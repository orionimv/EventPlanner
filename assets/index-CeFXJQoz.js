(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))a(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const v of m.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&a(v)}).observe(document,{childList:!0,subtree:!0});function n(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function a(h){if(h.ep)return;h.ep=!0;const m=n(h);fetch(h.href,m)}})();var th=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var O3={exports:{}},nT={},z3={exports:{}},xr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kx=Symbol.for("react.element"),U9=Symbol.for("react.portal"),j9=Symbol.for("react.fragment"),G9=Symbol.for("react.strict_mode"),$9=Symbol.for("react.profiler"),H9=Symbol.for("react.provider"),q9=Symbol.for("react.context"),W9=Symbol.for("react.forward_ref"),Z9=Symbol.for("react.suspense"),X9=Symbol.for("react.memo"),K9=Symbol.for("react.lazy"),HL=Symbol.iterator;function Y9(t){return t===null||typeof t!="object"?null:(t=HL&&t[HL]||t["@@iterator"],typeof t=="function"?t:null)}var F3={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N3=Object.assign,B3={};function $g(t,e,n){this.props=t,this.context=e,this.refs=B3,this.updater=n||F3}$g.prototype.isReactComponent={};$g.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};$g.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function V3(){}V3.prototype=$g.prototype;function u2(t,e,n){this.props=t,this.context=e,this.refs=B3,this.updater=n||F3}var h2=u2.prototype=new V3;h2.constructor=u2;N3(h2,$g.prototype);h2.isPureReactComponent=!0;var qL=Array.isArray,U3=Object.prototype.hasOwnProperty,d2={current:null},j3={key:!0,ref:!0,__self:!0,__source:!0};function G3(t,e,n){var a,h={},m=null,v=null;if(e!=null)for(a in e.ref!==void 0&&(v=e.ref),e.key!==void 0&&(m=""+e.key),e)U3.call(e,a)&&!j3.hasOwnProperty(a)&&(h[a]=e[a]);var o=arguments.length-2;if(o===1)h.children=n;else if(1<o){for(var S=Array(o),P=0;P<o;P++)S[P]=arguments[P+2];h.children=S}if(t&&t.defaultProps)for(a in o=t.defaultProps,o)h[a]===void 0&&(h[a]=o[a]);return{$$typeof:kx,type:t,key:m,ref:v,props:h,_owner:d2.current}}function Q9(t,e){return{$$typeof:kx,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function f2(t){return typeof t=="object"&&t!==null&&t.$$typeof===kx}function J9(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var WL=/\/+/g;function ZI(t,e){return typeof t=="object"&&t!==null&&t.key!=null?J9(""+t.key):e.toString(36)}function I1(t,e,n,a,h){var m=typeof t;(m==="undefined"||m==="boolean")&&(t=null);var v=!1;if(t===null)v=!0;else switch(m){case"string":case"number":v=!0;break;case"object":switch(t.$$typeof){case kx:case U9:v=!0}}if(v)return v=t,h=h(v),t=a===""?"."+ZI(v,0):a,qL(h)?(n="",t!=null&&(n=t.replace(WL,"$&/")+"/"),I1(h,e,n,"",function(P){return P})):h!=null&&(f2(h)&&(h=Q9(h,n+(!h.key||v&&v.key===h.key?"":(""+h.key).replace(WL,"$&/")+"/")+t)),e.push(h)),1;if(v=0,a=a===""?".":a+":",qL(t))for(var o=0;o<t.length;o++){m=t[o];var S=a+ZI(m,o);v+=I1(m,e,n,S,h)}else if(S=Y9(t),typeof S=="function")for(t=S.call(t),o=0;!(m=t.next()).done;)m=m.value,S=a+ZI(m,o++),v+=I1(m,e,n,S,h);else if(m==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return v}function Xw(t,e,n){if(t==null)return t;var a=[],h=0;return I1(t,a,"","",function(m){return e.call(n,m,h++)}),a}function eH(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ua={current:null},S1={transition:null},tH={ReactCurrentDispatcher:Ua,ReactCurrentBatchConfig:S1,ReactCurrentOwner:d2};function $3(){throw Error("act(...) is not supported in production builds of React.")}xr.Children={map:Xw,forEach:function(t,e,n){Xw(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Xw(t,function(){e++}),e},toArray:function(t){return Xw(t,function(e){return e})||[]},only:function(t){if(!f2(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};xr.Component=$g;xr.Fragment=j9;xr.Profiler=$9;xr.PureComponent=u2;xr.StrictMode=G9;xr.Suspense=Z9;xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tH;xr.act=$3;xr.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var a=N3({},t.props),h=t.key,m=t.ref,v=t._owner;if(e!=null){if(e.ref!==void 0&&(m=e.ref,v=d2.current),e.key!==void 0&&(h=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(S in e)U3.call(e,S)&&!j3.hasOwnProperty(S)&&(a[S]=e[S]===void 0&&o!==void 0?o[S]:e[S])}var S=arguments.length-2;if(S===1)a.children=n;else if(1<S){o=Array(S);for(var P=0;P<S;P++)o[P]=arguments[P+2];a.children=o}return{$$typeof:kx,type:t.type,key:h,ref:m,props:a,_owner:v}};xr.createContext=function(t){return t={$$typeof:q9,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:H9,_context:t},t.Consumer=t};xr.createElement=G3;xr.createFactory=function(t){var e=G3.bind(null,t);return e.type=t,e};xr.createRef=function(){return{current:null}};xr.forwardRef=function(t){return{$$typeof:W9,render:t}};xr.isValidElement=f2;xr.lazy=function(t){return{$$typeof:K9,_payload:{_status:-1,_result:t},_init:eH}};xr.memo=function(t,e){return{$$typeof:X9,type:t,compare:e===void 0?null:e}};xr.startTransition=function(t){var e=S1.transition;S1.transition={};try{t()}finally{S1.transition=e}};xr.unstable_act=$3;xr.useCallback=function(t,e){return Ua.current.useCallback(t,e)};xr.useContext=function(t){return Ua.current.useContext(t)};xr.useDebugValue=function(){};xr.useDeferredValue=function(t){return Ua.current.useDeferredValue(t)};xr.useEffect=function(t,e){return Ua.current.useEffect(t,e)};xr.useId=function(){return Ua.current.useId()};xr.useImperativeHandle=function(t,e,n){return Ua.current.useImperativeHandle(t,e,n)};xr.useInsertionEffect=function(t,e){return Ua.current.useInsertionEffect(t,e)};xr.useLayoutEffect=function(t,e){return Ua.current.useLayoutEffect(t,e)};xr.useMemo=function(t,e){return Ua.current.useMemo(t,e)};xr.useReducer=function(t,e,n){return Ua.current.useReducer(t,e,n)};xr.useRef=function(t){return Ua.current.useRef(t)};xr.useState=function(t){return Ua.current.useState(t)};xr.useSyncExternalStore=function(t,e,n){return Ua.current.useSyncExternalStore(t,e,n)};xr.useTransition=function(){return Ua.current.useTransition()};xr.version="18.3.1";z3.exports=xr;var yt=z3.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nH=yt,iH=Symbol.for("react.element"),rH=Symbol.for("react.fragment"),sH=Object.prototype.hasOwnProperty,oH=nH.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,aH={key:!0,ref:!0,__self:!0,__source:!0};function H3(t,e,n){var a,h={},m=null,v=null;n!==void 0&&(m=""+n),e.key!==void 0&&(m=""+e.key),e.ref!==void 0&&(v=e.ref);for(a in e)sH.call(e,a)&&!aH.hasOwnProperty(a)&&(h[a]=e[a]);if(t&&t.defaultProps)for(a in e=t.defaultProps,e)h[a]===void 0&&(h[a]=e[a]);return{$$typeof:iH,type:t,key:m,ref:v,props:h,_owner:oH.current}}nT.Fragment=rH;nT.jsx=H3;nT.jsxs=H3;O3.exports=nT;var mn=O3.exports,q3={exports:{}},Ml={},W3={exports:{}},Z3={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(vn,Vn){var je=vn.length;vn.push(Vn);e:for(;0<je;){var Pn=je-1>>>1,oi=vn[Pn];if(0<h(oi,Vn))vn[Pn]=Vn,vn[je]=oi,je=Pn;else break e}}function n(vn){return vn.length===0?null:vn[0]}function a(vn){if(vn.length===0)return null;var Vn=vn[0],je=vn.pop();if(je!==Vn){vn[0]=je;e:for(var Pn=0,oi=vn.length,et=oi>>>1;Pn<et;){var Xr=2*(Pn+1)-1,Kr=vn[Xr],qn=Xr+1,zi=vn[qn];if(0>h(Kr,je))qn<oi&&0>h(zi,Kr)?(vn[Pn]=zi,vn[qn]=je,Pn=qn):(vn[Pn]=Kr,vn[Xr]=je,Pn=Xr);else if(qn<oi&&0>h(zi,je))vn[Pn]=zi,vn[qn]=je,Pn=qn;else break e}}return Vn}function h(vn,Vn){var je=vn.sortIndex-Vn.sortIndex;return je!==0?je:vn.id-Vn.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;t.unstable_now=function(){return m.now()}}else{var v=Date,o=v.now();t.unstable_now=function(){return v.now()-o}}var S=[],P=[],N=1,V=null,j=3,Q=!1,oe=!1,me=!1,Ue=typeof setTimeout=="function"?setTimeout:null,de=typeof clearTimeout=="function"?clearTimeout:null,ge=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Re(vn){for(var Vn=n(P);Vn!==null;){if(Vn.callback===null)a(P);else if(Vn.startTime<=vn)a(P),Vn.sortIndex=Vn.expirationTime,e(S,Vn);else break;Vn=n(P)}}function _t(vn){if(me=!1,Re(vn),!oe)if(n(S)!==null)oe=!0,ii(ct);else{var Vn=n(P);Vn!==null&&Ii(_t,Vn.startTime-vn)}}function ct(vn,Vn){oe=!1,me&&(me=!1,de(xe),xe=-1),Q=!0;var je=j;try{for(Re(Vn),V=n(S);V!==null&&(!(V.expirationTime>Vn)||vn&&!De());){var Pn=V.callback;if(typeof Pn=="function"){V.callback=null,j=V.priorityLevel;var oi=Pn(V.expirationTime<=Vn);Vn=t.unstable_now(),typeof oi=="function"?V.callback=oi:V===n(S)&&a(S),Re(Vn)}else a(S);V=n(S)}if(V!==null)var et=!0;else{var Xr=n(P);Xr!==null&&Ii(_t,Xr.startTime-Vn),et=!1}return et}finally{V=null,j=je,Q=!1}}var nt=!1,Pe=null,xe=-1,ke=5,Ve=-1;function De(){return!(t.unstable_now()-Ve<ke)}function Qe(){if(Pe!==null){var vn=t.unstable_now();Ve=vn;var Vn=!0;try{Vn=Pe(!0,vn)}finally{Vn?Be():(nt=!1,Pe=null)}}else nt=!1}var Be;if(typeof ge=="function")Be=function(){ge(Qe)};else if(typeof MessageChannel<"u"){var Hn=new MessageChannel,Ln=Hn.port2;Hn.port1.onmessage=Qe,Be=function(){Ln.postMessage(null)}}else Be=function(){Ue(Qe,0)};function ii(vn){Pe=vn,nt||(nt=!0,Be())}function Ii(vn,Vn){xe=Ue(function(){vn(t.unstable_now())},Vn)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(vn){vn.callback=null},t.unstable_continueExecution=function(){oe||Q||(oe=!0,ii(ct))},t.unstable_forceFrameRate=function(vn){0>vn||125<vn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ke=0<vn?Math.floor(1e3/vn):5},t.unstable_getCurrentPriorityLevel=function(){return j},t.unstable_getFirstCallbackNode=function(){return n(S)},t.unstable_next=function(vn){switch(j){case 1:case 2:case 3:var Vn=3;break;default:Vn=j}var je=j;j=Vn;try{return vn()}finally{j=je}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(vn,Vn){switch(vn){case 1:case 2:case 3:case 4:case 5:break;default:vn=3}var je=j;j=vn;try{return Vn()}finally{j=je}},t.unstable_scheduleCallback=function(vn,Vn,je){var Pn=t.unstable_now();switch(typeof je=="object"&&je!==null?(je=je.delay,je=typeof je=="number"&&0<je?Pn+je:Pn):je=Pn,vn){case 1:var oi=-1;break;case 2:oi=250;break;case 5:oi=1073741823;break;case 4:oi=1e4;break;default:oi=5e3}return oi=je+oi,vn={id:N++,callback:Vn,priorityLevel:vn,startTime:je,expirationTime:oi,sortIndex:-1},je>Pn?(vn.sortIndex=je,e(P,vn),n(S)===null&&vn===n(P)&&(me?(de(xe),xe=-1):me=!0,Ii(_t,je-Pn))):(vn.sortIndex=oi,e(S,vn),oe||Q||(oe=!0,ii(ct))),vn},t.unstable_shouldYield=De,t.unstable_wrapCallback=function(vn){var Vn=j;return function(){var je=j;j=Vn;try{return vn.apply(this,arguments)}finally{j=je}}}})(Z3);W3.exports=Z3;var lH=W3.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cH=yt,Rl=lH;function wn(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var X3=new Set,Kv={};function vp(t,e){Ig(t,e),Ig(t+"Capture",e)}function Ig(t,e){for(Kv[t]=e,t=0;t<e.length;t++)X3.add(e[t])}var dh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dA=Object.prototype.hasOwnProperty,uH=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ZL={},XL={};function hH(t){return dA.call(XL,t)?!0:dA.call(ZL,t)?!1:uH.test(t)?XL[t]=!0:(ZL[t]=!0,!1)}function dH(t,e,n,a){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return a?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function fH(t,e,n,a){if(e===null||typeof e>"u"||dH(t,e,n,a))return!0;if(a)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ja(t,e,n,a,h,m,v){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=a,this.attributeNamespace=h,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=m,this.removeEmptyString=v}var ta={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ta[t]=new ja(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ta[e]=new ja(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ta[t]=new ja(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ta[t]=new ja(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ta[t]=new ja(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ta[t]=new ja(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ta[t]=new ja(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ta[t]=new ja(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ta[t]=new ja(t,5,!1,t.toLowerCase(),null,!1,!1)});var p2=/[\-:]([a-z])/g;function m2(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(p2,m2);ta[e]=new ja(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(p2,m2);ta[e]=new ja(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(p2,m2);ta[e]=new ja(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ta[t]=new ja(t,1,!1,t.toLowerCase(),null,!1,!1)});ta.xlinkHref=new ja("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ta[t]=new ja(t,1,!1,t.toLowerCase(),null,!0,!0)});function g2(t,e,n,a){var h=ta.hasOwnProperty(e)?ta[e]:null;(h!==null?h.type!==0:a||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(fH(e,n,h,a)&&(n=null),a||h===null?hH(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):h.mustUseProperty?t[h.propertyName]=n===null?h.type===3?!1:"":n:(e=h.attributeName,a=h.attributeNamespace,n===null?t.removeAttribute(e):(h=h.type,n=h===3||h===4&&n===!0?"":""+n,a?t.setAttributeNS(a,e,n):t.setAttribute(e,n))))}var bh=cH.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Kw=Symbol.for("react.element"),Xm=Symbol.for("react.portal"),Km=Symbol.for("react.fragment"),_2=Symbol.for("react.strict_mode"),fA=Symbol.for("react.profiler"),K3=Symbol.for("react.provider"),Y3=Symbol.for("react.context"),y2=Symbol.for("react.forward_ref"),pA=Symbol.for("react.suspense"),mA=Symbol.for("react.suspense_list"),v2=Symbol.for("react.memo"),_d=Symbol.for("react.lazy"),Q3=Symbol.for("react.offscreen"),KL=Symbol.iterator;function tv(t){return t===null||typeof t!="object"?null:(t=KL&&t[KL]||t["@@iterator"],typeof t=="function"?t:null)}var Gs=Object.assign,XI;function _v(t){if(XI===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);XI=e&&e[1]||""}return`
`+XI+t}var KI=!1;function YI(t,e){if(!t||KI)return"";KI=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(P){var a=P}Reflect.construct(t,[],e)}else{try{e.call()}catch(P){a=P}t.call(e.prototype)}else{try{throw Error()}catch(P){a=P}t()}}catch(P){if(P&&a&&typeof P.stack=="string"){for(var h=P.stack.split(`
`),m=a.stack.split(`
`),v=h.length-1,o=m.length-1;1<=v&&0<=o&&h[v]!==m[o];)o--;for(;1<=v&&0<=o;v--,o--)if(h[v]!==m[o]){if(v!==1||o!==1)do if(v--,o--,0>o||h[v]!==m[o]){var S=`
`+h[v].replace(" at new "," at ");return t.displayName&&S.includes("<anonymous>")&&(S=S.replace("<anonymous>",t.displayName)),S}while(1<=v&&0<=o);break}}}finally{KI=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?_v(t):""}function pH(t){switch(t.tag){case 5:return _v(t.type);case 16:return _v("Lazy");case 13:return _v("Suspense");case 19:return _v("SuspenseList");case 0:case 2:case 15:return t=YI(t.type,!1),t;case 11:return t=YI(t.type.render,!1),t;case 1:return t=YI(t.type,!0),t;default:return""}}function gA(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Km:return"Fragment";case Xm:return"Portal";case fA:return"Profiler";case _2:return"StrictMode";case pA:return"Suspense";case mA:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Y3:return(t.displayName||"Context")+".Consumer";case K3:return(t._context.displayName||"Context")+".Provider";case y2:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case v2:return e=t.displayName||null,e!==null?e:gA(t.type)||"Memo";case _d:e=t._payload,t=t._init;try{return gA(t(e))}catch{}}return null}function mH(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gA(e);case 8:return e===_2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gd(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function J3(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function gH(t){var e=J3(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),a=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var h=n.get,m=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return h.call(this)},set:function(v){a=""+v,m.call(this,v)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(v){a=""+v},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Yw(t){t._valueTracker||(t._valueTracker=gH(t))}function eB(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),a="";return t&&(a=J3(t)?t.checked?"true":"false":t.value),t=a,t!==n?(e.setValue(t),!0):!1}function Q1(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _A(t,e){var n=e.checked;return Gs({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function YL(t,e){var n=e.defaultValue==null?"":e.defaultValue,a=e.checked!=null?e.checked:e.defaultChecked;n=Gd(e.value!=null?e.value:n),t._wrapperState={initialChecked:a,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function tB(t,e){e=e.checked,e!=null&&g2(t,"checked",e,!1)}function yA(t,e){tB(t,e);var n=Gd(e.value),a=e.type;if(n!=null)a==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(a==="submit"||a==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?vA(t,e.type,n):e.hasOwnProperty("defaultValue")&&vA(t,e.type,Gd(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function QL(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var a=e.type;if(!(a!=="submit"&&a!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function vA(t,e,n){(e!=="number"||Q1(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var yv=Array.isArray;function ug(t,e,n,a){if(t=t.options,e){e={};for(var h=0;h<n.length;h++)e["$"+n[h]]=!0;for(n=0;n<t.length;n++)h=e.hasOwnProperty("$"+t[n].value),t[n].selected!==h&&(t[n].selected=h),h&&a&&(t[n].defaultSelected=!0)}else{for(n=""+Gd(n),e=null,h=0;h<t.length;h++){if(t[h].value===n){t[h].selected=!0,a&&(t[h].defaultSelected=!0);return}e!==null||t[h].disabled||(e=t[h])}e!==null&&(e.selected=!0)}}function xA(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(wn(91));return Gs({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function JL(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(wn(92));if(yv(n)){if(1<n.length)throw Error(wn(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Gd(n)}}function nB(t,e){var n=Gd(e.value),a=Gd(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),a!=null&&(t.defaultValue=""+a)}function eO(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function iB(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wA(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?iB(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Qw,rB=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,a,h){MSApp.execUnsafeLocalFunction(function(){return t(e,n,a,h)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Qw=Qw||document.createElement("div"),Qw.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Qw.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Yv(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Av={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_H=["Webkit","ms","Moz","O"];Object.keys(Av).forEach(function(t){_H.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Av[e]=Av[t]})});function sB(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Av.hasOwnProperty(t)&&Av[t]?(""+e).trim():e+"px"}function oB(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var a=n.indexOf("--")===0,h=sB(n,e[n],a);n==="float"&&(n="cssFloat"),a?t.setProperty(n,h):t[n]=h}}var yH=Gs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bA(t,e){if(e){if(yH[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(wn(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(wn(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(wn(61))}if(e.style!=null&&typeof e.style!="object")throw Error(wn(62))}}function TA(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var EA=null;function x2(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var IA=null,hg=null,dg=null;function tO(t){if(t=Lx(t)){if(typeof IA!="function")throw Error(wn(280));var e=t.stateNode;e&&(e=aT(e),IA(t.stateNode,t.type,e))}}function aB(t){hg?dg?dg.push(t):dg=[t]:hg=t}function lB(){if(hg){var t=hg,e=dg;if(dg=hg=null,tO(t),e)for(t=0;t<e.length;t++)tO(e[t])}}function cB(t,e){return t(e)}function uB(){}var QI=!1;function hB(t,e,n){if(QI)return t(e,n);QI=!0;try{return cB(t,e,n)}finally{QI=!1,(hg!==null||dg!==null)&&(uB(),lB())}}function Qv(t,e){var n=t.stateNode;if(n===null)return null;var a=aT(n);if(a===null)return null;n=a[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(t=t.type,a=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!a;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(wn(231,e,typeof n));return n}var SA=!1;if(dh)try{var nv={};Object.defineProperty(nv,"passive",{get:function(){SA=!0}}),window.addEventListener("test",nv,nv),window.removeEventListener("test",nv,nv)}catch{SA=!1}function vH(t,e,n,a,h,m,v,o,S){var P=Array.prototype.slice.call(arguments,3);try{e.apply(n,P)}catch(N){this.onError(N)}}var Cv=!1,J1=null,eb=!1,AA=null,xH={onError:function(t){Cv=!0,J1=t}};function wH(t,e,n,a,h,m,v,o,S){Cv=!1,J1=null,vH.apply(xH,arguments)}function bH(t,e,n,a,h,m,v,o,S){if(wH.apply(this,arguments),Cv){if(Cv){var P=J1;Cv=!1,J1=null}else throw Error(wn(198));eb||(eb=!0,AA=P)}}function xp(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function dB(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function nO(t){if(xp(t)!==t)throw Error(wn(188))}function TH(t){var e=t.alternate;if(!e){if(e=xp(t),e===null)throw Error(wn(188));return e!==t?null:t}for(var n=t,a=e;;){var h=n.return;if(h===null)break;var m=h.alternate;if(m===null){if(a=h.return,a!==null){n=a;continue}break}if(h.child===m.child){for(m=h.child;m;){if(m===n)return nO(h),t;if(m===a)return nO(h),e;m=m.sibling}throw Error(wn(188))}if(n.return!==a.return)n=h,a=m;else{for(var v=!1,o=h.child;o;){if(o===n){v=!0,n=h,a=m;break}if(o===a){v=!0,a=h,n=m;break}o=o.sibling}if(!v){for(o=m.child;o;){if(o===n){v=!0,n=m,a=h;break}if(o===a){v=!0,a=m,n=h;break}o=o.sibling}if(!v)throw Error(wn(189))}}if(n.alternate!==a)throw Error(wn(190))}if(n.tag!==3)throw Error(wn(188));return n.stateNode.current===n?t:e}function fB(t){return t=TH(t),t!==null?pB(t):null}function pB(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=pB(t);if(e!==null)return e;t=t.sibling}return null}var mB=Rl.unstable_scheduleCallback,iO=Rl.unstable_cancelCallback,EH=Rl.unstable_shouldYield,IH=Rl.unstable_requestPaint,no=Rl.unstable_now,SH=Rl.unstable_getCurrentPriorityLevel,w2=Rl.unstable_ImmediatePriority,gB=Rl.unstable_UserBlockingPriority,tb=Rl.unstable_NormalPriority,AH=Rl.unstable_LowPriority,_B=Rl.unstable_IdlePriority,iT=null,yu=null;function CH(t){if(yu&&typeof yu.onCommitFiberRoot=="function")try{yu.onCommitFiberRoot(iT,t,void 0,(t.current.flags&128)===128)}catch{}}var Sc=Math.clz32?Math.clz32:kH,PH=Math.log,RH=Math.LN2;function kH(t){return t>>>=0,t===0?32:31-(PH(t)/RH|0)|0}var Jw=64,e1=4194304;function vv(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function nb(t,e){var n=t.pendingLanes;if(n===0)return 0;var a=0,h=t.suspendedLanes,m=t.pingedLanes,v=n&268435455;if(v!==0){var o=v&~h;o!==0?a=vv(o):(m&=v,m!==0&&(a=vv(m)))}else v=n&~h,v!==0?a=vv(v):m!==0&&(a=vv(m));if(a===0)return 0;if(e!==0&&e!==a&&!(e&h)&&(h=a&-a,m=e&-e,h>=m||h===16&&(m&4194240)!==0))return e;if(a&4&&(a|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=a;0<e;)n=31-Sc(e),h=1<<n,a|=t[n],e&=~h;return a}function MH(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function DH(t,e){for(var n=t.suspendedLanes,a=t.pingedLanes,h=t.expirationTimes,m=t.pendingLanes;0<m;){var v=31-Sc(m),o=1<<v,S=h[v];S===-1?(!(o&n)||o&a)&&(h[v]=MH(o,e)):S<=e&&(t.expiredLanes|=o),m&=~o}}function CA(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function yB(){var t=Jw;return Jw<<=1,!(Jw&4194240)&&(Jw=64),t}function JI(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Mx(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Sc(e),t[e]=n}function LH(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var a=t.eventTimes;for(t=t.expirationTimes;0<n;){var h=31-Sc(n),m=1<<h;e[h]=0,a[h]=-1,t[h]=-1,n&=~m}}function b2(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var a=31-Sc(n),h=1<<a;h&e|t[a]&e&&(t[a]|=e),n&=~h}}var is=0;function vB(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var xB,T2,wB,bB,TB,PA=!1,t1=[],Ad=null,Cd=null,Pd=null,Jv=new Map,ex=new Map,vd=[],OH="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rO(t,e){switch(t){case"focusin":case"focusout":Ad=null;break;case"dragenter":case"dragleave":Cd=null;break;case"mouseover":case"mouseout":Pd=null;break;case"pointerover":case"pointerout":Jv.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ex.delete(e.pointerId)}}function iv(t,e,n,a,h,m){return t===null||t.nativeEvent!==m?(t={blockedOn:e,domEventName:n,eventSystemFlags:a,nativeEvent:m,targetContainers:[h]},e!==null&&(e=Lx(e),e!==null&&T2(e)),t):(t.eventSystemFlags|=a,e=t.targetContainers,h!==null&&e.indexOf(h)===-1&&e.push(h),t)}function zH(t,e,n,a,h){switch(e){case"focusin":return Ad=iv(Ad,t,e,n,a,h),!0;case"dragenter":return Cd=iv(Cd,t,e,n,a,h),!0;case"mouseover":return Pd=iv(Pd,t,e,n,a,h),!0;case"pointerover":var m=h.pointerId;return Jv.set(m,iv(Jv.get(m)||null,t,e,n,a,h)),!0;case"gotpointercapture":return m=h.pointerId,ex.set(m,iv(ex.get(m)||null,t,e,n,a,h)),!0}return!1}function EB(t){var e=Zf(t.target);if(e!==null){var n=xp(e);if(n!==null){if(e=n.tag,e===13){if(e=dB(n),e!==null){t.blockedOn=e,TB(t.priority,function(){wB(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function A1(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=RA(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var a=new n.constructor(n.type,n);EA=a,n.target.dispatchEvent(a),EA=null}else return e=Lx(n),e!==null&&T2(e),t.blockedOn=n,!1;e.shift()}return!0}function sO(t,e,n){A1(t)&&n.delete(e)}function FH(){PA=!1,Ad!==null&&A1(Ad)&&(Ad=null),Cd!==null&&A1(Cd)&&(Cd=null),Pd!==null&&A1(Pd)&&(Pd=null),Jv.forEach(sO),ex.forEach(sO)}function rv(t,e){t.blockedOn===e&&(t.blockedOn=null,PA||(PA=!0,Rl.unstable_scheduleCallback(Rl.unstable_NormalPriority,FH)))}function tx(t){function e(h){return rv(h,t)}if(0<t1.length){rv(t1[0],t);for(var n=1;n<t1.length;n++){var a=t1[n];a.blockedOn===t&&(a.blockedOn=null)}}for(Ad!==null&&rv(Ad,t),Cd!==null&&rv(Cd,t),Pd!==null&&rv(Pd,t),Jv.forEach(e),ex.forEach(e),n=0;n<vd.length;n++)a=vd[n],a.blockedOn===t&&(a.blockedOn=null);for(;0<vd.length&&(n=vd[0],n.blockedOn===null);)EB(n),n.blockedOn===null&&vd.shift()}var fg=bh.ReactCurrentBatchConfig,ib=!0;function NH(t,e,n,a){var h=is,m=fg.transition;fg.transition=null;try{is=1,E2(t,e,n,a)}finally{is=h,fg.transition=m}}function BH(t,e,n,a){var h=is,m=fg.transition;fg.transition=null;try{is=4,E2(t,e,n,a)}finally{is=h,fg.transition=m}}function E2(t,e,n,a){if(ib){var h=RA(t,e,n,a);if(h===null)cS(t,e,a,rb,n),rO(t,a);else if(zH(h,t,e,n,a))a.stopPropagation();else if(rO(t,a),e&4&&-1<OH.indexOf(t)){for(;h!==null;){var m=Lx(h);if(m!==null&&xB(m),m=RA(t,e,n,a),m===null&&cS(t,e,a,rb,n),m===h)break;h=m}h!==null&&a.stopPropagation()}else cS(t,e,a,null,n)}}var rb=null;function RA(t,e,n,a){if(rb=null,t=x2(a),t=Zf(t),t!==null)if(e=xp(t),e===null)t=null;else if(n=e.tag,n===13){if(t=dB(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return rb=t,null}function IB(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(SH()){case w2:return 1;case gB:return 4;case tb:case AH:return 16;case _B:return 536870912;default:return 16}default:return 16}}var Ed=null,I2=null,C1=null;function SB(){if(C1)return C1;var t,e=I2,n=e.length,a,h="value"in Ed?Ed.value:Ed.textContent,m=h.length;for(t=0;t<n&&e[t]===h[t];t++);var v=n-t;for(a=1;a<=v&&e[n-a]===h[m-a];a++);return C1=h.slice(t,1<a?1-a:void 0)}function P1(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function n1(){return!0}function oO(){return!1}function Dl(t){function e(n,a,h,m,v){this._reactName=n,this._targetInst=h,this.type=a,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(m):m[o]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?n1:oO,this.isPropagationStopped=oO,this}return Gs(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=n1)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=n1)},persist:function(){},isPersistent:n1}),e}var Hg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},S2=Dl(Hg),Dx=Gs({},Hg,{view:0,detail:0}),VH=Dl(Dx),eS,tS,sv,rT=Gs({},Dx,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:A2,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==sv&&(sv&&t.type==="mousemove"?(eS=t.screenX-sv.screenX,tS=t.screenY-sv.screenY):tS=eS=0,sv=t),eS)},movementY:function(t){return"movementY"in t?t.movementY:tS}}),aO=Dl(rT),UH=Gs({},rT,{dataTransfer:0}),jH=Dl(UH),GH=Gs({},Dx,{relatedTarget:0}),nS=Dl(GH),$H=Gs({},Hg,{animationName:0,elapsedTime:0,pseudoElement:0}),HH=Dl($H),qH=Gs({},Hg,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),WH=Dl(qH),ZH=Gs({},Hg,{data:0}),lO=Dl(ZH),XH={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},KH={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},YH={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function QH(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=YH[t])?!!e[t]:!1}function A2(){return QH}var JH=Gs({},Dx,{key:function(t){if(t.key){var e=XH[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=P1(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?KH[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:A2,charCode:function(t){return t.type==="keypress"?P1(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?P1(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),eq=Dl(JH),tq=Gs({},rT,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cO=Dl(tq),nq=Gs({},Dx,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:A2}),iq=Dl(nq),rq=Gs({},Hg,{propertyName:0,elapsedTime:0,pseudoElement:0}),sq=Dl(rq),oq=Gs({},rT,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),aq=Dl(oq),lq=[9,13,27,32],C2=dh&&"CompositionEvent"in window,Pv=null;dh&&"documentMode"in document&&(Pv=document.documentMode);var cq=dh&&"TextEvent"in window&&!Pv,AB=dh&&(!C2||Pv&&8<Pv&&11>=Pv),uO=" ",hO=!1;function CB(t,e){switch(t){case"keyup":return lq.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function PB(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ym=!1;function uq(t,e){switch(t){case"compositionend":return PB(e);case"keypress":return e.which!==32?null:(hO=!0,uO);case"textInput":return t=e.data,t===uO&&hO?null:t;default:return null}}function hq(t,e){if(Ym)return t==="compositionend"||!C2&&CB(t,e)?(t=SB(),C1=I2=Ed=null,Ym=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return AB&&e.locale!=="ko"?null:e.data;default:return null}}var dq={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dO(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!dq[t.type]:e==="textarea"}function RB(t,e,n,a){aB(a),e=sb(e,"onChange"),0<e.length&&(n=new S2("onChange","change",null,n,a),t.push({event:n,listeners:e}))}var Rv=null,nx=null;function fq(t){UB(t,0)}function sT(t){var e=eg(t);if(eB(e))return t}function pq(t,e){if(t==="change")return e}var kB=!1;if(dh){var iS;if(dh){var rS="oninput"in document;if(!rS){var fO=document.createElement("div");fO.setAttribute("oninput","return;"),rS=typeof fO.oninput=="function"}iS=rS}else iS=!1;kB=iS&&(!document.documentMode||9<document.documentMode)}function pO(){Rv&&(Rv.detachEvent("onpropertychange",MB),nx=Rv=null)}function MB(t){if(t.propertyName==="value"&&sT(nx)){var e=[];RB(e,nx,t,x2(t)),hB(fq,e)}}function mq(t,e,n){t==="focusin"?(pO(),Rv=e,nx=n,Rv.attachEvent("onpropertychange",MB)):t==="focusout"&&pO()}function gq(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return sT(nx)}function _q(t,e){if(t==="click")return sT(e)}function yq(t,e){if(t==="input"||t==="change")return sT(e)}function vq(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var kc=typeof Object.is=="function"?Object.is:vq;function ix(t,e){if(kc(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),a=Object.keys(e);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++){var h=n[a];if(!dA.call(e,h)||!kc(t[h],e[h]))return!1}return!0}function mO(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function gO(t,e){var n=mO(t);t=0;for(var a;n;){if(n.nodeType===3){if(a=t+n.textContent.length,t<=e&&a>=e)return{node:n,offset:e-t};t=a}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=mO(n)}}function DB(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?DB(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function LB(){for(var t=window,e=Q1();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Q1(t.document)}return e}function P2(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function xq(t){var e=LB(),n=t.focusedElem,a=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&DB(n.ownerDocument.documentElement,n)){if(a!==null&&P2(n)){if(e=a.start,t=a.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var h=n.textContent.length,m=Math.min(a.start,h);a=a.end===void 0?m:Math.min(a.end,h),!t.extend&&m>a&&(h=a,a=m,m=h),h=gO(n,m);var v=gO(n,a);h&&v&&(t.rangeCount!==1||t.anchorNode!==h.node||t.anchorOffset!==h.offset||t.focusNode!==v.node||t.focusOffset!==v.offset)&&(e=e.createRange(),e.setStart(h.node,h.offset),t.removeAllRanges(),m>a?(t.addRange(e),t.extend(v.node,v.offset)):(e.setEnd(v.node,v.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var wq=dh&&"documentMode"in document&&11>=document.documentMode,Qm=null,kA=null,kv=null,MA=!1;function _O(t,e,n){var a=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;MA||Qm==null||Qm!==Q1(a)||(a=Qm,"selectionStart"in a&&P2(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),kv&&ix(kv,a)||(kv=a,a=sb(kA,"onSelect"),0<a.length&&(e=new S2("onSelect","select",null,e,n),t.push({event:e,listeners:a}),e.target=Qm)))}function i1(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Jm={animationend:i1("Animation","AnimationEnd"),animationiteration:i1("Animation","AnimationIteration"),animationstart:i1("Animation","AnimationStart"),transitionend:i1("Transition","TransitionEnd")},sS={},OB={};dh&&(OB=document.createElement("div").style,"AnimationEvent"in window||(delete Jm.animationend.animation,delete Jm.animationiteration.animation,delete Jm.animationstart.animation),"TransitionEvent"in window||delete Jm.transitionend.transition);function oT(t){if(sS[t])return sS[t];if(!Jm[t])return t;var e=Jm[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in OB)return sS[t]=e[n];return t}var zB=oT("animationend"),FB=oT("animationiteration"),NB=oT("animationstart"),BB=oT("transitionend"),VB=new Map,yO="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qd(t,e){VB.set(t,e),vp(e,[t])}for(var oS=0;oS<yO.length;oS++){var aS=yO[oS],bq=aS.toLowerCase(),Tq=aS[0].toUpperCase()+aS.slice(1);Qd(bq,"on"+Tq)}Qd(zB,"onAnimationEnd");Qd(FB,"onAnimationIteration");Qd(NB,"onAnimationStart");Qd("dblclick","onDoubleClick");Qd("focusin","onFocus");Qd("focusout","onBlur");Qd(BB,"onTransitionEnd");Ig("onMouseEnter",["mouseout","mouseover"]);Ig("onMouseLeave",["mouseout","mouseover"]);Ig("onPointerEnter",["pointerout","pointerover"]);Ig("onPointerLeave",["pointerout","pointerover"]);vp("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vp("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vp("onBeforeInput",["compositionend","keypress","textInput","paste"]);vp("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vp("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vp("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Eq=new Set("cancel close invalid load scroll toggle".split(" ").concat(xv));function vO(t,e,n){var a=t.type||"unknown-event";t.currentTarget=n,bH(a,e,void 0,t),t.currentTarget=null}function UB(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var a=t[n],h=a.event;a=a.listeners;e:{var m=void 0;if(e)for(var v=a.length-1;0<=v;v--){var o=a[v],S=o.instance,P=o.currentTarget;if(o=o.listener,S!==m&&h.isPropagationStopped())break e;vO(h,o,P),m=S}else for(v=0;v<a.length;v++){if(o=a[v],S=o.instance,P=o.currentTarget,o=o.listener,S!==m&&h.isPropagationStopped())break e;vO(h,o,P),m=S}}}if(eb)throw t=AA,eb=!1,AA=null,t}function As(t,e){var n=e[FA];n===void 0&&(n=e[FA]=new Set);var a=t+"__bubble";n.has(a)||(jB(e,t,2,!1),n.add(a))}function lS(t,e,n){var a=0;e&&(a|=4),jB(n,t,a,e)}var r1="_reactListening"+Math.random().toString(36).slice(2);function rx(t){if(!t[r1]){t[r1]=!0,X3.forEach(function(n){n!=="selectionchange"&&(Eq.has(n)||lS(n,!1,t),lS(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[r1]||(e[r1]=!0,lS("selectionchange",!1,e))}}function jB(t,e,n,a){switch(IB(e)){case 1:var h=NH;break;case 4:h=BH;break;default:h=E2}n=h.bind(null,e,n,t),h=void 0,!SA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(h=!0),a?h!==void 0?t.addEventListener(e,n,{capture:!0,passive:h}):t.addEventListener(e,n,!0):h!==void 0?t.addEventListener(e,n,{passive:h}):t.addEventListener(e,n,!1)}function cS(t,e,n,a,h){var m=a;if(!(e&1)&&!(e&2)&&a!==null)e:for(;;){if(a===null)return;var v=a.tag;if(v===3||v===4){var o=a.stateNode.containerInfo;if(o===h||o.nodeType===8&&o.parentNode===h)break;if(v===4)for(v=a.return;v!==null;){var S=v.tag;if((S===3||S===4)&&(S=v.stateNode.containerInfo,S===h||S.nodeType===8&&S.parentNode===h))return;v=v.return}for(;o!==null;){if(v=Zf(o),v===null)return;if(S=v.tag,S===5||S===6){a=m=v;continue e}o=o.parentNode}}a=a.return}hB(function(){var P=m,N=x2(n),V=[];e:{var j=VB.get(t);if(j!==void 0){var Q=S2,oe=t;switch(t){case"keypress":if(P1(n)===0)break e;case"keydown":case"keyup":Q=eq;break;case"focusin":oe="focus",Q=nS;break;case"focusout":oe="blur",Q=nS;break;case"beforeblur":case"afterblur":Q=nS;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Q=aO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Q=jH;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Q=iq;break;case zB:case FB:case NB:Q=HH;break;case BB:Q=sq;break;case"scroll":Q=VH;break;case"wheel":Q=aq;break;case"copy":case"cut":case"paste":Q=WH;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Q=cO}var me=(e&4)!==0,Ue=!me&&t==="scroll",de=me?j!==null?j+"Capture":null:j;me=[];for(var ge=P,Re;ge!==null;){Re=ge;var _t=Re.stateNode;if(Re.tag===5&&_t!==null&&(Re=_t,de!==null&&(_t=Qv(ge,de),_t!=null&&me.push(sx(ge,_t,Re)))),Ue)break;ge=ge.return}0<me.length&&(j=new Q(j,oe,null,n,N),V.push({event:j,listeners:me}))}}if(!(e&7)){e:{if(j=t==="mouseover"||t==="pointerover",Q=t==="mouseout"||t==="pointerout",j&&n!==EA&&(oe=n.relatedTarget||n.fromElement)&&(Zf(oe)||oe[fh]))break e;if((Q||j)&&(j=N.window===N?N:(j=N.ownerDocument)?j.defaultView||j.parentWindow:window,Q?(oe=n.relatedTarget||n.toElement,Q=P,oe=oe?Zf(oe):null,oe!==null&&(Ue=xp(oe),oe!==Ue||oe.tag!==5&&oe.tag!==6)&&(oe=null)):(Q=null,oe=P),Q!==oe)){if(me=aO,_t="onMouseLeave",de="onMouseEnter",ge="mouse",(t==="pointerout"||t==="pointerover")&&(me=cO,_t="onPointerLeave",de="onPointerEnter",ge="pointer"),Ue=Q==null?j:eg(Q),Re=oe==null?j:eg(oe),j=new me(_t,ge+"leave",Q,n,N),j.target=Ue,j.relatedTarget=Re,_t=null,Zf(N)===P&&(me=new me(de,ge+"enter",oe,n,N),me.target=Re,me.relatedTarget=Ue,_t=me),Ue=_t,Q&&oe)t:{for(me=Q,de=oe,ge=0,Re=me;Re;Re=jm(Re))ge++;for(Re=0,_t=de;_t;_t=jm(_t))Re++;for(;0<ge-Re;)me=jm(me),ge--;for(;0<Re-ge;)de=jm(de),Re--;for(;ge--;){if(me===de||de!==null&&me===de.alternate)break t;me=jm(me),de=jm(de)}me=null}else me=null;Q!==null&&xO(V,j,Q,me,!1),oe!==null&&Ue!==null&&xO(V,Ue,oe,me,!0)}}e:{if(j=P?eg(P):window,Q=j.nodeName&&j.nodeName.toLowerCase(),Q==="select"||Q==="input"&&j.type==="file")var ct=pq;else if(dO(j))if(kB)ct=yq;else{ct=gq;var nt=mq}else(Q=j.nodeName)&&Q.toLowerCase()==="input"&&(j.type==="checkbox"||j.type==="radio")&&(ct=_q);if(ct&&(ct=ct(t,P))){RB(V,ct,n,N);break e}nt&&nt(t,j,P),t==="focusout"&&(nt=j._wrapperState)&&nt.controlled&&j.type==="number"&&vA(j,"number",j.value)}switch(nt=P?eg(P):window,t){case"focusin":(dO(nt)||nt.contentEditable==="true")&&(Qm=nt,kA=P,kv=null);break;case"focusout":kv=kA=Qm=null;break;case"mousedown":MA=!0;break;case"contextmenu":case"mouseup":case"dragend":MA=!1,_O(V,n,N);break;case"selectionchange":if(wq)break;case"keydown":case"keyup":_O(V,n,N)}var Pe;if(C2)e:{switch(t){case"compositionstart":var xe="onCompositionStart";break e;case"compositionend":xe="onCompositionEnd";break e;case"compositionupdate":xe="onCompositionUpdate";break e}xe=void 0}else Ym?CB(t,n)&&(xe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(xe="onCompositionStart");xe&&(AB&&n.locale!=="ko"&&(Ym||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&Ym&&(Pe=SB()):(Ed=N,I2="value"in Ed?Ed.value:Ed.textContent,Ym=!0)),nt=sb(P,xe),0<nt.length&&(xe=new lO(xe,t,null,n,N),V.push({event:xe,listeners:nt}),Pe?xe.data=Pe:(Pe=PB(n),Pe!==null&&(xe.data=Pe)))),(Pe=cq?uq(t,n):hq(t,n))&&(P=sb(P,"onBeforeInput"),0<P.length&&(N=new lO("onBeforeInput","beforeinput",null,n,N),V.push({event:N,listeners:P}),N.data=Pe))}UB(V,e)})}function sx(t,e,n){return{instance:t,listener:e,currentTarget:n}}function sb(t,e){for(var n=e+"Capture",a=[];t!==null;){var h=t,m=h.stateNode;h.tag===5&&m!==null&&(h=m,m=Qv(t,n),m!=null&&a.unshift(sx(t,m,h)),m=Qv(t,e),m!=null&&a.push(sx(t,m,h))),t=t.return}return a}function jm(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function xO(t,e,n,a,h){for(var m=e._reactName,v=[];n!==null&&n!==a;){var o=n,S=o.alternate,P=o.stateNode;if(S!==null&&S===a)break;o.tag===5&&P!==null&&(o=P,h?(S=Qv(n,m),S!=null&&v.unshift(sx(n,S,o))):h||(S=Qv(n,m),S!=null&&v.push(sx(n,S,o)))),n=n.return}v.length!==0&&t.push({event:e,listeners:v})}var Iq=/\r\n?/g,Sq=/\u0000|\uFFFD/g;function wO(t){return(typeof t=="string"?t:""+t).replace(Iq,`
`).replace(Sq,"")}function s1(t,e,n){if(e=wO(e),wO(t)!==e&&n)throw Error(wn(425))}function ob(){}var DA=null,LA=null;function OA(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var zA=typeof setTimeout=="function"?setTimeout:void 0,Aq=typeof clearTimeout=="function"?clearTimeout:void 0,bO=typeof Promise=="function"?Promise:void 0,Cq=typeof queueMicrotask=="function"?queueMicrotask:typeof bO<"u"?function(t){return bO.resolve(null).then(t).catch(Pq)}:zA;function Pq(t){setTimeout(function(){throw t})}function uS(t,e){var n=e,a=0;do{var h=n.nextSibling;if(t.removeChild(n),h&&h.nodeType===8)if(n=h.data,n==="/$"){if(a===0){t.removeChild(h),tx(e);return}a--}else n!=="$"&&n!=="$?"&&n!=="$!"||a++;n=h}while(n);tx(e)}function Rd(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function TO(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var qg=Math.random().toString(36).slice(2),mu="__reactFiber$"+qg,ox="__reactProps$"+qg,fh="__reactContainer$"+qg,FA="__reactEvents$"+qg,Rq="__reactListeners$"+qg,kq="__reactHandles$"+qg;function Zf(t){var e=t[mu];if(e)return e;for(var n=t.parentNode;n;){if(e=n[fh]||n[mu]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=TO(t);t!==null;){if(n=t[mu])return n;t=TO(t)}return e}t=n,n=t.parentNode}return null}function Lx(t){return t=t[mu]||t[fh],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function eg(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(wn(33))}function aT(t){return t[ox]||null}var NA=[],tg=-1;function Jd(t){return{current:t}}function ks(t){0>tg||(t.current=NA[tg],NA[tg]=null,tg--)}function xs(t,e){tg++,NA[tg]=t.current,t.current=e}var $d={},wa=Jd($d),sl=Jd(!1),sp=$d;function Sg(t,e){var n=t.type.contextTypes;if(!n)return $d;var a=t.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===e)return a.__reactInternalMemoizedMaskedChildContext;var h={},m;for(m in n)h[m]=e[m];return a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=h),h}function ol(t){return t=t.childContextTypes,t!=null}function ab(){ks(sl),ks(wa)}function EO(t,e,n){if(wa.current!==$d)throw Error(wn(168));xs(wa,e),xs(sl,n)}function GB(t,e,n){var a=t.stateNode;if(e=e.childContextTypes,typeof a.getChildContext!="function")return n;a=a.getChildContext();for(var h in a)if(!(h in e))throw Error(wn(108,mH(t)||"Unknown",h));return Gs({},n,a)}function lb(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||$d,sp=wa.current,xs(wa,t),xs(sl,sl.current),!0}function IO(t,e,n){var a=t.stateNode;if(!a)throw Error(wn(169));n?(t=GB(t,e,sp),a.__reactInternalMemoizedMergedChildContext=t,ks(sl),ks(wa),xs(wa,t)):ks(sl),xs(sl,n)}var Ju=null,lT=!1,hS=!1;function $B(t){Ju===null?Ju=[t]:Ju.push(t)}function Mq(t){lT=!0,$B(t)}function ef(){if(!hS&&Ju!==null){hS=!0;var t=0,e=is;try{var n=Ju;for(is=1;t<n.length;t++){var a=n[t];do a=a(!0);while(a!==null)}Ju=null,lT=!1}catch(h){throw Ju!==null&&(Ju=Ju.slice(t+1)),mB(w2,ef),h}finally{is=e,hS=!1}}return null}var ng=[],ig=0,cb=null,ub=0,Xl=[],Kl=0,op=null,nh=1,ih="";function Gf(t,e){ng[ig++]=ub,ng[ig++]=cb,cb=t,ub=e}function HB(t,e,n){Xl[Kl++]=nh,Xl[Kl++]=ih,Xl[Kl++]=op,op=t;var a=nh;t=ih;var h=32-Sc(a)-1;a&=~(1<<h),n+=1;var m=32-Sc(e)+h;if(30<m){var v=h-h%5;m=(a&(1<<v)-1).toString(32),a>>=v,h-=v,nh=1<<32-Sc(e)+h|n<<h|a,ih=m+t}else nh=1<<m|n<<h|a,ih=t}function R2(t){t.return!==null&&(Gf(t,1),HB(t,1,0))}function k2(t){for(;t===cb;)cb=ng[--ig],ng[ig]=null,ub=ng[--ig],ng[ig]=null;for(;t===op;)op=Xl[--Kl],Xl[Kl]=null,ih=Xl[--Kl],Xl[Kl]=null,nh=Xl[--Kl],Xl[Kl]=null}var Al=null,El=null,Ns=!1,bc=null;function qB(t,e){var n=Jl(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function SO(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Al=t,El=Rd(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Al=t,El=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=op!==null?{id:nh,overflow:ih}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Jl(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Al=t,El=null,!0):!1;default:return!1}}function BA(t){return(t.mode&1)!==0&&(t.flags&128)===0}function VA(t){if(Ns){var e=El;if(e){var n=e;if(!SO(t,e)){if(BA(t))throw Error(wn(418));e=Rd(n.nextSibling);var a=Al;e&&SO(t,e)?qB(a,n):(t.flags=t.flags&-4097|2,Ns=!1,Al=t)}}else{if(BA(t))throw Error(wn(418));t.flags=t.flags&-4097|2,Ns=!1,Al=t}}}function AO(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Al=t}function o1(t){if(t!==Al)return!1;if(!Ns)return AO(t),Ns=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!OA(t.type,t.memoizedProps)),e&&(e=El)){if(BA(t))throw WB(),Error(wn(418));for(;e;)qB(t,e),e=Rd(e.nextSibling)}if(AO(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(wn(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){El=Rd(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}El=null}}else El=Al?Rd(t.stateNode.nextSibling):null;return!0}function WB(){for(var t=El;t;)t=Rd(t.nextSibling)}function Ag(){El=Al=null,Ns=!1}function M2(t){bc===null?bc=[t]:bc.push(t)}var Dq=bh.ReactCurrentBatchConfig;function ov(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(wn(309));var a=n.stateNode}if(!a)throw Error(wn(147,t));var h=a,m=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===m?e.ref:(e=function(v){var o=h.refs;v===null?delete o[m]:o[m]=v},e._stringRef=m,e)}if(typeof t!="string")throw Error(wn(284));if(!n._owner)throw Error(wn(290,t))}return t}function a1(t,e){throw t=Object.prototype.toString.call(e),Error(wn(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function CO(t){var e=t._init;return e(t._payload)}function ZB(t){function e(de,ge){if(t){var Re=de.deletions;Re===null?(de.deletions=[ge],de.flags|=16):Re.push(ge)}}function n(de,ge){if(!t)return null;for(;ge!==null;)e(de,ge),ge=ge.sibling;return null}function a(de,ge){for(de=new Map;ge!==null;)ge.key!==null?de.set(ge.key,ge):de.set(ge.index,ge),ge=ge.sibling;return de}function h(de,ge){return de=Ld(de,ge),de.index=0,de.sibling=null,de}function m(de,ge,Re){return de.index=Re,t?(Re=de.alternate,Re!==null?(Re=Re.index,Re<ge?(de.flags|=2,ge):Re):(de.flags|=2,ge)):(de.flags|=1048576,ge)}function v(de){return t&&de.alternate===null&&(de.flags|=2),de}function o(de,ge,Re,_t){return ge===null||ge.tag!==6?(ge=yS(Re,de.mode,_t),ge.return=de,ge):(ge=h(ge,Re),ge.return=de,ge)}function S(de,ge,Re,_t){var ct=Re.type;return ct===Km?N(de,ge,Re.props.children,_t,Re.key):ge!==null&&(ge.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===_d&&CO(ct)===ge.type)?(_t=h(ge,Re.props),_t.ref=ov(de,ge,Re),_t.return=de,_t):(_t=z1(Re.type,Re.key,Re.props,null,de.mode,_t),_t.ref=ov(de,ge,Re),_t.return=de,_t)}function P(de,ge,Re,_t){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Re.containerInfo||ge.stateNode.implementation!==Re.implementation?(ge=vS(Re,de.mode,_t),ge.return=de,ge):(ge=h(ge,Re.children||[]),ge.return=de,ge)}function N(de,ge,Re,_t,ct){return ge===null||ge.tag!==7?(ge=np(Re,de.mode,_t,ct),ge.return=de,ge):(ge=h(ge,Re),ge.return=de,ge)}function V(de,ge,Re){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=yS(""+ge,de.mode,Re),ge.return=de,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case Kw:return Re=z1(ge.type,ge.key,ge.props,null,de.mode,Re),Re.ref=ov(de,null,ge),Re.return=de,Re;case Xm:return ge=vS(ge,de.mode,Re),ge.return=de,ge;case _d:var _t=ge._init;return V(de,_t(ge._payload),Re)}if(yv(ge)||tv(ge))return ge=np(ge,de.mode,Re,null),ge.return=de,ge;a1(de,ge)}return null}function j(de,ge,Re,_t){var ct=ge!==null?ge.key:null;if(typeof Re=="string"&&Re!==""||typeof Re=="number")return ct!==null?null:o(de,ge,""+Re,_t);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case Kw:return Re.key===ct?S(de,ge,Re,_t):null;case Xm:return Re.key===ct?P(de,ge,Re,_t):null;case _d:return ct=Re._init,j(de,ge,ct(Re._payload),_t)}if(yv(Re)||tv(Re))return ct!==null?null:N(de,ge,Re,_t,null);a1(de,Re)}return null}function Q(de,ge,Re,_t,ct){if(typeof _t=="string"&&_t!==""||typeof _t=="number")return de=de.get(Re)||null,o(ge,de,""+_t,ct);if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case Kw:return de=de.get(_t.key===null?Re:_t.key)||null,S(ge,de,_t,ct);case Xm:return de=de.get(_t.key===null?Re:_t.key)||null,P(ge,de,_t,ct);case _d:var nt=_t._init;return Q(de,ge,Re,nt(_t._payload),ct)}if(yv(_t)||tv(_t))return de=de.get(Re)||null,N(ge,de,_t,ct,null);a1(ge,_t)}return null}function oe(de,ge,Re,_t){for(var ct=null,nt=null,Pe=ge,xe=ge=0,ke=null;Pe!==null&&xe<Re.length;xe++){Pe.index>xe?(ke=Pe,Pe=null):ke=Pe.sibling;var Ve=j(de,Pe,Re[xe],_t);if(Ve===null){Pe===null&&(Pe=ke);break}t&&Pe&&Ve.alternate===null&&e(de,Pe),ge=m(Ve,ge,xe),nt===null?ct=Ve:nt.sibling=Ve,nt=Ve,Pe=ke}if(xe===Re.length)return n(de,Pe),Ns&&Gf(de,xe),ct;if(Pe===null){for(;xe<Re.length;xe++)Pe=V(de,Re[xe],_t),Pe!==null&&(ge=m(Pe,ge,xe),nt===null?ct=Pe:nt.sibling=Pe,nt=Pe);return Ns&&Gf(de,xe),ct}for(Pe=a(de,Pe);xe<Re.length;xe++)ke=Q(Pe,de,xe,Re[xe],_t),ke!==null&&(t&&ke.alternate!==null&&Pe.delete(ke.key===null?xe:ke.key),ge=m(ke,ge,xe),nt===null?ct=ke:nt.sibling=ke,nt=ke);return t&&Pe.forEach(function(De){return e(de,De)}),Ns&&Gf(de,xe),ct}function me(de,ge,Re,_t){var ct=tv(Re);if(typeof ct!="function")throw Error(wn(150));if(Re=ct.call(Re),Re==null)throw Error(wn(151));for(var nt=ct=null,Pe=ge,xe=ge=0,ke=null,Ve=Re.next();Pe!==null&&!Ve.done;xe++,Ve=Re.next()){Pe.index>xe?(ke=Pe,Pe=null):ke=Pe.sibling;var De=j(de,Pe,Ve.value,_t);if(De===null){Pe===null&&(Pe=ke);break}t&&Pe&&De.alternate===null&&e(de,Pe),ge=m(De,ge,xe),nt===null?ct=De:nt.sibling=De,nt=De,Pe=ke}if(Ve.done)return n(de,Pe),Ns&&Gf(de,xe),ct;if(Pe===null){for(;!Ve.done;xe++,Ve=Re.next())Ve=V(de,Ve.value,_t),Ve!==null&&(ge=m(Ve,ge,xe),nt===null?ct=Ve:nt.sibling=Ve,nt=Ve);return Ns&&Gf(de,xe),ct}for(Pe=a(de,Pe);!Ve.done;xe++,Ve=Re.next())Ve=Q(Pe,de,xe,Ve.value,_t),Ve!==null&&(t&&Ve.alternate!==null&&Pe.delete(Ve.key===null?xe:Ve.key),ge=m(Ve,ge,xe),nt===null?ct=Ve:nt.sibling=Ve,nt=Ve);return t&&Pe.forEach(function(Qe){return e(de,Qe)}),Ns&&Gf(de,xe),ct}function Ue(de,ge,Re,_t){if(typeof Re=="object"&&Re!==null&&Re.type===Km&&Re.key===null&&(Re=Re.props.children),typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case Kw:e:{for(var ct=Re.key,nt=ge;nt!==null;){if(nt.key===ct){if(ct=Re.type,ct===Km){if(nt.tag===7){n(de,nt.sibling),ge=h(nt,Re.props.children),ge.return=de,de=ge;break e}}else if(nt.elementType===ct||typeof ct=="object"&&ct!==null&&ct.$$typeof===_d&&CO(ct)===nt.type){n(de,nt.sibling),ge=h(nt,Re.props),ge.ref=ov(de,nt,Re),ge.return=de,de=ge;break e}n(de,nt);break}else e(de,nt);nt=nt.sibling}Re.type===Km?(ge=np(Re.props.children,de.mode,_t,Re.key),ge.return=de,de=ge):(_t=z1(Re.type,Re.key,Re.props,null,de.mode,_t),_t.ref=ov(de,ge,Re),_t.return=de,de=_t)}return v(de);case Xm:e:{for(nt=Re.key;ge!==null;){if(ge.key===nt)if(ge.tag===4&&ge.stateNode.containerInfo===Re.containerInfo&&ge.stateNode.implementation===Re.implementation){n(de,ge.sibling),ge=h(ge,Re.children||[]),ge.return=de,de=ge;break e}else{n(de,ge);break}else e(de,ge);ge=ge.sibling}ge=vS(Re,de.mode,_t),ge.return=de,de=ge}return v(de);case _d:return nt=Re._init,Ue(de,ge,nt(Re._payload),_t)}if(yv(Re))return oe(de,ge,Re,_t);if(tv(Re))return me(de,ge,Re,_t);a1(de,Re)}return typeof Re=="string"&&Re!==""||typeof Re=="number"?(Re=""+Re,ge!==null&&ge.tag===6?(n(de,ge.sibling),ge=h(ge,Re),ge.return=de,de=ge):(n(de,ge),ge=yS(Re,de.mode,_t),ge.return=de,de=ge),v(de)):n(de,ge)}return Ue}var Cg=ZB(!0),XB=ZB(!1),hb=Jd(null),db=null,rg=null,D2=null;function L2(){D2=rg=db=null}function O2(t){var e=hb.current;ks(hb),t._currentValue=e}function UA(t,e,n){for(;t!==null;){var a=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,a!==null&&(a.childLanes|=e)):a!==null&&(a.childLanes&e)!==e&&(a.childLanes|=e),t===n)break;t=t.return}}function pg(t,e){db=t,D2=rg=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(il=!0),t.firstContext=null)}function nc(t){var e=t._currentValue;if(D2!==t)if(t={context:t,memoizedValue:e,next:null},rg===null){if(db===null)throw Error(wn(308));rg=t,db.dependencies={lanes:0,firstContext:t}}else rg=rg.next=t;return e}var Xf=null;function z2(t){Xf===null?Xf=[t]:Xf.push(t)}function KB(t,e,n,a){var h=e.interleaved;return h===null?(n.next=n,z2(e)):(n.next=h.next,h.next=n),e.interleaved=n,ph(t,a)}function ph(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var yd=!1;function F2(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function YB(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ah(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function kd(t,e,n){var a=t.updateQueue;if(a===null)return null;if(a=a.shared,Vr&2){var h=a.pending;return h===null?e.next=e:(e.next=h.next,h.next=e),a.pending=e,ph(t,n)}return h=a.interleaved,h===null?(e.next=e,z2(a)):(e.next=h.next,h.next=e),a.interleaved=e,ph(t,n)}function R1(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var a=e.lanes;a&=t.pendingLanes,n|=a,e.lanes=n,b2(t,n)}}function PO(t,e){var n=t.updateQueue,a=t.alternate;if(a!==null&&(a=a.updateQueue,n===a)){var h=null,m=null;if(n=n.firstBaseUpdate,n!==null){do{var v={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};m===null?h=m=v:m=m.next=v,n=n.next}while(n!==null);m===null?h=m=e:m=m.next=e}else h=m=e;n={baseState:a.baseState,firstBaseUpdate:h,lastBaseUpdate:m,shared:a.shared,effects:a.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function fb(t,e,n,a){var h=t.updateQueue;yd=!1;var m=h.firstBaseUpdate,v=h.lastBaseUpdate,o=h.shared.pending;if(o!==null){h.shared.pending=null;var S=o,P=S.next;S.next=null,v===null?m=P:v.next=P,v=S;var N=t.alternate;N!==null&&(N=N.updateQueue,o=N.lastBaseUpdate,o!==v&&(o===null?N.firstBaseUpdate=P:o.next=P,N.lastBaseUpdate=S))}if(m!==null){var V=h.baseState;v=0,N=P=S=null,o=m;do{var j=o.lane,Q=o.eventTime;if((a&j)===j){N!==null&&(N=N.next={eventTime:Q,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var oe=t,me=o;switch(j=e,Q=n,me.tag){case 1:if(oe=me.payload,typeof oe=="function"){V=oe.call(Q,V,j);break e}V=oe;break e;case 3:oe.flags=oe.flags&-65537|128;case 0:if(oe=me.payload,j=typeof oe=="function"?oe.call(Q,V,j):oe,j==null)break e;V=Gs({},V,j);break e;case 2:yd=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,j=h.effects,j===null?h.effects=[o]:j.push(o))}else Q={eventTime:Q,lane:j,tag:o.tag,payload:o.payload,callback:o.callback,next:null},N===null?(P=N=Q,S=V):N=N.next=Q,v|=j;if(o=o.next,o===null){if(o=h.shared.pending,o===null)break;j=o,o=j.next,j.next=null,h.lastBaseUpdate=j,h.shared.pending=null}}while(!0);if(N===null&&(S=V),h.baseState=S,h.firstBaseUpdate=P,h.lastBaseUpdate=N,e=h.shared.interleaved,e!==null){h=e;do v|=h.lane,h=h.next;while(h!==e)}else m===null&&(h.shared.lanes=0);lp|=v,t.lanes=v,t.memoizedState=V}}function RO(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var a=t[e],h=a.callback;if(h!==null){if(a.callback=null,a=n,typeof h!="function")throw Error(wn(191,h));h.call(a)}}}var Ox={},vu=Jd(Ox),ax=Jd(Ox),lx=Jd(Ox);function Kf(t){if(t===Ox)throw Error(wn(174));return t}function N2(t,e){switch(xs(lx,e),xs(ax,t),xs(vu,Ox),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:wA(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=wA(e,t)}ks(vu),xs(vu,e)}function Pg(){ks(vu),ks(ax),ks(lx)}function QB(t){Kf(lx.current);var e=Kf(vu.current),n=wA(e,t.type);e!==n&&(xs(ax,t),xs(vu,n))}function B2(t){ax.current===t&&(ks(vu),ks(ax))}var Us=Jd(0);function pb(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var dS=[];function V2(){for(var t=0;t<dS.length;t++)dS[t]._workInProgressVersionPrimary=null;dS.length=0}var k1=bh.ReactCurrentDispatcher,fS=bh.ReactCurrentBatchConfig,ap=0,js=null,Io=null,Go=null,mb=!1,Mv=!1,cx=0,Lq=0;function ua(){throw Error(wn(321))}function U2(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!kc(t[n],e[n]))return!1;return!0}function j2(t,e,n,a,h,m){if(ap=m,js=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,k1.current=t===null||t.memoizedState===null?Nq:Bq,t=n(a,h),Mv){m=0;do{if(Mv=!1,cx=0,25<=m)throw Error(wn(301));m+=1,Go=Io=null,e.updateQueue=null,k1.current=Vq,t=n(a,h)}while(Mv)}if(k1.current=gb,e=Io!==null&&Io.next!==null,ap=0,Go=Io=js=null,mb=!1,e)throw Error(wn(300));return t}function G2(){var t=cx!==0;return cx=0,t}function du(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Go===null?js.memoizedState=Go=t:Go=Go.next=t,Go}function ic(){if(Io===null){var t=js.alternate;t=t!==null?t.memoizedState:null}else t=Io.next;var e=Go===null?js.memoizedState:Go.next;if(e!==null)Go=e,Io=t;else{if(t===null)throw Error(wn(310));Io=t,t={memoizedState:Io.memoizedState,baseState:Io.baseState,baseQueue:Io.baseQueue,queue:Io.queue,next:null},Go===null?js.memoizedState=Go=t:Go=Go.next=t}return Go}function ux(t,e){return typeof e=="function"?e(t):e}function pS(t){var e=ic(),n=e.queue;if(n===null)throw Error(wn(311));n.lastRenderedReducer=t;var a=Io,h=a.baseQueue,m=n.pending;if(m!==null){if(h!==null){var v=h.next;h.next=m.next,m.next=v}a.baseQueue=h=m,n.pending=null}if(h!==null){m=h.next,a=a.baseState;var o=v=null,S=null,P=m;do{var N=P.lane;if((ap&N)===N)S!==null&&(S=S.next={lane:0,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null}),a=P.hasEagerState?P.eagerState:t(a,P.action);else{var V={lane:N,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null};S===null?(o=S=V,v=a):S=S.next=V,js.lanes|=N,lp|=N}P=P.next}while(P!==null&&P!==m);S===null?v=a:S.next=o,kc(a,e.memoizedState)||(il=!0),e.memoizedState=a,e.baseState=v,e.baseQueue=S,n.lastRenderedState=a}if(t=n.interleaved,t!==null){h=t;do m=h.lane,js.lanes|=m,lp|=m,h=h.next;while(h!==t)}else h===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function mS(t){var e=ic(),n=e.queue;if(n===null)throw Error(wn(311));n.lastRenderedReducer=t;var a=n.dispatch,h=n.pending,m=e.memoizedState;if(h!==null){n.pending=null;var v=h=h.next;do m=t(m,v.action),v=v.next;while(v!==h);kc(m,e.memoizedState)||(il=!0),e.memoizedState=m,e.baseQueue===null&&(e.baseState=m),n.lastRenderedState=m}return[m,a]}function JB(){}function e4(t,e){var n=js,a=ic(),h=e(),m=!kc(a.memoizedState,h);if(m&&(a.memoizedState=h,il=!0),a=a.queue,$2(i4.bind(null,n,a,t),[t]),a.getSnapshot!==e||m||Go!==null&&Go.memoizedState.tag&1){if(n.flags|=2048,hx(9,n4.bind(null,n,a,h,e),void 0,null),qo===null)throw Error(wn(349));ap&30||t4(n,e,h)}return h}function t4(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=js.updateQueue,e===null?(e={lastEffect:null,stores:null},js.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function n4(t,e,n,a){e.value=n,e.getSnapshot=a,r4(e)&&s4(t)}function i4(t,e,n){return n(function(){r4(e)&&s4(t)})}function r4(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!kc(t,n)}catch{return!0}}function s4(t){var e=ph(t,1);e!==null&&Ac(e,t,1,-1)}function kO(t){var e=du();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ux,lastRenderedState:t},e.queue=t,t=t.dispatch=Fq.bind(null,js,t),[e.memoizedState,t]}function hx(t,e,n,a){return t={tag:t,create:e,destroy:n,deps:a,next:null},e=js.updateQueue,e===null?(e={lastEffect:null,stores:null},js.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(a=n.next,n.next=t,t.next=a,e.lastEffect=t)),t}function o4(){return ic().memoizedState}function M1(t,e,n,a){var h=du();js.flags|=t,h.memoizedState=hx(1|e,n,void 0,a===void 0?null:a)}function cT(t,e,n,a){var h=ic();a=a===void 0?null:a;var m=void 0;if(Io!==null){var v=Io.memoizedState;if(m=v.destroy,a!==null&&U2(a,v.deps)){h.memoizedState=hx(e,n,m,a);return}}js.flags|=t,h.memoizedState=hx(1|e,n,m,a)}function MO(t,e){return M1(8390656,8,t,e)}function $2(t,e){return cT(2048,8,t,e)}function a4(t,e){return cT(4,2,t,e)}function l4(t,e){return cT(4,4,t,e)}function c4(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function u4(t,e,n){return n=n!=null?n.concat([t]):null,cT(4,4,c4.bind(null,e,t),n)}function H2(){}function h4(t,e){var n=ic();e=e===void 0?null:e;var a=n.memoizedState;return a!==null&&e!==null&&U2(e,a[1])?a[0]:(n.memoizedState=[t,e],t)}function d4(t,e){var n=ic();e=e===void 0?null:e;var a=n.memoizedState;return a!==null&&e!==null&&U2(e,a[1])?a[0]:(t=t(),n.memoizedState=[t,e],t)}function f4(t,e,n){return ap&21?(kc(n,e)||(n=yB(),js.lanes|=n,lp|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,il=!0),t.memoizedState=n)}function Oq(t,e){var n=is;is=n!==0&&4>n?n:4,t(!0);var a=fS.transition;fS.transition={};try{t(!1),e()}finally{is=n,fS.transition=a}}function p4(){return ic().memoizedState}function zq(t,e,n){var a=Dd(t);if(n={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null},m4(t))g4(e,n);else if(n=KB(t,e,n,a),n!==null){var h=Va();Ac(n,t,a,h),_4(n,e,a)}}function Fq(t,e,n){var a=Dd(t),h={lane:a,action:n,hasEagerState:!1,eagerState:null,next:null};if(m4(t))g4(e,h);else{var m=t.alternate;if(t.lanes===0&&(m===null||m.lanes===0)&&(m=e.lastRenderedReducer,m!==null))try{var v=e.lastRenderedState,o=m(v,n);if(h.hasEagerState=!0,h.eagerState=o,kc(o,v)){var S=e.interleaved;S===null?(h.next=h,z2(e)):(h.next=S.next,S.next=h),e.interleaved=h;return}}catch{}finally{}n=KB(t,e,h,a),n!==null&&(h=Va(),Ac(n,t,a,h),_4(n,e,a))}}function m4(t){var e=t.alternate;return t===js||e!==null&&e===js}function g4(t,e){Mv=mb=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function _4(t,e,n){if(n&4194240){var a=e.lanes;a&=t.pendingLanes,n|=a,e.lanes=n,b2(t,n)}}var gb={readContext:nc,useCallback:ua,useContext:ua,useEffect:ua,useImperativeHandle:ua,useInsertionEffect:ua,useLayoutEffect:ua,useMemo:ua,useReducer:ua,useRef:ua,useState:ua,useDebugValue:ua,useDeferredValue:ua,useTransition:ua,useMutableSource:ua,useSyncExternalStore:ua,useId:ua,unstable_isNewReconciler:!1},Nq={readContext:nc,useCallback:function(t,e){return du().memoizedState=[t,e===void 0?null:e],t},useContext:nc,useEffect:MO,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,M1(4194308,4,c4.bind(null,e,t),n)},useLayoutEffect:function(t,e){return M1(4194308,4,t,e)},useInsertionEffect:function(t,e){return M1(4,2,t,e)},useMemo:function(t,e){var n=du();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var a=du();return e=n!==void 0?n(e):e,a.memoizedState=a.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},a.queue=t,t=t.dispatch=zq.bind(null,js,t),[a.memoizedState,t]},useRef:function(t){var e=du();return t={current:t},e.memoizedState=t},useState:kO,useDebugValue:H2,useDeferredValue:function(t){return du().memoizedState=t},useTransition:function(){var t=kO(!1),e=t[0];return t=Oq.bind(null,t[1]),du().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var a=js,h=du();if(Ns){if(n===void 0)throw Error(wn(407));n=n()}else{if(n=e(),qo===null)throw Error(wn(349));ap&30||t4(a,e,n)}h.memoizedState=n;var m={value:n,getSnapshot:e};return h.queue=m,MO(i4.bind(null,a,m,t),[t]),a.flags|=2048,hx(9,n4.bind(null,a,m,n,e),void 0,null),n},useId:function(){var t=du(),e=qo.identifierPrefix;if(Ns){var n=ih,a=nh;n=(a&~(1<<32-Sc(a)-1)).toString(32)+n,e=":"+e+"R"+n,n=cx++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Lq++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Bq={readContext:nc,useCallback:h4,useContext:nc,useEffect:$2,useImperativeHandle:u4,useInsertionEffect:a4,useLayoutEffect:l4,useMemo:d4,useReducer:pS,useRef:o4,useState:function(){return pS(ux)},useDebugValue:H2,useDeferredValue:function(t){var e=ic();return f4(e,Io.memoizedState,t)},useTransition:function(){var t=pS(ux)[0],e=ic().memoizedState;return[t,e]},useMutableSource:JB,useSyncExternalStore:e4,useId:p4,unstable_isNewReconciler:!1},Vq={readContext:nc,useCallback:h4,useContext:nc,useEffect:$2,useImperativeHandle:u4,useInsertionEffect:a4,useLayoutEffect:l4,useMemo:d4,useReducer:mS,useRef:o4,useState:function(){return mS(ux)},useDebugValue:H2,useDeferredValue:function(t){var e=ic();return Io===null?e.memoizedState=t:f4(e,Io.memoizedState,t)},useTransition:function(){var t=mS(ux)[0],e=ic().memoizedState;return[t,e]},useMutableSource:JB,useSyncExternalStore:e4,useId:p4,unstable_isNewReconciler:!1};function xc(t,e){if(t&&t.defaultProps){e=Gs({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function jA(t,e,n,a){e=t.memoizedState,n=n(a,e),n=n==null?e:Gs({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var uT={isMounted:function(t){return(t=t._reactInternals)?xp(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var a=Va(),h=Dd(t),m=ah(a,h);m.payload=e,n!=null&&(m.callback=n),e=kd(t,m,h),e!==null&&(Ac(e,t,h,a),R1(e,t,h))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var a=Va(),h=Dd(t),m=ah(a,h);m.tag=1,m.payload=e,n!=null&&(m.callback=n),e=kd(t,m,h),e!==null&&(Ac(e,t,h,a),R1(e,t,h))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Va(),a=Dd(t),h=ah(n,a);h.tag=2,e!=null&&(h.callback=e),e=kd(t,h,a),e!==null&&(Ac(e,t,a,n),R1(e,t,a))}};function DO(t,e,n,a,h,m,v){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(a,m,v):e.prototype&&e.prototype.isPureReactComponent?!ix(n,a)||!ix(h,m):!0}function y4(t,e,n){var a=!1,h=$d,m=e.contextType;return typeof m=="object"&&m!==null?m=nc(m):(h=ol(e)?sp:wa.current,a=e.contextTypes,m=(a=a!=null)?Sg(t,h):$d),e=new e(n,m),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=uT,t.stateNode=e,e._reactInternals=t,a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=h,t.__reactInternalMemoizedMaskedChildContext=m),e}function LO(t,e,n,a){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,a),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,a),e.state!==t&&uT.enqueueReplaceState(e,e.state,null)}function GA(t,e,n,a){var h=t.stateNode;h.props=n,h.state=t.memoizedState,h.refs={},F2(t);var m=e.contextType;typeof m=="object"&&m!==null?h.context=nc(m):(m=ol(e)?sp:wa.current,h.context=Sg(t,m)),h.state=t.memoizedState,m=e.getDerivedStateFromProps,typeof m=="function"&&(jA(t,e,m,n),h.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(e=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),e!==h.state&&uT.enqueueReplaceState(h,h.state,null),fb(t,n,h,a),h.state=t.memoizedState),typeof h.componentDidMount=="function"&&(t.flags|=4194308)}function Rg(t,e){try{var n="",a=e;do n+=pH(a),a=a.return;while(a);var h=n}catch(m){h=`
Error generating stack: `+m.message+`
`+m.stack}return{value:t,source:e,stack:h,digest:null}}function gS(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function $A(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Uq=typeof WeakMap=="function"?WeakMap:Map;function v4(t,e,n){n=ah(-1,n),n.tag=3,n.payload={element:null};var a=e.value;return n.callback=function(){yb||(yb=!0,eC=a),$A(t,e)},n}function x4(t,e,n){n=ah(-1,n),n.tag=3;var a=t.type.getDerivedStateFromError;if(typeof a=="function"){var h=e.value;n.payload=function(){return a(h)},n.callback=function(){$A(t,e)}}var m=t.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(n.callback=function(){$A(t,e),typeof a!="function"&&(Md===null?Md=new Set([this]):Md.add(this));var v=e.stack;this.componentDidCatch(e.value,{componentStack:v!==null?v:""})}),n}function OO(t,e,n){var a=t.pingCache;if(a===null){a=t.pingCache=new Uq;var h=new Set;a.set(e,h)}else h=a.get(e),h===void 0&&(h=new Set,a.set(e,h));h.has(n)||(h.add(n),t=tW.bind(null,t,e,n),e.then(t,t))}function zO(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function FO(t,e,n,a,h){return t.mode&1?(t.flags|=65536,t.lanes=h,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ah(-1,1),e.tag=2,kd(n,e,1))),n.lanes|=1),t)}var jq=bh.ReactCurrentOwner,il=!1;function Ba(t,e,n,a){e.child=t===null?XB(e,null,n,a):Cg(e,t.child,n,a)}function NO(t,e,n,a,h){n=n.render;var m=e.ref;return pg(e,h),a=j2(t,e,n,a,m,h),n=G2(),t!==null&&!il?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~h,mh(t,e,h)):(Ns&&n&&R2(e),e.flags|=1,Ba(t,e,a,h),e.child)}function BO(t,e,n,a,h){if(t===null){var m=n.type;return typeof m=="function"&&!J2(m)&&m.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=m,w4(t,e,m,a,h)):(t=z1(n.type,null,a,e,e.mode,h),t.ref=e.ref,t.return=e,e.child=t)}if(m=t.child,!(t.lanes&h)){var v=m.memoizedProps;if(n=n.compare,n=n!==null?n:ix,n(v,a)&&t.ref===e.ref)return mh(t,e,h)}return e.flags|=1,t=Ld(m,a),t.ref=e.ref,t.return=e,e.child=t}function w4(t,e,n,a,h){if(t!==null){var m=t.memoizedProps;if(ix(m,a)&&t.ref===e.ref)if(il=!1,e.pendingProps=a=m,(t.lanes&h)!==0)t.flags&131072&&(il=!0);else return e.lanes=t.lanes,mh(t,e,h)}return HA(t,e,n,a,h)}function b4(t,e,n){var a=e.pendingProps,h=a.children,m=t!==null?t.memoizedState:null;if(a.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},xs(og,Tl),Tl|=n;else{if(!(n&1073741824))return t=m!==null?m.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,xs(og,Tl),Tl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=m!==null?m.baseLanes:n,xs(og,Tl),Tl|=a}else m!==null?(a=m.baseLanes|n,e.memoizedState=null):a=n,xs(og,Tl),Tl|=a;return Ba(t,e,h,n),e.child}function T4(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function HA(t,e,n,a,h){var m=ol(n)?sp:wa.current;return m=Sg(e,m),pg(e,h),n=j2(t,e,n,a,m,h),a=G2(),t!==null&&!il?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~h,mh(t,e,h)):(Ns&&a&&R2(e),e.flags|=1,Ba(t,e,n,h),e.child)}function VO(t,e,n,a,h){if(ol(n)){var m=!0;lb(e)}else m=!1;if(pg(e,h),e.stateNode===null)D1(t,e),y4(e,n,a),GA(e,n,a,h),a=!0;else if(t===null){var v=e.stateNode,o=e.memoizedProps;v.props=o;var S=v.context,P=n.contextType;typeof P=="object"&&P!==null?P=nc(P):(P=ol(n)?sp:wa.current,P=Sg(e,P));var N=n.getDerivedStateFromProps,V=typeof N=="function"||typeof v.getSnapshotBeforeUpdate=="function";V||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(o!==a||S!==P)&&LO(e,v,a,P),yd=!1;var j=e.memoizedState;v.state=j,fb(e,a,v,h),S=e.memoizedState,o!==a||j!==S||sl.current||yd?(typeof N=="function"&&(jA(e,n,N,a),S=e.memoizedState),(o=yd||DO(e,n,o,a,j,S,P))?(V||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(e.flags|=4194308)):(typeof v.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=a,e.memoizedState=S),v.props=a,v.state=S,v.context=P,a=o):(typeof v.componentDidMount=="function"&&(e.flags|=4194308),a=!1)}else{v=e.stateNode,YB(t,e),o=e.memoizedProps,P=e.type===e.elementType?o:xc(e.type,o),v.props=P,V=e.pendingProps,j=v.context,S=n.contextType,typeof S=="object"&&S!==null?S=nc(S):(S=ol(n)?sp:wa.current,S=Sg(e,S));var Q=n.getDerivedStateFromProps;(N=typeof Q=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(o!==V||j!==S)&&LO(e,v,a,S),yd=!1,j=e.memoizedState,v.state=j,fb(e,a,v,h);var oe=e.memoizedState;o!==V||j!==oe||sl.current||yd?(typeof Q=="function"&&(jA(e,n,Q,a),oe=e.memoizedState),(P=yd||DO(e,n,P,a,j,oe,S)||!1)?(N||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(a,oe,S),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(a,oe,S)),typeof v.componentDidUpdate=="function"&&(e.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof v.componentDidUpdate!="function"||o===t.memoizedProps&&j===t.memoizedState||(e.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&j===t.memoizedState||(e.flags|=1024),e.memoizedProps=a,e.memoizedState=oe),v.props=a,v.state=oe,v.context=S,a=P):(typeof v.componentDidUpdate!="function"||o===t.memoizedProps&&j===t.memoizedState||(e.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&j===t.memoizedState||(e.flags|=1024),a=!1)}return qA(t,e,n,a,m,h)}function qA(t,e,n,a,h,m){T4(t,e);var v=(e.flags&128)!==0;if(!a&&!v)return h&&IO(e,n,!1),mh(t,e,m);a=e.stateNode,jq.current=e;var o=v&&typeof n.getDerivedStateFromError!="function"?null:a.render();return e.flags|=1,t!==null&&v?(e.child=Cg(e,t.child,null,m),e.child=Cg(e,null,o,m)):Ba(t,e,o,m),e.memoizedState=a.state,h&&IO(e,n,!0),e.child}function E4(t){var e=t.stateNode;e.pendingContext?EO(t,e.pendingContext,e.pendingContext!==e.context):e.context&&EO(t,e.context,!1),N2(t,e.containerInfo)}function UO(t,e,n,a,h){return Ag(),M2(h),e.flags|=256,Ba(t,e,n,a),e.child}var WA={dehydrated:null,treeContext:null,retryLane:0};function ZA(t){return{baseLanes:t,cachePool:null,transitions:null}}function I4(t,e,n){var a=e.pendingProps,h=Us.current,m=!1,v=(e.flags&128)!==0,o;if((o=v)||(o=t!==null&&t.memoizedState===null?!1:(h&2)!==0),o?(m=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(h|=1),xs(Us,h&1),t===null)return VA(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(v=a.children,t=a.fallback,m?(a=e.mode,m=e.child,v={mode:"hidden",children:v},!(a&1)&&m!==null?(m.childLanes=0,m.pendingProps=v):m=fT(v,a,0,null),t=np(t,a,n,null),m.return=e,t.return=e,m.sibling=t,e.child=m,e.child.memoizedState=ZA(n),e.memoizedState=WA,t):q2(e,v));if(h=t.memoizedState,h!==null&&(o=h.dehydrated,o!==null))return Gq(t,e,v,a,o,h,n);if(m){m=a.fallback,v=e.mode,h=t.child,o=h.sibling;var S={mode:"hidden",children:a.children};return!(v&1)&&e.child!==h?(a=e.child,a.childLanes=0,a.pendingProps=S,e.deletions=null):(a=Ld(h,S),a.subtreeFlags=h.subtreeFlags&14680064),o!==null?m=Ld(o,m):(m=np(m,v,n,null),m.flags|=2),m.return=e,a.return=e,a.sibling=m,e.child=a,a=m,m=e.child,v=t.child.memoizedState,v=v===null?ZA(n):{baseLanes:v.baseLanes|n,cachePool:null,transitions:v.transitions},m.memoizedState=v,m.childLanes=t.childLanes&~n,e.memoizedState=WA,a}return m=t.child,t=m.sibling,a=Ld(m,{mode:"visible",children:a.children}),!(e.mode&1)&&(a.lanes=n),a.return=e,a.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=a,e.memoizedState=null,a}function q2(t,e){return e=fT({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function l1(t,e,n,a){return a!==null&&M2(a),Cg(e,t.child,null,n),t=q2(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Gq(t,e,n,a,h,m,v){if(n)return e.flags&256?(e.flags&=-257,a=gS(Error(wn(422))),l1(t,e,v,a)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(m=a.fallback,h=e.mode,a=fT({mode:"visible",children:a.children},h,0,null),m=np(m,h,v,null),m.flags|=2,a.return=e,m.return=e,a.sibling=m,e.child=a,e.mode&1&&Cg(e,t.child,null,v),e.child.memoizedState=ZA(v),e.memoizedState=WA,m);if(!(e.mode&1))return l1(t,e,v,null);if(h.data==="$!"){if(a=h.nextSibling&&h.nextSibling.dataset,a)var o=a.dgst;return a=o,m=Error(wn(419)),a=gS(m,a,void 0),l1(t,e,v,a)}if(o=(v&t.childLanes)!==0,il||o){if(a=qo,a!==null){switch(v&-v){case 4:h=2;break;case 16:h=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:h=32;break;case 536870912:h=268435456;break;default:h=0}h=h&(a.suspendedLanes|v)?0:h,h!==0&&h!==m.retryLane&&(m.retryLane=h,ph(t,h),Ac(a,t,h,-1))}return Q2(),a=gS(Error(wn(421))),l1(t,e,v,a)}return h.data==="$?"?(e.flags|=128,e.child=t.child,e=nW.bind(null,t),h._reactRetry=e,null):(t=m.treeContext,El=Rd(h.nextSibling),Al=e,Ns=!0,bc=null,t!==null&&(Xl[Kl++]=nh,Xl[Kl++]=ih,Xl[Kl++]=op,nh=t.id,ih=t.overflow,op=e),e=q2(e,a.children),e.flags|=4096,e)}function jO(t,e,n){t.lanes|=e;var a=t.alternate;a!==null&&(a.lanes|=e),UA(t.return,e,n)}function _S(t,e,n,a,h){var m=t.memoizedState;m===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:a,tail:n,tailMode:h}:(m.isBackwards=e,m.rendering=null,m.renderingStartTime=0,m.last=a,m.tail=n,m.tailMode=h)}function S4(t,e,n){var a=e.pendingProps,h=a.revealOrder,m=a.tail;if(Ba(t,e,a.children,n),a=Us.current,a&2)a=a&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&jO(t,n,e);else if(t.tag===19)jO(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}a&=1}if(xs(Us,a),!(e.mode&1))e.memoizedState=null;else switch(h){case"forwards":for(n=e.child,h=null;n!==null;)t=n.alternate,t!==null&&pb(t)===null&&(h=n),n=n.sibling;n=h,n===null?(h=e.child,e.child=null):(h=n.sibling,n.sibling=null),_S(e,!1,h,n,m);break;case"backwards":for(n=null,h=e.child,e.child=null;h!==null;){if(t=h.alternate,t!==null&&pb(t)===null){e.child=h;break}t=h.sibling,h.sibling=n,n=h,h=t}_S(e,!0,n,null,m);break;case"together":_S(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function D1(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function mh(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),lp|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(wn(153));if(e.child!==null){for(t=e.child,n=Ld(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ld(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $q(t,e,n){switch(e.tag){case 3:E4(e),Ag();break;case 5:QB(e);break;case 1:ol(e.type)&&lb(e);break;case 4:N2(e,e.stateNode.containerInfo);break;case 10:var a=e.type._context,h=e.memoizedProps.value;xs(hb,a._currentValue),a._currentValue=h;break;case 13:if(a=e.memoizedState,a!==null)return a.dehydrated!==null?(xs(Us,Us.current&1),e.flags|=128,null):n&e.child.childLanes?I4(t,e,n):(xs(Us,Us.current&1),t=mh(t,e,n),t!==null?t.sibling:null);xs(Us,Us.current&1);break;case 19:if(a=(n&e.childLanes)!==0,t.flags&128){if(a)return S4(t,e,n);e.flags|=128}if(h=e.memoizedState,h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),xs(Us,Us.current),a)break;return null;case 22:case 23:return e.lanes=0,b4(t,e,n)}return mh(t,e,n)}var A4,XA,C4,P4;A4=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};XA=function(){};C4=function(t,e,n,a){var h=t.memoizedProps;if(h!==a){t=e.stateNode,Kf(vu.current);var m=null;switch(n){case"input":h=_A(t,h),a=_A(t,a),m=[];break;case"select":h=Gs({},h,{value:void 0}),a=Gs({},a,{value:void 0}),m=[];break;case"textarea":h=xA(t,h),a=xA(t,a),m=[];break;default:typeof h.onClick!="function"&&typeof a.onClick=="function"&&(t.onclick=ob)}bA(n,a);var v;n=null;for(P in h)if(!a.hasOwnProperty(P)&&h.hasOwnProperty(P)&&h[P]!=null)if(P==="style"){var o=h[P];for(v in o)o.hasOwnProperty(v)&&(n||(n={}),n[v]="")}else P!=="dangerouslySetInnerHTML"&&P!=="children"&&P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(Kv.hasOwnProperty(P)?m||(m=[]):(m=m||[]).push(P,null));for(P in a){var S=a[P];if(o=h!=null?h[P]:void 0,a.hasOwnProperty(P)&&S!==o&&(S!=null||o!=null))if(P==="style")if(o){for(v in o)!o.hasOwnProperty(v)||S&&S.hasOwnProperty(v)||(n||(n={}),n[v]="");for(v in S)S.hasOwnProperty(v)&&o[v]!==S[v]&&(n||(n={}),n[v]=S[v])}else n||(m||(m=[]),m.push(P,n)),n=S;else P==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,o=o?o.__html:void 0,S!=null&&o!==S&&(m=m||[]).push(P,S)):P==="children"?typeof S!="string"&&typeof S!="number"||(m=m||[]).push(P,""+S):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&(Kv.hasOwnProperty(P)?(S!=null&&P==="onScroll"&&As("scroll",t),m||o===S||(m=[])):(m=m||[]).push(P,S))}n&&(m=m||[]).push("style",n);var P=m;(e.updateQueue=P)&&(e.flags|=4)}};P4=function(t,e,n,a){n!==a&&(e.flags|=4)};function av(t,e){if(!Ns)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:a.sibling=null}}function ha(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,a=0;if(e)for(var h=t.child;h!==null;)n|=h.lanes|h.childLanes,a|=h.subtreeFlags&14680064,a|=h.flags&14680064,h.return=t,h=h.sibling;else for(h=t.child;h!==null;)n|=h.lanes|h.childLanes,a|=h.subtreeFlags,a|=h.flags,h.return=t,h=h.sibling;return t.subtreeFlags|=a,t.childLanes=n,e}function Hq(t,e,n){var a=e.pendingProps;switch(k2(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ha(e),null;case 1:return ol(e.type)&&ab(),ha(e),null;case 3:return a=e.stateNode,Pg(),ks(sl),ks(wa),V2(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(o1(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,bc!==null&&(iC(bc),bc=null))),XA(t,e),ha(e),null;case 5:B2(e);var h=Kf(lx.current);if(n=e.type,t!==null&&e.stateNode!=null)C4(t,e,n,a,h),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!a){if(e.stateNode===null)throw Error(wn(166));return ha(e),null}if(t=Kf(vu.current),o1(e)){a=e.stateNode,n=e.type;var m=e.memoizedProps;switch(a[mu]=e,a[ox]=m,t=(e.mode&1)!==0,n){case"dialog":As("cancel",a),As("close",a);break;case"iframe":case"object":case"embed":As("load",a);break;case"video":case"audio":for(h=0;h<xv.length;h++)As(xv[h],a);break;case"source":As("error",a);break;case"img":case"image":case"link":As("error",a),As("load",a);break;case"details":As("toggle",a);break;case"input":YL(a,m),As("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!m.multiple},As("invalid",a);break;case"textarea":JL(a,m),As("invalid",a)}bA(n,m),h=null;for(var v in m)if(m.hasOwnProperty(v)){var o=m[v];v==="children"?typeof o=="string"?a.textContent!==o&&(m.suppressHydrationWarning!==!0&&s1(a.textContent,o,t),h=["children",o]):typeof o=="number"&&a.textContent!==""+o&&(m.suppressHydrationWarning!==!0&&s1(a.textContent,o,t),h=["children",""+o]):Kv.hasOwnProperty(v)&&o!=null&&v==="onScroll"&&As("scroll",a)}switch(n){case"input":Yw(a),QL(a,m,!0);break;case"textarea":Yw(a),eO(a);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(a.onclick=ob)}a=h,e.updateQueue=a,a!==null&&(e.flags|=4)}else{v=h.nodeType===9?h:h.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=iB(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=v.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof a.is=="string"?t=v.createElement(n,{is:a.is}):(t=v.createElement(n),n==="select"&&(v=t,a.multiple?v.multiple=!0:a.size&&(v.size=a.size))):t=v.createElementNS(t,n),t[mu]=e,t[ox]=a,A4(t,e,!1,!1),e.stateNode=t;e:{switch(v=TA(n,a),n){case"dialog":As("cancel",t),As("close",t),h=a;break;case"iframe":case"object":case"embed":As("load",t),h=a;break;case"video":case"audio":for(h=0;h<xv.length;h++)As(xv[h],t);h=a;break;case"source":As("error",t),h=a;break;case"img":case"image":case"link":As("error",t),As("load",t),h=a;break;case"details":As("toggle",t),h=a;break;case"input":YL(t,a),h=_A(t,a),As("invalid",t);break;case"option":h=a;break;case"select":t._wrapperState={wasMultiple:!!a.multiple},h=Gs({},a,{value:void 0}),As("invalid",t);break;case"textarea":JL(t,a),h=xA(t,a),As("invalid",t);break;default:h=a}bA(n,h),o=h;for(m in o)if(o.hasOwnProperty(m)){var S=o[m];m==="style"?oB(t,S):m==="dangerouslySetInnerHTML"?(S=S?S.__html:void 0,S!=null&&rB(t,S)):m==="children"?typeof S=="string"?(n!=="textarea"||S!=="")&&Yv(t,S):typeof S=="number"&&Yv(t,""+S):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(Kv.hasOwnProperty(m)?S!=null&&m==="onScroll"&&As("scroll",t):S!=null&&g2(t,m,S,v))}switch(n){case"input":Yw(t),QL(t,a,!1);break;case"textarea":Yw(t),eO(t);break;case"option":a.value!=null&&t.setAttribute("value",""+Gd(a.value));break;case"select":t.multiple=!!a.multiple,m=a.value,m!=null?ug(t,!!a.multiple,m,!1):a.defaultValue!=null&&ug(t,!!a.multiple,a.defaultValue,!0);break;default:typeof h.onClick=="function"&&(t.onclick=ob)}switch(n){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ha(e),null;case 6:if(t&&e.stateNode!=null)P4(t,e,t.memoizedProps,a);else{if(typeof a!="string"&&e.stateNode===null)throw Error(wn(166));if(n=Kf(lx.current),Kf(vu.current),o1(e)){if(a=e.stateNode,n=e.memoizedProps,a[mu]=e,(m=a.nodeValue!==n)&&(t=Al,t!==null))switch(t.tag){case 3:s1(a.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&s1(a.nodeValue,n,(t.mode&1)!==0)}m&&(e.flags|=4)}else a=(n.nodeType===9?n:n.ownerDocument).createTextNode(a),a[mu]=e,e.stateNode=a}return ha(e),null;case 13:if(ks(Us),a=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ns&&El!==null&&e.mode&1&&!(e.flags&128))WB(),Ag(),e.flags|=98560,m=!1;else if(m=o1(e),a!==null&&a.dehydrated!==null){if(t===null){if(!m)throw Error(wn(318));if(m=e.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(wn(317));m[mu]=e}else Ag(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ha(e),m=!1}else bc!==null&&(iC(bc),bc=null),m=!0;if(!m)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(a=a!==null,a!==(t!==null&&t.memoizedState!==null)&&a&&(e.child.flags|=8192,e.mode&1&&(t===null||Us.current&1?So===0&&(So=3):Q2())),e.updateQueue!==null&&(e.flags|=4),ha(e),null);case 4:return Pg(),XA(t,e),t===null&&rx(e.stateNode.containerInfo),ha(e),null;case 10:return O2(e.type._context),ha(e),null;case 17:return ol(e.type)&&ab(),ha(e),null;case 19:if(ks(Us),m=e.memoizedState,m===null)return ha(e),null;if(a=(e.flags&128)!==0,v=m.rendering,v===null)if(a)av(m,!1);else{if(So!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(v=pb(t),v!==null){for(e.flags|=128,av(m,!1),a=v.updateQueue,a!==null&&(e.updateQueue=a,e.flags|=4),e.subtreeFlags=0,a=n,n=e.child;n!==null;)m=n,t=a,m.flags&=14680066,v=m.alternate,v===null?(m.childLanes=0,m.lanes=t,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=v.childLanes,m.lanes=v.lanes,m.child=v.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=v.memoizedProps,m.memoizedState=v.memoizedState,m.updateQueue=v.updateQueue,m.type=v.type,t=v.dependencies,m.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return xs(Us,Us.current&1|2),e.child}t=t.sibling}m.tail!==null&&no()>kg&&(e.flags|=128,a=!0,av(m,!1),e.lanes=4194304)}else{if(!a)if(t=pb(v),t!==null){if(e.flags|=128,a=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),av(m,!0),m.tail===null&&m.tailMode==="hidden"&&!v.alternate&&!Ns)return ha(e),null}else 2*no()-m.renderingStartTime>kg&&n!==1073741824&&(e.flags|=128,a=!0,av(m,!1),e.lanes=4194304);m.isBackwards?(v.sibling=e.child,e.child=v):(n=m.last,n!==null?n.sibling=v:e.child=v,m.last=v)}return m.tail!==null?(e=m.tail,m.rendering=e,m.tail=e.sibling,m.renderingStartTime=no(),e.sibling=null,n=Us.current,xs(Us,a?n&1|2:n&1),e):(ha(e),null);case 22:case 23:return Y2(),a=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==a&&(e.flags|=8192),a&&e.mode&1?Tl&1073741824&&(ha(e),e.subtreeFlags&6&&(e.flags|=8192)):ha(e),null;case 24:return null;case 25:return null}throw Error(wn(156,e.tag))}function qq(t,e){switch(k2(e),e.tag){case 1:return ol(e.type)&&ab(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Pg(),ks(sl),ks(wa),V2(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return B2(e),null;case 13:if(ks(Us),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(wn(340));Ag()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ks(Us),null;case 4:return Pg(),null;case 10:return O2(e.type._context),null;case 22:case 23:return Y2(),null;case 24:return null;default:return null}}var c1=!1,pa=!1,Wq=typeof WeakSet=="function"?WeakSet:Set,Xn=null;function sg(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(a){Ys(t,e,a)}else n.current=null}function KA(t,e,n){try{n()}catch(a){Ys(t,e,a)}}var GO=!1;function Zq(t,e){if(DA=ib,t=LB(),P2(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var a=n.getSelection&&n.getSelection();if(a&&a.rangeCount!==0){n=a.anchorNode;var h=a.anchorOffset,m=a.focusNode;a=a.focusOffset;try{n.nodeType,m.nodeType}catch{n=null;break e}var v=0,o=-1,S=-1,P=0,N=0,V=t,j=null;t:for(;;){for(var Q;V!==n||h!==0&&V.nodeType!==3||(o=v+h),V!==m||a!==0&&V.nodeType!==3||(S=v+a),V.nodeType===3&&(v+=V.nodeValue.length),(Q=V.firstChild)!==null;)j=V,V=Q;for(;;){if(V===t)break t;if(j===n&&++P===h&&(o=v),j===m&&++N===a&&(S=v),(Q=V.nextSibling)!==null)break;V=j,j=V.parentNode}V=Q}n=o===-1||S===-1?null:{start:o,end:S}}else n=null}n=n||{start:0,end:0}}else n=null;for(LA={focusedElem:t,selectionRange:n},ib=!1,Xn=e;Xn!==null;)if(e=Xn,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Xn=t;else for(;Xn!==null;){e=Xn;try{var oe=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(oe!==null){var me=oe.memoizedProps,Ue=oe.memoizedState,de=e.stateNode,ge=de.getSnapshotBeforeUpdate(e.elementType===e.type?me:xc(e.type,me),Ue);de.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Re=e.stateNode.containerInfo;Re.nodeType===1?Re.textContent="":Re.nodeType===9&&Re.documentElement&&Re.removeChild(Re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(wn(163))}}catch(_t){Ys(e,e.return,_t)}if(t=e.sibling,t!==null){t.return=e.return,Xn=t;break}Xn=e.return}return oe=GO,GO=!1,oe}function Dv(t,e,n){var a=e.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&t)===t){var m=h.destroy;h.destroy=void 0,m!==void 0&&KA(e,n,m)}h=h.next}while(h!==a)}}function hT(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var a=n.create;n.destroy=a()}n=n.next}while(n!==e)}}function YA(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function R4(t){var e=t.alternate;e!==null&&(t.alternate=null,R4(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[mu],delete e[ox],delete e[FA],delete e[Rq],delete e[kq])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function k4(t){return t.tag===5||t.tag===3||t.tag===4}function $O(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||k4(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function QA(t,e,n){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=ob));else if(a!==4&&(t=t.child,t!==null))for(QA(t,e,n),t=t.sibling;t!==null;)QA(t,e,n),t=t.sibling}function JA(t,e,n){var a=t.tag;if(a===5||a===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(a!==4&&(t=t.child,t!==null))for(JA(t,e,n),t=t.sibling;t!==null;)JA(t,e,n),t=t.sibling}var Yo=null,wc=!1;function pd(t,e,n){for(n=n.child;n!==null;)M4(t,e,n),n=n.sibling}function M4(t,e,n){if(yu&&typeof yu.onCommitFiberUnmount=="function")try{yu.onCommitFiberUnmount(iT,n)}catch{}switch(n.tag){case 5:pa||sg(n,e);case 6:var a=Yo,h=wc;Yo=null,pd(t,e,n),Yo=a,wc=h,Yo!==null&&(wc?(t=Yo,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Yo.removeChild(n.stateNode));break;case 18:Yo!==null&&(wc?(t=Yo,n=n.stateNode,t.nodeType===8?uS(t.parentNode,n):t.nodeType===1&&uS(t,n),tx(t)):uS(Yo,n.stateNode));break;case 4:a=Yo,h=wc,Yo=n.stateNode.containerInfo,wc=!0,pd(t,e,n),Yo=a,wc=h;break;case 0:case 11:case 14:case 15:if(!pa&&(a=n.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){h=a=a.next;do{var m=h,v=m.destroy;m=m.tag,v!==void 0&&(m&2||m&4)&&KA(n,e,v),h=h.next}while(h!==a)}pd(t,e,n);break;case 1:if(!pa&&(sg(n,e),a=n.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=n.memoizedProps,a.state=n.memoizedState,a.componentWillUnmount()}catch(o){Ys(n,e,o)}pd(t,e,n);break;case 21:pd(t,e,n);break;case 22:n.mode&1?(pa=(a=pa)||n.memoizedState!==null,pd(t,e,n),pa=a):pd(t,e,n);break;default:pd(t,e,n)}}function HO(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Wq),e.forEach(function(a){var h=iW.bind(null,t,a);n.has(a)||(n.add(a),a.then(h,h))})}}function vc(t,e){var n=e.deletions;if(n!==null)for(var a=0;a<n.length;a++){var h=n[a];try{var m=t,v=e,o=v;e:for(;o!==null;){switch(o.tag){case 5:Yo=o.stateNode,wc=!1;break e;case 3:Yo=o.stateNode.containerInfo,wc=!0;break e;case 4:Yo=o.stateNode.containerInfo,wc=!0;break e}o=o.return}if(Yo===null)throw Error(wn(160));M4(m,v,h),Yo=null,wc=!1;var S=h.alternate;S!==null&&(S.return=null),h.return=null}catch(P){Ys(h,e,P)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)D4(e,t),e=e.sibling}function D4(t,e){var n=t.alternate,a=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(vc(e,t),hu(t),a&4){try{Dv(3,t,t.return),hT(3,t)}catch(me){Ys(t,t.return,me)}try{Dv(5,t,t.return)}catch(me){Ys(t,t.return,me)}}break;case 1:vc(e,t),hu(t),a&512&&n!==null&&sg(n,n.return);break;case 5:if(vc(e,t),hu(t),a&512&&n!==null&&sg(n,n.return),t.flags&32){var h=t.stateNode;try{Yv(h,"")}catch(me){Ys(t,t.return,me)}}if(a&4&&(h=t.stateNode,h!=null)){var m=t.memoizedProps,v=n!==null?n.memoizedProps:m,o=t.type,S=t.updateQueue;if(t.updateQueue=null,S!==null)try{o==="input"&&m.type==="radio"&&m.name!=null&&tB(h,m),TA(o,v);var P=TA(o,m);for(v=0;v<S.length;v+=2){var N=S[v],V=S[v+1];N==="style"?oB(h,V):N==="dangerouslySetInnerHTML"?rB(h,V):N==="children"?Yv(h,V):g2(h,N,V,P)}switch(o){case"input":yA(h,m);break;case"textarea":nB(h,m);break;case"select":var j=h._wrapperState.wasMultiple;h._wrapperState.wasMultiple=!!m.multiple;var Q=m.value;Q!=null?ug(h,!!m.multiple,Q,!1):j!==!!m.multiple&&(m.defaultValue!=null?ug(h,!!m.multiple,m.defaultValue,!0):ug(h,!!m.multiple,m.multiple?[]:"",!1))}h[ox]=m}catch(me){Ys(t,t.return,me)}}break;case 6:if(vc(e,t),hu(t),a&4){if(t.stateNode===null)throw Error(wn(162));h=t.stateNode,m=t.memoizedProps;try{h.nodeValue=m}catch(me){Ys(t,t.return,me)}}break;case 3:if(vc(e,t),hu(t),a&4&&n!==null&&n.memoizedState.isDehydrated)try{tx(e.containerInfo)}catch(me){Ys(t,t.return,me)}break;case 4:vc(e,t),hu(t);break;case 13:vc(e,t),hu(t),h=t.child,h.flags&8192&&(m=h.memoizedState!==null,h.stateNode.isHidden=m,!m||h.alternate!==null&&h.alternate.memoizedState!==null||(X2=no())),a&4&&HO(t);break;case 22:if(N=n!==null&&n.memoizedState!==null,t.mode&1?(pa=(P=pa)||N,vc(e,t),pa=P):vc(e,t),hu(t),a&8192){if(P=t.memoizedState!==null,(t.stateNode.isHidden=P)&&!N&&t.mode&1)for(Xn=t,N=t.child;N!==null;){for(V=Xn=N;Xn!==null;){switch(j=Xn,Q=j.child,j.tag){case 0:case 11:case 14:case 15:Dv(4,j,j.return);break;case 1:sg(j,j.return);var oe=j.stateNode;if(typeof oe.componentWillUnmount=="function"){a=j,n=j.return;try{e=a,oe.props=e.memoizedProps,oe.state=e.memoizedState,oe.componentWillUnmount()}catch(me){Ys(a,n,me)}}break;case 5:sg(j,j.return);break;case 22:if(j.memoizedState!==null){WO(V);continue}}Q!==null?(Q.return=j,Xn=Q):WO(V)}N=N.sibling}e:for(N=null,V=t;;){if(V.tag===5){if(N===null){N=V;try{h=V.stateNode,P?(m=h.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(o=V.stateNode,S=V.memoizedProps.style,v=S!=null&&S.hasOwnProperty("display")?S.display:null,o.style.display=sB("display",v))}catch(me){Ys(t,t.return,me)}}}else if(V.tag===6){if(N===null)try{V.stateNode.nodeValue=P?"":V.memoizedProps}catch(me){Ys(t,t.return,me)}}else if((V.tag!==22&&V.tag!==23||V.memoizedState===null||V===t)&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===t)break e;for(;V.sibling===null;){if(V.return===null||V.return===t)break e;N===V&&(N=null),V=V.return}N===V&&(N=null),V.sibling.return=V.return,V=V.sibling}}break;case 19:vc(e,t),hu(t),a&4&&HO(t);break;case 21:break;default:vc(e,t),hu(t)}}function hu(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(k4(n)){var a=n;break e}n=n.return}throw Error(wn(160))}switch(a.tag){case 5:var h=a.stateNode;a.flags&32&&(Yv(h,""),a.flags&=-33);var m=$O(t);JA(t,m,h);break;case 3:case 4:var v=a.stateNode.containerInfo,o=$O(t);QA(t,o,v);break;default:throw Error(wn(161))}}catch(S){Ys(t,t.return,S)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Xq(t,e,n){Xn=t,L4(t)}function L4(t,e,n){for(var a=(t.mode&1)!==0;Xn!==null;){var h=Xn,m=h.child;if(h.tag===22&&a){var v=h.memoizedState!==null||c1;if(!v){var o=h.alternate,S=o!==null&&o.memoizedState!==null||pa;o=c1;var P=pa;if(c1=v,(pa=S)&&!P)for(Xn=h;Xn!==null;)v=Xn,S=v.child,v.tag===22&&v.memoizedState!==null?ZO(h):S!==null?(S.return=v,Xn=S):ZO(h);for(;m!==null;)Xn=m,L4(m),m=m.sibling;Xn=h,c1=o,pa=P}qO(t)}else h.subtreeFlags&8772&&m!==null?(m.return=h,Xn=m):qO(t)}}function qO(t){for(;Xn!==null;){var e=Xn;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pa||hT(5,e);break;case 1:var a=e.stateNode;if(e.flags&4&&!pa)if(n===null)a.componentDidMount();else{var h=e.elementType===e.type?n.memoizedProps:xc(e.type,n.memoizedProps);a.componentDidUpdate(h,n.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var m=e.updateQueue;m!==null&&RO(e,m,a);break;case 3:var v=e.updateQueue;if(v!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}RO(e,v,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var S=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":S.autoFocus&&n.focus();break;case"img":S.src&&(n.src=S.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var P=e.alternate;if(P!==null){var N=P.memoizedState;if(N!==null){var V=N.dehydrated;V!==null&&tx(V)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(wn(163))}pa||e.flags&512&&YA(e)}catch(j){Ys(e,e.return,j)}}if(e===t){Xn=null;break}if(n=e.sibling,n!==null){n.return=e.return,Xn=n;break}Xn=e.return}}function WO(t){for(;Xn!==null;){var e=Xn;if(e===t){Xn=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Xn=n;break}Xn=e.return}}function ZO(t){for(;Xn!==null;){var e=Xn;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{hT(4,e)}catch(S){Ys(e,n,S)}break;case 1:var a=e.stateNode;if(typeof a.componentDidMount=="function"){var h=e.return;try{a.componentDidMount()}catch(S){Ys(e,h,S)}}var m=e.return;try{YA(e)}catch(S){Ys(e,m,S)}break;case 5:var v=e.return;try{YA(e)}catch(S){Ys(e,v,S)}}}catch(S){Ys(e,e.return,S)}if(e===t){Xn=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Xn=o;break}Xn=e.return}}var Kq=Math.ceil,_b=bh.ReactCurrentDispatcher,W2=bh.ReactCurrentOwner,tc=bh.ReactCurrentBatchConfig,Vr=0,qo=null,po=null,ea=0,Tl=0,og=Jd(0),So=0,dx=null,lp=0,dT=0,Z2=0,Lv=null,el=null,X2=0,kg=1/0,Yu=null,yb=!1,eC=null,Md=null,u1=!1,Id=null,vb=0,Ov=0,tC=null,L1=-1,O1=0;function Va(){return Vr&6?no():L1!==-1?L1:L1=no()}function Dd(t){return t.mode&1?Vr&2&&ea!==0?ea&-ea:Dq.transition!==null?(O1===0&&(O1=yB()),O1):(t=is,t!==0||(t=window.event,t=t===void 0?16:IB(t.type)),t):1}function Ac(t,e,n,a){if(50<Ov)throw Ov=0,tC=null,Error(wn(185));Mx(t,n,a),(!(Vr&2)||t!==qo)&&(t===qo&&(!(Vr&2)&&(dT|=n),So===4&&xd(t,ea)),al(t,a),n===1&&Vr===0&&!(e.mode&1)&&(kg=no()+500,lT&&ef()))}function al(t,e){var n=t.callbackNode;DH(t,e);var a=nb(t,t===qo?ea:0);if(a===0)n!==null&&iO(n),t.callbackNode=null,t.callbackPriority=0;else if(e=a&-a,t.callbackPriority!==e){if(n!=null&&iO(n),e===1)t.tag===0?Mq(XO.bind(null,t)):$B(XO.bind(null,t)),Cq(function(){!(Vr&6)&&ef()}),n=null;else{switch(vB(a)){case 1:n=w2;break;case 4:n=gB;break;case 16:n=tb;break;case 536870912:n=_B;break;default:n=tb}n=j4(n,O4.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function O4(t,e){if(L1=-1,O1=0,Vr&6)throw Error(wn(327));var n=t.callbackNode;if(mg()&&t.callbackNode!==n)return null;var a=nb(t,t===qo?ea:0);if(a===0)return null;if(a&30||a&t.expiredLanes||e)e=xb(t,a);else{e=a;var h=Vr;Vr|=2;var m=F4();(qo!==t||ea!==e)&&(Yu=null,kg=no()+500,tp(t,e));do try{Jq();break}catch(o){z4(t,o)}while(!0);L2(),_b.current=m,Vr=h,po!==null?e=0:(qo=null,ea=0,e=So)}if(e!==0){if(e===2&&(h=CA(t),h!==0&&(a=h,e=nC(t,h))),e===1)throw n=dx,tp(t,0),xd(t,a),al(t,no()),n;if(e===6)xd(t,a);else{if(h=t.current.alternate,!(a&30)&&!Yq(h)&&(e=xb(t,a),e===2&&(m=CA(t),m!==0&&(a=m,e=nC(t,m))),e===1))throw n=dx,tp(t,0),xd(t,a),al(t,no()),n;switch(t.finishedWork=h,t.finishedLanes=a,e){case 0:case 1:throw Error(wn(345));case 2:$f(t,el,Yu);break;case 3:if(xd(t,a),(a&130023424)===a&&(e=X2+500-no(),10<e)){if(nb(t,0)!==0)break;if(h=t.suspendedLanes,(h&a)!==a){Va(),t.pingedLanes|=t.suspendedLanes&h;break}t.timeoutHandle=zA($f.bind(null,t,el,Yu),e);break}$f(t,el,Yu);break;case 4:if(xd(t,a),(a&4194240)===a)break;for(e=t.eventTimes,h=-1;0<a;){var v=31-Sc(a);m=1<<v,v=e[v],v>h&&(h=v),a&=~m}if(a=h,a=no()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*Kq(a/1960))-a,10<a){t.timeoutHandle=zA($f.bind(null,t,el,Yu),a);break}$f(t,el,Yu);break;case 5:$f(t,el,Yu);break;default:throw Error(wn(329))}}}return al(t,no()),t.callbackNode===n?O4.bind(null,t):null}function nC(t,e){var n=Lv;return t.current.memoizedState.isDehydrated&&(tp(t,e).flags|=256),t=xb(t,e),t!==2&&(e=el,el=n,e!==null&&iC(e)),t}function iC(t){el===null?el=t:el.push.apply(el,t)}function Yq(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var a=0;a<n.length;a++){var h=n[a],m=h.getSnapshot;h=h.value;try{if(!kc(m(),h))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function xd(t,e){for(e&=~Z2,e&=~dT,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Sc(e),a=1<<n;t[n]=-1,e&=~a}}function XO(t){if(Vr&6)throw Error(wn(327));mg();var e=nb(t,0);if(!(e&1))return al(t,no()),null;var n=xb(t,e);if(t.tag!==0&&n===2){var a=CA(t);a!==0&&(e=a,n=nC(t,a))}if(n===1)throw n=dx,tp(t,0),xd(t,e),al(t,no()),n;if(n===6)throw Error(wn(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,$f(t,el,Yu),al(t,no()),null}function K2(t,e){var n=Vr;Vr|=1;try{return t(e)}finally{Vr=n,Vr===0&&(kg=no()+500,lT&&ef())}}function cp(t){Id!==null&&Id.tag===0&&!(Vr&6)&&mg();var e=Vr;Vr|=1;var n=tc.transition,a=is;try{if(tc.transition=null,is=1,t)return t()}finally{is=a,tc.transition=n,Vr=e,!(Vr&6)&&ef()}}function Y2(){Tl=og.current,ks(og)}function tp(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Aq(n)),po!==null)for(n=po.return;n!==null;){var a=n;switch(k2(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&ab();break;case 3:Pg(),ks(sl),ks(wa),V2();break;case 5:B2(a);break;case 4:Pg();break;case 13:ks(Us);break;case 19:ks(Us);break;case 10:O2(a.type._context);break;case 22:case 23:Y2()}n=n.return}if(qo=t,po=t=Ld(t.current,null),ea=Tl=e,So=0,dx=null,Z2=dT=lp=0,el=Lv=null,Xf!==null){for(e=0;e<Xf.length;e++)if(n=Xf[e],a=n.interleaved,a!==null){n.interleaved=null;var h=a.next,m=n.pending;if(m!==null){var v=m.next;m.next=h,a.next=v}n.pending=a}Xf=null}return t}function z4(t,e){do{var n=po;try{if(L2(),k1.current=gb,mb){for(var a=js.memoizedState;a!==null;){var h=a.queue;h!==null&&(h.pending=null),a=a.next}mb=!1}if(ap=0,Go=Io=js=null,Mv=!1,cx=0,W2.current=null,n===null||n.return===null){So=1,dx=e,po=null;break}e:{var m=t,v=n.return,o=n,S=e;if(e=ea,o.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){var P=S,N=o,V=N.tag;if(!(N.mode&1)&&(V===0||V===11||V===15)){var j=N.alternate;j?(N.updateQueue=j.updateQueue,N.memoizedState=j.memoizedState,N.lanes=j.lanes):(N.updateQueue=null,N.memoizedState=null)}var Q=zO(v);if(Q!==null){Q.flags&=-257,FO(Q,v,o,m,e),Q.mode&1&&OO(m,P,e),e=Q,S=P;var oe=e.updateQueue;if(oe===null){var me=new Set;me.add(S),e.updateQueue=me}else oe.add(S);break e}else{if(!(e&1)){OO(m,P,e),Q2();break e}S=Error(wn(426))}}else if(Ns&&o.mode&1){var Ue=zO(v);if(Ue!==null){!(Ue.flags&65536)&&(Ue.flags|=256),FO(Ue,v,o,m,e),M2(Rg(S,o));break e}}m=S=Rg(S,o),So!==4&&(So=2),Lv===null?Lv=[m]:Lv.push(m),m=v;do{switch(m.tag){case 3:m.flags|=65536,e&=-e,m.lanes|=e;var de=v4(m,S,e);PO(m,de);break e;case 1:o=S;var ge=m.type,Re=m.stateNode;if(!(m.flags&128)&&(typeof ge.getDerivedStateFromError=="function"||Re!==null&&typeof Re.componentDidCatch=="function"&&(Md===null||!Md.has(Re)))){m.flags|=65536,e&=-e,m.lanes|=e;var _t=x4(m,o,e);PO(m,_t);break e}}m=m.return}while(m!==null)}B4(n)}catch(ct){e=ct,po===n&&n!==null&&(po=n=n.return);continue}break}while(!0)}function F4(){var t=_b.current;return _b.current=gb,t===null?gb:t}function Q2(){(So===0||So===3||So===2)&&(So=4),qo===null||!(lp&268435455)&&!(dT&268435455)||xd(qo,ea)}function xb(t,e){var n=Vr;Vr|=2;var a=F4();(qo!==t||ea!==e)&&(Yu=null,tp(t,e));do try{Qq();break}catch(h){z4(t,h)}while(!0);if(L2(),Vr=n,_b.current=a,po!==null)throw Error(wn(261));return qo=null,ea=0,So}function Qq(){for(;po!==null;)N4(po)}function Jq(){for(;po!==null&&!EH();)N4(po)}function N4(t){var e=U4(t.alternate,t,Tl);t.memoizedProps=t.pendingProps,e===null?B4(t):po=e,W2.current=null}function B4(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=qq(n,e),n!==null){n.flags&=32767,po=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{So=6,po=null;return}}else if(n=Hq(n,e,Tl),n!==null){po=n;return}if(e=e.sibling,e!==null){po=e;return}po=e=t}while(e!==null);So===0&&(So=5)}function $f(t,e,n){var a=is,h=tc.transition;try{tc.transition=null,is=1,eW(t,e,n,a)}finally{tc.transition=h,is=a}return null}function eW(t,e,n,a){do mg();while(Id!==null);if(Vr&6)throw Error(wn(327));n=t.finishedWork;var h=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(wn(177));t.callbackNode=null,t.callbackPriority=0;var m=n.lanes|n.childLanes;if(LH(t,m),t===qo&&(po=qo=null,ea=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||u1||(u1=!0,j4(tb,function(){return mg(),null})),m=(n.flags&15990)!==0,n.subtreeFlags&15990||m){m=tc.transition,tc.transition=null;var v=is;is=1;var o=Vr;Vr|=4,W2.current=null,Zq(t,n),D4(n,t),xq(LA),ib=!!DA,LA=DA=null,t.current=n,Xq(n),IH(),Vr=o,is=v,tc.transition=m}else t.current=n;if(u1&&(u1=!1,Id=t,vb=h),m=t.pendingLanes,m===0&&(Md=null),CH(n.stateNode),al(t,no()),e!==null)for(a=t.onRecoverableError,n=0;n<e.length;n++)h=e[n],a(h.value,{componentStack:h.stack,digest:h.digest});if(yb)throw yb=!1,t=eC,eC=null,t;return vb&1&&t.tag!==0&&mg(),m=t.pendingLanes,m&1?t===tC?Ov++:(Ov=0,tC=t):Ov=0,ef(),null}function mg(){if(Id!==null){var t=vB(vb),e=tc.transition,n=is;try{if(tc.transition=null,is=16>t?16:t,Id===null)var a=!1;else{if(t=Id,Id=null,vb=0,Vr&6)throw Error(wn(331));var h=Vr;for(Vr|=4,Xn=t.current;Xn!==null;){var m=Xn,v=m.child;if(Xn.flags&16){var o=m.deletions;if(o!==null){for(var S=0;S<o.length;S++){var P=o[S];for(Xn=P;Xn!==null;){var N=Xn;switch(N.tag){case 0:case 11:case 15:Dv(8,N,m)}var V=N.child;if(V!==null)V.return=N,Xn=V;else for(;Xn!==null;){N=Xn;var j=N.sibling,Q=N.return;if(R4(N),N===P){Xn=null;break}if(j!==null){j.return=Q,Xn=j;break}Xn=Q}}}var oe=m.alternate;if(oe!==null){var me=oe.child;if(me!==null){oe.child=null;do{var Ue=me.sibling;me.sibling=null,me=Ue}while(me!==null)}}Xn=m}}if(m.subtreeFlags&2064&&v!==null)v.return=m,Xn=v;else e:for(;Xn!==null;){if(m=Xn,m.flags&2048)switch(m.tag){case 0:case 11:case 15:Dv(9,m,m.return)}var de=m.sibling;if(de!==null){de.return=m.return,Xn=de;break e}Xn=m.return}}var ge=t.current;for(Xn=ge;Xn!==null;){v=Xn;var Re=v.child;if(v.subtreeFlags&2064&&Re!==null)Re.return=v,Xn=Re;else e:for(v=ge;Xn!==null;){if(o=Xn,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:hT(9,o)}}catch(ct){Ys(o,o.return,ct)}if(o===v){Xn=null;break e}var _t=o.sibling;if(_t!==null){_t.return=o.return,Xn=_t;break e}Xn=o.return}}if(Vr=h,ef(),yu&&typeof yu.onPostCommitFiberRoot=="function")try{yu.onPostCommitFiberRoot(iT,t)}catch{}a=!0}return a}finally{is=n,tc.transition=e}}return!1}function KO(t,e,n){e=Rg(n,e),e=v4(t,e,1),t=kd(t,e,1),e=Va(),t!==null&&(Mx(t,1,e),al(t,e))}function Ys(t,e,n){if(t.tag===3)KO(t,t,n);else for(;e!==null;){if(e.tag===3){KO(e,t,n);break}else if(e.tag===1){var a=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(Md===null||!Md.has(a))){t=Rg(n,t),t=x4(e,t,1),e=kd(e,t,1),t=Va(),e!==null&&(Mx(e,1,t),al(e,t));break}}e=e.return}}function tW(t,e,n){var a=t.pingCache;a!==null&&a.delete(e),e=Va(),t.pingedLanes|=t.suspendedLanes&n,qo===t&&(ea&n)===n&&(So===4||So===3&&(ea&130023424)===ea&&500>no()-X2?tp(t,0):Z2|=n),al(t,e)}function V4(t,e){e===0&&(t.mode&1?(e=e1,e1<<=1,!(e1&130023424)&&(e1=4194304)):e=1);var n=Va();t=ph(t,e),t!==null&&(Mx(t,e,n),al(t,n))}function nW(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),V4(t,n)}function iW(t,e){var n=0;switch(t.tag){case 13:var a=t.stateNode,h=t.memoizedState;h!==null&&(n=h.retryLane);break;case 19:a=t.stateNode;break;default:throw Error(wn(314))}a!==null&&a.delete(e),V4(t,n)}var U4;U4=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||sl.current)il=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return il=!1,$q(t,e,n);il=!!(t.flags&131072)}else il=!1,Ns&&e.flags&1048576&&HB(e,ub,e.index);switch(e.lanes=0,e.tag){case 2:var a=e.type;D1(t,e),t=e.pendingProps;var h=Sg(e,wa.current);pg(e,n),h=j2(null,e,a,t,h,n);var m=G2();return e.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ol(a)?(m=!0,lb(e)):m=!1,e.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,F2(e),h.updater=uT,e.stateNode=h,h._reactInternals=e,GA(e,a,t,n),e=qA(null,e,a,!0,m,n)):(e.tag=0,Ns&&m&&R2(e),Ba(null,e,h,n),e=e.child),e;case 16:a=e.elementType;e:{switch(D1(t,e),t=e.pendingProps,h=a._init,a=h(a._payload),e.type=a,h=e.tag=sW(a),t=xc(a,t),h){case 0:e=HA(null,e,a,t,n);break e;case 1:e=VO(null,e,a,t,n);break e;case 11:e=NO(null,e,a,t,n);break e;case 14:e=BO(null,e,a,xc(a.type,t),n);break e}throw Error(wn(306,a,""))}return e;case 0:return a=e.type,h=e.pendingProps,h=e.elementType===a?h:xc(a,h),HA(t,e,a,h,n);case 1:return a=e.type,h=e.pendingProps,h=e.elementType===a?h:xc(a,h),VO(t,e,a,h,n);case 3:e:{if(E4(e),t===null)throw Error(wn(387));a=e.pendingProps,m=e.memoizedState,h=m.element,YB(t,e),fb(e,a,null,n);var v=e.memoizedState;if(a=v.element,m.isDehydrated)if(m={element:a,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},e.updateQueue.baseState=m,e.memoizedState=m,e.flags&256){h=Rg(Error(wn(423)),e),e=UO(t,e,a,n,h);break e}else if(a!==h){h=Rg(Error(wn(424)),e),e=UO(t,e,a,n,h);break e}else for(El=Rd(e.stateNode.containerInfo.firstChild),Al=e,Ns=!0,bc=null,n=XB(e,null,a,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ag(),a===h){e=mh(t,e,n);break e}Ba(t,e,a,n)}e=e.child}return e;case 5:return QB(e),t===null&&VA(e),a=e.type,h=e.pendingProps,m=t!==null?t.memoizedProps:null,v=h.children,OA(a,h)?v=null:m!==null&&OA(a,m)&&(e.flags|=32),T4(t,e),Ba(t,e,v,n),e.child;case 6:return t===null&&VA(e),null;case 13:return I4(t,e,n);case 4:return N2(e,e.stateNode.containerInfo),a=e.pendingProps,t===null?e.child=Cg(e,null,a,n):Ba(t,e,a,n),e.child;case 11:return a=e.type,h=e.pendingProps,h=e.elementType===a?h:xc(a,h),NO(t,e,a,h,n);case 7:return Ba(t,e,e.pendingProps,n),e.child;case 8:return Ba(t,e,e.pendingProps.children,n),e.child;case 12:return Ba(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(a=e.type._context,h=e.pendingProps,m=e.memoizedProps,v=h.value,xs(hb,a._currentValue),a._currentValue=v,m!==null)if(kc(m.value,v)){if(m.children===h.children&&!sl.current){e=mh(t,e,n);break e}}else for(m=e.child,m!==null&&(m.return=e);m!==null;){var o=m.dependencies;if(o!==null){v=m.child;for(var S=o.firstContext;S!==null;){if(S.context===a){if(m.tag===1){S=ah(-1,n&-n),S.tag=2;var P=m.updateQueue;if(P!==null){P=P.shared;var N=P.pending;N===null?S.next=S:(S.next=N.next,N.next=S),P.pending=S}}m.lanes|=n,S=m.alternate,S!==null&&(S.lanes|=n),UA(m.return,n,e),o.lanes|=n;break}S=S.next}}else if(m.tag===10)v=m.type===e.type?null:m.child;else if(m.tag===18){if(v=m.return,v===null)throw Error(wn(341));v.lanes|=n,o=v.alternate,o!==null&&(o.lanes|=n),UA(v,n,e),v=m.sibling}else v=m.child;if(v!==null)v.return=m;else for(v=m;v!==null;){if(v===e){v=null;break}if(m=v.sibling,m!==null){m.return=v.return,v=m;break}v=v.return}m=v}Ba(t,e,h.children,n),e=e.child}return e;case 9:return h=e.type,a=e.pendingProps.children,pg(e,n),h=nc(h),a=a(h),e.flags|=1,Ba(t,e,a,n),e.child;case 14:return a=e.type,h=xc(a,e.pendingProps),h=xc(a.type,h),BO(t,e,a,h,n);case 15:return w4(t,e,e.type,e.pendingProps,n);case 17:return a=e.type,h=e.pendingProps,h=e.elementType===a?h:xc(a,h),D1(t,e),e.tag=1,ol(a)?(t=!0,lb(e)):t=!1,pg(e,n),y4(e,a,h),GA(e,a,h,n),qA(null,e,a,!0,t,n);case 19:return S4(t,e,n);case 22:return b4(t,e,n)}throw Error(wn(156,e.tag))};function j4(t,e){return mB(t,e)}function rW(t,e,n,a){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jl(t,e,n,a){return new rW(t,e,n,a)}function J2(t){return t=t.prototype,!(!t||!t.isReactComponent)}function sW(t){if(typeof t=="function")return J2(t)?1:0;if(t!=null){if(t=t.$$typeof,t===y2)return 11;if(t===v2)return 14}return 2}function Ld(t,e){var n=t.alternate;return n===null?(n=Jl(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function z1(t,e,n,a,h,m){var v=2;if(a=t,typeof t=="function")J2(t)&&(v=1);else if(typeof t=="string")v=5;else e:switch(t){case Km:return np(n.children,h,m,e);case _2:v=8,h|=8;break;case fA:return t=Jl(12,n,e,h|2),t.elementType=fA,t.lanes=m,t;case pA:return t=Jl(13,n,e,h),t.elementType=pA,t.lanes=m,t;case mA:return t=Jl(19,n,e,h),t.elementType=mA,t.lanes=m,t;case Q3:return fT(n,h,m,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case K3:v=10;break e;case Y3:v=9;break e;case y2:v=11;break e;case v2:v=14;break e;case _d:v=16,a=null;break e}throw Error(wn(130,t==null?t:typeof t,""))}return e=Jl(v,n,e,h),e.elementType=t,e.type=a,e.lanes=m,e}function np(t,e,n,a){return t=Jl(7,t,a,e),t.lanes=n,t}function fT(t,e,n,a){return t=Jl(22,t,a,e),t.elementType=Q3,t.lanes=n,t.stateNode={isHidden:!1},t}function yS(t,e,n){return t=Jl(6,t,null,e),t.lanes=n,t}function vS(t,e,n){return e=Jl(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function oW(t,e,n,a,h){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=JI(0),this.expirationTimes=JI(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=JI(0),this.identifierPrefix=a,this.onRecoverableError=h,this.mutableSourceEagerHydrationData=null}function eP(t,e,n,a,h,m,v,o,S){return t=new oW(t,e,n,o,S),e===1?(e=1,m===!0&&(e|=8)):e=0,m=Jl(3,null,null,e),t.current=m,m.stateNode=t,m.memoizedState={element:a,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},F2(m),t}function aW(t,e,n){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xm,key:a==null?null:""+a,children:t,containerInfo:e,implementation:n}}function G4(t){if(!t)return $d;t=t._reactInternals;e:{if(xp(t)!==t||t.tag!==1)throw Error(wn(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ol(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(wn(171))}if(t.tag===1){var n=t.type;if(ol(n))return GB(t,n,e)}return e}function $4(t,e,n,a,h,m,v,o,S){return t=eP(n,a,!0,t,h,m,v,o,S),t.context=G4(null),n=t.current,a=Va(),h=Dd(n),m=ah(a,h),m.callback=e??null,kd(n,m,h),t.current.lanes=h,Mx(t,h,a),al(t,a),t}function pT(t,e,n,a){var h=e.current,m=Va(),v=Dd(h);return n=G4(n),e.context===null?e.context=n:e.pendingContext=n,e=ah(m,v),e.payload={element:t},a=a===void 0?null:a,a!==null&&(e.callback=a),t=kd(h,e,v),t!==null&&(Ac(t,h,v,m),R1(t,h,v)),v}function wb(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function YO(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function tP(t,e){YO(t,e),(t=t.alternate)&&YO(t,e)}function lW(){return null}var H4=typeof reportError=="function"?reportError:function(t){console.error(t)};function nP(t){this._internalRoot=t}mT.prototype.render=nP.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(wn(409));pT(t,e,null,null)};mT.prototype.unmount=nP.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;cp(function(){pT(null,t,null,null)}),e[fh]=null}};function mT(t){this._internalRoot=t}mT.prototype.unstable_scheduleHydration=function(t){if(t){var e=bB();t={blockedOn:null,target:t,priority:e};for(var n=0;n<vd.length&&e!==0&&e<vd[n].priority;n++);vd.splice(n,0,t),n===0&&EB(t)}};function iP(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function gT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function QO(){}function cW(t,e,n,a,h){if(h){if(typeof a=="function"){var m=a;a=function(){var P=wb(v);m.call(P)}}var v=$4(e,a,t,0,null,!1,!1,"",QO);return t._reactRootContainer=v,t[fh]=v.current,rx(t.nodeType===8?t.parentNode:t),cp(),v}for(;h=t.lastChild;)t.removeChild(h);if(typeof a=="function"){var o=a;a=function(){var P=wb(S);o.call(P)}}var S=eP(t,0,!1,null,null,!1,!1,"",QO);return t._reactRootContainer=S,t[fh]=S.current,rx(t.nodeType===8?t.parentNode:t),cp(function(){pT(e,S,n,a)}),S}function _T(t,e,n,a,h){var m=n._reactRootContainer;if(m){var v=m;if(typeof h=="function"){var o=h;h=function(){var S=wb(v);o.call(S)}}pT(e,v,t,h)}else v=cW(n,e,t,h,a);return wb(v)}xB=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=vv(e.pendingLanes);n!==0&&(b2(e,n|1),al(e,no()),!(Vr&6)&&(kg=no()+500,ef()))}break;case 13:cp(function(){var a=ph(t,1);if(a!==null){var h=Va();Ac(a,t,1,h)}}),tP(t,1)}};T2=function(t){if(t.tag===13){var e=ph(t,134217728);if(e!==null){var n=Va();Ac(e,t,134217728,n)}tP(t,134217728)}};wB=function(t){if(t.tag===13){var e=Dd(t),n=ph(t,e);if(n!==null){var a=Va();Ac(n,t,e,a)}tP(t,e)}};bB=function(){return is};TB=function(t,e){var n=is;try{return is=t,e()}finally{is=n}};IA=function(t,e,n){switch(e){case"input":if(yA(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var a=n[e];if(a!==t&&a.form===t.form){var h=aT(a);if(!h)throw Error(wn(90));eB(a),yA(a,h)}}}break;case"textarea":nB(t,n);break;case"select":e=n.value,e!=null&&ug(t,!!n.multiple,e,!1)}};cB=K2;uB=cp;var uW={usingClientEntryPoint:!1,Events:[Lx,eg,aT,aB,lB,K2]},lv={findFiberByHostInstance:Zf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hW={bundleType:lv.bundleType,version:lv.version,rendererPackageName:lv.rendererPackageName,rendererConfig:lv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:bh.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=fB(t),t===null?null:t.stateNode},findFiberByHostInstance:lv.findFiberByHostInstance||lW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var h1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!h1.isDisabled&&h1.supportsFiber)try{iT=h1.inject(hW),yu=h1}catch{}}Ml.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uW;Ml.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iP(e))throw Error(wn(200));return aW(t,e,null,n)};Ml.createRoot=function(t,e){if(!iP(t))throw Error(wn(299));var n=!1,a="",h=H4;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(a=e.identifierPrefix),e.onRecoverableError!==void 0&&(h=e.onRecoverableError)),e=eP(t,1,!1,null,null,n,!1,a,h),t[fh]=e.current,rx(t.nodeType===8?t.parentNode:t),new nP(e)};Ml.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(wn(188)):(t=Object.keys(t).join(","),Error(wn(268,t)));return t=fB(e),t=t===null?null:t.stateNode,t};Ml.flushSync=function(t){return cp(t)};Ml.hydrate=function(t,e,n){if(!gT(e))throw Error(wn(200));return _T(null,t,e,!0,n)};Ml.hydrateRoot=function(t,e,n){if(!iP(t))throw Error(wn(405));var a=n!=null&&n.hydratedSources||null,h=!1,m="",v=H4;if(n!=null&&(n.unstable_strictMode===!0&&(h=!0),n.identifierPrefix!==void 0&&(m=n.identifierPrefix),n.onRecoverableError!==void 0&&(v=n.onRecoverableError)),e=$4(e,null,t,1,n??null,h,!1,m,v),t[fh]=e.current,rx(t),a)for(t=0;t<a.length;t++)n=a[t],h=n._getVersion,h=h(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,h]:e.mutableSourceEagerHydrationData.push(n,h);return new mT(e)};Ml.render=function(t,e,n){if(!gT(e))throw Error(wn(200));return _T(null,t,e,!1,n)};Ml.unmountComponentAtNode=function(t){if(!gT(t))throw Error(wn(40));return t._reactRootContainer?(cp(function(){_T(null,null,t,!1,function(){t._reactRootContainer=null,t[fh]=null})}),!0):!1};Ml.unstable_batchedUpdates=K2;Ml.unstable_renderSubtreeIntoContainer=function(t,e,n,a){if(!gT(n))throw Error(wn(200));if(t==null||t._reactInternals===void 0)throw Error(wn(38));return _T(t,e,n,!1,a)};Ml.version="18.3.1-next-f1338f8080-20240426";function q4(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(q4)}catch(t){console.error(t)}}q4(),q3.exports=Ml;var dW=q3.exports,W4,JO=dW;W4=JO.createRoot,JO.hydrateRoot;/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var ez="popstate";function fW(t={}){function e(h,m){let{pathname:v="/",search:o="",hash:S=""}=Wg(h.location.hash.substring(1));return!v.startsWith("/")&&!v.startsWith(".")&&(v="/"+v),rC("",{pathname:v,search:o,hash:S},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function n(h,m){let v=h.document.querySelector("base"),o="";if(v&&v.getAttribute("href")){let S=h.location.href,P=S.indexOf("#");o=P===-1?S:S.slice(0,P)}return o+"#"+(typeof m=="string"?m:fx(m))}function a(h,m){Mc(h.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(m)})`)}return mW(e,n,a,t)}function Ao(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Mc(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function pW(){return Math.random().toString(36).substring(2,10)}function tz(t,e){return{usr:t.state,key:t.key,idx:e}}function rC(t,e,n=null,a){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Wg(e):e,state:n,key:e&&e.key||a||pW()}}function fx({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Wg(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let a=t.indexOf("?");a>=0&&(e.search=t.substring(a),t=t.substring(0,a)),t&&(e.pathname=t)}return e}function mW(t,e,n,a={}){let{window:h=document.defaultView,v5Compat:m=!1}=a,v=h.history,o="POP",S=null,P=N();P==null&&(P=0,v.replaceState({...v.state,idx:P},""));function N(){return(v.state||{idx:null}).idx}function V(){o="POP";let Ue=N(),de=Ue==null?null:Ue-P;P=Ue,S&&S({action:o,location:me.location,delta:de})}function j(Ue,de){o="PUSH";let ge=rC(me.location,Ue,de);n&&n(ge,Ue),P=N()+1;let Re=tz(ge,P),_t=me.createHref(ge);try{v.pushState(Re,"",_t)}catch(ct){if(ct instanceof DOMException&&ct.name==="DataCloneError")throw ct;h.location.assign(_t)}m&&S&&S({action:o,location:me.location,delta:1})}function Q(Ue,de){o="REPLACE";let ge=rC(me.location,Ue,de);n&&n(ge,Ue),P=N();let Re=tz(ge,P),_t=me.createHref(ge);v.replaceState(Re,"",_t),m&&S&&S({action:o,location:me.location,delta:0})}function oe(Ue){return gW(Ue)}let me={get action(){return o},get location(){return t(h,v)},listen(Ue){if(S)throw new Error("A history only accepts one active listener");return h.addEventListener(ez,V),S=Ue,()=>{h.removeEventListener(ez,V),S=null}},createHref(Ue){return e(h,Ue)},createURL:oe,encodeLocation(Ue){let de=oe(Ue);return{pathname:de.pathname,search:de.search,hash:de.hash}},push:j,replace:Q,go(Ue){return v.go(Ue)}};return me}function gW(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Ao(n,"No window.location.(origin|href) available to create URL");let a=typeof t=="string"?t:fx(t);return a=a.replace(/ $/,"%20"),!e&&a.startsWith("//")&&(a=n+a),new URL(a,n)}function Z4(t,e,n="/"){return _W(t,e,n,!1)}function _W(t,e,n,a){let h=typeof e=="string"?Wg(e):e,m=gh(h.pathname||"/",n);if(m==null)return null;let v=X4(t);yW(v);let o=null;for(let S=0;o==null&&S<v.length;++S){let P=PW(m);o=AW(v[S],P,a)}return o}function X4(t,e=[],n=[],a="",h=!1){let m=(v,o,S=h,P)=>{let N={relativePath:P===void 0?v.path||"":P,caseSensitive:v.caseSensitive===!0,childrenIndex:o,route:v};if(N.relativePath.startsWith("/")){if(!N.relativePath.startsWith(a)&&S)return;Ao(N.relativePath.startsWith(a),`Absolute route path "${N.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),N.relativePath=N.relativePath.slice(a.length)}let V=lh([a,N.relativePath]),j=n.concat(N);v.children&&v.children.length>0&&(Ao(v.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${V}".`),X4(v.children,e,j,V,S)),!(v.path==null&&!v.index)&&e.push({path:V,score:IW(V,v.index),routesMeta:j})};return t.forEach((v,o)=>{var S;if(v.path===""||!((S=v.path)!=null&&S.includes("?")))m(v,o);else for(let P of K4(v.path))m(v,o,!0,P)}),e}function K4(t){let e=t.split("/");if(e.length===0)return[];let[n,...a]=e,h=n.endsWith("?"),m=n.replace(/\?$/,"");if(a.length===0)return h?[m,""]:[m];let v=K4(a.join("/")),o=[];return o.push(...v.map(S=>S===""?m:[m,S].join("/"))),h&&o.push(...v),o.map(S=>t.startsWith("/")&&S===""?"/":S)}function yW(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:SW(e.routesMeta.map(a=>a.childrenIndex),n.routesMeta.map(a=>a.childrenIndex)))}var vW=/^:[\w-]+$/,xW=3,wW=2,bW=1,TW=10,EW=-2,nz=t=>t==="*";function IW(t,e){let n=t.split("/"),a=n.length;return n.some(nz)&&(a+=EW),e&&(a+=wW),n.filter(h=>!nz(h)).reduce((h,m)=>h+(vW.test(m)?xW:m===""?bW:TW),a)}function SW(t,e){return t.length===e.length&&t.slice(0,-1).every((a,h)=>a===e[h])?t[t.length-1]-e[e.length-1]:0}function AW(t,e,n=!1){let{routesMeta:a}=t,h={},m="/",v=[];for(let o=0;o<a.length;++o){let S=a[o],P=o===a.length-1,N=m==="/"?e:e.slice(m.length)||"/",V=bb({path:S.relativePath,caseSensitive:S.caseSensitive,end:P},N),j=S.route;if(!V&&P&&n&&!a[a.length-1].route.index&&(V=bb({path:S.relativePath,caseSensitive:S.caseSensitive,end:!1},N)),!V)return null;Object.assign(h,V.params),v.push({params:h,pathname:lh([m,V.pathname]),pathnameBase:DW(lh([m,V.pathnameBase])),route:j}),V.pathnameBase!=="/"&&(m=lh([m,V.pathnameBase]))}return v}function bb(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,a]=CW(t.path,t.caseSensitive,t.end),h=e.match(n);if(!h)return null;let m=h[0],v=m.replace(/(.)\/+$/,"$1"),o=h.slice(1);return{params:a.reduce((P,{paramName:N,isOptional:V},j)=>{if(N==="*"){let oe=o[j]||"";v=m.slice(0,m.length-oe.length).replace(/(.)\/+$/,"$1")}const Q=o[j];return V&&!Q?P[N]=void 0:P[N]=(Q||"").replace(/%2F/g,"/"),P},{}),pathname:m,pathnameBase:v,pattern:t}}function CW(t,e=!1,n=!0){Mc(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let a=[],h="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(v,o,S)=>(a.push({paramName:o,isOptional:S!=null}),S?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(a.push({paramName:"*"}),h+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?h+="\\/*$":t!==""&&t!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,e?void 0:"i"),a]}function PW(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Mc(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function gh(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,a=t.charAt(n);return a&&a!=="/"?null:t.slice(n)||"/"}function RW(t,e="/"){let{pathname:n,search:a="",hash:h=""}=typeof t=="string"?Wg(t):t;return{pathname:n?n.startsWith("/")?n:kW(n,e):e,search:LW(a),hash:OW(h)}}function kW(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(h=>{h===".."?n.length>1&&n.pop():h!=="."&&n.push(h)}),n.length>1?n.join("/"):"/"}function xS(t,e,n,a){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function MW(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Y4(t){let e=MW(t);return e.map((n,a)=>a===e.length-1?n.pathname:n.pathnameBase)}function Q4(t,e,n,a=!1){let h;typeof t=="string"?h=Wg(t):(h={...t},Ao(!h.pathname||!h.pathname.includes("?"),xS("?","pathname","search",h)),Ao(!h.pathname||!h.pathname.includes("#"),xS("#","pathname","hash",h)),Ao(!h.search||!h.search.includes("#"),xS("#","search","hash",h)));let m=t===""||h.pathname==="",v=m?"/":h.pathname,o;if(v==null)o=n;else{let V=e.length-1;if(!a&&v.startsWith("..")){let j=v.split("/");for(;j[0]==="..";)j.shift(),V-=1;h.pathname=j.join("/")}o=V>=0?e[V]:"/"}let S=RW(h,o),P=v&&v!=="/"&&v.endsWith("/"),N=(m||v===".")&&n.endsWith("/");return!S.pathname.endsWith("/")&&(P||N)&&(S.pathname+="/"),S}var lh=t=>t.join("/").replace(/\/\/+/g,"/"),DW=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),LW=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,OW=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function zW(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var J4=["POST","PUT","PATCH","DELETE"];new Set(J4);var FW=["GET",...J4];new Set(FW);var Zg=yt.createContext(null);Zg.displayName="DataRouter";var yT=yt.createContext(null);yT.displayName="DataRouterState";yt.createContext(!1);var eV=yt.createContext({isTransitioning:!1});eV.displayName="ViewTransition";var NW=yt.createContext(new Map);NW.displayName="Fetchers";var BW=yt.createContext(null);BW.displayName="Await";var Au=yt.createContext(null);Au.displayName="Navigation";var vT=yt.createContext(null);vT.displayName="Location";var Th=yt.createContext({outlet:null,matches:[],isDataRoute:!1});Th.displayName="Route";var rP=yt.createContext(null);rP.displayName="RouteError";function VW(t,{relative:e}={}){Ao(zx(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:a}=yt.useContext(Au),{hash:h,pathname:m,search:v}=Fx(t,{relative:e}),o=m;return n!=="/"&&(o=m==="/"?n:lh([n,m])),a.createHref({pathname:o,search:v,hash:h})}function zx(){return yt.useContext(vT)!=null}function wp(){return Ao(zx(),"useLocation() may be used only in the context of a <Router> component."),yt.useContext(vT).location}var tV="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function nV(t){yt.useContext(Au).static||yt.useLayoutEffect(t)}function UW(){let{isDataRoute:t}=yt.useContext(Th);return t?e7():jW()}function jW(){Ao(zx(),"useNavigate() may be used only in the context of a <Router> component.");let t=yt.useContext(Zg),{basename:e,navigator:n}=yt.useContext(Au),{matches:a}=yt.useContext(Th),{pathname:h}=wp(),m=JSON.stringify(Y4(a)),v=yt.useRef(!1);return nV(()=>{v.current=!0}),yt.useCallback((S,P={})=>{if(Mc(v.current,tV),!v.current)return;if(typeof S=="number"){n.go(S);return}let N=Q4(S,JSON.parse(m),h,P.relative==="path");t==null&&e!=="/"&&(N.pathname=N.pathname==="/"?e:lh([e,N.pathname])),(P.replace?n.replace:n.push)(N,P.state,P)},[e,n,m,h,t])}yt.createContext(null);function Fx(t,{relative:e}={}){let{matches:n}=yt.useContext(Th),{pathname:a}=wp(),h=JSON.stringify(Y4(n));return yt.useMemo(()=>Q4(t,JSON.parse(h),a,e==="path"),[t,h,a,e])}function GW(t,e,n,a,h){Ao(zx(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:m}=yt.useContext(Au),{matches:v}=yt.useContext(Th),o=v[v.length-1],S=o?o.params:{},P=o?o.pathname:"/",N=o?o.pathnameBase:"/",V=o&&o.route;{let ge=V&&V.path||"";iV(P,!V||ge.endsWith("*")||ge.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${P}" (under <Route path="${ge}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ge}"> to <Route path="${ge==="/"?"*":`${ge}/*`}">.`)}let j=wp(),Q;Q=j;let oe=Q.pathname||"/",me=oe;if(N!=="/"){let ge=N.replace(/^\//,"").split("/");me="/"+oe.replace(/^\//,"").split("/").slice(ge.length).join("/")}let Ue=Z4(t,{pathname:me});return Mc(V||Ue!=null,`No routes matched location "${Q.pathname}${Q.search}${Q.hash}" `),Mc(Ue==null||Ue[Ue.length-1].route.element!==void 0||Ue[Ue.length-1].route.Component!==void 0||Ue[Ue.length-1].route.lazy!==void 0,`Matched leaf route at location "${Q.pathname}${Q.search}${Q.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),ZW(Ue&&Ue.map(ge=>Object.assign({},ge,{params:Object.assign({},S,ge.params),pathname:lh([N,m.encodeLocation?m.encodeLocation(ge.pathname).pathname:ge.pathname]),pathnameBase:ge.pathnameBase==="/"?N:lh([N,m.encodeLocation?m.encodeLocation(ge.pathnameBase).pathname:ge.pathnameBase])})),v,n,a,h)}function $W(){let t=JW(),e=zW(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,a="rgba(200,200,200, 0.5)",h={padding:"0.5rem",backgroundColor:a},m={padding:"2px 4px",backgroundColor:a},v=null;return console.error("Error handled by React Router default ErrorBoundary:",t),v=yt.createElement(yt.Fragment,null,yt.createElement("p",null," Hey developer "),yt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",yt.createElement("code",{style:m},"ErrorBoundary")," or"," ",yt.createElement("code",{style:m},"errorElement")," prop on your route.")),yt.createElement(yt.Fragment,null,yt.createElement("h2",null,"Unexpected Application Error!"),yt.createElement("h3",{style:{fontStyle:"italic"}},e),n?yt.createElement("pre",{style:h},n):null,v)}var HW=yt.createElement($W,null),qW=class extends yt.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.unstable_onError?this.props.unstable_onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?yt.createElement(Th.Provider,{value:this.props.routeContext},yt.createElement(rP.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function WW({routeContext:t,match:e,children:n}){let a=yt.useContext(Zg);return a&&a.static&&a.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=e.route.id),yt.createElement(Th.Provider,{value:t},n)}function ZW(t,e=[],n=null,a=null,h=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let m=t,v=n==null?void 0:n.errors;if(v!=null){let P=m.findIndex(N=>N.route.id&&(v==null?void 0:v[N.route.id])!==void 0);Ao(P>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(v).join(",")}`),m=m.slice(0,Math.min(m.length,P+1))}let o=!1,S=-1;if(n)for(let P=0;P<m.length;P++){let N=m[P];if((N.route.HydrateFallback||N.route.hydrateFallbackElement)&&(S=P),N.route.id){let{loaderData:V,errors:j}=n,Q=N.route.loader&&!V.hasOwnProperty(N.route.id)&&(!j||j[N.route.id]===void 0);if(N.route.lazy||Q){o=!0,S>=0?m=m.slice(0,S+1):m=[m[0]];break}}}return m.reduceRight((P,N,V)=>{let j,Q=!1,oe=null,me=null;n&&(j=v&&N.route.id?v[N.route.id]:void 0,oe=N.route.errorElement||HW,o&&(S<0&&V===0?(iV("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Q=!0,me=null):S===V&&(Q=!0,me=N.route.hydrateFallbackElement||null)));let Ue=e.concat(m.slice(0,V+1)),de=()=>{let ge;return j?ge=oe:Q?ge=me:N.route.Component?ge=yt.createElement(N.route.Component,null):N.route.element?ge=N.route.element:ge=P,yt.createElement(WW,{match:N,routeContext:{outlet:P,matches:Ue,isDataRoute:n!=null},children:ge})};return n&&(N.route.ErrorBoundary||N.route.errorElement||V===0)?yt.createElement(qW,{location:n.location,revalidation:n.revalidation,component:oe,error:j,children:de(),routeContext:{outlet:null,matches:Ue,isDataRoute:!0},unstable_onError:a}):de()},null)}function sP(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function XW(t){let e=yt.useContext(Zg);return Ao(e,sP(t)),e}function KW(t){let e=yt.useContext(yT);return Ao(e,sP(t)),e}function YW(t){let e=yt.useContext(Th);return Ao(e,sP(t)),e}function oP(t){let e=YW(t),n=e.matches[e.matches.length-1];return Ao(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function QW(){return oP("useRouteId")}function JW(){var a;let t=yt.useContext(rP),e=KW("useRouteError"),n=oP("useRouteError");return t!==void 0?t:(a=e.errors)==null?void 0:a[n]}function e7(){let{router:t}=XW("useNavigate"),e=oP("useNavigate"),n=yt.useRef(!1);return nV(()=>{n.current=!0}),yt.useCallback(async(h,m={})=>{Mc(n.current,tV),n.current&&(typeof h=="number"?t.navigate(h):await t.navigate(h,{fromRouteId:e,...m}))},[t,e])}var iz={};function iV(t,e,n){!e&&!iz[t]&&(iz[t]=!0,Mc(!1,n))}yt.memo(t7);function t7({routes:t,future:e,state:n,unstable_onError:a}){return GW(t,void 0,n,a,e)}function n7({basename:t="/",children:e=null,location:n,navigationType:a="POP",navigator:h,static:m=!1}){Ao(!zx(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let v=t.replace(/^\/*/,"/"),o=yt.useMemo(()=>({basename:v,navigator:h,static:m,future:{}}),[v,h,m]);typeof n=="string"&&(n=Wg(n));let{pathname:S="/",search:P="",hash:N="",state:V=null,key:j="default"}=n,Q=yt.useMemo(()=>{let oe=gh(S,v);return oe==null?null:{location:{pathname:oe,search:P,hash:N,state:V,key:j},navigationType:a}},[v,S,P,N,V,j,a]);return Mc(Q!=null,`<Router basename="${v}"> is not able to match the URL "${S}${P}${N}" because it does not start with the basename, so the <Router> won't render anything.`),Q==null?null:yt.createElement(Au.Provider,{value:o},yt.createElement(vT.Provider,{children:e,value:Q}))}var F1="get",N1="application/x-www-form-urlencoded";function xT(t){return t!=null&&typeof t.tagName=="string"}function i7(t){return xT(t)&&t.tagName.toLowerCase()==="button"}function r7(t){return xT(t)&&t.tagName.toLowerCase()==="form"}function s7(t){return xT(t)&&t.tagName.toLowerCase()==="input"}function o7(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function a7(t,e){return t.button===0&&(!e||e==="_self")&&!o7(t)}var d1=null;function l7(){if(d1===null)try{new FormData(document.createElement("form"),0),d1=!1}catch{d1=!0}return d1}var c7=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function wS(t){return t!=null&&!c7.has(t)?(Mc(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${N1}"`),null):t}function u7(t,e){let n,a,h,m,v;if(r7(t)){let o=t.getAttribute("action");a=o?gh(o,e):null,n=t.getAttribute("method")||F1,h=wS(t.getAttribute("enctype"))||N1,m=new FormData(t)}else if(i7(t)||s7(t)&&(t.type==="submit"||t.type==="image")){let o=t.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let S=t.getAttribute("formaction")||o.getAttribute("action");if(a=S?gh(S,e):null,n=t.getAttribute("formmethod")||o.getAttribute("method")||F1,h=wS(t.getAttribute("formenctype"))||wS(o.getAttribute("enctype"))||N1,m=new FormData(o,t),!l7()){let{name:P,type:N,value:V}=t;if(N==="image"){let j=P?`${P}.`:"";m.append(`${j}x`,"0"),m.append(`${j}y`,"0")}else P&&m.append(P,V)}}else{if(xT(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=F1,a=null,h=N1,v=t}return m&&h==="text/plain"&&(v=m,m=void 0),{action:a,method:n.toLowerCase(),encType:h,formData:m,body:v}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function aP(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function h7(t,e,n){let a=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return a.pathname==="/"?a.pathname=`_root.${n}`:e&&gh(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${n}`,a}async function d7(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function f7(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function p7(t,e,n){let a=await Promise.all(t.map(async h=>{let m=e.routes[h.route.id];if(m){let v=await d7(m,n);return v.links?v.links():[]}return[]}));return y7(a.flat(1).filter(f7).filter(h=>h.rel==="stylesheet"||h.rel==="preload").map(h=>h.rel==="stylesheet"?{...h,rel:"prefetch",as:"style"}:{...h,rel:"prefetch"}))}function rz(t,e,n,a,h,m){let v=(S,P)=>n[P]?S.route.id!==n[P].route.id:!0,o=(S,P)=>{var N;return n[P].pathname!==S.pathname||((N=n[P].route.path)==null?void 0:N.endsWith("*"))&&n[P].params["*"]!==S.params["*"]};return m==="assets"?e.filter((S,P)=>v(S,P)||o(S,P)):m==="data"?e.filter((S,P)=>{var V;let N=a.routes[S.route.id];if(!N||!N.hasLoader)return!1;if(v(S,P)||o(S,P))return!0;if(S.route.shouldRevalidate){let j=S.route.shouldRevalidate({currentUrl:new URL(h.pathname+h.search+h.hash,window.origin),currentParams:((V=n[0])==null?void 0:V.params)||{},nextUrl:new URL(t,window.origin),nextParams:S.params,defaultShouldRevalidate:!0});if(typeof j=="boolean")return j}return!0}):[]}function m7(t,e,{includeHydrateFallback:n}={}){return g7(t.map(a=>{let h=e.routes[a.route.id];if(!h)return[];let m=[h.module];return h.clientActionModule&&(m=m.concat(h.clientActionModule)),h.clientLoaderModule&&(m=m.concat(h.clientLoaderModule)),n&&h.hydrateFallbackModule&&(m=m.concat(h.hydrateFallbackModule)),h.imports&&(m=m.concat(h.imports)),m}).flat(1))}function g7(t){return[...new Set(t)]}function _7(t){let e={},n=Object.keys(t).sort();for(let a of n)e[a]=t[a];return e}function y7(t,e){let n=new Set;return new Set(e),t.reduce((a,h)=>{let m=JSON.stringify(_7(h));return n.has(m)||(n.add(m),a.push({key:m,link:h})),a},[])}function rV(){let t=yt.useContext(Zg);return aP(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function v7(){let t=yt.useContext(yT);return aP(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var lP=yt.createContext(void 0);lP.displayName="FrameworkContext";function sV(){let t=yt.useContext(lP);return aP(t,"You must render this element inside a <HydratedRouter> element"),t}function x7(t,e){let n=yt.useContext(lP),[a,h]=yt.useState(!1),[m,v]=yt.useState(!1),{onFocus:o,onBlur:S,onMouseEnter:P,onMouseLeave:N,onTouchStart:V}=e,j=yt.useRef(null);yt.useEffect(()=>{if(t==="render"&&v(!0),t==="viewport"){let me=de=>{de.forEach(ge=>{v(ge.isIntersecting)})},Ue=new IntersectionObserver(me,{threshold:.5});return j.current&&Ue.observe(j.current),()=>{Ue.disconnect()}}},[t]),yt.useEffect(()=>{if(a){let me=setTimeout(()=>{v(!0)},100);return()=>{clearTimeout(me)}}},[a]);let Q=()=>{h(!0)},oe=()=>{h(!1),v(!1)};return n?t!=="intent"?[m,j,{}]:[m,j,{onFocus:cv(o,Q),onBlur:cv(S,oe),onMouseEnter:cv(P,Q),onMouseLeave:cv(N,oe),onTouchStart:cv(V,Q)}]:[!1,j,{}]}function cv(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function w7({page:t,...e}){let{router:n}=rV(),a=yt.useMemo(()=>Z4(n.routes,t,n.basename),[n.routes,t,n.basename]);return a?yt.createElement(T7,{page:t,matches:a,...e}):null}function b7(t){let{manifest:e,routeModules:n}=sV(),[a,h]=yt.useState([]);return yt.useEffect(()=>{let m=!1;return p7(t,e,n).then(v=>{m||h(v)}),()=>{m=!0}},[t,e,n]),a}function T7({page:t,matches:e,...n}){let a=wp(),{manifest:h,routeModules:m}=sV(),{basename:v}=rV(),{loaderData:o,matches:S}=v7(),P=yt.useMemo(()=>rz(t,e,S,h,a,"data"),[t,e,S,h,a]),N=yt.useMemo(()=>rz(t,e,S,h,a,"assets"),[t,e,S,h,a]),V=yt.useMemo(()=>{if(t===a.pathname+a.search+a.hash)return[];let oe=new Set,me=!1;if(e.forEach(de=>{var Re;let ge=h.routes[de.route.id];!ge||!ge.hasLoader||(!P.some(_t=>_t.route.id===de.route.id)&&de.route.id in o&&((Re=m[de.route.id])!=null&&Re.shouldRevalidate)||ge.hasClientLoader?me=!0:oe.add(de.route.id))}),oe.size===0)return[];let Ue=h7(t,v,"data");return me&&oe.size>0&&Ue.searchParams.set("_routes",e.filter(de=>oe.has(de.route.id)).map(de=>de.route.id).join(",")),[Ue.pathname+Ue.search]},[v,o,a,h,P,e,t,m]),j=yt.useMemo(()=>m7(N,h),[N,h]),Q=b7(N);return yt.createElement(yt.Fragment,null,V.map(oe=>yt.createElement("link",{key:oe,rel:"prefetch",as:"fetch",href:oe,...n})),j.map(oe=>yt.createElement("link",{key:oe,rel:"modulepreload",href:oe,...n})),Q.map(({key:oe,link:me})=>yt.createElement("link",{key:oe,nonce:n.nonce,...me})))}function E7(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var oV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{oV&&(window.__reactRouterVersion="7.8.2")}catch{}function I7({basename:t,children:e,window:n}){let a=yt.useRef();a.current==null&&(a.current=fW({window:n,v5Compat:!0}));let h=a.current,[m,v]=yt.useState({action:h.action,location:h.location}),o=yt.useCallback(S=>{yt.startTransition(()=>v(S))},[v]);return yt.useLayoutEffect(()=>h.listen(o),[h,o]),yt.createElement(n7,{basename:t,children:e,location:m.location,navigationType:m.action,navigator:h})}var aV=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lV=yt.forwardRef(function({onClick:e,discover:n="render",prefetch:a="none",relative:h,reloadDocument:m,replace:v,state:o,target:S,to:P,preventScrollReset:N,viewTransition:V,...j},Q){let{basename:oe}=yt.useContext(Au),me=typeof P=="string"&&aV.test(P),Ue,de=!1;if(typeof P=="string"&&me&&(Ue=P,oV))try{let ke=new URL(window.location.href),Ve=P.startsWith("//")?new URL(ke.protocol+P):new URL(P),De=gh(Ve.pathname,oe);Ve.origin===ke.origin&&De!=null?P=De+Ve.search+Ve.hash:de=!0}catch{Mc(!1,`<Link to="${P}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ge=VW(P,{relative:h}),[Re,_t,ct]=x7(a,j),nt=P7(P,{replace:v,state:o,target:S,preventScrollReset:N,relative:h,viewTransition:V});function Pe(ke){e&&e(ke),ke.defaultPrevented||nt(ke)}let xe=yt.createElement("a",{...j,...ct,href:Ue||ge,onClick:de||m?e:Pe,ref:E7(Q,_t),target:S,"data-discover":!me&&n==="render"?"true":void 0});return Re&&!me?yt.createElement(yt.Fragment,null,xe,yt.createElement(w7,{page:ge})):xe});lV.displayName="Link";var S7=yt.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:a="",end:h=!1,style:m,to:v,viewTransition:o,children:S,...P},N){let V=Fx(v,{relative:P.relative}),j=wp(),Q=yt.useContext(yT),{navigator:oe,basename:me}=yt.useContext(Au),Ue=Q!=null&&L7(V)&&o===!0,de=oe.encodeLocation?oe.encodeLocation(V).pathname:V.pathname,ge=j.pathname,Re=Q&&Q.navigation&&Q.navigation.location?Q.navigation.location.pathname:null;n||(ge=ge.toLowerCase(),Re=Re?Re.toLowerCase():null,de=de.toLowerCase()),Re&&me&&(Re=gh(Re,me)||Re);const _t=de!=="/"&&de.endsWith("/")?de.length-1:de.length;let ct=ge===de||!h&&ge.startsWith(de)&&ge.charAt(_t)==="/",nt=Re!=null&&(Re===de||!h&&Re.startsWith(de)&&Re.charAt(de.length)==="/"),Pe={isActive:ct,isPending:nt,isTransitioning:Ue},xe=ct?e:void 0,ke;typeof a=="function"?ke=a(Pe):ke=[a,ct?"active":null,nt?"pending":null,Ue?"transitioning":null].filter(Boolean).join(" ");let Ve=typeof m=="function"?m(Pe):m;return yt.createElement(lV,{...P,"aria-current":xe,className:ke,ref:N,style:Ve,to:v,viewTransition:o},typeof S=="function"?S(Pe):S)});S7.displayName="NavLink";var A7=yt.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:a,replace:h,state:m,method:v=F1,action:o,onSubmit:S,relative:P,preventScrollReset:N,viewTransition:V,...j},Q)=>{let oe=M7(),me=D7(o,{relative:P}),Ue=v.toLowerCase()==="get"?"get":"post",de=typeof o=="string"&&aV.test(o),ge=Re=>{if(S&&S(Re),Re.defaultPrevented)return;Re.preventDefault();let _t=Re.nativeEvent.submitter,ct=(_t==null?void 0:_t.getAttribute("formmethod"))||v;oe(_t||Re.currentTarget,{fetcherKey:e,method:ct,navigate:n,replace:h,state:m,relative:P,preventScrollReset:N,viewTransition:V})};return yt.createElement("form",{ref:Q,method:Ue,action:me,onSubmit:a?S:ge,...j,"data-discover":!de&&t==="render"?"true":void 0})});A7.displayName="Form";function C7(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cV(t){let e=yt.useContext(Zg);return Ao(e,C7(t)),e}function P7(t,{target:e,replace:n,state:a,preventScrollReset:h,relative:m,viewTransition:v}={}){let o=UW(),S=wp(),P=Fx(t,{relative:m});return yt.useCallback(N=>{if(a7(N,e)){N.preventDefault();let V=n!==void 0?n:fx(S)===fx(P);o(t,{replace:V,state:a,preventScrollReset:h,relative:m,viewTransition:v})}},[S,o,P,n,a,e,t,h,m,v])}var R7=0,k7=()=>`__${String(++R7)}__`;function M7(){let{router:t}=cV("useSubmit"),{basename:e}=yt.useContext(Au),n=QW();return yt.useCallback(async(a,h={})=>{let{action:m,method:v,encType:o,formData:S,body:P}=u7(a,e);if(h.navigate===!1){let N=h.fetcherKey||k7();await t.fetch(N,n,h.action||m,{preventScrollReset:h.preventScrollReset,formData:S,body:P,formMethod:h.method||v,formEncType:h.encType||o,flushSync:h.flushSync})}else await t.navigate(h.action||m,{preventScrollReset:h.preventScrollReset,formData:S,body:P,formMethod:h.method||v,formEncType:h.encType||o,replace:h.replace,state:h.state,fromRouteId:n,flushSync:h.flushSync,viewTransition:h.viewTransition})},[t,e,n])}function D7(t,{relative:e}={}){let{basename:n}=yt.useContext(Au),a=yt.useContext(Th);Ao(a,"useFormAction must be used inside a RouteContext");let[h]=a.matches.slice(-1),m={...Fx(t||".",{relative:e})},v=wp();if(t==null){m.search=v.search;let o=new URLSearchParams(m.search),S=o.getAll("index");if(S.some(N=>N==="")){o.delete("index"),S.filter(V=>V).forEach(V=>o.append("index",V));let N=o.toString();m.search=N?`?${N}`:""}}return(!t||t===".")&&h.route.index&&(m.search=m.search?m.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(m.pathname=m.pathname==="/"?n:lh([n,m.pathname])),fx(m)}function L7(t,{relative:e}={}){let n=yt.useContext(eV);Ao(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=cV("useViewTransitionState"),h=Fx(t,{relative:e});if(!n.isTransitioning)return!1;let m=gh(n.currentLocation.pathname,a)||n.currentLocation.pathname,v=gh(n.nextLocation.pathname,a)||n.nextLocation.pathname;return bb(h.pathname,v)!=null||bb(h.pathname,m)!=null}const O7=()=>{};var sz={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uV={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zn=function(t,e){if(!t)throw Xg(e)},Xg=function(t){return new Error("Firebase Database ("+uV.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hV=function(t){const e=[];let n=0;for(let a=0;a<t.length;a++){let h=t.charCodeAt(a);h<128?e[n++]=h:h<2048?(e[n++]=h>>6|192,e[n++]=h&63|128):(h&64512)===55296&&a+1<t.length&&(t.charCodeAt(a+1)&64512)===56320?(h=65536+((h&1023)<<10)+(t.charCodeAt(++a)&1023),e[n++]=h>>18|240,e[n++]=h>>12&63|128,e[n++]=h>>6&63|128,e[n++]=h&63|128):(e[n++]=h>>12|224,e[n++]=h>>6&63|128,e[n++]=h&63|128)}return e},z7=function(t){const e=[];let n=0,a=0;for(;n<t.length;){const h=t[n++];if(h<128)e[a++]=String.fromCharCode(h);else if(h>191&&h<224){const m=t[n++];e[a++]=String.fromCharCode((h&31)<<6|m&63)}else if(h>239&&h<365){const m=t[n++],v=t[n++],o=t[n++],S=((h&7)<<18|(m&63)<<12|(v&63)<<6|o&63)-65536;e[a++]=String.fromCharCode(55296+(S>>10)),e[a++]=String.fromCharCode(56320+(S&1023))}else{const m=t[n++],v=t[n++];e[a++]=String.fromCharCode((h&15)<<12|(m&63)<<6|v&63)}}return e.join("")},cP={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let h=0;h<t.length;h+=3){const m=t[h],v=h+1<t.length,o=v?t[h+1]:0,S=h+2<t.length,P=S?t[h+2]:0,N=m>>2,V=(m&3)<<4|o>>4;let j=(o&15)<<2|P>>6,Q=P&63;S||(Q=64,v||(j=64)),a.push(n[N],n[V],n[j],n[Q])}return a.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(hV(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):z7(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let h=0;h<t.length;){const m=n[t.charAt(h++)],o=h<t.length?n[t.charAt(h)]:0;++h;const P=h<t.length?n[t.charAt(h)]:64;++h;const V=h<t.length?n[t.charAt(h)]:64;if(++h,m==null||o==null||P==null||V==null)throw new F7;const j=m<<2|o>>4;if(a.push(j),P!==64){const Q=o<<4&240|P>>2;if(a.push(Q),V!==64){const oe=P<<6&192|V;a.push(oe)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class F7 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const dV=function(t){const e=hV(t);return cP.encodeByteArray(e,!0)},Tb=function(t){return dV(t).replace(/\./g,"")},Eb=function(t){try{return cP.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N7(t){return fV(void 0,t)}function fV(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!B7(n)||(t[n]=fV(t[n],e[n]));return t}function B7(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V7(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U7=()=>V7().__FIREBASE_DEFAULTS__,j7=()=>{if(typeof process>"u"||typeof sz>"u")return;const t=sz.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},G7=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Eb(t[1]);return e&&JSON.parse(e)},wT=()=>{try{return O7()||U7()||j7()||G7()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},pV=t=>{var e,n;return(n=(e=wT())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},mV=t=>{const e=pV(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),a]:[e.substring(0,n),a]},gV=()=>{var t;return(t=wT())==null?void 0:t.config},_V=t=>{var e;return(e=wT())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uP{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,a)=>{n?this.reject(n):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,a))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tf(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function hP(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yV(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},a=e||"demo-project",h=t.iat||0,m=t.sub||t.user_id;if(!m)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const v={iss:`https://securetoken.google.com/${a}`,aud:a,iat:h,exp:h+3600,auth_time:h,sub:m,user_id:m,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Tb(JSON.stringify(n)),Tb(JSON.stringify(v)),""].join(".")}const zv={};function $7(){const t={prod:[],emulator:[]};for(const e of Object.keys(zv))zv[e]?t.emulator.push(e):t.prod.push(e);return t}function H7(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let oz=!1;function dP(t,e){if(typeof window>"u"||typeof document>"u"||!tf(window.location.host)||zv[t]===e||zv[t]||oz)return;zv[t]=e;function n(j){return`__firebase__banner__${j}`}const a="__firebase__banner",m=$7().prod.length>0;function v(){const j=document.getElementById(a);j&&j.remove()}function o(j){j.style.display="flex",j.style.background="#7faaf0",j.style.position="fixed",j.style.bottom="5px",j.style.left="5px",j.style.padding=".5em",j.style.borderRadius="5px",j.style.alignItems="center"}function S(j,Q){j.setAttribute("width","24"),j.setAttribute("id",Q),j.setAttribute("height","24"),j.setAttribute("viewBox","0 0 24 24"),j.setAttribute("fill","none"),j.style.marginLeft="-6px"}function P(){const j=document.createElement("span");return j.style.cursor="pointer",j.style.marginLeft="16px",j.style.fontSize="24px",j.innerHTML=" &times;",j.onclick=()=>{oz=!0,v()},j}function N(j,Q){j.setAttribute("id",Q),j.innerText="Learn more",j.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",j.setAttribute("target","__blank"),j.style.paddingLeft="5px",j.style.textDecoration="underline"}function V(){const j=H7(a),Q=n("text"),oe=document.getElementById(Q)||document.createElement("span"),me=n("learnmore"),Ue=document.getElementById(me)||document.createElement("a"),de=n("preprendIcon"),ge=document.getElementById(de)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(j.created){const Re=j.element;o(Re),N(Ue,me);const _t=P();S(ge,de),Re.append(ge,oe,Ue,_t),document.body.appendChild(Re)}m?(oe.innerText="Preview backend disconnected.",ge.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ge.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,oe.innerText="Preview backend running in this workspace."),oe.setAttribute("id",Q)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",V):V()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function fP(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ba())}function q7(){var e;const t=(e=wT())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function W7(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function vV(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function xV(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Z7(){const t=ba();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function X7(){return uV.NODE_ADMIN===!0}function K7(){return!q7()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pP(){try{return typeof indexedDB=="object"}catch{return!1}}function mP(){return new Promise((t,e)=>{try{let n=!0;const a="validate-browser-context-for-indexeddb-analytics-module",h=self.indexedDB.open(a);h.onsuccess=()=>{h.result.close(),n||self.indexedDB.deleteDatabase(a),t(!0)},h.onupgradeneeded=()=>{n=!1},h.onerror=()=>{var m;e(((m=h.error)==null?void 0:m.message)||"")}}catch(n){e(n)}})}function wV(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y7="FirebaseError";class Oc extends Error{constructor(e,n,a){super(n),this.code=e,this.customData=a,this.name=Y7,Object.setPrototypeOf(this,Oc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,nf.prototype.create)}}class nf{constructor(e,n,a){this.service=e,this.serviceName=n,this.errors=a}create(e,...n){const a=n[0]||{},h=`${this.service}/${e}`,m=this.errors[e],v=m?Q7(m,a):"Error",o=`${this.serviceName}: ${v} (${h}).`;return new Oc(h,o,a)}}function Q7(t,e){return t.replace(J7,(n,a)=>{const h=e[a];return h!=null?String(h):`<${a}?>`})}const J7=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function px(t){return JSON.parse(t)}function Qo(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bV=function(t){let e={},n={},a={},h="";try{const m=t.split(".");e=px(Eb(m[0])||""),n=px(Eb(m[1])||""),h=m[2],a=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:a,signature:h}},eZ=function(t){const e=bV(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},tZ=function(t){const e=bV(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Mg(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function sC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ib(t,e,n){const a={};for(const h in t)Object.prototype.hasOwnProperty.call(t,h)&&(a[h]=e.call(n,t[h],h,t));return a}function Dc(t,e){if(t===e)return!0;const n=Object.keys(t),a=Object.keys(e);for(const h of n){if(!a.includes(h))return!1;const m=t[h],v=e[h];if(az(m)&&az(v)){if(!Dc(m,v))return!1}else if(m!==v)return!1}for(const h of a)if(!n.includes(h))return!1;return!0}function az(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kg(t){const e=[];for(const[n,a]of Object.entries(t))Array.isArray(a)?a.forEach(h=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(h))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function wv(t){const e={};return t.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[h,m]=a.split("=");e[decodeURIComponent(h)]=decodeURIComponent(m)}}),e}function bv(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nZ{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const a=this.W_;if(typeof e=="string")for(let V=0;V<16;V++)a[V]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let V=0;V<16;V++)a[V]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let V=16;V<80;V++){const j=a[V-3]^a[V-8]^a[V-14]^a[V-16];a[V]=(j<<1|j>>>31)&4294967295}let h=this.chain_[0],m=this.chain_[1],v=this.chain_[2],o=this.chain_[3],S=this.chain_[4],P,N;for(let V=0;V<80;V++){V<40?V<20?(P=o^m&(v^o),N=1518500249):(P=m^v^o,N=1859775393):V<60?(P=m&v|o&(m|v),N=2400959708):(P=m^v^o,N=3395469782);const j=(h<<5|h>>>27)+P+S+N+a[V]&4294967295;S=o,o=v,v=(m<<30|m>>>2)&4294967295,m=h,h=j}this.chain_[0]=this.chain_[0]+h&4294967295,this.chain_[1]=this.chain_[1]+m&4294967295,this.chain_[2]=this.chain_[2]+v&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+S&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const a=n-this.blockSize;let h=0;const m=this.buf_;let v=this.inbuf_;for(;h<n;){if(v===0)for(;h<=a;)this.compress_(e,h),h+=this.blockSize;if(typeof e=="string"){for(;h<n;)if(m[v]=e.charCodeAt(h),++v,++h,v===this.blockSize){this.compress_(m),v=0;break}}else for(;h<n;)if(m[v]=e[h],++v,++h,v===this.blockSize){this.compress_(m),v=0;break}}this.inbuf_=v,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let h=this.blockSize-1;h>=56;h--)this.buf_[h]=n&255,n/=256;this.compress_(this.buf_);let a=0;for(let h=0;h<5;h++)for(let m=24;m>=0;m-=8)e[a]=this.chain_[h]>>m&255,++a;return e}}function iZ(t,e){const n=new rZ(t,e);return n.subscribe.bind(n)}class rZ{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,a){let h;if(e===void 0&&n===void 0&&a===void 0)throw new Error("Missing Observer.");sZ(e,["next","error","complete"])?h=e:h={next:e,error:n,complete:a},h.next===void 0&&(h.next=bS),h.error===void 0&&(h.error=bS),h.complete===void 0&&(h.complete=bS);const m=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?h.error(this.finalError):h.complete()}catch{}}),this.observers.push(h),m}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sZ(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function bS(){}function oZ(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aZ=function(t){const e=[];let n=0;for(let a=0;a<t.length;a++){let h=t.charCodeAt(a);if(h>=55296&&h<=56319){const m=h-55296;a++,zn(a<t.length,"Surrogate pair missing trail surrogate.");const v=t.charCodeAt(a)-56320;h=65536+(m<<10)+v}h<128?e[n++]=h:h<2048?(e[n++]=h>>6|192,e[n++]=h&63|128):h<65536?(e[n++]=h>>12|224,e[n++]=h>>6&63|128,e[n++]=h&63|128):(e[n++]=h>>18|240,e[n++]=h>>12&63|128,e[n++]=h>>6&63|128,e[n++]=h&63|128)}return e},bT=function(t){let e=0;for(let n=0;n<t.length;n++){const a=t.charCodeAt(n);a<128?e++:a<2048?e+=2:a>=55296&&a<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lZ=1e3,cZ=2,uZ=4*60*60*1e3,hZ=.5;function lz(t,e=lZ,n=cZ){const a=e*Math.pow(n,t),h=Math.round(hZ*a*(Math.random()-.5)*2);return Math.min(uZ,a+h)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bs(t){return t&&t._delegate?t._delegate:t}class ul{constructor(e,n,a){this.name=e,this.instanceFactory=n,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hf="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dZ{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const a=new uP;if(this.instancesDeferred.set(n,a),this.isInitialized(n)||this.shouldAutoInitialize())try{const h=this.getOrInitializeService({instanceIdentifier:n});h&&a.resolve(h)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(h){if(a)return null;throw h}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pZ(e))try{this.getOrInitializeService({instanceIdentifier:Hf})}catch{}for(const[n,a]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(n);try{const m=this.getOrInitializeService({instanceIdentifier:h});a.resolve(m)}catch{}}}}clearInstance(e=Hf){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Hf){return this.instances.has(e)}getOptions(e=Hf){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const h=this.getOrInitializeService({instanceIdentifier:a,options:n});for(const[m,v]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(m);a===o&&v.resolve(h)}return h}onInit(e,n){const a=this.normalizeInstanceIdentifier(n),h=this.onInitCallbacks.get(a)??new Set;h.add(e),this.onInitCallbacks.set(a,h);const m=this.instances.get(a);return m&&e(m,a),()=>{h.delete(e)}}invokeOnInitCallbacks(e,n){const a=this.onInitCallbacks.get(n);if(a)for(const h of a)try{h(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:fZ(e),options:n}),this.instances.set(e,a),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=Hf){return this.component?this.component.multipleInstances?e:Hf:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function fZ(t){return t===Hf?void 0:t}function pZ(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mZ{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new dZ(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vr;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(vr||(vr={}));const gZ={debug:vr.DEBUG,verbose:vr.VERBOSE,info:vr.INFO,warn:vr.WARN,error:vr.ERROR,silent:vr.SILENT},_Z=vr.INFO,yZ={[vr.DEBUG]:"log",[vr.VERBOSE]:"log",[vr.INFO]:"info",[vr.WARN]:"warn",[vr.ERROR]:"error"},vZ=(t,e,...n)=>{if(e<t.logLevel)return;const a=new Date().toISOString(),h=yZ[e];if(h)console[h](`[${a}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Nx{constructor(e){this.name=e,this._logLevel=_Z,this._logHandler=vZ,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in vr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?gZ[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,vr.DEBUG,...e),this._logHandler(this,vr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,vr.VERBOSE,...e),this._logHandler(this,vr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,vr.INFO,...e),this._logHandler(this,vr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,vr.WARN,...e),this._logHandler(this,vr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,vr.ERROR,...e),this._logHandler(this,vr.ERROR,...e)}}const xZ=(t,e)=>e.some(n=>t instanceof n);let cz,uz;function wZ(){return cz||(cz=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function bZ(){return uz||(uz=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const TV=new WeakMap,oC=new WeakMap,EV=new WeakMap,TS=new WeakMap,gP=new WeakMap;function TZ(t){const e=new Promise((n,a)=>{const h=()=>{t.removeEventListener("success",m),t.removeEventListener("error",v)},m=()=>{n(Od(t.result)),h()},v=()=>{a(t.error),h()};t.addEventListener("success",m),t.addEventListener("error",v)});return e.then(n=>{n instanceof IDBCursor&&TV.set(n,t)}).catch(()=>{}),gP.set(e,t),e}function EZ(t){if(oC.has(t))return;const e=new Promise((n,a)=>{const h=()=>{t.removeEventListener("complete",m),t.removeEventListener("error",v),t.removeEventListener("abort",v)},m=()=>{n(),h()},v=()=>{a(t.error||new DOMException("AbortError","AbortError")),h()};t.addEventListener("complete",m),t.addEventListener("error",v),t.addEventListener("abort",v)});oC.set(t,e)}let aC={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return oC.get(t);if(e==="objectStoreNames")return t.objectStoreNames||EV.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Od(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function IZ(t){aC=t(aC)}function SZ(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const a=t.call(ES(this),e,...n);return EV.set(a,e.sort?e.sort():[e]),Od(a)}:bZ().includes(t)?function(...e){return t.apply(ES(this),e),Od(TV.get(this))}:function(...e){return Od(t.apply(ES(this),e))}}function AZ(t){return typeof t=="function"?SZ(t):(t instanceof IDBTransaction&&EZ(t),xZ(t,wZ())?new Proxy(t,aC):t)}function Od(t){if(t instanceof IDBRequest)return TZ(t);if(TS.has(t))return TS.get(t);const e=AZ(t);return e!==t&&(TS.set(t,e),gP.set(e,t)),e}const ES=t=>gP.get(t);function CZ(t,e,{blocked:n,upgrade:a,blocking:h,terminated:m}={}){const v=indexedDB.open(t,e),o=Od(v);return a&&v.addEventListener("upgradeneeded",S=>{a(Od(v.result),S.oldVersion,S.newVersion,Od(v.transaction),S)}),n&&v.addEventListener("blocked",S=>n(S.oldVersion,S.newVersion,S)),o.then(S=>{m&&S.addEventListener("close",()=>m()),h&&S.addEventListener("versionchange",P=>h(P.oldVersion,P.newVersion,P))}).catch(()=>{}),o}const PZ=["get","getKey","getAll","getAllKeys","count"],RZ=["put","add","delete","clear"],IS=new Map;function hz(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(IS.get(e))return IS.get(e);const n=e.replace(/FromIndex$/,""),a=e!==n,h=RZ.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(h||PZ.includes(n)))return;const m=async function(v,...o){const S=this.transaction(v,h?"readwrite":"readonly");let P=S.store;return a&&(P=P.index(o.shift())),(await Promise.all([P[n](...o),h&&S.done]))[0]};return IS.set(e,m),m}IZ(t=>({...t,get:(e,n,a)=>hz(e,n)||t.get(e,n,a),has:(e,n)=>!!hz(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kZ{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(MZ(n)){const a=n.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(n=>n).join(" ")}}function MZ(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const lC="@firebase/app",dz="0.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h=new Nx("@firebase/app"),DZ="@firebase/app-compat",LZ="@firebase/analytics-compat",OZ="@firebase/analytics",zZ="@firebase/app-check-compat",FZ="@firebase/app-check",NZ="@firebase/auth",BZ="@firebase/auth-compat",VZ="@firebase/database",UZ="@firebase/data-connect",jZ="@firebase/database-compat",GZ="@firebase/functions",$Z="@firebase/functions-compat",HZ="@firebase/installations",qZ="@firebase/installations-compat",WZ="@firebase/messaging",ZZ="@firebase/messaging-compat",XZ="@firebase/performance",KZ="@firebase/performance-compat",YZ="@firebase/remote-config",QZ="@firebase/remote-config-compat",JZ="@firebase/storage",eX="@firebase/storage-compat",tX="@firebase/firestore",nX="@firebase/ai",iX="@firebase/firestore-compat",rX="firebase",sX="12.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC="[DEFAULT]",oX={[lC]:"fire-core",[DZ]:"fire-core-compat",[OZ]:"fire-analytics",[LZ]:"fire-analytics-compat",[FZ]:"fire-app-check",[zZ]:"fire-app-check-compat",[NZ]:"fire-auth",[BZ]:"fire-auth-compat",[VZ]:"fire-rtdb",[UZ]:"fire-data-connect",[jZ]:"fire-rtdb-compat",[GZ]:"fire-fn",[$Z]:"fire-fn-compat",[HZ]:"fire-iid",[qZ]:"fire-iid-compat",[WZ]:"fire-fcm",[ZZ]:"fire-fcm-compat",[XZ]:"fire-perf",[KZ]:"fire-perf-compat",[YZ]:"fire-rc",[QZ]:"fire-rc-compat",[JZ]:"fire-gcs",[eX]:"fire-gcs-compat",[tX]:"fire-fst",[iX]:"fire-fst-compat",[nX]:"fire-vertex","fire-js":"fire-js",[rX]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sb=new Map,aX=new Map,uC=new Map;function fz(t,e){try{t.container.addComponent(e)}catch(n){_h.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function kl(t){const e=t.name;if(uC.has(e))return _h.debug(`There were multiple attempts to register component ${e}.`),!1;uC.set(e,t);for(const n of Sb.values())fz(n,t);for(const n of aX.values())fz(n,t);return!0}function Ih(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function tl(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lX={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},zd=new nf("app","Firebase",lX);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cX{constructor(e,n,a){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new ul("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw zd.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bp=sX;function IV(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const a={name:cC,automaticDataCollectionEnabled:!0,...e},h=a.name;if(typeof h!="string"||!h)throw zd.create("bad-app-name",{appName:String(h)});if(n||(n=gV()),!n)throw zd.create("no-options");const m=Sb.get(h);if(m){if(Dc(n,m.options)&&Dc(a,m.config))return m;throw zd.create("duplicate-app",{appName:h})}const v=new mZ(h);for(const S of uC.values())v.addComponent(S);const o=new cX(n,a,v);return Sb.set(h,o),o}function Bx(t=cC){const e=Sb.get(t);if(!e&&t===cC&&gV())return IV();if(!e)throw zd.create("no-app",{appName:t});return e}function va(t,e,n){let a=oX[t]??t;n&&(a+=`-${n}`);const h=a.match(/\s|\//),m=e.match(/\s|\//);if(h||m){const v=[`Unable to register library "${a}" with version "${e}":`];h&&v.push(`library name "${a}" contains illegal characters (whitespace or "/")`),h&&m&&v.push("and"),m&&v.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_h.warn(v.join(" "));return}kl(new ul(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uX="firebase-heartbeat-database",hX=1,mx="firebase-heartbeat-store";let SS=null;function SV(){return SS||(SS=CZ(uX,hX,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(mx)}catch(n){console.warn(n)}}}}).catch(t=>{throw zd.create("idb-open",{originalErrorMessage:t.message})})),SS}async function dX(t){try{const n=(await SV()).transaction(mx),a=await n.objectStore(mx).get(AV(t));return await n.done,a}catch(e){if(e instanceof Oc)_h.warn(e.message);else{const n=zd.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});_h.warn(n.message)}}}async function pz(t,e){try{const a=(await SV()).transaction(mx,"readwrite");await a.objectStore(mx).put(e,AV(t)),await a.done}catch(n){if(n instanceof Oc)_h.warn(n.message);else{const a=zd.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});_h.warn(a.message)}}}function AV(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fX=1024,pX=30;class mX{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new _X(n),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,n;try{const h=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),m=mz();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===m||this._heartbeatsCache.heartbeats.some(v=>v.date===m))return;if(this._heartbeatsCache.heartbeats.push({date:m,agent:h}),this._heartbeatsCache.heartbeats.length>pX){const v=yX(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(v,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){_h.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=mz(),{heartbeatsToSend:a,unsentEntries:h}=gX(this._heartbeatsCache.heartbeats),m=Tb(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=n,h.length>0?(this._heartbeatsCache.heartbeats=h,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),m}catch(n){return _h.warn(n),""}}}function mz(){return new Date().toISOString().substring(0,10)}function gX(t,e=fX){const n=[];let a=t.slice();for(const h of t){const m=n.find(v=>v.agent===h.agent);if(m){if(m.dates.push(h.date),gz(n)>e){m.dates.pop();break}}else if(n.push({agent:h.agent,dates:[h.date]}),gz(n)>e){n.pop();break}a=a.slice(1)}return{heartbeatsToSend:n,unsentEntries:a}}class _X{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pP()?mP().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await dX(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return pz(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const a=await this.read();return pz(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function gz(t){return Tb(JSON.stringify({version:2,heartbeats:t})).length}function yX(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let a=1;a<t.length;a++)t[a].date<n&&(n=t[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vX(t){kl(new ul("platform-logger",e=>new kZ(e),"PRIVATE")),kl(new ul("heartbeat",e=>new mX(e),"PRIVATE")),va(lC,dz,t),va(lC,dz,"esm2020"),va("fire-js","")}vX("");var xX="firebase",wX="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */va(xX,wX,"app");function CV(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const bX=CV,PV=new nf("auth","Firebase",CV());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ab=new Nx("@firebase/auth");function TX(t,...e){Ab.logLevel<=vr.WARN&&Ab.warn(`Auth (${bp}): ${t}`,...e)}function B1(t,...e){Ab.logLevel<=vr.ERROR&&Ab.error(`Auth (${bp}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(t,...e){throw yP(t,...e)}function Cc(t,...e){return yP(t,...e)}function _P(t,e,n){const a={...bX(),[e]:n};return new nf("auth","Firebase",a).create(e,{appName:t.name})}function ch(t){return _P(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function EX(t,e,n){const a=n;if(!(e instanceof a))throw a.name!==e.constructor.name&&rc(t,"argument-error"),_P(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function yP(t,...e){if(typeof t!="string"){const n=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=t.name),t._errorFactory.create(n,...a)}return PV.create(t,...e)}function Li(t,e,...n){if(!t)throw yP(e,...n)}function rh(t){const e="INTERNAL ASSERTION FAILED: "+t;throw B1(e),new Error(e)}function yh(t,e){t||rh(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hC(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function IX(){return _z()==="http:"||_z()==="https:"}function _z(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SX(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(IX()||vV()||"connection"in navigator)?navigator.onLine:!0}function AX(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vx{constructor(e,n){this.shortDelay=e,this.longDelay=n,yh(n>e,"Short delay should be less than long delay!"),this.isMobile=fP()||xV()}get(){return SX()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vP(t,e){yh(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RV{static initialize(e,n,a){this.fetchImpl=e,n&&(this.headersImpl=n),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;rh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;rh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;rh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CX={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PX=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],RX=new Vx(3e4,6e4);function rf(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function sf(t,e,n,a,h={}){return kV(t,h,async()=>{let m={},v={};a&&(e==="GET"?v=a:m={body:JSON.stringify(a)});const o=Kg({key:t.config.apiKey,...v}).slice(1),S=await t._getAdditionalHeaders();S["Content-Type"]="application/json",t.languageCode&&(S["X-Firebase-Locale"]=t.languageCode);const P={method:e,headers:S,...m};return W7()||(P.referrerPolicy="no-referrer"),t.emulatorConfig&&tf(t.emulatorConfig.host)&&(P.credentials="include"),RV.fetch()(await MV(t,t.config.apiHost,n,o),P)})}async function kV(t,e,n){t._canInitEmulator=!1;const a={...CX,...e};try{const h=new MX(t),m=await Promise.race([n(),h.promise]);h.clearNetworkTimeout();const v=await m.json();if("needConfirmation"in v)throw f1(t,"account-exists-with-different-credential",v);if(m.ok&&!("errorMessage"in v))return v;{const o=m.ok?v.errorMessage:v.error.message,[S,P]=o.split(" : ");if(S==="FEDERATED_USER_ID_ALREADY_LINKED")throw f1(t,"credential-already-in-use",v);if(S==="EMAIL_EXISTS")throw f1(t,"email-already-in-use",v);if(S==="USER_DISABLED")throw f1(t,"user-disabled",v);const N=a[S]||S.toLowerCase().replace(/[_\s]+/g,"-");if(P)throw _P(t,N,P);rc(t,N)}}catch(h){if(h instanceof Oc)throw h;rc(t,"network-request-failed",{message:String(h)})}}async function Ux(t,e,n,a,h={}){const m=await sf(t,e,n,a,h);return"mfaPendingCredential"in m&&rc(t,"multi-factor-auth-required",{_serverResponse:m}),m}async function MV(t,e,n,a){const h=`${e}${n}?${a}`,m=t,v=m.config.emulator?vP(t.config,h):`${t.config.apiScheme}://${h}`;return PX.includes(n)&&(await m._persistenceManagerAvailable,m._getPersistenceType()==="COOKIE")?m._getPersistence()._getFinalTarget(v).toString():v}function kX(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class MX{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,a)=>{this.timer=setTimeout(()=>a(Cc(this.auth,"network-request-failed")),RX.get())})}}function f1(t,e,n){const a={appName:t.name};n.email&&(a.email=n.email),n.phoneNumber&&(a.phoneNumber=n.phoneNumber);const h=Cc(t,e,a);return h.customData._tokenResponse=n,h}function yz(t){return t!==void 0&&t.enterprise!==void 0}class DX{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return kX(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function LX(t,e){return sf(t,"GET","/v2/recaptchaConfig",rf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OX(t,e){return sf(t,"POST","/v1/accounts:delete",e)}async function Cb(t,e){return sf(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fv(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function zX(t,e=!1){const n=bs(t),a=await n.getIdToken(e),h=xP(a);Li(h&&h.exp&&h.auth_time&&h.iat,n.auth,"internal-error");const m=typeof h.firebase=="object"?h.firebase:void 0,v=m==null?void 0:m.sign_in_provider;return{claims:h,token:a,authTime:Fv(AS(h.auth_time)),issuedAtTime:Fv(AS(h.iat)),expirationTime:Fv(AS(h.exp)),signInProvider:v||null,signInSecondFactor:(m==null?void 0:m.sign_in_second_factor)||null}}function AS(t){return Number(t)*1e3}function xP(t){const[e,n,a]=t.split(".");if(e===void 0||n===void 0||a===void 0)return B1("JWT malformed, contained fewer than 3 sections"),null;try{const h=Eb(n);return h?JSON.parse(h):(B1("Failed to decode base64 JWT payload"),null)}catch(h){return B1("Caught error parsing JWT payload as JSON",h==null?void 0:h.toString()),null}}function vz(t){const e=xP(t);return Li(e,"internal-error"),Li(typeof e.exp<"u","internal-error"),Li(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gx(t,e,n=!1){if(n)return e;try{return await e}catch(a){throw a instanceof Oc&&FX(a)&&t.auth.currentUser===t&&await t.auth.signOut(),a}}function FX({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NX{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const a=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dC{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Fv(this.lastLoginAt),this.creationTime=Fv(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pb(t){var V;const e=t.auth,n=await t.getIdToken(),a=await gx(t,Cb(e,{idToken:n}));Li(a==null?void 0:a.users.length,e,"internal-error");const h=a.users[0];t._notifyReloadListener(h);const m=(V=h.providerUserInfo)!=null&&V.length?DV(h.providerUserInfo):[],v=VX(t.providerData,m),o=t.isAnonymous,S=!(t.email&&h.passwordHash)&&!(v!=null&&v.length),P=o?S:!1,N={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:v,metadata:new dC(h.createdAt,h.lastLoginAt),isAnonymous:P};Object.assign(t,N)}async function BX(t){const e=bs(t);await Pb(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function VX(t,e){return[...t.filter(a=>!e.some(h=>h.providerId===a.providerId)),...e]}function DV(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UX(t,e){const n=await kV(t,{},async()=>{const a=Kg({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:h,apiKey:m}=t.config,v=await MV(t,h,"/v1/token",`key=${m}`),o=await t._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const S={method:"POST",headers:o,body:a};return t.emulatorConfig&&tf(t.emulatorConfig.host)&&(S.credentials="include"),RV.fetch()(v,S)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function jX(t,e){return sf(t,"POST","/v2/accounts:revokeToken",rf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Li(e.idToken,"internal-error"),Li(typeof e.idToken<"u","internal-error"),Li(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):vz(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Li(e.length!==0,"internal-error");const n=vz(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Li(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:a,refreshToken:h,expiresIn:m}=await UX(e,n);this.updateTokensAndExpiration(a,h,Number(m))}updateTokensAndExpiration(e,n,a){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,n){const{refreshToken:a,accessToken:h,expirationTime:m}=n,v=new gg;return a&&(Li(typeof a=="string","internal-error",{appName:e}),v.refreshToken=a),h&&(Li(typeof h=="string","internal-error",{appName:e}),v.accessToken=h),m&&(Li(typeof m=="number","internal-error",{appName:e}),v.expirationTime=m),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gg,this.toJSON())}_performRefresh(){return rh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function md(t,e){Li(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Ec{constructor({uid:e,auth:n,stsTokenManager:a,...h}){this.providerId="firebase",this.proactiveRefresh=new NX(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=h.displayName||null,this.email=h.email||null,this.emailVerified=h.emailVerified||!1,this.phoneNumber=h.phoneNumber||null,this.photoURL=h.photoURL||null,this.isAnonymous=h.isAnonymous||!1,this.tenantId=h.tenantId||null,this.providerData=h.providerData?[...h.providerData]:[],this.metadata=new dC(h.createdAt||void 0,h.lastLoginAt||void 0)}async getIdToken(e){const n=await gx(this,this.stsTokenManager.getToken(this.auth,e));return Li(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return zX(this,e)}reload(){return BX(this)}_assign(e){this!==e&&(Li(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Ec({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Li(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),n&&await Pb(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tl(this.auth.app))return Promise.reject(ch(this.auth));const e=await this.getIdToken();return await gx(this,OX(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const a=n.displayName??void 0,h=n.email??void 0,m=n.phoneNumber??void 0,v=n.photoURL??void 0,o=n.tenantId??void 0,S=n._redirectEventId??void 0,P=n.createdAt??void 0,N=n.lastLoginAt??void 0,{uid:V,emailVerified:j,isAnonymous:Q,providerData:oe,stsTokenManager:me}=n;Li(V&&me,e,"internal-error");const Ue=gg.fromJSON(this.name,me);Li(typeof V=="string",e,"internal-error"),md(a,e.name),md(h,e.name),Li(typeof j=="boolean",e,"internal-error"),Li(typeof Q=="boolean",e,"internal-error"),md(m,e.name),md(v,e.name),md(o,e.name),md(S,e.name),md(P,e.name),md(N,e.name);const de=new Ec({uid:V,auth:e,email:h,emailVerified:j,displayName:a,isAnonymous:Q,photoURL:v,phoneNumber:m,tenantId:o,stsTokenManager:Ue,createdAt:P,lastLoginAt:N});return oe&&Array.isArray(oe)&&(de.providerData=oe.map(ge=>({...ge}))),S&&(de._redirectEventId=S),de}static async _fromIdTokenResponse(e,n,a=!1){const h=new gg;h.updateFromServerResponse(n);const m=new Ec({uid:n.localId,auth:e,stsTokenManager:h,isAnonymous:a});return await Pb(m),m}static async _fromGetAccountInfoResponse(e,n,a){const h=n.users[0];Li(h.localId!==void 0,"internal-error");const m=h.providerUserInfo!==void 0?DV(h.providerUserInfo):[],v=!(h.email&&h.passwordHash)&&!(m!=null&&m.length),o=new gg;o.updateFromIdToken(a);const S=new Ec({uid:h.localId,auth:e,stsTokenManager:o,isAnonymous:v}),P={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:m,metadata:new dC(h.createdAt,h.lastLoginAt),isAnonymous:!(h.email&&h.passwordHash)&&!(m!=null&&m.length)};return Object.assign(S,P),S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xz=new Map;function sh(t){yh(t instanceof Function,"Expected a class definition");let e=xz.get(t);return e?(yh(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,xz.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}LV.type="NONE";const wz=LV;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V1(t,e,n){return`firebase:${t}:${e}:${n}`}class _g{constructor(e,n,a){this.persistence=e,this.auth=n,this.userKey=a;const{config:h,name:m}=this.auth;this.fullUserKey=V1(this.userKey,h.apiKey,m),this.fullPersistenceKey=V1("persistence",h.apiKey,m),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Cb(this.auth,{idToken:e}).catch(()=>{});return n?Ec._fromGetAccountInfoResponse(this.auth,n,e):null}return Ec._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,a="authUser"){if(!n.length)return new _g(sh(wz),e,a);const h=(await Promise.all(n.map(async P=>{if(await P._isAvailable())return P}))).filter(P=>P);let m=h[0]||sh(wz);const v=V1(a,e.config.apiKey,e.name);let o=null;for(const P of n)try{const N=await P._get(v);if(N){let V;if(typeof N=="string"){const j=await Cb(e,{idToken:N}).catch(()=>{});if(!j)break;V=await Ec._fromGetAccountInfoResponse(e,j,N)}else V=Ec._fromJSON(e,N);P!==m&&(o=V),m=P;break}}catch{}const S=h.filter(P=>P._shouldAllowMigration);return!m._shouldAllowMigration||!S.length?new _g(m,e,a):(m=S[0],o&&await m._set(v,o.toJSON()),await Promise.all(n.map(async P=>{if(P!==m)try{await P._remove(v)}catch{}})),new _g(m,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bz(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(NV(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(OV(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(VV(e))return"Blackberry";if(UV(e))return"Webos";if(zV(e))return"Safari";if((e.includes("chrome/")||FV(e))&&!e.includes("edge/"))return"Chrome";if(BV(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=t.match(n);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function OV(t=ba()){return/firefox\//i.test(t)}function zV(t=ba()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function FV(t=ba()){return/crios\//i.test(t)}function NV(t=ba()){return/iemobile/i.test(t)}function BV(t=ba()){return/android/i.test(t)}function VV(t=ba()){return/blackberry/i.test(t)}function UV(t=ba()){return/webos/i.test(t)}function wP(t=ba()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function GX(t=ba()){var e;return wP(t)&&!!((e=window.navigator)!=null&&e.standalone)}function $X(){return Z7()&&document.documentMode===10}function jV(t=ba()){return wP(t)||BV(t)||UV(t)||VV(t)||/windows phone/i.test(t)||NV(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GV(t,e=[]){let n;switch(t){case"Browser":n=bz(ba());break;case"Worker":n=`${bz(ba())}-${t}`;break;default:n=t}const a=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${bp}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HX{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const a=m=>new Promise((v,o)=>{try{const S=e(m);v(S)}catch(S){o(S)}});a.onAbort=n,this.queue.push(a);const h=this.queue.length-1;return()=>{this.queue[h]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const a of this.queue)await a(e),a.onAbort&&n.push(a.onAbort)}catch(a){n.reverse();for(const h of n)try{h()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qX(t,e={}){return sf(t,"GET","/v2/passwordPolicy",rf(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WX=6;class ZX{constructor(e){var a;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??WX,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((a=e.allowedNonAlphanumericCharacters)==null?void 0:a.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const a=this.customStrengthOptions.minPasswordLength,h=this.customStrengthOptions.maxPasswordLength;a&&(n.meetsMinPasswordLength=e.length>=a),h&&(n.meetsMaxPasswordLength=e.length<=h)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let a;for(let h=0;h<e.length;h++)a=e.charAt(h),this.updatePasswordCharacterOptionsStatuses(n,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,n,a,h,m){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=h)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XX{constructor(e,n,a,h){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=a,this.config=h,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Tz(this),this.idTokenSubscription=new Tz(this),this.beforeStateQueue=new HX(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=PV,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=h.sdkClientVersion,this._persistenceManagerAvailable=new Promise(m=>this._resolvePersistenceManagerAvailable=m)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=sh(n)),this._initializationPromise=this.queue(async()=>{var a,h,m;if(!this._deleted&&(this.persistenceManager=await _g.create(this,e),(a=this._resolvePersistenceManagerAvailable)==null||a.call(this),!this._deleted)){if((h=this._popupRedirectResolver)!=null&&h._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((m=this.currentUser)==null?void 0:m.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Cb(this,{idToken:e}),a=await Ec._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(a)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var m;if(tl(this.app)){const v=this.app.settings.authIdToken;return v?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(v).then(o,o))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let a=n,h=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const v=(m=this.redirectUser)==null?void 0:m._redirectEventId,o=a==null?void 0:a._redirectEventId,S=await this.tryRedirectSignIn(e);(!v||v===o)&&(S!=null&&S.user)&&(a=S.user,h=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(h)try{await this.beforeStateQueue.runMiddleware(a)}catch(v){a=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(v))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return Li(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Pb(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=AX()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tl(this.app))return Promise.reject(ch(this));const n=e?bs(e):null;return n&&Li(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Li(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tl(this.app)?Promise.reject(ch(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tl(this.app)?Promise.reject(ch(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(sh(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await qX(this),n=new ZX(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new nf("auth","Firebase",e())}onAuthStateChanged(e,n,a){return this.registerStateListener(this.authStateSubscription,e,n,a)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,a){return this.registerStateListener(this.idTokenSubscription,e,n,a)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(a.tenantId=this.tenantId),await jX(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const a=await this.getOrInitRedirectPersistenceManager(n);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&sh(e)||this._popupRedirectResolver;Li(n,this,"argument-error"),this.redirectPersistenceManager=await _g.create(this,[sh(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,a;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((a=this.redirectUser)==null?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,a,h){if(this._deleted)return()=>{};const m=typeof n=="function"?n:n.next.bind(n);let v=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Li(o,this,"internal-error"),o.then(()=>{v||m(this.currentUser)}),typeof n=="function"){const S=e.addObserver(n,a,h);return()=>{v=!0,S()}}else{const S=e.addObserver(n);return()=>{v=!0,S()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Li(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=GV(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var h;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((h=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:h.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const a=await this._getAppCheckToken();return a&&(e["X-Firebase-AppCheck"]=a),e}async _getAppCheckToken(){var n;if(tl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&TX(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function of(t){return bs(t)}class Tz{constructor(e){this.auth=e,this.observer=null,this.addObserver=iZ(n=>this.observer=n)}get next(){return Li(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TT={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function KX(t){TT=t}function $V(t){return TT.loadJS(t)}function YX(){return TT.recaptchaEnterpriseScript}function QX(){return TT.gapiScript}function JX(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class eK{constructor(){this.enterprise=new tK}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class tK{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const nK="recaptcha-enterprise",HV="NO_RECAPTCHA";class iK{constructor(e){this.type=nK,this.auth=of(e)}async verify(e="verify",n=!1){async function a(m){if(!n){if(m.tenantId==null&&m._agentRecaptchaConfig!=null)return m._agentRecaptchaConfig.siteKey;if(m.tenantId!=null&&m._tenantRecaptchaConfigs[m.tenantId]!==void 0)return m._tenantRecaptchaConfigs[m.tenantId].siteKey}return new Promise(async(v,o)=>{LX(m,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(S=>{if(S.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const P=new DX(S);return m.tenantId==null?m._agentRecaptchaConfig=P:m._tenantRecaptchaConfigs[m.tenantId]=P,v(P.siteKey)}}).catch(S=>{o(S)})})}function h(m,v,o){const S=window.grecaptcha;yz(S)?S.enterprise.ready(()=>{S.enterprise.execute(m,{action:e}).then(P=>{v(P)}).catch(()=>{v(HV)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eK().execute("siteKey",{action:"verify"}):new Promise((m,v)=>{a(this.auth).then(o=>{if(!n&&yz(window.grecaptcha))h(o,m,v);else{if(typeof window>"u"){v(new Error("RecaptchaVerifier is only supported in browser"));return}let S=YX();S.length!==0&&(S+=o),$V(S).then(()=>{h(o,m,v)}).catch(P=>{v(P)})}}).catch(o=>{v(o)})})}}async function Ez(t,e,n,a=!1,h=!1){const m=new iK(t);let v;if(h)v=HV;else try{v=await m.verify(n)}catch{v=await m.verify(n,!0)}const o={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const S=o.phoneEnrollmentInfo.phoneNumber,P=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:S,recaptchaToken:P,captchaResponse:v,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const S=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:S,captchaResponse:v,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return a?Object.assign(o,{captchaResp:v}):Object.assign(o,{captchaResponse:v}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function fC(t,e,n,a,h){var m;if((m=t._getRecaptchaConfig())!=null&&m.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const v=await Ez(t,e,n,n==="getOobCode");return a(t,v)}else return a(t,e).catch(async v=>{if(v.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Ez(t,e,n,n==="getOobCode");return a(t,o)}else return Promise.reject(v)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rK(t,e){const n=Ih(t,"auth");if(n.isInitialized()){const h=n.getImmediate(),m=n.getOptions();if(Dc(m,e??{}))return h;rc(h,"already-initialized")}return n.initialize({options:e})}function sK(t,e){const n=(e==null?void 0:e.persistence)||[],a=(Array.isArray(n)?n:[n]).map(sh);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function oK(t,e,n){const a=of(t);Li(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const h=!1,m=qV(e),{host:v,port:o}=aK(e),S=o===null?"":`:${o}`,P={url:`${m}//${v}${S}/`},N=Object.freeze({host:v,port:o,protocol:m.replace(":",""),options:Object.freeze({disableWarnings:h})});if(!a._canInitEmulator){Li(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Li(Dc(P,a.config.emulator)&&Dc(N,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=P,a.emulatorConfig=N,a.settings.appVerificationDisabledForTesting=!0,tf(v)?(hP(`${m}//${v}${S}`),dP("Auth",!0)):lK()}function qV(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function aK(t){const e=qV(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const a=n[2].split("@").pop()||"",h=/^(\[[^\]]+\])(:|$)/.exec(a);if(h){const m=h[1];return{host:m,port:Iz(a.substr(m.length+1))}}else{const[m,v]=a.split(":");return{host:m,port:Iz(v)}}}function Iz(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function lK(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bP{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return rh("not implemented")}_getIdTokenResponse(e){return rh("not implemented")}_linkToIdToken(e,n){return rh("not implemented")}_getReauthenticationResolver(e){return rh("not implemented")}}async function cK(t,e){return sf(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uK(t,e){return Ux(t,"POST","/v1/accounts:signInWithPassword",rf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hK(t,e){return Ux(t,"POST","/v1/accounts:signInWithEmailLink",rf(t,e))}async function dK(t,e){return Ux(t,"POST","/v1/accounts:signInWithEmailLink",rf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x extends bP{constructor(e,n,a,h=null){super("password",a),this._email=e,this._password=n,this._tenantId=h}static _fromEmailAndPassword(e,n){return new _x(e,n,"password")}static _fromEmailAndCode(e,n,a=null){return new _x(e,n,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fC(e,n,"signInWithPassword",uK);case"emailLink":return hK(e,{email:this._email,oobCode:this._password});default:rc(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const a={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fC(e,a,"signUpPassword",cK);case"emailLink":return dK(e,{idToken:n,email:this._email,oobCode:this._password});default:rc(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yg(t,e){return Ux(t,"POST","/v1/accounts:signInWithIdp",rf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fK="http://localhost";class up extends bP{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new up(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):rc("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:h,...m}=n;if(!a||!h)return null;const v=new up(a,h);return v.idToken=m.idToken||void 0,v.accessToken=m.accessToken||void 0,v.secret=m.secret,v.nonce=m.nonce,v.pendingToken=m.pendingToken||null,v}_getIdTokenResponse(e){const n=this.buildRequest();return yg(e,n)}_linkToIdToken(e,n){const a=this.buildRequest();return a.idToken=n,yg(e,a)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,yg(e,n)}buildRequest(){const e={requestUri:fK,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Kg(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pK(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function mK(t){const e=wv(bv(t)).link,n=e?wv(bv(e)).deep_link_id:null,a=wv(bv(t)).deep_link_id;return(a?wv(bv(a)).link:null)||a||n||e||t}class TP{constructor(e){const n=wv(bv(e)),a=n.apiKey??null,h=n.oobCode??null,m=pK(n.mode??null);Li(a&&h&&m,"argument-error"),this.apiKey=a,this.operation=m,this.code=h,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=mK(e);try{return new TP(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(){this.providerId=Yg.PROVIDER_ID}static credential(e,n){return _x._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const a=TP.parseLink(n);return Li(a,"argument-error"),_x._fromEmailAndCode(e,a.code,a.tenantId)}}Yg.PROVIDER_ID="password";Yg.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Yg.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx extends EP{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wd extends jx{constructor(){super("facebook.com")}static credential(e){return up._fromParams({providerId:wd.PROVIDER_ID,signInMethod:wd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wd.credentialFromTaggedObject(e)}static credentialFromError(e){return wd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return wd.credential(e.oauthAccessToken)}catch{return null}}}wd.FACEBOOK_SIGN_IN_METHOD="facebook.com";wd.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eh extends jx{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return up._fromParams({providerId:eh.PROVIDER_ID,signInMethod:eh.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return eh.credentialFromTaggedObject(e)}static credentialFromError(e){return eh.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:a}=e;if(!n&&!a)return null;try{return eh.credential(n,a)}catch{return null}}}eh.GOOGLE_SIGN_IN_METHOD="google.com";eh.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd extends jx{constructor(){super("github.com")}static credential(e){return up._fromParams({providerId:bd.PROVIDER_ID,signInMethod:bd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bd.credentialFromTaggedObject(e)}static credentialFromError(e){return bd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bd.credential(e.oauthAccessToken)}catch{return null}}}bd.GITHUB_SIGN_IN_METHOD="github.com";bd.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td extends jx{constructor(){super("twitter.com")}static credential(e,n){return up._fromParams({providerId:Td.PROVIDER_ID,signInMethod:Td.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Td.credentialFromTaggedObject(e)}static credentialFromError(e){return Td.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:a}=e;if(!n||!a)return null;try{return Td.credential(n,a)}catch{return null}}}Td.TWITTER_SIGN_IN_METHOD="twitter.com";Td.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gK(t,e){return Ux(t,"POST","/v1/accounts:signUp",rf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hp{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,a,h=!1){const m=await Ec._fromIdTokenResponse(e,a,h),v=Sz(a);return new hp({user:m,providerId:v,_tokenResponse:a,operationType:n})}static async _forOperation(e,n,a){await e._updateTokensIfNecessary(a,!0);const h=Sz(a);return new hp({user:e,providerId:h,_tokenResponse:a,operationType:n})}}function Sz(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb extends Oc{constructor(e,n,a,h){super(n.code,n.message),this.operationType=a,this.user=h,Object.setPrototypeOf(this,Rb.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,n,a,h){return new Rb(e,n,a,h)}}function WV(t,e,n,a){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(m=>{throw m.code==="auth/multi-factor-auth-required"?Rb._fromErrorAndOperation(t,m,e,a):m})}async function _K(t,e,n=!1){const a=await gx(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return hp._forOperation(t,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yK(t,e,n=!1){const{auth:a}=t;if(tl(a.app))return Promise.reject(ch(a));const h="reauthenticate";try{const m=await gx(t,WV(a,h,e,t),n);Li(m.idToken,a,"internal-error");const v=xP(m.idToken);Li(v,a,"internal-error");const{sub:o}=v;return Li(t.uid===o,a,"user-mismatch"),hp._forOperation(t,h,m)}catch(m){throw(m==null?void 0:m.code)==="auth/user-not-found"&&rc(a,"user-mismatch"),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZV(t,e,n=!1){if(tl(t.app))return Promise.reject(ch(t));const a="signIn",h=await WV(t,a,e),m=await hp._fromIdTokenResponse(t,a,h);return n||await t._updateCurrentUser(m.user),m}async function vK(t,e){return ZV(of(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XV(t){const e=of(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function xK(t,e,n){if(tl(t.app))return Promise.reject(ch(t));const a=of(t),v=await fC(a,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",gK).catch(S=>{throw S.code==="auth/password-does-not-meet-requirements"&&XV(t),S}),o=await hp._fromIdTokenResponse(a,"signIn",v);return await a._updateCurrentUser(o.user),o}function wK(t,e,n){return tl(t.app)?Promise.reject(ch(t)):vK(bs(t),Yg.credential(e,n)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&XV(t),a})}function bK(t,e,n,a){return bs(t).onIdTokenChanged(e,n,a)}function TK(t,e,n){return bs(t).beforeAuthStateChanged(e,n)}function EK(t,e,n,a){return bs(t).onAuthStateChanged(e,n,a)}function IK(t){return bs(t).signOut()}const kb="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KV{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(kb,"1"),this.storage.removeItem(kb),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SK=1e3,AK=10;class YV extends KV{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=jV(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const a=this.storage.getItem(n),h=this.localCache[n];a!==h&&e(n,h,a)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((v,o,S)=>{this.notifyListeners(v,S)});return}const a=e.key;n?this.detachListener():this.stopPolling();const h=()=>{const v=this.storage.getItem(a);!n&&this.localCache[a]===v||this.notifyListeners(a,v)},m=this.storage.getItem(a);$X()&&m!==e.newValue&&e.newValue!==e.oldValue?setTimeout(h,AK):h()}notifyListeners(e,n){this.localCache[e]=n;const a=this.listeners[e];if(a)for(const h of Array.from(a))h(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:a}),!0)})},SK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}YV.type="LOCAL";const CK=YV;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QV extends KV{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}QV.type="SESSION";const JV=QV;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PK(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ET{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(h=>h.isListeningto(e));if(n)return n;const a=new ET(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:a,eventType:h,data:m}=n.data,v=this.handlersMap[h];if(!(v!=null&&v.size))return;n.ports[0].postMessage({status:"ack",eventId:a,eventType:h});const o=Array.from(v).map(async P=>P(n.origin,m)),S=await PK(o);n.ports[0].postMessage({status:"done",eventId:a,eventType:h,response:S})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ET.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IP(t="",e=10){let n="";for(let a=0;a<e;a++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RK{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,a=50){const h=typeof MessageChannel<"u"?new MessageChannel:null;if(!h)throw new Error("connection_unavailable");let m,v;return new Promise((o,S)=>{const P=IP("",20);h.port1.start();const N=setTimeout(()=>{S(new Error("unsupported_event"))},a);v={messageChannel:h,onMessage(V){const j=V;if(j.data.eventId===P)switch(j.data.status){case"ack":clearTimeout(N),m=setTimeout(()=>{S(new Error("timeout"))},3e3);break;case"done":clearTimeout(m),o(j.data.response);break;default:clearTimeout(N),clearTimeout(m),S(new Error("invalid_response"));break}}},this.handlers.add(v),h.port1.addEventListener("message",v.onMessage),this.target.postMessage({eventType:e,eventId:P,data:n},[h.port2])}).finally(()=>{v&&this.removeMessageHandler(v)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xu(){return window}function kK(t){xu().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function e5(){return typeof xu().WorkerGlobalScope<"u"&&typeof xu().importScripts=="function"}async function MK(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function DK(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function LK(){return e5()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5="firebaseLocalStorageDb",OK=1,Mb="firebaseLocalStorage",n5="fbase_key";class Gx{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function IT(t,e){return t.transaction([Mb],e?"readwrite":"readonly").objectStore(Mb)}function zK(){const t=indexedDB.deleteDatabase(t5);return new Gx(t).toPromise()}function pC(){const t=indexedDB.open(t5,OK);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const a=t.result;try{a.createObjectStore(Mb,{keyPath:n5})}catch(h){n(h)}}),t.addEventListener("success",async()=>{const a=t.result;a.objectStoreNames.contains(Mb)?e(a):(a.close(),await zK(),e(await pC()))})})}async function Az(t,e,n){const a=IT(t,!0).put({[n5]:e,value:n});return new Gx(a).toPromise()}async function FK(t,e){const n=IT(t,!1).get(e),a=await new Gx(n).toPromise();return a===void 0?null:a.value}function Cz(t,e){const n=IT(t,!0).delete(e);return new Gx(n).toPromise()}const NK=800,BK=3;class i5{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await pC(),this.db)}async _withRetries(e){let n=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(n++>BK)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return e5()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ET._getInstance(LK()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,a;if(this.activeServiceWorker=await MK(),!this.activeServiceWorker)return;this.sender=new RK(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(a=e[0])!=null&&a.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||DK()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await pC();return await Az(e,kb,"1"),await Cz(e,kb),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(a=>Az(a,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(a=>FK(a,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Cz(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(h=>{const m=IT(h,!1).getAll();return new Gx(m).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],a=new Set;if(e.length!==0)for(const{fbase_key:h,value:m}of e)a.add(h),JSON.stringify(this.localCache[h])!==JSON.stringify(m)&&(this.notifyListeners(h,m),n.push(h));for(const h of Object.keys(this.localCache))this.localCache[h]&&!a.has(h)&&(this.notifyListeners(h,null),n.push(h));return n}notifyListeners(e,n){this.localCache[e]=n;const a=this.listeners[e];if(a)for(const h of Array.from(a))h(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),NK)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}i5.type="LOCAL";const VK=i5;new Vx(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r5(t,e){return e?sh(e):(Li(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SP extends bP{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return yg(e,this._buildIdpRequest())}_linkToIdToken(e,n){return yg(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return yg(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function UK(t){return ZV(t.auth,new SP(t),t.bypassAuthState)}function jK(t){const{auth:e,user:n}=t;return Li(n,e,"internal-error"),yK(n,new SP(t),t.bypassAuthState)}async function GK(t){const{auth:e,user:n}=t;return Li(n,e,"internal-error"),_K(n,new SP(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s5{constructor(e,n,a,h,m=!1){this.auth=e,this.resolver=a,this.user=h,this.bypassAuthState=m,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:a,postBody:h,tenantId:m,error:v,type:o}=e;if(v){this.reject(v);return}const S={auth:this.auth,requestUri:n,sessionId:a,tenantId:m||void 0,postBody:h||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(S))}catch(P){this.reject(P)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return UK;case"linkViaPopup":case"linkViaRedirect":return GK;case"reauthViaPopup":case"reauthViaRedirect":return jK;default:rc(this.auth,"internal-error")}}resolve(e){yh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){yh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $K=new Vx(2e3,1e4);async function HK(t,e,n){if(tl(t.app))return Promise.reject(Cc(t,"operation-not-supported-in-this-environment"));const a=of(t);EX(t,e,EP);const h=r5(a,n);return new Yf(a,"signInViaPopup",e,h).executeNotNull()}class Yf extends s5{constructor(e,n,a,h,m){super(e,n,h,m),this.provider=a,this.authWindow=null,this.pollId=null,Yf.currentPopupAction&&Yf.currentPopupAction.cancel(),Yf.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Li(e,this.auth,"internal-error"),e}async onExecution(){yh(this.filter.length===1,"Popup operations only handle one event");const e=IP();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Cc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Cc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yf.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,a;if((a=(n=this.authWindow)==null?void 0:n.window)!=null&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Cc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,$K.get())};e()}}Yf.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qK="pendingRedirect",U1=new Map;class WK extends s5{constructor(e,n,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,a),this.eventId=null}async execute(){let e=U1.get(this.auth._key());if(!e){try{const a=await ZK(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(n){e=()=>Promise.reject(n)}U1.set(this.auth._key(),e)}return this.bypassAuthState||U1.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ZK(t,e){const n=YK(e),a=KK(t);if(!await a._isAvailable())return!1;const h=await a._get(n)==="true";return await a._remove(n),h}function XK(t,e){U1.set(t._key(),e)}function KK(t){return sh(t._redirectPersistence)}function YK(t){return V1(qK,t.config.apiKey,t.name)}async function QK(t,e,n=!1){if(tl(t.app))return Promise.reject(ch(t));const a=of(t),h=r5(a,e),v=await new WK(a,h,n).execute();return v&&!n&&(delete v.user._redirectEventId,await a._persistUserIfCurrent(v.user),await a._setRedirectUser(null,e)),v}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JK=10*60*1e3;class eY{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(n=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!tY(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var a;if(e.error&&!o5(e)){const h=((a=e.error.code)==null?void 0:a.split("auth/")[1])||"internal-error";n.onError(Cc(this.auth,h))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const a=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=JK&&this.cachedEventUids.clear(),this.cachedEventUids.has(Pz(e))}saveEventToCache(e){this.cachedEventUids.add(Pz(e)),this.lastProcessedEventTime=Date.now()}}function Pz(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function o5({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function tY(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return o5(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nY(t,e={}){return sf(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iY=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rY=/^https?/;async function sY(t){if(t.config.emulator)return;const{authorizedDomains:e}=await nY(t);for(const n of e)try{if(oY(n))return}catch{}rc(t,"unauthorized-domain")}function oY(t){const e=hC(),{protocol:n,hostname:a}=new URL(e);if(t.startsWith("chrome-extension://")){const v=new URL(t);return v.hostname===""&&a===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&v.hostname===a}if(!rY.test(n))return!1;if(iY.test(t))return a===t;const h=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+h+"|"+h+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aY=new Vx(3e4,6e4);function Rz(){const t=xu().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function lY(t){return new Promise((e,n)=>{var h,m,v;function a(){Rz(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Rz(),n(Cc(t,"network-request-failed"))},timeout:aY.get()})}if((m=(h=xu().gapi)==null?void 0:h.iframes)!=null&&m.Iframe)e(gapi.iframes.getContext());else if((v=xu().gapi)!=null&&v.load)a();else{const o=JX("iframefcb");return xu()[o]=()=>{gapi.load?a():n(Cc(t,"network-request-failed"))},$V(`${QX()}?onload=${o}`).catch(S=>n(S))}}).catch(e=>{throw j1=null,e})}let j1=null;function cY(t){return j1=j1||lY(t),j1}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uY=new Vx(5e3,15e3),hY="__/auth/iframe",dY="emulator/auth/iframe",fY={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pY=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function mY(t){const e=t.config;Li(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?vP(e,dY):`https://${t.config.authDomain}/${hY}`,a={apiKey:e.apiKey,appName:t.name,v:bp},h=pY.get(t.config.apiHost);h&&(a.eid=h);const m=t._getFrameworks();return m.length&&(a.fw=m.join(",")),`${n}?${Kg(a).slice(1)}`}async function gY(t){const e=await cY(t),n=xu().gapi;return Li(n,t,"internal-error"),e.open({where:document.body,url:mY(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:fY,dontclear:!0},a=>new Promise(async(h,m)=>{await a.restyle({setHideOnLeave:!1});const v=Cc(t,"network-request-failed"),o=xu().setTimeout(()=>{m(v)},uY.get());function S(){xu().clearTimeout(o),h(a)}a.ping(S).then(S,()=>{m(v)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Y={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},yY=500,vY=600,xY="_blank",wY="http://localhost";class kz{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function bY(t,e,n,a=yY,h=vY){const m=Math.max((window.screen.availHeight-h)/2,0).toString(),v=Math.max((window.screen.availWidth-a)/2,0).toString();let o="";const S={..._Y,width:a.toString(),height:h.toString(),top:m,left:v},P=ba().toLowerCase();n&&(o=FV(P)?xY:n),OV(P)&&(e=e||wY,S.scrollbars="yes");const N=Object.entries(S).reduce((j,[Q,oe])=>`${j}${Q}=${oe},`,"");if(GX(P)&&o!=="_self")return TY(e||"",o),new kz(null);const V=window.open(e||"",o,N);Li(V,t,"popup-blocked");try{V.focus()}catch{}return new kz(V)}function TY(t,e){const n=document.createElement("a");n.href=t,n.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EY="__/auth/handler",IY="emulator/auth/handler",SY=encodeURIComponent("fac");async function Mz(t,e,n,a,h,m){Li(t.config.authDomain,t,"auth-domain-config-required"),Li(t.config.apiKey,t,"invalid-api-key");const v={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:a,v:bp,eventId:h};if(e instanceof EP){e.setDefaultLanguage(t.languageCode),v.providerId=e.providerId||"",sC(e.getCustomParameters())||(v.customParameters=JSON.stringify(e.getCustomParameters()));for(const[N,V]of Object.entries({}))v[N]=V}if(e instanceof jx){const N=e.getScopes().filter(V=>V!=="");N.length>0&&(v.scopes=N.join(","))}t.tenantId&&(v.tid=t.tenantId);const o=v;for(const N of Object.keys(o))o[N]===void 0&&delete o[N];const S=await t._getAppCheckToken(),P=S?`#${SY}=${encodeURIComponent(S)}`:"";return`${AY(t)}?${Kg(o).slice(1)}${P}`}function AY({config:t}){return t.emulator?vP(t,IY):`https://${t.authDomain}/${EY}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CS="webStorageSupport";class CY{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=JV,this._completeRedirectFn=QK,this._overrideRedirectResult=XK}async _openPopup(e,n,a,h){var v;yh((v=this.eventManagers[e._key()])==null?void 0:v.manager,"_initialize() not called before _openPopup()");const m=await Mz(e,n,a,hC(),h);return bY(e,m,IP())}async _openRedirect(e,n,a,h){await this._originValidation(e);const m=await Mz(e,n,a,hC(),h);return kK(m),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:h,promise:m}=this.eventManagers[n];return h?Promise.resolve(h):(yh(m,"If manager is not set, promise should be"),m)}const a=this.initAndGetManager(e);return this.eventManagers[n]={promise:a},a.catch(()=>{delete this.eventManagers[n]}),a}async initAndGetManager(e){const n=await gY(e),a=new eY(e);return n.register("authEvent",h=>(Li(h==null?void 0:h.authEvent,e,"invalid-auth-event"),{status:a.onEvent(h.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=n,a}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(CS,{type:CS},h=>{var v;const m=(v=h==null?void 0:h[0])==null?void 0:v[CS];m!==void 0&&n(!!m),rc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=sY(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return jV()||zV()||wP()}}const PY=CY;var Dz="@firebase/auth",Lz="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RY{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Li(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kY(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function MY(t){kl(new ul("auth",(e,{options:n})=>{const a=e.getProvider("app").getImmediate(),h=e.getProvider("heartbeat"),m=e.getProvider("app-check-internal"),{apiKey:v,authDomain:o}=a.options;Li(v&&!v.includes(":"),"invalid-api-key",{appName:a.name});const S={apiKey:v,authDomain:o,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:GV(t)},P=new XX(a,h,m,S);return sK(P,n),P},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,a)=>{e.getProvider("auth-internal").initialize()})),kl(new ul("auth-internal",e=>{const n=of(e.getProvider("auth").getImmediate());return(a=>new RY(a))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),va(Dz,Lz,kY(t)),va(Dz,Lz,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DY=5*60,LY=_V("authIdTokenMaxAge")||DY;let Oz=null;const OY=t=>async e=>{const n=e&&await e.getIdTokenResult(),a=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(a&&a>LY)return;const h=n==null?void 0:n.token;Oz!==h&&(Oz=h,await fetch(t,{method:h?"POST":"DELETE",headers:h?{Authorization:`Bearer ${h}`}:{}}))};function zY(t=Bx()){const e=Ih(t,"auth");if(e.isInitialized())return e.getImmediate();const n=rK(t,{popupRedirectResolver:PY,persistence:[VK,CK,JV]}),a=_V("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const m=new URL(a,location.origin);if(location.origin===m.origin){const v=OY(m.toString());TK(n,v,()=>v(n.currentUser)),bK(n,o=>v(o))}}const h=pV("auth");return h&&oK(n,`http://${h}`),n}function FY(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}KX({loadJS(t){return new Promise((e,n)=>{const a=document.createElement("script");a.setAttribute("src",t),a.onload=e,a.onerror=h=>{const m=Cc("internal-error");m.customData=h,n(m)},a.type="text/javascript",a.charset="UTF-8",FY().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});MY("Browser");var zz=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Fd,a5;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Pe,xe){function ke(){}ke.prototype=xe.prototype,Pe.D=xe.prototype,Pe.prototype=new ke,Pe.prototype.constructor=Pe,Pe.C=function(Ve,De,Qe){for(var Be=Array(arguments.length-2),Hn=2;Hn<arguments.length;Hn++)Be[Hn-2]=arguments[Hn];return xe.prototype[De].apply(Ve,Be)}}function n(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,n),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function h(Pe,xe,ke){ke||(ke=0);var Ve=Array(16);if(typeof xe=="string")for(var De=0;16>De;++De)Ve[De]=xe.charCodeAt(ke++)|xe.charCodeAt(ke++)<<8|xe.charCodeAt(ke++)<<16|xe.charCodeAt(ke++)<<24;else for(De=0;16>De;++De)Ve[De]=xe[ke++]|xe[ke++]<<8|xe[ke++]<<16|xe[ke++]<<24;xe=Pe.g[0],ke=Pe.g[1],De=Pe.g[2];var Qe=Pe.g[3],Be=xe+(Qe^ke&(De^Qe))+Ve[0]+3614090360&4294967295;xe=ke+(Be<<7&4294967295|Be>>>25),Be=Qe+(De^xe&(ke^De))+Ve[1]+3905402710&4294967295,Qe=xe+(Be<<12&4294967295|Be>>>20),Be=De+(ke^Qe&(xe^ke))+Ve[2]+606105819&4294967295,De=Qe+(Be<<17&4294967295|Be>>>15),Be=ke+(xe^De&(Qe^xe))+Ve[3]+3250441966&4294967295,ke=De+(Be<<22&4294967295|Be>>>10),Be=xe+(Qe^ke&(De^Qe))+Ve[4]+4118548399&4294967295,xe=ke+(Be<<7&4294967295|Be>>>25),Be=Qe+(De^xe&(ke^De))+Ve[5]+1200080426&4294967295,Qe=xe+(Be<<12&4294967295|Be>>>20),Be=De+(ke^Qe&(xe^ke))+Ve[6]+2821735955&4294967295,De=Qe+(Be<<17&4294967295|Be>>>15),Be=ke+(xe^De&(Qe^xe))+Ve[7]+4249261313&4294967295,ke=De+(Be<<22&4294967295|Be>>>10),Be=xe+(Qe^ke&(De^Qe))+Ve[8]+1770035416&4294967295,xe=ke+(Be<<7&4294967295|Be>>>25),Be=Qe+(De^xe&(ke^De))+Ve[9]+2336552879&4294967295,Qe=xe+(Be<<12&4294967295|Be>>>20),Be=De+(ke^Qe&(xe^ke))+Ve[10]+4294925233&4294967295,De=Qe+(Be<<17&4294967295|Be>>>15),Be=ke+(xe^De&(Qe^xe))+Ve[11]+2304563134&4294967295,ke=De+(Be<<22&4294967295|Be>>>10),Be=xe+(Qe^ke&(De^Qe))+Ve[12]+1804603682&4294967295,xe=ke+(Be<<7&4294967295|Be>>>25),Be=Qe+(De^xe&(ke^De))+Ve[13]+4254626195&4294967295,Qe=xe+(Be<<12&4294967295|Be>>>20),Be=De+(ke^Qe&(xe^ke))+Ve[14]+2792965006&4294967295,De=Qe+(Be<<17&4294967295|Be>>>15),Be=ke+(xe^De&(Qe^xe))+Ve[15]+1236535329&4294967295,ke=De+(Be<<22&4294967295|Be>>>10),Be=xe+(De^Qe&(ke^De))+Ve[1]+4129170786&4294967295,xe=ke+(Be<<5&4294967295|Be>>>27),Be=Qe+(ke^De&(xe^ke))+Ve[6]+3225465664&4294967295,Qe=xe+(Be<<9&4294967295|Be>>>23),Be=De+(xe^ke&(Qe^xe))+Ve[11]+643717713&4294967295,De=Qe+(Be<<14&4294967295|Be>>>18),Be=ke+(Qe^xe&(De^Qe))+Ve[0]+3921069994&4294967295,ke=De+(Be<<20&4294967295|Be>>>12),Be=xe+(De^Qe&(ke^De))+Ve[5]+3593408605&4294967295,xe=ke+(Be<<5&4294967295|Be>>>27),Be=Qe+(ke^De&(xe^ke))+Ve[10]+38016083&4294967295,Qe=xe+(Be<<9&4294967295|Be>>>23),Be=De+(xe^ke&(Qe^xe))+Ve[15]+3634488961&4294967295,De=Qe+(Be<<14&4294967295|Be>>>18),Be=ke+(Qe^xe&(De^Qe))+Ve[4]+3889429448&4294967295,ke=De+(Be<<20&4294967295|Be>>>12),Be=xe+(De^Qe&(ke^De))+Ve[9]+568446438&4294967295,xe=ke+(Be<<5&4294967295|Be>>>27),Be=Qe+(ke^De&(xe^ke))+Ve[14]+3275163606&4294967295,Qe=xe+(Be<<9&4294967295|Be>>>23),Be=De+(xe^ke&(Qe^xe))+Ve[3]+4107603335&4294967295,De=Qe+(Be<<14&4294967295|Be>>>18),Be=ke+(Qe^xe&(De^Qe))+Ve[8]+1163531501&4294967295,ke=De+(Be<<20&4294967295|Be>>>12),Be=xe+(De^Qe&(ke^De))+Ve[13]+2850285829&4294967295,xe=ke+(Be<<5&4294967295|Be>>>27),Be=Qe+(ke^De&(xe^ke))+Ve[2]+4243563512&4294967295,Qe=xe+(Be<<9&4294967295|Be>>>23),Be=De+(xe^ke&(Qe^xe))+Ve[7]+1735328473&4294967295,De=Qe+(Be<<14&4294967295|Be>>>18),Be=ke+(Qe^xe&(De^Qe))+Ve[12]+2368359562&4294967295,ke=De+(Be<<20&4294967295|Be>>>12),Be=xe+(ke^De^Qe)+Ve[5]+4294588738&4294967295,xe=ke+(Be<<4&4294967295|Be>>>28),Be=Qe+(xe^ke^De)+Ve[8]+2272392833&4294967295,Qe=xe+(Be<<11&4294967295|Be>>>21),Be=De+(Qe^xe^ke)+Ve[11]+1839030562&4294967295,De=Qe+(Be<<16&4294967295|Be>>>16),Be=ke+(De^Qe^xe)+Ve[14]+4259657740&4294967295,ke=De+(Be<<23&4294967295|Be>>>9),Be=xe+(ke^De^Qe)+Ve[1]+2763975236&4294967295,xe=ke+(Be<<4&4294967295|Be>>>28),Be=Qe+(xe^ke^De)+Ve[4]+1272893353&4294967295,Qe=xe+(Be<<11&4294967295|Be>>>21),Be=De+(Qe^xe^ke)+Ve[7]+4139469664&4294967295,De=Qe+(Be<<16&4294967295|Be>>>16),Be=ke+(De^Qe^xe)+Ve[10]+3200236656&4294967295,ke=De+(Be<<23&4294967295|Be>>>9),Be=xe+(ke^De^Qe)+Ve[13]+681279174&4294967295,xe=ke+(Be<<4&4294967295|Be>>>28),Be=Qe+(xe^ke^De)+Ve[0]+3936430074&4294967295,Qe=xe+(Be<<11&4294967295|Be>>>21),Be=De+(Qe^xe^ke)+Ve[3]+3572445317&4294967295,De=Qe+(Be<<16&4294967295|Be>>>16),Be=ke+(De^Qe^xe)+Ve[6]+76029189&4294967295,ke=De+(Be<<23&4294967295|Be>>>9),Be=xe+(ke^De^Qe)+Ve[9]+3654602809&4294967295,xe=ke+(Be<<4&4294967295|Be>>>28),Be=Qe+(xe^ke^De)+Ve[12]+3873151461&4294967295,Qe=xe+(Be<<11&4294967295|Be>>>21),Be=De+(Qe^xe^ke)+Ve[15]+530742520&4294967295,De=Qe+(Be<<16&4294967295|Be>>>16),Be=ke+(De^Qe^xe)+Ve[2]+3299628645&4294967295,ke=De+(Be<<23&4294967295|Be>>>9),Be=xe+(De^(ke|~Qe))+Ve[0]+4096336452&4294967295,xe=ke+(Be<<6&4294967295|Be>>>26),Be=Qe+(ke^(xe|~De))+Ve[7]+1126891415&4294967295,Qe=xe+(Be<<10&4294967295|Be>>>22),Be=De+(xe^(Qe|~ke))+Ve[14]+2878612391&4294967295,De=Qe+(Be<<15&4294967295|Be>>>17),Be=ke+(Qe^(De|~xe))+Ve[5]+4237533241&4294967295,ke=De+(Be<<21&4294967295|Be>>>11),Be=xe+(De^(ke|~Qe))+Ve[12]+1700485571&4294967295,xe=ke+(Be<<6&4294967295|Be>>>26),Be=Qe+(ke^(xe|~De))+Ve[3]+2399980690&4294967295,Qe=xe+(Be<<10&4294967295|Be>>>22),Be=De+(xe^(Qe|~ke))+Ve[10]+4293915773&4294967295,De=Qe+(Be<<15&4294967295|Be>>>17),Be=ke+(Qe^(De|~xe))+Ve[1]+2240044497&4294967295,ke=De+(Be<<21&4294967295|Be>>>11),Be=xe+(De^(ke|~Qe))+Ve[8]+1873313359&4294967295,xe=ke+(Be<<6&4294967295|Be>>>26),Be=Qe+(ke^(xe|~De))+Ve[15]+4264355552&4294967295,Qe=xe+(Be<<10&4294967295|Be>>>22),Be=De+(xe^(Qe|~ke))+Ve[6]+2734768916&4294967295,De=Qe+(Be<<15&4294967295|Be>>>17),Be=ke+(Qe^(De|~xe))+Ve[13]+1309151649&4294967295,ke=De+(Be<<21&4294967295|Be>>>11),Be=xe+(De^(ke|~Qe))+Ve[4]+4149444226&4294967295,xe=ke+(Be<<6&4294967295|Be>>>26),Be=Qe+(ke^(xe|~De))+Ve[11]+3174756917&4294967295,Qe=xe+(Be<<10&4294967295|Be>>>22),Be=De+(xe^(Qe|~ke))+Ve[2]+718787259&4294967295,De=Qe+(Be<<15&4294967295|Be>>>17),Be=ke+(Qe^(De|~xe))+Ve[9]+3951481745&4294967295,Pe.g[0]=Pe.g[0]+xe&4294967295,Pe.g[1]=Pe.g[1]+(De+(Be<<21&4294967295|Be>>>11))&4294967295,Pe.g[2]=Pe.g[2]+De&4294967295,Pe.g[3]=Pe.g[3]+Qe&4294967295}a.prototype.u=function(Pe,xe){xe===void 0&&(xe=Pe.length);for(var ke=xe-this.blockSize,Ve=this.B,De=this.h,Qe=0;Qe<xe;){if(De==0)for(;Qe<=ke;)h(this,Pe,Qe),Qe+=this.blockSize;if(typeof Pe=="string"){for(;Qe<xe;)if(Ve[De++]=Pe.charCodeAt(Qe++),De==this.blockSize){h(this,Ve),De=0;break}}else for(;Qe<xe;)if(Ve[De++]=Pe[Qe++],De==this.blockSize){h(this,Ve),De=0;break}}this.h=De,this.o+=xe},a.prototype.v=function(){var Pe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Pe[0]=128;for(var xe=1;xe<Pe.length-8;++xe)Pe[xe]=0;var ke=8*this.o;for(xe=Pe.length-8;xe<Pe.length;++xe)Pe[xe]=ke&255,ke/=256;for(this.u(Pe),Pe=Array(16),xe=ke=0;4>xe;++xe)for(var Ve=0;32>Ve;Ve+=8)Pe[ke++]=this.g[xe]>>>Ve&255;return Pe};function m(Pe,xe){var ke=o;return Object.prototype.hasOwnProperty.call(ke,Pe)?ke[Pe]:ke[Pe]=xe(Pe)}function v(Pe,xe){this.h=xe;for(var ke=[],Ve=!0,De=Pe.length-1;0<=De;De--){var Qe=Pe[De]|0;Ve&&Qe==xe||(ke[De]=Qe,Ve=!1)}this.g=ke}var o={};function S(Pe){return-128<=Pe&&128>Pe?m(Pe,function(xe){return new v([xe|0],0>xe?-1:0)}):new v([Pe|0],0>Pe?-1:0)}function P(Pe){if(isNaN(Pe)||!isFinite(Pe))return V;if(0>Pe)return Ue(P(-Pe));for(var xe=[],ke=1,Ve=0;Pe>=ke;Ve++)xe[Ve]=Pe/ke|0,ke*=4294967296;return new v(xe,0)}function N(Pe,xe){if(Pe.length==0)throw Error("number format error: empty string");if(xe=xe||10,2>xe||36<xe)throw Error("radix out of range: "+xe);if(Pe.charAt(0)=="-")return Ue(N(Pe.substring(1),xe));if(0<=Pe.indexOf("-"))throw Error('number format error: interior "-" character');for(var ke=P(Math.pow(xe,8)),Ve=V,De=0;De<Pe.length;De+=8){var Qe=Math.min(8,Pe.length-De),Be=parseInt(Pe.substring(De,De+Qe),xe);8>Qe?(Qe=P(Math.pow(xe,Qe)),Ve=Ve.j(Qe).add(P(Be))):(Ve=Ve.j(ke),Ve=Ve.add(P(Be)))}return Ve}var V=S(0),j=S(1),Q=S(16777216);t=v.prototype,t.m=function(){if(me(this))return-Ue(this).m();for(var Pe=0,xe=1,ke=0;ke<this.g.length;ke++){var Ve=this.i(ke);Pe+=(0<=Ve?Ve:4294967296+Ve)*xe,xe*=4294967296}return Pe},t.toString=function(Pe){if(Pe=Pe||10,2>Pe||36<Pe)throw Error("radix out of range: "+Pe);if(oe(this))return"0";if(me(this))return"-"+Ue(this).toString(Pe);for(var xe=P(Math.pow(Pe,6)),ke=this,Ve="";;){var De=_t(ke,xe).g;ke=de(ke,De.j(xe));var Qe=((0<ke.g.length?ke.g[0]:ke.h)>>>0).toString(Pe);if(ke=De,oe(ke))return Qe+Ve;for(;6>Qe.length;)Qe="0"+Qe;Ve=Qe+Ve}},t.i=function(Pe){return 0>Pe?0:Pe<this.g.length?this.g[Pe]:this.h};function oe(Pe){if(Pe.h!=0)return!1;for(var xe=0;xe<Pe.g.length;xe++)if(Pe.g[xe]!=0)return!1;return!0}function me(Pe){return Pe.h==-1}t.l=function(Pe){return Pe=de(this,Pe),me(Pe)?-1:oe(Pe)?0:1};function Ue(Pe){for(var xe=Pe.g.length,ke=[],Ve=0;Ve<xe;Ve++)ke[Ve]=~Pe.g[Ve];return new v(ke,~Pe.h).add(j)}t.abs=function(){return me(this)?Ue(this):this},t.add=function(Pe){for(var xe=Math.max(this.g.length,Pe.g.length),ke=[],Ve=0,De=0;De<=xe;De++){var Qe=Ve+(this.i(De)&65535)+(Pe.i(De)&65535),Be=(Qe>>>16)+(this.i(De)>>>16)+(Pe.i(De)>>>16);Ve=Be>>>16,Qe&=65535,Be&=65535,ke[De]=Be<<16|Qe}return new v(ke,ke[ke.length-1]&-2147483648?-1:0)};function de(Pe,xe){return Pe.add(Ue(xe))}t.j=function(Pe){if(oe(this)||oe(Pe))return V;if(me(this))return me(Pe)?Ue(this).j(Ue(Pe)):Ue(Ue(this).j(Pe));if(me(Pe))return Ue(this.j(Ue(Pe)));if(0>this.l(Q)&&0>Pe.l(Q))return P(this.m()*Pe.m());for(var xe=this.g.length+Pe.g.length,ke=[],Ve=0;Ve<2*xe;Ve++)ke[Ve]=0;for(Ve=0;Ve<this.g.length;Ve++)for(var De=0;De<Pe.g.length;De++){var Qe=this.i(Ve)>>>16,Be=this.i(Ve)&65535,Hn=Pe.i(De)>>>16,Ln=Pe.i(De)&65535;ke[2*Ve+2*De]+=Be*Ln,ge(ke,2*Ve+2*De),ke[2*Ve+2*De+1]+=Qe*Ln,ge(ke,2*Ve+2*De+1),ke[2*Ve+2*De+1]+=Be*Hn,ge(ke,2*Ve+2*De+1),ke[2*Ve+2*De+2]+=Qe*Hn,ge(ke,2*Ve+2*De+2)}for(Ve=0;Ve<xe;Ve++)ke[Ve]=ke[2*Ve+1]<<16|ke[2*Ve];for(Ve=xe;Ve<2*xe;Ve++)ke[Ve]=0;return new v(ke,0)};function ge(Pe,xe){for(;(Pe[xe]&65535)!=Pe[xe];)Pe[xe+1]+=Pe[xe]>>>16,Pe[xe]&=65535,xe++}function Re(Pe,xe){this.g=Pe,this.h=xe}function _t(Pe,xe){if(oe(xe))throw Error("division by zero");if(oe(Pe))return new Re(V,V);if(me(Pe))return xe=_t(Ue(Pe),xe),new Re(Ue(xe.g),Ue(xe.h));if(me(xe))return xe=_t(Pe,Ue(xe)),new Re(Ue(xe.g),xe.h);if(30<Pe.g.length){if(me(Pe)||me(xe))throw Error("slowDivide_ only works with positive integers.");for(var ke=j,Ve=xe;0>=Ve.l(Pe);)ke=ct(ke),Ve=ct(Ve);var De=nt(ke,1),Qe=nt(Ve,1);for(Ve=nt(Ve,2),ke=nt(ke,2);!oe(Ve);){var Be=Qe.add(Ve);0>=Be.l(Pe)&&(De=De.add(ke),Qe=Be),Ve=nt(Ve,1),ke=nt(ke,1)}return xe=de(Pe,De.j(xe)),new Re(De,xe)}for(De=V;0<=Pe.l(xe);){for(ke=Math.max(1,Math.floor(Pe.m()/xe.m())),Ve=Math.ceil(Math.log(ke)/Math.LN2),Ve=48>=Ve?1:Math.pow(2,Ve-48),Qe=P(ke),Be=Qe.j(xe);me(Be)||0<Be.l(Pe);)ke-=Ve,Qe=P(ke),Be=Qe.j(xe);oe(Qe)&&(Qe=j),De=De.add(Qe),Pe=de(Pe,Be)}return new Re(De,Pe)}t.A=function(Pe){return _t(this,Pe).h},t.and=function(Pe){for(var xe=Math.max(this.g.length,Pe.g.length),ke=[],Ve=0;Ve<xe;Ve++)ke[Ve]=this.i(Ve)&Pe.i(Ve);return new v(ke,this.h&Pe.h)},t.or=function(Pe){for(var xe=Math.max(this.g.length,Pe.g.length),ke=[],Ve=0;Ve<xe;Ve++)ke[Ve]=this.i(Ve)|Pe.i(Ve);return new v(ke,this.h|Pe.h)},t.xor=function(Pe){for(var xe=Math.max(this.g.length,Pe.g.length),ke=[],Ve=0;Ve<xe;Ve++)ke[Ve]=this.i(Ve)^Pe.i(Ve);return new v(ke,this.h^Pe.h)};function ct(Pe){for(var xe=Pe.g.length+1,ke=[],Ve=0;Ve<xe;Ve++)ke[Ve]=Pe.i(Ve)<<1|Pe.i(Ve-1)>>>31;return new v(ke,Pe.h)}function nt(Pe,xe){var ke=xe>>5;xe%=32;for(var Ve=Pe.g.length-ke,De=[],Qe=0;Qe<Ve;Qe++)De[Qe]=0<xe?Pe.i(Qe+ke)>>>xe|Pe.i(Qe+ke+1)<<32-xe:Pe.i(Qe+ke);return new v(De,Pe.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,a5=a,v.prototype.add=v.prototype.add,v.prototype.multiply=v.prototype.j,v.prototype.modulo=v.prototype.A,v.prototype.compare=v.prototype.l,v.prototype.toNumber=v.prototype.m,v.prototype.toString=v.prototype.toString,v.prototype.getBits=v.prototype.i,v.fromNumber=P,v.fromString=N,Fd=v}).apply(typeof zz<"u"?zz:typeof self<"u"?self:typeof window<"u"?window:{});var p1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var l5,Tv,c5,G1,mC,u5,h5,d5;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(k,W,ee){return k==Array.prototype||k==Object.prototype||(k[W]=ee.value),k};function n(k){k=[typeof globalThis=="object"&&globalThis,k,typeof window=="object"&&window,typeof self=="object"&&self,typeof p1=="object"&&p1];for(var W=0;W<k.length;++W){var ee=k[W];if(ee&&ee.Math==Math)return ee}throw Error("Cannot find global object")}var a=n(this);function h(k,W){if(W)e:{var ee=a;k=k.split(".");for(var Ae=0;Ae<k.length-1;Ae++){var vt=k[Ae];if(!(vt in ee))break e;ee=ee[vt]}k=k[k.length-1],Ae=ee[k],W=W(Ae),W!=Ae&&W!=null&&e(ee,k,{configurable:!0,writable:!0,value:W})}}function m(k,W){k instanceof String&&(k+="");var ee=0,Ae=!1,vt={next:function(){if(!Ae&&ee<k.length){var Ot=ee++;return{value:W(Ot,k[Ot]),done:!1}}return Ae=!0,{done:!0,value:void 0}}};return vt[Symbol.iterator]=function(){return vt},vt}h("Array.prototype.values",function(k){return k||function(){return m(this,function(W,ee){return ee})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var v=v||{},o=this||self;function S(k){var W=typeof k;return W=W!="object"?W:k?Array.isArray(k)?"array":W:"null",W=="array"||W=="object"&&typeof k.length=="number"}function P(k){var W=typeof k;return W=="object"&&k!=null||W=="function"}function N(k,W,ee){return k.call.apply(k.bind,arguments)}function V(k,W,ee){if(!k)throw Error();if(2<arguments.length){var Ae=Array.prototype.slice.call(arguments,2);return function(){var vt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(vt,Ae),k.apply(W,vt)}}return function(){return k.apply(W,arguments)}}function j(k,W,ee){return j=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?N:V,j.apply(null,arguments)}function Q(k,W){var ee=Array.prototype.slice.call(arguments,1);return function(){var Ae=ee.slice();return Ae.push.apply(Ae,arguments),k.apply(this,Ae)}}function oe(k,W){function ee(){}ee.prototype=W.prototype,k.aa=W.prototype,k.prototype=new ee,k.prototype.constructor=k,k.Qb=function(Ae,vt,Ot){for(var xn=Array(arguments.length-2),Gi=2;Gi<arguments.length;Gi++)xn[Gi-2]=arguments[Gi];return W.prototype[vt].apply(Ae,xn)}}function me(k){const W=k.length;if(0<W){const ee=Array(W);for(let Ae=0;Ae<W;Ae++)ee[Ae]=k[Ae];return ee}return[]}function Ue(k,W){for(let ee=1;ee<arguments.length;ee++){const Ae=arguments[ee];if(S(Ae)){const vt=k.length||0,Ot=Ae.length||0;k.length=vt+Ot;for(let xn=0;xn<Ot;xn++)k[vt+xn]=Ae[xn]}else k.push(Ae)}}class de{constructor(W,ee){this.i=W,this.j=ee,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function ge(k){return/^[\s\xa0]*$/.test(k)}function Re(){var k=o.navigator;return k&&(k=k.userAgent)?k:""}function _t(k){return _t[" "](k),k}_t[" "]=function(){};var ct=Re().indexOf("Gecko")!=-1&&!(Re().toLowerCase().indexOf("webkit")!=-1&&Re().indexOf("Edge")==-1)&&!(Re().indexOf("Trident")!=-1||Re().indexOf("MSIE")!=-1)&&Re().indexOf("Edge")==-1;function nt(k,W,ee){for(const Ae in k)W.call(ee,k[Ae],Ae,k)}function Pe(k,W){for(const ee in k)W.call(void 0,k[ee],ee,k)}function xe(k){const W={};for(const ee in k)W[ee]=k[ee];return W}const ke="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ve(k,W){let ee,Ae;for(let vt=1;vt<arguments.length;vt++){Ae=arguments[vt];for(ee in Ae)k[ee]=Ae[ee];for(let Ot=0;Ot<ke.length;Ot++)ee=ke[Ot],Object.prototype.hasOwnProperty.call(Ae,ee)&&(k[ee]=Ae[ee])}}function De(k){var W=1;k=k.split(":");const ee=[];for(;0<W&&k.length;)ee.push(k.shift()),W--;return k.length&&ee.push(k.join(":")),ee}function Qe(k){o.setTimeout(()=>{throw k},0)}function Be(){var k=Vn;let W=null;return k.g&&(W=k.g,k.g=k.g.next,k.g||(k.h=null),W.next=null),W}class Hn{constructor(){this.h=this.g=null}add(W,ee){const Ae=Ln.get();Ae.set(W,ee),this.h?this.h.next=Ae:this.g=Ae,this.h=Ae}}var Ln=new de(()=>new ii,k=>k.reset());class ii{constructor(){this.next=this.g=this.h=null}set(W,ee){this.h=W,this.g=ee,this.next=null}reset(){this.next=this.g=this.h=null}}let Ii,vn=!1,Vn=new Hn,je=()=>{const k=o.Promise.resolve(void 0);Ii=()=>{k.then(Pn)}};var Pn=()=>{for(var k;k=Be();){try{k.h.call(k.g)}catch(ee){Qe(ee)}var W=Ln;W.j(k),100>W.h&&(W.h++,k.next=W.g,W.g=k)}vn=!1};function oi(){this.s=this.s,this.C=this.C}oi.prototype.s=!1,oi.prototype.ma=function(){this.s||(this.s=!0,this.N())},oi.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function et(k,W){this.type=k,this.g=this.target=W,this.defaultPrevented=!1}et.prototype.h=function(){this.defaultPrevented=!0};var Xr=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var k=!1,W=Object.defineProperty({},"passive",{get:function(){k=!0}});try{const ee=()=>{};o.addEventListener("test",ee,W),o.removeEventListener("test",ee,W)}catch{}return k}();function Kr(k,W){if(et.call(this,k?k.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,k){var ee=this.type=k.type,Ae=k.changedTouches&&k.changedTouches.length?k.changedTouches[0]:null;if(this.target=k.target||k.srcElement,this.g=W,W=k.relatedTarget){if(ct){e:{try{_t(W.nodeName);var vt=!0;break e}catch{}vt=!1}vt||(W=null)}}else ee=="mouseover"?W=k.fromElement:ee=="mouseout"&&(W=k.toElement);this.relatedTarget=W,Ae?(this.clientX=Ae.clientX!==void 0?Ae.clientX:Ae.pageX,this.clientY=Ae.clientY!==void 0?Ae.clientY:Ae.pageY,this.screenX=Ae.screenX||0,this.screenY=Ae.screenY||0):(this.clientX=k.clientX!==void 0?k.clientX:k.pageX,this.clientY=k.clientY!==void 0?k.clientY:k.pageY,this.screenX=k.screenX||0,this.screenY=k.screenY||0),this.button=k.button,this.key=k.key||"",this.ctrlKey=k.ctrlKey,this.altKey=k.altKey,this.shiftKey=k.shiftKey,this.metaKey=k.metaKey,this.pointerId=k.pointerId||0,this.pointerType=typeof k.pointerType=="string"?k.pointerType:qn[k.pointerType]||"",this.state=k.state,this.i=k,k.defaultPrevented&&Kr.aa.h.call(this)}}oe(Kr,et);var qn={2:"touch",3:"pen",4:"mouse"};Kr.prototype.h=function(){Kr.aa.h.call(this);var k=this.i;k.preventDefault?k.preventDefault():k.returnValue=!1};var zi="closure_listenable_"+(1e6*Math.random()|0),ar=0;function rs(k,W,ee,Ae,vt){this.listener=k,this.proxy=null,this.src=W,this.type=ee,this.capture=!!Ae,this.ha=vt,this.key=++ar,this.da=this.fa=!1}function Wi(k){k.da=!0,k.listener=null,k.proxy=null,k.src=null,k.ha=null}function $s(k){this.src=k,this.g={},this.h=0}$s.prototype.add=function(k,W,ee,Ae,vt){var Ot=k.toString();k=this.g[Ot],k||(k=this.g[Ot]=[],this.h++);var xn=Ea(k,W,Ae,vt);return-1<xn?(W=k[xn],ee||(W.fa=!1)):(W=new rs(W,this.src,Ot,!!Ae,vt),W.fa=ee,k.push(W)),W};function Po(k,W){var ee=W.type;if(ee in k.g){var Ae=k.g[ee],vt=Array.prototype.indexOf.call(Ae,W,void 0),Ot;(Ot=0<=vt)&&Array.prototype.splice.call(Ae,vt,1),Ot&&(Wi(W),k.g[ee].length==0&&(delete k.g[ee],k.h--))}}function Ea(k,W,ee,Ae){for(var vt=0;vt<k.length;++vt){var Ot=k[vt];if(!Ot.da&&Ot.listener==W&&Ot.capture==!!ee&&Ot.ha==Ae)return vt}return-1}var Hs="closure_lm_"+(1e6*Math.random()|0),Vi={};function Ts(k,W,ee,Ae,vt){if(Array.isArray(W)){for(var Ot=0;Ot<W.length;Ot++)Ts(k,W[Ot],ee,Ae,vt);return null}return ee=ra(ee),k&&k[zi]?k.K(W,ee,P(Ae)?!!Ae.capture:!1,vt):Ro(k,W,ee,!1,Ae,vt)}function Ro(k,W,ee,Ae,vt,Ot){if(!W)throw Error("Invalid event type");var xn=P(vt)?!!vt.capture:!!vt,Gi=io(k);if(Gi||(k[Hs]=Gi=new $s(k)),ee=Gi.add(W,ee,Ae,xn,Ot),ee.proxy)return ee;if(Ae=ia(),ee.proxy=Ae,Ae.src=k,Ae.listener=ee,k.addEventListener)Xr||(vt=xn),vt===void 0&&(vt=!1),k.addEventListener(W.toString(),Ae,vt);else if(k.attachEvent)k.attachEvent(Es(W.toString()),Ae);else if(k.addListener&&k.removeListener)k.addListener(Ae);else throw Error("addEventListener and attachEvent are unavailable.");return ee}function ia(){function k(ee){return W.call(k.src,k.listener,ee)}const W=ko;return k}function Qs(k,W,ee,Ae,vt){if(Array.isArray(W))for(var Ot=0;Ot<W.length;Ot++)Qs(k,W[Ot],ee,Ae,vt);else Ae=P(Ae)?!!Ae.capture:!!Ae,ee=ra(ee),k&&k[zi]?(k=k.i,W=String(W).toString(),W in k.g&&(Ot=k.g[W],ee=Ea(Ot,ee,Ae,vt),-1<ee&&(Wi(Ot[ee]),Array.prototype.splice.call(Ot,ee,1),Ot.length==0&&(delete k.g[W],k.h--)))):k&&(k=io(k))&&(W=k.g[W.toString()],k=-1,W&&(k=Ea(W,ee,Ae,vt)),(ee=-1<k?W[k]:null)&&ds(ee))}function ds(k){if(typeof k!="number"&&k&&!k.da){var W=k.src;if(W&&W[zi])Po(W.i,k);else{var ee=k.type,Ae=k.proxy;W.removeEventListener?W.removeEventListener(ee,Ae,k.capture):W.detachEvent?W.detachEvent(Es(ee),Ae):W.addListener&&W.removeListener&&W.removeListener(Ae),(ee=io(W))?(Po(ee,k),ee.h==0&&(ee.src=null,W[Hs]=null)):Wi(k)}}}function Es(k){return k in Vi?Vi[k]:Vi[k]="on"+k}function ko(k,W){if(k.da)k=!0;else{W=new Kr(W,this);var ee=k.listener,Ae=k.ha||k.src;k.fa&&ds(k),k=ee.call(Ae,W)}return k}function io(k){return k=k[Hs],k instanceof $s?k:null}var Mo="__closure_events_fn_"+(1e9*Math.random()>>>0);function ra(k){return typeof k=="function"?k:(k[Mo]||(k[Mo]=function(W){return k.handleEvent(W)}),k[Mo])}function Dt(){oi.call(this),this.i=new $s(this),this.M=this,this.F=null}oe(Dt,oi),Dt.prototype[zi]=!0,Dt.prototype.removeEventListener=function(k,W,ee,Ae){Qs(this,k,W,ee,Ae)};function Qt(k,W){var ee,Ae=k.F;if(Ae)for(ee=[];Ae;Ae=Ae.F)ee.push(Ae);if(k=k.M,Ae=W.type||W,typeof W=="string")W=new et(W,k);else if(W instanceof et)W.target=W.target||k;else{var vt=W;W=new et(Ae,k),Ve(W,vt)}if(vt=!0,ee)for(var Ot=ee.length-1;0<=Ot;Ot--){var xn=W.g=ee[Ot];vt=ai(xn,Ae,!0,W)&&vt}if(xn=W.g=k,vt=ai(xn,Ae,!0,W)&&vt,vt=ai(xn,Ae,!1,W)&&vt,ee)for(Ot=0;Ot<ee.length;Ot++)xn=W.g=ee[Ot],vt=ai(xn,Ae,!1,W)&&vt}Dt.prototype.N=function(){if(Dt.aa.N.call(this),this.i){var k=this.i,W;for(W in k.g){for(var ee=k.g[W],Ae=0;Ae<ee.length;Ae++)Wi(ee[Ae]);delete k.g[W],k.h--}}this.F=null},Dt.prototype.K=function(k,W,ee,Ae){return this.i.add(String(k),W,!1,ee,Ae)},Dt.prototype.L=function(k,W,ee,Ae){return this.i.add(String(k),W,!0,ee,Ae)};function ai(k,W,ee,Ae){if(W=k.i.g[String(W)],!W)return!0;W=W.concat();for(var vt=!0,Ot=0;Ot<W.length;++Ot){var xn=W[Ot];if(xn&&!xn.da&&xn.capture==ee){var Gi=xn.listener,us=xn.ha||xn.src;xn.fa&&Po(k.i,xn),vt=Gi.call(us,Ae)!==!1&&vt}}return vt&&!Ae.defaultPrevented}function vi(k,W,ee){if(typeof k=="function")ee&&(k=j(k,ee));else if(k&&typeof k.handleEvent=="function")k=j(k.handleEvent,k);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:o.setTimeout(k,W||0)}function er(k){k.g=vi(()=>{k.g=null,k.i&&(k.i=!1,er(k))},k.l);const W=k.h;k.h=null,k.m.apply(null,W)}class wr extends oi{constructor(W,ee){super(),this.m=W,this.l=ee,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:er(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ur(k){oi.call(this),this.h=k,this.g={}}oe(Ur,oi);var fs=[];function Ds(k){nt(k.g,function(W,ee){this.g.hasOwnProperty(ee)&&ds(W)},k),k.g={}}Ur.prototype.N=function(){Ur.aa.N.call(this),Ds(this)},Ur.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qs=o.JSON.stringify,ss=o.JSON.parse,Js=class{stringify(k){return o.JSON.stringify(k,void 0)}parse(k){return o.JSON.parse(k,void 0)}};function mi(){}mi.prototype.h=null;function Ll(k){return k.h||(k.h=k.i())}function vo(){}var Bs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function dl(){et.call(this,"d")}oe(dl,et);function Ol(){et.call(this,"c")}oe(Ol,et);var Do={},bt=null;function Lo(){return bt=bt||new Dt}Do.La="serverreachability";function zc(k){et.call(this,Do.La,k)}oe(zc,et);function Ia(k){const W=Lo();Qt(W,new zc(W))}Do.STAT_EVENT="statevent";function fi(k,W){et.call(this,Do.STAT_EVENT,k),this.stat=W}oe(fi,et);function Ge(k){const W=Lo();Qt(W,new fi(W,k))}Do.Ma="timingevent";function Y(k,W){et.call(this,Do.Ma,k),this.size=W}oe(Y,et);function J(k,W){if(typeof k!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){k()},W)}function le(){this.g=!0}le.prototype.xa=function(){this.g=!1};function Ie(k,W,ee,Ae,vt,Ot){k.info(function(){if(k.g)if(Ot)for(var xn="",Gi=Ot.split("&"),us=0;us<Gi.length;us++){var pn=Gi[us].split("=");if(1<pn.length){var Ut=pn[0];pn=pn[1];var Hr=Ut.split("_");xn=2<=Hr.length&&Hr[1]=="type"?xn+(Ut+"="+pn+"&"):xn+(Ut+"=redacted&")}}else xn=null;else xn=Ot;return"XMLHTTP REQ ("+Ae+") [attempt "+vt+"]: "+W+`
`+ee+`
`+xn})}function he(k,W,ee,Ae,vt,Ot,xn){k.info(function(){return"XMLHTTP RESP ("+Ae+") [ attempt "+vt+"]: "+W+`
`+ee+`
`+Ot+" "+xn})}function Me(k,W,ee,Ae){k.info(function(){return"XMLHTTP TEXT ("+W+"): "+Fe(k,ee)+(Ae?" "+Ae:"")})}function Je(k,W){k.info(function(){return"TIMEOUT: "+W})}le.prototype.info=function(){};function Fe(k,W){if(!k.g)return W;if(!W)return null;try{var ee=JSON.parse(W);if(ee){for(k=0;k<ee.length;k++)if(Array.isArray(ee[k])){var Ae=ee[k];if(!(2>Ae.length)){var vt=Ae[1];if(Array.isArray(vt)&&!(1>vt.length)){var Ot=vt[0];if(Ot!="noop"&&Ot!="stop"&&Ot!="close")for(var xn=1;xn<vt.length;xn++)vt[xn]=""}}}}return qs(ee)}catch{return W}}var Xe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},pt;function sn(){}oe(sn,mi),sn.prototype.g=function(){return new XMLHttpRequest},sn.prototype.i=function(){return{}},pt=new sn;function _n(k,W,ee,Ae){this.j=k,this.i=W,this.l=ee,this.R=Ae||1,this.U=new Ur(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Cn}function Cn(){this.i=null,this.g="",this.h=!1}var Qn={},Nn={};function Jn(k,W,ee){k.L=1,k.v=Fi(un(W)),k.m=ee,k.P=!0,Ui(k,null)}function Ui(k,W){k.F=Date.now(),Tr(k),k.A=un(k.v);var ee=k.A,Ae=k.R;Array.isArray(Ae)||(Ae=[String(Ae)]),uf(ee.i,"t",Ae),k.C=0,ee=k.j.J,k.h=new Cn,k.g=Lu(k.j,ee?W:null,!k.m),0<k.O&&(k.M=new wr(j(k.Y,k,k.g),k.O)),W=k.U,ee=k.g,Ae=k.ca;var vt="readystatechange";Array.isArray(vt)||(vt&&(fs[0]=vt.toString()),vt=fs);for(var Ot=0;Ot<vt.length;Ot++){var xn=Ts(ee,vt[Ot],Ae||W.handleEvent,!1,W.h||W);if(!xn)break;W.g[xn.key]=xn}W=k.H?xe(k.H):{},k.m?(k.u||(k.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",k.g.ea(k.A,k.u,k.m,W)):(k.u="GET",k.g.ea(k.A,k.u,null,W)),Ia(),Ie(k.i,k.u,k.A,k.l,k.R,k.m)}_n.prototype.ca=function(k){k=k.target;const W=this.M;W&&Aa(k)==3?W.j():this.Y(k)},_n.prototype.Y=function(k){try{if(k==this.g)e:{const Hr=Aa(this.g);var W=this.g.Ba();const bn=this.g.Z();if(!(3>Hr)&&(Hr!=3||this.g&&(this.h.h||this.g.oa()||Nl(this.g)))){this.J||Hr!=4||W==7||(W==8||0>=bn?Ia(3):Ia(2)),gi(this);var ee=this.g.Z();this.X=ee;t:if(ni(this)){var Ae=Nl(this.g);k="";var vt=Ae.length,Ot=Aa(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ji(this),ci(this);var xn="";break t}this.h.i=new o.TextDecoder}for(W=0;W<vt;W++)this.h.h=!0,k+=this.h.i.decode(Ae[W],{stream:!(Ot&&W==vt-1)});Ae.length=0,this.h.g+=k,this.C=0,xn=this.h.g}else xn=this.g.oa();if(this.o=ee==200,he(this.i,this.u,this.A,this.l,this.R,Hr,ee),this.o){if(this.T&&!this.K){t:{if(this.g){var Gi,us=this.g;if((Gi=us.g?us.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ge(Gi)){var pn=Gi;break t}}pn=null}if(ee=pn)Me(this.i,this.l,ee,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,tr(this,ee);else{this.o=!1,this.s=3,Ge(12),ji(this),ci(this);break e}}if(this.P){ee=!0;let ur;for(;!this.J&&this.C<xn.length;)if(ur=br(this,xn),ur==Nn){Hr==4&&(this.s=4,Ge(14),ee=!1),Me(this.i,this.l,null,"[Incomplete Response]");break}else if(ur==Qn){this.s=4,Ge(15),Me(this.i,this.l,xn,"[Invalid Chunk]"),ee=!1;break}else Me(this.i,this.l,ur,null),tr(this,ur);if(ni(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Hr!=4||xn.length!=0||this.h.h||(this.s=1,Ge(16),ee=!1),this.o=this.o&&ee,!ee)Me(this.i,this.l,xn,"[Invalid Chunked Response]"),ji(this),ci(this);else if(0<xn.length&&!this.W){this.W=!0;var Ut=this.j;Ut.g==this&&Ut.ba&&!Ut.M&&(Ut.j.info("Great, no buffering proxy detected. Bytes received: "+xn.length),Du(Ut),Ut.M=!0,Ge(11))}}else Me(this.i,this.l,xn,null),tr(this,xn);Hr==4&&ji(this),this.o&&!this.J&&(Hr==4?Si(this.j,this):(this.o=!1,Tr(this)))}else Oo(this.g),ee==400&&0<xn.indexOf("Unknown SID")?(this.s=3,Ge(12)):(this.s=0,Ge(13)),ji(this),ci(this)}}}catch{}finally{}};function ni(k){return k.g?k.u=="GET"&&k.L!=2&&k.j.Ca:!1}function br(k,W){var ee=k.C,Ae=W.indexOf(`
`,ee);return Ae==-1?Nn:(ee=Number(W.substring(ee,Ae)),isNaN(ee)?Qn:(Ae+=1,Ae+ee>W.length?Nn:(W=W.slice(Ae,Ae+ee),k.C=Ae+ee,W)))}_n.prototype.cancel=function(){this.J=!0,ji(this)};function Tr(k){k.S=Date.now()+k.I,jr(k,k.I)}function jr(k,W){if(k.B!=null)throw Error("WatchDog timer not null");k.B=J(j(k.ba,k),W)}function gi(k){k.B&&(o.clearTimeout(k.B),k.B=null)}_n.prototype.ba=function(){this.B=null;const k=Date.now();0<=k-this.S?(Je(this.i,this.A),this.L!=2&&(Ia(),Ge(17)),ji(this),this.s=2,ci(this)):jr(this,this.S-k)};function ci(k){k.j.G==0||k.J||Si(k.j,k)}function ji(k){gi(k);var W=k.M;W&&typeof W.ma=="function"&&W.ma(),k.M=null,Ds(k.U),k.g&&(W=k.g,k.g=null,W.abort(),W.ma())}function tr(k,W){try{var ee=k.j;if(ee.G!=0&&(ee.g==k||fl(ee.h,k))){if(!k.K&&fl(ee.h,k)&&ee.G==3){try{var Ae=ee.Da.g.parse(W)}catch{Ae=null}if(Array.isArray(Ae)&&Ae.length==3){var vt=Ae;if(vt[0]==0){e:if(!ee.u){if(ee.g)if(ee.g.F+3e3<k.F)on(ee),wi(ee);else break e;xo(ee),Ge(18)}}else ee.za=vt[1],0<ee.za-ee.T&&37500>vt[2]&&ee.F&&ee.v==0&&!ee.C&&(ee.C=J(j(ee.Za,ee),6e3));if(1>=Os(ee.h)&&ee.ca){try{ee.ca()}catch{}ee.ca=void 0}}else zs(ee,11)}else if((k.K||ee.g==k)&&on(ee),!ge(W))for(vt=ee.Da.g.parse(W),W=0;W<vt.length;W++){let pn=vt[W];if(ee.T=pn[0],pn=pn[1],ee.G==2)if(pn[0]=="c"){ee.K=pn[1],ee.ia=pn[2];const Ut=pn[3];Ut!=null&&(ee.la=Ut,ee.j.info("VER="+ee.la));const Hr=pn[4];Hr!=null&&(ee.Aa=Hr,ee.j.info("SVER="+ee.Aa));const bn=pn[5];bn!=null&&typeof bn=="number"&&0<bn&&(Ae=1.5*bn,ee.L=Ae,ee.j.info("backChannelRequestTimeoutMs_="+Ae)),Ae=ee;const ur=k.g;if(ur){const Ul=ur.g?ur.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ul){var Ot=Ae.h;Ot.g||Ul.indexOf("spdy")==-1&&Ul.indexOf("quic")==-1&&Ul.indexOf("h2")==-1||(Ot.j=Ot.l,Ot.g=new Set,Ot.h&&(ye(Ot,Ot.h),Ot.h=null))}if(Ae.D){const yn=ur.g?ur.g.getResponseHeader("X-HTTP-Session-Id"):null;yn&&(Ae.ya=yn,jn(Ae.I,Ae.D,yn))}}ee.G=3,ee.l&&ee.l.ua(),ee.ba&&(ee.R=Date.now()-k.F,ee.j.info("Handshake RTT: "+ee.R+"ms")),Ae=ee;var xn=k;if(Ae.qa=Pi(Ae,Ae.J?Ae.ia:null,Ae.W),xn.K){tt(Ae.h,xn);var Gi=xn,us=Ae.L;us&&(Gi.I=us),Gi.B&&(gi(Gi),Tr(Gi)),Ae.g=xn}else Bl(Ae);0<ee.i.length&&_l(ee)}else pn[0]!="stop"&&pn[0]!="close"||zs(ee,7);else ee.G==3&&(pn[0]=="stop"||pn[0]=="close"?pn[0]=="stop"?zs(ee,7):Mu(ee):pn[0]!="noop"&&ee.l&&ee.l.ta(pn),ee.v=0)}}Ia(4)}catch{}}var cr=class{constructor(k,W){this.g=k,this.map=W}};function ls(k){this.l=k||10,o.PerformanceNavigationTiming?(k=o.performance.getEntriesByType("navigation"),k=0<k.length&&(k[0].nextHopProtocol=="hq"||k[0].nextHopProtocol=="h2")):k=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=k?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ls(k){return k.h?!0:k.g?k.g.size>=k.j:!1}function Os(k){return k.h?1:k.g?k.g.size:0}function fl(k,W){return k.h?k.h==W:k.g?k.g.has(W):!1}function ye(k,W){k.g?k.g.add(W):k.h=W}function tt(k,W){k.h&&k.h==W?k.h=null:k.g&&k.g.has(W)&&k.g.delete(W)}ls.prototype.cancel=function(){if(this.i=ze(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const k of this.g.values())k.cancel();this.g.clear()}};function ze(k){if(k.h!=null)return k.i.concat(k.h.D);if(k.g!=null&&k.g.size!==0){let W=k.i;for(const ee of k.g.values())W=W.concat(ee.D);return W}return me(k.i)}function dt(k){if(k.V&&typeof k.V=="function")return k.V();if(typeof Map<"u"&&k instanceof Map||typeof Set<"u"&&k instanceof Set)return Array.from(k.values());if(typeof k=="string")return k.split("");if(S(k)){for(var W=[],ee=k.length,Ae=0;Ae<ee;Ae++)W.push(k[Ae]);return W}W=[],ee=0;for(Ae in k)W[ee++]=k[Ae];return W}function mt(k){if(k.na&&typeof k.na=="function")return k.na();if(!k.V||typeof k.V!="function"){if(typeof Map<"u"&&k instanceof Map)return Array.from(k.keys());if(!(typeof Set<"u"&&k instanceof Set)){if(S(k)||typeof k=="string"){var W=[];k=k.length;for(var ee=0;ee<k;ee++)W.push(ee);return W}W=[],ee=0;for(const Ae in k)W[ee++]=Ae;return W}}}function ut(k,W){if(k.forEach&&typeof k.forEach=="function")k.forEach(W,void 0);else if(S(k)||typeof k=="string")Array.prototype.forEach.call(k,W,void 0);else for(var ee=mt(k),Ae=dt(k),vt=Ae.length,Ot=0;Ot<vt;Ot++)W.call(void 0,Ae[Ot],ee&&ee[Ot],k)}var $t=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function rn(k,W){if(k){k=k.split("&");for(var ee=0;ee<k.length;ee++){var Ae=k[ee].indexOf("="),vt=null;if(0<=Ae){var Ot=k[ee].substring(0,Ae);vt=k[ee].substring(Ae+1)}else Ot=k[ee];W(Ot,vt?decodeURIComponent(vt.replace(/\+/g," ")):"")}}}function cn(k){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,k instanceof cn){this.h=k.h,fn(this,k.j),this.o=k.o,this.g=k.g,Mn(this,k.s),this.l=k.l;var W=k.i,ee=new Is;ee.i=W.i,W.g&&(ee.g=new Map(W.g),ee.h=W.h),ui(this,ee),this.m=k.m}else k&&(W=String(k).match($t))?(this.h=!1,fn(this,W[1]||"",!0),this.o=pr(W[2]||""),this.g=pr(W[3]||"",!0),Mn(this,W[4]),this.l=pr(W[5]||"",!0),ui(this,W[6]||"",!0),this.m=pr(W[7]||"")):(this.h=!1,this.i=new Is(null,this.h))}cn.prototype.toString=function(){var k=[],W=this.j;W&&k.push(Ar(W,sa,!0),":");var ee=this.g;return(ee||W=="file")&&(k.push("//"),(W=this.o)&&k.push(Ar(W,sa,!0),"@"),k.push(encodeURIComponent(String(ee)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ee=this.s,ee!=null&&k.push(":",String(ee))),(ee=this.l)&&(this.g&&ee.charAt(0)!="/"&&k.push("/"),k.push(Ar(ee,ee.charAt(0)=="/"?zl:Sa,!0))),(ee=this.i.toString())&&k.push("?",ee),(ee=this.m)&&k.push("#",Ar(ee,Sh)),k.join("")};function un(k){return new cn(k)}function fn(k,W,ee){k.j=ee?pr(W,!0):W,k.j&&(k.j=k.j.replace(/:$/,""))}function Mn(k,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);k.s=W}else k.s=null}function ui(k,W,ee){W instanceof Is?(k.i=W,Cu(k.i,k.h)):(ee||(W=Ar(W,oc)),k.i=new Is(W,k.h))}function jn(k,W,ee){k.i.set(W,ee)}function Fi(k){return jn(k,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),k}function pr(k,W){return k?W?decodeURI(k.replace(/%25/g,"%2525")):decodeURIComponent(k):""}function Ar(k,W,ee){return typeof k=="string"?(k=encodeURI(k).replace(W,cs),ee&&(k=k.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),k):null}function cs(k){return k=k.charCodeAt(0),"%"+(k>>4&15).toString(16)+(k&15).toString(16)}var sa=/[#\/\?@]/g,Sa=/[#\?:]/g,zl=/[#\?]/g,oc=/[#\?@]/g,Sh=/#/g;function Is(k,W){this.h=this.g=null,this.i=k||null,this.j=!!W}function ro(k){k.g||(k.g=new Map,k.h=0,k.i&&rn(k.i,function(W,ee){k.add(decodeURIComponent(W.replace(/\+/g," ")),ee)}))}t=Is.prototype,t.add=function(k,W){ro(this),this.i=null,k=lc(this,k);var ee=this.g.get(k);return ee||this.g.set(k,ee=[]),ee.push(W),this.h+=1,this};function pl(k,W){ro(k),W=lc(k,W),k.g.has(W)&&(k.i=null,k.h-=k.g.get(W).length,k.g.delete(W))}function ac(k,W){return ro(k),W=lc(k,W),k.g.has(W)}t.forEach=function(k,W){ro(this),this.g.forEach(function(ee,Ae){ee.forEach(function(vt){k.call(W,vt,Ae,this)},this)},this)},t.na=function(){ro(this);const k=Array.from(this.g.values()),W=Array.from(this.g.keys()),ee=[];for(let Ae=0;Ae<W.length;Ae++){const vt=k[Ae];for(let Ot=0;Ot<vt.length;Ot++)ee.push(W[Ae])}return ee},t.V=function(k){ro(this);let W=[];if(typeof k=="string")ac(this,k)&&(W=W.concat(this.g.get(lc(this,k))));else{k=Array.from(this.g.values());for(let ee=0;ee<k.length;ee++)W=W.concat(k[ee])}return W},t.set=function(k,W){return ro(this),this.i=null,k=lc(this,k),ac(this,k)&&(this.h-=this.g.get(k).length),this.g.set(k,[W]),this.h+=1,this},t.get=function(k,W){return k?(k=this.V(k),0<k.length?String(k[0]):W):W};function uf(k,W,ee){pl(k,W),0<ee.length&&(k.i=null,k.g.set(lc(k,W),me(ee)),k.h+=ee.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const k=[],W=Array.from(this.g.keys());for(var ee=0;ee<W.length;ee++){var Ae=W[ee];const Ot=encodeURIComponent(String(Ae)),xn=this.V(Ae);for(Ae=0;Ae<xn.length;Ae++){var vt=Ot;xn[Ae]!==""&&(vt+="="+encodeURIComponent(String(xn[Ae]))),k.push(vt)}}return this.i=k.join("&")};function lc(k,W){return W=String(W),k.j&&(W=W.toLowerCase()),W}function Cu(k,W){W&&!k.j&&(ro(k),k.i=null,k.g.forEach(function(ee,Ae){var vt=Ae.toLowerCase();Ae!=vt&&(pl(this,Ae),uf(this,vt,ee))},k)),k.j=W}function _i(k,W){const ee=new le;if(o.Image){const Ae=new Image;Ae.onload=Q(Wo,ee,"TestLoadImage: loaded",!0,W,Ae),Ae.onerror=Q(Wo,ee,"TestLoadImage: error",!1,W,Ae),Ae.onabort=Q(Wo,ee,"TestLoadImage: abort",!1,W,Ae),Ae.ontimeout=Q(Wo,ee,"TestLoadImage: timeout",!1,W,Ae),o.setTimeout(function(){Ae.ontimeout&&Ae.ontimeout()},1e4),Ae.src=k}else W(!1)}function Ah(k,W){const ee=new le,Ae=new AbortController,vt=setTimeout(()=>{Ae.abort(),Wo(ee,"TestPingServer: timeout",!1,W)},1e4);fetch(k,{signal:Ae.signal}).then(Ot=>{clearTimeout(vt),Ot.ok?Wo(ee,"TestPingServer: ok",!0,W):Wo(ee,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(vt),Wo(ee,"TestPingServer: error",!1,W)})}function Wo(k,W,ee,Ae,vt){try{vt&&(vt.onload=null,vt.onerror=null,vt.onabort=null,vt.ontimeout=null),Ae(ee)}catch{}}function Pu(){this.g=new Js}function c_(k,W,ee){const Ae=ee||"";try{ut(k,function(vt,Ot){let xn=vt;P(vt)&&(xn=qs(vt)),W.push(Ae+Ot+"="+encodeURIComponent(xn))})}catch(vt){throw W.push(Ae+"type="+encodeURIComponent("_badmap")),vt}}function Fl(k){this.l=k.Ub||null,this.j=k.eb||!1}oe(Fl,mi),Fl.prototype.g=function(){return new Ga(this.l,this.j)},Fl.prototype.i=function(k){return function(){return k}}({});function Ga(k,W){Dt.call(this),this.D=k,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}oe(Ga,Dt),t=Ga.prototype,t.open=function(k,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=k,this.A=W,this.readyState=1,Fc(this)},t.send=function(k){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};k&&(W.body=k),(this.D||o).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,gl(this)),this.readyState=0},t.Sa=function(k){if(this.g&&(this.l=k,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=k.headers,this.readyState=2,Fc(this)),this.g&&(this.readyState=3,Fc(this),this.g)))if(this.responseType==="arraybuffer")k.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in k){if(this.j=k.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;ml(this)}else k.text().then(this.Ra.bind(this),this.ga.bind(this))};function ml(k){k.j.read().then(k.Pa.bind(k)).catch(k.ga.bind(k))}t.Pa=function(k){if(this.g){if(this.o&&k.value)this.response.push(k.value);else if(!this.o){var W=k.value?k.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!k.done}))&&(this.response=this.responseText+=W)}k.done?gl(this):Fc(this),this.readyState==3&&ml(this)}},t.Ra=function(k){this.g&&(this.response=this.responseText=k,gl(this))},t.Qa=function(k){this.g&&(this.response=k,gl(this))},t.ga=function(){this.g&&gl(this)};function gl(k){k.readyState=4,k.l=null,k.j=null,k.v=null,Fc(k)}t.setRequestHeader=function(k,W){this.u.append(k,W)},t.getResponseHeader=function(k){return this.h&&this.h.get(k.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const k=[],W=this.h.entries();for(var ee=W.next();!ee.done;)ee=ee.value,k.push(ee[0]+": "+ee[1]),ee=W.next();return k.join(`\r
`)};function Fc(k){k.onreadystatechange&&k.onreadystatechange.call(k)}Object.defineProperty(Ga.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(k){this.m=k?"include":"same-origin"}});function Ru(k){let W="";return nt(k,function(ee,Ae){W+=Ae,W+=":",W+=ee,W+=`\r
`}),W}function Ch(k,W,ee){e:{for(Ae in ee){var Ae=!1;break e}Ae=!0}Ae||(ee=Ru(ee),typeof k=="string"?ee!=null&&encodeURIComponent(String(ee)):jn(k,W,ee))}function $r(k){Dt.call(this),this.headers=new Map,this.o=k||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}oe($r,Dt);var cc=/^https?$/i,Rp=["POST","PUT"];t=$r.prototype,t.Ha=function(k){this.J=k},t.ea=function(k,W,ee,Ae){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+k);W=W?W.toUpperCase():"GET",this.D=k,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():pt.g(),this.v=this.o?Ll(this.o):Ll(pt),this.g.onreadystatechange=j(this.Ea,this);try{this.B=!0,this.g.open(W,String(k),!0),this.B=!1}catch(Ot){Nc(this,Ot);return}if(k=ee||"",ee=new Map(this.headers),Ae)if(Object.getPrototypeOf(Ae)===Object.prototype)for(var vt in Ae)ee.set(vt,Ae[vt]);else if(typeof Ae.keys=="function"&&typeof Ae.get=="function")for(const Ot of Ae.keys())ee.set(Ot,Ae.get(Ot));else throw Error("Unknown input type for opt_headers: "+String(Ae));Ae=Array.from(ee.keys()).find(Ot=>Ot.toLowerCase()=="content-type"),vt=o.FormData&&k instanceof o.FormData,!(0<=Array.prototype.indexOf.call(Rp,W,void 0))||Ae||vt||ee.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ot,xn]of ee)this.g.setRequestHeader(Ot,xn);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ph(this),this.u=!0,this.g.send(k),this.u=!1}catch(Ot){Nc(this,Ot)}};function Nc(k,W){k.h=!1,k.g&&(k.j=!0,k.g.abort(),k.j=!1),k.l=W,k.m=5,uc(k),so(k)}function uc(k){k.A||(k.A=!0,Qt(k,"complete"),Qt(k,"error"))}t.abort=function(k){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=k||7,Qt(this,"complete"),Qt(this,"abort"),so(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),so(this,!0)),$r.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?$a(this):this.bb())},t.bb=function(){$a(this)};function $a(k){if(k.h&&typeof v<"u"&&(!k.v[1]||Aa(k)!=4||k.Z()!=2)){if(k.u&&Aa(k)==4)vi(k.Ea,0,k);else if(Qt(k,"readystatechange"),Aa(k)==4){k.h=!1;try{const xn=k.Z();e:switch(xn){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var ee;if(!(ee=W)){var Ae;if(Ae=xn===0){var vt=String(k.D).match($t)[1]||null;!vt&&o.self&&o.self.location&&(vt=o.self.location.protocol.slice(0,-1)),Ae=!cc.test(vt?vt.toLowerCase():"")}ee=Ae}if(ee)Qt(k,"complete"),Qt(k,"success");else{k.m=6;try{var Ot=2<Aa(k)?k.g.statusText:""}catch{Ot=""}k.l=Ot+" ["+k.Z()+"]",uc(k)}}finally{so(k)}}}}function so(k,W){if(k.g){Ph(k);const ee=k.g,Ae=k.v[0]?()=>{}:null;k.g=null,k.v=null,W||Qt(k,"ready");try{ee.onreadystatechange=Ae}catch{}}}function Ph(k){k.I&&(o.clearTimeout(k.I),k.I=null)}t.isActive=function(){return!!this.g};function Aa(k){return k.g?k.g.readyState:0}t.Z=function(){try{return 2<Aa(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(k){if(this.g){var W=this.g.responseText;return k&&W.indexOf(k)==0&&(W=W.substring(k.length)),ss(W)}};function Nl(k){try{if(!k.g)return null;if("response"in k.g)return k.g.response;switch(k.H){case"":case"text":return k.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in k.g)return k.g.mozResponseArrayBuffer}return null}catch{return null}}function Oo(k){const W={};k=(k.g&&2<=Aa(k)&&k.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ae=0;Ae<k.length;Ae++){if(ge(k[Ae]))continue;var ee=De(k[Ae]);const vt=ee[0];if(ee=ee[1],typeof ee!="string")continue;ee=ee.trim();const Ot=W[vt]||[];W[vt]=Ot,Ot.push(ee)}Pe(W,function(Ae){return Ae.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function hc(k,W,ee){return ee&&ee.internalChannelParams&&ee.internalChannelParams[k]||W}function ku(k){this.Aa=0,this.i=[],this.j=new le,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=hc("failFast",!1,k),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=hc("baseRetryDelayMs",5e3,k),this.cb=hc("retryDelaySeedMs",1e4,k),this.Wa=hc("forwardChannelMaxRetries",2,k),this.wa=hc("forwardChannelRequestTimeoutMs",2e4,k),this.pa=k&&k.xmlHttpFactory||void 0,this.Xa=k&&k.Tb||void 0,this.Ca=k&&k.useFetchStreams||!1,this.L=void 0,this.J=k&&k.supportsCrossDomainXhr||!1,this.K="",this.h=new ls(k&&k.concurrentRequestLimit),this.Da=new Pu,this.P=k&&k.fastHandshake||!1,this.O=k&&k.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=k&&k.Rb||!1,k&&k.xa&&this.j.xa(),k&&k.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&k&&k.detectBufferingProxy||!1,this.ja=void 0,k&&k.longPollingTimeout&&0<k.longPollingTimeout&&(this.ja=k.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=ku.prototype,t.la=8,t.G=1,t.connect=function(k,W,ee,Ae){Ge(0),this.W=k,this.H=W||{},ee&&Ae!==void 0&&(this.H.OSID=ee,this.H.OAID=Ae),this.F=this.X,this.I=Pi(this,null,this.W),_l(this)};function Mu(k){if(Bc(k),k.G==3){var W=k.U++,ee=un(k.I);if(jn(ee,"SID",k.K),jn(ee,"RID",W),jn(ee,"TYPE","terminate"),Vc(k,ee),W=new _n(k,k.j,W),W.L=2,W.v=Fi(un(ee)),ee=!1,o.navigator&&o.navigator.sendBeacon)try{ee=o.navigator.sendBeacon(W.v.toString(),"")}catch{}!ee&&o.Image&&(new Image().src=W.v,ee=!0),ee||(W.g=Lu(W.j,null),W.g.ea(W.v)),W.F=Date.now(),Tr(W)}Ha(k)}function wi(k){k.g&&(Du(k),k.g.cancel(),k.g=null)}function Bc(k){wi(k),k.u&&(o.clearTimeout(k.u),k.u=null),on(k),k.h.cancel(),k.s&&(typeof k.s=="number"&&o.clearTimeout(k.s),k.s=null)}function _l(k){if(!Ls(k.h)&&!k.s){k.s=!0;var W=k.Ga;Ii||je(),vn||(Ii(),vn=!0),Vn.add(W,k),k.B=0}}function kp(k,W){return Os(k.h)>=k.h.j-(k.s?1:0)?!1:k.s?(k.i=W.D.concat(k.i),!0):k.G==1||k.G==2||k.B>=(k.Va?0:k.Wa)?!1:(k.s=J(j(k.Ga,k,W),Ai(k,k.B)),k.B++,!0)}t.Ga=function(k){if(this.s)if(this.s=null,this.G==1){if(!k){this.U=Math.floor(1e5*Math.random()),k=this.U++;const vt=new _n(this,this.j,k);let Ot=this.o;if(this.S&&(Ot?(Ot=xe(Ot),Ve(Ot,this.S)):Ot=this.S),this.m!==null||this.O||(vt.H=Ot,Ot=null),this.P)e:{for(var W=0,ee=0;ee<this.i.length;ee++){t:{var Ae=this.i[ee];if("__data__"in Ae.map&&(Ae=Ae.map.__data__,typeof Ae=="string")){Ae=Ae.length;break t}Ae=void 0}if(Ae===void 0)break;if(W+=Ae,4096<W){W=ee;break e}if(W===4096||ee===this.i.length-1){W=ee+1;break e}}W=1e3}else W=1e3;W=Uc(this,vt,W),ee=un(this.I),jn(ee,"RID",k),jn(ee,"CVER",22),this.D&&jn(ee,"X-HTTP-Session-Id",this.D),Vc(this,ee),Ot&&(this.O?W="headers="+encodeURIComponent(String(Ru(Ot)))+"&"+W:this.m&&Ch(ee,this.m,Ot)),ye(this.h,vt),this.Ua&&jn(ee,"TYPE","init"),this.P?(jn(ee,"$req",W),jn(ee,"SID","null"),vt.T=!0,Jn(vt,ee,null)):Jn(vt,ee,W),this.G=2}}else this.G==3&&(k?gn(this,k):this.i.length==0||Ls(this.h)||gn(this))};function gn(k,W){var ee;W?ee=W.l:ee=k.U++;const Ae=un(k.I);jn(Ae,"SID",k.K),jn(Ae,"RID",ee),jn(Ae,"AID",k.T),Vc(k,Ae),k.m&&k.o&&Ch(Ae,k.m,k.o),ee=new _n(k,k.j,ee,k.B+1),k.m===null&&(ee.H=k.o),W&&(k.i=W.D.concat(k.i)),W=Uc(k,ee,1e3),ee.I=Math.round(.5*k.wa)+Math.round(.5*k.wa*Math.random()),ye(k.h,ee),Jn(ee,Ae,W)}function Vc(k,W){k.H&&nt(k.H,function(ee,Ae){jn(W,Ae,ee)}),k.l&&ut({},function(ee,Ae){jn(W,Ae,ee)})}function Uc(k,W,ee){ee=Math.min(k.i.length,ee);var Ae=k.l?j(k.l.Na,k.l,k):null;e:{var vt=k.i;let Ot=-1;for(;;){const xn=["count="+ee];Ot==-1?0<ee?(Ot=vt[0].g,xn.push("ofs="+Ot)):Ot=0:xn.push("ofs="+Ot);let Gi=!0;for(let us=0;us<ee;us++){let pn=vt[us].g;const Ut=vt[us].map;if(pn-=Ot,0>pn)Ot=Math.max(0,vt[us].g-100),Gi=!1;else try{c_(Ut,xn,"req"+pn+"_")}catch{Ae&&Ae(Ut)}}if(Gi){Ae=xn.join("&");break e}}}return k=k.i.splice(0,ee),W.D=k,Ae}function Bl(k){if(!k.g&&!k.u){k.Y=1;var W=k.Fa;Ii||je(),vn||(Ii(),vn=!0),Vn.add(W,k),k.v=0}}function xo(k){return k.g||k.u||3<=k.v?!1:(k.Y++,k.u=J(j(k.Fa,k),Ai(k,k.v)),k.v++,!0)}t.Fa=function(){if(this.u=null,dc(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var k=2*this.R;this.j.info("BP detection timer enabled: "+k),this.A=J(j(this.ab,this),k)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ge(10),wi(this),dc(this))};function Du(k){k.A!=null&&(o.clearTimeout(k.A),k.A=null)}function dc(k){k.g=new _n(k,k.j,"rpc",k.Y),k.m===null&&(k.g.H=k.o),k.g.O=0;var W=un(k.qa);jn(W,"RID","rpc"),jn(W,"SID",k.K),jn(W,"AID",k.T),jn(W,"CI",k.F?"0":"1"),!k.F&&k.ja&&jn(W,"TO",k.ja),jn(W,"TYPE","xmlhttp"),Vc(k,W),k.m&&k.o&&Ch(W,k.m,k.o),k.L&&(k.g.I=k.L);var ee=k.g;k=k.ia,ee.L=1,ee.v=Fi(un(W)),ee.m=null,ee.P=!0,Ui(ee,k)}t.Za=function(){this.C!=null&&(this.C=null,wi(this),xo(this),Ge(19))};function on(k){k.C!=null&&(o.clearTimeout(k.C),k.C=null)}function Si(k,W){var ee=null;if(k.g==W){on(k),Du(k),k.g=null;var Ae=2}else if(fl(k.h,W))ee=W.D,tt(k.h,W),Ae=1;else return;if(k.G!=0){if(W.o)if(Ae==1){ee=W.m?W.m.length:0,W=Date.now()-W.F;var vt=k.B;Ae=Lo(),Qt(Ae,new Y(Ae,ee)),_l(k)}else Bl(k);else if(vt=W.s,vt==3||vt==0&&0<W.X||!(Ae==1&&kp(k,W)||Ae==2&&xo(k)))switch(ee&&0<ee.length&&(W=k.h,W.i=W.i.concat(ee)),vt){case 1:zs(k,5);break;case 4:zs(k,10);break;case 3:zs(k,6);break;default:zs(k,2)}}}function Ai(k,W){let ee=k.Ta+Math.floor(Math.random()*k.cb);return k.isActive()||(ee*=2),ee*W}function zs(k,W){if(k.j.info("Error code "+W),W==2){var ee=j(k.fb,k),Ae=k.Xa;const vt=!Ae;Ae=new cn(Ae||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||fn(Ae,"https"),Fi(Ae),vt?_i(Ae.toString(),ee):Ah(Ae.toString(),ee)}else Ge(2);k.G=0,k.l&&k.l.sa(W),Ha(k),Bc(k)}t.fb=function(k){k?(this.j.info("Successfully pinged google.com"),Ge(2)):(this.j.info("Failed to ping google.com"),Ge(1))};function Ha(k){if(k.G=0,k.ka=[],k.l){const W=ze(k.h);(W.length!=0||k.i.length!=0)&&(Ue(k.ka,W),Ue(k.ka,k.i),k.h.i.length=0,me(k.i),k.i.length=0),k.l.ra()}}function Pi(k,W,ee){var Ae=ee instanceof cn?un(ee):new cn(ee);if(Ae.g!="")W&&(Ae.g=W+"."+Ae.g),Mn(Ae,Ae.s);else{var vt=o.location;Ae=vt.protocol,W=W?W+"."+vt.hostname:vt.hostname,vt=+vt.port;var Ot=new cn(null);Ae&&fn(Ot,Ae),W&&(Ot.g=W),vt&&Mn(Ot,vt),ee&&(Ot.l=ee),Ae=Ot}return ee=k.D,W=k.ya,ee&&W&&jn(Ae,ee,W),jn(Ae,"VER",k.la),Vc(k,Ae),Ae}function Lu(k,W,ee){if(W&&!k.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=k.Ca&&!k.pa?new $r(new Fl({eb:ee})):new $r(k.pa),W.Ha(k.J),W}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function jc(){}t=jc.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Vl(){}Vl.prototype.g=function(k,W){return new Fr(k,W)};function Fr(k,W){Dt.call(this),this.g=new ku(W),this.l=k,this.h=W&&W.messageUrlParams||null,k=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(k?k["X-Client-Protocol"]="webchannel":k={"X-Client-Protocol":"webchannel"}),this.g.o=k,k=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(k?k["X-WebChannel-Content-Type"]=W.messageContentType:k={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(k?k["X-WebChannel-Client-Profile"]=W.va:k={"X-WebChannel-Client-Profile":W.va}),this.g.S=k,(k=W&&W.Sb)&&!ge(k)&&(this.g.m=k),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!ge(W)&&(this.g.D=W,k=this.h,k!==null&&W in k&&(k=this.h,W in k&&delete k[W])),this.j=new Ca(this)}oe(Fr,Dt),Fr.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Fr.prototype.close=function(){Mu(this.g)},Fr.prototype.o=function(k){var W=this.g;if(typeof k=="string"){var ee={};ee.__data__=k,k=ee}else this.u&&(ee={},ee.__data__=qs(k),k=ee);W.i.push(new cr(W.Ya++,k)),W.G==3&&_l(W)},Fr.prototype.N=function(){this.g.l=null,delete this.j,Mu(this.g),delete this.g,Fr.aa.N.call(this)};function es(k){dl.call(this),k.__headers__&&(this.headers=k.__headers__,this.statusCode=k.__status__,delete k.__headers__,delete k.__status__);var W=k.__sm__;if(W){e:{for(const ee in W){k=ee;break e}k=void 0}(this.i=k)&&(k=this.i,W=W!==null&&k in W?W[k]:void 0),this.data=W}else this.data=k}oe(es,dl);function Mp(){Ol.call(this),this.status=1}oe(Mp,Ol);function Ca(k){this.g=k}oe(Ca,jc),Ca.prototype.ua=function(){Qt(this.g,"a")},Ca.prototype.ta=function(k){Qt(this.g,new es(k))},Ca.prototype.sa=function(k){Qt(this.g,new Mp)},Ca.prototype.ra=function(){Qt(this.g,"b")},Vl.prototype.createWebChannel=Vl.prototype.g,Fr.prototype.send=Fr.prototype.o,Fr.prototype.open=Fr.prototype.m,Fr.prototype.close=Fr.prototype.close,d5=function(){return new Vl},h5=function(){return Lo()},u5=Do,mC={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Xe.NO_ERROR=0,Xe.TIMEOUT=8,Xe.HTTP_ERROR=6,G1=Xe,Pt.COMPLETE="complete",c5=Pt,vo.EventType=Bs,Bs.OPEN="a",Bs.CLOSE="b",Bs.ERROR="c",Bs.MESSAGE="d",Dt.prototype.listen=Dt.prototype.K,Tv=vo,$r.prototype.listenOnce=$r.prototype.L,$r.prototype.getLastError=$r.prototype.Ka,$r.prototype.getLastErrorCode=$r.prototype.Ba,$r.prototype.getStatus=$r.prototype.Z,$r.prototype.getResponseJson=$r.prototype.Oa,$r.prototype.getResponseText=$r.prototype.oa,$r.prototype.send=$r.prototype.ea,$r.prototype.setWithCredentials=$r.prototype.Ha,l5=$r}).apply(typeof p1<"u"?p1:typeof self<"u"?self:typeof window<"u"?window:{});const Fz="@firebase/firestore",Nz="4.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}fa.UNAUTHENTICATED=new fa(null),fa.GOOGLE_CREDENTIALS=new fa("google-credentials-uid"),fa.FIRST_PARTY=new fa("first-party-uid"),fa.MOCK_USER=new fa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qg="12.0.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dp=new Nx("@firebase/firestore");function Hm(){return dp.logLevel}function $n(t,...e){if(dp.logLevel<=vr.DEBUG){const n=e.map(AP);dp.debug(`Firestore (${Qg}): ${t}`,...n)}}function vh(t,...e){if(dp.logLevel<=vr.ERROR){const n=e.map(AP);dp.error(`Firestore (${Qg}): ${t}`,...n)}}function Dg(t,...e){if(dp.logLevel<=vr.WARN){const n=e.map(AP);dp.warn(`Firestore (${Qg}): ${t}`,...n)}}function AP(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oi(t,e,n){let a="Unexpected state";typeof e=="string"?a=e:n=e,f5(t,a,n)}function f5(t,e,n){let a=`FIRESTORE (${Qg}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{a+=" CONTEXT: "+JSON.stringify(n)}catch{a+=" CONTEXT: "+n}throw vh(a),new Error(a)}function Jr(t,e,n,a){let h="Unexpected state";typeof n=="string"?h=n:a=n,t||f5(e,h,a)}function Yi(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const en={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Bn extends Oc{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class NY{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(fa.UNAUTHENTICATED))}shutdown(){}}class BY{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class VY{constructor(e){this.t=e,this.currentUser=fa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Jr(this.o===void 0,42304);let a=this.i;const h=S=>this.i!==a?(a=this.i,n(S)):Promise.resolve();let m=new ip;this.o=()=>{this.i++,this.currentUser=this.u(),m.resolve(),m=new ip,e.enqueueRetryable(()=>h(this.currentUser))};const v=()=>{const S=m;e.enqueueRetryable(async()=>{await S.promise,await h(this.currentUser)})},o=S=>{$n("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=S,this.o&&(this.auth.addAuthTokenListener(this.o),v())};this.t.onInit(S=>o(S)),setTimeout(()=>{if(!this.auth){const S=this.t.getImmediate({optional:!0});S?o(S):($n("FirebaseAuthCredentialsProvider","Auth not yet detected"),m.resolve(),m=new ip)}},0),v()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(a=>this.i!==e?($n("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(Jr(typeof a.accessToken=="string",31837,{l:a}),new p5(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Jr(e===null||typeof e=="string",2055,{h:e}),new fa(e)}}class UY{constructor(e,n,a){this.P=e,this.T=n,this.I=a,this.type="FirstParty",this.user=fa.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class jY{constructor(e,n,a){this.P=e,this.T=n,this.I=a}getToken(){return Promise.resolve(new UY(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(fa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Bz{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class GY{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,tl(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Jr(this.o===void 0,3512);const a=m=>{m.error!=null&&$n("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${m.error.message}`);const v=m.token!==this.m;return this.m=m.token,$n("FirebaseAppCheckTokenProvider",`Received ${v?"new":"existing"} token.`),v?n(m.token):Promise.resolve()};this.o=m=>{e.enqueueRetryable(()=>a(m))};const h=m=>{$n("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=m,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(m=>h(m)),setTimeout(()=>{if(!this.appCheck){const m=this.V.getImmediate({optional:!0});m?h(m):$n("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Bz(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Jr(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new Bz(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $Y(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let a=0;a<t;a++)n[a]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CP{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const h=$Y(40);for(let m=0;m<h.length;++m)a.length<20&&h[m]<n&&(a+=e.charAt(h[m]%62))}return a}}function Ir(t,e){return t<e?-1:t>e?1:0}function gC(t,e){const n=Math.min(t.length,e.length);for(let a=0;a<n;a++){const h=t.charAt(a),m=e.charAt(a);if(h!==m)return PS(h)===PS(m)?Ir(h,m):PS(h)?1:-1}return Ir(t.length,e.length)}const HY=55296,qY=57343;function PS(t){const e=t.charCodeAt(0);return e>=HY&&e<=qY}function Lg(t,e,n){return t.length===e.length&&t.every((a,h)=>n(a,e[h]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vz="__name__";class pu{constructor(e,n,a){n===void 0?n=0:n>e.length&&Oi(637,{offset:n,range:e.length}),a===void 0?a=e.length-n:a>e.length-n&&Oi(1746,{length:a,range:e.length-n}),this.segments=e,this.offset=n,this.len=a}get length(){return this.len}isEqual(e){return pu.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof pu?e.forEach(a=>{n.push(a)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,a=this.limit();n<a;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const a=Math.min(e.length,n.length);for(let h=0;h<a;h++){const m=pu.compareSegments(e.get(h),n.get(h));if(m!==0)return m}return Ir(e.length,n.length)}static compareSegments(e,n){const a=pu.isNumericId(e),h=pu.isNumericId(n);return a&&!h?-1:!a&&h?1:a&&h?pu.extractNumericId(e).compare(pu.extractNumericId(n)):gC(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Fd.fromString(e.substring(4,e.length-2))}}class vs extends pu{construct(e,n,a){return new vs(e,n,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const a of e){if(a.indexOf("//")>=0)throw new Bn(en.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);n.push(...a.split("/").filter(h=>h.length>0))}return new vs(n)}static emptyPath(){return new vs([])}}const WY=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Jo extends pu{construct(e,n,a){return new Jo(e,n,a)}static isValidIdentifier(e){return WY.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Jo.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Vz}static keyField(){return new Jo([Vz])}static fromServerFormat(e){const n=[];let a="",h=0;const m=()=>{if(a.length===0)throw new Bn(en.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(a),a=""};let v=!1;for(;h<e.length;){const o=e[h];if(o==="\\"){if(h+1===e.length)throw new Bn(en.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const S=e[h+1];if(S!=="\\"&&S!=="."&&S!=="`")throw new Bn(en.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=S,h+=2}else o==="`"?(v=!v,h++):o!=="."||v?(a+=o,h++):(m(),h++)}if(m(),v)throw new Bn(en.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Jo(n)}static emptyPath(){return new Jo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e){this.path=e}static fromPath(e){return new pi(vs.fromString(e))}static fromName(e){return new pi(vs.fromString(e).popFirst(5))}static empty(){return new pi(vs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&vs.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return vs.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pi(new vs(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m5(t,e,n){if(!n)throw new Bn(en.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ZY(t,e,n,a){if(e===!0&&a===!0)throw new Bn(en.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Uz(t){if(!pi.isDocumentKey(t))throw new Bn(en.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function jz(t){if(pi.isDocumentKey(t))throw new Bn(en.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function g5(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function ST(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Oi(12329,{type:typeof t})}function Nd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Bn(en.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ST(t);throw new Bn(en.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function go(t,e){const n={typeString:t};return e&&(n.value=e),n}function $x(t,e){if(!g5(t))throw new Bn(en.INVALID_ARGUMENT,"JSON must be an object");let n;for(const a in e)if(e[a]){const h=e[a].typeString,m="value"in e[a]?{value:e[a].value}:void 0;if(!(a in t)){n=`JSON missing required field: '${a}'`;break}const v=t[a];if(h&&typeof v!==h){n=`JSON field '${a}' must be a ${h}.`;break}if(m!==void 0&&v!==m.value){n=`Expected '${a}' field to equal '${m.value}'`;break}}if(n)throw new Bn(en.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gz=-62135596800,$z=1e6;class Rs{static now(){return Rs.fromMillis(Date.now())}static fromDate(e){return Rs.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),a=Math.floor((e-1e3*n)*$z);return new Rs(n,a)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Bn(en.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Bn(en.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Gz)throw new Bn(en.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Bn(en.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$z}_compareTo(e){return this.seconds===e.seconds?Ir(this.nanoseconds,e.nanoseconds):Ir(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Rs._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if($x(e,Rs._jsonSchema))return new Rs(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Gz;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Rs._jsonSchemaVersion="firestore/timestamp/1.0",Rs._jsonSchema={type:go("string",Rs._jsonSchemaVersion),seconds:go("number"),nanoseconds:go("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{static fromTimestamp(e){return new qi(e)}static min(){return new qi(new Rs(0,0))}static max(){return new qi(new Rs(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yx=-1;function XY(t,e){const n=t.toTimestamp().seconds,a=t.toTimestamp().nanoseconds+1,h=qi.fromTimestamp(a===1e9?new Rs(n+1,0):new Rs(n,a));return new Hd(h,pi.empty(),e)}function KY(t){return new Hd(t.readTime,t.key,yx)}class Hd{constructor(e,n,a){this.readTime=e,this.documentKey=n,this.largestBatchId=a}static min(){return new Hd(qi.min(),pi.empty(),yx)}static max(){return new Hd(qi.max(),pi.empty(),yx)}}function YY(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=pi.comparator(t.documentKey,e.documentKey),n!==0?n:Ir(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QY="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class JY{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jg(t){if(t.code!==en.FAILED_PRECONDITION||t.message!==QY)throw t;$n("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Oi(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new nn((a,h)=>{this.nextCallback=m=>{this.wrapSuccess(e,m).next(a,h)},this.catchCallback=m=>{this.wrapFailure(n,m).next(a,h)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof nn?n:nn.resolve(n)}catch(n){return nn.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):nn.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):nn.reject(n)}static resolve(e){return new nn((n,a)=>{n(e)})}static reject(e){return new nn((n,a)=>{a(e)})}static waitFor(e){return new nn((n,a)=>{let h=0,m=0,v=!1;e.forEach(o=>{++h,o.next(()=>{++m,v&&m===h&&n()},S=>a(S))}),v=!0,m===h&&n()})}static or(e){let n=nn.resolve(!1);for(const a of e)n=n.next(h=>h?nn.resolve(h):a());return n}static forEach(e,n){const a=[];return e.forEach((h,m)=>{a.push(n.call(this,h,m))}),this.waitFor(a)}static mapArray(e,n){return new nn((a,h)=>{const m=e.length,v=new Array(m);let o=0;for(let S=0;S<m;S++){const P=S;n(e[P]).next(N=>{v[P]=N,++o,o===m&&a(v)},N=>h(N))}})}static doWhile(e,n){return new nn((a,h)=>{const m=()=>{e()===!0?n().next(()=>{m()},h):a()};m()})}}function eQ(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function e_(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AT{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=a=>this.ae(a),this.ue=a=>n.writeSequenceNumber(a))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}AT.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP=-1;function CT(t){return t==null}function Db(t){return t===0&&1/t==-1/0}function tQ(t){return typeof t=="number"&&Number.isInteger(t)&&!Db(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5="";function nQ(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Hz(e)),e=iQ(t.get(n),e);return Hz(e)}function iQ(t,e){let n=e;const a=t.length;for(let h=0;h<a;h++){const m=t.charAt(h);switch(m){case"\0":n+="";break;case _5:n+="";break;default:n+=m}}return n}function Hz(t){return t+_5+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qz(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function af(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function y5(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yo=class _C{constructor(e,n){this.comparator=e,this.root=n||Bd.EMPTY}insert(e,n){return new _C(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Bd.BLACK,null,null))}remove(e){return new _C(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Bd.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const a=this.comparator(e,n.key);if(a===0)return n.value;a<0?n=n.left:a>0&&(n=n.right)}return null}indexOf(e){let n=0,a=this.root;for(;!a.isEmpty();){const h=this.comparator(e,a.key);if(h===0)return n+a.left.size;h<0?a=a.left:(n+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,a)=>(e(n,a),!1))}toString(){const e=[];return this.inorderTraversal((n,a)=>(e.push(`${n}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new m1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new m1(this.root,e,this.comparator,!1)}getReverseIterator(){return new m1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new m1(this.root,e,this.comparator,!0)}},m1=class{constructor(e,n,a,h){this.isReverse=h,this.nodeStack=[];let m=1;for(;!e.isEmpty();)if(m=n?a(e.key,n):1,n&&h&&(m*=-1),m<0)e=this.isReverse?e.left:e.right;else{if(m===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Bd=class Ku{constructor(e,n,a,h,m){this.key=e,this.value=n,this.color=a??Ku.RED,this.left=h??Ku.EMPTY,this.right=m??Ku.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,a,h,m){return new Ku(e??this.key,n??this.value,a??this.color,h??this.left,m??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,a){let h=this;const m=a(e,h.key);return h=m<0?h.copy(null,null,null,h.left.insert(e,n,a),null):m===0?h.copy(null,n,null,null,null):h.copy(null,null,null,null,h.right.insert(e,n,a)),h.fixUp()}removeMin(){if(this.left.isEmpty())return Ku.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let a,h=this;if(n(e,h.key)<0)h.left.isEmpty()||h.left.isRed()||h.left.left.isRed()||(h=h.moveRedLeft()),h=h.copy(null,null,null,h.left.remove(e,n),null);else{if(h.left.isRed()&&(h=h.rotateRight()),h.right.isEmpty()||h.right.isRed()||h.right.left.isRed()||(h=h.moveRedRight()),n(e,h.key)===0){if(h.right.isEmpty())return Ku.EMPTY;a=h.right.min(),h=h.copy(a.key,a.value,null,null,h.right.removeMin())}h=h.copy(null,null,null,null,h.right.remove(e,n))}return h.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ku.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ku.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Oi(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Oi(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Oi(27949);return e+(this.isRed()?0:1)}};Bd.EMPTY=null,Bd.RED=!0,Bd.BLACK=!1;Bd.EMPTY=new class{constructor(){this.size=0}get key(){throw Oi(57766)}get value(){throw Oi(16141)}get color(){throw Oi(16727)}get left(){throw Oi(29726)}get right(){throw Oi(36894)}copy(e,n,a,h,m){return this}insert(e,n,a){return new Bd(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e){this.comparator=e,this.data=new yo(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,a)=>(e(n),!1))}forEachInRange(e,n){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const h=a.getNext();if(this.comparator(h.key,e[1])>=0)return;n(h.key)}}forEachWhile(e,n){let a;for(a=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Wz(this.data.getIterator())}getIteratorFrom(e){return new Wz(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(a=>{n=n.add(a)}),n}isEqual(e){if(!(e instanceof Co)||this.size!==e.size)return!1;const n=this.data.getIterator(),a=e.data.getIterator();for(;n.hasNext();){const h=n.getNext().key,m=a.getNext().key;if(this.comparator(h,m)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Co(this.comparator);return n.data=e,n}}class Wz{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il{constructor(e){this.fields=e,e.sort(Jo.comparator)}static empty(){return new Il([])}unionWith(e){let n=new Co(Jo.comparator);for(const a of this.fields)n=n.add(a);for(const a of e)n=n.add(a);return new Il(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Lg(this.fields,e.fields,(n,a)=>n.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(h){try{return atob(h)}catch(m){throw typeof DOMException<"u"&&m instanceof DOMException?new v5("Invalid base64 string: "+m):m}}(e);return new na(n)}static fromUint8Array(e){const n=function(h){let m="";for(let v=0;v<h.length;++v)m+=String.fromCharCode(h[v]);return m}(e);return new na(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const a=new Uint8Array(n.length);for(let h=0;h<n.length;h++)a[h]=n.charCodeAt(h);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ir(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}na.EMPTY_BYTE_STRING=new na("");const rQ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qd(t){if(Jr(!!t,39018),typeof t=="string"){let e=0;const n=rQ.exec(t);if(Jr(!!n,46558,{timestamp:t}),n[1]){let h=n[1];h=(h+"000000000").substr(0,9),e=Number(h)}const a=new Date(t);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:to(t.seconds),nanos:to(t.nanos)}}function to(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Wd(t){return typeof t=="string"?na.fromBase64String(t):na.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x5="server_timestamp",w5="__type__",b5="__previous_value__",T5="__local_write_time__";function RP(t){var n,a;return((a=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[w5])==null?void 0:a.stringValue)===x5}function PT(t){const e=t.mapValue.fields[b5];return RP(e)?PT(e):e}function vx(t){const e=qd(t.mapValue.fields[T5].timestampValue);return new Rs(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sQ{constructor(e,n,a,h,m,v,o,S,P,N){this.databaseId=e,this.appId=n,this.persistenceKey=a,this.host=h,this.ssl=m,this.forceLongPolling=v,this.autoDetectLongPolling=o,this.longPollingOptions=S,this.useFetchStreams=P,this.isUsingEmulator=N}}const Lb="(default)";class xx{constructor(e,n){this.projectId=e,this.database=n||Lb}static empty(){return new xx("","")}get isDefaultDatabase(){return this.database===Lb}isEqual(e){return e instanceof xx&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E5="__type__",oQ="__max__",g1={mapValue:{}},I5="__vector__",Ob="value";function Zd(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?RP(t)?4:lQ(t)?9007199254740991:aQ(t)?10:11:Oi(28295,{value:t})}function Iu(t,e){if(t===e)return!0;const n=Zd(t);if(n!==Zd(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return vx(t).isEqual(vx(e));case 3:return function(h,m){if(typeof h.timestampValue=="string"&&typeof m.timestampValue=="string"&&h.timestampValue.length===m.timestampValue.length)return h.timestampValue===m.timestampValue;const v=qd(h.timestampValue),o=qd(m.timestampValue);return v.seconds===o.seconds&&v.nanos===o.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(h,m){return Wd(h.bytesValue).isEqual(Wd(m.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(h,m){return to(h.geoPointValue.latitude)===to(m.geoPointValue.latitude)&&to(h.geoPointValue.longitude)===to(m.geoPointValue.longitude)}(t,e);case 2:return function(h,m){if("integerValue"in h&&"integerValue"in m)return to(h.integerValue)===to(m.integerValue);if("doubleValue"in h&&"doubleValue"in m){const v=to(h.doubleValue),o=to(m.doubleValue);return v===o?Db(v)===Db(o):isNaN(v)&&isNaN(o)}return!1}(t,e);case 9:return Lg(t.arrayValue.values||[],e.arrayValue.values||[],Iu);case 10:case 11:return function(h,m){const v=h.mapValue.fields||{},o=m.mapValue.fields||{};if(qz(v)!==qz(o))return!1;for(const S in v)if(v.hasOwnProperty(S)&&(o[S]===void 0||!Iu(v[S],o[S])))return!1;return!0}(t,e);default:return Oi(52216,{left:t})}}function wx(t,e){return(t.values||[]).find(n=>Iu(n,e))!==void 0}function Og(t,e){if(t===e)return 0;const n=Zd(t),a=Zd(e);if(n!==a)return Ir(n,a);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ir(t.booleanValue,e.booleanValue);case 2:return function(m,v){const o=to(m.integerValue||m.doubleValue),S=to(v.integerValue||v.doubleValue);return o<S?-1:o>S?1:o===S?0:isNaN(o)?isNaN(S)?0:-1:1}(t,e);case 3:return Zz(t.timestampValue,e.timestampValue);case 4:return Zz(vx(t),vx(e));case 5:return gC(t.stringValue,e.stringValue);case 6:return function(m,v){const o=Wd(m),S=Wd(v);return o.compareTo(S)}(t.bytesValue,e.bytesValue);case 7:return function(m,v){const o=m.split("/"),S=v.split("/");for(let P=0;P<o.length&&P<S.length;P++){const N=Ir(o[P],S[P]);if(N!==0)return N}return Ir(o.length,S.length)}(t.referenceValue,e.referenceValue);case 8:return function(m,v){const o=Ir(to(m.latitude),to(v.latitude));return o!==0?o:Ir(to(m.longitude),to(v.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Xz(t.arrayValue,e.arrayValue);case 10:return function(m,v){var j,Q,oe,me;const o=m.fields||{},S=v.fields||{},P=(j=o[Ob])==null?void 0:j.arrayValue,N=(Q=S[Ob])==null?void 0:Q.arrayValue,V=Ir(((oe=P==null?void 0:P.values)==null?void 0:oe.length)||0,((me=N==null?void 0:N.values)==null?void 0:me.length)||0);return V!==0?V:Xz(P,N)}(t.mapValue,e.mapValue);case 11:return function(m,v){if(m===g1.mapValue&&v===g1.mapValue)return 0;if(m===g1.mapValue)return 1;if(v===g1.mapValue)return-1;const o=m.fields||{},S=Object.keys(o),P=v.fields||{},N=Object.keys(P);S.sort(),N.sort();for(let V=0;V<S.length&&V<N.length;++V){const j=gC(S[V],N[V]);if(j!==0)return j;const Q=Og(o[S[V]],P[N[V]]);if(Q!==0)return Q}return Ir(S.length,N.length)}(t.mapValue,e.mapValue);default:throw Oi(23264,{he:n})}}function Zz(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ir(t,e);const n=qd(t),a=qd(e),h=Ir(n.seconds,a.seconds);return h!==0?h:Ir(n.nanos,a.nanos)}function Xz(t,e){const n=t.values||[],a=e.values||[];for(let h=0;h<n.length&&h<a.length;++h){const m=Og(n[h],a[h]);if(m)return m}return Ir(n.length,a.length)}function zg(t){return yC(t)}function yC(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const a=qd(n);return`time(${a.seconds},${a.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Wd(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return pi.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let a="[",h=!0;for(const m of n.values||[])h?h=!1:a+=",",a+=yC(m);return a+"]"}(t.arrayValue):"mapValue"in t?function(n){const a=Object.keys(n.fields||{}).sort();let h="{",m=!0;for(const v of a)m?m=!1:h+=",",h+=`${v}:${yC(n.fields[v])}`;return h+"}"}(t.mapValue):Oi(61005,{value:t})}function $1(t){switch(Zd(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=PT(t);return e?16+$1(e):16;case 5:return 2*t.stringValue.length;case 6:return Wd(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((h,m)=>h+$1(m),0)}(t.arrayValue);case 10:case 11:return function(a){let h=0;return af(a.fields,(m,v)=>{h+=m.length+$1(v)}),h}(t.mapValue);default:throw Oi(13486,{value:t})}}function Kz(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function vC(t){return!!t&&"integerValue"in t}function kP(t){return!!t&&"arrayValue"in t}function Yz(t){return!!t&&"nullValue"in t}function Qz(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function H1(t){return!!t&&"mapValue"in t}function aQ(t){var n,a;return((a=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[E5])==null?void 0:a.stringValue)===I5}function Nv(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return af(t.mapValue.fields,(n,a)=>e.mapValue.fields[n]=Nv(a)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Nv(t.arrayValue.values[n]);return e}return{...t}}function lQ(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===oQ}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e){this.value=e}static empty(){return new nl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let a=0;a<e.length-1;++a)if(n=(n.mapValue.fields||{})[e.get(a)],!H1(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Nv(n)}setAll(e){let n=Jo.emptyPath(),a={},h=[];e.forEach((v,o)=>{if(!n.isImmediateParentOf(o)){const S=this.getFieldsMap(n);this.applyChanges(S,a,h),a={},h=[],n=o.popLast()}v?a[o.lastSegment()]=Nv(v):h.push(o.lastSegment())});const m=this.getFieldsMap(n);this.applyChanges(m,a,h)}delete(e){const n=this.field(e.popLast());H1(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Iu(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let a=0;a<e.length;++a){let h=n.mapValue.fields[e.get(a)];H1(h)&&h.mapValue.fields||(h={mapValue:{fields:{}}},n.mapValue.fields[e.get(a)]=h),n=h}return n.mapValue.fields}applyChanges(e,n,a){af(n,(h,m)=>e[h]=m);for(const h of a)delete e[h]}clone(){return new nl(Nv(this.value))}}function S5(t){const e=[];return af(t.fields,(n,a)=>{const h=new Jo([n]);if(H1(a)){const m=S5(a.mapValue).fields;if(m.length===0)e.push(h);else for(const v of m)e.push(h.child(v))}else e.push(h)}),new Il(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma{constructor(e,n,a,h,m,v,o){this.key=e,this.documentType=n,this.version=a,this.readTime=h,this.createTime=m,this.data=v,this.documentState=o}static newInvalidDocument(e){return new ma(e,0,qi.min(),qi.min(),qi.min(),nl.empty(),0)}static newFoundDocument(e,n,a,h){return new ma(e,1,n,qi.min(),a,h,0)}static newNoDocument(e,n){return new ma(e,2,n,qi.min(),qi.min(),nl.empty(),0)}static newUnknownDocument(e,n){return new ma(e,3,n,qi.min(),qi.min(),nl.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(qi.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=qi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ma&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ma(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zb{constructor(e,n){this.position=e,this.inclusive=n}}function Jz(t,e,n){let a=0;for(let h=0;h<t.position.length;h++){const m=e[h],v=t.position[h];if(m.field.isKeyField()?a=pi.comparator(pi.fromName(v.referenceValue),n.key):a=Og(v,n.data.field(m.field)),m.dir==="desc"&&(a*=-1),a!==0)break}return a}function eF(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Iu(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx{constructor(e,n="asc"){this.field=e,this.dir=n}}function cQ(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{}class mo extends A5{constructor(e,n,a){super(),this.field=e,this.op=n,this.value=a}static create(e,n,a){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,a):new hQ(e,n,a):n==="array-contains"?new pQ(e,a):n==="in"?new mQ(e,a):n==="not-in"?new gQ(e,a):n==="array-contains-any"?new _Q(e,a):new mo(e,n,a)}static createKeyFieldInFilter(e,n,a){return n==="in"?new dQ(e,a):new fQ(e,a)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Og(n,this.value)):n!==null&&Zd(this.value)===Zd(n)&&this.matchesComparison(Og(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Oi(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Lc extends A5{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new Lc(e,n)}matches(e){return C5(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function C5(t){return t.op==="and"}function P5(t){return uQ(t)&&C5(t)}function uQ(t){for(const e of t.filters)if(e instanceof Lc)return!1;return!0}function xC(t){if(t instanceof mo)return t.field.canonicalString()+t.op.toString()+zg(t.value);if(P5(t))return t.filters.map(e=>xC(e)).join(",");{const e=t.filters.map(n=>xC(n)).join(",");return`${t.op}(${e})`}}function R5(t,e){return t instanceof mo?function(a,h){return h instanceof mo&&a.op===h.op&&a.field.isEqual(h.field)&&Iu(a.value,h.value)}(t,e):t instanceof Lc?function(a,h){return h instanceof Lc&&a.op===h.op&&a.filters.length===h.filters.length?a.filters.reduce((m,v,o)=>m&&R5(v,h.filters[o]),!0):!1}(t,e):void Oi(19439)}function k5(t){return t instanceof mo?function(n){return`${n.field.canonicalString()} ${n.op} ${zg(n.value)}`}(t):t instanceof Lc?function(n){return n.op.toString()+" {"+n.getFilters().map(k5).join(" ,")+"}"}(t):"Filter"}class hQ extends mo{constructor(e,n,a){super(e,n,a),this.key=pi.fromName(a.referenceValue)}matches(e){const n=pi.comparator(e.key,this.key);return this.matchesComparison(n)}}class dQ extends mo{constructor(e,n){super(e,"in",n),this.keys=M5("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class fQ extends mo{constructor(e,n){super(e,"not-in",n),this.keys=M5("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function M5(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(a=>pi.fromName(a.referenceValue))}class pQ extends mo{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return kP(n)&&wx(n.arrayValue,this.value)}}class mQ extends mo{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&wx(this.value.arrayValue,n)}}class gQ extends mo{constructor(e,n){super(e,"not-in",n)}matches(e){if(wx(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!wx(this.value.arrayValue,n)}}class _Q extends mo{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!kP(n)||!n.arrayValue.values)&&n.arrayValue.values.some(a=>wx(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yQ{constructor(e,n=null,a=[],h=[],m=null,v=null,o=null){this.path=e,this.collectionGroup=n,this.orderBy=a,this.filters=h,this.limit=m,this.startAt=v,this.endAt=o,this.Te=null}}function tF(t,e=null,n=[],a=[],h=null,m=null,v=null){return new yQ(t,e,n,a,h,m,v)}function MP(t){const e=Yi(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(a=>xC(a)).join(","),n+="|ob:",n+=e.orderBy.map(a=>function(m){return m.field.canonicalString()+m.dir}(a)).join(","),CT(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(a=>zg(a)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(a=>zg(a)).join(",")),e.Te=n}return e.Te}function DP(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!cQ(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!R5(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!eF(t.startAt,e.startAt)&&eF(t.endAt,e.endAt)}function wC(t){return pi.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(e,n=null,a=[],h=[],m=null,v="F",o=null,S=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=a,this.filters=h,this.limit=m,this.limitType=v,this.startAt=o,this.endAt=S,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function vQ(t,e,n,a,h,m,v,o){return new t_(t,e,n,a,h,m,v,o)}function LP(t){return new t_(t)}function nF(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function D5(t){return t.collectionGroup!==null}function Bv(t){const e=Yi(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const m of e.explicitOrderBy)e.Ie.push(m),n.add(m.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(v){let o=new Co(Jo.comparator);return v.filters.forEach(S=>{S.getFlattenedFilters().forEach(P=>{P.isInequality()&&(o=o.add(P.field))})}),o})(e).forEach(m=>{n.has(m.canonicalString())||m.isKeyField()||e.Ie.push(new bx(m,a))}),n.has(Jo.keyField().canonicalString())||e.Ie.push(new bx(Jo.keyField(),a))}return e.Ie}function wu(t){const e=Yi(t);return e.Ee||(e.Ee=xQ(e,Bv(t))),e.Ee}function xQ(t,e){if(t.limitType==="F")return tF(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(h=>{const m=h.dir==="desc"?"asc":"desc";return new bx(h.field,m)});const n=t.endAt?new zb(t.endAt.position,t.endAt.inclusive):null,a=t.startAt?new zb(t.startAt.position,t.startAt.inclusive):null;return tF(t.path,t.collectionGroup,e,t.filters,t.limit,n,a)}}function bC(t,e){const n=t.filters.concat([e]);return new t_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function TC(t,e,n){return new t_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function RT(t,e){return DP(wu(t),wu(e))&&t.limitType===e.limitType}function L5(t){return`${MP(wu(t))}|lt:${t.limitType}`}function qm(t){return`Query(target=${function(n){let a=n.path.canonicalString();return n.collectionGroup!==null&&(a+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(a+=`, filters: [${n.filters.map(h=>k5(h)).join(", ")}]`),CT(n.limit)||(a+=", limit: "+n.limit),n.orderBy.length>0&&(a+=`, orderBy: [${n.orderBy.map(h=>function(v){return`${v.field.canonicalString()} (${v.dir})`}(h)).join(", ")}]`),n.startAt&&(a+=", startAt: ",a+=n.startAt.inclusive?"b:":"a:",a+=n.startAt.position.map(h=>zg(h)).join(",")),n.endAt&&(a+=", endAt: ",a+=n.endAt.inclusive?"a:":"b:",a+=n.endAt.position.map(h=>zg(h)).join(",")),`Target(${a})`}(wu(t))}; limitType=${t.limitType})`}function kT(t,e){return e.isFoundDocument()&&function(a,h){const m=h.key.path;return a.collectionGroup!==null?h.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(m):pi.isDocumentKey(a.path)?a.path.isEqual(m):a.path.isImmediateParentOf(m)}(t,e)&&function(a,h){for(const m of Bv(a))if(!m.field.isKeyField()&&h.data.field(m.field)===null)return!1;return!0}(t,e)&&function(a,h){for(const m of a.filters)if(!m.matches(h))return!1;return!0}(t,e)&&function(a,h){return!(a.startAt&&!function(v,o,S){const P=Jz(v,o,S);return v.inclusive?P<=0:P<0}(a.startAt,Bv(a),h)||a.endAt&&!function(v,o,S){const P=Jz(v,o,S);return v.inclusive?P>=0:P>0}(a.endAt,Bv(a),h))}(t,e)}function wQ(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function O5(t){return(e,n)=>{let a=!1;for(const h of Bv(t)){const m=bQ(h,e,n);if(m!==0)return m;a=a||h.field.isKeyField()}return 0}}function bQ(t,e,n){const a=t.field.isKeyField()?pi.comparator(e.key,n.key):function(m,v,o){const S=v.data.field(m),P=o.data.field(m);return S!==null&&P!==null?Og(S,P):Oi(42886)}(t.field,e,n);switch(t.dir){case"asc":return a;case"desc":return-1*a;default:return Oi(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),a=this.inner[n];if(a!==void 0){for(const[h,m]of a)if(this.equalsFn(h,e))return m}}has(e){return this.get(e)!==void 0}set(e,n){const a=this.mapKeyFn(e),h=this.inner[a];if(h===void 0)return this.inner[a]=[[e,n]],void this.innerSize++;for(let m=0;m<h.length;m++)if(this.equalsFn(h[m][0],e))return void(h[m]=[e,n]);h.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),a=this.inner[n];if(a===void 0)return!1;for(let h=0;h<a.length;h++)if(this.equalsFn(a[h][0],e))return a.length===1?delete this.inner[n]:a.splice(h,1),this.innerSize--,!0;return!1}forEach(e){af(this.inner,(n,a)=>{for(const[h,m]of a)e(h,m)})}isEmpty(){return y5(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TQ=new yo(pi.comparator);function xh(){return TQ}const z5=new yo(pi.comparator);function Ev(...t){let e=z5;for(const n of t)e=e.insert(n.key,n);return e}function F5(t){let e=z5;return t.forEach((n,a)=>e=e.insert(n,a.overlayedDocument)),e}function Qf(){return Vv()}function N5(){return Vv()}function Vv(){return new Tp(t=>t.toString(),(t,e)=>t.isEqual(e))}const EQ=new yo(pi.comparator),IQ=new Co(pi.comparator);function Sr(...t){let e=IQ;for(const n of t)e=e.add(n);return e}const SQ=new Co(Ir);function AQ(){return SQ}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OP(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Db(e)?"-0":e}}function B5(t){return{integerValue:""+t}}function CQ(t,e){return tQ(e)?B5(e):OP(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MT{constructor(){this._=void 0}}function PQ(t,e,n){return t instanceof Tx?function(h,m){const v={fields:{[w5]:{stringValue:x5},[T5]:{timestampValue:{seconds:h.seconds,nanos:h.nanoseconds}}}};return m&&RP(m)&&(m=PT(m)),m&&(v.fields[b5]=m),{mapValue:v}}(n,e):t instanceof Fg?U5(t,e):t instanceof Ng?j5(t,e):function(h,m){const v=V5(h,m),o=iF(v)+iF(h.Ae);return vC(v)&&vC(h.Ae)?B5(o):OP(h.serializer,o)}(t,e)}function RQ(t,e,n){return t instanceof Fg?U5(t,e):t instanceof Ng?j5(t,e):n}function V5(t,e){return t instanceof Fb?function(a){return vC(a)||function(m){return!!m&&"doubleValue"in m}(a)}(e)?e:{integerValue:0}:null}class Tx extends MT{}class Fg extends MT{constructor(e){super(),this.elements=e}}function U5(t,e){const n=G5(e);for(const a of t.elements)n.some(h=>Iu(h,a))||n.push(a);return{arrayValue:{values:n}}}class Ng extends MT{constructor(e){super(),this.elements=e}}function j5(t,e){let n=G5(e);for(const a of t.elements)n=n.filter(h=>!Iu(h,a));return{arrayValue:{values:n}}}class Fb extends MT{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function iF(t){return to(t.integerValue||t.doubleValue)}function G5(t){return kP(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zP{constructor(e,n){this.field=e,this.transform=n}}function kQ(t,e){return t.field.isEqual(e.field)&&function(a,h){return a instanceof Fg&&h instanceof Fg||a instanceof Ng&&h instanceof Ng?Lg(a.elements,h.elements,Iu):a instanceof Fb&&h instanceof Fb?Iu(a.Ae,h.Ae):a instanceof Tx&&h instanceof Tx}(t.transform,e.transform)}class MQ{constructor(e,n){this.version=e,this.transformResults=n}}class Pc{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Pc}static exists(e){return new Pc(void 0,e)}static updateTime(e){return new Pc(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function q1(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class DT{}function $5(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new FP(t.key,Pc.none()):new Hx(t.key,t.data,Pc.none());{const n=t.data,a=nl.empty();let h=new Co(Jo.comparator);for(let m of e.fields)if(!h.has(m)){let v=n.field(m);v===null&&m.length>1&&(m=m.popLast(),v=n.field(m)),v===null?a.delete(m):a.set(m,v),h=h.add(m)}return new lf(t.key,a,new Il(h.toArray()),Pc.none())}}function DQ(t,e,n){t instanceof Hx?function(h,m,v){const o=h.value.clone(),S=sF(h.fieldTransforms,m,v.transformResults);o.setAll(S),m.convertToFoundDocument(v.version,o).setHasCommittedMutations()}(t,e,n):t instanceof lf?function(h,m,v){if(!q1(h.precondition,m))return void m.convertToUnknownDocument(v.version);const o=sF(h.fieldTransforms,m,v.transformResults),S=m.data;S.setAll(H5(h)),S.setAll(o),m.convertToFoundDocument(v.version,S).setHasCommittedMutations()}(t,e,n):function(h,m,v){m.convertToNoDocument(v.version).setHasCommittedMutations()}(0,e,n)}function Uv(t,e,n,a){return t instanceof Hx?function(m,v,o,S){if(!q1(m.precondition,v))return o;const P=m.value.clone(),N=oF(m.fieldTransforms,S,v);return P.setAll(N),v.convertToFoundDocument(v.version,P).setHasLocalMutations(),null}(t,e,n,a):t instanceof lf?function(m,v,o,S){if(!q1(m.precondition,v))return o;const P=oF(m.fieldTransforms,S,v),N=v.data;return N.setAll(H5(m)),N.setAll(P),v.convertToFoundDocument(v.version,N).setHasLocalMutations(),o===null?null:o.unionWith(m.fieldMask.fields).unionWith(m.fieldTransforms.map(V=>V.field))}(t,e,n,a):function(m,v,o){return q1(m.precondition,v)?(v.convertToNoDocument(v.version).setHasLocalMutations(),null):o}(t,e,n)}function LQ(t,e){let n=null;for(const a of t.fieldTransforms){const h=e.data.field(a.field),m=V5(a.transform,h||null);m!=null&&(n===null&&(n=nl.empty()),n.set(a.field,m))}return n||null}function rF(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(a,h){return a===void 0&&h===void 0||!(!a||!h)&&Lg(a,h,(m,v)=>kQ(m,v))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Hx extends DT{constructor(e,n,a,h=[]){super(),this.key=e,this.value=n,this.precondition=a,this.fieldTransforms=h,this.type=0}getFieldMask(){return null}}class lf extends DT{constructor(e,n,a,h,m=[]){super(),this.key=e,this.data=n,this.fieldMask=a,this.precondition=h,this.fieldTransforms=m,this.type=1}getFieldMask(){return this.fieldMask}}function H5(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const a=t.data.field(n);e.set(n,a)}}),e}function sF(t,e,n){const a=new Map;Jr(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let h=0;h<n.length;h++){const m=t[h],v=m.transform,o=e.data.field(m.field);a.set(m.field,RQ(v,o,n[h]))}return a}function oF(t,e,n){const a=new Map;for(const h of t){const m=h.transform,v=n.data.field(h.field);a.set(h.field,PQ(m,v,e))}return a}class FP extends DT{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class OQ extends DT{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zQ{constructor(e,n,a,h){this.batchId=e,this.localWriteTime=n,this.baseMutations=a,this.mutations=h}applyToRemoteDocument(e,n){const a=n.mutationResults;for(let h=0;h<this.mutations.length;h++){const m=this.mutations[h];m.key.isEqual(e.key)&&DQ(m,e,a[h])}}applyToLocalView(e,n){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(n=Uv(a,e,n,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(n=Uv(a,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const a=N5();return this.mutations.forEach(h=>{const m=e.get(h.key),v=m.overlayedDocument;let o=this.applyToLocalView(v,m.mutatedFields);o=n.has(h.key)?null:o;const S=$5(v,o);S!==null&&a.set(h.key,S),v.isValidDocument()||v.convertToNoDocument(qi.min())}),a}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Sr())}isEqual(e){return this.batchId===e.batchId&&Lg(this.mutations,e.mutations,(n,a)=>rF(n,a))&&Lg(this.baseMutations,e.baseMutations,(n,a)=>rF(n,a))}}class NP{constructor(e,n,a,h){this.batch=e,this.commitVersion=n,this.mutationResults=a,this.docVersions=h}static from(e,n,a){Jr(e.mutations.length===a.length,58842,{me:e.mutations.length,fe:a.length});let h=function(){return EQ}();const m=e.mutations;for(let v=0;v<m.length;v++)h=h.insert(m[v].key,a[v].version);return new NP(e,n,a,h)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FQ{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NQ{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ho,Lr;function BQ(t){switch(t){case en.OK:return Oi(64938);case en.CANCELLED:case en.UNKNOWN:case en.DEADLINE_EXCEEDED:case en.RESOURCE_EXHAUSTED:case en.INTERNAL:case en.UNAVAILABLE:case en.UNAUTHENTICATED:return!1;case en.INVALID_ARGUMENT:case en.NOT_FOUND:case en.ALREADY_EXISTS:case en.PERMISSION_DENIED:case en.FAILED_PRECONDITION:case en.ABORTED:case en.OUT_OF_RANGE:case en.UNIMPLEMENTED:case en.DATA_LOSS:return!0;default:return Oi(15467,{code:t})}}function q5(t){if(t===void 0)return vh("GRPC error has no .code"),en.UNKNOWN;switch(t){case ho.OK:return en.OK;case ho.CANCELLED:return en.CANCELLED;case ho.UNKNOWN:return en.UNKNOWN;case ho.DEADLINE_EXCEEDED:return en.DEADLINE_EXCEEDED;case ho.RESOURCE_EXHAUSTED:return en.RESOURCE_EXHAUSTED;case ho.INTERNAL:return en.INTERNAL;case ho.UNAVAILABLE:return en.UNAVAILABLE;case ho.UNAUTHENTICATED:return en.UNAUTHENTICATED;case ho.INVALID_ARGUMENT:return en.INVALID_ARGUMENT;case ho.NOT_FOUND:return en.NOT_FOUND;case ho.ALREADY_EXISTS:return en.ALREADY_EXISTS;case ho.PERMISSION_DENIED:return en.PERMISSION_DENIED;case ho.FAILED_PRECONDITION:return en.FAILED_PRECONDITION;case ho.ABORTED:return en.ABORTED;case ho.OUT_OF_RANGE:return en.OUT_OF_RANGE;case ho.UNIMPLEMENTED:return en.UNIMPLEMENTED;case ho.DATA_LOSS:return en.DATA_LOSS;default:return Oi(39323,{code:t})}}(Lr=ho||(ho={}))[Lr.OK=0]="OK",Lr[Lr.CANCELLED=1]="CANCELLED",Lr[Lr.UNKNOWN=2]="UNKNOWN",Lr[Lr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Lr[Lr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Lr[Lr.NOT_FOUND=5]="NOT_FOUND",Lr[Lr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Lr[Lr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Lr[Lr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Lr[Lr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Lr[Lr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Lr[Lr.ABORTED=10]="ABORTED",Lr[Lr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Lr[Lr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Lr[Lr.INTERNAL=13]="INTERNAL",Lr[Lr.UNAVAILABLE=14]="UNAVAILABLE",Lr[Lr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VQ(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UQ=new Fd([4294967295,4294967295],0);function aF(t){const e=VQ().encode(t),n=new a5;return n.update(e),new Uint8Array(n.digest())}function lF(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),a=e.getUint32(4,!0),h=e.getUint32(8,!0),m=e.getUint32(12,!0);return[new Fd([n,a],0),new Fd([h,m],0)]}class BP{constructor(e,n,a){if(this.bitmap=e,this.padding=n,this.hashCount=a,n<0||n>=8)throw new Iv(`Invalid padding: ${n}`);if(a<0)throw new Iv(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new Iv(`Invalid hash count: ${a}`);if(e.length===0&&n!==0)throw new Iv(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Fd.fromNumber(this.ge)}ye(e,n,a){let h=e.add(n.multiply(Fd.fromNumber(a)));return h.compare(UQ)===1&&(h=new Fd([h.getBits(0),h.getBits(1)],0)),h.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=aF(e),[a,h]=lF(n);for(let m=0;m<this.hashCount;m++){const v=this.ye(a,h,m);if(!this.we(v))return!1}return!0}static create(e,n,a){const h=e%8==0?0:8-e%8,m=new Uint8Array(Math.ceil(e/8)),v=new BP(m,h,n);return a.forEach(o=>v.insert(o)),v}insert(e){if(this.ge===0)return;const n=aF(e),[a,h]=lF(n);for(let m=0;m<this.hashCount;m++){const v=this.ye(a,h,m);this.Se(v)}}Se(e){const n=Math.floor(e/8),a=e%8;this.bitmap[n]|=1<<a}}class Iv extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LT{constructor(e,n,a,h,m){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=a,this.documentUpdates=h,this.resolvedLimboDocuments=m}static createSynthesizedRemoteEventForCurrentChange(e,n,a){const h=new Map;return h.set(e,qx.createSynthesizedTargetChangeForCurrentChange(e,n,a)),new LT(qi.min(),h,new yo(Ir),xh(),Sr())}}class qx{constructor(e,n,a,h,m){this.resumeToken=e,this.current=n,this.addedDocuments=a,this.modifiedDocuments=h,this.removedDocuments=m}static createSynthesizedTargetChangeForCurrentChange(e,n,a){return new qx(a,n,Sr(),Sr(),Sr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W1{constructor(e,n,a,h){this.be=e,this.removedTargetIds=n,this.key=a,this.De=h}}class W5{constructor(e,n){this.targetId=e,this.Ce=n}}class Z5{constructor(e,n,a=na.EMPTY_BYTE_STRING,h=null){this.state=e,this.targetIds=n,this.resumeToken=a,this.cause=h}}class cF{constructor(){this.ve=0,this.Fe=uF(),this.Me=na.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Sr(),n=Sr(),a=Sr();return this.Fe.forEach((h,m)=>{switch(m){case 0:e=e.add(h);break;case 2:n=n.add(h);break;case 1:a=a.add(h);break;default:Oi(38017,{changeType:m})}}),new qx(this.Me,this.xe,e,n,a)}qe(){this.Oe=!1,this.Fe=uF()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Jr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class jQ{constructor(e){this.Ge=e,this.ze=new Map,this.je=xh(),this.Je=_1(),this.He=_1(),this.Ye=new yo(Ir)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const a=this.nt(n);switch(e.state){case 0:this.rt(n)&&a.Le(e.resumeToken);break;case 1:a.Ke(),a.Ne||a.qe(),a.Le(e.resumeToken);break;case 2:a.Ke(),a.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(a.We(),a.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),a.Le(e.resumeToken));break;default:Oi(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((a,h)=>{this.rt(h)&&n(h)})}st(e){const n=e.targetId,a=e.Ce.count,h=this.ot(n);if(h){const m=h.target;if(wC(m))if(a===0){const v=new pi(m.path);this.et(n,v,ma.newNoDocument(v,qi.min()))}else Jr(a===1,20013,{expectedCount:a});else{const v=this._t(n);if(v!==a){const o=this.ut(e),S=o?this.ct(o,e,v):1;if(S!==0){this.it(n);const P=S===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,P)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:a="",padding:h=0},hashCount:m=0}=n;let v,o;try{v=Wd(a).toUint8Array()}catch(S){if(S instanceof v5)return Dg("Decoding the base64 bloom filter in existence filter failed ("+S.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw S}try{o=new BP(v,h,m)}catch(S){return Dg(S instanceof Iv?"BloomFilter error: ":"Applying bloom filter failed: ",S),null}return o.ge===0?null:o}ct(e,n,a){return n.Ce.count===a-this.Pt(e,n.targetId)?0:2}Pt(e,n){const a=this.Ge.getRemoteKeysForTarget(n);let h=0;return a.forEach(m=>{const v=this.Ge.ht(),o=`projects/${v.projectId}/databases/${v.database}/documents/${m.path.canonicalString()}`;e.mightContain(o)||(this.et(n,m,null),h++)}),h}Tt(e){const n=new Map;this.ze.forEach((m,v)=>{const o=this.ot(v);if(o){if(m.current&&wC(o.target)){const S=new pi(o.target.path);this.It(S).has(v)||this.Et(v,S)||this.et(v,S,ma.newNoDocument(S,e))}m.Be&&(n.set(v,m.ke()),m.qe())}});let a=Sr();this.He.forEach((m,v)=>{let o=!0;v.forEachWhile(S=>{const P=this.ot(S);return!P||P.purpose==="TargetPurposeLimboResolution"||(o=!1,!1)}),o&&(a=a.add(m))}),this.je.forEach((m,v)=>v.setReadTime(e));const h=new LT(e,n,this.Ye,this.je,a);return this.je=xh(),this.Je=_1(),this.He=_1(),this.Ye=new yo(Ir),h}Xe(e,n){if(!this.rt(e))return;const a=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,a),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,a){if(!this.rt(e))return;const h=this.nt(e);this.Et(e,n)?h.Qe(n,1):h.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),a&&(this.je=this.je.insert(n,a))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new cF,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Co(Ir),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Co(Ir),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||$n("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new cF),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function _1(){return new yo(pi.comparator)}function uF(){return new yo(pi.comparator)}const GQ={asc:"ASCENDING",desc:"DESCENDING"},$Q={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},HQ={and:"AND",or:"OR"};class qQ{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function EC(t,e){return t.useProto3Json||CT(e)?e:{value:e}}function Nb(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function X5(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function WQ(t,e){return Nb(t,e.toTimestamp())}function bu(t){return Jr(!!t,49232),qi.fromTimestamp(function(n){const a=qd(n);return new Rs(a.seconds,a.nanos)}(t))}function VP(t,e){return IC(t,e).canonicalString()}function IC(t,e){const n=function(h){return new vs(["projects",h.projectId,"databases",h.database])}(t).child("documents");return e===void 0?n:n.child(e)}function K5(t){const e=vs.fromString(t);return Jr(tU(e),10190,{key:e.toString()}),e}function SC(t,e){return VP(t.databaseId,e.path)}function RS(t,e){const n=K5(e);if(n.get(1)!==t.databaseId.projectId)throw new Bn(en.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Bn(en.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new pi(Q5(n))}function Y5(t,e){return VP(t.databaseId,e)}function ZQ(t){const e=K5(t);return e.length===4?vs.emptyPath():Q5(e)}function AC(t){return new vs(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Q5(t){return Jr(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function hF(t,e,n){return{name:SC(t,e),fields:n.value.mapValue.fields}}function XQ(t,e){let n;if("targetChange"in e){e.targetChange;const a=function(P){return P==="NO_CHANGE"?0:P==="ADD"?1:P==="REMOVE"?2:P==="CURRENT"?3:P==="RESET"?4:Oi(39313,{state:P})}(e.targetChange.targetChangeType||"NO_CHANGE"),h=e.targetChange.targetIds||[],m=function(P,N){return P.useProto3Json?(Jr(N===void 0||typeof N=="string",58123),na.fromBase64String(N||"")):(Jr(N===void 0||N instanceof Buffer||N instanceof Uint8Array,16193),na.fromUint8Array(N||new Uint8Array))}(t,e.targetChange.resumeToken),v=e.targetChange.cause,o=v&&function(P){const N=P.code===void 0?en.UNKNOWN:q5(P.code);return new Bn(N,P.message||"")}(v);n=new Z5(a,h,m,o||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const h=RS(t,a.document.name),m=bu(a.document.updateTime),v=a.document.createTime?bu(a.document.createTime):qi.min(),o=new nl({mapValue:{fields:a.document.fields}}),S=ma.newFoundDocument(h,m,v,o),P=a.targetIds||[],N=a.removedTargetIds||[];n=new W1(P,N,S.key,S)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const h=RS(t,a.document),m=a.readTime?bu(a.readTime):qi.min(),v=ma.newNoDocument(h,m),o=a.removedTargetIds||[];n=new W1([],o,v.key,v)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const h=RS(t,a.document),m=a.removedTargetIds||[];n=new W1([],m,h,null)}else{if(!("filter"in e))return Oi(11601,{Rt:e});{e.filter;const a=e.filter;a.targetId;const{count:h=0,unchangedNames:m}=a,v=new NQ(h,m),o=a.targetId;n=new W5(o,v)}}return n}function KQ(t,e){let n;if(e instanceof Hx)n={update:hF(t,e.key,e.value)};else if(e instanceof FP)n={delete:SC(t,e.key)};else if(e instanceof lf)n={update:hF(t,e.key,e.data),updateMask:sJ(e.fieldMask)};else{if(!(e instanceof OQ))return Oi(16599,{Vt:e.type});n={verify:SC(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(a=>function(m,v){const o=v.transform;if(o instanceof Tx)return{fieldPath:v.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Fg)return{fieldPath:v.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Ng)return{fieldPath:v.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Fb)return{fieldPath:v.field.canonicalString(),increment:o.Ae};throw Oi(20930,{transform:v.transform})}(0,a))),e.precondition.isNone||(n.currentDocument=function(h,m){return m.updateTime!==void 0?{updateTime:WQ(h,m.updateTime)}:m.exists!==void 0?{exists:m.exists}:Oi(27497)}(t,e.precondition)),n}function YQ(t,e){return t&&t.length>0?(Jr(e!==void 0,14353),t.map(n=>function(h,m){let v=h.updateTime?bu(h.updateTime):bu(m);return v.isEqual(qi.min())&&(v=bu(m)),new MQ(v,h.transformResults||[])}(n,e))):[]}function QQ(t,e){return{documents:[Y5(t,e.path)]}}function JQ(t,e){const n={structuredQuery:{}},a=e.path;let h;e.collectionGroup!==null?(h=a,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(h=a.popLast(),n.structuredQuery.from=[{collectionId:a.lastSegment()}]),n.parent=Y5(t,h);const m=function(P){if(P.length!==0)return eU(Lc.create(P,"and"))}(e.filters);m&&(n.structuredQuery.where=m);const v=function(P){if(P.length!==0)return P.map(N=>function(j){return{field:Wm(j.field),direction:nJ(j.dir)}}(N))}(e.orderBy);v&&(n.structuredQuery.orderBy=v);const o=EC(t,e.limit);return o!==null&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(P){return{before:P.inclusive,values:P.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(P){return{before:!P.inclusive,values:P.position}}(e.endAt)),{ft:n,parent:h}}function eJ(t){let e=ZQ(t.parent);const n=t.structuredQuery,a=n.from?n.from.length:0;let h=null;if(a>0){Jr(a===1,65062);const N=n.from[0];N.allDescendants?h=N.collectionId:e=e.child(N.collectionId)}let m=[];n.where&&(m=function(V){const j=J5(V);return j instanceof Lc&&P5(j)?j.getFilters():[j]}(n.where));let v=[];n.orderBy&&(v=function(V){return V.map(j=>function(oe){return new bx(Zm(oe.field),function(Ue){switch(Ue){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(oe.direction))}(j))}(n.orderBy));let o=null;n.limit&&(o=function(V){let j;return j=typeof V=="object"?V.value:V,CT(j)?null:j}(n.limit));let S=null;n.startAt&&(S=function(V){const j=!!V.before,Q=V.values||[];return new zb(Q,j)}(n.startAt));let P=null;return n.endAt&&(P=function(V){const j=!V.before,Q=V.values||[];return new zb(Q,j)}(n.endAt)),vQ(e,h,v,m,o,"F",S,P)}function tJ(t,e){const n=function(h){switch(h){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Oi(28987,{purpose:h})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function J5(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const a=Zm(n.unaryFilter.field);return mo.create(a,"==",{doubleValue:NaN});case"IS_NULL":const h=Zm(n.unaryFilter.field);return mo.create(h,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const m=Zm(n.unaryFilter.field);return mo.create(m,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const v=Zm(n.unaryFilter.field);return mo.create(v,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Oi(61313);default:return Oi(60726)}}(t):t.fieldFilter!==void 0?function(n){return mo.create(Zm(n.fieldFilter.field),function(h){switch(h){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Oi(58110);default:return Oi(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Lc.create(n.compositeFilter.filters.map(a=>J5(a)),function(h){switch(h){case"AND":return"and";case"OR":return"or";default:return Oi(1026)}}(n.compositeFilter.op))}(t):Oi(30097,{filter:t})}function nJ(t){return GQ[t]}function iJ(t){return $Q[t]}function rJ(t){return HQ[t]}function Wm(t){return{fieldPath:t.canonicalString()}}function Zm(t){return Jo.fromServerFormat(t.fieldPath)}function eU(t){return t instanceof mo?function(n){if(n.op==="=="){if(Qz(n.value))return{unaryFilter:{field:Wm(n.field),op:"IS_NAN"}};if(Yz(n.value))return{unaryFilter:{field:Wm(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Qz(n.value))return{unaryFilter:{field:Wm(n.field),op:"IS_NOT_NAN"}};if(Yz(n.value))return{unaryFilter:{field:Wm(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wm(n.field),op:iJ(n.op),value:n.value}}}(t):t instanceof Lc?function(n){const a=n.getFilters().map(h=>eU(h));return a.length===1?a[0]:{compositeFilter:{op:rJ(n.op),filters:a}}}(t):Oi(54877,{filter:t})}function sJ(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function tU(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sd{constructor(e,n,a,h,m=qi.min(),v=qi.min(),o=na.EMPTY_BYTE_STRING,S=null){this.target=e,this.targetId=n,this.purpose=a,this.sequenceNumber=h,this.snapshotVersion=m,this.lastLimboFreeSnapshotVersion=v,this.resumeToken=o,this.expectedCount=S}withSequenceNumber(e){return new Sd(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Sd(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Sd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Sd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oJ{constructor(e){this.yt=e}}function aJ(t){const e=eJ({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?TC(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lJ{constructor(){this.Cn=new cJ}addToCollectionParentIndex(e,n){return this.Cn.add(n),nn.resolve()}getCollectionParents(e,n){return nn.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return nn.resolve()}deleteFieldIndex(e,n){return nn.resolve()}deleteAllFieldIndexes(e){return nn.resolve()}createTargetIndexes(e,n){return nn.resolve()}getDocumentsMatchingTarget(e,n){return nn.resolve(null)}getIndexType(e,n){return nn.resolve(0)}getFieldIndexes(e,n){return nn.resolve([])}getNextCollectionGroupToUpdate(e){return nn.resolve(null)}getMinOffset(e,n){return nn.resolve(Hd.min())}getMinOffsetFromCollectionGroup(e,n){return nn.resolve(Hd.min())}updateCollectionGroup(e,n,a){return nn.resolve()}updateIndexEntries(e,n){return nn.resolve()}}class cJ{constructor(){this.index={}}add(e){const n=e.lastSegment(),a=e.popLast(),h=this.index[n]||new Co(vs.comparator),m=!h.has(a);return this.index[n]=h.add(a),m}has(e){const n=e.lastSegment(),a=e.popLast(),h=this.index[n];return h&&h.has(a)}getEntries(e){return(this.index[e]||new Co(vs.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dF={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nU=41943040;class Ja{static withCacheSize(e){return new Ja(e,Ja.DEFAULT_COLLECTION_PERCENTILE,Ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ja.DEFAULT_COLLECTION_PERCENTILE=10,Ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ja.DEFAULT=new Ja(nU,Ja.DEFAULT_COLLECTION_PERCENTILE,Ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ja.DISABLED=new Ja(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Bg(0)}static cr(){return new Bg(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fF="LruGarbageCollector",uJ=1048576;function pF([t,e],[n,a]){const h=Ir(t,n);return h===0?Ir(e,a):h}class hJ{constructor(e){this.Ir=e,this.buffer=new Co(pF),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const a=this.buffer.last();pF(n,a)<0&&(this.buffer=this.buffer.delete(a).add(n))}}get maxValue(){return this.buffer.last()[0]}}class dJ{constructor(e,n,a){this.garbageCollector=e,this.asyncQueue=n,this.localStore=a,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){$n(fF,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){e_(n)?$n(fF,"Ignoring IndexedDB error during garbage collection: ",n):await Jg(n)}await this.Vr(3e5)})}}class fJ{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(a=>Math.floor(n/100*a))}nthSequenceNumber(e,n){if(n===0)return nn.resolve(AT.ce);const a=new hJ(n);return this.mr.forEachTarget(e,h=>a.Ar(h.sequenceNumber)).next(()=>this.mr.pr(e,h=>a.Ar(h))).next(()=>a.maxValue)}removeTargets(e,n,a){return this.mr.removeTargets(e,n,a)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?($n("LruGarbageCollector","Garbage collection skipped; disabled"),nn.resolve(dF)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?($n("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dF):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let a,h,m,v,o,S,P;const N=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(V=>(V>this.params.maximumSequenceNumbersToCollect?($n("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${V}`),h=this.params.maximumSequenceNumbersToCollect):h=V,v=Date.now(),this.nthSequenceNumber(e,h))).next(V=>(a=V,o=Date.now(),this.removeTargets(e,a,n))).next(V=>(m=V,S=Date.now(),this.removeOrphanedDocuments(e,a))).next(V=>(P=Date.now(),Hm()<=vr.DEBUG&&$n("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${v-N}ms
	Determined least recently used ${h} in `+(o-v)+`ms
	Removed ${m} targets in `+(S-o)+`ms
	Removed ${V} documents in `+(P-S)+`ms
Total Duration: ${P-N}ms`),nn.resolve({didRun:!0,sequenceNumbersCollected:h,targetsRemoved:m,documentsRemoved:V})))}}function pJ(t,e){return new fJ(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mJ{constructor(){this.changes=new Tp(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,ma.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const a=this.changes.get(n);return a!==void 0?nn.resolve(a):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gJ{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _J{constructor(e,n,a,h){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=a,this.indexManager=h}getDocument(e,n){let a=null;return this.documentOverlayCache.getOverlay(e,n).next(h=>(a=h,this.remoteDocumentCache.getEntry(e,n))).next(h=>(a!==null&&Uv(a.mutation,h,Il.empty(),Rs.now()),h))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(a=>this.getLocalViewOfDocuments(e,a,Sr()).next(()=>a))}getLocalViewOfDocuments(e,n,a=Sr()){const h=Qf();return this.populateOverlays(e,h,n).next(()=>this.computeViews(e,n,h,a).next(m=>{let v=Ev();return m.forEach((o,S)=>{v=v.insert(o,S.overlayedDocument)}),v}))}getOverlayedDocuments(e,n){const a=Qf();return this.populateOverlays(e,a,n).next(()=>this.computeViews(e,n,a,Sr()))}populateOverlays(e,n,a){const h=[];return a.forEach(m=>{n.has(m)||h.push(m)}),this.documentOverlayCache.getOverlays(e,h).next(m=>{m.forEach((v,o)=>{n.set(v,o)})})}computeViews(e,n,a,h){let m=xh();const v=Vv(),o=function(){return Vv()}();return n.forEach((S,P)=>{const N=a.get(P.key);h.has(P.key)&&(N===void 0||N.mutation instanceof lf)?m=m.insert(P.key,P):N!==void 0?(v.set(P.key,N.mutation.getFieldMask()),Uv(N.mutation,P,N.mutation.getFieldMask(),Rs.now())):v.set(P.key,Il.empty())}),this.recalculateAndSaveOverlays(e,m).next(S=>(S.forEach((P,N)=>v.set(P,N)),n.forEach((P,N)=>o.set(P,new gJ(N,v.get(P)??null))),o))}recalculateAndSaveOverlays(e,n){const a=Vv();let h=new yo((v,o)=>v-o),m=Sr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(v=>{for(const o of v)o.keys().forEach(S=>{const P=n.get(S);if(P===null)return;let N=a.get(S)||Il.empty();N=o.applyToLocalView(P,N),a.set(S,N);const V=(h.get(o.batchId)||Sr()).add(S);h=h.insert(o.batchId,V)})}).next(()=>{const v=[],o=h.getReverseIterator();for(;o.hasNext();){const S=o.getNext(),P=S.key,N=S.value,V=N5();N.forEach(j=>{if(!m.has(j)){const Q=$5(n.get(j),a.get(j));Q!==null&&V.set(j,Q),m=m.add(j)}}),v.push(this.documentOverlayCache.saveOverlays(e,P,V))}return nn.waitFor(v)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,n,a,h){return function(v){return pi.isDocumentKey(v.path)&&v.collectionGroup===null&&v.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):D5(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,a,h):this.getDocumentsMatchingCollectionQuery(e,n,a,h)}getNextDocuments(e,n,a,h){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,a,h).next(m=>{const v=h-m.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,a.largestBatchId,h-m.size):nn.resolve(Qf());let o=yx,S=m;return v.next(P=>nn.forEach(P,(N,V)=>(o<V.largestBatchId&&(o=V.largestBatchId),m.get(N)?nn.resolve():this.remoteDocumentCache.getEntry(e,N).next(j=>{S=S.insert(N,j)}))).next(()=>this.populateOverlays(e,P,m)).next(()=>this.computeViews(e,S,P,Sr())).next(N=>({batchId:o,changes:F5(N)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new pi(n)).next(a=>{let h=Ev();return a.isFoundDocument()&&(h=h.insert(a.key,a)),h})}getDocumentsMatchingCollectionGroupQuery(e,n,a,h){const m=n.collectionGroup;let v=Ev();return this.indexManager.getCollectionParents(e,m).next(o=>nn.forEach(o,S=>{const P=function(V,j){return new t_(j,null,V.explicitOrderBy.slice(),V.filters.slice(),V.limit,V.limitType,V.startAt,V.endAt)}(n,S.child(m));return this.getDocumentsMatchingCollectionQuery(e,P,a,h).next(N=>{N.forEach((V,j)=>{v=v.insert(V,j)})})}).next(()=>v))}getDocumentsMatchingCollectionQuery(e,n,a,h){let m;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,a.largestBatchId).next(v=>(m=v,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,a,m,h))).next(v=>{m.forEach((S,P)=>{const N=P.getKey();v.get(N)===null&&(v=v.insert(N,ma.newInvalidDocument(N)))});let o=Ev();return v.forEach((S,P)=>{const N=m.get(S);N!==void 0&&Uv(N.mutation,P,Il.empty(),Rs.now()),kT(n,P)&&(o=o.insert(S,P))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yJ{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return nn.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(h){return{id:h.id,version:h.version,createTime:bu(h.createTime)}}(n)),nn.resolve()}getNamedQuery(e,n){return nn.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(h){return{name:h.name,query:aJ(h.bundledQuery),readTime:bu(h.readTime)}}(n)),nn.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vJ{constructor(){this.overlays=new yo(pi.comparator),this.qr=new Map}getOverlay(e,n){return nn.resolve(this.overlays.get(n))}getOverlays(e,n){const a=Qf();return nn.forEach(n,h=>this.getOverlay(e,h).next(m=>{m!==null&&a.set(h,m)})).next(()=>a)}saveOverlays(e,n,a){return a.forEach((h,m)=>{this.St(e,n,m)}),nn.resolve()}removeOverlaysForBatchId(e,n,a){const h=this.qr.get(a);return h!==void 0&&(h.forEach(m=>this.overlays=this.overlays.remove(m)),this.qr.delete(a)),nn.resolve()}getOverlaysForCollection(e,n,a){const h=Qf(),m=n.length+1,v=new pi(n.child("")),o=this.overlays.getIteratorFrom(v);for(;o.hasNext();){const S=o.getNext().value,P=S.getKey();if(!n.isPrefixOf(P.path))break;P.path.length===m&&S.largestBatchId>a&&h.set(S.getKey(),S)}return nn.resolve(h)}getOverlaysForCollectionGroup(e,n,a,h){let m=new yo((P,N)=>P-N);const v=this.overlays.getIterator();for(;v.hasNext();){const P=v.getNext().value;if(P.getKey().getCollectionGroup()===n&&P.largestBatchId>a){let N=m.get(P.largestBatchId);N===null&&(N=Qf(),m=m.insert(P.largestBatchId,N)),N.set(P.getKey(),P)}}const o=Qf(),S=m.getIterator();for(;S.hasNext()&&(S.getNext().value.forEach((P,N)=>o.set(P,N)),!(o.size()>=h)););return nn.resolve(o)}St(e,n,a){const h=this.overlays.get(a.key);if(h!==null){const v=this.qr.get(h.largestBatchId).delete(a.key);this.qr.set(h.largestBatchId,v)}this.overlays=this.overlays.insert(a.key,new FQ(n,a));let m=this.qr.get(n);m===void 0&&(m=Sr(),this.qr.set(n,m)),this.qr.set(n,m.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xJ{constructor(){this.sessionToken=na.EMPTY_BYTE_STRING}getSessionToken(e){return nn.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,nn.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(){this.Qr=new Co(jo.$r),this.Ur=new Co(jo.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const a=new jo(e,n);this.Qr=this.Qr.add(a),this.Ur=this.Ur.add(a)}Wr(e,n){e.forEach(a=>this.addReference(a,n))}removeReference(e,n){this.Gr(new jo(e,n))}zr(e,n){e.forEach(a=>this.removeReference(a,n))}jr(e){const n=new pi(new vs([])),a=new jo(n,e),h=new jo(n,e+1),m=[];return this.Ur.forEachInRange([a,h],v=>{this.Gr(v),m.push(v.key)}),m}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new pi(new vs([])),a=new jo(n,e),h=new jo(n,e+1);let m=Sr();return this.Ur.forEachInRange([a,h],v=>{m=m.add(v.key)}),m}containsKey(e){const n=new jo(e,0),a=this.Qr.firstAfterOrEqual(n);return a!==null&&e.isEqual(a.key)}}class jo{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return pi.comparator(e.key,n.key)||Ir(e.Yr,n.Yr)}static Kr(e,n){return Ir(e.Yr,n.Yr)||pi.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wJ{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Co(jo.$r)}checkEmpty(e){return nn.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,a,h){const m=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const v=new zQ(m,n,a,h);this.mutationQueue.push(v);for(const o of h)this.Zr=this.Zr.add(new jo(o.key,m)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return nn.resolve(v)}lookupMutationBatch(e,n){return nn.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const a=n+1,h=this.ei(a),m=h<0?0:h;return nn.resolve(this.mutationQueue.length>m?this.mutationQueue[m]:null)}getHighestUnacknowledgedBatchId(){return nn.resolve(this.mutationQueue.length===0?PP:this.tr-1)}getAllMutationBatches(e){return nn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const a=new jo(n,0),h=new jo(n,Number.POSITIVE_INFINITY),m=[];return this.Zr.forEachInRange([a,h],v=>{const o=this.Xr(v.Yr);m.push(o)}),nn.resolve(m)}getAllMutationBatchesAffectingDocumentKeys(e,n){let a=new Co(Ir);return n.forEach(h=>{const m=new jo(h,0),v=new jo(h,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([m,v],o=>{a=a.add(o.Yr)})}),nn.resolve(this.ti(a))}getAllMutationBatchesAffectingQuery(e,n){const a=n.path,h=a.length+1;let m=a;pi.isDocumentKey(m)||(m=m.child(""));const v=new jo(new pi(m),0);let o=new Co(Ir);return this.Zr.forEachWhile(S=>{const P=S.key.path;return!!a.isPrefixOf(P)&&(P.length===h&&(o=o.add(S.Yr)),!0)},v),nn.resolve(this.ti(o))}ti(e){const n=[];return e.forEach(a=>{const h=this.Xr(a);h!==null&&n.push(h)}),n}removeMutationBatch(e,n){Jr(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let a=this.Zr;return nn.forEach(n.mutations,h=>{const m=new jo(h.key,n.batchId);return a=a.delete(m),this.referenceDelegate.markPotentiallyOrphaned(e,h.key)}).next(()=>{this.Zr=a})}ir(e){}containsKey(e,n){const a=new jo(n,0),h=this.Zr.firstAfterOrEqual(a);return nn.resolve(n.isEqual(h&&h.key))}performConsistencyCheck(e){return this.mutationQueue.length,nn.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bJ{constructor(e){this.ri=e,this.docs=function(){return new yo(pi.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const a=n.key,h=this.docs.get(a),m=h?h.size:0,v=this.ri(n);return this.docs=this.docs.insert(a,{document:n.mutableCopy(),size:v}),this.size+=v-m,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const a=this.docs.get(n);return nn.resolve(a?a.document.mutableCopy():ma.newInvalidDocument(n))}getEntries(e,n){let a=xh();return n.forEach(h=>{const m=this.docs.get(h);a=a.insert(h,m?m.document.mutableCopy():ma.newInvalidDocument(h))}),nn.resolve(a)}getDocumentsMatchingQuery(e,n,a,h){let m=xh();const v=n.path,o=new pi(v.child("__id-9223372036854775808__")),S=this.docs.getIteratorFrom(o);for(;S.hasNext();){const{key:P,value:{document:N}}=S.getNext();if(!v.isPrefixOf(P.path))break;P.path.length>v.length+1||YY(KY(N),a)<=0||(h.has(N.key)||kT(n,N))&&(m=m.insert(N.key,N.mutableCopy()))}return nn.resolve(m)}getAllFromCollectionGroup(e,n,a,h){Oi(9500)}ii(e,n){return nn.forEach(this.docs,a=>n(a))}newChangeBuffer(e){return new TJ(this)}getSize(e){return nn.resolve(this.size)}}class TJ extends mJ{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((a,h)=>{h.isValidDocument()?n.push(this.Nr.addEntry(e,h)):this.Nr.removeEntry(a)}),nn.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EJ{constructor(e){this.persistence=e,this.si=new Tp(n=>MP(n),DP),this.lastRemoteSnapshotVersion=qi.min(),this.highestTargetId=0,this.oi=0,this._i=new UP,this.targetCount=0,this.ai=Bg.ur()}forEachTarget(e,n){return this.si.forEach((a,h)=>n(h)),nn.resolve()}getLastRemoteSnapshotVersion(e){return nn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nn.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),nn.resolve(this.highestTargetId)}setTargetsMetadata(e,n,a){return a&&(this.lastRemoteSnapshotVersion=a),n>this.oi&&(this.oi=n),nn.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Bg(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,nn.resolve()}updateTargetData(e,n){return this.Pr(n),nn.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,nn.resolve()}removeTargets(e,n,a){let h=0;const m=[];return this.si.forEach((v,o)=>{o.sequenceNumber<=n&&a.get(o.targetId)===null&&(this.si.delete(v),m.push(this.removeMatchingKeysForTargetId(e,o.targetId)),h++)}),nn.waitFor(m).next(()=>h)}getTargetCount(e){return nn.resolve(this.targetCount)}getTargetData(e,n){const a=this.si.get(n)||null;return nn.resolve(a)}addMatchingKeys(e,n,a){return this._i.Wr(n,a),nn.resolve()}removeMatchingKeys(e,n,a){this._i.zr(n,a);const h=this.persistence.referenceDelegate,m=[];return h&&n.forEach(v=>{m.push(h.markPotentiallyOrphaned(e,v))}),nn.waitFor(m)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),nn.resolve()}getMatchingKeysForTargetId(e,n){const a=this._i.Hr(n);return nn.resolve(a)}containsKey(e,n){return nn.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iU{constructor(e,n){this.ui={},this.overlays={},this.ci=new AT(0),this.li=!1,this.li=!0,this.hi=new xJ,this.referenceDelegate=e(this),this.Pi=new EJ(this),this.indexManager=new lJ,this.remoteDocumentCache=function(h){return new bJ(h)}(a=>this.referenceDelegate.Ti(a)),this.serializer=new oJ(n),this.Ii=new yJ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new vJ,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let a=this.ui[e.toKey()];return a||(a=new wJ(n,this.referenceDelegate),this.ui[e.toKey()]=a),a}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,a){$n("MemoryPersistence","Starting transaction:",e);const h=new IJ(this.ci.next());return this.referenceDelegate.Ei(),a(h).next(m=>this.referenceDelegate.di(h).next(()=>m)).toPromise().then(m=>(h.raiseOnCommittedEvent(),m))}Ai(e,n){return nn.or(Object.values(this.ui).map(a=>()=>a.containsKey(e,n)))}}class IJ extends JY{constructor(e){super(),this.currentSequenceNumber=e}}class jP{constructor(e){this.persistence=e,this.Ri=new UP,this.Vi=null}static mi(e){return new jP(e)}get fi(){if(this.Vi)return this.Vi;throw Oi(60996)}addReference(e,n,a){return this.Ri.addReference(a,n),this.fi.delete(a.toString()),nn.resolve()}removeReference(e,n,a){return this.Ri.removeReference(a,n),this.fi.add(a.toString()),nn.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),nn.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(h=>this.fi.add(h.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,n.targetId).next(h=>{h.forEach(m=>this.fi.add(m.toString()))}).next(()=>a.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nn.forEach(this.fi,a=>{const h=pi.fromPath(a);return this.gi(e,h).next(m=>{m||n.removeEntry(h,qi.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(a=>{a?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return nn.or([()=>nn.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Bb{constructor(e,n){this.persistence=e,this.pi=new Tp(a=>nQ(a.path),(a,h)=>a.isEqual(h)),this.garbageCollector=pJ(this,n)}static mi(e,n){return new Bb(e,n)}Ei(){}di(e){return nn.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(a=>n.next(h=>a+h))}wr(e){let n=0;return this.pr(e,a=>{n++}).next(()=>n)}pr(e,n){return nn.forEach(this.pi,(a,h)=>this.br(e,a,h).next(m=>m?nn.resolve():n(h)))}removeTargets(e,n,a){return this.persistence.getTargetCache().removeTargets(e,n,a)}removeOrphanedDocuments(e,n){let a=0;const h=this.persistence.getRemoteDocumentCache(),m=h.newChangeBuffer();return h.ii(e,v=>this.br(e,v,n).next(o=>{o||(a++,m.removeEntry(v,qi.min()))})).next(()=>m.apply(e)).next(()=>a)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),nn.resolve()}removeTarget(e,n){const a=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,n,a){return this.pi.set(a,e.currentSequenceNumber),nn.resolve()}removeReference(e,n,a){return this.pi.set(a,e.currentSequenceNumber),nn.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),nn.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=$1(e.data.value)),n}br(e,n,a){return nn.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const h=this.pi.get(n);return nn.resolve(h!==void 0&&h>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{constructor(e,n,a,h){this.targetId=e,this.fromCache=n,this.Es=a,this.ds=h}static As(e,n){let a=Sr(),h=Sr();for(const m of n.docChanges)switch(m.type){case 0:a=a.add(m.doc.key);break;case 1:h=h.add(m.doc.key)}return new GP(e,n.fromCache,a,h)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SJ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AJ{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return K7()?8:eQ(ba())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,a,h){const m={result:null};return this.ys(e,n).next(v=>{m.result=v}).next(()=>{if(!m.result)return this.ws(e,n,h,a).next(v=>{m.result=v})}).next(()=>{if(m.result)return;const v=new SJ;return this.Ss(e,n,v).next(o=>{if(m.result=o,this.Vs)return this.bs(e,n,v,o.size)})}).next(()=>m.result)}bs(e,n,a,h){return a.documentReadCount<this.fs?(Hm()<=vr.DEBUG&&$n("QueryEngine","SDK will not create cache indexes for query:",qm(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),nn.resolve()):(Hm()<=vr.DEBUG&&$n("QueryEngine","Query:",qm(n),"scans",a.documentReadCount,"local documents and returns",h,"documents as results."),a.documentReadCount>this.gs*h?(Hm()<=vr.DEBUG&&$n("QueryEngine","The SDK decides to create cache indexes for query:",qm(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wu(n))):nn.resolve())}ys(e,n){if(nF(n))return nn.resolve(null);let a=wu(n);return this.indexManager.getIndexType(e,a).next(h=>h===0?null:(n.limit!==null&&h===1&&(n=TC(n,null,"F"),a=wu(n)),this.indexManager.getDocumentsMatchingTarget(e,a).next(m=>{const v=Sr(...m);return this.ps.getDocuments(e,v).next(o=>this.indexManager.getMinOffset(e,a).next(S=>{const P=this.Ds(n,o);return this.Cs(n,P,v,S.readTime)?this.ys(e,TC(n,null,"F")):this.vs(e,P,n,S)}))})))}ws(e,n,a,h){return nF(n)||h.isEqual(qi.min())?nn.resolve(null):this.ps.getDocuments(e,a).next(m=>{const v=this.Ds(n,m);return this.Cs(n,v,a,h)?nn.resolve(null):(Hm()<=vr.DEBUG&&$n("QueryEngine","Re-using previous result from %s to execute query: %s",h.toString(),qm(n)),this.vs(e,v,n,XY(h,yx)).next(o=>o))})}Ds(e,n){let a=new Co(O5(e));return n.forEach((h,m)=>{kT(e,m)&&(a=a.add(m))}),a}Cs(e,n,a,h){if(e.limit===null)return!1;if(a.size!==n.size)return!0;const m=e.limitType==="F"?n.last():n.first();return!!m&&(m.hasPendingWrites||m.version.compareTo(h)>0)}Ss(e,n,a){return Hm()<=vr.DEBUG&&$n("QueryEngine","Using full collection scan to execute query:",qm(n)),this.ps.getDocumentsMatchingQuery(e,n,Hd.min(),a)}vs(e,n,a,h){return this.ps.getDocumentsMatchingQuery(e,a,h).next(m=>(n.forEach(v=>{m=m.insert(v.key,v)}),m))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P="LocalStore",CJ=3e8;class PJ{constructor(e,n,a,h){this.persistence=e,this.Fs=n,this.serializer=h,this.Ms=new yo(Ir),this.xs=new Tp(m=>MP(m),DP),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(a)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _J(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function RJ(t,e,n,a){return new PJ(t,e,n,a)}async function rU(t,e){const n=Yi(t);return await n.persistence.runTransaction("Handle user change","readonly",a=>{let h;return n.mutationQueue.getAllMutationBatches(a).next(m=>(h=m,n.Bs(e),n.mutationQueue.getAllMutationBatches(a))).next(m=>{const v=[],o=[];let S=Sr();for(const P of h){v.push(P.batchId);for(const N of P.mutations)S=S.add(N.key)}for(const P of m){o.push(P.batchId);for(const N of P.mutations)S=S.add(N.key)}return n.localDocuments.getDocuments(a,S).next(P=>({Ls:P,removedBatchIds:v,addedBatchIds:o}))})})}function kJ(t,e){const n=Yi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const h=e.batch.keys(),m=n.Ns.newChangeBuffer({trackRemovals:!0});return function(o,S,P,N){const V=P.batch,j=V.keys();let Q=nn.resolve();return j.forEach(oe=>{Q=Q.next(()=>N.getEntry(S,oe)).next(me=>{const Ue=P.docVersions.get(oe);Jr(Ue!==null,48541),me.version.compareTo(Ue)<0&&(V.applyToRemoteDocument(me,P),me.isValidDocument()&&(me.setReadTime(P.commitVersion),N.addEntry(me)))})}),Q.next(()=>o.mutationQueue.removeMutationBatch(S,V))}(n,a,e,m).next(()=>m.apply(a)).next(()=>n.mutationQueue.performConsistencyCheck(a)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(a,h,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(o){let S=Sr();for(let P=0;P<o.mutationResults.length;++P)o.mutationResults[P].transformResults.length>0&&(S=S.add(o.batch.mutations[P].key));return S}(e))).next(()=>n.localDocuments.getDocuments(a,h))})}function sU(t){const e=Yi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function MJ(t,e){const n=Yi(t),a=e.snapshotVersion;let h=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",m=>{const v=n.Ns.newChangeBuffer({trackRemovals:!0});h=n.Ms;const o=[];e.targetChanges.forEach((N,V)=>{const j=h.get(V);if(!j)return;o.push(n.Pi.removeMatchingKeys(m,N.removedDocuments,V).next(()=>n.Pi.addMatchingKeys(m,N.addedDocuments,V)));let Q=j.withSequenceNumber(m.currentSequenceNumber);e.targetMismatches.get(V)!==null?Q=Q.withResumeToken(na.EMPTY_BYTE_STRING,qi.min()).withLastLimboFreeSnapshotVersion(qi.min()):N.resumeToken.approximateByteSize()>0&&(Q=Q.withResumeToken(N.resumeToken,a)),h=h.insert(V,Q),function(me,Ue,de){return me.resumeToken.approximateByteSize()===0||Ue.snapshotVersion.toMicroseconds()-me.snapshotVersion.toMicroseconds()>=CJ?!0:de.addedDocuments.size+de.modifiedDocuments.size+de.removedDocuments.size>0}(j,Q,N)&&o.push(n.Pi.updateTargetData(m,Q))});let S=xh(),P=Sr();if(e.documentUpdates.forEach(N=>{e.resolvedLimboDocuments.has(N)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(m,N))}),o.push(DJ(m,v,e.documentUpdates).next(N=>{S=N.ks,P=N.qs})),!a.isEqual(qi.min())){const N=n.Pi.getLastRemoteSnapshotVersion(m).next(V=>n.Pi.setTargetsMetadata(m,m.currentSequenceNumber,a));o.push(N)}return nn.waitFor(o).next(()=>v.apply(m)).next(()=>n.localDocuments.getLocalViewOfDocuments(m,S,P)).next(()=>S)}).then(m=>(n.Ms=h,m))}function DJ(t,e,n){let a=Sr(),h=Sr();return n.forEach(m=>a=a.add(m)),e.getEntries(t,a).next(m=>{let v=xh();return n.forEach((o,S)=>{const P=m.get(o);S.isFoundDocument()!==P.isFoundDocument()&&(h=h.add(o)),S.isNoDocument()&&S.version.isEqual(qi.min())?(e.removeEntry(o,S.readTime),v=v.insert(o,S)):!P.isValidDocument()||S.version.compareTo(P.version)>0||S.version.compareTo(P.version)===0&&P.hasPendingWrites?(e.addEntry(S),v=v.insert(o,S)):$n($P,"Ignoring outdated watch update for ",o,". Current version:",P.version," Watch version:",S.version)}),{ks:v,qs:h}})}function LJ(t,e){const n=Yi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=PP),n.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function OJ(t,e){const n=Yi(t);return n.persistence.runTransaction("Allocate target","readwrite",a=>{let h;return n.Pi.getTargetData(a,e).next(m=>m?(h=m,nn.resolve(h)):n.Pi.allocateTargetId(a).next(v=>(h=new Sd(e,v,"TargetPurposeListen",a.currentSequenceNumber),n.Pi.addTargetData(a,h).next(()=>h))))}).then(a=>{const h=n.Ms.get(a.targetId);return(h===null||a.snapshotVersion.compareTo(h.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(a.targetId,a),n.xs.set(e,a.targetId)),a})}async function CC(t,e,n){const a=Yi(t),h=a.Ms.get(e),m=n?"readwrite":"readwrite-primary";try{n||await a.persistence.runTransaction("Release target",m,v=>a.persistence.referenceDelegate.removeTarget(v,h))}catch(v){if(!e_(v))throw v;$n($P,`Failed to update sequence numbers for target ${e}: ${v}`)}a.Ms=a.Ms.remove(e),a.xs.delete(h.target)}function mF(t,e,n){const a=Yi(t);let h=qi.min(),m=Sr();return a.persistence.runTransaction("Execute query","readwrite",v=>function(S,P,N){const V=Yi(S),j=V.xs.get(N);return j!==void 0?nn.resolve(V.Ms.get(j)):V.Pi.getTargetData(P,N)}(a,v,wu(e)).next(o=>{if(o)return h=o.lastLimboFreeSnapshotVersion,a.Pi.getMatchingKeysForTargetId(v,o.targetId).next(S=>{m=S})}).next(()=>a.Fs.getDocumentsMatchingQuery(v,e,n?h:qi.min(),n?m:Sr())).next(o=>(zJ(a,wQ(e),o),{documents:o,Qs:m})))}function zJ(t,e,n){let a=t.Os.get(e)||qi.min();n.forEach((h,m)=>{m.readTime.compareTo(a)>0&&(a=m.readTime)}),t.Os.set(e,a)}class gF{constructor(){this.activeTargetIds=AQ()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class FJ{constructor(){this.Mo=new gF,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,a){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,a){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new gF,Promise.resolve()}handleUserChange(e,n,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NJ{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _F="ConnectivityMonitor";class yF{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){$n(_F,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){$n(_F,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let y1=null;function PC(){return y1===null?y1=function(){return 268435456+Math.round(2147483648*Math.random())}():y1++,"0x"+y1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kS="RestConnection",BJ={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class VJ{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),h=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${a}/databases/${h}`,this.Wo=this.databaseId.database===Lb?`project_id=${a}`:`project_id=${a}&database_id=${h}`}Go(e,n,a,h,m){const v=PC(),o=this.zo(e,n.toUriEncodedString());$n(kS,`Sending RPC '${e}' ${v}:`,o,a);const S={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(S,h,m);const{host:P}=new URL(o),N=tf(P);return this.Jo(e,o,S,a,N).then(V=>($n(kS,`Received RPC '${e}' ${v}: `,V),V),V=>{throw Dg(kS,`RPC '${e}' ${v} failed with error: `,V,"url: ",o,"request:",a),V})}Ho(e,n,a,h,m,v){return this.Go(e,n,a,h,m)}jo(e,n,a){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Qg}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((h,m)=>e[m]=h),a&&a.headers.forEach((h,m)=>e[m]=h)}zo(e,n){const a=BJ[e];return`${this.Uo}/v1/${n}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UJ{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const da="WebChannelConnection";class jJ extends VJ{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,a,h,m){const v=PC();return new Promise((o,S)=>{const P=new l5;P.setWithCredentials(!0),P.listenOnce(c5.COMPLETE,()=>{try{switch(P.getLastErrorCode()){case G1.NO_ERROR:const V=P.getResponseJson();$n(da,`XHR for RPC '${e}' ${v} received:`,JSON.stringify(V)),o(V);break;case G1.TIMEOUT:$n(da,`RPC '${e}' ${v} timed out`),S(new Bn(en.DEADLINE_EXCEEDED,"Request time out"));break;case G1.HTTP_ERROR:const j=P.getStatus();if($n(da,`RPC '${e}' ${v} failed with status:`,j,"response text:",P.getResponseText()),j>0){let Q=P.getResponseJson();Array.isArray(Q)&&(Q=Q[0]);const oe=Q==null?void 0:Q.error;if(oe&&oe.status&&oe.message){const me=function(de){const ge=de.toLowerCase().replace(/_/g,"-");return Object.values(en).indexOf(ge)>=0?ge:en.UNKNOWN}(oe.status);S(new Bn(me,oe.message))}else S(new Bn(en.UNKNOWN,"Server responded with status "+P.getStatus()))}else S(new Bn(en.UNAVAILABLE,"Connection failed."));break;default:Oi(9055,{l_:e,streamId:v,h_:P.getLastErrorCode(),P_:P.getLastError()})}}finally{$n(da,`RPC '${e}' ${v} completed.`)}});const N=JSON.stringify(h);$n(da,`RPC '${e}' ${v} sending request:`,h),P.send(n,"POST",N,a,15)})}T_(e,n,a){const h=PC(),m=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],v=d5(),o=h5(),S={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},P=this.longPollingOptions.timeoutSeconds;P!==void 0&&(S.longPollingTimeout=Math.round(1e3*P)),this.useFetchStreams&&(S.useFetchStreams=!0),this.jo(S.initMessageHeaders,n,a),S.encodeInitMessageHeaders=!0;const N=m.join("");$n(da,`Creating RPC '${e}' stream ${h}: ${N}`,S);const V=v.createWebChannel(N,S);this.I_(V);let j=!1,Q=!1;const oe=new UJ({Yo:Ue=>{Q?$n(da,`Not sending because RPC '${e}' stream ${h} is closed:`,Ue):(j||($n(da,`Opening RPC '${e}' stream ${h} transport.`),V.open(),j=!0),$n(da,`RPC '${e}' stream ${h} sending:`,Ue),V.send(Ue))},Zo:()=>V.close()}),me=(Ue,de,ge)=>{Ue.listen(de,Re=>{try{ge(Re)}catch(_t){setTimeout(()=>{throw _t},0)}})};return me(V,Tv.EventType.OPEN,()=>{Q||($n(da,`RPC '${e}' stream ${h} transport opened.`),oe.o_())}),me(V,Tv.EventType.CLOSE,()=>{Q||(Q=!0,$n(da,`RPC '${e}' stream ${h} transport closed`),oe.a_(),this.E_(V))}),me(V,Tv.EventType.ERROR,Ue=>{Q||(Q=!0,Dg(da,`RPC '${e}' stream ${h} transport errored. Name:`,Ue.name,"Message:",Ue.message),oe.a_(new Bn(en.UNAVAILABLE,"The operation could not be completed")))}),me(V,Tv.EventType.MESSAGE,Ue=>{var de;if(!Q){const ge=Ue.data[0];Jr(!!ge,16349);const Re=ge,_t=(Re==null?void 0:Re.error)||((de=Re[0])==null?void 0:de.error);if(_t){$n(da,`RPC '${e}' stream ${h} received error:`,_t);const ct=_t.status;let nt=function(ke){const Ve=ho[ke];if(Ve!==void 0)return q5(Ve)}(ct),Pe=_t.message;nt===void 0&&(nt=en.INTERNAL,Pe="Unknown error status: "+ct+" with message "+_t.message),Q=!0,oe.a_(new Bn(nt,Pe)),V.close()}else $n(da,`RPC '${e}' stream ${h} received:`,ge),oe.u_(ge)}}),me(o,u5.STAT_EVENT,Ue=>{Ue.stat===mC.PROXY?$n(da,`RPC '${e}' stream ${h} detected buffering proxy`):Ue.stat===mC.NOPROXY&&$n(da,`RPC '${e}' stream ${h} detected no buffering proxy`)}),setTimeout(()=>{oe.__()},0),oe}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}function MS(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OT(t){return new qQ(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,n,a=1e3,h=1.5,m=6e4){this.Mi=e,this.timerId=n,this.d_=a,this.A_=h,this.R_=m,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),a=Math.max(0,Date.now()-this.f_),h=Math.max(0,n-a);h>0&&$n("ExponentialBackoff",`Backing off for ${h} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${a} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,h,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vF="PersistentStream";class aU{constructor(e,n,a,h,m,v,o,S){this.Mi=e,this.S_=a,this.b_=h,this.connection=m,this.authCredentialsProvider=v,this.appCheckCredentialsProvider=o,this.listener=S,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new oU(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===en.RESOURCE_EXHAUSTED?(vh(n.toString()),vh("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===en.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,h])=>{this.D_===n&&this.G_(a,h)},a=>{e(()=>{const h=new Bn(en.UNKNOWN,"Fetching auth token failed: "+a.message);return this.z_(h)})})}G_(e,n){const a=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{a(()=>this.listener.Xo())}),this.stream.t_(()=>{a(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(h=>{a(()=>this.z_(h))}),this.stream.onMessage(h=>{a(()=>++this.F_==1?this.J_(h):this.onNext(h))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return $n(vF,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():($n(vF,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class GJ extends aU{constructor(e,n,a,h,m,v){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,a,h,v),this.serializer=m}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=XQ(this.serializer,e),a=function(m){if(!("targetChange"in m))return qi.min();const v=m.targetChange;return v.targetIds&&v.targetIds.length?qi.min():v.readTime?bu(v.readTime):qi.min()}(e);return this.listener.H_(n,a)}Y_(e){const n={};n.database=AC(this.serializer),n.addTarget=function(m,v){let o;const S=v.target;if(o=wC(S)?{documents:QQ(m,S)}:{query:JQ(m,S).ft},o.targetId=v.targetId,v.resumeToken.approximateByteSize()>0){o.resumeToken=X5(m,v.resumeToken);const P=EC(m,v.expectedCount);P!==null&&(o.expectedCount=P)}else if(v.snapshotVersion.compareTo(qi.min())>0){o.readTime=Nb(m,v.snapshotVersion.toTimestamp());const P=EC(m,v.expectedCount);P!==null&&(o.expectedCount=P)}return o}(this.serializer,e);const a=tJ(this.serializer,e);a&&(n.labels=a),this.q_(n)}Z_(e){const n={};n.database=AC(this.serializer),n.removeTarget=e,this.q_(n)}}class $J extends aU{constructor(e,n,a,h,m,v){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,a,h,v),this.serializer=m}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return Jr(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Jr(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Jr(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=YQ(e.writeResults,e.commitTime),a=bu(e.commitTime);return this.listener.na(a,n)}ra(){const e={};e.database=AC(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(a=>KQ(this.serializer,a))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HJ{}class qJ extends HJ{constructor(e,n,a,h){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=a,this.serializer=h,this.ia=!1}sa(){if(this.ia)throw new Bn(en.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,a,h){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([m,v])=>this.connection.Go(e,IC(n,a),h,m,v)).catch(m=>{throw m.name==="FirebaseError"?(m.code===en.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),m):new Bn(en.UNKNOWN,m.toString())})}Ho(e,n,a,h,m){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([v,o])=>this.connection.Ho(e,IC(n,a),h,v,o,m)).catch(v=>{throw v.name==="FirebaseError"?(v.code===en.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),v):new Bn(en.UNKNOWN,v.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class WJ{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(vh(n),this.aa=!1):$n("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fp="RemoteStore";class ZJ{constructor(e,n,a,h,m){this.localStore=e,this.datastore=n,this.asyncQueue=a,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=m,this.Aa.Oo(v=>{a.enqueueAndForget(async()=>{Ep(this)&&($n(fp,"Restarting streams for network reachability change."),await async function(S){const P=Yi(S);P.Ea.add(4),await Wx(P),P.Ra.set("Unknown"),P.Ea.delete(4),await zT(P)}(this))})}),this.Ra=new WJ(a,h)}}async function zT(t){if(Ep(t))for(const e of t.da)await e(!0)}async function Wx(t){for(const e of t.da)await e(!1)}function lU(t,e){const n=Yi(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),ZP(n)?WP(n):n_(n).O_()&&qP(n,e))}function HP(t,e){const n=Yi(t),a=n_(n);n.Ia.delete(e),a.O_()&&cU(n,e),n.Ia.size===0&&(a.O_()?a.L_():Ep(n)&&n.Ra.set("Unknown"))}function qP(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(qi.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}n_(t).Y_(e)}function cU(t,e){t.Va.Ue(e),n_(t).Z_(e)}function WP(t){t.Va=new jQ({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),n_(t).start(),t.Ra.ua()}function ZP(t){return Ep(t)&&!n_(t).x_()&&t.Ia.size>0}function Ep(t){return Yi(t).Ea.size===0}function uU(t){t.Va=void 0}async function XJ(t){t.Ra.set("Online")}async function KJ(t){t.Ia.forEach((e,n)=>{qP(t,e)})}async function YJ(t,e){uU(t),ZP(t)?(t.Ra.ha(e),WP(t)):t.Ra.set("Unknown")}async function QJ(t,e,n){if(t.Ra.set("Online"),e instanceof Z5&&e.state===2&&e.cause)try{await async function(h,m){const v=m.cause;for(const o of m.targetIds)h.Ia.has(o)&&(await h.remoteSyncer.rejectListen(o,v),h.Ia.delete(o),h.Va.removeTarget(o))}(t,e)}catch(a){$n(fp,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await Vb(t,a)}else if(e instanceof W1?t.Va.Ze(e):e instanceof W5?t.Va.st(e):t.Va.tt(e),!n.isEqual(qi.min()))try{const a=await sU(t.localStore);n.compareTo(a)>=0&&await function(m,v){const o=m.Va.Tt(v);return o.targetChanges.forEach((S,P)=>{if(S.resumeToken.approximateByteSize()>0){const N=m.Ia.get(P);N&&m.Ia.set(P,N.withResumeToken(S.resumeToken,v))}}),o.targetMismatches.forEach((S,P)=>{const N=m.Ia.get(S);if(!N)return;m.Ia.set(S,N.withResumeToken(na.EMPTY_BYTE_STRING,N.snapshotVersion)),cU(m,S);const V=new Sd(N.target,S,P,N.sequenceNumber);qP(m,V)}),m.remoteSyncer.applyRemoteEvent(o)}(t,n)}catch(a){$n(fp,"Failed to raise snapshot:",a),await Vb(t,a)}}async function Vb(t,e,n){if(!e_(e))throw e;t.Ea.add(1),await Wx(t),t.Ra.set("Offline"),n||(n=()=>sU(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{$n(fp,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await zT(t)})}function hU(t,e){return e().catch(n=>Vb(t,n,e))}async function FT(t){const e=Yi(t),n=Xd(e);let a=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:PP;for(;JJ(e);)try{const h=await LJ(e.localStore,a);if(h===null){e.Ta.length===0&&n.L_();break}a=h.batchId,eee(e,h)}catch(h){await Vb(e,h)}dU(e)&&fU(e)}function JJ(t){return Ep(t)&&t.Ta.length<10}function eee(t,e){t.Ta.push(e);const n=Xd(t);n.O_()&&n.X_&&n.ea(e.mutations)}function dU(t){return Ep(t)&&!Xd(t).x_()&&t.Ta.length>0}function fU(t){Xd(t).start()}async function tee(t){Xd(t).ra()}async function nee(t){const e=Xd(t);for(const n of t.Ta)e.ea(n.mutations)}async function iee(t,e,n){const a=t.Ta.shift(),h=NP.from(a,e,n);await hU(t,()=>t.remoteSyncer.applySuccessfulWrite(h)),await FT(t)}async function ree(t,e){e&&Xd(t).X_&&await async function(a,h){if(function(v){return BQ(v)&&v!==en.ABORTED}(h.code)){const m=a.Ta.shift();Xd(a).B_(),await hU(a,()=>a.remoteSyncer.rejectFailedWrite(m.batchId,h)),await FT(a)}}(t,e),dU(t)&&fU(t)}async function xF(t,e){const n=Yi(t);n.asyncQueue.verifyOperationInProgress(),$n(fp,"RemoteStore received new credentials");const a=Ep(n);n.Ea.add(3),await Wx(n),a&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await zT(n)}async function see(t,e){const n=Yi(t);e?(n.Ea.delete(2),await zT(n)):e||(n.Ea.add(2),await Wx(n),n.Ra.set("Unknown"))}function n_(t){return t.ma||(t.ma=function(n,a,h){const m=Yi(n);return m.sa(),new GJ(a,m.connection,m.authCredentials,m.appCheckCredentials,m.serializer,h)}(t.datastore,t.asyncQueue,{Xo:XJ.bind(null,t),t_:KJ.bind(null,t),r_:YJ.bind(null,t),H_:QJ.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),ZP(t)?WP(t):t.Ra.set("Unknown")):(await t.ma.stop(),uU(t))})),t.ma}function Xd(t){return t.fa||(t.fa=function(n,a,h){const m=Yi(n);return m.sa(),new $J(a,m.connection,m.authCredentials,m.appCheckCredentials,m.serializer,h)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:tee.bind(null,t),r_:ree.bind(null,t),ta:nee.bind(null,t),na:iee.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await FT(t)):(await t.fa.stop(),t.Ta.length>0&&($n(fp,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(e,n,a,h,m){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=a,this.op=h,this.removalCallback=m,this.deferred=new ip,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(v=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,a,h,m){const v=Date.now()+a,o=new XP(e,n,v,h,m);return o.start(a),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Bn(en.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function KP(t,e){if(vh("AsyncQueue",`${e}: ${t}`),e_(t))return new Bn(en.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{static emptySet(e){return new vg(e.comparator)}constructor(e){this.comparator=e?(n,a)=>e(n,a)||pi.comparator(n.key,a.key):(n,a)=>pi.comparator(n.key,a.key),this.keyedMap=Ev(),this.sortedSet=new yo(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,a)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof vg)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;n.hasNext();){const h=n.getNext().key,m=a.getNext().key;if(!h.isEqual(m))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const a=new vg;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=n,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wF{constructor(){this.ga=new yo(pi.comparator)}track(e){const n=e.doc.key,a=this.ga.get(n);a?e.type!==0&&a.type===3?this.ga=this.ga.insert(n,e):e.type===3&&a.type!==1?this.ga=this.ga.insert(n,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.ga=this.ga.remove(n):e.type===1&&a.type===2?this.ga=this.ga.insert(n,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Oi(63341,{Rt:e,pa:a}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,a)=>{e.push(a)}),e}}class Vg{constructor(e,n,a,h,m,v,o,S,P){this.query=e,this.docs=n,this.oldDocs=a,this.docChanges=h,this.mutatedKeys=m,this.fromCache=v,this.syncStateChanged=o,this.excludesMetadataChanges=S,this.hasCachedResults=P}static fromInitialDocuments(e,n,a,h,m){const v=[];return n.forEach(o=>{v.push({type:0,doc:o})}),new Vg(e,n,vg.emptySet(n),v,a,h,!0,!1,m)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&RT(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,a=e.docChanges;if(n.length!==a.length)return!1;for(let h=0;h<n.length;h++)if(n[h].type!==a[h].type||!n[h].doc.isEqual(a[h].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oee{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class aee{constructor(){this.queries=bF(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,a){const h=Yi(n),m=h.queries;h.queries=bF(),m.forEach((v,o)=>{for(const S of o.Sa)S.onError(a)})})(this,new Bn(en.ABORTED,"Firestore shutting down"))}}function bF(){return new Tp(t=>L5(t),RT)}async function lee(t,e){const n=Yi(t);let a=3;const h=e.query;let m=n.queries.get(h);m?!m.ba()&&e.Da()&&(a=2):(m=new oee,a=e.Da()?0:1);try{switch(a){case 0:m.wa=await n.onListen(h,!0);break;case 1:m.wa=await n.onListen(h,!1);break;case 2:await n.onFirstRemoteStoreListen(h)}}catch(v){const o=KP(v,`Initialization of query '${qm(e.query)}' failed`);return void e.onError(o)}n.queries.set(h,m),m.Sa.push(e),e.va(n.onlineState),m.wa&&e.Fa(m.wa)&&YP(n)}async function cee(t,e){const n=Yi(t),a=e.query;let h=3;const m=n.queries.get(a);if(m){const v=m.Sa.indexOf(e);v>=0&&(m.Sa.splice(v,1),m.Sa.length===0?h=e.Da()?0:1:!m.ba()&&e.Da()&&(h=2))}switch(h){case 0:return n.queries.delete(a),n.onUnlisten(a,!0);case 1:return n.queries.delete(a),n.onUnlisten(a,!1);case 2:return n.onLastRemoteStoreUnlisten(a);default:return}}function uee(t,e){const n=Yi(t);let a=!1;for(const h of e){const m=h.query,v=n.queries.get(m);if(v){for(const o of v.Sa)o.Fa(h)&&(a=!0);v.wa=h}}a&&YP(n)}function hee(t,e,n){const a=Yi(t),h=a.queries.get(e);if(h)for(const m of h.Sa)m.onError(n);a.queries.delete(e)}function YP(t){t.Ca.forEach(e=>{e.next()})}var RC,TF;(TF=RC||(RC={})).Ma="default",TF.Cache="cache";class dee{constructor(e,n,a){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=a||{}}Fa(e){if(!this.options.includeMetadataChanges){const a=[];for(const h of e.docChanges)h.type!==3&&a.push(h);e=new Vg(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const a=n!=="Offline";return(!this.options.qa||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Vg.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==RC.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pU{constructor(e){this.key=e}}class mU{constructor(e){this.key=e}}class fee{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Sr(),this.mutatedKeys=Sr(),this.eu=O5(e),this.tu=new vg(this.eu)}get nu(){return this.Ya}ru(e,n){const a=n?n.iu:new wF,h=n?n.tu:this.tu;let m=n?n.mutatedKeys:this.mutatedKeys,v=h,o=!1;const S=this.query.limitType==="F"&&h.size===this.query.limit?h.last():null,P=this.query.limitType==="L"&&h.size===this.query.limit?h.first():null;if(e.inorderTraversal((N,V)=>{const j=h.get(N),Q=kT(this.query,V)?V:null,oe=!!j&&this.mutatedKeys.has(j.key),me=!!Q&&(Q.hasLocalMutations||this.mutatedKeys.has(Q.key)&&Q.hasCommittedMutations);let Ue=!1;j&&Q?j.data.isEqual(Q.data)?oe!==me&&(a.track({type:3,doc:Q}),Ue=!0):this.su(j,Q)||(a.track({type:2,doc:Q}),Ue=!0,(S&&this.eu(Q,S)>0||P&&this.eu(Q,P)<0)&&(o=!0)):!j&&Q?(a.track({type:0,doc:Q}),Ue=!0):j&&!Q&&(a.track({type:1,doc:j}),Ue=!0,(S||P)&&(o=!0)),Ue&&(Q?(v=v.add(Q),m=me?m.add(N):m.delete(N)):(v=v.delete(N),m=m.delete(N)))}),this.query.limit!==null)for(;v.size>this.query.limit;){const N=this.query.limitType==="F"?v.last():v.first();v=v.delete(N.key),m=m.delete(N.key),a.track({type:1,doc:N})}return{tu:v,iu:a,Cs:o,mutatedKeys:m}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,a,h){const m=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const v=e.iu.ya();v.sort((N,V)=>function(Q,oe){const me=Ue=>{switch(Ue){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Oi(20277,{Rt:Ue})}};return me(Q)-me(oe)}(N.type,V.type)||this.eu(N.doc,V.doc)),this.ou(a),h=h??!1;const o=n&&!h?this._u():[],S=this.Xa.size===0&&this.current&&!h?1:0,P=S!==this.Za;return this.Za=S,v.length!==0||P?{snapshot:new Vg(this.query,e.tu,m,v,e.mutatedKeys,S===0,P,!1,!!a&&a.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new wF,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Sr(),this.tu.forEach(a=>{this.uu(a.key)&&(this.Xa=this.Xa.add(a.key))});const n=[];return e.forEach(a=>{this.Xa.has(a)||n.push(new mU(a))}),this.Xa.forEach(a=>{e.has(a)||n.push(new pU(a))}),n}cu(e){this.Ya=e.Qs,this.Xa=Sr();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Vg.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const QP="SyncEngine";class pee{constructor(e,n,a){this.query=e,this.targetId=n,this.view=a}}class mee{constructor(e){this.key=e,this.hu=!1}}class gee{constructor(e,n,a,h,m,v){this.localStore=e,this.remoteStore=n,this.eventManager=a,this.sharedClientState=h,this.currentUser=m,this.maxConcurrentLimboResolutions=v,this.Pu={},this.Tu=new Tp(o=>L5(o),RT),this.Iu=new Map,this.Eu=new Set,this.du=new yo(pi.comparator),this.Au=new Map,this.Ru=new UP,this.Vu={},this.mu=new Map,this.fu=Bg.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function _ee(t,e,n=!0){const a=wU(t);let h;const m=a.Tu.get(e);return m?(a.sharedClientState.addLocalQueryTarget(m.targetId),h=m.view.lu()):h=await gU(a,e,n,!0),h}async function yee(t,e){const n=wU(t);await gU(n,e,!0,!1)}async function gU(t,e,n,a){const h=await OJ(t.localStore,wu(e)),m=h.targetId,v=t.sharedClientState.addLocalQueryTarget(m,n);let o;return a&&(o=await vee(t,e,m,v==="current",h.resumeToken)),t.isPrimaryClient&&n&&lU(t.remoteStore,h),o}async function vee(t,e,n,a,h){t.pu=(V,j,Q)=>async function(me,Ue,de,ge){let Re=Ue.view.ru(de);Re.Cs&&(Re=await mF(me.localStore,Ue.query,!1).then(({documents:Pe})=>Ue.view.ru(Pe,Re)));const _t=ge&&ge.targetChanges.get(Ue.targetId),ct=ge&&ge.targetMismatches.get(Ue.targetId)!=null,nt=Ue.view.applyChanges(Re,me.isPrimaryClient,_t,ct);return IF(me,Ue.targetId,nt.au),nt.snapshot}(t,V,j,Q);const m=await mF(t.localStore,e,!0),v=new fee(e,m.Qs),o=v.ru(m.documents),S=qx.createSynthesizedTargetChangeForCurrentChange(n,a&&t.onlineState!=="Offline",h),P=v.applyChanges(o,t.isPrimaryClient,S);IF(t,n,P.au);const N=new pee(e,n,v);return t.Tu.set(e,N),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),P.snapshot}async function xee(t,e,n){const a=Yi(t),h=a.Tu.get(e),m=a.Iu.get(h.targetId);if(m.length>1)return a.Iu.set(h.targetId,m.filter(v=>!RT(v,e))),void a.Tu.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(h.targetId),a.sharedClientState.isActiveQueryTarget(h.targetId)||await CC(a.localStore,h.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(h.targetId),n&&HP(a.remoteStore,h.targetId),kC(a,h.targetId)}).catch(Jg)):(kC(a,h.targetId),await CC(a.localStore,h.targetId,!0))}async function wee(t,e){const n=Yi(t),a=n.Tu.get(e),h=n.Iu.get(a.targetId);n.isPrimaryClient&&h.length===1&&(n.sharedClientState.removeLocalQueryTarget(a.targetId),HP(n.remoteStore,a.targetId))}async function bee(t,e,n){const a=Pee(t);try{const h=await function(v,o){const S=Yi(v),P=Rs.now(),N=o.reduce((Q,oe)=>Q.add(oe.key),Sr());let V,j;return S.persistence.runTransaction("Locally write mutations","readwrite",Q=>{let oe=xh(),me=Sr();return S.Ns.getEntries(Q,N).next(Ue=>{oe=Ue,oe.forEach((de,ge)=>{ge.isValidDocument()||(me=me.add(de))})}).next(()=>S.localDocuments.getOverlayedDocuments(Q,oe)).next(Ue=>{V=Ue;const de=[];for(const ge of o){const Re=LQ(ge,V.get(ge.key).overlayedDocument);Re!=null&&de.push(new lf(ge.key,Re,S5(Re.value.mapValue),Pc.exists(!0)))}return S.mutationQueue.addMutationBatch(Q,P,de,o)}).next(Ue=>{j=Ue;const de=Ue.applyToLocalDocumentSet(V,me);return S.documentOverlayCache.saveOverlays(Q,Ue.batchId,de)})}).then(()=>({batchId:j.batchId,changes:F5(V)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(h.batchId),function(v,o,S){let P=v.Vu[v.currentUser.toKey()];P||(P=new yo(Ir)),P=P.insert(o,S),v.Vu[v.currentUser.toKey()]=P}(a,h.batchId,n),await Zx(a,h.changes),await FT(a.remoteStore)}catch(h){const m=KP(h,"Failed to persist write");n.reject(m)}}async function _U(t,e){const n=Yi(t);try{const a=await MJ(n.localStore,e);e.targetChanges.forEach((h,m)=>{const v=n.Au.get(m);v&&(Jr(h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size<=1,22616),h.addedDocuments.size>0?v.hu=!0:h.modifiedDocuments.size>0?Jr(v.hu,14607):h.removedDocuments.size>0&&(Jr(v.hu,42227),v.hu=!1))}),await Zx(n,a,e)}catch(a){await Jg(a)}}function EF(t,e,n){const a=Yi(t);if(a.isPrimaryClient&&n===0||!a.isPrimaryClient&&n===1){const h=[];a.Tu.forEach((m,v)=>{const o=v.view.va(e);o.snapshot&&h.push(o.snapshot)}),function(v,o){const S=Yi(v);S.onlineState=o;let P=!1;S.queries.forEach((N,V)=>{for(const j of V.Sa)j.va(o)&&(P=!0)}),P&&YP(S)}(a.eventManager,e),h.length&&a.Pu.H_(h),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function Tee(t,e,n){const a=Yi(t);a.sharedClientState.updateQueryState(e,"rejected",n);const h=a.Au.get(e),m=h&&h.key;if(m){let v=new yo(pi.comparator);v=v.insert(m,ma.newNoDocument(m,qi.min()));const o=Sr().add(m),S=new LT(qi.min(),new Map,new yo(Ir),v,o);await _U(a,S),a.du=a.du.remove(m),a.Au.delete(e),JP(a)}else await CC(a.localStore,e,!1).then(()=>kC(a,e,n)).catch(Jg)}async function Eee(t,e){const n=Yi(t),a=e.batch.batchId;try{const h=await kJ(n.localStore,e);vU(n,a,null),yU(n,a),n.sharedClientState.updateMutationState(a,"acknowledged"),await Zx(n,h)}catch(h){await Jg(h)}}async function Iee(t,e,n){const a=Yi(t);try{const h=await function(v,o){const S=Yi(v);return S.persistence.runTransaction("Reject batch","readwrite-primary",P=>{let N;return S.mutationQueue.lookupMutationBatch(P,o).next(V=>(Jr(V!==null,37113),N=V.keys(),S.mutationQueue.removeMutationBatch(P,V))).next(()=>S.mutationQueue.performConsistencyCheck(P)).next(()=>S.documentOverlayCache.removeOverlaysForBatchId(P,N,o)).next(()=>S.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(P,N)).next(()=>S.localDocuments.getDocuments(P,N))})}(a.localStore,e);vU(a,e,n),yU(a,e),a.sharedClientState.updateMutationState(e,"rejected",n),await Zx(a,h)}catch(h){await Jg(h)}}function yU(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function vU(t,e,n){const a=Yi(t);let h=a.Vu[a.currentUser.toKey()];if(h){const m=h.get(e);m&&(n?m.reject(n):m.resolve(),h=h.remove(e)),a.Vu[a.currentUser.toKey()]=h}}function kC(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const a of t.Iu.get(e))t.Tu.delete(a),n&&t.Pu.yu(a,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(a=>{t.Ru.containsKey(a)||xU(t,a)})}function xU(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(HP(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),JP(t))}function IF(t,e,n){for(const a of n)a instanceof pU?(t.Ru.addReference(a.key,e),See(t,a)):a instanceof mU?($n(QP,"Document no longer in limbo: "+a.key),t.Ru.removeReference(a.key,e),t.Ru.containsKey(a.key)||xU(t,a.key)):Oi(19791,{wu:a})}function See(t,e){const n=e.key,a=n.path.canonicalString();t.du.get(n)||t.Eu.has(a)||($n(QP,"New document in limbo: "+n),t.Eu.add(a),JP(t))}function JP(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new pi(vs.fromString(e)),a=t.fu.next();t.Au.set(a,new mee(n)),t.du=t.du.insert(n,a),lU(t.remoteStore,new Sd(wu(LP(n.path)),a,"TargetPurposeLimboResolution",AT.ce))}}async function Zx(t,e,n){const a=Yi(t),h=[],m=[],v=[];a.Tu.isEmpty()||(a.Tu.forEach((o,S)=>{v.push(a.pu(S,e,n).then(P=>{var N;if((P||n)&&a.isPrimaryClient){const V=P?!P.fromCache:(N=n==null?void 0:n.targetChanges.get(S.targetId))==null?void 0:N.current;a.sharedClientState.updateQueryState(S.targetId,V?"current":"not-current")}if(P){h.push(P);const V=GP.As(S.targetId,P);m.push(V)}}))}),await Promise.all(v),a.Pu.H_(h),await async function(S,P){const N=Yi(S);try{await N.persistence.runTransaction("notifyLocalViewChanges","readwrite",V=>nn.forEach(P,j=>nn.forEach(j.Es,Q=>N.persistence.referenceDelegate.addReference(V,j.targetId,Q)).next(()=>nn.forEach(j.ds,Q=>N.persistence.referenceDelegate.removeReference(V,j.targetId,Q)))))}catch(V){if(!e_(V))throw V;$n($P,"Failed to update sequence numbers: "+V)}for(const V of P){const j=V.targetId;if(!V.fromCache){const Q=N.Ms.get(j),oe=Q.snapshotVersion,me=Q.withLastLimboFreeSnapshotVersion(oe);N.Ms=N.Ms.insert(j,me)}}}(a.localStore,m))}async function Aee(t,e){const n=Yi(t);if(!n.currentUser.isEqual(e)){$n(QP,"User change. New user:",e.toKey());const a=await rU(n.localStore,e);n.currentUser=e,function(m,v){m.mu.forEach(o=>{o.forEach(S=>{S.reject(new Bn(en.CANCELLED,v))})}),m.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await Zx(n,a.Ls)}}function Cee(t,e){const n=Yi(t),a=n.Au.get(e);if(a&&a.hu)return Sr().add(a.key);{let h=Sr();const m=n.Iu.get(e);if(!m)return h;for(const v of m){const o=n.Tu.get(v);h=h.unionWith(o.view.nu)}return h}}function wU(t){const e=Yi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=_U.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cee.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Tee.bind(null,e),e.Pu.H_=uee.bind(null,e.eventManager),e.Pu.yu=hee.bind(null,e.eventManager),e}function Pee(t){const e=Yi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Eee.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Iee.bind(null,e),e}class Ub{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=OT(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return RJ(this.persistence,new AJ,e.initialUser,this.serializer)}Cu(e){return new iU(jP.mi,this.serializer)}Du(e){return new FJ}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ub.provider={build:()=>new Ub};class Ree extends Ub{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Jr(this.persistence.referenceDelegate instanceof Bb,46915);const a=this.persistence.referenceDelegate.garbageCollector;return new dJ(a,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Ja.withCacheSize(this.cacheSizeBytes):Ja.DEFAULT;return new iU(a=>Bb.mi(a,n),this.serializer)}}class MC{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>EF(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=Aee.bind(null,this.syncEngine),await see(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new aee}()}createDatastore(e){const n=OT(e.databaseInfo.databaseId),a=function(m){return new jJ(m)}(e.databaseInfo);return function(m,v,o,S){return new qJ(m,v,o,S)}(e.authCredentials,e.appCheckCredentials,a,n)}createRemoteStore(e){return function(a,h,m,v,o){return new ZJ(a,h,m,v,o)}(this.localStore,this.datastore,e.asyncQueue,n=>EF(this.syncEngine,n,0),function(){return yF.v()?new yF:new NJ}())}createSyncEngine(e,n){return function(h,m,v,o,S,P,N){const V=new gee(h,m,v,o,S,P);return N&&(V.gu=!0),V}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(h){const m=Yi(h);$n(fp,"RemoteStore shutting down."),m.Ea.add(5),await Wx(m),m.Aa.shutdown(),m.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}MC.provider={build:()=>new MC};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kee{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):vh("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kd="FirestoreClient";class Mee{constructor(e,n,a,h,m){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=a,this.databaseInfo=h,this.user=fa.UNAUTHENTICATED,this.clientId=CP.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=m,this.authCredentials.start(a,async v=>{$n(Kd,"Received user=",v.uid),await this.authCredentialListener(v),this.user=v}),this.appCheckCredentials.start(a,v=>($n(Kd,"Received new app check token=",v),this.appCheckCredentialListener(v,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ip;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const a=KP(n,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function DS(t,e){t.asyncQueue.verifyOperationInProgress(),$n(Kd,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let a=n.initialUser;t.setCredentialChangeListener(async h=>{a.isEqual(h)||(await rU(e.localStore,h),a=h)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function SF(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Dee(t);$n(Kd,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(a=>xF(e.remoteStore,a)),t.setAppCheckTokenChangeListener((a,h)=>xF(e.remoteStore,h)),t._onlineComponents=e}async function Dee(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){$n(Kd,"Using user provided OfflineComponentProvider");try{await DS(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(h){return h.name==="FirebaseError"?h.code===en.FAILED_PRECONDITION||h.code===en.UNIMPLEMENTED:!(typeof DOMException<"u"&&h instanceof DOMException)||h.code===22||h.code===20||h.code===11}(n))throw n;Dg("Error using user provided cache. Falling back to memory cache: "+n),await DS(t,new Ub)}}else $n(Kd,"Using default OfflineComponentProvider"),await DS(t,new Ree(void 0));return t._offlineComponents}async function bU(t){return t._onlineComponents||(t._uninitializedComponentsProvider?($n(Kd,"Using user provided OnlineComponentProvider"),await SF(t,t._uninitializedComponentsProvider._online)):($n(Kd,"Using default OnlineComponentProvider"),await SF(t,new MC))),t._onlineComponents}function Lee(t){return bU(t).then(e=>e.syncEngine)}async function AF(t){const e=await bU(t),n=e.eventManager;return n.onListen=_ee.bind(null,e.syncEngine),n.onUnlisten=xee.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=yee.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=wee.bind(null,e.syncEngine),n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TU(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CF=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EU="firestore.googleapis.com",PF=!0;class RF{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Bn(en.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=EU,this.ssl=PF}else this.host=e.host,this.ssl=e.ssl??PF;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=nU;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<uJ)throw new Bn(en.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ZY("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=TU(e.experimentalLongPollingOptions??{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new Bn(en.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new Bn(en.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new Bn(en.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,h){return a.timeoutSeconds===h.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class NT{constructor(e,n,a,h){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=a,this._app=h,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new RF({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Bn(en.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Bn(en.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new RF(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new NY;switch(a.type){case"firstParty":return new jY(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new Bn(en.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const a=CF.get(n);a&&($n("ComponentProvider","Removing Datastore"),CF.delete(n),a.terminate())}(this),Promise.resolve()}}function Oee(t,e,n,a={}){var P;t=Nd(t,NT);const h=tf(e),m=t._getSettings(),v={...m,emulatorOptions:t._getEmulatorOptions()},o=`${e}:${n}`;h&&(hP(`https://${o}`),dP("Firestore",!0)),m.host!==EU&&m.host!==o&&Dg("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const S={...m,host:o,ssl:h,emulatorOptions:a};if(!Dc(S,v)&&(t._setSettings(S),a.mockUserToken)){let N,V;if(typeof a.mockUserToken=="string")N=a.mockUserToken,V=fa.MOCK_USER;else{N=yV(a.mockUserToken,(P=t._app)==null?void 0:P.options.projectId);const j=a.mockUserToken.sub||a.mockUserToken.user_id;if(!j)throw new Bn(en.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");V=new fa(j)}t._authCredentials=new BY(new p5(N,V))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ip{constructor(e,n,a){this.converter=n,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Ip(this.firestore,e,this._query)}}class _o{constructor(e,n,a){this.converter=n,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new _o(this.firestore,e,this._key)}toJSON(){return{type:_o._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,a){if($x(n,_o._jsonSchema))return new _o(e,a||null,new pi(vs.fromString(n.referencePath)))}}_o._jsonSchemaVersion="firestore/documentReference/1.0",_o._jsonSchema={type:go("string",_o._jsonSchemaVersion),referencePath:go("string")};class Vd extends Ip{constructor(e,n,a){super(e,n,LP(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new _o(this.firestore,null,new pi(e))}withConverter(e){return new Vd(this.firestore,e,this._path)}}function kF(t,e,...n){if(t=bs(t),m5("collection","path",e),t instanceof NT){const a=vs.fromString(e,...n);return jz(a),new Vd(t,null,a)}{if(!(t instanceof _o||t instanceof Vd))throw new Bn(en.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=t._path.child(vs.fromString(e,...n));return jz(a),new Vd(t.firestore,null,a)}}function Ex(t,e,...n){if(t=bs(t),arguments.length===1&&(e=CP.newId()),m5("doc","path",e),t instanceof NT){const a=vs.fromString(e,...n);return Uz(a),new _o(t,null,new pi(a))}{if(!(t instanceof _o||t instanceof Vd))throw new Bn(en.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=t._path.child(vs.fromString(e,...n));return Uz(a),new _o(t.firestore,t instanceof Vd?t.converter:null,new pi(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MF="AsyncQueue";class DF{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new oU(this,"async_queue_retry"),this._c=()=>{const a=MS();a&&$n(MF,"Visibility state changed to "+a.visibilityState),this.M_.w_()},this.ac=e;const n=MS();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=MS();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new ip;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!e_(e))throw e;$n(MF,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(a=>{throw this.nc=a,this.rc=!1,vh("INTERNAL UNHANDLED ERROR: ",LF(a)),a}).then(a=>(this.rc=!1,a))));return this.ac=n,n}enqueueAfterDelay(e,n,a){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const h=XP.createAndSchedule(this,e,n,a,m=>this.hc(m));return this.tc.push(h),h}uc(){this.nc&&Oi(47125,{Pc:LF(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,a)=>n.targetTimeMs-a.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function LF(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OF(t){return function(n,a){if(typeof n!="object"||n===null)return!1;const h=n;for(const m of a)if(m in h&&typeof h[m]=="function")return!0;return!1}(t,["next","error","complete"])}class Ug extends NT{constructor(e,n,a,h){super(e,n,a,h),this.type="firestore",this._queue=new DF,this._persistenceKey=(h==null?void 0:h.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new DF(e),this._firestoreClient=void 0,await e}}}function zee(t,e){const n=typeof t=="object"?t:Bx(),a=typeof t=="string"?t:Lb,h=Ih(n,"firestore").getImmediate({identifier:a});if(!h._initialized){const m=mV("firestore");m&&Oee(h,...m)}return h}function IU(t){if(t._terminated)throw new Bn(en.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Fee(t),t._firestoreClient}function Fee(t){var a,h,m;const e=t._freezeSettings(),n=function(o,S,P,N){return new sQ(o,S,P,N.host,N.ssl,N.experimentalForceLongPolling,N.experimentalAutoDetectLongPolling,TU(N.experimentalLongPollingOptions),N.useFetchStreams,N.isUsingEmulator)}(t._databaseId,((a=t._app)==null?void 0:a.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(h=e.localCache)!=null&&h._offlineComponentProvider&&((m=e.localCache)!=null&&m._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new Mee(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(o){const S=o==null?void 0:o._online.build();return{_offline:o==null?void 0:o._offline.build(S),_online:S}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ql(na.fromBase64String(e))}catch(n){throw new Bn(en.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Ql(na.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ql._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if($x(e,Ql._jsonSchema))return Ql.fromBase64String(e.bytes)}}Ql._jsonSchemaVersion="firestore/bytes/1.0",Ql._jsonSchema={type:go("string",Ql._jsonSchemaVersion),bytes:go("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BT{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Bn(en.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tu{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Bn(en.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Bn(en.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ir(this._lat,e._lat)||Ir(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Tu._jsonSchemaVersion}}static fromJSON(e){if($x(e,Tu._jsonSchema))return new Tu(e.latitude,e.longitude)}}Tu._jsonSchemaVersion="firestore/geoPoint/1.0",Tu._jsonSchema={type:go("string",Tu._jsonSchemaVersion),latitude:go("number"),longitude:go("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,h){if(a.length!==h.length)return!1;for(let m=0;m<a.length;++m)if(a[m]!==h[m])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Eu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if($x(e,Eu._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Eu(e.vectorValues);throw new Bn(en.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Eu._jsonSchemaVersion="firestore/vectorValue/1.0",Eu._jsonSchema={type:go("string",Eu._jsonSchemaVersion),vectorValues:go("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nee=/^__.*__$/;class Bee{constructor(e,n,a){this.data=e,this.fieldMask=n,this.fieldTransforms=a}toMutation(e,n){return this.fieldMask!==null?new lf(e,this.data,this.fieldMask,n,this.fieldTransforms):new Hx(e,this.data,n,this.fieldTransforms)}}class SU{constructor(e,n,a){this.data=e,this.fieldMask=n,this.fieldTransforms=a}toMutation(e,n){return new lf(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function AU(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Oi(40011,{Ac:t})}}class VT{constructor(e,n,a,h,m,v){this.settings=e,this.databaseId=n,this.serializer=a,this.ignoreUndefinedProperties=h,m===void 0&&this.Rc(),this.fieldTransforms=m||[],this.fieldMask=v||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new VT({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var h;const n=(h=this.path)==null?void 0:h.child(e),a=this.Vc({path:n,fc:!1});return a.gc(e),a}yc(e){var h;const n=(h=this.path)==null?void 0:h.child(e),a=this.Vc({path:n,fc:!1});return a.Rc(),a}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return jb(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(AU(this.Ac)&&Nee.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Vee{constructor(e,n,a){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=a||OT(e)}Cc(e,n,a,h=!1){return new VT({Ac:e,methodName:n,Dc:a,path:Jo.emptyPath(),fc:!1,bc:h},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function eR(t){const e=t._freezeSettings(),n=OT(t._databaseId);return new Vee(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Uee(t,e,n,a,h,m={}){const v=t.Cc(m.merge||m.mergeFields?2:0,e,n,h);rR("Data must be an object, but it was:",v,a);const o=PU(a,v);let S,P;if(m.merge)S=new Il(v.fieldMask),P=v.fieldTransforms;else if(m.mergeFields){const N=[];for(const V of m.mergeFields){const j=DC(e,V,n);if(!v.contains(j))throw new Bn(en.INVALID_ARGUMENT,`Field '${j}' is specified in your field mask but missing from your input data.`);kU(N,j)||N.push(j)}S=new Il(N),P=v.fieldTransforms.filter(V=>S.covers(V.field))}else S=null,P=v.fieldTransforms;return new Bee(new nl(o),S,P)}class UT extends i_{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof UT}}function CU(t,e,n){return new VT({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class tR extends i_{_toFieldTransform(e){return new zP(e.path,new Tx)}isEqual(e){return e instanceof tR}}class nR extends i_{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=CU(this,e,!0),a=this.vc.map(m=>Sp(m,n)),h=new Fg(a);return new zP(e.path,h)}isEqual(e){return e instanceof nR&&Dc(this.vc,e.vc)}}class iR extends i_{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=CU(this,e,!0),a=this.vc.map(m=>Sp(m,n)),h=new Ng(a);return new zP(e.path,h)}isEqual(e){return e instanceof iR&&Dc(this.vc,e.vc)}}function jee(t,e,n,a){const h=t.Cc(1,e,n);rR("Data must be an object, but it was:",h,a);const m=[],v=nl.empty();af(a,(S,P)=>{const N=sR(e,S,n);P=bs(P);const V=h.yc(N);if(P instanceof UT)m.push(N);else{const j=Sp(P,V);j!=null&&(m.push(N),v.set(N,j))}});const o=new Il(m);return new SU(v,o,h.fieldTransforms)}function Gee(t,e,n,a,h,m){const v=t.Cc(1,e,n),o=[DC(e,a,n)],S=[h];if(m.length%2!=0)throw new Bn(en.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let j=0;j<m.length;j+=2)o.push(DC(e,m[j])),S.push(m[j+1]);const P=[],N=nl.empty();for(let j=o.length-1;j>=0;--j)if(!kU(P,o[j])){const Q=o[j];let oe=S[j];oe=bs(oe);const me=v.yc(Q);if(oe instanceof UT)P.push(Q);else{const Ue=Sp(oe,me);Ue!=null&&(P.push(Q),N.set(Q,Ue))}}const V=new Il(P);return new SU(N,V,v.fieldTransforms)}function $ee(t,e,n,a=!1){return Sp(n,t.Cc(a?4:3,e))}function Sp(t,e){if(RU(t=bs(t)))return rR("Unsupported field value:",e,t),PU(t,e);if(t instanceof i_)return function(a,h){if(!AU(h.Ac))throw h.Sc(`${a._methodName}() can only be used with update() and set()`);if(!h.path)throw h.Sc(`${a._methodName}() is not currently supported inside arrays`);const m=a._toFieldTransform(h);m&&h.fieldTransforms.push(m)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(a,h){const m=[];let v=0;for(const o of a){let S=Sp(o,h.wc(v));S==null&&(S={nullValue:"NULL_VALUE"}),m.push(S),v++}return{arrayValue:{values:m}}}(t,e)}return function(a,h){if((a=bs(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return CQ(h.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const m=Rs.fromDate(a);return{timestampValue:Nb(h.serializer,m)}}if(a instanceof Rs){const m=new Rs(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Nb(h.serializer,m)}}if(a instanceof Tu)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof Ql)return{bytesValue:X5(h.serializer,a._byteString)};if(a instanceof _o){const m=h.databaseId,v=a.firestore._databaseId;if(!v.isEqual(m))throw h.Sc(`Document reference is for database ${v.projectId}/${v.database} but should be for database ${m.projectId}/${m.database}`);return{referenceValue:VP(a.firestore._databaseId||h.databaseId,a._key.path)}}if(a instanceof Eu)return function(v,o){return{mapValue:{fields:{[E5]:{stringValue:I5},[Ob]:{arrayValue:{values:v.toArray().map(P=>{if(typeof P!="number")throw o.Sc("VectorValues must only contain numeric values.");return OP(o.serializer,P)})}}}}}}(a,h);throw h.Sc(`Unsupported field value: ${ST(a)}`)}(t,e)}function PU(t,e){const n={};return y5(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):af(t,(a,h)=>{const m=Sp(h,e.mc(a));m!=null&&(n[a]=m)}),{mapValue:{fields:n}}}function RU(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Rs||t instanceof Tu||t instanceof Ql||t instanceof _o||t instanceof i_||t instanceof Eu)}function rR(t,e,n){if(!RU(n)||!g5(n)){const a=ST(n);throw a==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+a)}}function DC(t,e,n){if((e=bs(e))instanceof BT)return e._internalPath;if(typeof e=="string")return sR(t,e);throw jb("Field path arguments must be of type string or ",t,!1,void 0,n)}const Hee=new RegExp("[~\\*/\\[\\]]");function sR(t,e,n){if(e.search(Hee)>=0)throw jb(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new BT(...e.split("."))._internalPath}catch{throw jb(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function jb(t,e,n,a,h){const m=a&&!a.isEmpty(),v=h!==void 0;let o=`Function ${e}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let S="";return(m||v)&&(S+=" (found",m&&(S+=` in field ${a}`),v&&(S+=` in document ${h}`),S+=")"),new Bn(en.INVALID_ARGUMENT,o+t+S)}function kU(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(e,n,a,h,m){this._firestore=e,this._userDataWriter=n,this._key=a,this._document=h,this._converter=m}get id(){return this._key.path.lastSegment()}get ref(){return new _o(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new qee(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(jT("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class qee extends MU{data(){return super.data()}}function jT(t,e){return typeof e=="string"?sR(t,e):e instanceof BT?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wee(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Bn(en.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class oR{}class DU extends oR{}function zF(t,e,...n){let a=[];e instanceof oR&&a.push(e),a=a.concat(n),function(m){const v=m.filter(S=>S instanceof aR).length,o=m.filter(S=>S instanceof GT).length;if(v>1||v>0&&o>0)throw new Bn(en.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const h of a)t=h._apply(t);return t}class GT extends DU{constructor(e,n,a){super(),this._field=e,this._op=n,this._value=a,this.type="where"}static _create(e,n,a){return new GT(e,n,a)}_apply(e){const n=this._parse(e);return LU(e._query,n),new Ip(e.firestore,e.converter,bC(e._query,n))}_parse(e){const n=eR(e.firestore);return function(m,v,o,S,P,N,V){let j;if(P.isKeyField()){if(N==="array-contains"||N==="array-contains-any")throw new Bn(en.INVALID_ARGUMENT,`Invalid Query. You can't perform '${N}' queries on documentId().`);if(N==="in"||N==="not-in"){BF(V,N);const oe=[];for(const me of V)oe.push(NF(S,m,me));j={arrayValue:{values:oe}}}else j=NF(S,m,V)}else N!=="in"&&N!=="not-in"&&N!=="array-contains-any"||BF(V,N),j=$ee(o,v,V,N==="in"||N==="not-in");return mo.create(P,N,j)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Zee(t,e,n){const a=e,h=jT("where",t);return GT._create(h,a,n)}class aR extends oR{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new aR(e,n)}_parse(e){const n=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return n.length===1?n[0]:Lc.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(h,m){let v=h;const o=m.getFlattenedFilters();for(const S of o)LU(v,S),v=bC(v,S)}(e._query,n),new Ip(e.firestore,e.converter,bC(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class lR extends DU{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new lR(e,n)}_apply(e){const n=function(h,m,v){if(h.startAt!==null)throw new Bn(en.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(h.endAt!==null)throw new Bn(en.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bx(m,v)}(e._query,this._field,this._direction);return new Ip(e.firestore,e.converter,function(h,m){const v=h.explicitOrderBy.concat([m]);return new t_(h.path,h.collectionGroup,v,h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(e._query,n))}}function FF(t,e="asc"){const n=e,a=jT("orderBy",t);return lR._create(a,n)}function NF(t,e,n){if(typeof(n=bs(n))=="string"){if(n==="")throw new Bn(en.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!D5(e)&&n.indexOf("/")!==-1)throw new Bn(en.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const a=e.path.child(vs.fromString(n));if(!pi.isDocumentKey(a))throw new Bn(en.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return Kz(t,new pi(a))}if(n instanceof _o)return Kz(t,n._key);throw new Bn(en.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ST(n)}.`)}function BF(t,e){if(!Array.isArray(t)||t.length===0)throw new Bn(en.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function LU(t,e){const n=function(h,m){for(const v of h)for(const o of v.getFlattenedFilters())if(m.indexOf(o.op)>=0)return o.op;return null}(t.filters,function(h){switch(h){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new Bn(en.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Bn(en.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Xee{convertValue(e,n="none"){switch(Zd(e)){case 0:return null;case 1:return e.booleanValue;case 2:return to(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Wd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Oi(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const a={};return af(e,(h,m)=>{a[h]=this.convertValue(m,n)}),a}convertVectorValue(e){var a,h,m;const n=(m=(h=(a=e.fields)==null?void 0:a[Ob].arrayValue)==null?void 0:h.values)==null?void 0:m.map(v=>to(v.doubleValue));return new Eu(n)}convertGeoPoint(e){return new Tu(to(e.latitude),to(e.longitude))}convertArray(e,n){return(e.values||[]).map(a=>this.convertValue(a,n))}convertServerTimestamp(e,n){switch(n){case"previous":const a=PT(e);return a==null?null:this.convertValue(a,n);case"estimate":return this.convertTimestamp(vx(e));default:return null}}convertTimestamp(e){const n=qd(e);return new Rs(n.seconds,n.nanos)}convertDocumentKey(e,n){const a=vs.fromString(e);Jr(tU(a),9688,{name:e});const h=new xx(a.get(1),a.get(3)),m=new pi(a.popFirst(5));return h.isEqual(n)||vh(`Document ${m} contains a document reference within a different database (${h.projectId}/${h.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),m}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kee(t,e,n){let a;return a=t?t.toFirestore(e):e,a}class Sv{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rp extends MU{constructor(e,n,a,h,m,v){super(e,n,a,h,v),this._firestore=e,this._firestoreImpl=e,this.metadata=m}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Z1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const a=this._document.data.field(jT("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Bn(en.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=rp._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}rp._jsonSchemaVersion="firestore/documentSnapshot/1.0",rp._jsonSchema={type:go("string",rp._jsonSchemaVersion),bundleSource:go("string","DocumentSnapshot"),bundleName:go("string"),bundle:go("string")};class Z1 extends rp{data(e={}){return super.data(e)}}class xg{constructor(e,n,a,h){this._firestore=e,this._userDataWriter=n,this._snapshot=h,this.metadata=new Sv(h.hasPendingWrites,h.fromCache),this.query=a}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(a=>{e.call(n,new Z1(this._firestore,this._userDataWriter,a.key,a,new Sv(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Bn(en.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(h,m){if(h._snapshot.oldDocs.isEmpty()){let v=0;return h._snapshot.docChanges.map(o=>{const S=new Z1(h._firestore,h._userDataWriter,o.doc.key,o.doc,new Sv(h._snapshot.mutatedKeys.has(o.doc.key),h._snapshot.fromCache),h.query.converter);return o.doc,{type:"added",doc:S,oldIndex:-1,newIndex:v++}})}{let v=h._snapshot.oldDocs;return h._snapshot.docChanges.filter(o=>m||o.type!==3).map(o=>{const S=new Z1(h._firestore,h._userDataWriter,o.doc.key,o.doc,new Sv(h._snapshot.mutatedKeys.has(o.doc.key),h._snapshot.fromCache),h.query.converter);let P=-1,N=-1;return o.type!==0&&(P=v.indexOf(o.doc.key),v=v.delete(o.doc.key)),o.type!==1&&(v=v.add(o.doc),N=v.indexOf(o.doc.key)),{type:Yee(o.type),doc:S,oldIndex:P,newIndex:N}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Bn(en.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=xg._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=CP.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],a=[],h=[];return this.docs.forEach(m=>{m._document!==null&&(n.push(m._document),a.push(this._userDataWriter.convertObjectMap(m._document.data.value.mapValue.fields,"previous")),h.push(m.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Yee(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Oi(61501,{type:t})}}xg._jsonSchemaVersion="firestore/querySnapshot/1.0",xg._jsonSchema={type:go("string",xg._jsonSchemaVersion),bundleSource:go("string","QuerySnapshot"),bundleName:go("string"),bundle:go("string")};class OU extends Xee{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ql(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new _o(this.firestore,null,n)}}function LC(t,e,n,...a){t=Nd(t,_o);const h=Nd(t.firestore,Ug),m=eR(h);let v;return v=typeof(e=bs(e))=="string"||e instanceof BT?Gee(m,"updateDoc",t._key,e,n,a):jee(m,"updateDoc",t._key,e),cR(h,[v.toMutation(t._key,Pc.exists(!0))])}function Qee(t){return cR(Nd(t.firestore,Ug),[new FP(t._key,Pc.none())])}function Jee(t,e){const n=Nd(t.firestore,Ug),a=Ex(t),h=Kee(t.converter,e);return cR(n,[Uee(eR(t.firestore),"addDoc",a._key,h,t.converter!==null,{}).toMutation(a._key,Pc.exists(!1))]).then(()=>a)}function ete(t,...e){var S,P,N;t=bs(t);let n={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||OF(e[a])||(n=e[a++]);const h={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(OF(e[a])){const V=e[a];e[a]=(S=V.next)==null?void 0:S.bind(V),e[a+1]=(P=V.error)==null?void 0:P.bind(V),e[a+2]=(N=V.complete)==null?void 0:N.bind(V)}let m,v,o;if(t instanceof _o)v=Nd(t.firestore,Ug),o=LP(t._key.path),m={next:V=>{e[a]&&e[a](tte(v,t,V))},error:e[a+1],complete:e[a+2]};else{const V=Nd(t,Ip);v=Nd(V.firestore,Ug),o=V._query;const j=new OU(v);m={next:Q=>{e[a]&&e[a](new xg(v,j,V,Q))},error:e[a+1],complete:e[a+2]},Wee(t._query)}return function(j,Q,oe,me){const Ue=new kee(me),de=new dee(Q,Ue,oe);return j.asyncQueue.enqueueAndForget(async()=>lee(await AF(j),de)),()=>{Ue.Nu(),j.asyncQueue.enqueueAndForget(async()=>cee(await AF(j),de))}}(IU(v),o,h,m)}function cR(t,e){return function(a,h){const m=new ip;return a.asyncQueue.enqueueAndForget(async()=>bee(await Lee(a),h,m)),m.promise}(IU(t),e)}function tte(t,e,n){const a=n.docs.get(e._key),h=new OU(t);return new rp(t,h,e._key,a,new Sv(n.hasPendingWrites,n.fromCache),e.converter)}function nte(){return new tR("serverTimestamp")}function VF(...t){return new nR("arrayUnion",t)}function ite(...t){return new iR("arrayRemove",t)}(function(e,n=!0){(function(h){Qg=h})(bp),kl(new ul("firestore",(a,{instanceIdentifier:h,options:m})=>{const v=a.getProvider("app").getImmediate(),o=new Ug(new VY(a.getProvider("auth-internal")),new GY(v,a.getProvider("app-check-internal")),function(P,N){if(!Object.prototype.hasOwnProperty.apply(P.options,["projectId"]))throw new Bn(en.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xx(P.options.projectId,N)}(v,h),v);return m={useFetchStreams:n,...m},o._setSettings(m),o},"PUBLIC").setMultipleInstances(!0)),va(Fz,Nz,e),va(Fz,Nz,"esm2020")})();var UF={};const jF="@firebase/database",GF="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zU="";function rte(t){zU=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ste{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Qo(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:px(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ote{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Eh(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FU=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ste(e)}}catch{}return new ote},Jf=FU("localStorage"),ate=FU("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wg=new Nx("@firebase/database"),lte=function(){let t=1;return function(){return t++}}(),NU=function(t){const e=aZ(t),n=new nZ;n.update(e);const a=n.digest();return cP.encodeByteArray(a)},Xx=function(...t){let e="";for(let n=0;n<t.length;n++){const a=t[n];Array.isArray(a)||a&&typeof a=="object"&&typeof a.length=="number"?e+=Xx.apply(null,a):typeof a=="object"?e+=Qo(a):e+=a,e+=" "}return e};let jv=null,$F=!0;const cte=function(t,e){zn(!0,"Can't turn on custom loggers persistently."),wg.logLevel=vr.VERBOSE,jv=wg.log.bind(wg)},ga=function(...t){if($F===!0&&($F=!1,jv===null&&ate.get("logging_enabled")===!0&&cte()),jv){const e=Xx.apply(null,t);jv(e)}},Kx=function(t){return function(...e){ga(t,...e)}},OC=function(...t){const e="FIREBASE INTERNAL ERROR: "+Xx(...t);wg.error(e)},wh=function(...t){const e=`FIREBASE FATAL ERROR: ${Xx(...t)}`;throw wg.error(e),new Error(e)},Cl=function(...t){const e="FIREBASE WARNING: "+Xx(...t);wg.warn(e)},ute=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Cl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},BU=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},hte=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},jg="[MIN_NAME]",pp="[MAX_NAME]",r_=function(t,e){if(t===e)return 0;if(t===jg||e===pp)return-1;if(e===jg||t===pp)return 1;{const n=HF(t),a=HF(e);return n!==null?a!==null?n-a===0?t.length-e.length:n-a:-1:a!==null?1:t<e?-1:1}},dte=function(t,e){return t===e?0:t<e?-1:1},uv=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Qo(e))},uR=function(t){if(typeof t!="object"||t===null)return Qo(t);const e=[];for(const a in t)e.push(a);e.sort();let n="{";for(let a=0;a<e.length;a++)a!==0&&(n+=","),n+=Qo(e[a]),n+=":",n+=uR(t[e[a]]);return n+="}",n},VU=function(t,e){const n=t.length;if(n<=e)return[t];const a=[];for(let h=0;h<n;h+=e)h+e>n?a.push(t.substring(h,n)):a.push(t.substring(h,h+e));return a};function sc(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const UU=function(t){zn(!BU(t),"Invalid JSON number");const e=11,n=52,a=(1<<e-1)-1;let h,m,v,o,S;t===0?(m=0,v=0,h=1/t===-1/0?1:0):(h=t<0,t=Math.abs(t),t>=Math.pow(2,1-a)?(o=Math.min(Math.floor(Math.log(t)/Math.LN2),a),m=o+a,v=Math.round(t*Math.pow(2,n-o)-Math.pow(2,n))):(m=0,v=Math.round(t/Math.pow(2,1-a-n))));const P=[];for(S=n;S;S-=1)P.push(v%2?1:0),v=Math.floor(v/2);for(S=e;S;S-=1)P.push(m%2?1:0),m=Math.floor(m/2);P.push(h?1:0),P.reverse();const N=P.join("");let V="";for(S=0;S<64;S+=8){let j=parseInt(N.substr(S,8),2).toString(16);j.length===1&&(j="0"+j),V=V+j}return V.toLowerCase()},fte=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},pte=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},mte=new RegExp("^-?(0*)\\d{1,10}$"),gte=-2147483648,_te=2147483647,HF=function(t){if(mte.test(t)){const e=Number(t);if(e>=gte&&e<=_te)return e}return null},Yx=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw Cl("Exception was thrown by user callback.",n),e},Math.floor(0))}},yte=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Gv=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vte{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,tl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(a=>this.appCheck=a)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,a)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,a):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(a=>a.addTokenListener(e))}notifyForInvalidToken(){Cl(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xte{constructor(e,n,a){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=a,this.auth_=null,this.auth_=a.getImmediate({optional:!0}),this.auth_||a.onInit(h=>this.auth_=h)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(ga("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,a)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,a):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Cl(e)}}class X1{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}X1.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hR="5",jU="v",GU="s",$U="r",HU="f",qU=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,WU="ls",ZU="p",zC="ac",XU="websocket",KU="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YU{constructor(e,n,a,h,m=!1,v="",o=!1,S=!1,P=null){this.secure=n,this.namespace=a,this.webSocketOnly=h,this.nodeAdmin=m,this.persistenceKey=v,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=S,this.emulatorOptions=P,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Jf.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Jf.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function wte(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function QU(t,e,n){zn(typeof e=="string","typeof type must == string"),zn(typeof n=="object","typeof params must == object");let a;if(e===XU)a=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===KU)a=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);wte(t)&&(n.ns=t.namespace);const h=[];return sc(n,(m,v)=>{h.push(m+"="+v)}),a+h.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bte{constructor(){this.counters_={}}incrementCounter(e,n=1){Eh(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return N7(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS={},OS={};function dR(t){const e=t.toString();return LS[e]||(LS[e]=new bte),LS[e]}function Tte(t,e){const n=t.toString();return OS[n]||(OS[n]=e()),OS[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ete{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const a=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let h=0;h<a.length;++h)a[h]&&Yx(()=>{this.onMessage_(a[h])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qF="start",Ite="close",Ste="pLPCommand",Ate="pRTLPCB",JU="id",e6="pw",t6="ser",Cte="cb",Pte="seg",Rte="ts",kte="d",Mte="dframe",n6=1870,i6=30,Dte=n6-i6,Lte=25e3,Ote=3e4;class ag{constructor(e,n,a,h,m,v,o){this.connId=e,this.repoInfo=n,this.applicationId=a,this.appCheckToken=h,this.authToken=m,this.transportSessionId=v,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Kx(e),this.stats_=dR(n),this.urlFn=S=>(this.appCheckToken&&(S[zC]=this.appCheckToken),QU(n,KU,S))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Ete(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Ote)),hte(()=>{if(this.isClosed_)return;this.scriptTagHolder=new fR((...m)=>{const[v,o,S,P,N]=m;if(this.incrementIncomingBytes_(m),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,v===qF)this.id=o,this.password=S;else if(v===Ite)o?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(o,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+v)},(...m)=>{const[v,o]=m;this.incrementIncomingBytes_(m),this.myPacketOrderer.handleResponse(v,o)},()=>{this.onClosed_()},this.urlFn);const a={};a[qF]="t",a[t6]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(a[Cte]=this.scriptTagHolder.uniqueCallbackIdentifier),a[jU]=hR,this.transportSessionId&&(a[GU]=this.transportSessionId),this.lastSessionId&&(a[WU]=this.lastSessionId),this.applicationId&&(a[ZU]=this.applicationId),this.appCheckToken&&(a[zC]=this.appCheckToken),typeof location<"u"&&location.hostname&&qU.test(location.hostname)&&(a[$U]=HU);const h=this.urlFn(a);this.log_("Connecting via long-poll to "+h),this.scriptTagHolder.addTag(h,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ag.forceAllow_=!0}static forceDisallow(){ag.forceDisallow_=!0}static isAvailable(){return ag.forceAllow_?!0:!ag.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!fte()&&!pte()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=Qo(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const a=dV(n),h=VU(a,Dte);for(let m=0;m<h.length;m++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,h.length,h[m]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const a={};a[Mte]="t",a[JU]=e,a[e6]=n,this.myDisconnFrame.src=this.urlFn(a),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=Qo(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class fR{constructor(e,n,a,h){this.onDisconnect=a,this.urlFn=h,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=lte(),window[Ste+this.uniqueCallbackIdentifier]=e,window[Ate+this.uniqueCallbackIdentifier]=n,this.myIFrame=fR.createIFrame_();let m="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(m='<script>document.domain="'+document.domain+'";<\/script>');const v="<html><body>"+m+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(v),this.myIFrame.doc.close()}catch(o){ga("frame writing exception"),o.stack&&ga(o.stack),ga(o)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ga("No IE domain setting required")}catch{const a=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+a+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[JU]=this.myID,e[e6]=this.myPW,e[t6]=this.currentSerial;let n=this.urlFn(e),a="",h=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+i6+a.length<=n6;){const v=this.pendingSegs.shift();a=a+"&"+Pte+h+"="+v.seg+"&"+Rte+h+"="+v.ts+"&"+kte+h+"="+v.d,h++}return n=n+a,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,a){this.pendingSegs.push({seg:e,ts:n,d:a}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const a=()=>{this.outstandingRequests.delete(n),this.newRequest_()},h=setTimeout(a,Math.floor(Lte)),m=()=>{clearTimeout(h),a()};this.addTag(e,m)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const a=this.myIFrame.doc.createElement("script");a.type="text/javascript",a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(){const h=a.readyState;(!h||h==="loaded"||h==="complete")&&(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a),n())},a.onerror=()=>{ga("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(a)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zte=16384,Fte=45e3;let Gb=null;typeof MozWebSocket<"u"?Gb=MozWebSocket:typeof WebSocket<"u"&&(Gb=WebSocket);class Tc{constructor(e,n,a,h,m,v,o){this.connId=e,this.applicationId=a,this.appCheckToken=h,this.authToken=m,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Kx(this.connId),this.stats_=dR(n),this.connURL=Tc.connectionURL_(n,v,o,h,a),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,a,h,m){const v={};return v[jU]=hR,typeof location<"u"&&location.hostname&&qU.test(location.hostname)&&(v[$U]=HU),n&&(v[GU]=n),a&&(v[WU]=a),h&&(v[zC]=h),m&&(v[ZU]=m),QU(e,XU,v)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Jf.set("previous_websocket_failure",!0);try{let a;X7(),this.mySock=new Gb(this.connURL,[],a)}catch(a){this.log_("Error instantiating WebSocket.");const h=a.message||a.data;h&&this.log_(h),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=a=>{this.handleIncomingFrame(a)},this.mySock.onerror=a=>{this.log_("WebSocket error.  Closing connection.");const h=a.message||a.data;h&&this.log_(h),this.onClosed_()}}start(){}static forceDisallow(){Tc.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,a=navigator.userAgent.match(n);a&&a.length>1&&parseFloat(a[1])<4.4&&(e=!0)}return!e&&Gb!==null&&!Tc.forceDisallow_}static previouslyFailed(){return Jf.isInMemoryStorage||Jf.get("previous_websocket_failure")===!0}markConnectionHealthy(){Jf.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const a=px(n);this.onMessage(a)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(zn(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const a=this.extractFrameCount_(n);a!==null&&this.appendFrame_(a)}}send(e){this.resetKeepAlive();const n=Qo(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const a=VU(n,zte);a.length>1&&this.sendString_(String(a.length));for(let h=0;h<a.length;h++)this.sendString_(a[h])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Fte))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Tc.responsesRequiredToBeHealthy=2;Tc.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{static get ALL_TRANSPORTS(){return[ag,Tc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Tc&&Tc.isAvailable();let a=n&&!Tc.previouslyFailed();if(e.webSocketOnly&&(n||Cl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),a=!0),a)this.transports_=[Tc];else{const h=this.transports_=[];for(const m of Ix.ALL_TRANSPORTS)m&&m.isAvailable()&&h.push(m);Ix.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Ix.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nte=6e4,Bte=5e3,Vte=10*1024,Ute=100*1024,zS="t",WF="d",jte="s",ZF="r",Gte="e",XF="o",KF="a",YF="n",QF="p",$te="h";class Hte{constructor(e,n,a,h,m,v,o,S,P,N){this.id=e,this.repoInfo_=n,this.applicationId_=a,this.appCheckToken_=h,this.authToken_=m,this.onMessage_=v,this.onReady_=o,this.onDisconnect_=S,this.onKill_=P,this.lastSessionId=N,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Kx("c:"+this.id+":"),this.transportManager_=new Ix(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),a=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,a)},Math.floor(0));const h=e.healthyTimeout||0;h>0&&(this.healthyTimeout_=Gv(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Ute?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Vte?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(h)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(zS in e){const n=e[zS];n===KF?this.upgradeIfSecondaryHealthy_():n===ZF?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===XF&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=uv("t",e),a=uv("d",e);if(n==="c")this.onSecondaryControl_(a);else if(n==="d")this.pendingDataMessages.push(a);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:QF,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:KF,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:YF,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=uv("t",e),a=uv("d",e);n==="c"?this.onControl_(a):n==="d"&&this.onDataMessage_(a)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=uv(zS,e);if(WF in e){const a=e[WF];if(n===$te){const h={...a};this.repoInfo_.isUsingEmulator&&(h.h=this.repoInfo_.host),this.onHandshake_(h)}else if(n===YF){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let h=0;h<this.pendingDataMessages.length;++h)this.onDataMessage_(this.pendingDataMessages[h]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===jte?this.onConnectionShutdown_(a):n===ZF?this.onReset_(a):n===Gte?OC("Server Error: "+a):n===XF?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):OC("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,a=e.v,h=e.h;this.sessionId=e.s,this.repoInfo_.host=h,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),hR!==a&&Cl("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),a=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,a),Gv(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Nte))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Gv(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Bte))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:QF,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Jf.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r6{put(e,n,a,h){}merge(e,n,a,h){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,a){}onDisconnectMerge(e,n,a){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6{constructor(e){this.allowedEvents_=e,this.listeners_={},zn(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const a=[...this.listeners_[e]];for(let h=0;h<a.length;h++)a[h].callback.apply(a[h].context,n)}}on(e,n,a){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:a});const h=this.getInitialEvent(e);h&&n.apply(a,h)}off(e,n,a){this.validateEventType_(e);const h=this.listeners_[e]||[];for(let m=0;m<h.length;m++)if(h[m].callback===n&&(!a||a===h[m].context)){h.splice(m,1);return}}validateEventType_(e){zn(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b extends s6{static getInstance(){return new $b}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!fP()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return zn(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JF=32,eN=768;class Ms{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let a=0;for(let h=0;h<this.pieces_.length;h++)this.pieces_[h].length>0&&(this.pieces_[a]=this.pieces_[h],a++);this.pieces_.length=a,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function as(){return new Ms("")}function Or(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Yd(t){return t.pieces_.length-t.pieceNum_}function Ps(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Ms(t.pieces_,e)}function o6(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function qte(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function a6(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function l6(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new Ms(e,0)}function Ho(t,e){const n=[];for(let a=t.pieceNum_;a<t.pieces_.length;a++)n.push(t.pieces_[a]);if(e instanceof Ms)for(let a=e.pieceNum_;a<e.pieces_.length;a++)n.push(e.pieces_[a]);else{const a=e.split("/");for(let h=0;h<a.length;h++)a[h].length>0&&n.push(a[h])}return new Ms(n,0)}function Mr(t){return t.pieceNum_>=t.pieces_.length}function ec(t,e){const n=Or(t),a=Or(e);if(n===null)return e;if(n===a)return ec(Ps(t),Ps(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function c6(t,e){if(Yd(t)!==Yd(e))return!1;for(let n=t.pieceNum_,a=e.pieceNum_;n<=t.pieces_.length;n++,a++)if(t.pieces_[n]!==e.pieces_[a])return!1;return!0}function Ic(t,e){let n=t.pieceNum_,a=e.pieceNum_;if(Yd(t)>Yd(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[a])return!1;++n,++a}return!0}class Wte{constructor(e,n){this.errorPrefix_=n,this.parts_=a6(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let a=0;a<this.parts_.length;a++)this.byteLength_+=bT(this.parts_[a]);u6(this)}}function Zte(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=bT(e),u6(t)}function Xte(t){const e=t.parts_.pop();t.byteLength_-=bT(e),t.parts_.length>0&&(t.byteLength_-=1)}function u6(t){if(t.byteLength_>eN)throw new Error(t.errorPrefix_+"has a key path longer than "+eN+" bytes ("+t.byteLength_+").");if(t.parts_.length>JF)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+JF+") or object contains a cycle "+qf(t))}function qf(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR extends s6{static getInstance(){return new pR}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const a=!document[e];a!==this.visible_&&(this.visible_=a,this.trigger("visible",a))},!1)}getInitialEvent(e){return zn(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hv=1e3,Kte=60*5*1e3,tN=30*1e3,Yte=1.3,Qte=3e4,Jte="server_kill",nN=3;class uh extends r6{constructor(e,n,a,h,m,v,o,S){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=a,this.onConnectStatus_=h,this.onServerInfoUpdate_=m,this.authTokenProvider_=v,this.appCheckTokenProvider_=o,this.authOverride_=S,this.id=uh.nextPersistentConnectionId_++,this.log_=Kx("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=hv,this.maxReconnectDelay_=Kte,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,S)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");pR.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&$b.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,a){const h=++this.requestNumber_,m={r:h,a:e,b:n};this.log_(Qo(m)),zn(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(m),a&&(this.requestCBHash_[h]=a)}get(e){this.initConnection_();const n=new uP,h={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:v=>{const o=v.d;v.s==="ok"?n.resolve(o):n.reject(o)}};this.outstandingGets_.push(h),this.outstandingGetCount_++;const m=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(m),n.promise}listen(e,n,a,h){this.initConnection_();const m=e._queryIdentifier,v=e._path.toString();this.log_("Listen called for "+v+" "+m),this.listens.has(v)||this.listens.set(v,new Map),zn(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),zn(!this.listens.get(v).has(m),"listen() called twice for same path/queryId.");const o={onComplete:h,hashFn:n,query:e,tag:a};this.listens.get(v).set(m,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,a=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(a)})}sendListen_(e){const n=e.query,a=n._path.toString(),h=n._queryIdentifier;this.log_("Listen on "+a+" for "+h);const m={p:a},v="q";e.tag&&(m.q=n._queryObject,m.t=e.tag),m.h=e.hashFn(),this.sendRequest(v,m,o=>{const S=o.d,P=o.s;uh.warnOnListenWarnings_(S,n),(this.listens.get(a)&&this.listens.get(a).get(h))===e&&(this.log_("listen response",o),P!=="ok"&&this.removeListen_(a,h),e.onComplete&&e.onComplete(P,S))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Eh(e,"w")){const a=Mg(e,"w");if(Array.isArray(a)&&~a.indexOf("no_index")){const h='".indexOn": "'+n._queryParams.getIndex().toString()+'"',m=n._path.toString();Cl(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${h} at ${m} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||tZ(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=tN)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=eZ(e)?"auth":"gauth",a={cred:e};this.authOverride_===null?a.noauth=!0:typeof this.authOverride_=="object"&&(a.authvar=this.authOverride_),this.sendRequest(n,a,h=>{const m=h.s,v=h.d||"error";this.authToken_===e&&(m==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(m,v))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,a=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,a)})}unlisten(e,n){const a=e._path.toString(),h=e._queryIdentifier;this.log_("Unlisten called for "+a+" "+h),zn(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(a,h)&&this.connected_&&this.sendUnlisten_(a,h,e._queryObject,n)}sendUnlisten_(e,n,a,h){this.log_("Unlisten on "+e+" for "+n);const m={p:e},v="n";h&&(m.q=a,m.t=h),this.sendRequest(v,m)}onDisconnectPut(e,n,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:a})}onDisconnectMerge(e,n,a){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,a):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:a})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,a,h){const m={p:n,d:a};this.log_("onDisconnect "+e,m),this.sendRequest(e,m,v=>{h&&setTimeout(()=>{h(v.s,v.d)},Math.floor(0))})}put(e,n,a,h){this.putInternal("p",e,n,a,h)}merge(e,n,a,h){this.putInternal("m",e,n,a,h)}putInternal(e,n,a,h,m){this.initConnection_();const v={p:n,d:a};m!==void 0&&(v.h=m),this.outstandingPuts_.push({action:e,request:v,onComplete:h}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,a=this.outstandingPuts_[e].request,h=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,a,m=>{this.log_(n+" response",m),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),h&&h(m.s,m.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,a=>{if(a.s!=="ok"){const m=a.d;this.log_("reportStats","Error sending stats: "+m)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Qo(e));const n=e.r,a=this.requestCBHash_[n];a&&(delete this.requestCBHash_[n],a(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):OC("Unrecognized action received from server: "+Qo(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){zn(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=hv,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=hv,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Qte&&(this.reconnectDelay_=hv),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Yte)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),a=this.onRealtimeDisconnect_.bind(this),h=this.id+":"+uh.nextConnectionId_++,m=this.lastSessionId;let v=!1,o=null;const S=function(){o?o.close():(v=!0,a())},P=function(V){zn(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(V)};this.realtime_={close:S,sendRequest:P};const N=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[V,j]=await Promise.all([this.authTokenProvider_.getToken(N),this.appCheckTokenProvider_.getToken(N)]);v?ga("getToken() completed but was canceled"):(ga("getToken() completed. Creating connection."),this.authToken_=V&&V.accessToken,this.appCheckToken_=j&&j.token,o=new Hte(h,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,a,Q=>{Cl(Q+" ("+this.repoInfo_.toString()+")"),this.interrupt(Jte)},m))}catch(V){this.log_("Failed to get token: "+V),v||(this.repoInfo_.nodeAdmin&&Cl(V),S())}}}interrupt(e){ga("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ga("Resuming connection for reason: "+e),delete this.interruptReasons_[e],sC(this.interruptReasons_)&&(this.reconnectDelay_=hv,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let a;n?a=n.map(m=>uR(m)).join("$"):a="default";const h=this.removeListen_(e,a);h&&h.onComplete&&h.onComplete("permission_denied")}removeListen_(e,n){const a=new Ms(e).toString();let h;if(this.listens.has(a)){const m=this.listens.get(a);h=m.get(n),m.delete(n),m.size===0&&this.listens.delete(a)}else h=void 0;return h}onAuthRevoked_(e,n){ga("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=nN&&(this.reconnectDelay_=tN,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){ga("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=nN&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+zU.replace(/\./g,"-")]=1,fP()?e["framework.cordova"]=1:xV()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=$b.getInstance().currentlyOnline();return sC(this.interruptReasons_)&&e}}uh.nextPersistentConnectionId_=0;uh.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new zr(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $T{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const a=new zr(jg,e),h=new zr(jg,n);return this.compare(a,h)!==0}minPost(){return zr.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let v1;class h6 extends $T{static get __EMPTY_NODE(){return v1}static set __EMPTY_NODE(e){v1=e}compare(e,n){return r_(e.name,n.name)}isDefinedOn(e){throw Xg("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return zr.MIN}maxPost(){return new zr(pp,v1)}makePost(e,n){return zn(typeof e=="string","KeyIndex indexValue must always be a string."),new zr(e,v1)}toString(){return".key"}}const bg=new h6;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(e,n,a,h,m=null){this.isReverse_=h,this.resultGenerator_=m,this.nodeStack_=[];let v=1;for(;!e.isEmpty();)if(e=e,v=n?a(e.key,n):1,h&&(v*=-1),v<0)this.isReverse_?e=e.left:e=e.right;else if(v===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class $o{constructor(e,n,a,h,m){this.key=e,this.value=n,this.color=a??$o.RED,this.left=h??rl.EMPTY_NODE,this.right=m??rl.EMPTY_NODE}copy(e,n,a,h,m){return new $o(e??this.key,n??this.value,a??this.color,h??this.left,m??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,a){let h=this;const m=a(e,h.key);return m<0?h=h.copy(null,null,null,h.left.insert(e,n,a),null):m===0?h=h.copy(null,n,null,null,null):h=h.copy(null,null,null,null,h.right.insert(e,n,a)),h.fixUp_()}removeMin_(){if(this.left.isEmpty())return rl.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let a,h;if(a=this,n(e,a.key)<0)!a.left.isEmpty()&&!a.left.isRed_()&&!a.left.left.isRed_()&&(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.remove(e,n),null);else{if(a.left.isRed_()&&(a=a.rotateRight_()),!a.right.isEmpty()&&!a.right.isRed_()&&!a.right.left.isRed_()&&(a=a.moveRedRight_()),n(e,a.key)===0){if(a.right.isEmpty())return rl.EMPTY_NODE;h=a.right.min_(),a=a.copy(h.key,h.value,null,null,a.right.removeMin_())}a=a.copy(null,null,null,null,a.right.remove(e,n))}return a.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,$o.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,$o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}$o.RED=!0;$o.BLACK=!1;class ene{copy(e,n,a,h,m){return this}insert(e,n,a){return new $o(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class rl{constructor(e,n=rl.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new rl(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,$o.BLACK,null,null))}remove(e){return new rl(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,$o.BLACK,null,null))}get(e){let n,a=this.root_;for(;!a.isEmpty();){if(n=this.comparator_(e,a.key),n===0)return a.value;n<0?a=a.left:n>0&&(a=a.right)}return null}getPredecessorKey(e){let n,a=this.root_,h=null;for(;!a.isEmpty();)if(n=this.comparator_(e,a.key),n===0){if(a.left.isEmpty())return h?h.key:null;for(a=a.left;!a.right.isEmpty();)a=a.right;return a.key}else n<0?a=a.left:n>0&&(h=a,a=a.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new x1(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new x1(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new x1(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new x1(this.root_,null,this.comparator_,!0,e)}}rl.EMPTY_NODE=new ene;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tne(t,e){return r_(t.name,e.name)}function mR(t,e){return r_(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FC;function nne(t){FC=t}const d6=function(t){return typeof t=="number"?"number:"+UU(t):"string:"+t},f6=function(t){if(t.isLeafNode()){const e=t.val();zn(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Eh(e,".sv"),"Priority must be a string or number.")}else zn(t===FC||t.isEmpty(),"priority of unexpected type.");zn(t===FC||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iN;class Uo{static set __childrenNodeConstructor(e){iN=e}static get __childrenNodeConstructor(){return iN}constructor(e,n=Uo.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,zn(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),f6(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Uo(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Uo.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Mr(e)?this:Or(e)===".priority"?this.priorityNode_:Uo.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:Uo.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const a=Or(e);return a===null?n:n.isEmpty()&&a!==".priority"?this:(zn(a!==".priority"||Yd(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(a,Uo.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ps(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+d6(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=UU(this.value_):e+=this.value_,this.lazyHash_=NU(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Uo.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Uo.__childrenNodeConstructor?-1:(zn(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,a=typeof this.value_,h=Uo.VALUE_TYPE_ORDER.indexOf(n),m=Uo.VALUE_TYPE_ORDER.indexOf(a);return zn(h>=0,"Unknown leaf type: "+n),zn(m>=0,"Unknown leaf type: "+a),h===m?a==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:m-h}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}Uo.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let p6,m6;function ine(t){p6=t}function rne(t){m6=t}class sne extends $T{compare(e,n){const a=e.node.getPriority(),h=n.node.getPriority(),m=a.compareTo(h);return m===0?r_(e.name,n.name):m}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return zr.MIN}maxPost(){return new zr(pp,new Uo("[PRIORITY-POST]",m6))}makePost(e,n){const a=p6(e);return new zr(n,new Uo("[PRIORITY-POST]",a))}toString(){return".priority"}}const ya=new sne;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const one=Math.log(2);class ane{constructor(e){const n=m=>parseInt(Math.log(m)/one,10),a=m=>parseInt(Array(m+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const h=a(this.count);this.bits_=e+1&h}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Hb=function(t,e,n,a){t.sort(e);const h=function(S,P){const N=P-S;let V,j;if(N===0)return null;if(N===1)return V=t[S],j=n?n(V):V,new $o(j,V.node,$o.BLACK,null,null);{const Q=parseInt(N/2,10)+S,oe=h(S,Q),me=h(Q+1,P);return V=t[Q],j=n?n(V):V,new $o(j,V.node,$o.BLACK,oe,me)}},m=function(S){let P=null,N=null,V=t.length;const j=function(oe,me){const Ue=V-oe,de=V;V-=oe;const ge=h(Ue+1,de),Re=t[Ue],_t=n?n(Re):Re;Q(new $o(_t,Re.node,me,null,ge))},Q=function(oe){P?(P.left=oe,P=oe):(N=oe,P=oe)};for(let oe=0;oe<S.count;++oe){const me=S.nextBitIsOne(),Ue=Math.pow(2,S.count-(oe+1));me?j(Ue,$o.BLACK):(j(Ue,$o.BLACK),j(Ue,$o.RED))}return N},v=new ane(t.length),o=m(v);return new rl(a||e,o)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FS;const Gm={};class oh{static get Default(){return zn(Gm&&ya,"ChildrenNode.ts has not been loaded"),FS=FS||new oh({".priority":Gm},{".priority":ya}),FS}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Mg(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof rl?n:null}hasIndex(e){return Eh(this.indexSet_,e.toString())}addIndex(e,n){zn(e!==bg,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const a=[];let h=!1;const m=n.getIterator(zr.Wrap);let v=m.getNext();for(;v;)h=h||e.isDefinedOn(v.node),a.push(v),v=m.getNext();let o;h?o=Hb(a,e.getCompare()):o=Gm;const S=e.toString(),P={...this.indexSet_};P[S]=e;const N={...this.indexes_};return N[S]=o,new oh(N,P)}addToIndexes(e,n){const a=Ib(this.indexes_,(h,m)=>{const v=Mg(this.indexSet_,m);if(zn(v,"Missing index implementation for "+m),h===Gm)if(v.isDefinedOn(e.node)){const o=[],S=n.getIterator(zr.Wrap);let P=S.getNext();for(;P;)P.name!==e.name&&o.push(P),P=S.getNext();return o.push(e),Hb(o,v.getCompare())}else return Gm;else{const o=n.get(e.name);let S=h;return o&&(S=S.remove(new zr(e.name,o))),S.insert(e,e.node)}});return new oh(a,this.indexSet_)}removeFromIndexes(e,n){const a=Ib(this.indexes_,h=>{if(h===Gm)return h;{const m=n.get(e.name);return m?h.remove(new zr(e.name,m)):h}});return new oh(a,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dv;class Qr{static get EMPTY_NODE(){return dv||(dv=new Qr(new rl(mR),null,oh.Default))}constructor(e,n,a){this.children_=e,this.priorityNode_=n,this.indexMap_=a,this.lazyHash_=null,this.priorityNode_&&f6(this.priorityNode_),this.children_.isEmpty()&&zn(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||dv}updatePriority(e){return this.children_.isEmpty()?this:new Qr(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?dv:n}}getChild(e){const n=Or(e);return n===null?this:this.getImmediateChild(n).getChild(Ps(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(zn(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const a=new zr(e,n);let h,m;n.isEmpty()?(h=this.children_.remove(e),m=this.indexMap_.removeFromIndexes(a,this.children_)):(h=this.children_.insert(e,n),m=this.indexMap_.addToIndexes(a,this.children_));const v=h.isEmpty()?dv:this.priorityNode_;return new Qr(h,v,m)}}updateChild(e,n){const a=Or(e);if(a===null)return n;{zn(Or(e)!==".priority"||Yd(e)===1,".priority must be the last token in a path");const h=this.getImmediateChild(a).updateChild(Ps(e),n);return this.updateImmediateChild(a,h)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let a=0,h=0,m=!0;if(this.forEachChild(ya,(v,o)=>{n[v]=o.val(e),a++,m&&Qr.INTEGER_REGEXP_.test(v)?h=Math.max(h,Number(v)):m=!1}),!e&&m&&h<2*a){const v=[];for(const o in n)v[o]=n[o];return v}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+d6(this.getPriority().val())+":"),this.forEachChild(ya,(n,a)=>{const h=a.hash();h!==""&&(e+=":"+n+":"+h)}),this.lazyHash_=e===""?"":NU(e)}return this.lazyHash_}getPredecessorChildName(e,n,a){const h=this.resolveIndex_(a);if(h){const m=h.getPredecessorKey(new zr(e,n));return m?m.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const a=n.minKey();return a&&a.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new zr(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const a=n.maxKey();return a&&a.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new zr(n,this.children_.get(n)):null}forEachChild(e,n){const a=this.resolveIndex_(e);return a?a.inorderTraversal(h=>n(h.name,h.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const a=this.resolveIndex_(n);if(a)return a.getIteratorFrom(e,h=>h);{const h=this.children_.getIteratorFrom(e.name,zr.Wrap);let m=h.peek();for(;m!=null&&n.compare(m,e)<0;)h.getNext(),m=h.peek();return h}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const a=this.resolveIndex_(n);if(a)return a.getReverseIteratorFrom(e,h=>h);{const h=this.children_.getReverseIteratorFrom(e.name,zr.Wrap);let m=h.peek();for(;m!=null&&n.compare(m,e)>0;)h.getNext(),m=h.peek();return h}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Qx?-1:0}withIndex(e){if(e===bg||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Qr(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===bg||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const a=this.getIterator(ya),h=n.getIterator(ya);let m=a.getNext(),v=h.getNext();for(;m&&v;){if(m.name!==v.name||!m.node.equals(v.node))return!1;m=a.getNext(),v=h.getNext()}return m===null&&v===null}else return!1;else return!1}}resolveIndex_(e){return e===bg?null:this.indexMap_.get(e.toString())}}Qr.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class lne extends Qr{constructor(){super(new rl(mR),Qr.EMPTY_NODE,oh.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Qr.EMPTY_NODE}isEmpty(){return!1}}const Qx=new lne;Object.defineProperties(zr,{MIN:{value:new zr(jg,Qr.EMPTY_NODE)},MAX:{value:new zr(pp,Qx)}});h6.__EMPTY_NODE=Qr.EMPTY_NODE;Uo.__childrenNodeConstructor=Qr;nne(Qx);rne(Qx);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cne=!0;function _a(t,e=null){if(t===null)return Qr.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),zn(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new Uo(n,_a(e))}if(!(t instanceof Array)&&cne){const n=[];let a=!1;if(sc(t,(v,o)=>{if(v.substring(0,1)!=="."){const S=_a(o);S.isEmpty()||(a=a||!S.getPriority().isEmpty(),n.push(new zr(v,S)))}}),n.length===0)return Qr.EMPTY_NODE;const m=Hb(n,tne,v=>v.name,mR);if(a){const v=Hb(n,ya.getCompare());return new Qr(m,_a(e),new oh({".priority":v},{".priority":ya}))}else return new Qr(m,_a(e),oh.Default)}else{let n=Qr.EMPTY_NODE;return sc(t,(a,h)=>{if(Eh(t,a)&&a.substring(0,1)!=="."){const m=_a(h);(m.isLeafNode()||!m.isEmpty())&&(n=n.updateImmediateChild(a,m))}}),n.updatePriority(_a(e))}}ine(_a);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class une extends $T{constructor(e){super(),this.indexPath_=e,zn(!Mr(e)&&Or(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const a=this.extractChild(e.node),h=this.extractChild(n.node),m=a.compareTo(h);return m===0?r_(e.name,n.name):m}makePost(e,n){const a=_a(e),h=Qr.EMPTY_NODE.updateChild(this.indexPath_,a);return new zr(n,h)}maxPost(){const e=Qr.EMPTY_NODE.updateChild(this.indexPath_,Qx);return new zr(pp,e)}toString(){return a6(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hne extends $T{compare(e,n){const a=e.node.compareTo(n.node);return a===0?r_(e.name,n.name):a}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return zr.MIN}maxPost(){return zr.MAX}makePost(e,n){const a=_a(e);return new zr(n,a)}toString(){return".value"}}const dne=new hne;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fne(t){return{type:"value",snapshotNode:t}}function pne(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function mne(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function rN(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function gne(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ya}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return zn(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return zn(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:jg}hasEnd(){return this.endSet_}getIndexEndValue(){return zn(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return zn(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:pp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return zn(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ya}copy(){const e=new gR;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function sN(t){const e={};if(t.isDefault())return e;let n;if(t.index_===ya?n="$priority":t.index_===dne?n="$value":t.index_===bg?n="$key":(zn(t.index_ instanceof une,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=Qo(n),t.startSet_){const a=t.startAfterSet_?"startAfter":"startAt";e[a]=Qo(t.indexStartValue_),t.startNameSet_&&(e[a]+=","+Qo(t.indexStartName_))}if(t.endSet_){const a=t.endBeforeSet_?"endBefore":"endAt";e[a]=Qo(t.indexEndValue_),t.endNameSet_&&(e[a]+=","+Qo(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function oN(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==ya&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qb extends r6{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(zn(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,a,h){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=a,this.appCheckTokenProvider_=h,this.log_=Kx("p:rest:"),this.listens_={}}listen(e,n,a,h){const m=e._path.toString();this.log_("Listen called for "+m+" "+e._queryIdentifier);const v=qb.getListenId_(e,a),o={};this.listens_[v]=o;const S=sN(e._queryParams);this.restRequest_(m+".json",S,(P,N)=>{let V=N;if(P===404&&(V=null,P=null),P===null&&this.onDataUpdate_(m,V,!1,a),Mg(this.listens_,v)===o){let j;P?P===401?j="permission_denied":j="rest_error:"+P:j="ok",h(j,null)}})}unlisten(e,n){const a=qb.getListenId_(e,n);delete this.listens_[a]}get(e){const n=sN(e._queryParams),a=e._path.toString(),h=new uP;return this.restRequest_(a+".json",n,(m,v)=>{let o=v;m===404&&(o=null,m=null),m===null?(this.onDataUpdate_(a,o,!1,null),h.resolve(o)):h.reject(new Error(o))}),h.promise}refreshAuthToken(e){}restRequest_(e,n={},a){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([h,m])=>{h&&h.accessToken&&(n.auth=h.accessToken),m&&m.token&&(n.ac=m.token);const v=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Kg(n);this.log_("Sending REST request for "+v);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(a&&o.readyState===4){this.log_("REST Response for "+v+" received. status:",o.status,"response:",o.responseText);let S=null;if(o.status>=200&&o.status<300){try{S=px(o.responseText)}catch{Cl("Failed to parse JSON response for "+v+": "+o.responseText)}a(null,S)}else o.status!==401&&o.status!==404&&Cl("Got unsuccessful REST response for "+v+" Status: "+o.status),a(o.status);a=null}},o.open("GET",v,!0),o.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ne{constructor(){this.rootNode_=Qr.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wb(){return{value:null,children:new Map}}function g6(t,e,n){if(Mr(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const a=Or(e);t.children.has(a)||t.children.set(a,Wb());const h=t.children.get(a);e=Ps(e),g6(h,e,n)}}function NC(t,e,n){t.value!==null?n(e,t.value):yne(t,(a,h)=>{const m=new Ms(e.toString()+"/"+a);NC(h,m,n)})}function yne(t,e){t.children.forEach((n,a)=>{e(a,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vne{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&sc(this.last_,(a,h)=>{n[a]=n[a]-h}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aN=10*1e3,xne=30*1e3,wne=5*60*1e3;class bne{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new vne(e);const a=aN+(xne-aN)*Math.random();Gv(this.reportStats_.bind(this),Math.floor(a))}reportStats_(){const e=this.statsListener_.get(),n={};let a=!1;sc(e,(h,m)=>{m>0&&Eh(this.statsToReport_,h)&&(n[h]=m,a=!0)}),a&&this.server_.reportStats(n),Gv(this.reportStats_.bind(this),Math.floor(Math.random()*2*wne))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _u;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(_u||(_u={}));function _6(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function y6(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function v6(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(e,n,a){this.path=e,this.affectedTree=n,this.revert=a,this.type=_u.ACK_USER_WRITE,this.source=_6()}operationForChild(e){if(Mr(this.path)){if(this.affectedTree.value!=null)return zn(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new Ms(e));return new Zb(as(),n,this.revert)}}else return zn(Or(this.path)===e,"operationForChild called for unrelated child."),new Zb(Ps(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp{constructor(e,n,a){this.source=e,this.path=n,this.snap=a,this.type=_u.OVERWRITE}operationForChild(e){return Mr(this.path)?new mp(this.source,as(),this.snap.getImmediateChild(e)):new mp(this.source,Ps(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(e,n,a){this.source=e,this.path=n,this.children=a,this.type=_u.MERGE}operationForChild(e){if(Mr(this.path)){const n=this.children.subtree(new Ms(e));return n.isEmpty()?null:n.value?new mp(this.source,as(),n.value):new Sx(this.source,as(),n)}else return zn(Or(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Sx(this.source,Ps(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(e,n,a){this.node_=e,this.fullyInitialized_=n,this.filtered_=a}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Mr(e))return this.isFullyInitialized()&&!this.filtered_;const n=Or(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Tne(t,e,n,a){const h=[],m=[];return e.forEach(v=>{v.type==="child_changed"&&t.index_.indexedValueChanged(v.oldSnap,v.snapshotNode)&&m.push(gne(v.childName,v.snapshotNode))}),fv(t,h,"child_removed",e,a,n),fv(t,h,"child_added",e,a,n),fv(t,h,"child_moved",m,a,n),fv(t,h,"child_changed",e,a,n),fv(t,h,"value",e,a,n),h}function fv(t,e,n,a,h,m){const v=a.filter(o=>o.type===n);v.sort((o,S)=>Ine(t,o,S)),v.forEach(o=>{const S=Ene(t,o,m);h.forEach(P=>{P.respondsTo(o.type)&&e.push(P.createEvent(S,t.query_))})})}function Ene(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Ine(t,e,n){if(e.childName==null||n.childName==null)throw Xg("Should only compare child_ events.");const a=new zr(e.childName,e.snapshotNode),h=new zr(n.childName,n.snapshotNode);return t.index_.compare(a,h)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x6(t,e){return{eventCache:t,serverCache:e}}function $v(t,e,n,a){return x6(new _R(e,n,a),t.serverCache)}function w6(t,e,n,a){return x6(t.eventCache,new _R(e,n,a))}function BC(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function gp(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let NS;const Sne=()=>(NS||(NS=new rl(dte)),NS);class Cs{static fromObject(e){let n=new Cs(null);return sc(e,(a,h)=>{n=n.set(new Ms(a),h)}),n}constructor(e,n=Sne()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:as(),value:this.value};if(Mr(e))return null;{const a=Or(e),h=this.children.get(a);if(h!==null){const m=h.findRootMostMatchingPathAndValue(Ps(e),n);return m!=null?{path:Ho(new Ms(a),m.path),value:m.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Mr(e))return this;{const n=Or(e),a=this.children.get(n);return a!==null?a.subtree(Ps(e)):new Cs(null)}}set(e,n){if(Mr(e))return new Cs(n,this.children);{const a=Or(e),m=(this.children.get(a)||new Cs(null)).set(Ps(e),n),v=this.children.insert(a,m);return new Cs(this.value,v)}}remove(e){if(Mr(e))return this.children.isEmpty()?new Cs(null):new Cs(null,this.children);{const n=Or(e),a=this.children.get(n);if(a){const h=a.remove(Ps(e));let m;return h.isEmpty()?m=this.children.remove(n):m=this.children.insert(n,h),this.value===null&&m.isEmpty()?new Cs(null):new Cs(this.value,m)}else return this}}get(e){if(Mr(e))return this.value;{const n=Or(e),a=this.children.get(n);return a?a.get(Ps(e)):null}}setTree(e,n){if(Mr(e))return n;{const a=Or(e),m=(this.children.get(a)||new Cs(null)).setTree(Ps(e),n);let v;return m.isEmpty()?v=this.children.remove(a):v=this.children.insert(a,m),new Cs(this.value,v)}}fold(e){return this.fold_(as(),e)}fold_(e,n){const a={};return this.children.inorderTraversal((h,m)=>{a[h]=m.fold_(Ho(e,h),n)}),n(e,this.value,a)}findOnPath(e,n){return this.findOnPath_(e,as(),n)}findOnPath_(e,n,a){const h=this.value?a(n,this.value):!1;if(h)return h;if(Mr(e))return null;{const m=Or(e),v=this.children.get(m);return v?v.findOnPath_(Ps(e),Ho(n,m),a):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,as(),n)}foreachOnPath_(e,n,a){if(Mr(e))return this;{this.value&&a(n,this.value);const h=Or(e),m=this.children.get(h);return m?m.foreachOnPath_(Ps(e),Ho(n,h),a):new Cs(null)}}foreach(e){this.foreach_(as(),e)}foreach_(e,n){this.children.inorderTraversal((a,h)=>{h.foreach_(Ho(e,a),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,a)=>{a.value&&e(n,a.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc{constructor(e){this.writeTree_=e}static empty(){return new Rc(new Cs(null))}}function Hv(t,e,n){if(Mr(e))return new Rc(new Cs(n));{const a=t.writeTree_.findRootMostValueAndPath(e);if(a!=null){const h=a.path;let m=a.value;const v=ec(h,e);return m=m.updateChild(v,n),new Rc(t.writeTree_.set(h,m))}else{const h=new Cs(n),m=t.writeTree_.setTree(e,h);return new Rc(m)}}}function lN(t,e,n){let a=t;return sc(n,(h,m)=>{a=Hv(a,Ho(e,h),m)}),a}function cN(t,e){if(Mr(e))return Rc.empty();{const n=t.writeTree_.setTree(e,new Cs(null));return new Rc(n)}}function VC(t,e){return Ap(t,e)!=null}function Ap(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(ec(n.path,e)):null}function uN(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(ya,(a,h)=>{e.push(new zr(a,h))}):t.writeTree_.children.inorderTraversal((a,h)=>{h.value!=null&&e.push(new zr(a,h.value))}),e}function Ud(t,e){if(Mr(e))return t;{const n=Ap(t,e);return n!=null?new Rc(new Cs(n)):new Rc(t.writeTree_.subtree(e))}}function UC(t){return t.writeTree_.isEmpty()}function Gg(t,e){return b6(as(),t.writeTree_,e)}function b6(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let a=null;return e.children.inorderTraversal((h,m)=>{h===".priority"?(zn(m.value!==null,"Priority writes must always be leaf nodes"),a=m.value):n=b6(Ho(t,h),m,n)}),!n.getChild(t).isEmpty()&&a!==null&&(n=n.updateChild(Ho(t,".priority"),a)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T6(t,e){return C6(e,t)}function Ane(t,e,n,a,h){zn(a>t.lastWriteId,"Stacking an older write on top of newer ones"),h===void 0&&(h=!0),t.allWrites.push({path:e,snap:n,writeId:a,visible:h}),h&&(t.visibleWrites=Hv(t.visibleWrites,e,n)),t.lastWriteId=a}function Cne(t,e){for(let n=0;n<t.allWrites.length;n++){const a=t.allWrites[n];if(a.writeId===e)return a}return null}function Pne(t,e){const n=t.allWrites.findIndex(o=>o.writeId===e);zn(n>=0,"removeWrite called with nonexistent writeId.");const a=t.allWrites[n];t.allWrites.splice(n,1);let h=a.visible,m=!1,v=t.allWrites.length-1;for(;h&&v>=0;){const o=t.allWrites[v];o.visible&&(v>=n&&Rne(o,a.path)?h=!1:Ic(a.path,o.path)&&(m=!0)),v--}if(h){if(m)return kne(t),!0;if(a.snap)t.visibleWrites=cN(t.visibleWrites,a.path);else{const o=a.children;sc(o,S=>{t.visibleWrites=cN(t.visibleWrites,Ho(a.path,S))})}return!0}else return!1}function Rne(t,e){if(t.snap)return Ic(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Ic(Ho(t.path,n),e))return!0;return!1}function kne(t){t.visibleWrites=E6(t.allWrites,Mne,as()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Mne(t){return t.visible}function E6(t,e,n){let a=Rc.empty();for(let h=0;h<t.length;++h){const m=t[h];if(e(m)){const v=m.path;let o;if(m.snap)Ic(n,v)?(o=ec(n,v),a=Hv(a,o,m.snap)):Ic(v,n)&&(o=ec(v,n),a=Hv(a,as(),m.snap.getChild(o)));else if(m.children){if(Ic(n,v))o=ec(n,v),a=lN(a,o,m.children);else if(Ic(v,n))if(o=ec(v,n),Mr(o))a=lN(a,as(),m.children);else{const S=Mg(m.children,Or(o));if(S){const P=S.getChild(Ps(o));a=Hv(a,as(),P)}}}else throw Xg("WriteRecord should have .snap or .children")}}return a}function I6(t,e,n,a,h){if(!a&&!h){const m=Ap(t.visibleWrites,e);if(m!=null)return m;{const v=Ud(t.visibleWrites,e);if(UC(v))return n;if(n==null&&!VC(v,as()))return null;{const o=n||Qr.EMPTY_NODE;return Gg(v,o)}}}else{const m=Ud(t.visibleWrites,e);if(!h&&UC(m))return n;if(!h&&n==null&&!VC(m,as()))return null;{const v=function(P){return(P.visible||h)&&(!a||!~a.indexOf(P.writeId))&&(Ic(P.path,e)||Ic(e,P.path))},o=E6(t.allWrites,v,e),S=n||Qr.EMPTY_NODE;return Gg(o,S)}}}function Dne(t,e,n){let a=Qr.EMPTY_NODE;const h=Ap(t.visibleWrites,e);if(h)return h.isLeafNode()||h.forEachChild(ya,(m,v)=>{a=a.updateImmediateChild(m,v)}),a;if(n){const m=Ud(t.visibleWrites,e);return n.forEachChild(ya,(v,o)=>{const S=Gg(Ud(m,new Ms(v)),o);a=a.updateImmediateChild(v,S)}),uN(m).forEach(v=>{a=a.updateImmediateChild(v.name,v.node)}),a}else{const m=Ud(t.visibleWrites,e);return uN(m).forEach(v=>{a=a.updateImmediateChild(v.name,v.node)}),a}}function Lne(t,e,n,a,h){zn(a||h,"Either existingEventSnap or existingServerSnap must exist");const m=Ho(e,n);if(VC(t.visibleWrites,m))return null;{const v=Ud(t.visibleWrites,m);return UC(v)?h.getChild(n):Gg(v,h.getChild(n))}}function One(t,e,n,a){const h=Ho(e,n),m=Ap(t.visibleWrites,h);if(m!=null)return m;if(a.isCompleteForChild(n)){const v=Ud(t.visibleWrites,h);return Gg(v,a.getNode().getImmediateChild(n))}else return null}function zne(t,e){return Ap(t.visibleWrites,e)}function Fne(t,e,n,a,h,m,v){let o;const S=Ud(t.visibleWrites,e),P=Ap(S,as());if(P!=null)o=P;else if(n!=null)o=Gg(S,n);else return[];if(o=o.withIndex(v),!o.isEmpty()&&!o.isLeafNode()){const N=[],V=v.getCompare(),j=m?o.getReverseIteratorFrom(a,v):o.getIteratorFrom(a,v);let Q=j.getNext();for(;Q&&N.length<h;)V(Q,a)!==0&&N.push(Q),Q=j.getNext();return N}else return[]}function Nne(){return{visibleWrites:Rc.empty(),allWrites:[],lastWriteId:-1}}function jC(t,e,n,a){return I6(t.writeTree,t.treePath,e,n,a)}function S6(t,e){return Dne(t.writeTree,t.treePath,e)}function hN(t,e,n,a){return Lne(t.writeTree,t.treePath,e,n,a)}function Xb(t,e){return zne(t.writeTree,Ho(t.treePath,e))}function Bne(t,e,n,a,h,m){return Fne(t.writeTree,t.treePath,e,n,a,h,m)}function yR(t,e,n){return One(t.writeTree,t.treePath,e,n)}function A6(t,e){return C6(Ho(t.treePath,e),t.writeTree)}function C6(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vne{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,a=e.childName;zn(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),zn(a!==".priority","Only non-priority child changes can be tracked.");const h=this.changeMap.get(a);if(h){const m=h.type;if(n==="child_added"&&m==="child_removed")this.changeMap.set(a,rN(a,e.snapshotNode,h.snapshotNode));else if(n==="child_removed"&&m==="child_added")this.changeMap.delete(a);else if(n==="child_removed"&&m==="child_changed")this.changeMap.set(a,mne(a,h.oldSnap));else if(n==="child_changed"&&m==="child_added")this.changeMap.set(a,pne(a,e.snapshotNode));else if(n==="child_changed"&&m==="child_changed")this.changeMap.set(a,rN(a,e.snapshotNode,h.oldSnap));else throw Xg("Illegal combination of changes: "+e+" occurred after "+h)}else this.changeMap.set(a,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Une{getCompleteChild(e){return null}getChildAfterChild(e,n,a){return null}}const P6=new Une;class vR{constructor(e,n,a=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=a}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const a=this.optCompleteServerCache_!=null?new _R(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return yR(this.writes_,e,a)}}getChildAfterChild(e,n,a){const h=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:gp(this.viewCache_),m=Bne(this.writes_,h,n,1,a,e);return m.length===0?null:m[0]}}function jne(t,e){zn(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),zn(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function Gne(t,e,n,a,h){const m=new Vne;let v,o;if(n.type===_u.OVERWRITE){const P=n;P.source.fromUser?v=GC(t,e,P.path,P.snap,a,h,m):(zn(P.source.fromServer,"Unknown source."),o=P.source.tagged||e.serverCache.isFiltered()&&!Mr(P.path),v=Kb(t,e,P.path,P.snap,a,h,o,m))}else if(n.type===_u.MERGE){const P=n;P.source.fromUser?v=Hne(t,e,P.path,P.children,a,h,m):(zn(P.source.fromServer,"Unknown source."),o=P.source.tagged||e.serverCache.isFiltered(),v=$C(t,e,P.path,P.children,a,h,o,m))}else if(n.type===_u.ACK_USER_WRITE){const P=n;P.revert?v=Zne(t,e,P.path,a,h,m):v=qne(t,e,P.path,P.affectedTree,a,h,m)}else if(n.type===_u.LISTEN_COMPLETE)v=Wne(t,e,n.path,a,m);else throw Xg("Unknown operation type: "+n.type);const S=m.getChanges();return $ne(e,v,S),{viewCache:v,changes:S}}function $ne(t,e,n){const a=e.eventCache;if(a.isFullyInitialized()){const h=a.getNode().isLeafNode()||a.getNode().isEmpty(),m=BC(t);(n.length>0||!t.eventCache.isFullyInitialized()||h&&!a.getNode().equals(m)||!a.getNode().getPriority().equals(m.getPriority()))&&n.push(fne(BC(e)))}}function R6(t,e,n,a,h,m){const v=e.eventCache;if(Xb(a,n)!=null)return e;{let o,S;if(Mr(n))if(zn(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const P=gp(e),N=P instanceof Qr?P:Qr.EMPTY_NODE,V=S6(a,N);o=t.filter.updateFullNode(e.eventCache.getNode(),V,m)}else{const P=jC(a,gp(e));o=t.filter.updateFullNode(e.eventCache.getNode(),P,m)}else{const P=Or(n);if(P===".priority"){zn(Yd(n)===1,"Can't have a priority with additional path components");const N=v.getNode();S=e.serverCache.getNode();const V=hN(a,n,N,S);V!=null?o=t.filter.updatePriority(N,V):o=v.getNode()}else{const N=Ps(n);let V;if(v.isCompleteForChild(P)){S=e.serverCache.getNode();const j=hN(a,n,v.getNode(),S);j!=null?V=v.getNode().getImmediateChild(P).updateChild(N,j):V=v.getNode().getImmediateChild(P)}else V=yR(a,P,e.serverCache);V!=null?o=t.filter.updateChild(v.getNode(),P,V,N,h,m):o=v.getNode()}}return $v(e,o,v.isFullyInitialized()||Mr(n),t.filter.filtersNodes())}}function Kb(t,e,n,a,h,m,v,o){const S=e.serverCache;let P;const N=v?t.filter:t.filter.getIndexedFilter();if(Mr(n))P=N.updateFullNode(S.getNode(),a,null);else if(N.filtersNodes()&&!S.isFiltered()){const Q=S.getNode().updateChild(n,a);P=N.updateFullNode(S.getNode(),Q,null)}else{const Q=Or(n);if(!S.isCompleteForPath(n)&&Yd(n)>1)return e;const oe=Ps(n),Ue=S.getNode().getImmediateChild(Q).updateChild(oe,a);Q===".priority"?P=N.updatePriority(S.getNode(),Ue):P=N.updateChild(S.getNode(),Q,Ue,oe,P6,null)}const V=w6(e,P,S.isFullyInitialized()||Mr(n),N.filtersNodes()),j=new vR(h,V,m);return R6(t,V,n,h,j,o)}function GC(t,e,n,a,h,m,v){const o=e.eventCache;let S,P;const N=new vR(h,e,m);if(Mr(n))P=t.filter.updateFullNode(e.eventCache.getNode(),a,v),S=$v(e,P,!0,t.filter.filtersNodes());else{const V=Or(n);if(V===".priority")P=t.filter.updatePriority(e.eventCache.getNode(),a),S=$v(e,P,o.isFullyInitialized(),o.isFiltered());else{const j=Ps(n),Q=o.getNode().getImmediateChild(V);let oe;if(Mr(j))oe=a;else{const me=N.getCompleteChild(V);me!=null?o6(j)===".priority"&&me.getChild(l6(j)).isEmpty()?oe=me:oe=me.updateChild(j,a):oe=Qr.EMPTY_NODE}if(Q.equals(oe))S=e;else{const me=t.filter.updateChild(o.getNode(),V,oe,j,N,v);S=$v(e,me,o.isFullyInitialized(),t.filter.filtersNodes())}}}return S}function dN(t,e){return t.eventCache.isCompleteForChild(e)}function Hne(t,e,n,a,h,m,v){let o=e;return a.foreach((S,P)=>{const N=Ho(n,S);dN(e,Or(N))&&(o=GC(t,o,N,P,h,m,v))}),a.foreach((S,P)=>{const N=Ho(n,S);dN(e,Or(N))||(o=GC(t,o,N,P,h,m,v))}),o}function fN(t,e,n){return n.foreach((a,h)=>{e=e.updateChild(a,h)}),e}function $C(t,e,n,a,h,m,v,o){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let S=e,P;Mr(n)?P=a:P=new Cs(null).setTree(n,a);const N=e.serverCache.getNode();return P.children.inorderTraversal((V,j)=>{if(N.hasChild(V)){const Q=e.serverCache.getNode().getImmediateChild(V),oe=fN(t,Q,j);S=Kb(t,S,new Ms(V),oe,h,m,v,o)}}),P.children.inorderTraversal((V,j)=>{const Q=!e.serverCache.isCompleteForChild(V)&&j.value===null;if(!N.hasChild(V)&&!Q){const oe=e.serverCache.getNode().getImmediateChild(V),me=fN(t,oe,j);S=Kb(t,S,new Ms(V),me,h,m,v,o)}}),S}function qne(t,e,n,a,h,m,v){if(Xb(h,n)!=null)return e;const o=e.serverCache.isFiltered(),S=e.serverCache;if(a.value!=null){if(Mr(n)&&S.isFullyInitialized()||S.isCompleteForPath(n))return Kb(t,e,n,S.getNode().getChild(n),h,m,o,v);if(Mr(n)){let P=new Cs(null);return S.getNode().forEachChild(bg,(N,V)=>{P=P.set(new Ms(N),V)}),$C(t,e,n,P,h,m,o,v)}else return e}else{let P=new Cs(null);return a.foreach((N,V)=>{const j=Ho(n,N);S.isCompleteForPath(j)&&(P=P.set(N,S.getNode().getChild(j)))}),$C(t,e,n,P,h,m,o,v)}}function Wne(t,e,n,a,h){const m=e.serverCache,v=w6(e,m.getNode(),m.isFullyInitialized()||Mr(n),m.isFiltered());return R6(t,v,n,a,P6,h)}function Zne(t,e,n,a,h,m){let v;if(Xb(a,n)!=null)return e;{const o=new vR(a,e,h),S=e.eventCache.getNode();let P;if(Mr(n)||Or(n)===".priority"){let N;if(e.serverCache.isFullyInitialized())N=jC(a,gp(e));else{const V=e.serverCache.getNode();zn(V instanceof Qr,"serverChildren would be complete if leaf node"),N=S6(a,V)}N=N,P=t.filter.updateFullNode(S,N,m)}else{const N=Or(n);let V=yR(a,N,e.serverCache);V==null&&e.serverCache.isCompleteForChild(N)&&(V=S.getImmediateChild(N)),V!=null?P=t.filter.updateChild(S,N,V,Ps(n),o,m):e.eventCache.getNode().hasChild(N)?P=t.filter.updateChild(S,N,Qr.EMPTY_NODE,Ps(n),o,m):P=S,P.isEmpty()&&e.serverCache.isFullyInitialized()&&(v=jC(a,gp(e)),v.isLeafNode()&&(P=t.filter.updateFullNode(P,v,m)))}return v=e.serverCache.isFullyInitialized()||Xb(a,as())!=null,$v(e,P,v,t.filter.filtersNodes())}}function Xne(t,e){const n=gp(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Mr(e)&&!n.getImmediateChild(Or(e)).isEmpty())?n.getChild(e):null}function pN(t,e,n,a){e.type===_u.MERGE&&e.source.queryId!==null&&(zn(gp(t.viewCache_),"We should always have a full cache before handling merges"),zn(BC(t.viewCache_),"Missing event cache, even though we have a server cache"));const h=t.viewCache_,m=Gne(t.processor_,h,e,n,a);return jne(t.processor_,m.viewCache),zn(m.viewCache.serverCache.isFullyInitialized()||!h.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=m.viewCache,Kne(t,m.changes,m.viewCache.eventCache.getNode())}function Kne(t,e,n,a){const h=t.eventRegistrations_;return Tne(t.eventGenerator_,e,n,h)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mN;function Yne(t){zn(!mN,"__referenceConstructor has already been defined"),mN=t}function xR(t,e,n,a){const h=e.source.queryId;if(h!==null){const m=t.views.get(h);return zn(m!=null,"SyncTree gave us an op for an invalid query."),pN(m,e,n,a)}else{let m=[];for(const v of t.views.values())m=m.concat(pN(v,e,n,a));return m}}function wR(t,e){let n=null;for(const a of t.views.values())n=n||Xne(a,e);return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gN;function Qne(t){zn(!gN,"__referenceConstructor has already been defined"),gN=t}class _N{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Cs(null),this.pendingWriteTree_=Nne(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Jne(t,e,n,a,h){return Ane(t.pendingWriteTree_,e,n,a,h),h?qT(t,new mp(_6(),e,n)):[]}function lg(t,e,n=!1){const a=Cne(t.pendingWriteTree_,e);if(Pne(t.pendingWriteTree_,e)){let m=new Cs(null);return a.snap!=null?m=m.set(as(),!0):sc(a.children,v=>{m=m.set(new Ms(v),!0)}),qT(t,new Zb(a.path,m,n))}else return[]}function HT(t,e,n){return qT(t,new mp(y6(),e,n))}function eie(t,e,n){const a=Cs.fromObject(n);return qT(t,new Sx(y6(),e,a))}function tie(t,e,n,a){const h=L6(t,a);if(h!=null){const m=O6(h),v=m.path,o=m.queryId,S=ec(v,e),P=new mp(v6(o),S,n);return z6(t,v,P)}else return[]}function nie(t,e,n,a){const h=L6(t,a);if(h){const m=O6(h),v=m.path,o=m.queryId,S=ec(v,e),P=Cs.fromObject(n),N=new Sx(v6(o),S,P);return z6(t,v,N)}else return[]}function k6(t,e,n){const h=t.pendingWriteTree_,m=t.syncPointTree_.findOnPath(e,(v,o)=>{const S=ec(v,e),P=wR(o,S);if(P)return P});return I6(h,e,m,n,!0)}function qT(t,e){return M6(e,t.syncPointTree_,null,T6(t.pendingWriteTree_,as()))}function M6(t,e,n,a){if(Mr(t.path))return D6(t,e,n,a);{const h=e.get(as());n==null&&h!=null&&(n=wR(h,as()));let m=[];const v=Or(t.path),o=t.operationForChild(v),S=e.children.get(v);if(S&&o){const P=n?n.getImmediateChild(v):null,N=A6(a,v);m=m.concat(M6(o,S,P,N))}return h&&(m=m.concat(xR(h,t,a,n))),m}}function D6(t,e,n,a){const h=e.get(as());n==null&&h!=null&&(n=wR(h,as()));let m=[];return e.children.inorderTraversal((v,o)=>{const S=n?n.getImmediateChild(v):null,P=A6(a,v),N=t.operationForChild(v);N&&(m=m.concat(D6(N,o,S,P)))}),h&&(m=m.concat(xR(h,t,a,n))),m}function L6(t,e){return t.tagToQueryMap.get(e)}function O6(t){const e=t.indexOf("$");return zn(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Ms(t.substr(0,e))}}function z6(t,e,n){const a=t.syncPointTree_.get(e);zn(a,"Missing sync point for query tag that we're tracking");const h=T6(t.pendingWriteTree_,e);return xR(a,n,h,null)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new bR(n)}node(){return this.node_}}class TR{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Ho(this.path_,e);return new TR(this.syncTree_,n)}node(){return k6(this.syncTree_,this.path_)}}const iie=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},yN=function(t,e,n){if(!t||typeof t!="object")return t;if(zn(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return rie(t[".sv"],e,n);if(typeof t[".sv"]=="object")return sie(t[".sv"],e);zn(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},rie=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:zn(!1,"Unexpected server value: "+t)}},sie=function(t,e,n){t.hasOwnProperty("increment")||zn(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const a=t.increment;typeof a!="number"&&zn(!1,"Unexpected increment value: "+a);const h=e.node();if(zn(h!==null&&typeof h<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!h.isLeafNode())return a;const v=h.getValue();return typeof v!="number"?a:v+a},oie=function(t,e,n,a){return ER(e,new TR(n,t),a)},aie=function(t,e,n){return ER(t,new bR(e),n)};function ER(t,e,n){const a=t.getPriority().val(),h=yN(a,e.getImmediateChild(".priority"),n);let m;if(t.isLeafNode()){const v=t,o=yN(v.getValue(),e,n);return o!==v.getValue()||h!==v.getPriority().val()?new Uo(o,_a(h)):t}else{const v=t;return m=v,h!==v.getPriority().val()&&(m=m.updatePriority(new Uo(h))),v.forEachChild(ya,(o,S)=>{const P=ER(S,e.getImmediateChild(o),n);P!==S&&(m=m.updateImmediateChild(o,P))}),m}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(e="",n=null,a={children:{},childCount:0}){this.name=e,this.parent=n,this.node=a}}function SR(t,e){let n=e instanceof Ms?e:new Ms(e),a=t,h=Or(n);for(;h!==null;){const m=Mg(a.node.children,h)||{children:{},childCount:0};a=new IR(h,a,m),n=Ps(n),h=Or(n)}return a}function s_(t){return t.node.value}function F6(t,e){t.node.value=e,HC(t)}function N6(t){return t.node.childCount>0}function lie(t){return s_(t)===void 0&&!N6(t)}function WT(t,e){sc(t.node.children,(n,a)=>{e(new IR(n,t,a))})}function B6(t,e,n,a){n&&e(t),WT(t,h=>{B6(h,e,!0)})}function cie(t,e,n){let a=t.parent;for(;a!==null;){if(e(a))return!0;a=a.parent}return!1}function Jx(t){return new Ms(t.parent===null?t.name:Jx(t.parent)+"/"+t.name)}function HC(t){t.parent!==null&&uie(t.parent,t.name,t)}function uie(t,e,n){const a=lie(n),h=Eh(t.node.children,e);a&&h?(delete t.node.children[e],t.node.childCount--,HC(t)):!a&&!h&&(t.node.children[e]=n.node,t.node.childCount++,HC(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hie=/[\[\].#$\/\u0000-\u001F\u007F]/,die=/[\[\].#$\u0000-\u001F\u007F]/,BS=10*1024*1024,V6=function(t){return typeof t=="string"&&t.length!==0&&!hie.test(t)},fie=function(t){return typeof t=="string"&&t.length!==0&&!die.test(t)},pie=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),fie(t)},U6=function(t,e,n){const a=n instanceof Ms?new Wte(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+qf(a));if(typeof e=="function")throw new Error(t+"contains a function "+qf(a)+" with contents = "+e.toString());if(BU(e))throw new Error(t+"contains "+e.toString()+" "+qf(a));if(typeof e=="string"&&e.length>BS/3&&bT(e)>BS)throw new Error(t+"contains a string greater than "+BS+" utf8 bytes "+qf(a)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let h=!1,m=!1;if(sc(e,(v,o)=>{if(v===".value")h=!0;else if(v!==".priority"&&v!==".sv"&&(m=!0,!V6(v)))throw new Error(t+" contains an invalid key ("+v+") "+qf(a)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Zte(a,v),U6(t,o,a),Xte(a)}),h&&m)throw new Error(t+' contains ".value" child '+qf(a)+" in addition to actual children.")}},mie=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!V6(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!pie(n))throw new Error(oZ(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gie{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function _ie(t,e){let n=null;for(let a=0;a<e.length;a++){const h=e[a],m=h.getPath();n!==null&&!c6(m,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:m}),n.events.push(h)}n&&t.eventLists_.push(n)}function Cp(t,e,n){_ie(t,n),yie(t,a=>Ic(a,e)||Ic(e,a))}function yie(t,e){t.recursionDepth_++;let n=!0;for(let a=0;a<t.eventLists_.length;a++){const h=t.eventLists_[a];if(h){const m=h.path;e(m)?(vie(t.eventLists_[a]),t.eventLists_[a]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function vie(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const a=n.getEventRunner();jv&&ga("event: "+n.toString()),Yx(a)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xie="repo_interrupt",wie=25;class bie{constructor(e,n,a,h){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=a,this.appCheckProvider_=h,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new gie,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Wb(),this.transactionQueueTree_=new IR,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Tie(t,e,n){if(t.stats_=dR(t.repoInfo_),t.forceRestClient_||yte())t.server_=new qb(t.repoInfo_,(a,h,m,v)=>{vN(t,a,h,m,v)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>xN(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Qo(n)}catch(a){throw new Error("Invalid authOverride provided: "+a)}}t.persistentConnection_=new uh(t.repoInfo_,e,(a,h,m,v)=>{vN(t,a,h,m,v)},a=>{xN(t,a)},a=>{Iie(t,a)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(a=>{t.server_.refreshAuthToken(a)}),t.appCheckProvider_.addTokenChangeListener(a=>{t.server_.refreshAppCheckToken(a.token)}),t.statsReporter_=Tte(t.repoInfo_,()=>new bne(t.stats_,t.server_)),t.infoData_=new _ne,t.infoSyncTree_=new _N({startListening:(a,h,m,v)=>{let o=[];const S=t.infoData_.getNode(a._path);return S.isEmpty()||(o=HT(t.infoSyncTree_,a._path,S),setTimeout(()=>{v("ok")},0)),o},stopListening:()=>{}}),AR(t,"connected",!1),t.serverSyncTree_=new _N({startListening:(a,h,m,v)=>(t.server_.listen(a,m,h,(o,S)=>{const P=v(o,S);Cp(t.eventQueue_,a._path,P)}),[]),stopListening:(a,h)=>{t.server_.unlisten(a,h)}})}function Eie(t){const n=t.infoData_.getNode(new Ms(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function j6(t){return iie({timestamp:Eie(t)})}function vN(t,e,n,a,h){t.dataUpdateCount++;const m=new Ms(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let v=[];if(h)if(a){const S=Ib(n,P=>_a(P));v=nie(t.serverSyncTree_,m,S,h)}else{const S=_a(n);v=tie(t.serverSyncTree_,m,S,h)}else if(a){const S=Ib(n,P=>_a(P));v=eie(t.serverSyncTree_,m,S)}else{const S=_a(n);v=HT(t.serverSyncTree_,m,S)}let o=m;v.length>0&&(o=PR(t,m)),Cp(t.eventQueue_,o,v)}function xN(t,e){AR(t,"connected",e),e===!1&&Aie(t)}function Iie(t,e){sc(e,(n,a)=>{AR(t,n,a)})}function AR(t,e,n){const a=new Ms("/.info/"+e),h=_a(n);t.infoData_.updateSnapshot(a,h);const m=HT(t.infoSyncTree_,a,h);Cp(t.eventQueue_,a,m)}function Sie(t){return t.nextWriteId_++}function Aie(t){G6(t,"onDisconnectEvents");const e=j6(t),n=Wb();NC(t.onDisconnect_,as(),(h,m)=>{const v=oie(h,m,t.serverSyncTree_,e);g6(n,h,v)});let a=[];NC(n,as(),(h,m)=>{a=a.concat(HT(t.serverSyncTree_,h,m));const v=kie(t,h);PR(t,v)}),t.onDisconnect_=Wb(),Cp(t.eventQueue_,as(),a)}function Cie(t){t.persistentConnection_&&t.persistentConnection_.interrupt(xie)}function G6(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),ga(n,...e)}function $6(t,e,n){return k6(t.serverSyncTree_,e,n)||Qr.EMPTY_NODE}function CR(t,e=t.transactionQueueTree_){if(e||ZT(t,e),s_(e)){const n=q6(t,e);zn(n.length>0,"Sending zero length transaction queue"),n.every(h=>h.status===0)&&Pie(t,Jx(e),n)}else N6(e)&&WT(e,n=>{CR(t,n)})}function Pie(t,e,n){const a=n.map(P=>P.currentWriteId),h=$6(t,e,a);let m=h;const v=h.hash();for(let P=0;P<n.length;P++){const N=n[P];zn(N.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),N.status=1,N.retryCount++;const V=ec(e,N.path);m=m.updateChild(V,N.currentOutputSnapshotRaw)}const o=m.val(!0),S=e;t.server_.put(S.toString(),o,P=>{G6(t,"transaction put response",{path:S.toString(),status:P});let N=[];if(P==="ok"){const V=[];for(let j=0;j<n.length;j++)n[j].status=2,N=N.concat(lg(t.serverSyncTree_,n[j].currentWriteId)),n[j].onComplete&&V.push(()=>n[j].onComplete(null,!0,n[j].currentOutputSnapshotResolved)),n[j].unwatcher();ZT(t,SR(t.transactionQueueTree_,e)),CR(t,t.transactionQueueTree_),Cp(t.eventQueue_,e,N);for(let j=0;j<V.length;j++)Yx(V[j])}else{if(P==="datastale")for(let V=0;V<n.length;V++)n[V].status===3?n[V].status=4:n[V].status=0;else{Cl("transaction at "+S.toString()+" failed: "+P);for(let V=0;V<n.length;V++)n[V].status=4,n[V].abortReason=P}PR(t,e)}},v)}function PR(t,e){const n=H6(t,e),a=Jx(n),h=q6(t,n);return Rie(t,h,a),a}function Rie(t,e,n){if(e.length===0)return;const a=[];let h=[];const v=e.filter(o=>o.status===0).map(o=>o.currentWriteId);for(let o=0;o<e.length;o++){const S=e[o],P=ec(n,S.path);let N=!1,V;if(zn(P!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),S.status===4)N=!0,V=S.abortReason,h=h.concat(lg(t.serverSyncTree_,S.currentWriteId,!0));else if(S.status===0)if(S.retryCount>=wie)N=!0,V="maxretry",h=h.concat(lg(t.serverSyncTree_,S.currentWriteId,!0));else{const j=$6(t,S.path,v);S.currentInputSnapshot=j;const Q=e[o].update(j.val());if(Q!==void 0){U6("transaction failed: Data returned ",Q,S.path);let oe=_a(Q);typeof Q=="object"&&Q!=null&&Eh(Q,".priority")||(oe=oe.updatePriority(j.getPriority()));const Ue=S.currentWriteId,de=j6(t),ge=aie(oe,j,de);S.currentOutputSnapshotRaw=oe,S.currentOutputSnapshotResolved=ge,S.currentWriteId=Sie(t),v.splice(v.indexOf(Ue),1),h=h.concat(Jne(t.serverSyncTree_,S.path,ge,S.currentWriteId,S.applyLocally)),h=h.concat(lg(t.serverSyncTree_,Ue,!0))}else N=!0,V="nodata",h=h.concat(lg(t.serverSyncTree_,S.currentWriteId,!0))}Cp(t.eventQueue_,n,h),h=[],N&&(e[o].status=2,function(j){setTimeout(j,Math.floor(0))}(e[o].unwatcher),e[o].onComplete&&(V==="nodata"?a.push(()=>e[o].onComplete(null,!1,e[o].currentInputSnapshot)):a.push(()=>e[o].onComplete(new Error(V),!1,null))))}ZT(t,t.transactionQueueTree_);for(let o=0;o<a.length;o++)Yx(a[o]);CR(t,t.transactionQueueTree_)}function H6(t,e){let n,a=t.transactionQueueTree_;for(n=Or(e);n!==null&&s_(a)===void 0;)a=SR(a,n),e=Ps(e),n=Or(e);return a}function q6(t,e){const n=[];return W6(t,e,n),n.sort((a,h)=>a.order-h.order),n}function W6(t,e,n){const a=s_(e);if(a)for(let h=0;h<a.length;h++)n.push(a[h]);WT(e,h=>{W6(t,h,n)})}function ZT(t,e){const n=s_(e);if(n){let a=0;for(let h=0;h<n.length;h++)n[h].status!==2&&(n[a]=n[h],a++);n.length=a,F6(e,n.length>0?n:void 0)}WT(e,a=>{ZT(t,a)})}function kie(t,e){const n=Jx(H6(t,e)),a=SR(t.transactionQueueTree_,e);return cie(a,h=>{VS(t,h)}),VS(t,a),B6(a,h=>{VS(t,h)}),n}function VS(t,e){const n=s_(e);if(n){const a=[];let h=[],m=-1;for(let v=0;v<n.length;v++)n[v].status===3||(n[v].status===1?(zn(m===v-1,"All SENT items should be at beginning of queue."),m=v,n[v].status=3,n[v].abortReason="set"):(zn(n[v].status===0,"Unexpected transaction status in abort"),n[v].unwatcher(),h=h.concat(lg(t.serverSyncTree_,n[v].currentWriteId,!0)),n[v].onComplete&&a.push(n[v].onComplete.bind(null,new Error("set"),!1,null))));m===-1?F6(e,void 0):n.length=m+1,Cp(t.eventQueue_,Jx(e),h);for(let v=0;v<a.length;v++)Yx(a[v])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mie(t){let e="";const n=t.split("/");for(let a=0;a<n.length;a++)if(n[a].length>0){let h=n[a];try{h=decodeURIComponent(h.replace(/\+/g," "))}catch{}e+="/"+h}return e}function Die(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const a=n.split("=");a.length===2?e[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):Cl(`Invalid query segment '${n}' in query '${t}'`)}return e}const wN=function(t,e){const n=Lie(t),a=n.namespace;n.domain==="firebase.com"&&wh(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!a||a==="undefined")&&n.domain!=="localhost"&&wh("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||ute();const h=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new YU(n.host,n.secure,a,h,e,"",a!==n.subdomain),path:new Ms(n.pathString)}},Lie=function(t){let e="",n="",a="",h="",m="",v=!0,o="https",S=443;if(typeof t=="string"){let P=t.indexOf("//");P>=0&&(o=t.substring(0,P-1),t=t.substring(P+2));let N=t.indexOf("/");N===-1&&(N=t.length);let V=t.indexOf("?");V===-1&&(V=t.length),e=t.substring(0,Math.min(N,V)),N<V&&(h=Mie(t.substring(N,V)));const j=Die(t.substring(Math.min(t.length,V)));P=e.indexOf(":"),P>=0?(v=o==="https"||o==="wss",S=parseInt(e.substring(P+1),10)):P=e.length;const Q=e.slice(0,P);if(Q.toLowerCase()==="localhost")n="localhost";else if(Q.split(".").length<=2)n=Q;else{const oe=e.indexOf(".");a=e.substring(0,oe).toLowerCase(),n=e.substring(oe+1),m=a}"ns"in j&&(m=j.ns)}return{host:e,port:S,domain:n,subdomain:a,secure:v,scheme:o,pathString:h,namespace:m}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e,n,a,h){this._repo=e,this._path=n,this._queryParams=a,this._orderByCalled=h}get key(){return Mr(this._path)?null:o6(this._path)}get ref(){return new o_(this._repo,this._path)}get _queryIdentifier(){const e=oN(this._queryParams),n=uR(e);return n==="{}"?"default":n}get _queryObject(){return oN(this._queryParams)}isEqual(e){if(e=bs(e),!(e instanceof RR))return!1;const n=this._repo===e._repo,a=c6(this._path,e._path),h=this._queryIdentifier===e._queryIdentifier;return n&&a&&h}toJSON(){return this.toString()}toString(){return this._repo.toString()+qte(this._path)}}class o_ extends RR{constructor(e,n){super(e,n,new gR,!1)}get parent(){const e=l6(this._path);return e===null?null:new o_(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}Yne(o_);Qne(o_);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oie="FIREBASE_DATABASE_EMULATOR_HOST",qC={};let zie=!1;function Fie(t,e,n,a){const h=e.lastIndexOf(":"),m=e.substring(0,h),v=tf(m);t.repoInfo_=new YU(e,v,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),a&&(t.authTokenProvider_=a)}function Nie(t,e,n,a,h){let m=a||t.options.databaseURL;m===void 0&&(t.options.projectId||wh("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ga("Using default host for project ",t.options.projectId),m=`${t.options.projectId}-default-rtdb.firebaseio.com`);let v=wN(m,h),o=v.repoInfo,S;typeof process<"u"&&UF&&(S=UF[Oie]),S?(m=`http://${S}?ns=${o.namespace}`,v=wN(m,h),o=v.repoInfo):v.repoInfo.secure;const P=new xte(t.name,t.options,e);mie("Invalid Firebase Database URL",v),Mr(v.path)||wh("Database URL must point to the root of a Firebase Database (not including a child path).");const N=Vie(o,t,P,new vte(t,n));return new Uie(N,t)}function Bie(t,e){const n=qC[e];(!n||n[t.key]!==t)&&wh(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Cie(t),delete n[t.key]}function Vie(t,e,n,a){let h=qC[e.name];h||(h={},qC[e.name]=h);let m=h[t.toURLString()];return m&&wh("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),m=new bie(t,zie,n,a),h[t.toURLString()]=m,m}class Uie{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Tie(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new o_(this._repo,as())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Bie(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&wh("Cannot call "+e+" on a deleted database.")}}function jie(t=Bx(),e){const n=Ih(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const a=mV("database");a&&Gie(n,...a)}return n}function Gie(t,e,n,a={}){t=bs(t),t._checkNotDeleted("useEmulator");const h=`${e}:${n}`,m=t._repoInternal;if(t._instanceStarted){if(h===t._repoInternal.repoInfo_.host&&Dc(a,m.repoInfo_.emulatorOptions))return;wh("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let v;if(m.repoInfo_.nodeAdmin)a.mockUserToken&&wh('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),v=new X1(X1.OWNER);else if(a.mockUserToken){const o=typeof a.mockUserToken=="string"?a.mockUserToken:yV(a.mockUserToken,t.app.options.projectId);v=new X1(o)}tf(e)&&(hP(e),dP("Database",!0)),Fie(m,h,a,v)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $ie(t){rte(bp),kl(new ul("database",(e,{instanceIdentifier:n})=>{const a=e.getProvider("app").getImmediate(),h=e.getProvider("auth-internal"),m=e.getProvider("app-check-internal");return Nie(a,h,m,n)},"PUBLIC").setMultipleInstances(!0)),va(jF,GF,t),va(jF,GF,"esm2020")}uh.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};uh.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};$ie();const Hie=(t,e)=>e.some(n=>t instanceof n);let bN,TN;function qie(){return bN||(bN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Wie(){return TN||(TN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Z6=new WeakMap,WC=new WeakMap,X6=new WeakMap,US=new WeakMap,kR=new WeakMap;function Zie(t){const e=new Promise((n,a)=>{const h=()=>{t.removeEventListener("success",m),t.removeEventListener("error",v)},m=()=>{n(jd(t.result)),h()},v=()=>{a(t.error),h()};t.addEventListener("success",m),t.addEventListener("error",v)});return e.then(n=>{n instanceof IDBCursor&&Z6.set(n,t)}).catch(()=>{}),kR.set(e,t),e}function Xie(t){if(WC.has(t))return;const e=new Promise((n,a)=>{const h=()=>{t.removeEventListener("complete",m),t.removeEventListener("error",v),t.removeEventListener("abort",v)},m=()=>{n(),h()},v=()=>{a(t.error||new DOMException("AbortError","AbortError")),h()};t.addEventListener("complete",m),t.addEventListener("error",v),t.addEventListener("abort",v)});WC.set(t,e)}let ZC={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return WC.get(t);if(e==="objectStoreNames")return t.objectStoreNames||X6.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return jd(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Kie(t){ZC=t(ZC)}function Yie(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const a=t.call(jS(this),e,...n);return X6.set(a,e.sort?e.sort():[e]),jd(a)}:Wie().includes(t)?function(...e){return t.apply(jS(this),e),jd(Z6.get(this))}:function(...e){return jd(t.apply(jS(this),e))}}function Qie(t){return typeof t=="function"?Yie(t):(t instanceof IDBTransaction&&Xie(t),Hie(t,qie())?new Proxy(t,ZC):t)}function jd(t){if(t instanceof IDBRequest)return Zie(t);if(US.has(t))return US.get(t);const e=Qie(t);return e!==t&&(US.set(t,e),kR.set(e,t)),e}const jS=t=>kR.get(t);function Jie(t,e,{blocked:n,upgrade:a,blocking:h,terminated:m}={}){const v=indexedDB.open(t,e),o=jd(v);return a&&v.addEventListener("upgradeneeded",S=>{a(jd(v.result),S.oldVersion,S.newVersion,jd(v.transaction),S)}),n&&v.addEventListener("blocked",S=>n(S.oldVersion,S.newVersion,S)),o.then(S=>{m&&S.addEventListener("close",()=>m()),h&&S.addEventListener("versionchange",P=>h(P.oldVersion,P.newVersion,P))}).catch(()=>{}),o}const ere=["get","getKey","getAll","getAllKeys","count"],tre=["put","add","delete","clear"],GS=new Map;function EN(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(GS.get(e))return GS.get(e);const n=e.replace(/FromIndex$/,""),a=e!==n,h=tre.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(h||ere.includes(n)))return;const m=async function(v,...o){const S=this.transaction(v,h?"readwrite":"readonly");let P=S.store;return a&&(P=P.index(o.shift())),(await Promise.all([P[n](...o),h&&S.done]))[0]};return GS.set(e,m),m}Kie(t=>({...t,get:(e,n,a)=>EN(e,n)||t.get(e,n,a),has:(e,n)=>!!EN(e,n)||t.has(e,n)}));const K6="@firebase/installations",MR="0.6.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y6=1e4,Q6=`w:${MR}`,J6="FIS_v2",nre="https://firebaseinstallations.googleapis.com/v1",ire=60*60*1e3,rre="installations",sre="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ore={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},_p=new nf(rre,sre,ore);function ej(t){return t instanceof Oc&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tj({projectId:t}){return`${nre}/projects/${t}/installations`}function nj(t){return{token:t.token,requestStatus:2,expiresIn:lre(t.expiresIn),creationTime:Date.now()}}async function ij(t,e){const a=(await e.json()).error;return _p.create("request-failed",{requestName:t,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})}function rj({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function are(t,{refreshToken:e}){const n=rj(t);return n.append("Authorization",cre(e)),n}async function sj(t){const e=await t();return e.status>=500&&e.status<600?t():e}function lre(t){return Number(t.replace("s","000"))}function cre(t){return`${J6} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ure({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const a=tj(t),h=rj(t),m=e.getImmediate({optional:!0});if(m){const P=await m.getHeartbeatsHeader();P&&h.append("x-firebase-client",P)}const v={fid:n,authVersion:J6,appId:t.appId,sdkVersion:Q6},o={method:"POST",headers:h,body:JSON.stringify(v)},S=await sj(()=>fetch(a,o));if(S.ok){const P=await S.json();return{fid:P.fid||n,registrationStatus:2,refreshToken:P.refreshToken,authToken:nj(P.authToken)}}else throw await ij("Create Installation",S)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oj(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hre(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dre=/^[cdef][\w-]{21}$/,XC="";function fre(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=pre(t);return dre.test(n)?n:XC}catch{return XC}}function pre(t){return hre(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XT(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aj=new Map;function lj(t,e){const n=XT(t);cj(n,e),mre(n,e)}function cj(t,e){const n=aj.get(t);if(n)for(const a of n)a(e)}function mre(t,e){const n=gre();n&&n.postMessage({key:t,fid:e}),_re()}let ep=null;function gre(){return!ep&&"BroadcastChannel"in self&&(ep=new BroadcastChannel("[Firebase] FID Change"),ep.onmessage=t=>{cj(t.data.key,t.data.fid)}),ep}function _re(){aj.size===0&&ep&&(ep.close(),ep=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yre="firebase-installations-database",vre=1,yp="firebase-installations-store";let $S=null;function DR(){return $S||($S=Jie(yre,vre,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(yp)}}})),$S}async function Yb(t,e){const n=XT(t),h=(await DR()).transaction(yp,"readwrite"),m=h.objectStore(yp),v=await m.get(n);return await m.put(e,n),await h.done,(!v||v.fid!==e.fid)&&lj(t,e.fid),e}async function uj(t){const e=XT(t),a=(await DR()).transaction(yp,"readwrite");await a.objectStore(yp).delete(e),await a.done}async function KT(t,e){const n=XT(t),h=(await DR()).transaction(yp,"readwrite"),m=h.objectStore(yp),v=await m.get(n),o=e(v);return o===void 0?await m.delete(n):await m.put(o,n),await h.done,o&&(!v||v.fid!==o.fid)&&lj(t,o.fid),o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LR(t){let e;const n=await KT(t.appConfig,a=>{const h=xre(a),m=wre(t,h);return e=m.registrationPromise,m.installationEntry});return n.fid===XC?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function xre(t){const e=t||{fid:fre(),registrationStatus:0};return hj(e)}function wre(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const h=Promise.reject(_p.create("app-offline"));return{installationEntry:e,registrationPromise:h}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},a=bre(t,n);return{installationEntry:n,registrationPromise:a}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Tre(t)}:{installationEntry:e}}async function bre(t,e){try{const n=await ure(t,e);return Yb(t.appConfig,n)}catch(n){throw ej(n)&&n.customData.serverCode===409?await uj(t.appConfig):await Yb(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function Tre(t){let e=await IN(t.appConfig);for(;e.registrationStatus===1;)await oj(100),e=await IN(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:a}=await LR(t);return a||n}return e}function IN(t){return KT(t,e=>{if(!e)throw _p.create("installation-not-found");return hj(e)})}function hj(t){return Ere(t)?{fid:t.fid,registrationStatus:0}:t}function Ere(t){return t.registrationStatus===1&&t.registrationTime+Y6<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ire({appConfig:t,heartbeatServiceProvider:e},n){const a=Sre(t,n),h=are(t,n),m=e.getImmediate({optional:!0});if(m){const P=await m.getHeartbeatsHeader();P&&h.append("x-firebase-client",P)}const v={installation:{sdkVersion:Q6,appId:t.appId}},o={method:"POST",headers:h,body:JSON.stringify(v)},S=await sj(()=>fetch(a,o));if(S.ok){const P=await S.json();return nj(P)}else throw await ij("Generate Auth Token",S)}function Sre(t,{fid:e}){return`${tj(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OR(t,e=!1){let n;const a=await KT(t.appConfig,m=>{if(!dj(m))throw _p.create("not-registered");const v=m.authToken;if(!e&&Pre(v))return m;if(v.requestStatus===1)return n=Are(t,e),m;{if(!navigator.onLine)throw _p.create("app-offline");const o=kre(m);return n=Cre(t,o),o}});return n?await n:a.authToken}async function Are(t,e){let n=await SN(t.appConfig);for(;n.authToken.requestStatus===1;)await oj(100),n=await SN(t.appConfig);const a=n.authToken;return a.requestStatus===0?OR(t,e):a}function SN(t){return KT(t,e=>{if(!dj(e))throw _p.create("not-registered");const n=e.authToken;return Mre(n)?{...e,authToken:{requestStatus:0}}:e})}async function Cre(t,e){try{const n=await Ire(t,e),a={...e,authToken:n};return await Yb(t.appConfig,a),n}catch(n){if(ej(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await uj(t.appConfig);else{const a={...e,authToken:{requestStatus:0}};await Yb(t.appConfig,a)}throw n}}function dj(t){return t!==void 0&&t.registrationStatus===2}function Pre(t){return t.requestStatus===2&&!Rre(t)}function Rre(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+ire}function kre(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function Mre(t){return t.requestStatus===1&&t.requestTime+Y6<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dre(t){const e=t,{installationEntry:n,registrationPromise:a}=await LR(e);return a?a.catch(console.error):OR(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lre(t,e=!1){const n=t;return await Ore(n),(await OR(n,e)).token}async function Ore(t){const{registrationPromise:e}=await LR(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zre(t){if(!t||!t.options)throw HS("App Configuration");if(!t.name)throw HS("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw HS(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function HS(t){return _p.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fj="installations",Fre="installations-internal",Nre=t=>{const e=t.getProvider("app").getImmediate(),n=zre(e),a=Ih(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:a,_delete:()=>Promise.resolve()}},Bre=t=>{const e=t.getProvider("app").getImmediate(),n=Ih(e,fj).getImmediate();return{getId:()=>Dre(n),getToken:h=>Lre(n,h)}};function Vre(){kl(new ul(fj,Nre,"PUBLIC")),kl(new ul(Fre,Bre,"PRIVATE"))}Vre();va(K6,MR);va(K6,MR,"esm2020");const Ure=(t,e)=>e.some(n=>t instanceof n);let AN,CN;function jre(){return AN||(AN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Gre(){return CN||(CN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const pj=new WeakMap,KC=new WeakMap,mj=new WeakMap,qS=new WeakMap,zR=new WeakMap;function $re(t){const e=new Promise((n,a)=>{const h=()=>{t.removeEventListener("success",m),t.removeEventListener("error",v)},m=()=>{n(hh(t.result)),h()},v=()=>{a(t.error),h()};t.addEventListener("success",m),t.addEventListener("error",v)});return e.then(n=>{n instanceof IDBCursor&&pj.set(n,t)}).catch(()=>{}),zR.set(e,t),e}function Hre(t){if(KC.has(t))return;const e=new Promise((n,a)=>{const h=()=>{t.removeEventListener("complete",m),t.removeEventListener("error",v),t.removeEventListener("abort",v)},m=()=>{n(),h()},v=()=>{a(t.error||new DOMException("AbortError","AbortError")),h()};t.addEventListener("complete",m),t.addEventListener("error",v),t.addEventListener("abort",v)});KC.set(t,e)}let YC={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return KC.get(t);if(e==="objectStoreNames")return t.objectStoreNames||mj.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hh(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function qre(t){YC=t(YC)}function Wre(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const a=t.call(WS(this),e,...n);return mj.set(a,e.sort?e.sort():[e]),hh(a)}:Gre().includes(t)?function(...e){return t.apply(WS(this),e),hh(pj.get(this))}:function(...e){return hh(t.apply(WS(this),e))}}function Zre(t){return typeof t=="function"?Wre(t):(t instanceof IDBTransaction&&Hre(t),Ure(t,jre())?new Proxy(t,YC):t)}function hh(t){if(t instanceof IDBRequest)return $re(t);if(qS.has(t))return qS.get(t);const e=Zre(t);return e!==t&&(qS.set(t,e),zR.set(e,t)),e}const WS=t=>zR.get(t);function gj(t,e,{blocked:n,upgrade:a,blocking:h,terminated:m}={}){const v=indexedDB.open(t,e),o=hh(v);return a&&v.addEventListener("upgradeneeded",S=>{a(hh(v.result),S.oldVersion,S.newVersion,hh(v.transaction),S)}),n&&v.addEventListener("blocked",S=>n(S.oldVersion,S.newVersion,S)),o.then(S=>{m&&S.addEventListener("close",()=>m()),h&&S.addEventListener("versionchange",P=>h(P.oldVersion,P.newVersion,P))}).catch(()=>{}),o}function ZS(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",a=>e(a.oldVersion,a)),hh(n).then(()=>{})}const Xre=["get","getKey","getAll","getAllKeys","count"],Kre=["put","add","delete","clear"],XS=new Map;function PN(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(XS.get(e))return XS.get(e);const n=e.replace(/FromIndex$/,""),a=e!==n,h=Kre.includes(n);if(!(n in(a?IDBIndex:IDBObjectStore).prototype)||!(h||Xre.includes(n)))return;const m=async function(v,...o){const S=this.transaction(v,h?"readwrite":"readonly");let P=S.store;return a&&(P=P.index(o.shift())),(await Promise.all([P[n](...o),h&&S.done]))[0]};return XS.set(e,m),m}qre(t=>({...t,get:(e,n,a)=>PN(e,n)||t.get(e,n,a),has:(e,n)=>!!PN(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yre="/firebase-messaging-sw.js",Qre="/firebase-cloud-messaging-push-scope",_j="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Jre="https://fcmregistrations.googleapis.com/v1",yj="google.c.a.c_id",ese="google.c.a.c_l",tse="google.c.a.ts",nse="google.c.a.e",RN=1e4;var kN;(function(t){t[t.DATA_MESSAGE=1]="DATA_MESSAGE",t[t.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(kN||(kN={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Ax;(function(t){t.PUSH_RECEIVED="push-received",t.NOTIFICATION_CLICKED="notification-clicked"})(Ax||(Ax={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qu(t){const e=new Uint8Array(t);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ise(t){const e="=".repeat((4-t.length%4)%4),n=(t+e).replace(/\-/g,"+").replace(/_/g,"/"),a=atob(n),h=new Uint8Array(a.length);for(let m=0;m<a.length;++m)h[m]=a.charCodeAt(m);return h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KS="fcm_token_details_db",rse=5,MN="fcm_token_object_Store";async function sse(t){if("databases"in indexedDB&&!(await indexedDB.databases()).map(m=>m.name).includes(KS))return null;let e=null;return(await gj(KS,rse,{upgrade:async(a,h,m,v)=>{if(h<2||!a.objectStoreNames.contains(MN))return;const o=v.objectStore(MN),S=await o.index("fcmSenderId").get(t);if(await o.clear(),!!S){if(h===2){const P=S;if(!P.auth||!P.p256dh||!P.endpoint)return;e={token:P.fcmToken,createTime:P.createTime??Date.now(),subscriptionOptions:{auth:P.auth,p256dh:P.p256dh,endpoint:P.endpoint,swScope:P.swScope,vapidKey:typeof P.vapidKey=="string"?P.vapidKey:Qu(P.vapidKey)}}}else if(h===3){const P=S;e={token:P.fcmToken,createTime:P.createTime,subscriptionOptions:{auth:Qu(P.auth),p256dh:Qu(P.p256dh),endpoint:P.endpoint,swScope:P.swScope,vapidKey:Qu(P.vapidKey)}}}else if(h===4){const P=S;e={token:P.fcmToken,createTime:P.createTime,subscriptionOptions:{auth:Qu(P.auth),p256dh:Qu(P.p256dh),endpoint:P.endpoint,swScope:P.swScope,vapidKey:Qu(P.vapidKey)}}}}}})).close(),await ZS(KS),await ZS("fcm_vapid_details_db"),await ZS("undefined"),ose(e)?e:null}function ose(t){if(!t||!t.subscriptionOptions)return!1;const{subscriptionOptions:e}=t;return typeof t.createTime=="number"&&t.createTime>0&&typeof t.token=="string"&&t.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ase="firebase-messaging-database",lse=1,Cx="firebase-messaging-store";let YS=null;function vj(){return YS||(YS=gj(ase,lse,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Cx)}}})),YS}async function cse(t){const e=xj(t),a=await(await vj()).transaction(Cx).objectStore(Cx).get(e);if(a)return a;{const h=await sse(t.appConfig.senderId);if(h)return await FR(t,h),h}}async function FR(t,e){const n=xj(t),h=(await vj()).transaction(Cx,"readwrite");return await h.objectStore(Cx).put(e,n),await h.done,e}function xj({appConfig:t}){return t.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const use={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},xa=new nf("messaging","Messaging",use);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hse(t,e){const n=await BR(t),a=wj(e),h={method:"POST",headers:n,body:JSON.stringify(a)};let m;try{m=await(await fetch(NR(t.appConfig),h)).json()}catch(v){throw xa.create("token-subscribe-failed",{errorInfo:v==null?void 0:v.toString()})}if(m.error){const v=m.error.message;throw xa.create("token-subscribe-failed",{errorInfo:v})}if(!m.token)throw xa.create("token-subscribe-no-token");return m.token}async function dse(t,e){const n=await BR(t),a=wj(e.subscriptionOptions),h={method:"PATCH",headers:n,body:JSON.stringify(a)};let m;try{m=await(await fetch(`${NR(t.appConfig)}/${e.token}`,h)).json()}catch(v){throw xa.create("token-update-failed",{errorInfo:v==null?void 0:v.toString()})}if(m.error){const v=m.error.message;throw xa.create("token-update-failed",{errorInfo:v})}if(!m.token)throw xa.create("token-update-no-token");return m.token}async function fse(t,e){const a={method:"DELETE",headers:await BR(t)};try{const m=await(await fetch(`${NR(t.appConfig)}/${e}`,a)).json();if(m.error){const v=m.error.message;throw xa.create("token-unsubscribe-failed",{errorInfo:v})}}catch(h){throw xa.create("token-unsubscribe-failed",{errorInfo:h==null?void 0:h.toString()})}}function NR({projectId:t}){return`${Jre}/projects/${t}/registrations`}async function BR({appConfig:t,installations:e}){const n=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function wj({p256dh:t,auth:e,endpoint:n,vapidKey:a}){const h={web:{endpoint:n,auth:e,p256dh:t}};return a!==_j&&(h.web.applicationPubKey=a),h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pse=7*24*60*60*1e3;async function mse(t){const e=await _se(t.swRegistration,t.vapidKey),n={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:e.endpoint,auth:Qu(e.getKey("auth")),p256dh:Qu(e.getKey("p256dh"))},a=await cse(t.firebaseDependencies);if(a){if(yse(a.subscriptionOptions,n))return Date.now()>=a.createTime+pse?gse(t,{token:a.token,createTime:Date.now(),subscriptionOptions:n}):a.token;try{await fse(t.firebaseDependencies,a.token)}catch(h){console.warn(h)}return DN(t.firebaseDependencies,n)}else return DN(t.firebaseDependencies,n)}async function gse(t,e){try{const n=await dse(t.firebaseDependencies,e),a={...e,token:n,createTime:Date.now()};return await FR(t.firebaseDependencies,a),n}catch(n){throw n}}async function DN(t,e){const a={token:await hse(t,e),createTime:Date.now(),subscriptionOptions:e};return await FR(t,a),a.token}async function _se(t,e){const n=await t.pushManager.getSubscription();return n||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ise(e)})}function yse(t,e){const n=e.vapidKey===t.vapidKey,a=e.endpoint===t.endpoint,h=e.auth===t.auth,m=e.p256dh===t.p256dh;return n&&a&&h&&m}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(t){const e={from:t.from,collapseKey:t.collapse_key,messageId:t.fcmMessageId};return vse(e,t),xse(e,t),wse(e,t),e}function vse(t,e){if(!e.notification)return;t.notification={};const n=e.notification.title;n&&(t.notification.title=n);const a=e.notification.body;a&&(t.notification.body=a);const h=e.notification.image;h&&(t.notification.image=h);const m=e.notification.icon;m&&(t.notification.icon=m)}function xse(t,e){e.data&&(t.data=e.data)}function wse(t,e){var h,m,v,o;if(!e.fcmOptions&&!((h=e.notification)!=null&&h.click_action))return;t.fcmOptions={};const n=((m=e.fcmOptions)==null?void 0:m.link)??((v=e.notification)==null?void 0:v.click_action);n&&(t.fcmOptions.link=n);const a=(o=e.fcmOptions)==null?void 0:o.analytics_label;a&&(t.fcmOptions.analyticsLabel=a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bse(t){return typeof t=="object"&&!!t&&yj in t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tse(t){if(!t||!t.options)throw QS("App Configuration Object");if(!t.name)throw QS("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:n}=t;for(const a of e)if(!n[a])throw QS(a);return{appName:t.name,projectId:n.projectId,apiKey:n.apiKey,appId:n.appId,senderId:n.messagingSenderId}}function QS(t){return xa.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ese{constructor(e,n,a){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const h=Tse(e);this.firebaseDependencies={app:e,appConfig:h,installations:n,analyticsProvider:a}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ise(t){try{t.swRegistration=await navigator.serviceWorker.register(Yre,{scope:Qre}),t.swRegistration.update().catch(()=>{}),await Sse(t.swRegistration)}catch(e){throw xa.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}async function Sse(t){return new Promise((e,n)=>{const a=setTimeout(()=>n(new Error(`Service worker not registered after ${RN} ms`)),RN),h=t.installing||t.waiting;t.active?(clearTimeout(a),e()):h?h.onstatechange=m=>{var v;((v=m.target)==null?void 0:v.state)==="activated"&&(h.onstatechange=null,clearTimeout(a),e())}:(clearTimeout(a),n(new Error("No incoming service worker found.")))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ase(t,e){if(!e&&!t.swRegistration&&await Ise(t),!(!e&&t.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw xa.create("invalid-sw-registration");t.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cse(t,e){e?t.vapidKey=e:t.vapidKey||(t.vapidKey=_j)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bj(t,e){if(!navigator)throw xa.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw xa.create("permission-blocked");return await Cse(t,e==null?void 0:e.vapidKey),await Ase(t,e==null?void 0:e.serviceWorkerRegistration),mse(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pse(t,e,n){const a=Rse(e);(await t.firebaseDependencies.analyticsProvider.get()).logEvent(a,{message_id:n[yj],message_name:n[ese],message_time:n[tse],message_device_time:Math.floor(Date.now()/1e3)})}function Rse(t){switch(t){case Ax.NOTIFICATION_CLICKED:return"notification_open";case Ax.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kse(t,e){const n=e.data;if(!n.isFirebaseMessaging)return;t.onMessageHandler&&n.messageType===Ax.PUSH_RECEIVED&&(typeof t.onMessageHandler=="function"?t.onMessageHandler(LN(n)):t.onMessageHandler.next(LN(n)));const a=n.data;bse(a)&&a[nse]==="1"&&await Pse(t,n.messageType,a)}const ON="@firebase/messaging",zN="0.12.23";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mse=t=>{const e=new Ese(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),t.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",n=>kse(e,n)),e},Dse=t=>{const e=t.getProvider("messaging").getImmediate();return{getToken:a=>bj(e,a)}};function Lse(){kl(new ul("messaging",Mse,"PUBLIC")),kl(new ul("messaging-internal",Dse,"PRIVATE")),va(ON,zN),va(ON,zN,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ose(){try{await mP()}catch{return!1}return typeof window<"u"&&pP()&&wV()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zse(t,e){if(!navigator)throw xa.create("only-available-in-window");return t.onMessageHandler=e,()=>{t.onMessageHandler=null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fse(t=Bx()){return Ose().then(e=>{if(!e)throw xa.create("unsupported-browser")},e=>{throw xa.create("indexed-db-unsupported")}),Ih(bs(t),"messaging").getImmediate()}async function Nse(t,e){return t=bs(t),bj(t,e)}function Bse(t,e){return t=bs(t),zse(t,e)}Lse();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qb="analytics",Vse="firebase_id",Use="origin",jse=60*1e3,Gse="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",VR="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ll=new Nx("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $se={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Pl=new nf("analytics","Analytics",$se);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hse(t){if(!t.startsWith(VR)){const e=Pl.create("invalid-gtag-resource",{gtagURL:t});return ll.warn(e.message),""}return t}function Tj(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function qse(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function Wse(t,e){const n=qse("firebase-js-sdk-policy",{createScriptURL:Hse}),a=document.createElement("script"),h=`${VR}?l=${t}&id=${e}`;a.src=n?n==null?void 0:n.createScriptURL(h):h,a.async=!0,document.head.appendChild(a)}function Zse(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function Xse(t,e,n,a,h,m){const v=a[h];try{if(v)await e[v];else{const S=(await Tj(n)).find(P=>P.measurementId===h);S&&await e[S.appId]}}catch(o){ll.error(o)}t("config",h,m)}async function Kse(t,e,n,a,h){try{let m=[];if(h&&h.send_to){let v=h.send_to;Array.isArray(v)||(v=[v]);const o=await Tj(n);for(const S of v){const P=o.find(V=>V.measurementId===S),N=P&&e[P.appId];if(N)m.push(N);else{m=[];break}}}m.length===0&&(m=Object.values(e)),await Promise.all(m),t("event",a,h||{})}catch(m){ll.error(m)}}function Yse(t,e,n,a){async function h(m,...v){try{if(m==="event"){const[o,S]=v;await Kse(t,e,n,o,S)}else if(m==="config"){const[o,S]=v;await Xse(t,e,n,a,o,S)}else if(m==="consent"){const[o,S]=v;t("consent",o,S)}else if(m==="get"){const[o,S,P]=v;t("get",o,S,P)}else if(m==="set"){const[o]=v;t("set",o)}else t(m,...v)}catch(o){ll.error(o)}}return h}function Qse(t,e,n,a,h){let m=function(...v){window[a].push(arguments)};return window[h]&&typeof window[h]=="function"&&(m=window[h]),window[h]=Yse(m,t,e,n),{gtagCore:m,wrappedGtag:window[h]}}function Jse(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(VR)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eoe=30,toe=1e3;class noe{constructor(e={},n=toe){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Ej=new noe;function ioe(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function roe(t){var v;const{appId:e,apiKey:n}=t,a={method:"GET",headers:ioe(n)},h=Gse.replace("{app-id}",e),m=await fetch(h,a);if(m.status!==200&&m.status!==304){let o="";try{const S=await m.json();(v=S.error)!=null&&v.message&&(o=S.error.message)}catch{}throw Pl.create("config-fetch-failed",{httpStatus:m.status,responseMessage:o})}return m.json()}async function soe(t,e=Ej,n){const{appId:a,apiKey:h,measurementId:m}=t.options;if(!a)throw Pl.create("no-app-id");if(!h){if(m)return{measurementId:m,appId:a};throw Pl.create("no-api-key")}const v=e.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new loe;return setTimeout(async()=>{o.abort()},jse),Ij({appId:a,apiKey:h,measurementId:m},v,o,e)}async function Ij(t,{throttleEndTimeMillis:e,backoffCount:n},a,h=Ej){var o;const{appId:m,measurementId:v}=t;try{await ooe(a,e)}catch(S){if(v)return ll.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${v} provided in the "measurementId" field in the local Firebase config. [${S==null?void 0:S.message}]`),{appId:m,measurementId:v};throw S}try{const S=await roe(t);return h.deleteThrottleMetadata(m),S}catch(S){const P=S;if(!aoe(P)){if(h.deleteThrottleMetadata(m),v)return ll.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${v} provided in the "measurementId" field in the local Firebase config. [${P==null?void 0:P.message}]`),{appId:m,measurementId:v};throw S}const N=Number((o=P==null?void 0:P.customData)==null?void 0:o.httpStatus)===503?lz(n,h.intervalMillis,eoe):lz(n,h.intervalMillis),V={throttleEndTimeMillis:Date.now()+N,backoffCount:n+1};return h.setThrottleMetadata(m,V),ll.debug(`Calling attemptFetch again in ${N} millis`),Ij(t,V,a,h)}}function ooe(t,e){return new Promise((n,a)=>{const h=Math.max(e-Date.now(),0),m=setTimeout(n,h);t.addEventListener(()=>{clearTimeout(m),a(Pl.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function aoe(t){if(!(t instanceof Oc)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class loe{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function coe(t,e,n,a,h){if(h&&h.global){t("event",n,a);return}else{const m=await e,v={...a,send_to:m};t("event",n,v)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uoe(){if(pP())try{await mP()}catch(t){return ll.warn(Pl.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return ll.warn(Pl.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function hoe(t,e,n,a,h,m,v){const o=soe(t);o.then(j=>{n[j.measurementId]=j.appId,t.options.measurementId&&j.measurementId!==t.options.measurementId&&ll.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${j.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(j=>ll.error(j)),e.push(o);const S=uoe().then(j=>{if(j)return a.getId()}),[P,N]=await Promise.all([o,S]);Jse(m)||Wse(m,P.measurementId),h("js",new Date);const V=(v==null?void 0:v.config)??{};return V[Use]="firebase",V.update=!0,N!=null&&(V[Vse]=N),h("config",P.measurementId,V),P.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class doe{constructor(e){this.app=e}_delete(){return delete qv[this.app.options.appId],Promise.resolve()}}let qv={},FN=[];const NN={};let JS="dataLayer",foe="gtag",BN,Sj,VN=!1;function poe(){const t=[];if(vV()&&t.push("This is a browser extension environment."),wV()||t.push("Cookies are not available."),t.length>0){const e=t.map((a,h)=>`(${h+1}) ${a}`).join(" "),n=Pl.create("invalid-analytics-context",{errorInfo:e});ll.warn(n.message)}}function moe(t,e,n){poe();const a=t.options.appId;if(!a)throw Pl.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)ll.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Pl.create("no-api-key");if(qv[a]!=null)throw Pl.create("already-exists",{id:a});if(!VN){Zse(JS);const{wrappedGtag:m,gtagCore:v}=Qse(qv,FN,NN,JS,foe);Sj=m,BN=v,VN=!0}return qv[a]=hoe(t,FN,NN,e,BN,JS,n),new doe(t)}function goe(t=Bx()){t=bs(t);const e=Ih(t,Qb);return e.isInitialized()?e.getImmediate():_oe(t)}function _oe(t,e={}){const n=Ih(t,Qb);if(n.isInitialized()){const h=n.getImmediate();if(Dc(e,n.getOptions()))return h;throw Pl.create("already-initialized")}return n.initialize({options:e})}function yoe(t,e,n,a){t=bs(t),coe(Sj,qv[t.app.options.appId],e,n,a).catch(h=>ll.error(h))}const UN="@firebase/analytics",jN="0.10.18";function voe(){kl(new ul(Qb,(e,{options:n})=>{const a=e.getProvider("app").getImmediate(),h=e.getProvider("installations-internal").getImmediate();return moe(a,h,n)},"PUBLIC")),kl(new ul("analytics-internal",t,"PRIVATE")),va(UN,jN),va(UN,jN,"esm2020");function t(e){try{const n=e.getProvider(Qb).getImmediate();return{logEvent:(a,h,m)=>yoe(n,a,h,m)}}catch(n){throw Pl.create("interop-component-reg-failed",{reason:n})}}}voe();const Aj={apiKey:"AIzaSyD3HoYXurNWenu22LQUJpi8Y2lELpurENM",authDomain:"planner-f9ba2.firebaseapp.com",projectId:"planner-f9ba2",storageBucket:"planner-f9ba2.firebasestorage.app",messagingSenderId:"995199005733",appId:"1:995199005733:web:fc55697cadcb61197f7bcc",measurementId:"G-Q9ST1XH5P0"},e0=IV(Aj);let xoe;if(typeof window<"u"&&Aj.measurementId)try{xoe=goe(e0)}catch(t){console.warn("Analytics init error:",t.message)}const pv=zY(e0),woe=new eh,cg=zee(e0);jie(e0);let Px;try{typeof window<"u"&&(Px=Fse(e0))}catch(t){console.warn("Messaging init error:",t.message)}async function boe(){try{return!Px||!("Notification"in window)||await Notification.requestPermission()!=="granted"?null:await Nse(Px,{vapidKey:"BMAG-iRsf74wKAKAu9lSyV02iHnPZI81Gz_7RUbCxSfo28y7LwGH_MtwnaQrKOOnUuzWTn1zU2KNgmw257PpNcA"})||null}catch(t){return console.error("FCM getToken error:",t),null}}function Toe(t){return Px?Bse(Px,t):()=>{}}function Eoe(){const[t,e]=yt.useState(null),[n,a]=yt.useState(!0);yt.useEffect(()=>{let S=!0;const P=EK(pv,N=>{S&&(e(N),a(!1))});return()=>{S=!1,P()}},[]);const h=yt.useCallback((S,P)=>wK(pv,S,P),[]),m=yt.useCallback((S,P)=>xK(pv,S,P),[]),v=yt.useCallback(()=>HK(pv,woe),[]),o=yt.useCallback(()=>IK(pv),[]);return{user:t,loading:n,loginEmail:h,registerEmail:m,loginGoogle:v,logout:o}}function w1(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Cj={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(a,h,m){function v(P,N){if(!h[P]){if(!a[P]){var V=typeof w1=="function"&&w1;if(!N&&V)return V(P,!0);if(o)return o(P,!0);var j=new Error("Cannot find module '"+P+"'");throw j.code="MODULE_NOT_FOUND",j}var Q=h[P]={exports:{}};a[P][0].call(Q.exports,function(oe){var me=a[P][1][oe];return v(me||oe)},Q,Q.exports,n,a,h,m)}return h[P].exports}for(var o=typeof w1=="function"&&w1,S=0;S<m.length;S++)v(m[S]);return v}({1:[function(n,a,h){(function(m){var v=m.MutationObserver||m.WebKitMutationObserver,o;if(v){var S=0,P=new v(oe),N=m.document.createTextNode("");P.observe(N,{characterData:!0}),o=function(){N.data=S=++S%2}}else if(!m.setImmediate&&typeof m.MessageChannel<"u"){var V=new m.MessageChannel;V.port1.onmessage=oe,o=function(){V.port2.postMessage(0)}}else"document"in m&&"onreadystatechange"in m.document.createElement("script")?o=function(){var Ue=m.document.createElement("script");Ue.onreadystatechange=function(){oe(),Ue.onreadystatechange=null,Ue.parentNode.removeChild(Ue),Ue=null},m.document.documentElement.appendChild(Ue)}:o=function(){setTimeout(oe,0)};var j,Q=[];function oe(){j=!0;for(var Ue,de,ge=Q.length;ge;){for(de=Q,Q=[],Ue=-1;++Ue<ge;)de[Ue]();ge=Q.length}j=!1}a.exports=me;function me(Ue){Q.push(Ue)===1&&!j&&o()}}).call(this,typeof th<"u"?th:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(n,a,h){var m=n(1);function v(){}var o={},S=["REJECTED"],P=["FULFILLED"],N=["PENDING"];a.exports=V;function V(ct){if(typeof ct!="function")throw new TypeError("resolver must be a function");this.state=N,this.queue=[],this.outcome=void 0,ct!==v&&me(this,ct)}V.prototype.catch=function(ct){return this.then(null,ct)},V.prototype.then=function(ct,nt){if(typeof ct!="function"&&this.state===P||typeof nt!="function"&&this.state===S)return this;var Pe=new this.constructor(v);if(this.state!==N){var xe=this.state===P?ct:nt;Q(Pe,xe,this.outcome)}else this.queue.push(new j(Pe,ct,nt));return Pe};function j(ct,nt,Pe){this.promise=ct,typeof nt=="function"&&(this.onFulfilled=nt,this.callFulfilled=this.otherCallFulfilled),typeof Pe=="function"&&(this.onRejected=Pe,this.callRejected=this.otherCallRejected)}j.prototype.callFulfilled=function(ct){o.resolve(this.promise,ct)},j.prototype.otherCallFulfilled=function(ct){Q(this.promise,this.onFulfilled,ct)},j.prototype.callRejected=function(ct){o.reject(this.promise,ct)},j.prototype.otherCallRejected=function(ct){Q(this.promise,this.onRejected,ct)};function Q(ct,nt,Pe){m(function(){var xe;try{xe=nt(Pe)}catch(ke){return o.reject(ct,ke)}xe===ct?o.reject(ct,new TypeError("Cannot resolve promise with itself")):o.resolve(ct,xe)})}o.resolve=function(ct,nt){var Pe=Ue(oe,nt);if(Pe.status==="error")return o.reject(ct,Pe.value);var xe=Pe.value;if(xe)me(ct,xe);else{ct.state=P,ct.outcome=nt;for(var ke=-1,Ve=ct.queue.length;++ke<Ve;)ct.queue[ke].callFulfilled(nt)}return ct},o.reject=function(ct,nt){ct.state=S,ct.outcome=nt;for(var Pe=-1,xe=ct.queue.length;++Pe<xe;)ct.queue[Pe].callRejected(nt);return ct};function oe(ct){var nt=ct&&ct.then;if(ct&&(typeof ct=="object"||typeof ct=="function")&&typeof nt=="function")return function(){nt.apply(ct,arguments)}}function me(ct,nt){var Pe=!1;function xe(Qe){Pe||(Pe=!0,o.reject(ct,Qe))}function ke(Qe){Pe||(Pe=!0,o.resolve(ct,Qe))}function Ve(){nt(ke,xe)}var De=Ue(Ve);De.status==="error"&&xe(De.value)}function Ue(ct,nt){var Pe={};try{Pe.value=ct(nt),Pe.status="success"}catch(xe){Pe.status="error",Pe.value=xe}return Pe}V.resolve=de;function de(ct){return ct instanceof this?ct:o.resolve(new this(v),ct)}V.reject=ge;function ge(ct){var nt=new this(v);return o.reject(nt,ct)}V.all=Re;function Re(ct){var nt=this;if(Object.prototype.toString.call(ct)!=="[object Array]")return this.reject(new TypeError("must be an array"));var Pe=ct.length,xe=!1;if(!Pe)return this.resolve([]);for(var ke=new Array(Pe),Ve=0,De=-1,Qe=new this(v);++De<Pe;)Be(ct[De],De);return Qe;function Be(Hn,Ln){nt.resolve(Hn).then(ii,function(Ii){xe||(xe=!0,o.reject(Qe,Ii))});function ii(Ii){ke[Ln]=Ii,++Ve===Pe&&!xe&&(xe=!0,o.resolve(Qe,ke))}}}V.race=_t;function _t(ct){var nt=this;if(Object.prototype.toString.call(ct)!=="[object Array]")return this.reject(new TypeError("must be an array"));var Pe=ct.length,xe=!1;if(!Pe)return this.resolve([]);for(var ke=-1,Ve=new this(v);++ke<Pe;)De(ct[ke]);return Ve;function De(Qe){nt.resolve(Qe).then(function(Be){xe||(xe=!0,o.resolve(Ve,Be))},function(Be){xe||(xe=!0,o.reject(Ve,Be))})}}},{1:1}],3:[function(n,a,h){(function(m){typeof m.Promise!="function"&&(m.Promise=n(2))}).call(this,typeof th<"u"?th:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(n,a,h){var m=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ye){return typeof ye}:function(ye){return ye&&typeof Symbol=="function"&&ye.constructor===Symbol&&ye!==Symbol.prototype?"symbol":typeof ye};function v(ye,tt){if(!(ye instanceof tt))throw new TypeError("Cannot call a class as a function")}function o(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var S=o();function P(){try{if(!S||!S.open)return!1;var ye=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),tt=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!ye||tt)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function N(ye,tt){ye=ye||[],tt=tt||{};try{return new Blob(ye,tt)}catch(ut){if(ut.name!=="TypeError")throw ut;for(var ze=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,dt=new ze,mt=0;mt<ye.length;mt+=1)dt.append(ye[mt]);return dt.getBlob(tt.type)}}typeof Promise>"u"&&n(3);var V=Promise;function j(ye,tt){tt&&ye.then(function(ze){tt(null,ze)},function(ze){tt(ze)})}function Q(ye,tt,ze){typeof tt=="function"&&ye.then(tt),typeof ze=="function"&&ye.catch(ze)}function oe(ye){return typeof ye!="string"&&(console.warn(ye+" used as a key, but it is not a string."),ye=String(ye)),ye}function me(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var Ue="local-forage-detect-blob-support",de=void 0,ge={},Re=Object.prototype.toString,_t="readonly",ct="readwrite";function nt(ye){for(var tt=ye.length,ze=new ArrayBuffer(tt),dt=new Uint8Array(ze),mt=0;mt<tt;mt++)dt[mt]=ye.charCodeAt(mt);return ze}function Pe(ye){return new V(function(tt){var ze=ye.transaction(Ue,ct),dt=N([""]);ze.objectStore(Ue).put(dt,"key"),ze.onabort=function(mt){mt.preventDefault(),mt.stopPropagation(),tt(!1)},ze.oncomplete=function(){var mt=navigator.userAgent.match(/Chrome\/(\d+)/),ut=navigator.userAgent.match(/Edge\//);tt(ut||!mt||parseInt(mt[1],10)>=43)}}).catch(function(){return!1})}function xe(ye){return typeof de=="boolean"?V.resolve(de):Pe(ye).then(function(tt){return de=tt,de})}function ke(ye){var tt=ge[ye.name],ze={};ze.promise=new V(function(dt,mt){ze.resolve=dt,ze.reject=mt}),tt.deferredOperations.push(ze),tt.dbReady?tt.dbReady=tt.dbReady.then(function(){return ze.promise}):tt.dbReady=ze.promise}function Ve(ye){var tt=ge[ye.name],ze=tt.deferredOperations.pop();if(ze)return ze.resolve(),ze.promise}function De(ye,tt){var ze=ge[ye.name],dt=ze.deferredOperations.pop();if(dt)return dt.reject(tt),dt.promise}function Qe(ye,tt){return new V(function(ze,dt){if(ge[ye.name]=ge[ye.name]||oi(),ye.db)if(tt)ke(ye),ye.db.close();else return ze(ye.db);var mt=[ye.name];tt&&mt.push(ye.version);var ut=S.open.apply(S,mt);tt&&(ut.onupgradeneeded=function($t){var rn=ut.result;try{rn.createObjectStore(ye.storeName),$t.oldVersion<=1&&rn.createObjectStore(Ue)}catch(cn){if(cn.name==="ConstraintError")console.warn('The database "'+ye.name+'" has been upgraded from version '+$t.oldVersion+" to version "+$t.newVersion+', but the storage "'+ye.storeName+'" already exists.');else throw cn}}),ut.onerror=function($t){$t.preventDefault(),dt(ut.error)},ut.onsuccess=function(){var $t=ut.result;$t.onversionchange=function(rn){rn.target.close()},ze($t),Ve(ye)}})}function Be(ye){return Qe(ye,!1)}function Hn(ye){return Qe(ye,!0)}function Ln(ye,tt){if(!ye.db)return!0;var ze=!ye.db.objectStoreNames.contains(ye.storeName),dt=ye.version<ye.db.version,mt=ye.version>ye.db.version;if(dt&&(ye.version!==tt&&console.warn('The database "'+ye.name+`" can't be downgraded from version `+ye.db.version+" to version "+ye.version+"."),ye.version=ye.db.version),mt||ze){if(ze){var ut=ye.db.version+1;ut>ye.version&&(ye.version=ut)}return!0}return!1}function ii(ye){return new V(function(tt,ze){var dt=new FileReader;dt.onerror=ze,dt.onloadend=function(mt){var ut=btoa(mt.target.result||"");tt({__local_forage_encoded_blob:!0,data:ut,type:ye.type})},dt.readAsBinaryString(ye)})}function Ii(ye){var tt=nt(atob(ye.data));return N([tt],{type:ye.type})}function vn(ye){return ye&&ye.__local_forage_encoded_blob}function Vn(ye){var tt=this,ze=tt._initReady().then(function(){var dt=ge[tt._dbInfo.name];if(dt&&dt.dbReady)return dt.dbReady});return Q(ze,ye,ye),ze}function je(ye){ke(ye);for(var tt=ge[ye.name],ze=tt.forages,dt=0;dt<ze.length;dt++){var mt=ze[dt];mt._dbInfo.db&&(mt._dbInfo.db.close(),mt._dbInfo.db=null)}return ye.db=null,Be(ye).then(function(ut){return ye.db=ut,Ln(ye)?Hn(ye):ut}).then(function(ut){ye.db=tt.db=ut;for(var $t=0;$t<ze.length;$t++)ze[$t]._dbInfo.db=ut}).catch(function(ut){throw De(ye,ut),ut})}function Pn(ye,tt,ze,dt){dt===void 0&&(dt=1);try{var mt=ye.db.transaction(ye.storeName,tt);ze(null,mt)}catch(ut){if(dt>0&&(!ye.db||ut.name==="InvalidStateError"||ut.name==="NotFoundError"))return V.resolve().then(function(){if(!ye.db||ut.name==="NotFoundError"&&!ye.db.objectStoreNames.contains(ye.storeName)&&ye.version<=ye.db.version)return ye.db&&(ye.version=ye.db.version+1),Hn(ye)}).then(function(){return je(ye).then(function(){Pn(ye,tt,ze,dt-1)})}).catch(ze);ze(ut)}}function oi(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function et(ye){var tt=this,ze={db:null};if(ye)for(var dt in ye)ze[dt]=ye[dt];var mt=ge[ze.name];mt||(mt=oi(),ge[ze.name]=mt),mt.forages.push(tt),tt._initReady||(tt._initReady=tt.ready,tt.ready=Vn);var ut=[];function $t(){return V.resolve()}for(var rn=0;rn<mt.forages.length;rn++){var cn=mt.forages[rn];cn!==tt&&ut.push(cn._initReady().catch($t))}var un=mt.forages.slice(0);return V.all(ut).then(function(){return ze.db=mt.db,Be(ze)}).then(function(fn){return ze.db=fn,Ln(ze,tt._defaultConfig.version)?Hn(ze):fn}).then(function(fn){ze.db=mt.db=fn,tt._dbInfo=ze;for(var Mn=0;Mn<un.length;Mn++){var ui=un[Mn];ui!==tt&&(ui._dbInfo.db=ze.db,ui._dbInfo.version=ze.version)}})}function Xr(ye,tt){var ze=this;ye=oe(ye);var dt=new V(function(mt,ut){ze.ready().then(function(){Pn(ze._dbInfo,_t,function($t,rn){if($t)return ut($t);try{var cn=rn.objectStore(ze._dbInfo.storeName),un=cn.get(ye);un.onsuccess=function(){var fn=un.result;fn===void 0&&(fn=null),vn(fn)&&(fn=Ii(fn)),mt(fn)},un.onerror=function(){ut(un.error)}}catch(fn){ut(fn)}})}).catch(ut)});return j(dt,tt),dt}function Kr(ye,tt){var ze=this,dt=new V(function(mt,ut){ze.ready().then(function(){Pn(ze._dbInfo,_t,function($t,rn){if($t)return ut($t);try{var cn=rn.objectStore(ze._dbInfo.storeName),un=cn.openCursor(),fn=1;un.onsuccess=function(){var Mn=un.result;if(Mn){var ui=Mn.value;vn(ui)&&(ui=Ii(ui));var jn=ye(ui,Mn.key,fn++);jn!==void 0?mt(jn):Mn.continue()}else mt()},un.onerror=function(){ut(un.error)}}catch(Mn){ut(Mn)}})}).catch(ut)});return j(dt,tt),dt}function qn(ye,tt,ze){var dt=this;ye=oe(ye);var mt=new V(function(ut,$t){var rn;dt.ready().then(function(){return rn=dt._dbInfo,Re.call(tt)==="[object Blob]"?xe(rn.db).then(function(cn){return cn?tt:ii(tt)}):tt}).then(function(cn){Pn(dt._dbInfo,ct,function(un,fn){if(un)return $t(un);try{var Mn=fn.objectStore(dt._dbInfo.storeName);cn===null&&(cn=void 0);var ui=Mn.put(cn,ye);fn.oncomplete=function(){cn===void 0&&(cn=null),ut(cn)},fn.onabort=fn.onerror=function(){var jn=ui.error?ui.error:ui.transaction.error;$t(jn)}}catch(jn){$t(jn)}})}).catch($t)});return j(mt,ze),mt}function zi(ye,tt){var ze=this;ye=oe(ye);var dt=new V(function(mt,ut){ze.ready().then(function(){Pn(ze._dbInfo,ct,function($t,rn){if($t)return ut($t);try{var cn=rn.objectStore(ze._dbInfo.storeName),un=cn.delete(ye);rn.oncomplete=function(){mt()},rn.onerror=function(){ut(un.error)},rn.onabort=function(){var fn=un.error?un.error:un.transaction.error;ut(fn)}}catch(fn){ut(fn)}})}).catch(ut)});return j(dt,tt),dt}function ar(ye){var tt=this,ze=new V(function(dt,mt){tt.ready().then(function(){Pn(tt._dbInfo,ct,function(ut,$t){if(ut)return mt(ut);try{var rn=$t.objectStore(tt._dbInfo.storeName),cn=rn.clear();$t.oncomplete=function(){dt()},$t.onabort=$t.onerror=function(){var un=cn.error?cn.error:cn.transaction.error;mt(un)}}catch(un){mt(un)}})}).catch(mt)});return j(ze,ye),ze}function rs(ye){var tt=this,ze=new V(function(dt,mt){tt.ready().then(function(){Pn(tt._dbInfo,_t,function(ut,$t){if(ut)return mt(ut);try{var rn=$t.objectStore(tt._dbInfo.storeName),cn=rn.count();cn.onsuccess=function(){dt(cn.result)},cn.onerror=function(){mt(cn.error)}}catch(un){mt(un)}})}).catch(mt)});return j(ze,ye),ze}function Wi(ye,tt){var ze=this,dt=new V(function(mt,ut){if(ye<0){mt(null);return}ze.ready().then(function(){Pn(ze._dbInfo,_t,function($t,rn){if($t)return ut($t);try{var cn=rn.objectStore(ze._dbInfo.storeName),un=!1,fn=cn.openKeyCursor();fn.onsuccess=function(){var Mn=fn.result;if(!Mn){mt(null);return}ye===0||un?mt(Mn.key):(un=!0,Mn.advance(ye))},fn.onerror=function(){ut(fn.error)}}catch(Mn){ut(Mn)}})}).catch(ut)});return j(dt,tt),dt}function $s(ye){var tt=this,ze=new V(function(dt,mt){tt.ready().then(function(){Pn(tt._dbInfo,_t,function(ut,$t){if(ut)return mt(ut);try{var rn=$t.objectStore(tt._dbInfo.storeName),cn=rn.openKeyCursor(),un=[];cn.onsuccess=function(){var fn=cn.result;if(!fn){dt(un);return}un.push(fn.key),fn.continue()},cn.onerror=function(){mt(cn.error)}}catch(fn){mt(fn)}})}).catch(mt)});return j(ze,ye),ze}function Po(ye,tt){tt=me.apply(this,arguments);var ze=this.config();ye=typeof ye!="function"&&ye||{},ye.name||(ye.name=ye.name||ze.name,ye.storeName=ye.storeName||ze.storeName);var dt=this,mt;if(!ye.name)mt=V.reject("Invalid arguments");else{var ut=ye.name===ze.name&&dt._dbInfo.db,$t=ut?V.resolve(dt._dbInfo.db):Be(ye).then(function(rn){var cn=ge[ye.name],un=cn.forages;cn.db=rn;for(var fn=0;fn<un.length;fn++)un[fn]._dbInfo.db=rn;return rn});ye.storeName?mt=$t.then(function(rn){if(rn.objectStoreNames.contains(ye.storeName)){var cn=rn.version+1;ke(ye);var un=ge[ye.name],fn=un.forages;rn.close();for(var Mn=0;Mn<fn.length;Mn++){var ui=fn[Mn];ui._dbInfo.db=null,ui._dbInfo.version=cn}var jn=new V(function(Fi,pr){var Ar=S.open(ye.name,cn);Ar.onerror=function(cs){var sa=Ar.result;sa.close(),pr(cs)},Ar.onupgradeneeded=function(){var cs=Ar.result;cs.deleteObjectStore(ye.storeName)},Ar.onsuccess=function(){var cs=Ar.result;cs.close(),Fi(cs)}});return jn.then(function(Fi){un.db=Fi;for(var pr=0;pr<fn.length;pr++){var Ar=fn[pr];Ar._dbInfo.db=Fi,Ve(Ar._dbInfo)}}).catch(function(Fi){throw(De(ye,Fi)||V.resolve()).catch(function(){}),Fi})}}):mt=$t.then(function(rn){ke(ye);var cn=ge[ye.name],un=cn.forages;rn.close();for(var fn=0;fn<un.length;fn++){var Mn=un[fn];Mn._dbInfo.db=null}var ui=new V(function(jn,Fi){var pr=S.deleteDatabase(ye.name);pr.onerror=function(){var Ar=pr.result;Ar&&Ar.close(),Fi(pr.error)},pr.onblocked=function(){console.warn('dropInstance blocked for database "'+ye.name+'" until all open connections are closed')},pr.onsuccess=function(){var Ar=pr.result;Ar&&Ar.close(),jn(Ar)}});return ui.then(function(jn){cn.db=jn;for(var Fi=0;Fi<un.length;Fi++){var pr=un[Fi];Ve(pr._dbInfo)}}).catch(function(jn){throw(De(ye,jn)||V.resolve()).catch(function(){}),jn})})}return j(mt,tt),mt}var Ea={_driver:"asyncStorage",_initStorage:et,_support:P(),iterate:Kr,getItem:Xr,setItem:qn,removeItem:zi,clear:ar,length:rs,key:Wi,keys:$s,dropInstance:Po};function Hs(){return typeof openDatabase=="function"}var Vi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ts="~~local_forage_type~",Ro=/^~~local_forage_type~([^~]+)~/,ia="__lfsc__:",Qs=ia.length,ds="arbf",Es="blob",ko="si08",io="ui08",Mo="uic8",ra="si16",Dt="si32",Qt="ur16",ai="ui32",vi="fl32",er="fl64",wr=Qs+ds.length,Ur=Object.prototype.toString;function fs(ye){var tt=ye.length*.75,ze=ye.length,dt,mt=0,ut,$t,rn,cn;ye[ye.length-1]==="="&&(tt--,ye[ye.length-2]==="="&&tt--);var un=new ArrayBuffer(tt),fn=new Uint8Array(un);for(dt=0;dt<ze;dt+=4)ut=Vi.indexOf(ye[dt]),$t=Vi.indexOf(ye[dt+1]),rn=Vi.indexOf(ye[dt+2]),cn=Vi.indexOf(ye[dt+3]),fn[mt++]=ut<<2|$t>>4,fn[mt++]=($t&15)<<4|rn>>2,fn[mt++]=(rn&3)<<6|cn&63;return un}function Ds(ye){var tt=new Uint8Array(ye),ze="",dt;for(dt=0;dt<tt.length;dt+=3)ze+=Vi[tt[dt]>>2],ze+=Vi[(tt[dt]&3)<<4|tt[dt+1]>>4],ze+=Vi[(tt[dt+1]&15)<<2|tt[dt+2]>>6],ze+=Vi[tt[dt+2]&63];return tt.length%3===2?ze=ze.substring(0,ze.length-1)+"=":tt.length%3===1&&(ze=ze.substring(0,ze.length-2)+"=="),ze}function qs(ye,tt){var ze="";if(ye&&(ze=Ur.call(ye)),ye&&(ze==="[object ArrayBuffer]"||ye.buffer&&Ur.call(ye.buffer)==="[object ArrayBuffer]")){var dt,mt=ia;ye instanceof ArrayBuffer?(dt=ye,mt+=ds):(dt=ye.buffer,ze==="[object Int8Array]"?mt+=ko:ze==="[object Uint8Array]"?mt+=io:ze==="[object Uint8ClampedArray]"?mt+=Mo:ze==="[object Int16Array]"?mt+=ra:ze==="[object Uint16Array]"?mt+=Qt:ze==="[object Int32Array]"?mt+=Dt:ze==="[object Uint32Array]"?mt+=ai:ze==="[object Float32Array]"?mt+=vi:ze==="[object Float64Array]"?mt+=er:tt(new Error("Failed to get type for BinaryArray"))),tt(mt+Ds(dt))}else if(ze==="[object Blob]"){var ut=new FileReader;ut.onload=function(){var $t=Ts+ye.type+"~"+Ds(this.result);tt(ia+Es+$t)},ut.readAsArrayBuffer(ye)}else try{tt(JSON.stringify(ye))}catch($t){console.error("Couldn't convert value into a JSON string: ",ye),tt(null,$t)}}function ss(ye){if(ye.substring(0,Qs)!==ia)return JSON.parse(ye);var tt=ye.substring(wr),ze=ye.substring(Qs,wr),dt;if(ze===Es&&Ro.test(tt)){var mt=tt.match(Ro);dt=mt[1],tt=tt.substring(mt[0].length)}var ut=fs(tt);switch(ze){case ds:return ut;case Es:return N([ut],{type:dt});case ko:return new Int8Array(ut);case io:return new Uint8Array(ut);case Mo:return new Uint8ClampedArray(ut);case ra:return new Int16Array(ut);case Qt:return new Uint16Array(ut);case Dt:return new Int32Array(ut);case ai:return new Uint32Array(ut);case vi:return new Float32Array(ut);case er:return new Float64Array(ut);default:throw new Error("Unkown type: "+ze)}}var Js={serialize:qs,deserialize:ss,stringToBuffer:fs,bufferToString:Ds};function mi(ye,tt,ze,dt){ye.executeSql("CREATE TABLE IF NOT EXISTS "+tt.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],ze,dt)}function Ll(ye){var tt=this,ze={db:null};if(ye)for(var dt in ye)ze[dt]=typeof ye[dt]!="string"?ye[dt].toString():ye[dt];var mt=new V(function(ut,$t){try{ze.db=openDatabase(ze.name,String(ze.version),ze.description,ze.size)}catch(rn){return $t(rn)}ze.db.transaction(function(rn){mi(rn,ze,function(){tt._dbInfo=ze,ut()},function(cn,un){$t(un)})},$t)});return ze.serializer=Js,mt}function vo(ye,tt,ze,dt,mt,ut){ye.executeSql(ze,dt,mt,function($t,rn){rn.code===rn.SYNTAX_ERR?$t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[tt.storeName],function(cn,un){un.rows.length?ut(cn,rn):mi(cn,tt,function(){cn.executeSql(ze,dt,mt,ut)},ut)},ut):ut($t,rn)},ut)}function Bs(ye,tt){var ze=this;ye=oe(ye);var dt=new V(function(mt,ut){ze.ready().then(function(){var $t=ze._dbInfo;$t.db.transaction(function(rn){vo(rn,$t,"SELECT * FROM "+$t.storeName+" WHERE key = ? LIMIT 1",[ye],function(cn,un){var fn=un.rows.length?un.rows.item(0).value:null;fn&&(fn=$t.serializer.deserialize(fn)),mt(fn)},function(cn,un){ut(un)})})}).catch(ut)});return j(dt,tt),dt}function dl(ye,tt){var ze=this,dt=new V(function(mt,ut){ze.ready().then(function(){var $t=ze._dbInfo;$t.db.transaction(function(rn){vo(rn,$t,"SELECT * FROM "+$t.storeName,[],function(cn,un){for(var fn=un.rows,Mn=fn.length,ui=0;ui<Mn;ui++){var jn=fn.item(ui),Fi=jn.value;if(Fi&&(Fi=$t.serializer.deserialize(Fi)),Fi=ye(Fi,jn.key,ui+1),Fi!==void 0){mt(Fi);return}}mt()},function(cn,un){ut(un)})})}).catch(ut)});return j(dt,tt),dt}function Ol(ye,tt,ze,dt){var mt=this;ye=oe(ye);var ut=new V(function($t,rn){mt.ready().then(function(){tt===void 0&&(tt=null);var cn=tt,un=mt._dbInfo;un.serializer.serialize(tt,function(fn,Mn){Mn?rn(Mn):un.db.transaction(function(ui){vo(ui,un,"INSERT OR REPLACE INTO "+un.storeName+" (key, value) VALUES (?, ?)",[ye,fn],function(){$t(cn)},function(jn,Fi){rn(Fi)})},function(ui){if(ui.code===ui.QUOTA_ERR){if(dt>0){$t(Ol.apply(mt,[ye,cn,ze,dt-1]));return}rn(ui)}})})}).catch(rn)});return j(ut,ze),ut}function Do(ye,tt,ze){return Ol.apply(this,[ye,tt,ze,1])}function bt(ye,tt){var ze=this;ye=oe(ye);var dt=new V(function(mt,ut){ze.ready().then(function(){var $t=ze._dbInfo;$t.db.transaction(function(rn){vo(rn,$t,"DELETE FROM "+$t.storeName+" WHERE key = ?",[ye],function(){mt()},function(cn,un){ut(un)})})}).catch(ut)});return j(dt,tt),dt}function Lo(ye){var tt=this,ze=new V(function(dt,mt){tt.ready().then(function(){var ut=tt._dbInfo;ut.db.transaction(function($t){vo($t,ut,"DELETE FROM "+ut.storeName,[],function(){dt()},function(rn,cn){mt(cn)})})}).catch(mt)});return j(ze,ye),ze}function zc(ye){var tt=this,ze=new V(function(dt,mt){tt.ready().then(function(){var ut=tt._dbInfo;ut.db.transaction(function($t){vo($t,ut,"SELECT COUNT(key) as c FROM "+ut.storeName,[],function(rn,cn){var un=cn.rows.item(0).c;dt(un)},function(rn,cn){mt(cn)})})}).catch(mt)});return j(ze,ye),ze}function Ia(ye,tt){var ze=this,dt=new V(function(mt,ut){ze.ready().then(function(){var $t=ze._dbInfo;$t.db.transaction(function(rn){vo(rn,$t,"SELECT key FROM "+$t.storeName+" WHERE id = ? LIMIT 1",[ye+1],function(cn,un){var fn=un.rows.length?un.rows.item(0).key:null;mt(fn)},function(cn,un){ut(un)})})}).catch(ut)});return j(dt,tt),dt}function fi(ye){var tt=this,ze=new V(function(dt,mt){tt.ready().then(function(){var ut=tt._dbInfo;ut.db.transaction(function($t){vo($t,ut,"SELECT key FROM "+ut.storeName,[],function(rn,cn){for(var un=[],fn=0;fn<cn.rows.length;fn++)un.push(cn.rows.item(fn).key);dt(un)},function(rn,cn){mt(cn)})})}).catch(mt)});return j(ze,ye),ze}function Ge(ye){return new V(function(tt,ze){ye.transaction(function(dt){dt.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(mt,ut){for(var $t=[],rn=0;rn<ut.rows.length;rn++)$t.push(ut.rows.item(rn).name);tt({db:ye,storeNames:$t})},function(mt,ut){ze(ut)})},function(dt){ze(dt)})})}function Y(ye,tt){tt=me.apply(this,arguments);var ze=this.config();ye=typeof ye!="function"&&ye||{},ye.name||(ye.name=ye.name||ze.name,ye.storeName=ye.storeName||ze.storeName);var dt=this,mt;return ye.name?mt=new V(function(ut){var $t;ye.name===ze.name?$t=dt._dbInfo.db:$t=openDatabase(ye.name,"","",0),ye.storeName?ut({db:$t,storeNames:[ye.storeName]}):ut(Ge($t))}).then(function(ut){return new V(function($t,rn){ut.db.transaction(function(cn){function un(jn){return new V(function(Fi,pr){cn.executeSql("DROP TABLE IF EXISTS "+jn,[],function(){Fi()},function(Ar,cs){pr(cs)})})}for(var fn=[],Mn=0,ui=ut.storeNames.length;Mn<ui;Mn++)fn.push(un(ut.storeNames[Mn]));V.all(fn).then(function(){$t()}).catch(function(jn){rn(jn)})},function(cn){rn(cn)})})}):mt=V.reject("Invalid arguments"),j(mt,tt),mt}var J={_driver:"webSQLStorage",_initStorage:Ll,_support:Hs(),iterate:dl,getItem:Bs,setItem:Do,removeItem:bt,clear:Lo,length:zc,key:Ia,keys:fi,dropInstance:Y};function le(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Ie(ye,tt){var ze=ye.name+"/";return ye.storeName!==tt.storeName&&(ze+=ye.storeName+"/"),ze}function he(){var ye="_localforage_support_test";try{return localStorage.setItem(ye,!0),localStorage.removeItem(ye),!1}catch{return!0}}function Me(){return!he()||localStorage.length>0}function Je(ye){var tt=this,ze={};if(ye)for(var dt in ye)ze[dt]=ye[dt];return ze.keyPrefix=Ie(ye,tt._defaultConfig),Me()?(tt._dbInfo=ze,ze.serializer=Js,V.resolve()):V.reject()}function Fe(ye){var tt=this,ze=tt.ready().then(function(){for(var dt=tt._dbInfo.keyPrefix,mt=localStorage.length-1;mt>=0;mt--){var ut=localStorage.key(mt);ut.indexOf(dt)===0&&localStorage.removeItem(ut)}});return j(ze,ye),ze}function Xe(ye,tt){var ze=this;ye=oe(ye);var dt=ze.ready().then(function(){var mt=ze._dbInfo,ut=localStorage.getItem(mt.keyPrefix+ye);return ut&&(ut=mt.serializer.deserialize(ut)),ut});return j(dt,tt),dt}function Pt(ye,tt){var ze=this,dt=ze.ready().then(function(){for(var mt=ze._dbInfo,ut=mt.keyPrefix,$t=ut.length,rn=localStorage.length,cn=1,un=0;un<rn;un++){var fn=localStorage.key(un);if(fn.indexOf(ut)===0){var Mn=localStorage.getItem(fn);if(Mn&&(Mn=mt.serializer.deserialize(Mn)),Mn=ye(Mn,fn.substring($t),cn++),Mn!==void 0)return Mn}}});return j(dt,tt),dt}function pt(ye,tt){var ze=this,dt=ze.ready().then(function(){var mt=ze._dbInfo,ut;try{ut=localStorage.key(ye)}catch{ut=null}return ut&&(ut=ut.substring(mt.keyPrefix.length)),ut});return j(dt,tt),dt}function sn(ye){var tt=this,ze=tt.ready().then(function(){for(var dt=tt._dbInfo,mt=localStorage.length,ut=[],$t=0;$t<mt;$t++){var rn=localStorage.key($t);rn.indexOf(dt.keyPrefix)===0&&ut.push(rn.substring(dt.keyPrefix.length))}return ut});return j(ze,ye),ze}function _n(ye){var tt=this,ze=tt.keys().then(function(dt){return dt.length});return j(ze,ye),ze}function Cn(ye,tt){var ze=this;ye=oe(ye);var dt=ze.ready().then(function(){var mt=ze._dbInfo;localStorage.removeItem(mt.keyPrefix+ye)});return j(dt,tt),dt}function Qn(ye,tt,ze){var dt=this;ye=oe(ye);var mt=dt.ready().then(function(){tt===void 0&&(tt=null);var ut=tt;return new V(function($t,rn){var cn=dt._dbInfo;cn.serializer.serialize(tt,function(un,fn){if(fn)rn(fn);else try{localStorage.setItem(cn.keyPrefix+ye,un),$t(ut)}catch(Mn){(Mn.name==="QuotaExceededError"||Mn.name==="NS_ERROR_DOM_QUOTA_REACHED")&&rn(Mn),rn(Mn)}})})});return j(mt,ze),mt}function Nn(ye,tt){if(tt=me.apply(this,arguments),ye=typeof ye!="function"&&ye||{},!ye.name){var ze=this.config();ye.name=ye.name||ze.name,ye.storeName=ye.storeName||ze.storeName}var dt=this,mt;return ye.name?mt=new V(function(ut){ye.storeName?ut(Ie(ye,dt._defaultConfig)):ut(ye.name+"/")}).then(function(ut){for(var $t=localStorage.length-1;$t>=0;$t--){var rn=localStorage.key($t);rn.indexOf(ut)===0&&localStorage.removeItem(rn)}}):mt=V.reject("Invalid arguments"),j(mt,tt),mt}var Jn={_driver:"localStorageWrapper",_initStorage:Je,_support:le(),iterate:Pt,getItem:Xe,setItem:Qn,removeItem:Cn,clear:Fe,length:_n,key:pt,keys:sn,dropInstance:Nn},Ui=function(tt,ze){return tt===ze||typeof tt=="number"&&typeof ze=="number"&&isNaN(tt)&&isNaN(ze)},ni=function(tt,ze){for(var dt=tt.length,mt=0;mt<dt;){if(Ui(tt[mt],ze))return!0;mt++}return!1},br=Array.isArray||function(ye){return Object.prototype.toString.call(ye)==="[object Array]"},Tr={},jr={},gi={INDEXEDDB:Ea,WEBSQL:J,LOCALSTORAGE:Jn},ci=[gi.INDEXEDDB._driver,gi.WEBSQL._driver,gi.LOCALSTORAGE._driver],ji=["dropInstance"],tr=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ji),cr={description:"",driver:ci.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ls(ye,tt){ye[tt]=function(){var ze=arguments;return ye.ready().then(function(){return ye[tt].apply(ye,ze)})}}function Ls(){for(var ye=1;ye<arguments.length;ye++){var tt=arguments[ye];if(tt)for(var ze in tt)tt.hasOwnProperty(ze)&&(br(tt[ze])?arguments[0][ze]=tt[ze].slice():arguments[0][ze]=tt[ze])}return arguments[0]}var Os=function(){function ye(tt){v(this,ye);for(var ze in gi)if(gi.hasOwnProperty(ze)){var dt=gi[ze],mt=dt._driver;this[ze]=mt,Tr[mt]||this.defineDriver(dt)}this._defaultConfig=Ls({},cr),this._config=Ls({},this._defaultConfig,tt),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return ye.prototype.config=function(ze){if((typeof ze>"u"?"undefined":m(ze))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var dt in ze){if(dt==="storeName"&&(ze[dt]=ze[dt].replace(/\W/g,"_")),dt==="version"&&typeof ze[dt]!="number")return new Error("Database version must be a number.");this._config[dt]=ze[dt]}return"driver"in ze&&ze.driver?this.setDriver(this._config.driver):!0}else return typeof ze=="string"?this._config[ze]:this._config},ye.prototype.defineDriver=function(ze,dt,mt){var ut=new V(function($t,rn){try{var cn=ze._driver,un=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!ze._driver){rn(un);return}for(var fn=tr.concat("_initStorage"),Mn=0,ui=fn.length;Mn<ui;Mn++){var jn=fn[Mn],Fi=!ni(ji,jn);if((Fi||ze[jn])&&typeof ze[jn]!="function"){rn(un);return}}var pr=function(){for(var sa=function(Is){return function(){var ro=new Error("Method "+Is+" is not implemented by the current driver"),pl=V.reject(ro);return j(pl,arguments[arguments.length-1]),pl}},Sa=0,zl=ji.length;Sa<zl;Sa++){var oc=ji[Sa];ze[oc]||(ze[oc]=sa(oc))}};pr();var Ar=function(sa){Tr[cn]&&console.info("Redefining LocalForage driver: "+cn),Tr[cn]=ze,jr[cn]=sa,$t()};"_support"in ze?ze._support&&typeof ze._support=="function"?ze._support().then(Ar,rn):Ar(!!ze._support):Ar(!0)}catch(cs){rn(cs)}});return Q(ut,dt,mt),ut},ye.prototype.driver=function(){return this._driver||null},ye.prototype.getDriver=function(ze,dt,mt){var ut=Tr[ze]?V.resolve(Tr[ze]):V.reject(new Error("Driver not found."));return Q(ut,dt,mt),ut},ye.prototype.getSerializer=function(ze){var dt=V.resolve(Js);return Q(dt,ze),dt},ye.prototype.ready=function(ze){var dt=this,mt=dt._driverSet.then(function(){return dt._ready===null&&(dt._ready=dt._initDriver()),dt._ready});return Q(mt,ze,ze),mt},ye.prototype.setDriver=function(ze,dt,mt){var ut=this;br(ze)||(ze=[ze]);var $t=this._getSupportedDrivers(ze);function rn(){ut._config.driver=ut.driver()}function cn(Mn){return ut._extend(Mn),rn(),ut._ready=ut._initStorage(ut._config),ut._ready}function un(Mn){return function(){var ui=0;function jn(){for(;ui<Mn.length;){var Fi=Mn[ui];return ui++,ut._dbInfo=null,ut._ready=null,ut.getDriver(Fi).then(cn).catch(jn)}rn();var pr=new Error("No available storage method found.");return ut._driverSet=V.reject(pr),ut._driverSet}return jn()}}var fn=this._driverSet!==null?this._driverSet.catch(function(){return V.resolve()}):V.resolve();return this._driverSet=fn.then(function(){var Mn=$t[0];return ut._dbInfo=null,ut._ready=null,ut.getDriver(Mn).then(function(ui){ut._driver=ui._driver,rn(),ut._wrapLibraryMethodsWithReady(),ut._initDriver=un($t)})}).catch(function(){rn();var Mn=new Error("No available storage method found.");return ut._driverSet=V.reject(Mn),ut._driverSet}),Q(this._driverSet,dt,mt),this._driverSet},ye.prototype.supports=function(ze){return!!jr[ze]},ye.prototype._extend=function(ze){Ls(this,ze)},ye.prototype._getSupportedDrivers=function(ze){for(var dt=[],mt=0,ut=ze.length;mt<ut;mt++){var $t=ze[mt];this.supports($t)&&dt.push($t)}return dt},ye.prototype._wrapLibraryMethodsWithReady=function(){for(var ze=0,dt=tr.length;ze<dt;ze++)ls(this,tr[ze])},ye.prototype.createInstance=function(ze){return new ye(ze)},ye}(),fl=new Os;a.exports=fl},{3:3}]},{},[4])(4)})})(Cj);var Ioe=Cj.exports;const GN=tT(Ioe),Soe="events_cache_v1";function Aoe(t){const[e,n]=yt.useState([]),[a,h]=yt.useState(!0),[m,v]=yt.useState(null),o=yt.useMemo(()=>`${Soe}:${t||"all"}`,[t]),S=yt.useMemo(()=>{const j=kF(cg,"events");return t?zF(j,Zee("participants","array-contains",t),FF("start")):zF(j,FF("start"))},[t]);yt.useEffect(()=>{h(!0),v(null);let j=null,Q=!1;return(async()=>{try{const oe=await GN.getItem(o);!Q&&oe&&n(oe)}catch(oe){console.warn("cache read",oe)}try{j=ete(S,oe=>{if(Q)return;const me=oe.docs.map(Ue=>({id:Ue.id,...Ue.data()}));n(me),GN.setItem(o,me).catch(()=>{}),h(!1)},oe=>{Q||(console.error(oe),v(oe.message),h(!1))})}catch(oe){if(Q)return;console.error(oe),v(oe.message),h(!1)}})(),()=>{Q=!0,typeof j=="function"&&j()}},[S,o]);const P=yt.useCallback(async j=>{await Jee(kF(cg,"events"),{...j,createdAt:nte()})},[]),N=yt.useCallback(async(j,Q)=>{await LC(Ex(cg,"events",j),Q)},[]),V=yt.useCallback(async j=>{await Qee(Ex(cg,"events",j))},[]);return{events:e,loading:a,error:m,addEvent:P,updateEvent:N,removeEvent:V}}var Pj={exports:{}};(function(t,e){(function(n,a){t.exports=a()})(th,function(){var n,a,h;function m(o,S){if(!n)n=S;else if(!a)a=S;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",N={};n(N),h=S(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}m(["exports"],function(o){var S=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function N(l,i){var s=i[0],u=i[1],d=i[2],g=i[3],_=s*g-d*u;return _?(l[0]=g*(_=1/_),l[1]=-u*_,l[2]=-d*_,l[3]=s*_,l):null}function V(){var l=new P(9);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function j(l,i){var s=i[0],u=i[1],d=i[2],g=i[3],_=i[4],w=i[5],T=i[6],E=i[7],C=i[8];return l[0]=_*C-w*E,l[1]=d*E-u*C,l[2]=u*w-d*_,l[3]=w*T-g*C,l[4]=s*C-d*T,l[5]=d*g-s*w,l[6]=g*E-_*T,l[7]=u*T-s*E,l[8]=s*_-u*g,l}function Q(l,i,s){var u=i[0],d=i[1],g=i[2],_=i[3],w=i[4],T=i[5],E=i[6],C=i[7],R=i[8],M=s[0],z=s[1],F=s[2],G=s[3],H=s[4],K=s[5],ie=s[6],ne=s[7],se=s[8];return l[0]=M*u+z*_+F*E,l[1]=M*d+z*w+F*C,l[2]=M*g+z*T+F*R,l[3]=G*u+H*_+K*E,l[4]=G*d+H*w+K*C,l[5]=G*g+H*T+K*R,l[6]=ie*u+ne*_+se*E,l[7]=ie*d+ne*w+se*C,l[8]=ie*g+ne*T+se*R,l}function oe(){var l=new P(16);return P!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function me(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Ue(l,i){var s=i[0],u=i[1],d=i[2],g=i[3],_=i[4],w=i[5],T=i[6],E=i[7],C=i[8],R=i[9],M=i[10],z=i[11],F=i[12],G=i[13],H=i[14],K=i[15],ie=s*w-u*_,ne=s*T-d*_,se=s*E-g*_,Se=u*T-d*w,we=u*E-g*w,Te=d*E-g*T,Oe=C*G-R*F,Ne=C*H-M*F,at=C*K-z*F,He=R*H-M*G,ht=R*K-z*G,Mt=M*K-z*H,gt=ie*Mt-ne*ht+se*He+Se*at-we*Ne+Te*Oe;return gt?(l[0]=(w*Mt-T*ht+E*He)*(gt=1/gt),l[1]=(d*ht-u*Mt-g*He)*gt,l[2]=(G*Te-H*we+K*Se)*gt,l[3]=(M*we-R*Te-z*Se)*gt,l[4]=(T*at-_*Mt-E*Ne)*gt,l[5]=(s*Mt-d*at+g*Ne)*gt,l[6]=(H*se-F*Te-K*ne)*gt,l[7]=(C*Te-M*se+z*ne)*gt,l[8]=(_*ht-w*at+E*Oe)*gt,l[9]=(u*at-s*ht-g*Oe)*gt,l[10]=(F*we-G*se+K*ie)*gt,l[11]=(R*se-C*we-z*ie)*gt,l[12]=(w*Ne-_*He-T*Oe)*gt,l[13]=(s*He-u*Ne+d*Oe)*gt,l[14]=(G*ne-F*Se-H*ie)*gt,l[15]=(C*Se-R*ne+M*ie)*gt,l):null}function de(l,i,s){var u=i[0],d=i[1],g=i[2],_=i[3],w=i[4],T=i[5],E=i[6],C=i[7],R=i[8],M=i[9],z=i[10],F=i[11],G=i[12],H=i[13],K=i[14],ie=i[15],ne=s[0],se=s[1],Se=s[2],we=s[3];return l[0]=ne*u+se*w+Se*R+we*G,l[1]=ne*d+se*T+Se*M+we*H,l[2]=ne*g+se*E+Se*z+we*K,l[3]=ne*_+se*C+Se*F+we*ie,l[4]=(ne=s[4])*u+(se=s[5])*w+(Se=s[6])*R+(we=s[7])*G,l[5]=ne*d+se*T+Se*M+we*H,l[6]=ne*g+se*E+Se*z+we*K,l[7]=ne*_+se*C+Se*F+we*ie,l[8]=(ne=s[8])*u+(se=s[9])*w+(Se=s[10])*R+(we=s[11])*G,l[9]=ne*d+se*T+Se*M+we*H,l[10]=ne*g+se*E+Se*z+we*K,l[11]=ne*_+se*C+Se*F+we*ie,l[12]=(ne=s[12])*u+(se=s[13])*w+(Se=s[14])*R+(we=s[15])*G,l[13]=ne*d+se*T+Se*M+we*H,l[14]=ne*g+se*E+Se*z+we*K,l[15]=ne*_+se*C+Se*F+we*ie,l}function ge(l,i,s){var u,d,g,_,w,T,E,C,R,M,z,F,G=s[0],H=s[1],K=s[2];return i===l?(l[12]=i[0]*G+i[4]*H+i[8]*K+i[12],l[13]=i[1]*G+i[5]*H+i[9]*K+i[13],l[14]=i[2]*G+i[6]*H+i[10]*K+i[14],l[15]=i[3]*G+i[7]*H+i[11]*K+i[15]):(d=i[1],g=i[2],_=i[3],w=i[4],T=i[5],E=i[6],C=i[7],R=i[8],M=i[9],z=i[10],F=i[11],l[0]=u=i[0],l[1]=d,l[2]=g,l[3]=_,l[4]=w,l[5]=T,l[6]=E,l[7]=C,l[8]=R,l[9]=M,l[10]=z,l[11]=F,l[12]=u*G+w*H+R*K+i[12],l[13]=d*G+T*H+M*K+i[13],l[14]=g*G+E*H+z*K+i[14],l[15]=_*G+C*H+F*K+i[15]),l}function Re(l,i,s){var u=s[0],d=s[1],g=s[2];return l[0]=i[0]*u,l[1]=i[1]*u,l[2]=i[2]*u,l[3]=i[3]*u,l[4]=i[4]*d,l[5]=i[5]*d,l[6]=i[6]*d,l[7]=i[7]*d,l[8]=i[8]*g,l[9]=i[9]*g,l[10]=i[10]*g,l[11]=i[11]*g,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l}function _t(l,i,s){var u=Math.sin(s),d=Math.cos(s),g=i[4],_=i[5],w=i[6],T=i[7],E=i[8],C=i[9],R=i[10],M=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=g*d+E*u,l[5]=_*d+C*u,l[6]=w*d+R*u,l[7]=T*d+M*u,l[8]=E*d-g*u,l[9]=C*d-_*u,l[10]=R*d-w*u,l[11]=M*d-T*u,l}function ct(l,i,s){var u=Math.sin(s),d=Math.cos(s),g=i[0],_=i[1],w=i[2],T=i[3],E=i[8],C=i[9],R=i[10],M=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=g*d-E*u,l[1]=_*d-C*u,l[2]=w*d-R*u,l[3]=T*d-M*u,l[8]=g*u+E*d,l[9]=_*u+C*d,l[10]=w*u+R*d,l[11]=T*u+M*d,l}function nt(l,i,s){var u=Math.sin(s),d=Math.cos(s),g=i[0],_=i[1],w=i[2],T=i[3],E=i[4],C=i[5],R=i[6],M=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=g*d+E*u,l[1]=_*d+C*u,l[2]=w*d+R*u,l[3]=T*d+M*u,l[4]=E*d-g*u,l[5]=C*d-_*u,l[6]=R*d-w*u,l[7]=M*d-T*u,l}function Pe(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function xe(l,i,s){var u,d,g,_=s[0],w=s[1],T=s[2],E=Math.hypot(_,w,T);return E<S?null:(_*=E=1/E,w*=E,T*=E,u=Math.sin(i),d=Math.cos(i),l[0]=_*_*(g=1-d)+d,l[1]=w*_*g+T*u,l[2]=T*_*g-w*u,l[3]=0,l[4]=_*w*g-T*u,l[5]=w*w*g+d,l[6]=T*w*g+_*u,l[7]=0,l[8]=_*T*g+w*u,l[9]=w*T*g-_*u,l[10]=T*T*g+d,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function ke(l,i){var s=i[0],u=i[1],d=i[2],g=i[3],_=s+s,w=u+u,T=d+d,E=s*_,C=u*_,R=u*w,M=d*_,z=d*w,F=d*T,G=g*_,H=g*w,K=g*T;return l[0]=1-R-F,l[1]=C+K,l[2]=M-H,l[3]=0,l[4]=C-K,l[5]=1-E-F,l[6]=z+G,l[7]=0,l[8]=M+H,l[9]=z-G,l[10]=1-E-R,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}Math.hypot||(Math.hypot=function(){for(var l=0,i=arguments.length;i--;)l+=arguments[i]*arguments[i];return Math.sqrt(l)});var Ve=de;function De(){var l=new P(3);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Qe(l){var i=new P(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i}function Be(l){return Math.hypot(l[0],l[1],l[2])}function Hn(l,i,s){var u=new P(3);return u[0]=l,u[1]=i,u[2]=s,u}function Ln(l,i,s,u){return l[0]=i,l[1]=s,l[2]=u,l}function ii(l,i,s){return l[0]=i[0]+s[0],l[1]=i[1]+s[1],l[2]=i[2]+s[2],l}function Ii(l,i,s){return l[0]=i[0]-s[0],l[1]=i[1]-s[1],l[2]=i[2]-s[2],l}function vn(l,i,s){return l[0]=i[0]*s[0],l[1]=i[1]*s[1],l[2]=i[2]*s[2],l}function Vn(l,i,s){return l[0]=Math.min(i[0],s[0]),l[1]=Math.min(i[1],s[1]),l[2]=Math.min(i[2],s[2]),l}function je(l,i,s){return l[0]=Math.max(i[0],s[0]),l[1]=Math.max(i[1],s[1]),l[2]=Math.max(i[2],s[2]),l}function Pn(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l[2]=i[2]*s,l}function oi(l,i,s,u){return l[0]=i[0]+s[0]*u,l[1]=i[1]+s[1]*u,l[2]=i[2]+s[2]*u,l}function et(l,i){var s=i[0]-l[0],u=i[1]-l[1],d=i[2]-l[2];return s*s+u*u+d*d}function Xr(l){var i=l[0],s=l[1],u=l[2];return i*i+s*s+u*u}function Kr(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l}function qn(l,i){var s=i[0],u=i[1],d=i[2],g=s*s+u*u+d*d;return g>0&&(g=1/Math.sqrt(g)),l[0]=i[0]*g,l[1]=i[1]*g,l[2]=i[2]*g,l}function zi(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]}function ar(l,i,s){var u=i[0],d=i[1],g=i[2],_=s[0],w=s[1],T=s[2];return l[0]=d*T-g*w,l[1]=g*_-u*T,l[2]=u*w-d*_,l}function rs(l,i,s,u){var d=i[0],g=i[1],_=i[2];return l[0]=d+u*(s[0]-d),l[1]=g+u*(s[1]-g),l[2]=_+u*(s[2]-_),l}function Wi(l,i,s){var u=i[0],d=i[1],g=i[2],_=s[3]*u+s[7]*d+s[11]*g+s[15];return l[0]=(s[0]*u+s[4]*d+s[8]*g+s[12])/(_=_||1),l[1]=(s[1]*u+s[5]*d+s[9]*g+s[13])/_,l[2]=(s[2]*u+s[6]*d+s[10]*g+s[14])/_,l}function $s(l,i,s){var u=i[0],d=i[1],g=i[2];return l[0]=u*s[0]+d*s[3]+g*s[6],l[1]=u*s[1]+d*s[4]+g*s[7],l[2]=u*s[2]+d*s[5]+g*s[8],l}function Po(l,i,s){var u=s[0],d=s[1],g=s[2],_=i[0],w=i[1],T=i[2],E=d*T-g*w,C=g*_-u*T,R=u*w-d*_,M=d*R-g*C,z=g*E-u*R,F=u*C-d*E,G=2*s[3];return C*=G,R*=G,z*=2,F*=2,l[0]=_+(E*=G)+(M*=2),l[1]=w+C+z,l[2]=T+R+F,l}function Ea(l){return l[0]=0,l[1]=0,l[2]=0,l}function Hs(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]}var Vi=Ii,Ts=vn,Ro=Be;function ia(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Qs(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l[2]=i[2]*s,l[3]=i[3]*s,l}function ds(l,i){var s=i[0],u=i[1],d=i[2],g=i[3],_=s*s+u*u+d*d+g*g;return _>0&&(_=1/Math.sqrt(_)),l[0]=s*_,l[1]=u*_,l[2]=d*_,l[3]=g*_,l}function Es(l,i,s){var u=i[0],d=i[1],g=i[2],_=i[3];return l[0]=s[0]*u+s[4]*d+s[8]*g+s[12]*_,l[1]=s[1]*u+s[5]*d+s[9]*g+s[13]*_,l[2]=s[2]*u+s[6]*d+s[10]*g+s[14]*_,l[3]=s[3]*u+s[7]*d+s[11]*g+s[15]*_,l}function ko(){var l=new P(4);return P!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function io(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function Mo(l,i,s){s*=.5;var u=i[0],d=i[1],g=i[2],_=i[3],w=Math.sin(s),T=Math.cos(s);return l[0]=u*T+_*w,l[1]=d*T+g*w,l[2]=g*T-d*w,l[3]=_*T-u*w,l}function ra(l,i,s){s*=.5;var u=i[0],d=i[1],g=i[2],_=i[3],w=Math.sin(s),T=Math.cos(s);return l[0]=u*T-g*w,l[1]=d*T+_*w,l[2]=g*T+u*w,l[3]=_*T-d*w,l}De(),ia();var Dt,Qt,ai,vi=ds,er=(Dt=De(),Qt=Hn(1,0,0),ai=Hn(0,1,0),function(l,i,s){var u=zi(i,s);return u<-.999999?(ar(Dt,Qt,i),Ro(Dt)<1e-6&&ar(Dt,ai,i),qn(Dt,Dt),function(d,g,_){_*=.5;var w=Math.sin(_);d[0]=w*g[0],d[1]=w*g[1],d[2]=w*g[2],d[3]=Math.cos(_)}(l,Dt,Math.PI),l):u>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(ar(Dt,i,s),l[0]=Dt[0],l[1]=Dt[1],l[2]=Dt[2],l[3]=1+u,vi(l,l))});function wr(){var l=new P(2);return P!=Float32Array&&(l[0]=0,l[1]=0),l}function Ur(l,i){var s=new P(2);return s[0]=l,s[1]=i,s}function fs(l,i,s){return l[0]=i[0]+s[0],l[1]=i[1]+s[1],l}function Ds(l,i,s){return l[0]=i[0]-s[0],l[1]=i[1]-s[1],l}function qs(l,i,s){return l[0]=i[0]*s,l[1]=i[1]*s,l}function ss(l){return Math.hypot(l[0],l[1])}function Js(l,i){var s=i[0],u=i[1],d=s*s+u*u;return d>0&&(d=1/Math.sqrt(d)),l[0]=i[0]*d,l[1]=i[1]*d,l}function mi(l,i){return l[0]*i[0]+l[1]*i[1]}ko(),ko(),V();var Ll,vo,Bs=Ds;function dl(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}wr();var Ol=function(){if(vo)return Ll;function l(i,s,u,d){this.cx=3*i,this.bx=3*(u-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=s,this.p2x=u,this.p2y=d}return vo=1,Ll=l,l.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,s){if(s===void 0&&(s=1e-6),i<0)return 0;if(i>1)return 1;for(var u=i,d=0;d<8;d++){var g=this.sampleCurveX(u)-i;if(Math.abs(g)<s)return u;var _=this.sampleCurveDerivativeX(u);if(Math.abs(_)<1e-6)break;u-=g/_}var w=0,T=1;for(u=i,d=0;d<20&&(g=this.sampleCurveX(u),!(Math.abs(g-i)<s));d++)i>g?w=u:T=u,u=.5*(T-w)+w;return u},solve:function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))}},Ll}(),Do=dl(Ol);function bt(l,i){this.x=l,this.y=i}function Lo(l,i){if(Array.isArray(l)){if(!Array.isArray(i)||l.length!==i.length)return!1;for(let s=0;s<l.length;s++)if(!Lo(l[s],i[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&i!==null){if(typeof i!="object"||Object.keys(l).length!==Object.keys(i).length)return!1;for(const s in l)if(!Lo(l[s],i[s]))return!1;return!0}return l===i}bt.prototype={clone(){return new bt(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,i){return this.clone()._rotateAround(l,i)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const i=l.x-this.x,s=l.y-this.y;return i*i+s*s},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,i){return Math.atan2(this.x*i-this.y*l,this.x*l+this.y*i)},_matMult(l){const i=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=i,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const i=Math.cos(l),s=Math.sin(l),u=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=u,this},_rotateAround(l,i){const s=Math.cos(l),u=Math.sin(l),d=i.y+u*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-u*(this.y-i.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:bt},bt.convert=function(l){if(l instanceof bt)return l;if(Array.isArray(l))return new bt(+l[0],+l[1]);if(l.x!==void 0&&l.y!==void 0)return new bt(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};const zc=Math.PI/180,Ia=180/Math.PI;function fi(l){return l*zc}function Ge(l){return l*Ia}const Y=[[0,0],[1,0],[1,1],[0,1]];function J(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,s=i*l;return 4*(l<.5?s:3*(l-i)+s-.75)}function le(l,i,s,u){const d=new Do(l,i,s,u);return function(g){return d.solve(g)}}const Ie=le(.25,.1,.25,1);function he(l,i,s){return Math.min(s,Math.max(i,l))}function Me(l,i,s){return(s=he((s-l)/(i-l),0,1))*s*(3-2*s)}function Je(l,i,s){const u=s-i,d=((l-i)%u+u)%u+i;return d===i?s:d}function Fe(l,i,s){if(!l.length)return s(null,[]);let u=l.length;const d=new Array(l.length);let g=null;l.forEach((_,w)=>{i(_,(T,E)=>{T&&(g=T),d[w]=E,--u==0&&s(g,d)})})}function Xe(l,...i){for(const s of i)for(const u in s)l[u]=s[u];return l}let Pt=1;function pt(){return Pt++}function sn(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function _n(l,i){l.forEach(s=>{i[s]&&(i[s]=i[s].bind(i))})}function Cn(l,i,s){const u={};for(const d in l)u[d]=i.call(this,l[d],d,l);return u}function Qn(l,i,s){const u={};for(const d in l)i.call(this,l[d],d,l)&&(u[d]=l[d]);return u}function Nn(l){return Array.isArray(l)?l.map(Nn):typeof l=="object"&&l?Cn(l,Nn):l}function Jn(l,i){for(let s=0;s<l.length;s++)if(i.indexOf(l[s])>=0)return!0;return!1}const Ui={};function ni(l){Ui[l]||(typeof console<"u"&&console.warn(l),Ui[l]=!0)}function br(l,i,s){return(s.y-l.y)*(i.x-l.x)>(i.y-l.y)*(s.x-l.x)}function Tr(l){let i=0;for(let s,u,d=0,g=l.length,_=g-1;d<g;_=d++)s=l[d],u=l[_],i+=(u.x-s.x)*(s.y+u.y);return i}function jr([l,i,s]){const u=fi(i+90),d=fi(s);return{x:l*Math.cos(u)*Math.sin(d),y:l*Math.sin(u)*Math.sin(d),z:l*Math.cos(d),azimuthal:i,polar:s}}function gi(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function ci(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,u,d,g)=>{const _=d||g;return i[u]=!_||_.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i}let ji=null;function tr(l,i){return[l[4*i],l[4*i+1],l[4*i+2],l[4*i+3]]}function cr(l,i,s,u){for(;i<s;){const d=i+s>>1;l[d]<u?i=d+1:s=d}return i}function ls(l,i,s,u){for(;i<s;){const d=i+s>>1;l[d]<=u?i=d+1:s=d}return i}function Ls(l){return l>0?1/(1.001-l):1+l}function Os(l){return l>0?1-1/(1.001-l):-l}function fl(l,i,s){return(l-i.min)*(s.max-s.min)/(i.max-i.min)+s.min}const ye={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ye.API_URL)return null;try{const l=new URL(ye.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function tt(l){return ye.API_URL_REGEX.test(l)}function ze(l){return ye.API_SPRITE_REGEX.test(l)}let dt,mt,ut,$t,rn,cn;function un(){return dt==null&&(dt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),dt}const fn={now:()=>$t!==void 0?$t:performance.now(),setNow(l){$t=l},restoreNow(){$t=void 0},frame(l){const i=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(l,i=0){const{width:s,height:u}=l;rn||(rn=document.createElement("canvas"));const d=rn.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(s>rn.width||u>rn.height)&&(rn.width=s,rn.height=u),d.clearRect(-i,-i,s+2*i,u+2*i),d.drawImage(l,0,0,s,u),d.getImageData(-i,-i,s+2*i,u+2*i)},resolveURL:l=>(mt||(mt=document.createElement("a")),mt.href=l,mt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ut==null&&(ut=window.matchMedia("(prefers-reduced-motion: reduce)")),ut.matches)},hasCanvasFingerprintNoise(){if(cn!==void 0)return cn;if(!un())return cn=!1,!1;const l=new OffscreenCanvas(85,1),i=l.getContext("2d",{willReadFrequently:!0});let s=0;for(let d=0;d<l.width;++d)i.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,i.fillRect(d,0,1,1);const u=i.getImageData(0,0,l.width,l.height);s=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&s++!==u.data[d])return cn=!0,!0;return cn=!1,!1}};function Mn(l,i){const s=l.indexOf("?");if(s<0)return`${l}?${new URLSearchParams(i).toString()}`;const u=new URLSearchParams(l.slice(s));for(const d in i)u.set(d,i[d]);return`${l.slice(0,s)}?${u.toString()}`}function ui(l,i={persistentParams:[]}){const s=l.indexOf("?");if(s<0)return l;const u=new URLSearchParams,d=new URLSearchParams(l.slice(s));for(const _ of i.persistentParams){const w=d.get(_);w&&u.set(_,w)}const g=u.toString();return`${l.slice(0,s)}${g.length>0?`?${g}`:""}`}const jn="mapbox-tiles";let Fi=500,pr=50;const Ar=["language","worldview","jobid"];let cs,sa;function Sa(){try{return caches}catch{}}function zl(){const l=Sa();l&&cs==null&&(cs=l.open(jn))}let oc=1/0;const Sh={supported:!1,testSupport:function(l){!pl&&ro&&(ac?lc(l):Is=l)}};let Is,ro,pl=!1,ac=!1;const uf=typeof self<"u"?self:{};function lc(l){const i=l.createTexture();l.bindTexture(l.TEXTURE_2D,i);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,ro),l.isContextLost())return;Sh.supported=!0}catch{}l.deleteTexture(i),pl=!0}uf.document&&(ro=uf.document.createElement("img"),ro.onload=function(){Is&&lc(Is),Is=null,ac=!0},ro.onerror=function(){pl=!0,Is=null},ro.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Cu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Cu);class _i extends Error{constructor(i,s,u){s===401&&tt(u)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=s,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ah=gi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Wo=function(l,i){if(!(/^file:/.test(s=l.url)||/^file:/.test(Ah())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,d){const g=new AbortController,_=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Ah(),referrerPolicy:u.referrerPolicy,signal:g.signal});let w=!1,T=!1;const E=(C=_.url).indexOf("sku=")>0&&tt(C);var C;u.type==="json"&&_.headers.set("Accept","application/json");const R=(z,F,G)=>{if(T)return;if(z&&z.message!=="SecurityError"&&ni(z.toString()),F&&G)return M(F);const H=Date.now();fetch(_).then(K=>{if(K.ok){const ie=E?K.clone():null;return M(K,ie,H)}return d(new _i(K.statusText,K.status,u.url))}).catch(K=>{K.name!=="AbortError"&&d(new Error(`${K.message} ${u.url}`))})},M=(z,F,G)=>{(u.type==="arrayBuffer"?z.arrayBuffer():u.type==="json"?z.json():z.text()).then(H=>{T||(F&&G&&function(K,ie,ne){if(zl(),cs==null)return;const se=ci(ie.headers.get("Cache-Control")||"");if(se["no-store"])return;const Se={status:ie.status,statusText:ie.statusText,headers:new Headers};ie.headers.forEach((Oe,Ne)=>Se.headers.set(Ne,Oe)),se["max-age"]&&Se.headers.set("Expires",new Date(ne+1e3*se["max-age"]).toUTCString());const we=Se.headers.get("Expires");if(!we||new Date(we).getTime()-ne<42e4)return;let Te=ui(K.url,{persistentParams:Ar});if(ie.status===206){const Oe=K.headers.get("Range");if(!Oe)return;Se.status=200,Te=Mn(Te,{range:Oe})}(function(Oe,Ne){if(sa===void 0)try{new Response(new ReadableStream),sa=!0}catch{sa=!1}sa?Ne(Oe.body):Oe.blob().then(Ne).catch(at=>ni(at.message))})(ie,Oe=>{const Ne=new Response((at=ie.status)!==200&&at!==404&&[101,103,204,205,304].includes(at)?null:Oe,Se);var at;zl(),cs!=null&&cs.then(He=>He.put(Te,Ne)).catch(He=>ni(He.message))})}(_,F,G),w=!0,d(null,H,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(H=>{T||d(new Error(H.message))})};return E?function(z,F){if(zl(),cs==null)return F(null);cs.then(G=>{let H=ui(z.url,{persistentParams:Ar});const K=z.headers.get("Range");K&&(H=Mn(H,{range:K})),G.match(H).then(ie=>{const ne=function(se){if(!se)return!1;const Se=new Date(se.headers.get("Expires")||0),we=ci(se.headers.get("Cache-Control")||"");return Number(Se)>Date.now()&&!we["no-cache"]}(ie);G.delete(H).catch(F),ne&&G.put(H,ie.clone()).catch(F),F(null,ie,ne)}).catch(F)}).catch(F)}(_,R):R(null,null),{cancel:()=>{T=!0,w||g.abort()}}}(l,i);if(gi(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,i,void 0,!0)}var s;return function(u,d){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in u.headers)g.setRequestHeader(_,u.headers[_]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(u.type==="json")try{_=JSON.parse(g.response)}catch(w){return d(w)}d(null,_,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else d(new _i(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(l,i)},Pu=function(l,i){return Wo(Xe(l,{type:"arrayBuffer"}),i)};function c_(l){const i=document.createElement("a");return i.href=l,i.protocol===location.protocol&&i.host===location.host}const Fl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ga,ml;Ga=[],ml=0;const gl=function(l,i){if(Sh.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),ml>=ye.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:l,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Ga.push(g),g}ml++;let s=!1;const u=()=>{if(!s)for(s=!0,ml--;Ga.length&&ml<ye.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Ga.shift(),{requestParameters:_,callback:w,cancelled:T}=g;T||(g.cancel=gl(_,w).cancel)}},d=Pu(l,(g,_,w,T)=>{u(),g?i(g):_&&(self.createImageBitmap?function(E,C){const R=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(R).then(M=>{C(null,M)}).catch(M=>{C(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(E,C)=>i(E,C,w,T)):function(E,C){const R=new Image;R.onload=()=>{C(null,R),URL.revokeObjectURL(R.src),R.onload=null,requestAnimationFrame(()=>{R.src=Fl})},R.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(E)],{type:"image/png"});R.src=E.byteLength?URL.createObjectURL(M):Fl}(_,(E,C)=>i(E,C,w,T)))});return{cancel:()=>{d.cancel(),u()}}};var Fc,Ru,Ch,$r={exports:{}},cc={exports:{}},Rp={exports:{}},Nc=function(){if(Ch)return $r.exports;Ch=1;var l=(Fc||(Fc=1,cc.exports=function(s,u){var d,g,_,w,T,E,C,R;for(g=s.length-(d=3&s.length),_=u,T=3432918353,E=461845907,R=0;R<g;)C=255&s.charCodeAt(R)|(255&s.charCodeAt(++R))<<8|(255&s.charCodeAt(++R))<<16|(255&s.charCodeAt(++R))<<24,++R,_=27492+(65535&(w=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*T+(((C>>>16)*T&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(C=0,d){case 3:C^=(255&s.charCodeAt(R+2))<<16;case 2:C^=(255&s.charCodeAt(R+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&s.charCodeAt(R)))*T+(((C>>>16)*T&65535)<<16)&4294967295)<<15|C>>>17))*E+(((C>>>16)*E&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),cc.exports),i=(Ru||(Ru=1,Rp.exports=function(s,u){for(var d,g=s.length,_=u^g,w=0;g>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++w;switch(g){case 3:_^=(255&s.charCodeAt(w+2))<<16;case 2:_^=(255&s.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Rp.exports);return $r.exports=l,$r.exports.murmur3=l,$r.exports.murmur2=i,$r.exports}(),uc=dl(Nc);class $a{constructor(i,...s){Xe(this,s[0]||{}),this.type=i}}class so extends $a{constructor(i,s={}){super("error",Xe({error:i},s))}}function Ph(l,i,s){s[l]&&s[l].indexOf(i)!==-1||(s[l]=s[l]||[],s[l].push(i))}function Aa(l,i,s){if(s&&s[l]){const u=s[l].indexOf(i);u!==-1&&s[l].splice(u,1)}}class Nl{on(i,s){return this._listeners=this._listeners||{},Ph(i,s,this._listeners),this}off(i,s){return Aa(i,s,this._listeners),Aa(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Ph(i,s,this._oneTimeListeners),this):new Promise(u=>{this.once(i,u)})}fire(i,s){const u=typeof i=="string"?new $a(i,s):i,d=u.type;if(this.listens(d)){u.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of g)T.call(this,u);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of _)Aa(d,T,this._oneTimeListeners),T.call(this,u);const w=this._eventedParent;w&&(Xe(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(u))}else u instanceof so&&console.error(u.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}class Oo{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new Oo(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[s,u]=i.split("");return new Oo({name:s,iconsetId:u})}static isEqual(i,s){return i.name===s.name&&i.iconsetId===s.iconsetId}toString(){return Oo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var hc,ku={},Mu=function(){if(hc)return ku;hc=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(g){return(g=Math.round(g))<0?0:g>255?255:g}function s(g){return i(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(_=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:_>1?1:_;var _}function d(g,_,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?g+(_-g)*w*6:2*w<1?_:3*w<2?g+(_-g)*(2/3-w)*6:g}try{ku.parseCSSColor=function(g){var _,w=g.replace(/ /g,"").toLowerCase();if(w in l)return l[w].slice();if(w[0]==="#")return w.length===4?(_=parseInt(w.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:w.length===7&&(_=parseInt(w.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var T=w.indexOf("("),E=w.indexOf(")");if(T!==-1&&E+1===w.length){var C=w.substr(0,T),R=w.substr(T+1,E-(T+1)).split(","),M=1;switch(C){case"rgba":if(R.length!==4)return null;M=u(R.pop());case"rgb":return R.length!==3?null:[s(R[0]),s(R[1]),s(R[2]),M];case"hsla":if(R.length!==4)return null;M=u(R.pop());case"hsl":if(R.length!==3)return null;var z=(parseFloat(R[0])%360+360)%360/360,F=u(R[1]),G=u(R[2]),H=G<=.5?G*(F+1):G+F-G*F,K=2*G-H;return[i(255*d(K,H,z+1/3)),i(255*d(K,H,z)),i(255*d(K,H,z-1/3)),M];default:return null}}return null}}catch{}return ku}();class wi{constructor(i,s,u,d=1){this.r=i,this.g=s,this.b=u,this.a=d}static parse(i){if(!i)return;if(i instanceof wi)return i;if(typeof i!="string")return;const s=Mu.parseCSSColor(i);return s?new wi(s[0]/255,s[1]/255,s[2]/255,s[3]):void 0}toString(){const[i,s,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*s)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(i){const{r:s,g:u,b:d,a:g}=this;return new _l(i,s,u,d,g)}toPremultipliedRenderColor(i){const{r:s,g:u,b:d,a:g}=this;return new kp(i,s*g,u*g,d*g,g)}clone(){return new wi(this.r,this.g,this.b,this.a)}}class Bc{constructor(i,s,u,d,g,_=!1){if(this.premultiplied=!1,this.premultiplied=_,i){const w=i.image.height,T=w*w;this.premultiplied?(s=g===0?0:s/g*(w-1),u=g===0?0:u/g*(w-1),d=g===0?0:d/g*(w-1)):(s*=w-1,u*=w-1,d*=w-1);const E=Math.floor(s),C=Math.floor(u),R=Math.floor(d),M=Math.ceil(s),z=Math.ceil(u),F=Math.ceil(d),G=s-E,H=u-C,K=d-R,ie=i.image.data,ne=4*(E+C*T+R*w),se=4*(E+C*T+F*w),Se=4*(E+z*T+R*w),we=4*(E+z*T+F*w),Te=4*(M+C*T+R*w),Oe=4*(M+C*T+F*w),Ne=4*(M+z*T+R*w),at=4*(M+z*T+F*w);if(ne<0||at>=ie.length)throw new Error("out of range");this.r=gn(gn(gn(ie[ne],ie[se],K),gn(ie[Se],ie[we],K),H),gn(gn(ie[Te],ie[Oe],K),gn(ie[Ne],ie[at],K),H),G)/255*(this.premultiplied?g:1),this.g=gn(gn(gn(ie[ne+1],ie[se+1],K),gn(ie[Se+1],ie[we+1],K),H),gn(gn(ie[Te+1],ie[Oe+1],K),gn(ie[Ne+1],ie[at+1],K),H),G)/255*(this.premultiplied?g:1),this.b=gn(gn(gn(ie[ne+2],ie[se+2],K),gn(ie[Se+2],ie[we+2],K),H),gn(gn(ie[Te+2],ie[Oe+2],K),gn(ie[Ne+2],ie[at+2],K),H),G)/255*(this.premultiplied?g:1),this.a=g}else this.r=s,this.g=u,this.b=d,this.a=g}toArray(){const{r:i,g:s,b:u,a:d}=this;return[255*i,255*s,255*u,d]}toHslaArray(){let{r:i,g:s,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];i/=d,s/=d,u/=d}const g=Math.min(Math.max(i,0),1),_=Math.min(Math.max(s,0),1),w=Math.min(Math.max(u,0),1),T=Math.min(g,_,w),E=Math.max(g,_,w),C=(T+E)/2;if(T===E)return[0,0,100*C,d];const R=E-T,M=C>.5?R/(2-E-T):R/(E+T);let z=0;return E===g?z=(_-w)/R+(_<w?6:0):E===_?z=(w-g)/R+2:E===w&&(z=(g-_)/R+4),z*=60,[Math.min(Math.max(z,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*C,0),100),d]}toArray01(){const{r:i,g:s,b:u,a:d}=this;return[i,s,u,d]}toArray01Scaled(i){const{r:s,g:u,b:d}=this;return[s*i,u*i,d*i]}toArray01Linear(){const{r:i,g:s,b:u,a:d}=this;return[Math.pow(i,2.2),Math.pow(s,2.2),Math.pow(u,2.2),d]}}class _l extends Bc{constructor(i,s,u,d,g){super(i,s,u,d,g,!1)}}class kp extends Bc{constructor(i,s,u,d,g){super(i,s,u,d,g,!0)}}function gn(l,i,s){return l*(1-s)+i*s}function Vc(l,i,s){return l.map((u,d)=>gn(u,i[d],s))}wi.black=new wi(0,0,0,1),wi.white=new wi(1,1,1,1),wi.transparent=new wi(0,0,0,0),wi.red=new wi(1,0,0,1),wi.blue=new wi(0,0,1,1);var Uc=Object.freeze({__proto__:null,array:Vc,color:function(l,i,s){return new wi(gn(l.r,i.r,s),gn(l.g,i.g,s),gn(l.b,i.b,s),gn(l.a,i.a,s))},number:gn});function Bl(l,...i){for(const s of i)for(const u in s)l[u]=s[u];return l}class xo extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}class Du{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[u,d]of s)this.bindings[u]=d}concat(i){return new Du(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const dc={kind:"null"},on={kind:"number"},Si={kind:"string"},Ai={kind:"boolean"},zs={kind:"color"},Ha={kind:"object"},Pi={kind:"value"},Lu={kind:"collator"},jc={kind:"formatted"},Vl={kind:"resolvedImage"};function Fr(l,i){return{kind:"array",itemType:l,N:i}}function es(l){if(l.kind==="array"){const i=es(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const Mp=[dc,on,Si,Ai,zs,jc,Ha,Fr(Pi),Vl];function Ca(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Ca(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const s of Mp)if(!Ca(s,i))return null}}return`Expected ${es(l)} but found ${es(i)} instead.`}function k(l,i){return i.some(s=>s.kind===l.kind)}function W(l,i){return i.some(s=>s==="null"?l===null:s==="array"?Array.isArray(l):s==="object"?l&&!Array.isArray(l)&&typeof l=="object":s===typeof l)}function ee(l,i){return l.kind==="array"&&i.kind==="array"?l.N===i.N&&ee(l.itemType,i.itemType):l.kind===i.kind}class Ae{constructor(i,s,u){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class vt{constructor(i,s,u,d,g){this.text=i.normalize?i.normalize():i,this.image=s,this.scale=u,this.fontStack=d,this.textColor=g}}class Ot{constructor(i){this.sections=i}static fromString(i){return new Ot([new vt(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof Ot?i:Ot.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const s of this.sections){if(s.image){const d=s.image.getPrimary().id.toString();i.push(["image",d]);continue}i.push(s.text);const u={};s.fontStack&&(u["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(u["font-scale"]=s.scale),s.textColor&&(u["text-color"]=["rgba"].concat(s.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(u)}return i}}class xn{constructor(i,s={}){if(this.id=Oo.from(i),this.options=Object.assign({},s),s.transform){const{a:u,b:d,c:g,d:_,e:w,f:T}=s.transform;this.options.transform=new DOMMatrix([u,d,g,_,w,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:s,c:u,d,e:g,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:s,c:u,d,e:g,f:_}})}static parse(i){let s,u,d,g;try{({name:s,iconsetId:u,params:d,transform:g}=JSON.parse(i)||{})}catch{return null}if(!s)return null;const{a:_,b:w,c:T,d:E,e:C,f:R}=g||{};return new xn({name:s,iconsetId:u},{params:d,transform:new DOMMatrix([_,w,T,E,C,R])})}scaleSelf(i,s){return this.options.transform.scaleSelf(i,s),this}}class Gi{constructor(i,s,u,d,g=!1){this.primaryId=Oo.from(i),this.primaryOptions=s,u&&(this.secondaryId=Oo.from(u)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new xn(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new xn(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?Gi.build({name:i}):i}static build(i,s,u,d){return!i||typeof i=="object"&&!("name"in i)?null:new Gi(i,u,s,d)}}function us(l,i,s,u){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof s=="number"&&s>=0&&s<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[l,i,s,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[l,i,s,u]:[l,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pn(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof wi||l instanceof Ae||l instanceof Ot||l instanceof Gi)return!0;if(Array.isArray(l)){for(const i of l)if(!pn(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!pn(l[i]))return!1;return!0}return!1}function Ut(l){if(l===null)return dc;if(typeof l=="string")return Si;if(typeof l=="boolean")return Ai;if(typeof l=="number")return on;if(l instanceof wi)return zs;if(l instanceof Ae)return Lu;if(l instanceof Ot)return jc;if(l instanceof Gi)return Vl;if(Array.isArray(l)){const i=l.length;let s;for(const u of l){const d=Ut(u);if(s){if(s===d)continue;s=Pi;break}s=d}return Fr(s||Pi,i)}return Ha}function Hr(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof Ot||l instanceof Gi||l instanceof wi?l.toString():JSON.stringify(l)}class bn{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(i.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!pn(i[1]))return s.error("invalid value");const u=i[1];let d=Ut(u);const g=s.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new bn(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof wi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ot?this.value.serialize():this.value}}class ur{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Ul={string:Si,number:on,boolean:Ai,object:Ha};class yn{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let u,d=1;const g=i[0];if(g==="array"){let w,T;if(i.length>2){const E=i[1];if(typeof E!="string"||!(E in Ul)||E==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=Ul[E],d++}else w=Pi;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=i[2],d++}u=Fr(w,T)}else u=Ul[g];const _=[];for(;d<i.length;d++){const w=s.parse(i[d],d,Pi);if(!w)return null;_.push(w)}return new yn(u,_)}evaluate(i){for(let s=0;s<this.args.length;s++){const u=this.args[s].evaluate(i);if(!Ca(this.type,Ut(u)))return u;if(s===this.args.length-1)throw new ur(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${es(Ut(u))} but was expected to be of type ${es(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,s=[i.kind];if(i.kind==="array"){const u=i.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){s.push(u.kind);const d=i.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(u=>u.serialize()))}}class Rh{constructor(i){this.type=jc,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const u=i[1];if(!Array.isArray(u)&&typeof u=="object")return s.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=i.length-1;++_){const w=i[_];if(g&&typeof w=="object"&&!Array.isArray(w)){g=!1;let T=null;if(w["font-scale"]&&(T=s.parseObjectValue(w["font-scale"],_,"font-scale",on),!T))return null;let E=null;if(w["text-font"]&&(E=s.parseObjectValue(w["text-font"],_,"text-font",Fr(Si)),!E))return null;let C=null;if(w["text-color"]&&(C=s.parseObjectValue(w["text-color"],_,"text-color",zs),!C))return null;const R=d[d.length-1];R.scale=T,R.font=E,R.textColor=C}else{const T=s.parse(i[_],_,Pi);if(!T)return null;const E=T.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new Rh(d)}evaluate(i){return new Ot(this.sections.map(s=>{const u=s.content.evaluate(i);return ee(Ut(u),Vl)?new vt("",u,null,null,null):new vt(Hr(u),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const s of this.sections){i.push(s.content.serialize());const u={};s.scale&&(u["font-scale"]=s.scale.serialize()),s.font&&(u["text-font"]=s.font.serialize()),s.textColor&&(u["text-color"]=s.textColor.serialize()),i.push(u)}return i}}class kh{constructor(i,s,u,d){this._imageWarnHistory={},this.type=Vl,this.namePrimary=i,this.nameSecondary=s,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(i,s){if(i.length<2)return s.error("Expected two or more arguments.");let u=1;const d=[];function g(){if(u<i.length){const w=s.parse(i[u],u++,Si);return w?(d.push({image:w,options:{}}),!0):(s.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(u<i.length){const T=i[u];if((w=T)===null||typeof w!="object"||Array.isArray(w))return!0;const E=T.params,C=T.iconset,R=s.concat(u);if(!E&&!C)return u++,!0;if(E){if(typeof E!="object"||E.constructor!==Object)return R.error('Image options "params" should be an object'),!1;const M={},z=R.concat(void 0,"params");for(const F in E){if(!F)return z.error("Image parameter name should be non-empty"),!1;const G=z.concat(void 0,F).parse(E[F],void 0,zs,void 0,{typeAnnotation:"coerce"});if(!G)return!1;M[F]=G}d[d.length-1].options.params=M}if(C){if(typeof C!="object"||C.constructor!==Object)return R.error('Image options "iconset" should be an object'),!1;if(!C.id)return R.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=C}return u++,!0}var w;return!0}for(let w=0;w<2;w++)if(!g()||!_())return;return new kh(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(i,s){const u={};if(s){for(const d in s)if(s[d])try{u[d]=s[d].evaluate(i)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(i){const s={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,d=Gi.build(s,u,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(d&&i.availableImages){const g=d.getPrimary().id;if(d.available=i.availableImages.some(_=>Oo.isEqual(_,g)),d.available){const _=d.getSecondary()?d.getSecondary().id:null;_&&(d.available=i.availableImages.some(w=>Oo.isEqual(w,_)))}}return d}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const s in this.paramsPrimary)this.paramsPrimary[s]&&i(this.paramsPrimary[s]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const s in this.paramsSecondary)this.paramsSecondary[s]&&i(this.paramsSecondary[s])}outputDefined(){return!1}serializeOptions(i,s){const u={};if(s&&(u.iconset={id:s}),i){u.params={};for(const d in i)i[d]&&(u.params[d]=i[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const s=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);s&&i.push(s)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const s=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);s&&i.push(s)}return i}}function Gc(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const i0={"to-boolean":Ai,"to-color":zs,"to-number":on,"to-string":Si};class qa{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const u=i[0],d=[];let g=dc;if(u==="to-array"){if(!Array.isArray(i[1]))return null;const _=i[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);g=Fr(s.expectedType.itemType,_)}else{if(!(_>0&&pn(i[1][0])))return null;g=Fr(Ut(i[1][0]),_)}for(let w=0;w<_;w++){const T=i[1][w];let E;if(Gc(T)==="array")E=s.parse(T,void 0,g.itemType);else{const C=Gc(T);if(C!==g.itemType.kind)return s.error(`Expected ${g.itemType.kind} but found ${C}.`);E=s.registry.literal.parse(["literal",T===void 0?null:T],s)}if(!E)return null;d.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&i.length!==2)return s.error("Expected one argument.");g=i0[u];for(let _=1;_<i.length;_++){const w=s.parse(i[_],_,Pi);if(!w)return null;d.push(w)}}return new qa(g,d)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let s,u;for(const d of this.args){if(s=d.evaluate(i),u=null,s instanceof wi)return s;if(typeof s=="string"){const g=i.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(u=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:us(s[0],s[1],s[2],s[3]),!u))return new wi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new ur(u||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const u of this.args){if(s=u.evaluate(i),s===null)return 0;const d=Number(s);if(!isNaN(d))return d}throw new ur(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Ot.fromString(Hr(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Gi.build(Hr(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(s=>s.evaluate(i)):Hr(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Rh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new kh(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{i.push(s.serialize())}),i}}const zo=["Unknown","Point","LineString","Polygon"];class hf{constructor(i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*s-i[0])+this.featureDistanceData.bearing[1]*(d*s-i[1])}return 0}parseColor(i){let s=this._parseColorCache[i];return s||(s=this._parseColorCache[i]=wi.parse(i)),s}getConfig(i){return this.options?this.options.get(i):null}}class Ws{constructor(i,s,u,d,g){this.name=i,this.type=s,this._evaluate=u,this.args=d,this._overloadIndex=g}evaluate(i){if(!this._evaluate){const s=Ws.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,s){const u=i[0],d=Ws.definitions[u];if(!d)return s.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=[];let T=null,E=-1;for(const[C,R]of _){if(Array.isArray(C)&&C.length!==i.length-1)continue;w.push(C),E++,T=new Hp(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const M=[];let z=!1;for(let F=1;F<i.length;F++){const G=i[F],H=Array.isArray(C)?C[F-1]:C.type,K=T.parse(G,1+M.length,H);if(!K){z=!0;break}M.push(K)}if(!z)if(Array.isArray(C)&&C.length!==M.length)T.error(`Expected ${C.length} arguments, but found ${M.length} instead.`);else{for(let F=0;F<M.length;F++){const G=Array.isArray(C)?C[F]:C.type,H=M[F];T.concat(F+1).checkSubtype(G,H.type)}if(T.errors.length===0)return new Ws(u,g,R,M,E)}}if(w.length===1)s.errors.push(...T.errors);else{const C=(w.length?w:_.map(([M])=>M)).map(u_).join(" | "),R=[];for(let M=1;M<i.length;M++){const z=s.parse(i[M],1+R.length);if(!z)return null;R.push(es(z.type))}s.error(`Expected arguments of type ${C}, but found (${R.join(", ")}) instead.`)}return null}static register(i,s){Ws.definitions=s;for(const u in s)i[u]=Ws}}function u_(l){return Array.isArray(l)?`(${l.map(es).join(", ")})`:`(${es(l.type)}...)`}class jl{constructor(i,s,u){this.type=Lu,this.locale=u,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(i.length!==2)return s.error("Expected one argument.");const u=i[1];if(typeof u!="object"||Array.isArray(u))return s.error("Collator options argument must be an object.");const d=u["case-sensitive"]===void 0?s.parse(!1,1,Ai):s.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Ai);if(!d)return null;const g=u["diacritic-sensitive"]===void 0?s.parse(!1,1,Ai):s.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Ai);if(!g)return null;let _=null;return u.locale&&(_=s.parseObjectValue(u.locale,1,"locale",Si),!_)?null:new jl(d,g,_)}evaluate(i){return new Ae(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function wo(l,i,s=0,u=l.length-1,d=tE){for(;u>s;){if(u-s>600){const T=u-s+1,E=i-s+1,C=Math.log(T),R=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*R*(T-R)/T)*(E-T/2<0?-1:1);wo(l,i,Math.max(s,Math.floor(i-E*R/T+M)),Math.min(u,Math.floor(i+(T-E)*R/T+M)),d)}const g=l[i];let _=s,w=u;for(df(l,s,i),d(l[u],g)>0&&df(l,s,u);_<w;){for(df(l,_,w),_++,w--;d(l[_],g)<0;)_++;for(;d(l[w],g)>0;)w--}d(l[s],g)===0?df(l,s,w):(w++,df(l,w,u)),w<=i&&(s=w+1),i<=w&&(u=w-1)}}function df(l,i,s){const u=l[i];l[i]=l[s],l[s]=u}function tE(l,i){return l<i?-1:l>i?1:0}function nE(l){let i=0;for(let s,u,d=0,g=l.length,_=g-1;d<g;_=d++)s=l[d],u=l[_],i+=(u.x-s.x)*(s.y+u.y);return i}function $c(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function Mh(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function Ou(l,i,s){const u=l[0]-i[0],d=l[1]-i[1],g=l[0]-s[0],_=l[1]-s[1];return u*_-g*d==0&&u*g<=0&&d*_<=0}function Dh(l,i,s=!1){let u=!1;for(let w=0,T=i.length;w<T;w++){const E=i[w];for(let C=0,R=E.length,M=R-1;C<R;M=C++){const z=E[M],F=E[C];if(Ou(l,z,F))return s;(g=z)[1]>(d=l)[1]!=(_=F)[1]>d[1]&&d[0]<(_[0]-g[0])*(d[1]-g[1])/(_[1]-g[1])+g[0]&&(u=!u)}}var d,g,_;return u}function r0(l,i,s,u){const d=u[0]-s[0],g=u[1]-s[1],_=(l[0]-s[0])*g-d*(l[1]-s[1]),w=(i[0]-s[0])*g-d*(i[1]-s[1]);return _>0&&w<0||_<0&&w>0}function Dp(l,i,s,u){return(d=[u[0]-s[0],u[1]-s[1]])[0]*(g=[i[0]-l[0],i[1]-l[1]])[1]-d[1]*g[0]!=0&&!(!r0(l,i,s,u)||!r0(s,u,l,i));var d,g}function h_(l){const i=new bt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new bt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of l[0])i.x>u.x&&(i.x=u.x),i.y>u.y&&(i.y=u.y),s.x<u.x&&(s.x=u.x),s.y<u.y&&(s.y=u.y);return{min:i,max:s}}const Hc=8192;function iE(l,i){const s=(180+l[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,d=Math.pow(2,i.z);return[Math.round(s*d*Hc),Math.round(u*d*Hc)]}function s0(l,i){for(let s=0;s<i.length;s++)if(Dh(l,i[s]))return!0;return!1}function rE(l,i,s){for(const u of s)for(let d=0,g=u.length,_=g-1;d<g;_=d++)if(Dp(l,i,u[_],u[d]))return!0;return!1}function o0(l,i){for(let s=0;s<l.length;++s)if(!Dh(l[s],i))return!1;for(let s=0;s<l.length-1;++s)if(rE(l[s],l[s+1],i))return!1;return!0}function a0(l,i){for(let s=0;s<i.length;s++)if(o0(l,i[s]))return!0;return!1}function d_(l,i,s){const u=[];for(let d=0;d<l.length;d++){const g=[];for(let _=0;_<l[d].length;_++){const w=iE(l[d][_],s);$c(i,w),g.push(w)}u.push(g)}return u}function qc(l,i,s){const u=[];for(let d=0;d<l.length;d++){const g=d_(l[d],i,s);u.push(g)}return u}function l0(l,i,s,u){if(l[0]<s[0]||l[0]>s[2]){const d=.5*u;let g=l[0]-s[0]>d?-u:s[0]-l[0]>d?u:0;g===0&&(g=l[0]-s[2]>d?-u:s[2]-l[0]>d?u:0),l[0]+=g}$c(i,l)}function c0(l,i,s,u){const d=Math.pow(2,u.z)*Hc,g=[u.x*Hc,u.y*Hc],_=[];if(!l)return _;for(const w of l)for(const T of w){const E=[T.x+g[0],T.y+g[1]];l0(E,i,s,d),_.push(E)}return _}function Lp(l,i,s,u){const d=Math.pow(2,u.z)*Hc,g=[u.x*Hc,u.y*Hc],_=[];if(!l)return _;for(const T of l){const E=[];for(const C of T){const R=[C.x+g[0],C.y+g[1]];$c(i,R),E.push(R)}_.push(E)}if(i[2]-i[0]<=d/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of _)for(const E of T)l0(E,i,s,d)}var w;return _}class Wc{constructor(i,s){this.type=Ai,this.geojson=i,this.geometries=s}static parse(i,s){if(i.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(pn(i[1])){const u=i[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const g=u.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Wc(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Wc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Wc(u,u)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const w=d_(u.coordinates,g,_),T=c0(s.geometry(),d,g,_);if(!Mh(d,g))return!1;for(const E of T)if(!Dh(E,w))return!1}if(u.type==="MultiPolygon"){const w=qc(u.coordinates,g,_),T=c0(s.geometry(),d,g,_);if(!Mh(d,g))return!1;for(const E of T)if(!s0(E,w))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(u.type==="Polygon"){const w=d_(u.coordinates,g,_),T=Lp(s.geometry(),d,g,_);if(!Mh(d,g))return!1;for(const E of T)if(!o0(E,w))return!1}if(u.type==="MultiPolygon"){const w=qc(u.coordinates,g,_),T=Lp(s.geometry(),d,g,_);if(!Mh(d,g))return!1;for(const E of T)if(!a0(E,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ff={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Wa=1/298.257223563,f_=Wa*(2-Wa),Lh=Math.PI/180;class Oh{static fromTile(i,s,u){const d=Math.PI*(1-2*(i+.5)/Math.pow(2,s)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Lh;return new Oh(g,u)}static get units(){return ff}constructor(i,s){if(i===void 0)throw new Error("No latitude given.");if(s&&!ff[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(ff).join(", ")}`);const u=6378.137*Lh*(s?ff[s]:1),d=Math.cos(i*Lh),g=1/(1-f_*(1-d*d)),_=Math.sqrt(g);this.kx=u*_*d,this.ky=u*_*g*(1-f_)}distance(i,s){const u=Pa(i[0]-s[0])*this.kx,d=(i[1]-s[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(i,s){const u=Pa(s[0]-i[0])*this.kx;return Math.atan2(u,(s[1]-i[1])*this.ky)/Lh}destination(i,s,u){const d=u*Lh;return this.offset(i,Math.sin(d)*s,Math.cos(d)*s)}offset(i,s,u){return[i[0]+s/this.kx,i[1]+u/this.ky]}lineDistance(i){let s=0;for(let u=0;u<i.length-1;u++)s+=this.distance(i[u],i[u+1]);return s}area(i){let s=0;for(let u=0;u<i.length;u++){const d=i[u];for(let g=0,_=d.length,w=_-1;g<_;w=g++)s+=Pa(d[g][0]-d[w][0])*(d[g][1]+d[w][1])*(u?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(i,s){let u=0;if(s<=0)return i[0];for(let d=0;d<i.length-1;d++){const g=i[d],_=i[d+1],w=this.distance(g,_);if(u+=w,u>s)return Op(g,_,(s-(u-w))/w)}return i[i.length-1]}pointToSegmentDistance(i,s,u){let[d,g]=s,_=Pa(u[0]-d)*this.kx,w=(u[1]-g)*this.ky;if(_!==0||w!==0){const T=(Pa(i[0]-d)*this.kx*_+(i[1]-g)*this.ky*w)/(_*_+w*w);T>1?(d=u[0],g=u[1]):T>0&&(d+=_/this.kx*T,g+=w/this.ky*T)}return _=Pa(i[0]-d)*this.kx,w=(i[1]-g)*this.ky,Math.sqrt(_*_+w*w)}pointOnLine(i,s){let u=1/0,d=i[0][0],g=i[0][1],_=0,w=0;for(let T=0;T<i.length-1;T++){let E=i[T][0],C=i[T][1],R=Pa(i[T+1][0]-E)*this.kx,M=(i[T+1][1]-C)*this.ky,z=0;R===0&&M===0||(z=(Pa(s[0]-E)*this.kx*R+(s[1]-C)*this.ky*M)/(R*R+M*M),z>1?(E=i[T+1][0],C=i[T+1][1]):z>0&&(E+=R/this.kx*z,C+=M/this.ky*z)),R=Pa(s[0]-E)*this.kx,M=(s[1]-C)*this.ky;const F=R*R+M*M;F<u&&(u=F,d=E,g=C,_=T,w=z)}return{point:[d,g],index:_,t:Math.max(0,Math.min(1,w))}}lineSlice(i,s,u){let d=this.pointOnLine(u,i),g=this.pointOnLine(u,s);if(d.index>g.index||d.index===g.index&&d.t>g.t){const E=d;d=g,g=E}const _=[d.point],w=d.index+1,T=g.index;!p_(u[w],_[0])&&w<=T&&_.push(u[w]);for(let E=w+1;E<=T;E++)_.push(u[E]);return p_(u[T],g.point)||_.push(g.point),_}lineSliceAlong(i,s,u){let d=0;const g=[];for(let _=0;_<u.length-1;_++){const w=u[_],T=u[_+1],E=this.distance(w,T);if(d+=E,d>i&&g.length===0&&g.push(Op(w,T,(i-(d-E))/E)),d>=s)return g.push(Op(w,T,(s-(d-E))/E)),g;d>i&&g.push(T)}return g}bufferPoint(i,s){const u=s/this.ky,d=s/this.kx;return[i[0]-d,i[1]-u,i[0]+d,i[1]+u]}bufferBBox(i,s){const u=s/this.ky,d=s/this.kx;return[i[0]-d,i[1]-u,i[2]+d,i[3]+u]}insideBBox(i,s){return Pa(i[0]-s[0])>=0&&Pa(i[0]-s[2])<=0&&i[1]>=s[1]&&i[1]<=s[3]}}function p_(l,i){return l[0]===i[0]&&l[1]===i[1]}function Op(l,i,s){const u=Pa(i[0]-l[0]);return[l[0]+u*s,l[1]+(i[1]-l[1])*s]}function Pa(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class zp{constructor(i=[],s=(u,d)=>u<d?-1:u>d?1:0){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:u}=this,d=s[i];for(;i>0;){const g=i-1>>1,_=s[g];if(u(d,_)>=0)break;s[i]=_,i=g}s[i]=d}_down(i){const{data:s,compare:u}=this,d=this.length>>1,g=s[i];for(;i<d;){let _=1+(i<<1);const w=_+1;if(w<this.length&&u(s[w],s[_])<0&&(_=w),u(s[_],g)>=0)break;s[i]=s[_],i=_}s[i]=g}}var Bt=8192;function m_(l,i){return i.dist-l.dist}const Fp=100,Np=50;function pf(l){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==l.length)return!1;for(let s=0;s<i.length;s++)if(i[s]!==l[s])return!1;return!0}function zu(l){return l[1]-l[0]+1}function Za(l,i){const s=l[1]>=l[0]&&l[1]<i;return s||console.warn("Distance Expression: Index is out of range"),s}function Bp(l,i){if(l[0]>l[1])return[null,null];const s=zu(l);if(i){if(s===2)return[l,null];const u=Math.floor(s/2);return[[l[0],l[0]+u],[l[0]+u,l[1]]]}{if(s===1)return[l,null];const u=Math.floor(s/2)-1;return[[l[0],l[0]+u],[l[0]+u+1,l[1]]]}}function Zc(l,i){const s=[1/0,1/0,-1/0,-1/0];if(!Za(i,l.length))return s;for(let u=i[0];u<=i[1];++u)$c(s,l[u]);return s}function mf(l){const i=[1/0,1/0,-1/0,-1/0];for(let s=0;s<l.length;++s)for(let u=0;u<l[s].length;++u)$c(i,l[s][u]);return i}function yl(l,i,s){if(pf(l)||pf(i))return NaN;let u=0,d=0;return l[2]<i[0]&&(u=i[0]-l[2]),l[0]>i[2]&&(u=l[0]-i[2]),l[1]>i[3]&&(d=l[1]-i[3]),l[3]<i[1]&&(d=i[1]-l[3]),s.distance([0,0],[u,d])}function hi(l){return 360*l-180}function sE(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function g_(l,i){const s=Math.pow(2,i.z),u=(l.y/Bt+i.y)/s;return[hi((l.x/Bt+i.x)/s),sE(u)]}function oE(l,i){const s=[];for(let u=0;u<l.length;++u)s.push(g_(l[u],i));return s}function __(l,i,s){const u=s.pointOnLine(i,l).point;return s.distance(l,u)}function u0(l,i,s,u,d){const g=s.slice(u[0],u[1]+1);let _=1/0;for(let w=i[0];w<=i[1];++w)if((_=Math.min(_,__(l[w],g,d)))===0)return 0;return _}function Er(l,i,s,u,d){const g=Math.min(d.pointToSegmentDistance(l,s,u),d.pointToSegmentDistance(i,s,u)),_=Math.min(d.pointToSegmentDistance(s,l,i),d.pointToSegmentDistance(u,l,i));return Math.min(g,_)}function aE(l,i,s,u,d){if(!Za(i,l.length)||!Za(u,s.length))return NaN;let g=1/0;for(let _=i[0];_<i[1];++_)for(let w=u[0];w<u[1];++w){if(Dp(l[_],l[_+1],s[w],s[w+1]))return 0;g=Math.min(g,Er(l[_],l[_+1],s[w],s[w+1],d))}return g}function lE(l,i,s,u,d){if(!Za(i,l.length)||!Za(u,s.length))return NaN;let g=1/0;for(let _=i[0];_<=i[1];++_)for(let w=u[0];w<=u[1];++w)if((g=Math.min(g,d.distance(l[_],s[w])))===0)return g;return g}function cE(l,i,s){if(Dh(l,i,!0))return 0;let u=1/0;for(const d of i){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(u=Math.min(u,s.pointToSegmentDistance(l,d[g-1],d[0])))===0||(u=Math.min(u,__(l,d,s)))===0)return u}return u}function uE(l,i,s,u){if(!Za(i,l.length))return NaN;for(let g=i[0];g<=i[1];++g)if(Dh(l[g],s,!0))return 0;let d=1/0;for(let g=i[0];g<i[1];++g)for(const _ of s)for(let w=0,T=_.length,E=T-1;w<T;E=w++){if(Dp(l[g],l[g+1],_[E],_[w]))return 0;d=Math.min(d,Er(l[g],l[g+1],_[E],_[w],u))}return d}function h0(l,i){for(const s of l)for(let u=0;u<=s.length-1;++u)if(Dh(s[u],i,!0))return!0;return!1}function hE(l,i,s,u=1/0){const d=mf(l),g=mf(i);if(u!==1/0&&yl(d,g,s)>=u)return u;if(Mh(d,g)){if(h0(l,i))return 0}else if(h0(i,l))return 0;let _=u;for(const w of l)for(let T=0,E=w.length,C=E-1;T<E;C=T++)for(const R of i)for(let M=0,z=R.length,F=z-1;M<z;F=M++){if(Dp(w[C],w[T],R[F],R[M]))return 0;_=Math.min(_,Er(w[C],w[T],R[F],R[M],s))}return _}function Vp(l,i,s,u,d,g,_){if(g===null||_===null)return;const w=yl(Zc(u,g),Zc(d,_),s);w<i&&l.push({dist:w,range1:g,range2:_})}function dE(l,i,s,u,d=1/0){let g=Math.min(u.distance(l[0],s[0][0]),d);if(g===0)return g;const _=new zp([{dist:0,range1:[0,l.length-1],range2:[0,0]}],m_),w=i?Np:Fp,T=mf(s);for(;_.length;){const E=_.pop();if(E.dist>=g)continue;const C=E.range1;if(zu(C)<=w){if(!Za(C,l.length))return NaN;if(i){const R=uE(l,C,s,u);if((g=Math.min(g,R))===0)return g}else for(let R=C[0];R<=C[1];++R){const M=cE(l[R],s,u);if((g=Math.min(g,M))===0)return g}}else{const R=Bp(C,i);if(R[0]!==null){const M=yl(Zc(l,R[0]),T,u);M<g&&_.push({dist:M,range1:R[0],range2:[0,0]})}if(R[1]!==null){const M=yl(Zc(l,R[1]),T,u);M<g&&_.push({dist:M,range1:R[1],range2:[0,0]})}}}return g}function d0(l,i,s,u,d,g=1/0){let _=Math.min(g,d.distance(l[0],s[0]));if(_===0)return _;const w=new zp([{dist:0,range1:[0,l.length-1],range2:[0,s.length-1]}],m_),T=i?Np:Fp,E=u?Np:Fp;for(;w.length;){const C=w.pop();if(C.dist>=_)continue;const R=C.range1,M=C.range2;if(zu(R)<=T&&zu(M)<=E){if(!Za(R,l.length)||!Za(M,s.length))return NaN;if(i&&u?_=Math.min(_,aE(l,R,s,M,d)):i||u?i&&!u?_=Math.min(_,u0(s,M,l,R,d)):!i&&u&&(_=Math.min(_,u0(l,R,s,M,d))):_=Math.min(_,lE(l,R,s,M,d)),_===0)return _}else{const z=Bp(R,i),F=Bp(M,u);Vp(w,_,d,l,s,z[0],F[0]),Vp(w,_,d,l,s,z[0],F[1]),Vp(w,_,d,l,s,z[1],F[0]),Vp(w,_,d,l,s,z[1],F[1])}}return _}function y_(l,i,s,u,d=1/0){let g=d;const _=Zc(l,[0,l.length-1]);for(const w of s)if(!(g!==1/0&&yl(_,Zc(w,[0,w.length-1]),u)>=g)&&(g=Math.min(g,d0(l,i,w,!0,u,g)),g===0))return g;return g}function Up(l,i,s,u,d=1/0){let g=d;const _=Zc(l,[0,l.length-1]);for(const w of s){if(g!==1/0&&yl(_,mf(w),u)>=g)continue;const T=dE(l,i,w,u,g);if(isNaN(T))return T;if((g=Math.min(g,T))===0)return g}return g}function v_(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Fu{constructor(i,s){this.type=on,this.geojson=i,this.geometries=s}static parse(i,s){if(i.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(pn(i[1])){const u=i[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(v_(u.features[d].geometry.type))return new Fu(u,u.features[d].geometry)}else if(u.type==="Feature"){if(v_(u.geometry.type))return new Fu(u,u.geometry)}else if(v_(u.type))return new Fu(u,u)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const s=i.geometry(),u=i.canonicalID();if(s!=null&&u!=null){if(i.geometryType()==="Point")return function(d,g,_){const w=[];for(const E of d)for(const C of E)w.push(g_(C,g));const T=new Oh(w[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?d0(w,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",T):_.type==="MultiLineString"?y_(w,!1,_.coordinates,T):_.type==="Polygon"||_.type==="MultiPolygon"?Up(w,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,T):null}(s,u,this.geometries);if(i.geometryType()==="LineString")return function(d,g,_){const w=[];for(const E of d){const C=[];for(const R of E)C.push(g_(R,g));w.push(C)}const T=new Oh(w[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return y_(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,T);if(_.type==="MultiLineString"){let E=1/0;for(let C=0;C<_.coordinates.length;C++){const R=y_(_.coordinates[C],!0,w,T,E);if(isNaN(R))return R;if((E=Math.min(E,R))===0)return E}return E}if(_.type==="Polygon"||_.type==="MultiPolygon"){let E=1/0;for(let C=0;C<w.length;C++){const R=Up(w[C],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,T,E);if(isNaN(R))return R;if((E=Math.min(E,R))===0)return E}return E}return null}(s,u,this.geometries);if(i.geometryType()==="Polygon")return function(d,g,_){const w=[];for(const E of function(C,R){const M=C.length;if(M<=1)return[C];const z=[];let F,G;for(let H=0;H<M;H++){const K=nE(C[H]);K!==0&&(C[H].area=Math.abs(K),G===void 0&&(G=K<0),G===K<0?(F&&z.push(F),F=[C[H]]):F.push(C[H]))}return F&&z.push(F),z}(d)){const C=[];for(let R=0;R<E.length;++R)C.push(oE(E[R],g));w.push(C)}const T=new Oh(w[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Up(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",w,T);if(_.type==="MultiLineString"){let E=1/0;for(let C=0;C<_.coordinates.length;C++){const R=Up(_.coordinates[C],!0,w,T,E);if(isNaN(R))return R;if((E=Math.min(E,R))===0)return E}return E}return _.type==="Polygon"||_.type==="MultiPolygon"?function(E,C,R){let M=1/0;for(const z of E)for(const F of C){const G=hE(z,F,R,M);if(isNaN(G))return G;if((M=Math.min(M,G))===0)return M}return M}(_.type==="Polygon"?[_.coordinates]:_.coordinates,w,T):null}(s,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function zh(l){if(l instanceof Ws&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Wc||l instanceof Fu)return!1;if(l instanceof Nh)return l.featureConstant;let i=!0;return l.eachChild(s=>{i&&!zh(s)&&(i=!1)}),i}function jp(l){if(l instanceof Ws&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(s=>{i&&!jp(s)&&(i=!1)}),i}function Gp(l){if(l instanceof Nh)return new Set([l.key]);let i=new Set;return l.eachChild(s=>{i=new Set([...i,...Gp(s)])}),i}function Fh(l,i){if(l instanceof Ws&&i.indexOf(l.name)>=0)return!1;let s=!0;return l.eachChild(u=>{s&&!Fh(u,i)&&(s=!1)}),s}function f0(l,i,s){return[l,i,s].filter(Boolean).join("")}function x_(l,i){switch(l){case"string":return Hr(i);case"number":return+i;case"boolean":return!!i;case"color":return wi.parse(i);case"formatted":return Ot.fromString(Hr(i));case"resolvedImage":return Gi.build(Hr(i))}return i}function p0(l,i,s,u){return u!==void 0&&(l=u*Math.round(l/u)),i!==void 0&&l<i&&(l=i),s!==void 0&&l>s&&(l=s),l}class Nh{constructor(i,s,u,d=!1){this.type=i,this.key=s,this.scope=u,this.featureConstant=d}static parse(i,s){let u=s.expectedType;if(u==null&&(u=Pi),i.length<2||i.length>3)return s.error("Invalid number of arguments for 'config' expression.");const d=s.parse(i[1],1);if(!(d instanceof bn))return s.error("Key name of 'config' expression must be a string literal.");let g,_=!0;const w=Hr(d.value);if(i.length>=3){const T=s.parse(i[2],2);if(!(T instanceof bn))return s.error("Scope of 'config' expression must be a string literal.");g=Hr(T.value)}if(s.options){const T=f0(w,g,s._scope),E=s.options.get(T);E&&(_=zh(E.value||E.default))}return new Nh(u,w,g,_)}evaluate(i){const s=f0(this.key,this.scope,i.scope),u=i.getConfig(s);if(!u)return null;const{type:d,value:g,values:_,minValue:w,maxValue:T,stepValue:E}=u,C=u.default.evaluate(i);let R=C;if(g){const M=i.scope;i.scope=(M||"").split("").slice(1).join(""),R=g.evaluate(i),i.scope=M}return d&&(R=x_(d,R)),R===void 0||w===void 0&&T===void 0&&E===void 0||(typeof R=="number"?R=p0(R,w,T,E):Array.isArray(R)&&(R=R.map(M=>typeof M=="number"?p0(M,w,T,E):M))),g!==void 0&&R!==void 0&&_&&!_.includes(R)&&(R=C,d&&(R=x_(d,R))),(d&&d!==this.type||R!==void 0&&!ee(Ut(R),this.type))&&(R=x_(this.type.kind,R)),R}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class $p{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(i.length!==2||typeof i[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const u=i[1];return s.scope.has(u)?new $p(u,s.scope.get(u)):s.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Hp{constructor(i,s=[],u,d=new Du,g=[],_,w){this.registry=i,this.path=s,this.key=s.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=d,this.errors=g,this.expectedType=u,this._scope=_,this.options=w}parse(i,s,u,d,g={}){return s||u?this.concat(s,null,u,d)._parse(i,g):this._parse(i,g)}parseObjectValue(i,s,u,d,g,_={}){return this.concat(s,u,d,g)._parse(i,_)}_parse(i,s){function u(d,g,_){return _==="assert"?new yn(g,[d]):_==="coerce"?new qa(g,[d]):d}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(d){let g=d.parse(i,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,w=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||w.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(_,w))return null}else g=u(g,_,s.typeAnnotation||"coerce");else g=u(g,_,s.typeAnnotation||"assert")}if(!(g instanceof bn)&&g.type.kind!=="resolvedImage"&&w_(g)){const _=new hf(this._scope,this.options);try{g=new bn(g.type,g.evaluate(_))}catch(w){return this.error(w.message),null}}return g}return qa.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,u,d){let g=typeof i=="number"?this.path.concat(i):this.path;g=typeof s=="string"?g.concat(s):g;const _=d?this.scope.concat(d):this.scope;return new Hp(this.registry,g,u||null,_,this.errors,this._scope,this.options)}error(i,...s){const u=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new xo(u,i))}checkSubtype(i,s){const u=Ca(i,s);return u&&this.error(u),u}}function w_(l){if(l instanceof $p)return w_(l.boundExpression);if(l instanceof Ws&&l.name==="error"||l instanceof jl||l instanceof Wc||l instanceof Fu||l instanceof Nh)return!1;const i=l instanceof qa||l instanceof yn;let s=!0;return l.eachChild(u=>{s=i?s&&w_(u):s&&u instanceof bn}),!!s&&zh(l)&&Fh(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function qp(l,i){const s=l.length-1;let u,d,g=0,_=s,w=0;for(;g<=_;)if(w=Math.floor((g+_)/2),u=l[w],d=l[w+1],u<=i){if(w===s||i<d)return w;g=w+1}else{if(!(u>i))throw new ur("Input is not a number.");_=w-1}return 0}class gf{constructor(i,s,u){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[d,g]of u)this.labels.push(d),this.outputs.push(g)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const u=s.parse(i[1],1,on);if(!u)return null;const d=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let _=1;_<i.length;_+=2){const w=_===1?-1/0:i[_],T=i[_+1],E=_,C=_+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(d.length&&d[d.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const R=s.parse(T,C,g);if(!R)return null;g=g||R.type,d.push([w,R])}return new gf(g,u,d)}evaluate(i){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(i);const d=this.input.evaluate(i);if(d<=s[0])return u[0].evaluate(i);const g=s.length;return d>=s[g-1]?u[g-1].evaluate(i):u[qp(s,d)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i}}const m0=.95047,g0=1.08883,_0=4/29,Bh=6/29,y0=3*Bh*Bh,b_=Bh*Bh*Bh,fE=Math.PI/180,v0=180/Math.PI;function T_(l){return l>b_?Math.pow(l,1/3):l/y0+_0}function E_(l){return l>Bh?l*l*l:y0*(l-_0)}function I_(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function Wp(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function S_(l){const i=Wp(l.r),s=Wp(l.g),u=Wp(l.b),d=T_((.4124564*i+.3575761*s+.1804375*u)/m0),g=T_((.2126729*i+.7151522*s+.072175*u)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-T_((.0193339*i+.119192*s+.9503041*u)/g0)),alpha:l.a}}function Nu(l){let i=(l.l+16)/116,s=isNaN(l.a)?i:i+l.a/500,u=isNaN(l.b)?i:i-l.b/200;return i=1*E_(i),s=m0*E_(s),u=g0*E_(u),new wi(I_(3.2404542*s-1.5371385*i-.4985314*u),I_(-.969266*s+1.8760108*i+.041556*u),I_(.0556434*s-.2040259*i+1.0572252*u),l.alpha)}function x0(l,i,s){const u=i-l;return l+s*(u>180||u<-180?u-360*Math.round(u/360):u)}const Vh={forward:S_,reverse:Nu,interpolate:function(l,i,s){return{l:gn(l.l,i.l,s),a:gn(l.a,i.a,s),b:gn(l.b,i.b,s),alpha:gn(l.alpha,i.alpha,s)}}},_f={forward:function(l){const{l:i,a:s,b:u}=S_(l),d=Math.atan2(u,s)*v0;return{h:d<0?d+360:d,c:Math.sqrt(s*s+u*u),l:i,alpha:l.a}},reverse:function(l){const i=l.h*fE,s=l.c;return Nu({l:l.l,a:Math.cos(i)*s,b:Math.sin(i)*s,alpha:l.alpha})},interpolate:function(l,i,s){return{h:x0(l.h,i.h,s),c:gn(l.c,i.c,s),l:gn(l.l,i.l,s),alpha:gn(l.alpha,i.alpha,s)}}};var Zp=Object.freeze({__proto__:null,hcl:_f,lab:Vh});class Zo{constructor(i,s,u,d,g){this.type=i,this.operator=s,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[_,w]of g)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(i,s,u,d){let g=0;if(i.name==="exponential")g=A_(s,i.base,u,d);else if(i.name==="linear")g=A_(s,1,u,d);else if(i.name==="cubic-bezier"){const _=i.controlPoints;g=new Do(_[0],_[1],_[2],_[3]).solve(A_(s,1,u,d))}return g}static parse(i,s){let[u,d,g,..._]=i;if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const E=d[1];if(typeof E!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:E}}else{if(d[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const E=d.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:E}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,on),!g)return null;const w=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=zs:s.expectedType&&s.expectedType.kind!=="value"&&(T=s.expectedType);for(let E=0;E<_.length;E+=2){const C=_[E],R=_[E+1],M=E+3,z=E+4;if(typeof C!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(w.length&&w[w.length-1][0]>=C)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const F=s.parse(R,z,T);if(!F)return null;T=T||F.type,w.push([C,F])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Zo(T,u,d,g,w):s.error(`Type ${es(T)} is not interpolatable.`)}evaluate(i){const s=this.labels,u=this.outputs;if(s.length===1)return u[0].evaluate(i);const d=this.input.evaluate(i);if(d<=s[0])return u[0].evaluate(i);const g=s.length;if(d>=s[g-1])return u[g-1].evaluate(i);const _=qp(s,d),w=Zo.interpolationFactor(this.interpolation,d,s[_],s[_+1]),T=u[_].evaluate(i),E=u[_+1].evaluate(i);return this.operator==="interpolate"?Uc[this.type.kind.toLowerCase()](T,E,w):this.operator==="interpolate-hcl"?_f.reverse(_f.interpolate(_f.forward(T),_f.forward(E),w)):Vh.reverse(Vh.interpolate(Vh.forward(T),Vh.forward(E),w))}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const s=[this.operator,i,this.input.serialize()];for(let u=0;u<this.labels.length;u++)s.push(this.labels[u],this.outputs[u].serialize());return s}}function A_(l,i,s,u){const d=u-s,g=l-s;return d===0?0:i===1?g/d:(Math.pow(i,g)-1)/(Math.pow(i,d)-1)}class Xp{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expectected at least one argument.");let u=null;const d=s.expectedType;d&&d.kind!=="value"&&(u=d);const g=[];for(const w of i.slice(1)){const T=s.parse(w,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,g.push(T)}const _=d&&g.some(w=>Ca(d,w.type));return new Xp(_?Pi:u,g)}evaluate(i){let s,u=null,d=0;for(const g of this.args){if(d++,u=g.evaluate(i),u&&u instanceof Gi&&!u.available&&(s||(s=u),u=null,d===this.args.length))return s;if(u!==null)break}return u}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(s=>{i.push(s.serialize())}),i}}class yf{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const u=[];for(let g=1;g<i.length-1;g+=2){const _=i[g];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=s.parse(i[g+1],g+1);if(!w)return null;u.push([_,w])}const d=s.parse(i[i.length-1],i.length-1,s.expectedType,u);return d?new yf(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[s,u]of this.bindings)i.push(s,u.serialize());return i.push(this.result.serialize()),i}}class Kp{constructor(i,s,u){this.type=i,this.index=s,this.input=u}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=s.parse(i[1],1,on),d=s.parse(i[2],2,Fr(s.expectedType||Pi));return u&&d?new Kp(d.type.itemType,u,d):null}evaluate(i){const s=this.index.evaluate(i),u=this.input.evaluate(i);if(s<0)throw new ur(`Array index out of bounds: ${s} < 0.`);if(s>=u.length)throw new ur(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s!==Math.floor(s))throw new ur(`Array index must be an integer, but found ${s} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class C_{constructor(i,s,u){this.type=i,this.index=s,this.input=u}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=s.parse(i[1],1,on),d=s.parse(i[2],2,Fr(s.expectedType||Pi));return u&&d?new C_(d.type.itemType,u,d):null}evaluate(i){const s=this.index.evaluate(i),u=this.input.evaluate(i);if(s<0)throw new ur(`Array index out of bounds: ${s} < 0.`);if(s>u.length-1)throw new ur(`Array index out of bounds: ${s} > ${u.length-1}.`);if(s===Math.floor(s))return u[s];const d=Math.floor(s),g=Math.ceil(s),_=u[d],w=u[g];if(typeof _!="number"||typeof w!="number")throw new ur(`Cannot interpolate between non-number values at index ${s}.`);const T=s-d;return _*(1-T)+w*T}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class P_{constructor(i,s){this.type=Ai,this.needle=i,this.haystack=s}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=s.parse(i[1],1,Pi),d=s.parse(i[2],2,Pi);return u&&d?k(u.type,[Ai,Si,on,dc,Pi])?new P_(u,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${es(u.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(u==null)return!1;if(!W(s,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${es(Ut(s))} instead.`);if(!W(u,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${es(Ut(u))} instead.`);return u.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Yp{constructor(i,s,u){this.type=on,this.needle=i,this.haystack=s,this.fromIndex=u}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=s.parse(i[1],1,Pi),d=s.parse(i[2],2,Pi);if(!u||!d)return null;if(!k(u.type,[Ai,Si,on,dc,Pi]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${es(u.type)} instead`);if(i.length===4){const g=s.parse(i[3],3,on);return g?new Yp(u,d,g):null}return new Yp(u,d)}evaluate(i){const s=this.needle.evaluate(i),u=this.haystack.evaluate(i);if(!W(s,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${es(Ut(s))} instead.`);if(!W(u,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${es(Ut(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(i);return u.indexOf(s,d)}return u.indexOf(s)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Qp{constructor(i,s,u,d,g,_){this.inputType=i,this.type=s,this.input=u,this.cases=d,this.outputs=g,this.otherwise=_}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let u,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);const g={},_=[];for(let E=2;E<i.length-1;E+=2){let C=i[E];const R=i[E+1];Array.isArray(C)||(C=[C]);const M=s.concat(E);if(C.length===0)return M.error("Expected at least one branch label.");for(const F of C){if(typeof F!="number"&&typeof F!="string")return M.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return M.error("Numeric branch labels must be integer values.");if(u){if(M.checkSubtype(u,Ut(F)))return null}else u=Ut(F);if(g[String(F)]!==void 0)return M.error("Branch labels must be unique.");g[String(F)]=_.length}const z=s.parse(R,E,d);if(!z)return null;d=d||z.type,_.push(z)}const w=s.parse(i[1],1,Pi);if(!w)return null;const T=s.parse(i[i.length-1],i.length-1,d);return T?w.type.kind!=="value"&&s.concat(1).checkSubtype(u,w.type)?null:new Qp(u,d,w,g,_,T):null}evaluate(i){const s=this.input.evaluate(i);return(ee(Ut(s),this.inputType)&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),u=[],d={};for(const _ of s){const w=d[this.cases[_]];w===void 0?(d[this.cases[_]]=u.length,u.push([this.cases[_],[_]])):u[w][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,w]of u)i.push(w.length===1?g(w[0]):w.map(g)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}class Jp{constructor(i,s,u){this.type=i,this.branches=s,this.otherwise=u}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let u;s.expectedType&&s.expectedType.kind!=="value"&&(u=s.expectedType);const d=[];for(let _=1;_<i.length-1;_+=2){const w=s.parse(i[_],_,Ai);if(!w)return null;const T=s.parse(i[_+1],_+1,u);if(!T)return null;d.push([w,T]),u=u||T.type}const g=s.parse(i[i.length-1],i.length-1,u);return g?new Jp(u,d,g):null}evaluate(i){for(const[s,u]of this.branches)if(s.evaluate(i))return u.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,u]of this.branches)i(s),i(u);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(s=>{i.push(s.serialize())}),i}}class Bu{constructor(i,s,u,d){this.type=i,this.input=s,this.beginIndex=u,this.endIndex=d}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const u=s.parse(i[1],1,Pi),d=s.parse(i[2],2,on);if(!u||!d)return null;if(!k(u.type,[Fr(Pi),Si,Pi]))return s.error(`Expected first argument to be of type array or string, but found ${es(u.type)} instead`);if(i.length===4){const g=s.parse(i[3],3,on);return g?new Bu(u.type,u,d,g):null}return new Bu(u.type,u,d)}evaluate(i){const s=this.input.evaluate(i),u=this.beginIndex.evaluate(i);if(!W(s,["string","array"]))throw new ur(`Expected first argument to be of type array or string, but found ${es(Ut(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(i);return s.slice(u,d)}return s.slice(u)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class R_{constructor(i,s){this.type=Fr(Si),this.str=i,this.delimiter=s}static parse(i,s){if(i.length!==3)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const u=s.parse(i[1],1,Si),d=s.parse(i[2],2,Si);return u&&d?new R_(u,d):void 0}evaluate(i){const s=this.str.evaluate(i),u=this.delimiter.evaluate(i);return s.split(u)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function k_(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function w0(l,i,s,u){return u.compare(i,s)===0}function Uh(l,i,s){const u=l!=="=="&&l!=="!=";return class Rj{constructor(g,_,w){this.type=Ai,this.lhs=g,this.rhs=_,this.collator=w,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const w=g[0];let T=_.parse(g[1],1,Pi);if(!T)return null;if(!k_(w,T.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${es(T.type)}'.`);let E=_.parse(g[2],2,Pi);if(!E)return null;if(!k_(w,E.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${es(E.type)}'.`);if(T.type.kind!==E.type.kind&&T.type.kind!=="value"&&E.type.kind!=="value")return _.error(`Cannot compare types '${es(T.type)}' and '${es(E.type)}'.`);u&&(T.type.kind==="value"&&E.type.kind!=="value"?T=new yn(E.type,[T]):T.type.kind!=="value"&&E.type.kind==="value"&&(E=new yn(T.type,[E])));let C=null;if(g.length===4){if(T.type.kind!=="string"&&E.type.kind!=="string"&&T.type.kind!=="value"&&E.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(C=_.parse(g[3],3,Lu),!C)return null}return new Rj(T,E,C)}evaluate(g){const _=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const T=Ut(_),E=Ut(w);if(T.kind!==E.kind||T.kind!=="string"&&T.kind!=="number")throw new ur(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${T.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=Ut(_),E=Ut(w);if(T.kind!=="string"||E.kind!=="string")return i(g,_,w)}return this.collator?s(g,_,w,this.collator.evaluate(g)):i(g,_,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[l];return this.eachChild(_=>{g.push(_.serialize())}),g}}}const b0=Uh("==",function(l,i,s){return i===s},w0),T0=Uh("!=",function(l,i,s){return i!==s},function(l,i,s,u){return!w0(0,i,s,u)}),pE=Uh("<",function(l,i,s){return i<s},function(l,i,s,u){return u.compare(i,s)<0}),mE=Uh(">",function(l,i,s){return i>s},function(l,i,s,u){return u.compare(i,s)>0}),gE=Uh("<=",function(l,i,s){return i<=s},function(l,i,s,u){return u.compare(i,s)<=0}),em=Uh(">=",function(l,i,s){return i>=s},function(l,i,s,u){return u.compare(i,s)>=0});class M_{constructor(i,s,u,d,g,_){this.type=Si,this.number=i,this.locale=s,this.currency=u,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(i,s){if(i.length!==3)return s.error("Expected two arguments.");const u=s.parse(i[1],1,on);if(!u)return null;const d=i[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=s.parseObjectValue(d.locale,2,"locale",Si),!g))return null;let _=null;if(d.currency&&(_=s.parseObjectValue(d.currency,2,"currency",Si),!_))return null;let w=null;if(d.unit&&(w=s.parseObjectValue(d.unit,2,"unit",Si),!w))return null;let T=null;if(d["min-fraction-digits"]&&(T=s.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",on),!T))return null;let E=null;return d["max-fraction-digits"]&&(E=s.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",on),!E)?null:new M_(u,g,_,w,T,E)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class D_{constructor(i){this.type=on,this.input=i}static parse(i,s){if(i.length!==2)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const u=s.parse(i[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${es(u.type)} instead.`):new D_(u):null}evaluate(i){const s=this.input.evaluate(i);if(typeof s=="string"||Array.isArray(s))return s.length;throw new ur(`Expected value to be of type string or array, but found ${es(Ut(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(s=>{i.push(s.serialize())}),i}}function E0(l){return function(){l=1831565813+(l|=0)|0;let i=Math.imul(l^l>>>15,1|l);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const jh={"==":b0,"!=":T0,">":mE,"<":pE,">=":em,"<=":gE,array:yn,at:Kp,"at-interpolated":C_,boolean:yn,case:Jp,coalesce:Xp,collator:jl,format:Rh,image:kh,in:P_,"index-of":Yp,interpolate:Zo,"interpolate-hcl":Zo,"interpolate-lab":Zo,length:D_,let:yf,literal:bn,match:Qp,number:yn,"number-format":M_,object:yn,slice:Bu,step:gf,string:yn,"to-boolean":qa,"to-color":qa,"to-number":qa,"to-string":qa,var:$p,within:Wc,distance:Fu,config:Nh,split:R_};function L_(l,[i,s,u,d]){i=i.evaluate(l),s=s.evaluate(l),u=u.evaluate(l);const g=d?d.evaluate(l):1,_=us(i,s,u,g);if(_)throw new ur(_);return new wi(i/255,s/255,u/255,g)}function I0(l,[i,s,u,d]){i=i.evaluate(l),s=s.evaluate(l),u=u.evaluate(l);const g=d?d.evaluate(l):1,_=function(E,C,R,M){return typeof E=="number"&&E>=0&&E<=360?typeof C=="number"&&C>=0&&C<=100&&typeof R=="number"&&R>=0&&R<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[E,C,R,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[E,C,R,M]:[E,C,R]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[E,C,R,M]:[E,C,R]).join(", ")}]: 'h' must be between 0 and 360.`}(i,s,u,g);if(_)throw new ur(_);const w=`hsla(${i}, ${s}%, ${u}%, ${g})`,T=wi.parse(w);if(!T)throw new ur(`Failed to parse HSLA color: ${w}`);return T}function S0(l,i){return l in i}function tm(l,i){const s=i[l];return s===void 0?null:s}function Xc(l){return{type:l}}function O_(l){return{result:"success",value:l}}function Kc(l){return{result:"error",value:l}}function Yc(l,i){return!!l&&!!l.parameters&&l.parameters.indexOf(i)>-1}function nm(l){return l["property-type"]==="data-driven"}function A0(l){return Yc(l.expression,"measure-light")}function C0(l){return Yc(l.expression,"zoom")}function im(l){return!!l.expression&&l.expression.interpolated}function rm(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function P0(l){return l}function z_(l,i){const s=i.type==="color",u=l.stops&&typeof l.stops[0][0]=="object",d=u||!(u||l.property!==void 0),g=l.type||(im(i)?"exponential":"interval");if(s&&((l=Bl({},l)).stops&&(l.stops=l.stops.map(E=>[E[0],wi.parse(E[1])])),l.default=wi.parse(l.default?l.default:i.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Zp[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let _,w,T;if(g==="exponential")_=k0;else if(g==="interval")_=R0;else if(g==="categorical"){_=F_,w=Object.create(null);for(const E of l.stops)w[E[0]]=E[1];T=typeof l.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=Qc}if(u){const E={},C=[];for(let z=0;z<l.stops.length;z++){const F=l.stops[z],G=F[0].zoom;E[G]===void 0&&(E[G]={zoom:G,type:l.type,property:l.property,default:l.default,stops:[]},C.push(G)),E[G].stops.push([F[0].value,F[1]])}const R=[];for(const z of C)R.push([E[z].zoom,z_(E[z],i)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Zo.interpolationFactor.bind(void 0,M),zoomStops:R.map(z=>z[0]),evaluate:({zoom:z},F)=>k0({stops:R,base:l.base},i,z).evaluate(z,F)}}if(d){const E=g==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Zo.interpolationFactor.bind(void 0,E),zoomStops:l.stops.map(C=>C[0]),evaluate:({zoom:C})=>_(l,i,C,w,T)}}return{kind:"source",evaluate(E,C){const R=C&&C.properties?C.properties[l.property]:void 0;return R===void 0?Vu(l.default,i.default):_(l,i,R,w,T)}}}function Vu(l,i,s){return l!==void 0?l:i!==void 0?i:s!==void 0?s:void 0}function F_(l,i,s,u,d){return Vu(typeof s===d?u[s]:void 0,l.default,i.default)}function R0(l,i,s){if(Gc(s)!=="number")return Vu(l.default,i.default);const u=l.stops.length;if(u===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[u-1][0])return l.stops[u-1][1];const d=qp(l.stops.map(g=>g[0]),s);return l.stops[d][1]}function k0(l,i,s){const u=l.base!==void 0?l.base:1;if(Gc(s)!=="number")return Vu(l.default,i.default);const d=l.stops.length;if(d===1||s<=l.stops[0][0])return l.stops[0][1];if(s>=l.stops[d-1][0])return l.stops[d-1][1];const g=qp(l.stops.map(C=>C[0]),s),_=function(C,R,M,z){const F=z-M,G=C-M;return F===0?0:R===1?G/F:(Math.pow(R,G)-1)/(Math.pow(R,F)-1)}(s,u,l.stops[g][0],l.stops[g+1][0]),w=l.stops[g][1],T=l.stops[g+1][1];let E=Uc[i.type]||P0;if(l.colorSpace&&l.colorSpace!=="rgb"){const C=Zp[l.colorSpace];E=(R,M)=>C.reverse(C.interpolate(C.forward(R),C.forward(M),_))}return typeof w.evaluate=="function"?{evaluate(...C){const R=w.evaluate.apply(void 0,C),M=T.evaluate.apply(void 0,C);if(R!==void 0&&M!==void 0)return E(R,M,_)}}:E(w,T,_)}function Qc(l,i,s){return i.type==="color"?s=wi.parse(s):i.type==="formatted"?s=Ot.fromString(s.toString()):i.type==="resolvedImage"?s=Gi.build(s.toString()):Gc(s)===i.type||i.type==="enum"&&i.values[s]||(s=void 0),Vu(s,l.default,i.default)}Ws.register(jh,{error:[{kind:"error"},[Si],(l,[i])=>{throw new ur(i.evaluate(l))}],typeof:[Si,[Pi],(l,[i])=>es(Ut(i.evaluate(l)))],"to-rgba":[Fr(on,4),[zs],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Fr(on,4),[zs],(l,[i])=>i.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[zs,[on,on,on],L_],rgba:[zs,[on,on,on,on],L_],hsl:[zs,[on,on,on],I0],hsla:[zs,[on,on,on,on],I0],has:{type:Ai,overloads:[[[Si],(l,[i])=>S0(i.evaluate(l),l.properties())],[[Si,Ha],(l,[i,s])=>S0(i.evaluate(l),s.evaluate(l))]]},get:{type:Pi,overloads:[[[Si],(l,[i])=>tm(i.evaluate(l),l.properties())],[[Si,Ha],(l,[i,s])=>tm(i.evaluate(l),s.evaluate(l))]]},"feature-state":[Pi,[Si],(l,[i])=>tm(i.evaluate(l),l.featureState||{})],properties:[Ha,[],l=>l.properties()],"geometry-type":[Si,[],l=>l.geometryType()],worldview:[Si,[],l=>l.globals.worldview||""],id:[Pi,[],l=>l.id()],zoom:[on,[],l=>l.globals.zoom],pitch:[on,[],l=>l.globals.pitch||0],"distance-from-center":[on,[],l=>l.distanceFromCenter()],"measure-light":[on,[Si],(l,[i])=>l.measureLight(i.evaluate(l))],"heatmap-density":[on,[],l=>l.globals.heatmapDensity||0],"line-progress":[on,[],l=>l.globals.lineProgress||0],"raster-value":[on,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[on,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[on,[],l=>l.globals.skyRadialProgress||0],accumulated:[Pi,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[on,Xc(on),(l,i)=>{let s=0;for(const u of i)s+=u.evaluate(l);return s}],"*":[on,Xc(on),(l,i)=>{let s=1;for(const u of i)s*=u.evaluate(l);return s}],"-":{type:on,overloads:[[[on,on],(l,[i,s])=>i.evaluate(l)-s.evaluate(l)],[[on],(l,[i])=>-i.evaluate(l)]]},"/":[on,[on,on],(l,[i,s])=>i.evaluate(l)/s.evaluate(l)],"%":[on,[on,on],(l,[i,s])=>i.evaluate(l)%s.evaluate(l)],ln2:[on,[],()=>Math.LN2],pi:[on,[],()=>Math.PI],e:[on,[],()=>Math.E],"^":[on,[on,on],(l,[i,s])=>Math.pow(i.evaluate(l),s.evaluate(l))],sqrt:[on,[on],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[on,[on],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[on,[on],(l,[i])=>Math.log(i.evaluate(l))],log2:[on,[on],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[on,[on],(l,[i])=>Math.sin(i.evaluate(l))],cos:[on,[on],(l,[i])=>Math.cos(i.evaluate(l))],tan:[on,[on],(l,[i])=>Math.tan(i.evaluate(l))],asin:[on,[on],(l,[i])=>Math.asin(i.evaluate(l))],acos:[on,[on],(l,[i])=>Math.acos(i.evaluate(l))],atan:[on,[on],(l,[i])=>Math.atan(i.evaluate(l))],min:[on,Xc(on),(l,i)=>Math.min(...i.map(s=>s.evaluate(l)))],max:[on,Xc(on),(l,i)=>Math.max(...i.map(s=>s.evaluate(l)))],abs:[on,[on],(l,[i])=>Math.abs(i.evaluate(l))],round:[on,[on],(l,[i])=>{const s=i.evaluate(l);return s<0?-Math.round(-s):Math.round(s)}],floor:[on,[on],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[on,[on],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[Ai,[Si,Pi],(l,[i,s])=>l.properties()[i.value]===s.value],"filter-id-==":[Ai,[Pi],(l,[i])=>l.id()===i.value],"filter-type-==":[Ai,[Si],(l,[i])=>l.geometryType()===i.value],"filter-<":[Ai,[Si,Pi],(l,[i,s])=>{const u=l.properties()[i.value],d=s.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Ai,[Pi],(l,[i])=>{const s=l.id(),u=i.value;return typeof s==typeof u&&s<u}],"filter->":[Ai,[Si,Pi],(l,[i,s])=>{const u=l.properties()[i.value],d=s.value;return typeof u==typeof d&&u>d}],"filter-id->":[Ai,[Pi],(l,[i])=>{const s=l.id(),u=i.value;return typeof s==typeof u&&s>u}],"filter-<=":[Ai,[Si,Pi],(l,[i,s])=>{const u=l.properties()[i.value],d=s.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Ai,[Pi],(l,[i])=>{const s=l.id(),u=i.value;return typeof s==typeof u&&s<=u}],"filter->=":[Ai,[Si,Pi],(l,[i,s])=>{const u=l.properties()[i.value],d=s.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Ai,[Pi],(l,[i])=>{const s=l.id(),u=i.value;return typeof s==typeof u&&s>=u}],"filter-has":[Ai,[Pi],(l,[i])=>i.value in l.properties()],"filter-has-id":[Ai,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Ai,[Fr(Si)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[Ai,[Fr(Pi)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[Ai,[Si,Fr(Pi)],(l,[i,s])=>s.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[Ai,[Si,Fr(Pi)],(l,[i,s])=>function(u,d,g,_){for(;g<=_;){const w=g+_>>1;if(d[w]===u)return!0;d[w]>u?_=w-1:g=w+1}return!1}(l.properties()[i.value],s.value,0,s.value.length-1)],all:{type:Ai,overloads:[[[Ai,Ai],(l,[i,s])=>i.evaluate(l)&&s.evaluate(l)],[Xc(Ai),(l,i)=>{for(const s of i)if(!s.evaluate(l))return!1;return!0}]]},any:{type:Ai,overloads:[[[Ai,Ai],(l,[i,s])=>i.evaluate(l)||s.evaluate(l)],[Xc(Ai),(l,i)=>{for(const s of i)if(s.evaluate(l))return!0;return!1}]]},"!":[Ai,[Ai],(l,[i])=>!i.evaluate(l)],"is-supported-script":[Ai,[Si],(l,[i])=>{const s=l.globals&&l.globals.isSupportedScript;return!s||s(i.evaluate(l))}],upcase:[Si,[Si],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[Si,[Si],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[Si,Xc(Pi),(l,i)=>i.map(s=>Hr(s.evaluate(l))).join("")],"resolved-locale":[Si,[Lu],(l,[i])=>i.evaluate(l).resolvedLocale()],random:[on,[on,on,Pi],(l,i)=>{const[s,u,d]=i.map(_=>_.evaluate(l));if(s>u||s===u)return s;let g;if(typeof d=="string")g=function(_){let w=0;if(_.length===0)return w;for(let T=0;T<_.length;T++)w=(w<<5)-w+_.charCodeAt(T),w|=0;return w}(d);else{if(typeof d!="number")throw new ur(`Invalid seed input: ${d}`);g=d}return s+E0(g)()*(u-s)}]});class N_{constructor(i,s,u,d){this.expression=i,this._warningHistory={},this._evaluator=new hf(u,d),this._defaultValue=s?function(g){return g.type==="color"&&(rm(g.default)||Array.isArray(g.default))?new wi(0,0,0,0):g.type==="color"?wi.parse(g.default)||null:g.default===void 0?null:g.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null,this.configDependencies=Gp(i)}evaluateWithoutErrorHandling(i,s,u,d,g,_,w,T){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(i,s,u,d,g,_,w,T){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function B_(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in jh}function Uu(l,i,s,u){const d=new Hp(jh,[],i?function(_){const w={color:zs,string:Si,number:on,enum:Si,boolean:Ai,formatted:jc,resolvedImage:Vl};return _.type==="array"?Fr(w[_.value]||Pi,_.length):w[_.type]}(i):void 0,void 0,void 0,s,u),g=d.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?O_(new N_(g,i,s,u)):Kc(d.errors)}class sm{constructor(i,s,u,d){this.kind=i,this._styleExpression=s,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=i!=="constant"&&!jp(s.expression),this.configDependencies=Gp(s.expression)}evaluateWithoutErrorHandling(i,s,u,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(i,s,u,d,g,_)}evaluate(i,s,u,d,g,_){return this._styleExpression.evaluate(i,s,u,d,g,_)}}class Jc{constructor(i,s,u,d,g,_){this.kind=i,this.zoomStops=u,this._styleExpression=s,this.isStateDependent=i!=="camera"&&!jp(s.expression),this.isLightConstant=g,this.isLineProgressConstant=_,this.configDependencies=Gp(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(i,s,u,d,g,_){return this._styleExpression.evaluateWithoutErrorHandling(i,s,u,d,g,_)}evaluate(i,s,u,d,g,_){return this._styleExpression.evaluate(i,s,u,d,g,_)}interpolationFactor(i,s,u){return this.interpolationType?Zo.interpolationFactor(this.interpolationType,i,s,u):0}}function V_(l,i,s,u){if((l=Uu(l,i,s,u)).result==="error")return l;const d=l.value.expression,g=zh(d);if(!g&&!nm(i))return Kc([new xo("","data expressions not supported")]);const _=Fh(d,["zoom","pitch","distance-from-center"]);if(!_&&!C0(i))return Kc([new xo("","zoom expressions not supported")]);const w=Fh(d,["measure-light"]);if(!w&&!A0(i))return Kc([new xo("","measure-light expression not supported")]);const T=Fh(d,["line-progress"]);if(!T&&!function(R){return Yc(R.expression,"line-progress")}(i))return Kc([new xo("","line-progress expression not supported")]);const E=i.expression&&i.expression.relaxZoomRestriction,C=vf(d);return C||_||E?C instanceof xo?Kc([C]):C instanceof Zo&&!im(i)?Kc([new xo("",'"interpolate" expressions cannot be used with this property')]):O_(C?new Jc(g&&T?"camera":"composite",l.value,C.labels,C instanceof Zo?C.interpolation:void 0,w,T):new sm(g&&T?"constant":"source",l.value,w,T)):Kc([new xo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ju{constructor(i,s){this._parameters=i,this._specification=s,Bl(this,z_(this._parameters,this._specification))}static deserialize(i){return new ju(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function vf(l){let i=null;if(l instanceof yf)i=vf(l.result);else if(l instanceof Xp){for(const s of l.args)if(i=vf(s),i)break}else(l instanceof gf||l instanceof Zo)&&l.input instanceof Ws&&l.input.name==="zoom"&&(i=l);return i instanceof xo||l.eachChild(s=>{const u=vf(s);u instanceof xo?i=u:i&&u&&i!==u&&(i=new xo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var U_,M0,j_=function(){if(M0)return U_;M0=1,U_=i;var l=3;function i(s,u,d){var g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var _=new Int32Array(this.arrayBuffer);s=_[0],this.d=(u=_[1])+2*(d=_[2]);for(var w=0;w<this.d*this.d;w++){var T=_[l+w],E=_[l+w+1];g.push(T===E?null:_.subarray(T,E))}var C=_[l+g.length+1];this.keys=_.subarray(_[l+g.length],C),this.bboxes=_.subarray(C),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var R=0;R<this.d*this.d;R++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=d,this.scale=u/s,this.uid=0;var M=d/u*s;this.min=-M,this.max=s+M}return i.prototype.insert=function(s,u,d,g,_){this._forEachCell(u,d,g,_,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(_)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(s,u,d,g,_,w){this.cells[_].push(w)},i.prototype.query=function(s,u,d,g,_){var w=this.min,T=this.max;if(s<=w&&u<=w&&T<=d&&T<=g&&!_)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(s,u,d,g,this._queryCell,E,{},_),E},i.prototype._queryCell=function(s,u,d,g,_,w,T,E){var C=this.cells[_];if(C!==null)for(var R=this.keys,M=this.bboxes,z=0;z<C.length;z++){var F=C[z];if(T[F]===void 0){var G=4*F;(E?E(M[G+0],M[G+1],M[G+2],M[G+3]):s<=M[G+2]&&u<=M[G+3]&&d>=M[G+0]&&g>=M[G+1])?(T[F]=!0,w.push(R[F])):T[F]=!1}}},i.prototype._forEachCell=function(s,u,d,g,_,w,T,E){for(var C=this._convertToCellCoord(s),R=this._convertToCellCoord(u),M=this._convertToCellCoord(d),z=this._convertToCellCoord(g),F=C;F<=M;F++)for(var G=R;G<=z;G++){var H=this.d*G+F;if((!E||E(this._convertFromCellCoord(F),this._convertFromCellCoord(G),this._convertFromCellCoord(F+1),this._convertFromCellCoord(G+1)))&&_.call(this,s,u,d,g,H,w,T,E))return}},i.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},i.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=l+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var _=new Int32Array(u+d+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var w=u,T=0;T<s.length;T++){var E=s[T];_[l+T]=w,_.set(E,w),w+=E.length}return _[l+s.length]=w,_.set(this.keys,w),_[l+s.length+1]=w+=this.keys.length,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer},U_}(),eu=dl(j_);const xf={};function Xt(l,i,s={}){Object.defineProperty(l,"_classRegistryKey",{value:i,writable:!1}),xf[i]={klass:l,omit:s.omit||[]}}Xt(Object,"Object"),eu.serialize=function(l,i){const s=l.toArrayBuffer();return i&&i.add(s),{buffer:s}},eu.deserialize=function(l){return new eu(l.buffer)},Object.defineProperty(eu,"name",{value:"Grid"}),Xt(eu,"Grid"),delete bt.prototype.constructor,typeof DOMMatrix<"u"&&Xt(DOMMatrix,"DOMMatrix"),Xt(wi,"Color"),Xt(Error,"Error"),Xt(Ot,"Formatted"),Xt(vt,"FormattedSection"),Xt(_i,"AJAXError"),Xt(Gi,"ResolvedImage"),Xt(ju,"StylePropertyFunction"),Xt(N_,"StyleExpression",{omit:["_evaluator"]}),Xt(Oo,"ImageId"),Xt(xn,"ImageVariant"),Xt(Jc,"ZoomDependentExpression"),Xt(sm,"ZoomConstantExpression"),Xt(Ws,"CompoundExpression",{omit:["_evaluate"]});for(const l in jh)xf[jh[l]._classRegistryKey]||Xt(jh[l],`Expression${l}`);function om(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function wf(l){return self.ImageBitmap&&l instanceof ImageBitmap}function fc(l,i){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(om(l)||wf(l))return i&&i.add(l),l;if(ArrayBuffer.isView(l))return i&&i.add(l.buffer),l;if(l instanceof ImageData)return i&&i.add(l.data.buffer),l;if(Array.isArray(l)){const s=[];for(const u of l)s.push(fc(u,i));return s}if(l instanceof Map){const s={$name:"Map",entries:[]};for(const[u,d]of l.entries())s.entries.push(fc(u),fc(d,i));return s}if(l instanceof Set){const s={$name:"Set"};let u=0;for(const d of l.values())s[++u]=fc(d);return s}if(l instanceof DOMMatrix){const s={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const d of u)s[d]=l[d];return s}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const s=l.constructor,u=s._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${s.name}".`);const d=s.serialize?s.serialize(l,i):{};if(!s.serialize){for(const g in l)l.hasOwnProperty(g)&&(xf[u].omit.indexOf(g)>=0||(d[g]=fc(l[g],i)));l instanceof Error&&(d.message=l.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof l)}function Xo(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||om(l)||wf(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Xo);if(typeof l=="object"){const i=l.$name||"Object";if(i==="Map"){const d=l.entries||[],g=new Map;for(let _=0;_<d.length;_+=2)g.set(Xo(d[_]),Xo(d[_+1]));return g}if(i==="Set"){const d=new Set;for(const g of Object.keys(l))g!=="$name"&&d.add(Xo(l[g]));return d}if(i==="DOMMatrix"){let d;return d=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(d)}if(i==="BigInt")return BigInt(l.value);const{klass:s}=xf[i];if(!s)throw new Error(`Can't deserialize unregistered class "${i}".`);if(s.deserialize)return s.deserialize(l);const u=Object.create(s.prototype);for(const d of Object.keys(l))d!=="$name"&&(u[d]=Xo(l[d]));return u}throw new Error("can't deserialize object of type "+typeof l)}const In={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function G_(l){for(const i of l)if(am(i.charCodeAt(0)))return!0;return!1}function _E(l){for(const i of l)if(!yE(i.charCodeAt(0)))return!1;return!0}function yE(l){return!(In.Arabic(l)||In["Arabic Supplement"](l)||In["Arabic Extended-A"](l)||In["Arabic Presentation Forms-A"](l)||In["Arabic Presentation Forms-B"](l))}function am(l){return!(l!==746&&l!==747&&(l<4352||!(In["Bopomofo Extended"](l)||In.Bopomofo(l)||In["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||In["CJK Compatibility Ideographs"](l)||In["CJK Compatibility"](l)||In["CJK Radicals Supplement"](l)||In["CJK Strokes"](l)||!(!In["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||In["CJK Unified Ideographs Extension A"](l)||In["CJK Unified Ideographs"](l)||In["Enclosed CJK Letters and Months"](l)||In["Hangul Compatibility Jamo"](l)||In["Hangul Jamo Extended-A"](l)||In["Hangul Jamo Extended-B"](l)||In["Hangul Jamo"](l)||In["Hangul Syllables"](l)||In.Hiragana(l)||In["Ideographic Description Characters"](l)||In.Kanbun(l)||In["Kangxi Radicals"](l)||In["Katakana Phonetic Extensions"](l)||In.Katakana(l)&&l!==12540||!(!In["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!In["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||In["Unified Canadian Aboriginal Syllabics"](l)||In["Unified Canadian Aboriginal Syllabics Extended"](l)||In["Vertical Forms"](l)||In["Yijing Hexagram Symbols"](l)||In["Yi Syllables"](l)||In["Yi Radicals"](l))))}function lm(l){return!(am(l)||function(i){return!!(In["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||In["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||In["Letterlike Symbols"](i)||In["Number Forms"](i)||In["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||In["Control Pictures"](i)&&i!==9251||In["Optical Character Recognition"](i)||In["Enclosed Alphanumerics"](i)||In["Geometric Shapes"](i)||In["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||In["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||In["CJK Symbols and Punctuation"](i)||In.Katakana(i)||In["Private Use Area"](i)||In["CJK Compatibility Forms"](i)||In["Small Form Variants"](i)||In["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}function D0(l){return In.Arabic(l)||In["Arabic Supplement"](l)||In["Arabic Extended-A"](l)||In["Arabic Presentation Forms-A"](l)||In["Arabic Presentation Forms-B"](l)}function cm(l){return l>=1424&&l<=2303||In["Arabic Presentation Forms-A"](l)||In["Arabic Presentation Forms-B"](l)}function vE(l,i){return!(!i&&cm(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||In.Khmer(l))}function xE(l){for(const i of l)if(cm(i.charCodeAt(0)))return!0;return!1}const oa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let $_=null,Fo=oa.unavailable,tu=null;const L0=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Fo=oa.error),$_&&$_(l)};function H_(){q_.fire(new $a("pluginStateChange",{pluginStatus:Fo,pluginURL:tu}))}const q_=new Nl,W_=function(){return Fo},O0=function(){if(Fo!==oa.deferred||!tu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Fo=oa.loading,H_(),tu&&Pu({url:tu},l=>{l?L0(l):(Fo=oa.loaded,H_())})},Gl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Fo===oa.loaded||Gl.applyArabicShaping!=null,isLoading:()=>Fo===oa.loading,setState(l){Fo=l.pluginStatus,tu=l.pluginURL},isParsing:()=>Fo===oa.parsing,isParsed:()=>Fo===oa.parsed,getPluginURL:()=>tu};class Zi{constructor(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness,this.worldview=s.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(s,u){for(const d of s)if(!vE(d.charCodeAt(0),u))return!1;return!0}(i,Gl.isLoaded())}}class bf{constructor(i,s,u,d){this.property=i,this.value=s,this.expression=function(g,_,w,T){if(rm(g))return new ju(g,_);if(B_(g)||Array.isArray(g)&&g.length>0){const E=V_(g,_,w,T);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));return E.value}{let E=g;return typeof g=="string"&&_.type==="color"&&(E=wi.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(s===void 0?i.specification.default:s,i.specification,u,d)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,s,u){return this.property.possiblyEvaluate(this,i,s,u)}}class um{constructor(i,s,u){this.property=i,this.value=new bf(i,void 0,s,u)}transitioned(i,s){return new z0(this.property,this.value,s,Xe({},i.transition,this.transition),i.now)}untransitioned(){return new z0(this.property,this.value,null,{},0)}}class Tf{constructor(i,s,u){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(i){return Nn(this._values[i].value.value)}setValue(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new um(this._values[i].property,this._scope,this._options)),this._values[i].value=new bf(this._values[i].property,s===null?void 0:Nn(s),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,s){s&&(this._options=s);const u=this._properties.properties;if(i)for(const d in i){const g=i[d];if(d.endsWith("-transition")){const _=d.slice(0,-11);u[_]&&this.setTransition(_,g)}else u.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(i){return Nn(this._values[i].transition)}setTransition(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new um(this._values[i].property)),this._values[i].transition=Nn(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(i[s]=u);const d=this.getTransition(s);d!==void 0&&(i[`${s}-transition`]=d)}return i}transitioned(i,s){const u=new F0(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(i,s._values[d]);return u}untransitioned(){const i=new F0(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class z0{constructor(i,s,u,d,g){const _=d.delay||0,w=d.duration||0;g=g||0,this.property=i,this.value=s,this.begin=g+_,this.end=this.begin+w,i.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(i,s,u){const d=i.now||0,g=this.value.possiblyEvaluate(i,s,u),_=this.prior;if(_){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return _.possiblyEvaluate(i,s,u);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,s,u),g,J(w))}}return g}}class F0{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,u){const d=new vl(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(i,s,u);return d}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class nu{constructor(i,s,u){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=s,this._options=u,this.configDependencies=new Set}getValue(i){return Nn(this._values[i].value)}setValue(i,s){this._values[i]=new bf(this._values[i].property,s===null?void 0:Nn(s),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const s of Object.keys(this._values)){const u=this.getValue(s);u!==void 0&&(i[s]=u)}return i}possiblyEvaluate(i,s,u){const d=new vl(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(i,s,u);return d}}class Gu{constructor(i,s,u){this.property=i,this.value=s,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,s,u,d){return this.property.evaluate(this.value,this.parameters,i,s,u,d)}}class vl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Lt{constructor(i){this.specification=i}possiblyEvaluate(i,s){return i.expression.evaluate(s)}interpolate(i,s,u){const d=Uc[this.specification.type];return d?d(i,s,u):i}}class Ht{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,u,d){return new Gu(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(s,null,{},u,d)}:i.expression,s)}interpolate(i,s,u){if(i.value.kind!=="constant"||s.value.kind!=="constant")return i;if(i.value.value===void 0||s.value.value===void 0)return new Gu(this,{kind:"constant",value:void 0},i.parameters);const d=Uc[this.specification.type];return d?new Gu(this,{kind:"constant",value:d(i.value.value,s.value.value,u)},i.parameters):i}evaluate(i,s,u,d,g,_){return i.kind==="constant"?i.value:i.evaluate(s,u,d,g,_)}}class Gh{constructor(i){this.specification=i}possiblyEvaluate(i,s,u,d){return!!i.expression.evaluate(s,null,{},u,d)}interpolate(){return!1}}class Gr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new Zi(0,{});for(const u in i){const d=i[u];d.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new bf(d,void 0),_=this.defaultTransitionablePropertyValues[u]=new um(d);this.defaultTransitioningPropertyValues[u]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(s)}}}Xt(Ht,"DataDrivenProperty"),Xt(Lt,"DataConstantProperty"),Xt(Gh,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function N0(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Ef(l){if(Array.isArray(l))return l.map(Ef);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const s in l)i[s]=Ef(l[s]);return i}return N0(l)}function If(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!If(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function $h(l,i="",s=null,u="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};If(l)||(l=dm(l));const d=l;let g=!0;try{g=function(C){if(!Hh(C))return C;let R=Ef(C);return hm(R),R=Z_(R),R}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let _=null,w=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){w=$e[`filter_${u}`];const C=Uu(g,w,i,s);if(C.result==="error")throw new Error(C.value.map(R=>`${R.key}: ${R.message}`).join(", "));_=(R,M,z)=>C.value.evaluate(R,M,{},z)}let T=null,E=null;if(g!==d){const C=Uu(d,w,i,s);if(C.result==="error")throw new Error(C.value.map(R=>`${R.key}: ${R.message}`).join(", "));T=(R,M,z,F,G)=>C.value.evaluate(R,M,{},z,void 0,void 0,F,G),E=!zh(C.value.expression)}return{filter:_,dynamicFilter:T||void 0,needGeometry:X_(g),needFeature:!!E}}function Z_(l){if(!Array.isArray(l))return l;const i=function(s){if($l.has(s[0])){for(let u=1;u<s.length;u++)if(Hh(s[u]))return!0}return s}(l);return i===!0?i:i.map(s=>Z_(s))}function hm(l){let i=!1;const s=[];if(l[0]==="case"){for(let u=1;u<l.length-1;u+=2)i=i||Hh(l[u]),s.push(l[u+1]);s.push(l[l.length-1])}else if(l[0]==="match"){i=i||Hh(l[1]);for(let u=2;u<l.length-1;u+=2)s.push(l[u+1]);s.push(l[l.length-1])}else if(l[0]==="step"){i=i||Hh(l[1]);for(let u=1;u<l.length-1;u+=2)s.push(l[u+1])}i&&(l.length=0,l.push("any",...s));for(let u=1;u<l.length;u++)hm(l[u])}function Hh(l){if(!Array.isArray(l))return!1;if((i=l[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let s=1;s<l.length;s++)if(Hh(l[s]))return!0;return!1}const $l=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wE(l,i){return l<i?-1:l>i?1:0}function X_(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let i=1;i<l.length;i++)if(X_(l[i]))return!0;return!1}function dm(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?K_(l[1],l[2],"=="):i==="!="?fm(K_(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?K_(l[1],l[2],i):i==="any"?(s=l.slice(1),["any"].concat(s.map(dm))):i==="all"?["all"].concat(l.slice(1).map(dm)):i==="none"?["all"].concat(l.slice(1).map(dm).map(fm)):i==="in"?B0(l[1],l.slice(2)):i==="!in"?fm(B0(l[1],l.slice(2))):i==="has"?V0(l[1]):i!=="!has"||fm(V0(l[1]));var s}function K_(l,i,s){switch(l){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,l,i]}}function B0(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",l,["literal",i.sort(wE)]]:["filter-in-small",l,["literal",i]]}}function V0(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function fm(l){return["!",l]}const Sf="";function qh(l,i){return i?`${l}${Sf}${i}`:l}const U0="-transition",bE=new Set(["fill","line","background","hillshade","raster"]);class bo extends Nl{constructor(i,s,u,d,g){if(super(),this.id=i.id,this.fqid=qh(this.id,u),this.type=i.type,this.scope=u,this.lut=d,this.options=g,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const _=Uu(this.filter,$e[`filter_${i.type}`]);_.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,..._.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),s.layout&&(this._unevaluatedLayout=new nu(s.layout,this.scope,g),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint){this._transitionablePaint=new Tf(s.paint,this.scope,g);for(const _ in i.paint)this.setPaintProperty(_,i.paint[_]);for(const _ in i.layout)this.setLayoutProperty(_,i.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vl(s.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&bE.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,s){if(this.type==="custom"&&i==="visibility")return void(this.visibility=s);const u=this._unevaluatedLayout;u._properties.properties[i]&&(u.setValue(i,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),i==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(U0)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s){const u=this._transitionablePaint,d=u._properties.properties;if(i.endsWith(U0)){const R=i.slice(0,-11);return d[R]&&u.setTransition(R,s||void 0),!1}if(!d[i])return!1;const g=u._values[i],_=g.value.isDataDriven(),w=g.value;u.setValue(i,s),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const T=u._values[i].value,E=T.isDataDriven(),C=i.endsWith("pattern")||i==="line-dasharray";return E||_||C||this._handleOverridablePaintPropertyUpdate(i,w,T)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,s,u){return null}_handleOverridablePaintPropertyUpdate(i,s,u){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){return Qn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof Gu&&nm(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=$h(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,s,u,d,g,_,w,T,E){}}const TE={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Af{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mr{constructor(){this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&s.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function di(l,i=1){let s=0,u=0;return{members:l.map(d=>{const g=TE[d.type].BYTES_PER_ELEMENT,_=s=Y_(s,Math.max(i,g)),w=d.components||1;return u=Math.max(u,g),s+=g*w,{name:d.name,type:d.type,components:w,offset:_}}),size:Y_(s,Math.max(u,i)),alignment:i}}function Y_(l,i){return Math.ceil(l/i)*i}class Ko extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const u=this.length;return this.resize(u+1),this.emplace(u,i,s)}emplace(i,s,u){const d=2*i;return this.int16[d+0]=s,this.int16[d+1]=u,i}}Ko.prototype.bytesPerElement=4,Xt(Ko,"StructArrayLayout2i4");class Wh extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,u)}emplace(i,s,u,d){const g=3*i;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=d,i}}Wh.prototype.bytesPerElement=6,Xt(Wh,"StructArrayLayout3i6");class Zh extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,u,d)}emplace(i,s,u,d,g){const _=4*i;return this.int16[_+0]=s,this.int16[_+1]=u,this.int16[_+2]=d,this.int16[_+3]=g,i}}Zh.prototype.bytesPerElement=8,Xt(Zh,"StructArrayLayout4i8");class $u extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}$u.prototype.bytesPerElement=4,Xt($u,"StructArrayLayout1f4");class Q_ extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,u)}emplace(i,s,u,d){const g=4*i,_=2*i;return this.int16[g+0]=s,this.int16[g+1]=u,this.float32[_+1]=d,i}}Q_.prototype.bytesPerElement=8,Xt(Q_,"StructArrayLayout2i1f8");class J_ extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,u)}emplace(i,s,u,d){const g=4*i;return this.int16[g+0]=s,this.int16[g+1]=u,this.int16[g+2]=d,i}}J_.prototype.bytesPerElement=8,Xt(J_,"StructArrayLayout3i8");class pm extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,u,d,g)}emplace(i,s,u,d,g,_){const w=5*i;return this.int16[w+0]=s,this.int16[w+1]=u,this.int16[w+2]=d,this.int16[w+3]=g,this.int16[w+4]=_,i}}pm.prototype.bytesPerElement=10,Xt(pm,"StructArrayLayout5i10");class mm extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,u,d,g,_,w)}emplace(i,s,u,d,g,_,w,T){const E=6*i,C=12*i,R=3*i;return this.int16[E+0]=s,this.int16[E+1]=u,this.uint8[C+4]=d,this.uint8[C+5]=g,this.uint8[C+6]=_,this.uint8[C+7]=w,this.float32[R+2]=T,i}}mm.prototype.bytesPerElement=12,Xt(mm,"StructArrayLayout2i4ub1f12");class Ra extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,u)}emplace(i,s,u,d){const g=3*i;return this.float32[g+0]=s,this.float32[g+1]=u,this.float32[g+2]=d,i}}Ra.prototype.bytesPerElement=12,Xt(Ra,"StructArrayLayout3f12");class iu extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,u,d,g)}emplace(i,s,u,d,g,_){const w=6*i,T=3*i;return this.uint16[w+0]=s,this.uint16[w+1]=u,this.uint16[w+2]=d,this.uint16[w+3]=g,this.float32[T+2]=_,i}}iu.prototype.bytesPerElement=12,Xt(iu,"StructArrayLayout4ui1f12");class Xh extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,u,d)}emplace(i,s,u,d,g){const _=4*i;return this.uint16[_+0]=s,this.uint16[_+1]=u,this.uint16[_+2]=d,this.uint16[_+3]=g,i}}Xh.prototype.bytesPerElement=8,Xt(Xh,"StructArrayLayout4ui8");class gm extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,u,d,g,_)}emplace(i,s,u,d,g,_,w){const T=6*i;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=w,i}}gm.prototype.bytesPerElement=12,Xt(gm,"StructArrayLayout6i12");class _m extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w,T,E,C,R,M){const z=this.length;return this.resize(z+1),this.emplace(z,i,s,u,d,g,_,w,T,E,C,R,M)}emplace(i,s,u,d,g,_,w,T,E,C,R,M,z){const F=12*i;return this.int16[F+0]=s,this.int16[F+1]=u,this.int16[F+2]=d,this.int16[F+3]=g,this.uint16[F+4]=_,this.uint16[F+5]=w,this.uint16[F+6]=T,this.uint16[F+7]=E,this.int16[F+8]=C,this.int16[F+9]=R,this.int16[F+10]=M,this.int16[F+11]=z,i}}_m.prototype.bytesPerElement=24,Xt(_m,"StructArrayLayout4i4ui4i24");class Kh extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,u,d,g,_)}emplace(i,s,u,d,g,_,w){const T=10*i,E=5*i;return this.int16[T+0]=s,this.int16[T+1]=u,this.int16[T+2]=d,this.float32[E+2]=g,this.float32[E+3]=_,this.float32[E+4]=w,i}}Kh.prototype.bytesPerElement=20,Xt(Kh,"StructArrayLayout3i3f20");class ru extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,u,d)}emplace(i,s,u,d,g){const _=4*i;return this.float32[_+0]=s,this.float32[_+1]=u,this.float32[_+2]=d,this.float32[_+3]=g,i}}ru.prototype.bytesPerElement=16,Xt(ru,"StructArrayLayout4f16");class ey extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}ey.prototype.bytesPerElement=4,Xt(ey,"StructArrayLayout1ul4");class Hl extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const u=this.length;return this.resize(u+1),this.emplace(u,i,s)}emplace(i,s,u){const d=2*i;return this.uint16[d+0]=s,this.uint16[d+1]=u,i}}Hl.prototype.bytesPerElement=4,Xt(Hl,"StructArrayLayout2ui4");class ty extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w,T,E,C,R,M,z){const F=this.length;return this.resize(F+1),this.emplace(F,i,s,u,d,g,_,w,T,E,C,R,M,z)}emplace(i,s,u,d,g,_,w,T,E,C,R,M,z,F){const G=20*i,H=10*i;return this.int16[G+0]=s,this.int16[G+1]=u,this.int16[G+2]=d,this.int16[G+3]=g,this.int16[G+4]=_,this.float32[H+3]=w,this.float32[H+4]=T,this.float32[H+5]=E,this.float32[H+6]=C,this.int16[G+14]=R,this.uint32[H+8]=M,this.uint16[G+18]=z,this.uint16[G+19]=F,i}}ty.prototype.bytesPerElement=40,Xt(ty,"StructArrayLayout5i4f1i1ul2ui40");class ym extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,u,d,g,_,w)}emplace(i,s,u,d,g,_,w,T){const E=8*i;return this.int16[E+0]=s,this.int16[E+1]=u,this.int16[E+2]=d,this.int16[E+4]=g,this.int16[E+5]=_,this.int16[E+6]=w,this.int16[E+7]=T,i}}ym.prototype.bytesPerElement=16,Xt(ym,"StructArrayLayout3i2i2i16");class Yh extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,u,d,g)}emplace(i,s,u,d,g,_){const w=4*i,T=8*i;return this.float32[w+0]=s,this.float32[w+1]=u,this.float32[w+2]=d,this.int16[T+6]=g,this.int16[T+7]=_,i}}Yh.prototype.bytesPerElement=16,Xt(Yh,"StructArrayLayout2f1f2i16");class Qh extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,u,d,g,_)}emplace(i,s,u,d,g,_,w){const T=20*i,E=5*i;return this.uint8[T+0]=s,this.uint8[T+1]=u,this.float32[E+1]=d,this.float32[E+2]=g,this.float32[E+3]=_,this.float32[E+4]=w,i}}Qh.prototype.bytesPerElement=20,Xt(Qh,"StructArrayLayout2ub4f20");class yr extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,u){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,u)}emplace(i,s,u,d){const g=3*i;return this.uint16[g+0]=s,this.uint16[g+1]=u,this.uint16[g+2]=d,i}}yr.prototype.bytesPerElement=6,Xt(yr,"StructArrayLayout3ui6");class Jh extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K,ie,ne,se,Se){const we=this.length;return this.resize(we+1),this.emplace(we,i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K,ie,ne,se,Se)}emplace(i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K,ie,ne,se,Se,we){const Te=30*i,Oe=15*i,Ne=60*i;return this.int16[Te+0]=s,this.int16[Te+1]=u,this.int16[Te+2]=d,this.float32[Oe+2]=g,this.float32[Oe+3]=_,this.uint16[Te+8]=w,this.uint16[Te+9]=T,this.uint32[Oe+5]=E,this.uint32[Oe+6]=C,this.uint32[Oe+7]=R,this.uint16[Te+16]=M,this.uint16[Te+17]=z,this.uint16[Te+18]=F,this.float32[Oe+10]=G,this.float32[Oe+11]=H,this.uint8[Ne+48]=K,this.uint8[Ne+49]=ie,this.uint8[Ne+50]=ne,this.uint32[Oe+13]=se,this.int16[Te+28]=Se,this.uint8[Ne+58]=we,i}}Jh.prototype.bytesPerElement=60,Xt(Jh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ny extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K,ie,ne,se,Se,we,Te,Oe,Ne,at,He,ht,Mt,gt,It,Rt,st){const St=this.length;return this.resize(St+1),this.emplace(St,i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K,ie,ne,se,Se,we,Te,Oe,Ne,at,He,ht,Mt,gt,It,Rt,st)}emplace(i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K,ie,ne,se,Se,we,Te,Oe,Ne,at,He,ht,Mt,gt,It,Rt,st,St){const qe=20*i,ot=40*i,zt=80*i;return this.float32[qe+0]=s,this.float32[qe+1]=u,this.int16[ot+4]=d,this.int16[ot+5]=g,this.int16[ot+6]=_,this.int16[ot+7]=w,this.int16[ot+8]=T,this.int16[ot+9]=E,this.int16[ot+10]=C,this.int16[ot+11]=R,this.int16[ot+12]=M,this.uint16[ot+13]=z,this.uint16[ot+14]=F,this.uint16[ot+15]=G,this.uint16[ot+16]=H,this.uint16[ot+17]=K,this.uint16[ot+18]=ie,this.uint16[ot+19]=ne,this.uint16[ot+20]=se,this.uint16[ot+21]=Se,this.uint16[ot+22]=we,this.uint16[ot+23]=Te,this.uint16[ot+24]=Oe,this.uint16[ot+25]=Ne,this.uint16[ot+26]=at,this.uint16[ot+27]=He,this.uint32[qe+14]=ht,this.float32[qe+15]=Mt,this.float32[qe+16]=gt,this.float32[qe+17]=It,this.float32[qe+18]=Rt,this.uint8[zt+76]=st,this.uint16[ot+39]=St,i}}ny.prototype.bytesPerElement=80,Xt(ny,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class iy extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,u,d,g,_)}emplace(i,s,u,d,g,_,w){const T=6*i;return this.float32[T+0]=s,this.float32[T+1]=u,this.float32[T+2]=d,this.float32[T+3]=g,this.float32[T+4]=_,this.float32[T+5]=w,i}}iy.prototype.bytesPerElement=24,Xt(iy,"StructArrayLayout6f24");class Hu extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,s,u,d,g)}emplace(i,s,u,d,g,_){const w=5*i;return this.float32[w+0]=s,this.float32[w+1]=u,this.float32[w+2]=d,this.float32[w+3]=g,this.float32[w+4]=_,i}}Hu.prototype.bytesPerElement=20,Xt(Hu,"StructArrayLayout5f20");class ry extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,u,d,g,_,w)}emplace(i,s,u,d,g,_,w,T){const E=7*i;return this.float32[E+0]=s,this.float32[E+1]=u,this.float32[E+2]=d,this.float32[E+3]=g,this.float32[E+4]=_,this.float32[E+5]=w,this.float32[E+6]=T,i}}ry.prototype.bytesPerElement=28,Xt(ry,"StructArrayLayout7f28");class Cf extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w,T,E,C,R){const M=this.length;return this.resize(M+1),this.emplace(M,i,s,u,d,g,_,w,T,E,C,R)}emplace(i,s,u,d,g,_,w,T,E,C,R,M){const z=11*i;return this.float32[z+0]=s,this.float32[z+1]=u,this.float32[z+2]=d,this.float32[z+3]=g,this.float32[z+4]=_,this.float32[z+5]=w,this.float32[z+6]=T,this.float32[z+7]=E,this.float32[z+8]=C,this.float32[z+9]=R,this.float32[z+10]=M,i}}Cf.prototype.bytesPerElement=44,Xt(Cf,"StructArrayLayout11f44");class sy extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,i,s,u,d,g,_,w,T,E)}emplace(i,s,u,d,g,_,w,T,E,C){const R=9*i;return this.float32[R+0]=s,this.float32[R+1]=u,this.float32[R+2]=d,this.float32[R+3]=g,this.float32[R+4]=_,this.float32[R+5]=w,this.float32[R+6]=T,this.float32[R+7]=E,this.float32[R+8]=C,i}}sy.prototype.bytesPerElement=36,Xt(sy,"StructArrayLayout9f36");class su extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const u=this.length;return this.resize(u+1),this.emplace(u,i,s)}emplace(i,s,u){const d=2*i;return this.float32[d+0]=s,this.float32[d+1]=u,i}}su.prototype.bytesPerElement=8,Xt(su,"StructArrayLayout2f8");class oy extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,s,u,d)}emplace(i,s,u,d,g){const _=6*i;return this.uint32[3*i+0]=s,this.uint16[_+2]=u,this.uint16[_+3]=d,this.uint16[_+4]=g,i}}oy.prototype.bytesPerElement=12,Xt(oy,"StructArrayLayout1ul3ui12");class ay extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}ay.prototype.bytesPerElement=2,Xt(ay,"StructArrayLayout1ui2");class vm extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H){const K=this.length;return this.resize(K+1),this.emplace(K,i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H)}emplace(i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K){const ie=16*i;return this.float32[ie+0]=s,this.float32[ie+1]=u,this.float32[ie+2]=d,this.float32[ie+3]=g,this.float32[ie+4]=_,this.float32[ie+5]=w,this.float32[ie+6]=T,this.float32[ie+7]=E,this.float32[ie+8]=C,this.float32[ie+9]=R,this.float32[ie+10]=M,this.float32[ie+11]=z,this.float32[ie+12]=F,this.float32[ie+13]=G,this.float32[ie+14]=H,this.float32[ie+15]=K,i}}vm.prototype.bytesPerElement=64,Xt(vm,"StructArrayLayout16f64");class ed extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,u,d,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,s,u,d,g,_,w)}emplace(i,s,u,d,g,_,w,T){const E=10*i,C=5*i;return this.uint16[E+0]=s,this.uint16[E+1]=u,this.uint16[E+2]=d,this.uint16[E+3]=g,this.float32[C+2]=_,this.float32[C+3]=w,this.float32[C+4]=T,i}}ed.prototype.bytesPerElement=20,Xt(ed,"StructArrayLayout4ui3f20");class ly extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.int16[1*i+0]=s,i}}ly.prototype.bytesPerElement=2,Xt(ly,"StructArrayLayout1i2");class xm extends mr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint8[1*i+0]=s,i}}xm.prototype.bytesPerElement=1,Xt(xm,"StructArrayLayout1ub1");class cy extends Af{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}cy.prototype.size=40;class j0 extends ty{get(i){return new cy(this,i)}}Xt(j0,"CollisionBoxArray");class wm extends Af{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}wm.prototype.size=60;class Pf extends Jh{get(i){return new wm(this,i)}}Xt(Pf,"PlacedSymbolArray");class uy extends Af{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}uy.prototype.size=80;class G0 extends ny{get(i){return new uy(this,i)}}Xt(G0,"SymbolInstanceArray");class hy extends $u{getoffsetX(i){return this.float32[1*i+0]}}Xt(hy,"GlyphOffsetArray");class $0 extends Ko{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Xt($0,"SymbolLineVertexArray");class bm extends Af{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bm.prototype.size=12;class H0 extends oy{get(i){return new bm(this,i)}}Xt(H0,"FeatureIndexArray");class q0 extends Hl{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Xt(q0,"FillExtrusionCentroidArray");class W0 extends Af{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}W0.prototype.size=6;class Z0 extends Wh{get(i){return new W0(this,i)}}Xt(Z0,"FillExtrusionWallArray");const X0=di([{name:"a_pos",components:2,type:"Int16"}],4),EE=di([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),IE=di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Cr{constructor(i=[]){this.segments=i}_prepareSegment(i,s,u,d){let g=this.segments[this.segments.length-1];return i>Cr.MAX_VERTEX_ARRAY_LENGTH&&ni(`Max vertices per segment is ${Cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!g||g.vertexLength+i>Cr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:s,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(i,s,u,d){return this._prepareSegment(i,s.length,u.length,d)}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,u,d){return new Cr([{vertexOffset:i,primitiveOffset:s,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function K0(l,i){return 256*(l=he(Math.floor(l),0,255))+he(Math.floor(i),0,255)}Cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt(Cr,"SegmentVector");const SE=di([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),dy=di([{name:"a_pattern_b",components:4,type:"Uint16"}]),AE=di([{name:"a_dash",components:4,type:"Uint16"}]);class Rf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,s,u,d){this.ids.push(kf(i)),this.positions.push(s,u,d)}eachPosition(i,s){const u=kf(i);let d=0,g=this.ids.length-1;for(;d<g;){const _=d+g>>1;this.ids[_]>=u?g=_:d=_+1}for(;this.ids[d]===u;)s(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(i,s){const u=new Float64Array(i.ids),d=new Uint32Array(i.positions);return fy(u,d,0,u.length-1),s&&(s.add(u.buffer),s.add(d.buffer)),{ids:u,positions:d}}static deserialize(i){const s=new Rf;let u;s.ids=i.ids,s.positions=i.positions;for(const d of s.ids)d!==u&&s.uniqueIds.push(d),u=d;return s.indexed=!0,s}}function kf(l){const i=+l;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:uc(String(l))}function fy(l,i,s,u){for(;s<u;){const d=l[s+u>>1];let g=s-1,_=u+1;for(;;){do g++;while(l[g]<d);do _--;while(l[_]>d);if(g>=_)break;Tm(l,g,_),Tm(i,3*g,3*_),Tm(i,3*g+1,3*_+1),Tm(i,3*g+2,3*_+2)}_-s<u-_?(fy(l,i,s,_),s=_+1):(fy(l,i,_+1,u),u=_)}}function Tm(l,i,s){const u=l[i];l[i]=l[s],l[s]=u}Xt(Rf,"FeaturePositionMap");class Xa{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,s),this.initialized=!0),!!this.location}set(i,s,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Em extends Xa{constructor(i){super(i),this.current=0}set(i,s,u){this.fetchUniformLocation(i,s)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class ts extends Xa{constructor(i){super(i),this.current=0}set(i,s,u){this.fetchUniformLocation(i,s)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ql extends Xa{constructor(i){super(i),this.current=[0,0]}set(i,s,u){this.fetchUniformLocation(i,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class td extends Xa{constructor(i){super(i),this.current=[0,0,0]}set(i,s,u){this.fetchUniformLocation(i,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Mf extends Xa{constructor(i){super(i),this.current=[0,0,0,0]}set(i,s,u){this.fetchUniformLocation(i,s)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class py extends Xa{constructor(i){super(i),this.current=wi.transparent.toPremultipliedRenderColor(null)}set(i,s,u){this.fetchUniformLocation(i,s)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const Y0=new Float32Array(16);class Df extends Xa{constructor(i){super(i),this.current=Y0}set(i,s,u){if(this.fetchUniformLocation(i,s)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const CE=new Float32Array(9),Q0=new Float32Array(4);class my extends Xa{constructor(i){super(i),this.current=Q0}set(i,s,u){if(this.fetchUniformLocation(i,s)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function gy(l){return[K0(255*l.r,255*l.g),K0(255*l.b,255*l.a)]}class Lf{constructor(i,s,u,d){this.value=i,this.uniformNames=s.map(g=>`u_${g}`),this.type=u,this.context=d}setUniform(i,s,u,d,g){const _=d.constantOr(this.value);s.set(i,g,_ instanceof wi?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(i,s){return this.type==="color"?new py(i):new ts(i)}}class nd{constructor(i,s){this.uniformNames=s.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,s){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=s?s.tl.concat(s.br):this.pattern}setUniform(i,s,u,d,g){let _=null;g!=="u_pattern"&&g!=="u_dash"||(_=this.pattern),g==="u_pattern_b"&&(_=this.patternTransition),g==="u_pixel_ratio"&&(_=this.pixelRatio),_&&s.set(i,g,_)}getBinding(i,s){return s==="u_pattern"||s==="u_pattern_b"||s==="u_dash"?new Mf(i):new ts(i)}}class pc{constructor(i,s,u,d){this.expression=i,this.type=u,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(i,s,u,d,g,_,w,T){const E=this.paintVertexArray.length,C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Zi(0,{brightness:_,worldview:T}),s,{},g,d,w):this.expression.kind==="constant"&&this.expression.value,R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:_,worldview:T}),s,{},g,d,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(i),this._setPaintValue(E,i,C,R?null:this.context.lut)}updatePaintArray(i,s,u,d,g,_,w,T){const E=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:T},u,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:w,worldview:T}),u,d,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(i,s,E,C?null:this.context.lut)}_setPaintValue(i,s,u,d){if(this.type==="color"){const g=gy(u.toPremultipliedRenderColor(d));for(let _=i;_<s;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=i;g<s;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ka{constructor(i,s,u,d,g,_){this.expression=i,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=u,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,s,u,d,g,_,w,T){const E=this.expression.evaluate(new Zi(this.context.zoom,{brightness:_,worldview:T}),s,{},g,d,w),C=this.expression.evaluate(new Zi(this.context.zoom+1,{brightness:_,worldview:T}),s,{},g,d,w),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:_,worldview:T}),s,{},g,d,w):this.lutExpression.value)==="none",M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,E,C,R?null:this.context.lut)}updatePaintArray(i,s,u,d,g,_,w,T){const E=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:T},u,d,void 0,g),C=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:T},u,d,void 0,g),R=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:w,worldview:T}),u,d,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(i,s,E,C,R?null:this.context.lut)}_setPaintValue(i,s,u,d,g){if(this.type==="color"){const _=gy(u.toPremultipliedRenderColor(g)),w=gy(u.toPremultipliedRenderColor(g));for(let T=i;T<s;T++)this.paintVertexArray.emplace(T,_[0],_[1],w[0],w[1])}else{for(let _=i;_<s;_++)this.paintVertexArray.emplace(_,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s,u,d,g){const _=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=he(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);s.set(i,g,w)}getBinding(i,s){return new ts(i)}}class ka{constructor(i,s,u,d,g){this.expression=i,this.layerId=g,this.paintVertexAttributes=(u==="array"?AE:SE).members;for(let _=0;_<s.length;++_);this.paintVertexArray=new d,this.paintTransitionVertexArray=new Xh}populatePaintArray(i,s,u,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(g,i,s.patterns&&s.patterns[this.layerId],u)}updatePaintArray(i,s,u,d,g,_,w){this._setPaintValues(i,s,u.patterns&&u.patterns[this.layerId],_)}_setPaintValues(i,s,u,d){if(!d||!u)return;const g=d[u[0]],_=d[u[1]];if(g){if(g){const{tl:w,br:T,pixelRatio:E}=g;for(let C=i;C<s;C++)this.paintVertexArray.emplace(C,w[0],w[1],T[0],T[1],E)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:T}=_;for(let E=i;E<s;E++)this.paintTransitionVertexArray.emplace(E,w[0],w[1],T[0],T[1])}}}upload(i){const s=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,s)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,dy.members,s))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class No{constructor(i,s,u=()=>!0){this.binders={},this._buffers=[],this.context=s;const d=[];for(const g in i.paint._values){const _=i.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(_ instanceof Gu&&nm(_.property.specification)))continue;const w=RE(g,i.type),T=_.value,E=_.property.specification.type,C=!!_.property.useIntegerZoom,R=g==="line-dasharray"||g.endsWith("pattern"),M=i.paint.get(`${g}-use-theme`),z=g==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(T.kind!=="constant"||z)if(T.kind==="source"||z||R){const F=J0(g,E,"source");this.binders[g]=R?new ka(T,w,E,F,i.id):new pc(T,w,E,F),d.push(`/a_${g}`)}else{const F=J0(g,E,"composite");this.binders[g]=new Ka(T,w,E,C,s,F),d.push(`/z_${g}`)}else this.binders[g]=R?new nd(T.value,w):new Lf(T.value,w,E,s),d.push(`/u_${g}`);M&&(this.binders[g].lutExpression=M.value)}this.cacheKey=d.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof pc||s instanceof Ka?s.maxValue:0}populatePaintArrays(i,s,u,d,g,_,w,T){for(const E in this.binders){const C=this.binders[E];C.context=this.context,(C instanceof pc||C instanceof Ka||C instanceof ka)&&C.populatePaintArray(i,s,u,d,g,_,w,T)}}setConstantPatternPositions(i,s){for(const u in this.binders){const d=this.binders[u];d instanceof nd&&d.setConstantPatternPositions(i,s)}}getPatternTransitionVertexBuffer(i){const s=this.binders[i];return s instanceof ka?s.paintTransitionVertexBuffer:null}updatePaintArrays(i,s,u,d,g,_,w,T,E,C){let R=!1;const M=Object.keys(i),z=M.length!==0&&!T,F=z?M:s.uniqueIds;this.context.lut=g.lut;for(const G in this.binders){const H=this.binders[G];if(H.context=this.context,(H instanceof pc||H instanceof Ka||H instanceof ka)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){const K=g.paint.get(G);H.expression=K.value;for(const ie of F){const ne=i[ie.toString()];s.eachPosition(ie,(se,Se,we)=>{const Te=d.feature(se);H.updatePaintArray(Se,we,Te,ne,_,w,E,C)})}if(!z)for(const ie of u.uniqueIds){const ne=i[ie.toString()];u.eachPosition(ie,(se,Se,we)=>{const Te=d.feature(se);H.updatePaintArray(Se,we,Te,ne,_,w,E,C)})}R=!0}}return R}defines(){const i=[];for(const s in this.binders){const u=this.binders[s];(u instanceof Lf||u instanceof nd)&&i.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof pc||u instanceof Ka||u instanceof ka)for(let d=0;d<u.paintVertexAttributes.length;d++)i.push(u.paintVertexAttributes[d].name);if(u instanceof ka)for(let d=0;d<dy.members.length;d++)i.push(dy.members[d].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Lf||u instanceof nd||u instanceof Ka)for(const d of u.uniformNames)i.push(d)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const s=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Lf||d instanceof nd||d instanceof Ka)for(const g of d.uniformNames)s.push({name:g,property:u,binding:d.getBinding(i,g)})}return s}setUniforms(i,s,u,d,g){for(const{name:_,property:w,binding:T}of u)this.binders[w].setUniform(i,T,g,d.get(w),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const s=this.binders[i];(s instanceof pc||s instanceof Ka||s instanceof ka)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer),s instanceof ka&&s.paintTransitionVertexBuffer&&this._buffers.push(s.paintTransitionVertexBuffer)}}upload(i){for(const s in this.binders){const u=this.binders[s];(u instanceof pc||u instanceof Ka||u instanceof ka)&&u.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof pc||s instanceof Ka||s instanceof ka)&&s.destroy()}}}class Ma{constructor(i,s,u=()=>!0){this.programConfigurations={};for(const d of i)this.programConfigurations[d.id]=new No(d,s,u);this.needsUpload=!1,this._featureMap=new Rf,this._featureMapWithoutIds=new Rf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,s,u,d,g,_,w,T,E){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(i,s,d,g,_,w,T,E);s.id!==void 0?this._featureMap.add(s.id,u,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,u,d,g,_,w,T){for(const E of u)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,s,E,d,g,_,w||0,T)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const PE={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function RE(l,i){return PE[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}const kE={"line-pattern":{source:iu,composite:iu},"fill-pattern":{source:iu,composite:iu},"fill-extrusion-pattern":{source:iu,composite:iu},"line-dasharray":{source:Xh,composite:Xh}},ME={color:{source:su,composite:ru},number:{source:$u,composite:su}};function J0(l,i,s){const u=kE[l];return u&&u[s]||ME[i][s]}Xt(Lf,"ConstantBinder"),Xt(nd,"PatternConstantBinder"),Xt(pc,"SourceExpressionBinder"),Xt(ka,"PatternCompositeBinder"),Xt(Ka,"CompositeExpressionBinder"),Xt(No,"ProgramConfiguration",{omit:["_buffers"]}),Xt(Ma,"ProgramConfigurationSet");const To=Bt/Math.PI/2,ew=5,f=6,r=16383,c=64,p=[c,32,16],y=-To,x=To;function b(l,i,s,u=To){return s=fi(s),[l*Math.sin(s)*u,-i*u,l*Math.cos(s)*u]}function I(l,i,s){return b(Math.cos(fi(l)),Math.sin(fi(l)),i,s)}const A=63710088e-1,D=2*Math.PI*A;class L{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new L(Je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,u=this.lat*s,d=i.lat*s,g=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((i.lng-this.lng)*s);return A*Math.acos(Math.min(g,1))}toBounds(i=0){const s=360*i/40075017,u=s/Math.cos(Math.PI/180*this.lat);return new B({lng:this.lng-u,lat:this.lat-s},{lng:this.lng+u,lat:this.lat+s})}toEcef(i){return I(this.lat,this.lng,To+i*To/A)}static convert(i){if(i instanceof L)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new L(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new L(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class B{constructor(i,s){if(i)if(s)this.setSouthWest(i).setNorthEast(s);else if(i.length===4){const u=i;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=i;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(i){return this._ne=i instanceof L?new L(i.lng,i.lat):L.convert(i),this}setSouthWest(i){return this._sw=i instanceof L?new L(i.lng,i.lat):L.convert(i),this}extend(i){const s=this._sw,u=this._ne;let d,g;if(i instanceof L)d=i,g=i;else{if(!(i instanceof B))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(B.convert(i)):this.extend(L.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(L.convert(i)):this;if(d=i._sw,g=i._ne,!d||!g)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new L(d.lng,d.lat),this._ne=new L(g.lng,g.lat)),this}getCenter(){return new L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new L(this.getWest(),this.getNorth())}getSouthEast(){return new L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:s,lat:u}=L.convert(i);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(i){if(i)return i instanceof B?i:new B(i)}}const O=0,U=25.5;function q(l){return D*Math.cos(l*Math.PI/180)}function $(l){return(180+l)/360}function X(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Z(l,i){return l/q(i)}function te(l){return 360*l-180}function re(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function ae(l,i){return l*q(re(i))}const fe=85.051129;function be(l){return Math.cos(fi(he(l,-fe,fe)))}function Ee(l,i){const s=he(i,O,U),u=Math.pow(2,s);return be(l)*D/(512*u)}function pe(l){return 1/Math.cos(l*Math.PI/180)}function _e(l,i=0){const s=Math.exp(Math.PI*(1-(l.y+i/Bt)/(1<<l.z)*2));return 80150034*s/(s*s+1)/Bt/(1<<l.z)}class ve{constructor(i,s,u=0){this.x=+i,this.y=+s,this.z=+u}static fromLngLat(i,s=0){const u=L.convert(i);return new ve($(u.lng),X(u.lat),Z(s,u.lat))}toLngLat(){return new L(te(this.x),re(this.y))}toAltitude(){return ae(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/D*pe(re(this.y))}}function We(l,i,s,u,d,g,_,w,T){const E=(i+u)/2,C=(s+d)/2,R=new bt(E,C);w(R),function(M,z,F,G,H,K){const ie=F-H,ne=G-K;return Math.abs((G-z)*ie-(F-M)*ne)/Math.hypot(ie,ne)}(R.x,R.y,g.x,g.y,_.x,_.y)>=T?(We(l,i,s,E,C,g,R,w,T),We(l,E,C,u,d,R,_,w,T)):l.push(_)}function Le(l,i,s){let u=l[0],d=u.x,g=u.y;i(u);const _=[u];for(let w=1;w<l.length;w++){const T=l[w],{x:E,y:C}=T;i(T),We(_,d,g,E,C,u,T,i,s),d=E,g=C,u=T}return _}function lt(l,i,s,u){if(u(i,s)){const d=i.add(s)._mult(.5);lt(l,i,d,u),lt(l,d,s,u)}else l.push(s)}function Ye(l,i){let s=l[0];const u=[s];for(let d=1;d<l.length;d++){const g=l[d];lt(u,s,g,i),s=g}return u}const ft=Math.pow(2,14)-1,kt=-ft-1;function Ze(l,i){const s=Math.round(l.x*i),u=Math.round(l.y*i);return l.x=he(s,kt,ft),l.y=he(u,kt,ft),(s<l.x||s>l.x+1||u<l.y||u>l.y+1)&&ni("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Ce(l,i,s){const u=l.loadGeometry(),d=l.extent,g=Bt/d;if(i&&s&&s.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:w,x:T,y:E,projection:C}=s,R=M=>{const z=te((i.x+M.x/d)/_),F=re((i.y+M.y/d)/_),G=C.project(z,F);M.x=(G.x*w-T)*d,M.y=(G.y*w-E)*d};for(let M=0;M<u.length;M++)if(l.type!==1)u[M]=Le(u[M],R,1);else{const z=[];for(const F of u[M])F.x<0||F.x>=d||F.y<0||F.y>=d||(R(F),z.push(F));u[M]=z}}for(const _ of u)for(const w of _)Ze(w,g);return u}function rt(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?Ce(l):[]}}class Ke{constructor(i,s,u,d,g){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=d,this._values=g,i.readFields(xt,this,s)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const s=i.readVarint()+i.pos,u=[];let d,g=1,_=0,w=0,T=0;for(;i.pos<s;){if(_<=0){const E=i.readVarint();g=7&E,_=E>>3}if(_--,g===1||g===2)w+=i.readSVarint(),T+=i.readSVarint(),g===1&&(d&&u.push(d),d=[]),d&&d.push(new bt(w,T));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&u.push(d),u}bbox(){const i=this._pbf;i.pos=this._geometry;const s=i.readVarint()+i.pos;let u=1,d=0,g=0,_=0,w=1/0,T=-1/0,E=1/0,C=-1/0;for(;i.pos<s;){if(d<=0){const R=i.readVarint();u=7&R,d=R>>3}if(d--,u===1||u===2)g+=i.readSVarint(),_+=i.readSVarint(),g<w&&(w=g),g>T&&(T=g),_<E&&(E=_),_>C&&(C=_);else if(u!==7)throw new Error(`unknown command ${u}`)}return[w,E,T,C]}toGeoJSON(i,s,u){const d=this.extent*Math.pow(2,u),g=this.extent*i,_=this.extent*s,w=this.loadGeometry();function T(M){return[360*(M.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(M.y+_)/d)*Math.PI))-90]}function E(M){return M.map(T)}let C;if(this.type===1){const M=[];for(const F of w)M.push(F[0]);const z=E(M);C=M.length===1?{type:"Point",coordinates:z[0]}:{type:"MultiPoint",coordinates:z}}else if(this.type===2){const M=w.map(E);C=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M}}else{if(this.type!==3)throw new Error("unknown feature type");{const M=function(F){const G=F.length;if(G<=1)return[F];const H=[];let K,ie;for(let ne=0;ne<G;ne++){const se=wt(F[ne]);se!==0&&(ie===void 0&&(ie=se<0),ie===se<0?(K&&H.push(K),K=[F[ne]]):K&&K.push(F[ne]))}return K&&H.push(K),H}(w),z=[];for(const F of M)z.push(F.map(E));C=z.length===1?{type:"Polygon",coordinates:z[0]}:{type:"MultiPolygon",coordinates:z}}}const R={type:"Feature",geometry:C,properties:this.properties};return this.id!=null&&(R.id=this.id),R}}function xt(l,i,s){l===1?i.id=s.readVarint():l===2?function(u,d){const g=u.readVarint()+u.pos;for(;u.pos<g;){const _=d._keys[u.readVarint()],w=d._values[u.readVarint()];d.properties[_]=w}}(s,i):l===3?i.type=s.readVarint():l===4&&(i._geometry=s.pos)}function wt(l){let i=0;for(let s,u,d=0,g=l.length,_=g-1;d<g;_=d++)s=l[d],u=l[_],i+=(u.x-s.x)*(s.y+u.y);return i}Ke.types=["Unknown","Point","LineString","Polygon"];class Et{constructor(i,s){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Nt,this,s),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const s=this._pbf.readVarint()+this._pbf.pos;return new Ke(this._pbf,s,this.extent,this._keys,this._values)}}function Nt(l,i,s){l===15?i.version=s.readVarint():l===1?i.name=s.readString():l===5?i.extent=s.readVarint():l===2?i._features.push(s.pos):l===3?i._keys.push(s.readString()):l===4&&i._values.push(function(u){let d=null;const g=u.readVarint()+u.pos;for(;u.pos<g;){const _=u.readVarint()>>3;d=_===1?u.readString():_===2?u.readFloat():_===3?u.readDouble():_===4?u.readVarint64():_===5?u.readVarint():_===6?u.readSVarint():_===7?u.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d}(s))}class tn{constructor(i,s){this.layers=i.readFields(dn,{},s)}}function dn(l,i,s){if(l===3){const u=new Et(s,s.readVarint()+s.pos);u.length&&(i[u.name]=u)}}const qt="3d_elevation_id",hn="level";class an{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,s){return this._valid&&i(s(this._geometry)),this}require(i,s,u){return this.get(i,!0,s,u)}optional(i,s,u){return this.get(i,!1,s,u)}success(){return this._valid}get(i,s,u,d){const g=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(d?d(g):g):s&&(this._valid=!1),this}}class Rn{constructor(i,s){this.featureFunc=i,this.vertexFunc=s}parseFeature(i,s,u){return this.featureFunc(i,s,u)}parseVertex(i,s,u){return this.vertexFunc(i,s,u)}}const Fn=new Rn((l,i,s)=>l.reset(i).require(qt,u=>{s.id=u}).optional("fixed_height_relative",u=>{s.constantHeight=u},bi.decodeRelativeHeight).geometry(u=>{s.bounds=u},h_).success(),(l,i,s)=>l.reset(i).require(qt,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height_relative",u=>{s.height=u},bi.decodeRelativeHeight).geometry(u=>{s.position=u},bi.getPoint).success()),ei=new Rn((l,i,s)=>l.reset(i).require(qt,u=>{s.id=u}).optional("fixed_height",u=>{s.constantHeight=u},bi.decodeMetricHeight).geometry(u=>{s.bounds=u},h_).success(),(l,i,s)=>l.reset(i).require(qt,u=>{s.id=u}).require("elevation_idx",u=>{s.idx=u}).require("extent",u=>{s.extent=u}).require("height",u=>{s.height=u},bi.decodeMetricHeight).geometry(u=>{s.position=u},bi.getPoint).success());class bi{static getPoint(i){return Ur(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static parse(i){const s=[],u=[],d=i.length,g=new an;for(let w=0;w<d;w++){const T=i.feature(w),E=T.properties.version,C=(_=E)?_==="1.0.1"?ei:void 0:Fn;if(C===void 0){ni(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const R=T.properties.hasOwnProperty("type")?T.properties.type:void 0;if(R){if(Ke.types[T.type]==="Point"&&R==="curve_point"){const M={};C.parseVertex(g,T,M)&&s.push(M)}else if(Ke.types[T.type]==="Polygon"&&R==="curve_meta"){const M={};C.parseFeature(g,T,M)&&u.push(M)}}}var _;return{vertices:s,features:u}}}class Dn{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,u){const d=mi(s,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class Ti{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,u){const d=zi(s,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1]+(i[2]-this.pos[2])*s[2])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(i,s,u){if(function(z,F){var G=z[0],H=z[1],K=z[2],ie=F[0],ne=F[1],se=F[2];return Math.abs(G-ie)<=S*Math.max(1,Math.abs(G),Math.abs(ie))&&Math.abs(H-ne)<=S*Math.max(1,Math.abs(H),Math.abs(ne))&&Math.abs(K-se)<=S*Math.max(1,Math.abs(K),Math.abs(se))}(this.pos,i)||s===0)return u[0]=u[1]=u[2]=0,!1;const[d,g,_]=this.dir,w=this.pos[0]-i[0],T=this.pos[1]-i[1],E=this.pos[2]-i[2],C=d*d+g*g+_*_,R=2*(w*d+T*g+E*_),M=R*R-4*C*(w*w+T*T+E*E-s*s);if(M<0){const z=Math.max(-R/2,0),F=w+d*z,G=T+g*z,H=E+_*z,K=Math.hypot(F,G,H);return u[0]=F*s/K,u[1]=G*s/K,u[2]=H*s/K,!1}{const z=(-R-Math.sqrt(M))/(2*C);if(z<0){const F=Math.hypot(w,T,E);return u[0]=w*s/F,u[1]=T*s/F,u[2]=E*s/F,!1}return u[0]=w+d*z,u[1]=T+g*z,u[2]=E+_*z,!0}}}class Ri{constructor(i,s,u,d,g){this.TL=i,this.TR=s,this.BR=u,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(i,s,u){const d=[-1,1,1],g=[1,1,1],_=[1,-1,1],w=[-1,-1,1],T=Wi(d,d,i),E=Wi(g,g,i),C=Wi(_,_,i),R=Wi(w,w,i);return new Ri(T,E,C,R,s/u)}}function nr(l,i,s){let u=1/0,d=-1/0;const g=[];for(const _ of l){Vi(g,_,i);const w=zi(g,s);u=Math.min(u,w),d=Math.max(d,w)}return[u,d]}function Kn(l,i){let s=!0;for(let u=0;u<l.planes.length;u++){const d=l.planes[u];let g=0;for(let _=0;_<i.length;_++)g+=zi(d,i[_])+d[3]>=0;if(g===0)return 0;g!==i.length&&(s=!1)}return s?2:1}function Ei(l,i){for(const s of l.projections){const u=nr(i,l.points[0],s.axis);if(s.projection[1]<u[0]||s.projection[0]>u[1])return 0}return 1}function Ci(l,i){let s=0;const u=[0,0,0,0];for(let _=0;_<l.length;_++)u[0]=l[_][0],u[1]=l[_][1],u[2]=l[_][2],u[3]=1,(d=u)[0]*(g=i)[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3]>=0&&s++;var d,g;return s}class Mi{constructor(i,s){this.points=i||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=ti.fromPoints(this.points),this.projections=[],this.frustumEdges=[Vi([],this.points[2],this.points[3]),Vi([],this.points[0],this.points[3]),Vi([],this.points[4],this.points[0]),Vi([],this.points[5],this.points[1]),Vi([],this.points[6],this.points[2]),Vi([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:d,projection:nr(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:nr(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(i,s,u,d){const g=Math.pow(2,u),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=Es([],E,i),R=1/C[3]/s*g;return(M=C)[0]=(z=C)[0]*(F=[R,R,d?1/C[3]:R,R])[0],M[1]=z[1]*F[1],M[2]=z[2]*F[2],M[3]=z[3]*F[3],M;var M,z,F}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=qn([],ar([],Vi([],_[E[0]],_[E[1]]),Vi([],_[E[2]],_[E[1]]))),R=-zi(C,_[E[1]]);return C.concat(R)}),T=[];for(let E=0;E<_.length;E++)T.push([_[E][0],_[E][1],_[E][2]]);return new Mi(T,w)}intersectsPrecise(i,s,u){for(let d=0;d<s.length;d++)if(!Ci(i,s[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Ci(i,this.planes[d]))return 0;for(const d of u)for(const g of this.frustumEdges){const _=ar([],d,g),w=Be(_);if(w===0)continue;Pn(_,_,1/w);const T=nr(this.points,this.points[0],_),E=nr(i,this.points[0],_);if(T[0]>E[1]||E[0]>T[1])return 0}return 1}containsPoint(i){for(const s of this.planes){const u=s[3];if(zi([s[0],s[1],s[2]],i)+u<0)return!1}return!0}}class ti{static fromPoints(i){const s=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of i)Vn(s,s,d),je(u,u,d);return new ti(s,u)}static fromTileIdAndHeight(i,s,u){const d=1<<i.canonical.z,g=i.canonical.x,_=i.canonical.y;return new ti([g/d,_/d,s],[(g+1)/d,(_+1)/d,u])}static applyTransform(i,s){const u=i.getCorners();for(let d=0;d<u.length;++d)Wi(u[d],u[d],s);return ti.fromPoints(u)}static applyTransformFast(i,s){const u=[s[12],s[13],s[14]],d=[...u];for(let g=0;g<3;g++)for(let _=0;_<3;_++){const w=s[4*_+g],T=w*i.min[_],E=w*i.max[_];u[g]+=Math.min(T,E),d[g]+=Math.max(T,E)}return new ti(u,d)}static projectAabbCorners(i,s){const u=i.getCorners();for(let d=0;d<u.length;++d)Wi(u[d],u[d],s);return u}constructor(i,s){this.min=i,this.max=s,this.center=Pn([],ii([],this.min,this.max),.5)}quadrant(i){const s=[i%2==0,i<2],u=Qe(this.min),d=Qe(this.max);for(let g=0;g<s.length;g++)u[g]=s[g]?this.min[g]:this.center[g],d[g]=s[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new ti(u,d)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,s=this.max;return[[i[0],i[1],i[2]],[s[0],i[1],i[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[i[0],i[1],s[2]],[s[0],i[1],s[2]],[s[0],s[1],s[2]],[i[0],s[1],s[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?Kn(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?Kn(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,s){return s||this.intersects(i)?Ei(i,this.getCorners()):0}intersectsPreciseFlat(i,s){return s||this.intersectsFlat(i)?Ei(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let s=0;s<3;++s)if(this.min[s]>i.max[s]||i.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],i.min[s]),this.max[s]=Math.max(this.max[s],i.max[s])}encapsulatePoint(i){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],i[s]),this.max[s]=Math.max(this.max[s],i[s])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Xt(ti,"Aabb");class $i{constructor(i,s){this.feature=i,this.metersToTile=s,this.index=0}get(){const i=this.feature.vertices[this.index],s=this.feature.vertexProps[this.index].dir,u=s[1],d=-s[0],g=(i.extent+1)*this.metersToTile;return[new bt(Math.trunc(i.position[0]+u*g),Math.trunc(i.position[1]+d*g)),new bt(Math.trunc(i.position[0]-u*g),Math.trunc(i.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ki{constructor(i,s,u,d,g,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=i,this.heightRange={min:u,max:u},this.safeArea=s,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter(w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((T=this.vertices[w.a].position)[0]===(E=this.vertices[w.b].position)[0]&&T[1]===E[1]);var T,E}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:Ur(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const T=this.vertices[w.a].position,E=this.vertices[w.b].position,C=Ds(wr(),E,T),R=ss(C),M=qs(wr(),C,1/R);this.edgeProps.push({vec:C,dir:M,len:R});const z=this.vertexProps[w.a].dir,F=this.vertexProps[w.b].dir;fs(z,z,M),fs(F,F,M)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||Js(w.dir,w.dir);this.tessellate(_)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const s=this.getClosestEdge(i);if(s==null)return 0;const[u,d]=s;return gn(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(i,s){const u=this.getClosestEdge(i);if(!u)return Hn(0,0,1);const d=u[0],g=this.edges[d],_=this.edgeProps[d].vec,w=Hn(_[0],_[1],(this.vertices[g.b].height-this.vertices[g.a].height)*s),T=Hn(w[1],-w[0],0);ar(T,T,w);const E=Be(T);return E>0?Pn(T,T,1/E):Hn(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let s=0,u=Number.POSITIVE_INFINITY,d=0;const g=Ur(i.x,i.y);for(let _=0;_<this.edges.length;_++){const w=this.edges[_],T=this.edgeProps[_].dir,E=new Dn(g,this.edgeProps[_].dir),C=this.vertices[w.a].position,R=this.vertices[w.b].position,M=wr(),z=wr(),F=E.intersectsPlane(C,this.vertexProps[w.a].dir,M),G=E.intersectsPlane(R,this.vertexProps[w.b].dir,z);if(!F||!G)continue;const H=Ds(wr(),z,M),K=Ds(wr(),g,M),ie=mi(H,H),ne=ie>0?mi(K,H)/ie:0,se=he(ne,0,1),Se=Math.abs((ne-se)*this.edgeProps[_].len),we=Ds(wr(),g,C),Te=Se+Math.abs(mi(we,Ur(T[1],-T[0])));Te<u&&(s=_,u=Te,d=se)}return[s,d]}tessellate(i){for(let s=this.edges.length-1;s>=0;--s){const u=this.edges[s].a,d=this.edges[s].b,{position:g,height:_,extent:w}=this.vertices[u],{position:T,height:E,extent:C}=this.vertices[d],R=this.vertexProps[u].dir,M=this.vertexProps[d].dir,z=Hn(g[0]/i,g[1]/i,_),F=Hn(T[0]/i,T[1]/i,E),G=Hn(R[1],-R[0],0);Pn(G,G,w);const H=Hn(M[1],-M[0],0);if(Pn(H,H,C),this.distSqLines(Hn(z[0]+.5*G[0],z[1]+.5*G[1],z[2]+.5*G[2]),Hn(F[0]-.5*H[0],F[1]-.5*H[1],F[2]-.5*H[2]),Hn(z[0]-.5*G[0],z[1]-.5*G[1],z[2]-.5*G[2]),Hn(F[0]+.5*H[0],F[1]+.5*H[1],F[2]+.5*H[2]))<=.0025000000000000005)continue;const K=this.vertices.length,ie=fs(wr(),g,T);this.vertices.push({position:qs(ie,ie,.5),height:.5*(_+E),extent:.5*(w+C)});const ne=fs(wr(),R,M);this.vertexProps.push({dir:Js(ne,ne)}),this.edges.splice(s,1),this.edgeProps.splice(s,1),this.edges.push({a:u,b:K}),this.edges.push({a:K,b:d});const se=Ds(wr(),this.vertices[K].position,g),Se=ss(se),we={vec:se,dir:qs(wr(),se,1/Se),len:Se};this.edgeProps.push(we),this.edgeProps.push(we)}}distSqLines(i,s,u,d){const g=Ii(De(),s,i),_=Ii(De(),d,u),w=Ii(De(),i,u),T=zi(g,g),E=zi(g,_),C=zi(g,w),R=zi(_,_),M=zi(_,w),z=T*R-E*E;if(z===0){const H=zi(w,_)/zi(_,_);return et(rs(De(),u,d,H),i)}const F=(E*M-C*R)/z,G=(T*M-E*C)/z;return et(rs(De(),i,s,F),rs(De(),u,d,G))}}class Pr{static parseFrom(i,s){const u=bi.parse(i);if(!u)return[];let{vertices:d,features:g}=u;const _=1/_e(s);g.sort((C,R)=>C.id-R.id),d.sort((C,R)=>C.id-R.id||C.idx-R.idx),d=d.filter((C,R,M)=>R===M.findIndex(z=>z.id===C.id&&z.idx===C.idx));const w=new Array;let T=0;const E=d.length;for(const C of g){if(C.constantHeight){w.push(new ki(C.id,C.bounds,C.constantHeight));continue}for(;T!==E&&d[T].id<C.id;)T++;if(T===E||d[T].id!==C.id)continue;const R=new Array,M=new Array,z=T;for(;T!==E&&d[T].id===C.id;){const F=d[T];if(R.push({position:F.position,height:F.height,extent:F.extent}),T!==z&&d[T-1].idx===F.idx-1){const G=T-z;M.push({a:G-1,b:G})}T++}w.push(new ki(C.id,C.bounds,void 0,R,M,_))}return w}static getElevationFeature(i,s){if(!s)return;const u=+i.properties[qt];return Number.isNaN(u)?void 0:s.find(d=>d.id===u)}}class xi{constructor(i,s){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(s)||(this.zScale=Math.pow(2,s.z-i.z),this.xOffset=(i.x*this.zScale-s.x)*Bt,this.yOffset=(i.y*this.zScale-s.y)*Bt)}constantElevation(i,s){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,s)}pointElevation(i,s,u){const d=this.constantElevation(s,u);return d??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(s.pointElevation(i),u))}computeBiasedHeight(i,s){return s<=0?i:i+s*Me(0,s,i>=0?i:Math.abs(.5*i))}}Xt(ki,"ElevationFeature");class Di{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Ko,this.indexArray=new yr,this.segments=new Cr,this.programConfigurations=new Ma(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new $u),this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,u,d){const g=this.layers[0],_=[];let w=null;g.type==="circle"&&(w=g.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:R,sourceLayerIndex:M}of i){const z=this.layers[0]._featureFilter.needGeometry,F=rt(E,z);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom,{worldview:this.worldview}),F,u))continue;const G=w?w.evaluate(F,{},u):void 0,H={id:C,properties:E.properties,type:E.type,sourceLayerIndex:M,index:R,geometry:z?F.geometry:Ce(E,u,d),patterns:{},sortKey:G};_.push(H)}w&&_.sort((E,C)=>E.sortKey-C.sortKey);let T=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new gm,T=d.projection);for(const E of _){const{geometry:C,index:R,sourceLayerIndex:M}=E,z=i[R].feature;this.addFeature(E,C,R,s.availableImages,u,T,s.brightness,s.elevationFeatures),s.featureIndex.insert(z,C,R,M,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,s,u,d,g,_,w){this.programConfigurations.updatePaintArrays(i,s,g,u,d,_,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,X0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,IE.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,EE.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,s,u,d,g,_,w,T){let E;this.elevationMode!=="none"&&(E=Pr.getElevationFeature(i,T));for(const C of s)for(const R of C){const M=R.x,z=R.y;if(M<0||M>=Bt||z<0||z>=Bt)continue;if(_){const H=_.projectTilePoint(M,z,g),K=_.upVector(g,M,z);this.addGlobeExtVertex(H,K),this.addGlobeExtVertex(H,K),this.addGlobeExtVertex(H,K),this.addGlobeExtVertex(H,K)}const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),G=F.vertexLength;if(this.addCircleVertex(M,z,-1,-1),this.addCircleVertex(M,z,1,-1),this.addCircleVertex(M,z,1,1),this.addCircleVertex(M,z,-1,1),this.elevationMode!=="none"){const H=E?E.pointElevation(new bt(M,z)):0;this.hasElevation=this.hasElevation||H!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack(G,G+1,G+2),this.indexArray.emplaceBack(G,G+2,G+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,{},d,g,w,void 0,this.worldview)}addCircleVertex(i,s,u,d){this.layoutVertexArray.emplaceBack(2*i+(u+1)/2,2*s+(d+1)/2)}addGlobeExtVertex(i,s){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,s[0]*16384,s[1]*16384,s[2]*16384)}}function Qi(l,i){for(let s=0;s<l.length;s++)if(ao(i,l[s]))return!0;for(let s=0;s<i.length;s++)if(ao(l,i[s]))return!0;return!!Zs(l,i)}function ns(l,i,s){return!!ao(l,i)||!!oo(i,l,s)}function Yr(l,i){if(l.length===1)return Ya(i,l[0]);for(let s=0;s<i.length;s++){const u=i[s];for(let d=0;d<u.length;d++)if(ao(l,u[d]))return!0}for(let s=0;s<l.length;s++)if(Ya(i,l[s]))return!0;for(let s=0;s<i.length;s++)if(Zs(l,i[s]))return!0;return!1}function os(l,i,s){if(l.length>1){if(Zs(l,i))return!0;for(let u=0;u<i.length;u++)if(oo(i[u],l,s))return!0}for(let u=0;u<l.length;u++)if(oo(l[u],i,s))return!0;return!1}function Zs(l,i){if(l.length===0||i.length===0)return!1;for(let s=0;s<l.length-1;s++){const u=l[s],d=l[s+1];for(let g=0;g<i.length-1;g++)if(xl(u,d,i[g],i[g+1]))return!0}return!1}function xl(l,i,s,u){return br(l,s,u)!==br(i,s,u)&&br(l,i,s)!==br(l,i,u)}function Bo(l,i,s){return(l.x-s.x)*(i.y-s.y)-(l.y-s.y)*(i.x-s.x)}function aa(l,i,s,u){const d=Bo(l,i,u),g=Bo(l,i,s);if(Math.sign(d)===Math.sign(g))return;const _=Bo(s,u,l),w=_+g-d;return Math.sign(_)!==Math.sign(w)?[_/(_-w),g/(g-d)]:void 0}function oo(l,i,s){const u=s*s;if(i.length===1)return l.distSqr(i[0])<u;for(let d=1;d<i.length;d++)if(Da(l,i[d-1],i[d])<u)return!0;return!1}function Da(l,i,s){const u=i.distSqr(s);if(u===0)return l.distSqr(i);const d=((l.x-i.x)*(s.x-i.x)+(l.y-i.y)*(s.y-i.y))/u;return l.distSqr(d<0?i:d>1?s:s.sub(i)._mult(d)._add(i))}function Ya(l,i){let s,u,d,g=!1;for(let _=0;_<l.length;_++){s=l[_];for(let w=0,T=s.length-1;w<s.length;T=w++)u=s[w],d=s[T],u.y>i.y!=d.y>i.y&&i.x<(d.x-u.x)*(i.y-u.y)/(d.y-u.y)+u.x&&(g=!g)}return g}function ao(l,i){let s=!1;for(let u=0,d=l.length-1;u<l.length;d=u++){const g=l[u],_=l[d];g.y>i.y!=_.y>i.y&&i.x<(_.x-g.x)*(i.y-g.y)/(_.y-g.y)+g.x&&(s=!s)}return s}function qr(l,i,s,u,d){for(const _ of l)if(i<=_.x&&s<=_.y&&u>=_.x&&d>=_.y)return!0;const g=[new bt(i,s),new bt(i,d),new bt(u,d),new bt(u,s)];if(l.length>2){for(const _ of g)if(ao(l,_))return!0}for(let _=0;_<l.length-1;_++)if(Nr(l[_],l[_+1],g))return!0;return!1}function Nr(l,i,s){const u=s[0],d=s[2];if(l.x<u.x&&i.x<u.x||l.x>d.x&&i.x>d.x||l.y<u.y&&i.y<u.y||l.y>d.y&&i.y>d.y)return!1;const g=br(l,i,s[0]);return g!==br(l,i,s[1])||g!==br(l,i,s[2])||g!==br(l,i,s[3])}function ir(l,i,s,u,d,g){let _=i.y-l.y,w=l.x-i.x;if(g=g||0){const T=_*_+w*w;if(T===0)return!0;const E=Math.sqrt(T);_/=E,w/=E}return!((s.x-l.x)*_+(s.y-l.y)*w-g<0||(u.x-l.x)*_+(u.y-l.y)*w-g<0||(d.x-l.x)*_+(d.y-l.y)*w-g<0)}function ps(l,i,s,u,d,g,_){return!(ir(l,i,u,d,g,_)||ir(i,s,u,d,g,_)||ir(s,l,u,d,g,_)||ir(u,d,l,i,s,_)||ir(d,g,l,i,s,_)||ir(g,u,l,i,s,_))}function Xs(l,i,s){const u=i.paint.get(l).value;return u.kind==="constant"?u.value:s.programConfigurations.get(i.id).getMaxValue(l)}function Wr(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function La(l,i,s,u,d){if(!i[0]&&!i[1])return l;const g=bt.convert(i)._mult(d);s==="viewport"&&g._rotate(-u);const _=[];for(let w=0;w<l.length;w++)_.push(l[w].sub(g));return _}function qu(l,i,s,u){const d=bt.convert(l)._mult(u);return i==="viewport"&&d._rotate(-s),d}let ou,id;function rd(l,i,s){var u=2*Math.PI*6378137/256/Math.pow(2,s);return[l*u-2*Math.PI*6378137/2,i*u-2*Math.PI*6378137/2]}Xt(Di,"CircleBucket",{omit:["layers"]});class Oa{constructor(i,s,u){this.z=i,this.x=s,this.y=u,this.key=za(0,i,i,s,u)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const s=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>s&&i.y===this.y>>s}url(i,s){const u=function(g,_,w){var T=rd(256*g,256*(_=Math.pow(2,w)-_-1),w),E=rd(256*(g+1),256*(_+1),w);return T[0]+","+T[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),d=function(g,_,w){let T,E="";for(let C=g;C>0;C--)T=1<<C-1,E+=(_&T?1:0)+(w&T?2:0);return E}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wl{constructor(i,s){this.wrap=i,this.canonical=s,this.key=za(i,s.z,s.z,s.x,s.y)}}class ms{constructor(i,s,u,d,g){this.overscaledZ=i,this.wrap=s,this.canonical=new Oa(u,+d,+g),this.key=s===0&&i===u?this.canonical.key:za(s,i,u,d,g)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const s=this.canonical.z-i;return i>this.canonical.z?new ms(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ms(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s=!0){if(this.overscaledZ===i&&s)return this.key;if(i>this.canonical.z)return za(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-i;return za(this.wrap*+s,i,i,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new ms(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new ms(s,this.wrap,s,u,d),new ms(s,this.wrap,s,u+1,d),new ms(s,this.wrap,s,u,d+1),new ms(s,this.wrap,s,u+1,d+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new ms(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new ms(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function za(l,i,s,u,d){const g=1<<Math.min(s,22);let _=g*(d%g)+u%g;return l&&s<22&&(_+=g*g*((l<0?-2*l-1:2*l)%(1<<2*(22-s)))),16*(32*_+s)+(i-s)}const Wu=[l=>{let i=l.canonical.x-1,s=l.wrap;return i<0&&(i=(1<<l.canonical.z)-1,s--),new ms(l.overscaledZ,s,l.canonical.z,i,l.canonical.y)},l=>{let i=l.canonical.x+1,s=l.wrap;return i===1<<l.canonical.z&&(i=0,s++),new ms(l.overscaledZ,s,l.canonical.z,i,l.canonical.y)},l=>new ms(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new ms(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Xt(Oa,"CanonicalTileID"),Xt(ms,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const p8=di([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:tw}=p8,m8=di([{name:"a_pos_3",components:3,type:"Int16"}]);var nk=di([{name:"a_pos",type:"Int16",components:2}]);function nw(l){return l*To/A}const g8=[new ti([y,y,y],[x,x,x]),new ti([y,y,y],[0,0,x]),new ti([0,y,y],[x,0,x]),new ti([y,0,y],[0,x,x]),new ti([0,0,y],[x,x,x])];function ik(l,i,s,u=!0){const d=Pn([],l._camera.position,l.worldSize),g=[i,s,1,1];Es(g,g,l.pixelMatrixInverse),Qs(g,g,1/g[3]);const _=qn([],Vi([],g,d)),w=l.globeMatrix,T=[w[12],w[13],w[14]],E=Vi([],T,d),C=Be(E),R=qn([],E),M=l.worldSize/(2*Math.PI),z=zi(R,_),F=Math.asin(M/C);if(F<Math.acos(z)){if(!u)return null;const at=[],He=[];Pn(at,_,C/z),qn(He,Vi(He,at,E)),qn(_,ii(_,E,Pn(_,He,Math.tan(F)*C)))}const G=[];new Ti(d,_).closestPointOnSphere(T,M,G);const H=qn([],tr(w,0)),K=qn([],tr(w,1)),ie=qn([],tr(w,2)),ne=zi(H,G),se=zi(K,G),Se=zi(ie,G),we=Ge(Math.asin(-se/M));let Te=Ge(Math.atan2(ne,Se));Te=l.center.lng+function(at,He){const ht=(He-at+180)%360-180;return ht<-180?ht+360:ht}(l.center.lng,Te);const Oe=$(Te),Ne=he(X(we),0,1);return new ve(Oe,Ne)}class _8{constructor(i,s,u){this.a=Vi([],i,u),this.b=Vi([],s,u),this.center=u;const d=qn([],this.a),g=qn([],this.b);this.angle=Math.acos(zi(d,g))}}function DE(l,i){if(l.angle===0)return null;let s;return s=l.a[i]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[i]/l.a[i]/Math.sin(l.angle)-1/Math.tan(l.angle)),s<0||s>1?null:function(u,d,g,_){const w=Math.sin(g);return u*(Math.sin((1-_)*g)/w)+d*(Math.sin(_*g)/w)}(l.a[i],l.b[i],l.angle,he(s,0,1))+l.center[i]}function au(l){if(l.z<=1)return g8[l.z+2*l.y+l.x];const i=LE(iw(l));return ti.fromPoints(i)}function Zu(l,i,s){return Pn(l,l,1-s),oi(l,l,i,s)}function rk(l,i,s){for(const u of l)Wi(u,u,i),Pn(u,u,s)}function sk(l,i,s,u){const d=i/l.worldSize,g=l.globeMatrix;if(s.z<=1){const Ne=au(s).getCorners();return rk(Ne,g,d),ti.fromPoints(Ne)}const _=iw(s,u),w=LE(_,To+nw(l._tileCoverLift));rk(w,g,d);const T=Number.MAX_VALUE,E=[-T,-T,-T],C=[T,T,T];if(_.contains(l.center)){for(const He of w)Vn(C,C,He),je(E,E,He);E[2]=0;const Ne=l.point,at=[Ne.x*d,Ne.y*d,0];return Vn(C,C,at),je(E,E,at),new ti(C,E)}if(l._tileCoverLift>0){for(const Ne of w)Vn(C,C,Ne),je(E,E,Ne);return new ti(C,E)}const R=[g[12]*d,g[13]*d,g[14]*d],M=_.getCenter(),z=he(l.center.lat,-fe,fe),F=he(M.lat,-fe,fe),G=$(l.center.lng),H=X(z);let K=G-$(M.lng);const ie=H-X(F);K>.5?K-=1:K<-.5&&(K+=1);let ne=0;Math.abs(K)>Math.abs(ie)?ne=K>=0?1:3:(ne=ie>=0?0:2,oi(R,R,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(fi(ie>=0?_.getSouth():_.getNorth()))*To));const se=w[ne],Se=w[(ne+1)%4],we=new _8(se,Se,R),Te=[DE(we,0)||se[0],DE(we,1)||se[1],DE(we,2)||se[2]],Oe=sd(l.zoom);if(Oe>0){const Ne=function({x:He,y:ht,z:Mt},gt,It,Rt,st){const St=1/(1<<Mt);let qe=He*St,ot=qe+St,zt=ht*St,At=zt+St,ln=0;const Kt=(qe+ot)/2-Rt;return Kt>.5?ln=-1:Kt<-.5&&(ln=1),qe=((qe+ln)*gt-(Rt*=gt))*It+Rt,ot=((ot+ln)*gt-Rt)*It+Rt,zt=(zt*gt-(st*=gt))*It+st,At=(At*gt-st)*It+st,[[qe,At,0],[ot,At,0],[ot,zt,0],[qe,zt,0]]}(s,i,l._pixelsPerMercatorPixel,G,H);for(let He=0;He<w.length;He++)Zu(w[He],Ne[He],Oe);const at=ii([],Ne[ne],Ne[(ne+1)%4]);Pn(at,at,.5),Zu(Te,at,Oe)}for(const Ne of w)Vn(C,C,Ne),je(E,E,Ne);return C[2]=Math.min(se[2],Se[2]),Vn(C,C,Te),je(E,E,Te),new ti(C,E)}function iw({x:l,y:i,z:s},u=!1){const d=1/(1<<s),g=new L(te(l*d),i===(1<<s)-1&&u?-90:re((i+1)*d)),_=new L(te((l+1)*d),i===0&&u?90:re(i*d));return new B(g,_)}function LE(l,i=To){const s=fi(l.getNorth()),u=fi(l.getSouth()),d=Math.cos(s),g=Math.cos(u),_=Math.sin(s),w=Math.sin(u),T=l.getWest(),E=l.getEast();return[b(g,w,T,i),b(g,w,E,i),b(d,_,E,i),b(d,_,T,i)]}function _y(l,i,s,u){const d=1<<s.z,g=(l/Bt+s.x)/d;return I(re((i/Bt+s.y)/d),te(g),u)}function rw({min:l,max:i}){return r/Math.max(i[0]-l[0],i[1]-l[1],i[2]-l[2])}const ok=new Float64Array(16);function sw(l){const i=rw(l),s=Pe(ok,[i,i,i]);return ge(s,s,Kr([],l.min))}function OE(l){const i=(u=l.min,(s=ok)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=u[0],s[13]=u[1],s[14]=u[2],s[15]=1,s);var s,u;const d=1/rw(l);return Re(i,i,[d,d,d])}function zE(l){const i=Bt/(2*Math.PI);return l/(2*Math.PI)/i}function ak(l,i){return Bt/(512*Math.pow(2,l))*rw(au(i))}function lk(l,i,s,u,d){const g=zE(s),_=[l,i,-s/(2*Math.PI)],w=me(new Float64Array(16));return ge(w,w,_),Re(w,w,[g,g,g]),_t(w,w,fi(-d)),ct(w,w,fi(-u)),w}function sd(l){return Me(ew,f,l)}function ck(l,i){const s=I(i.lat,i.lng),u=function(F){const G=I(F._center.lat,F._center.lng);let H=ar([],Hn(0,1,0),G);const K=xe([],-F.angle,G);H=Wi(H,H,K),xe(K,-F._pitch,H);const ie=qn([],G);return Pn(ie,ie,nw(F.cameraToCenterDistance/F.pixelsPerMeter)),Wi(ie,ie,K),ii([],G,ie)}(l);return _=(d=Ii([],u,s))[0],w=d[1],T=d[2],E=(g=s)[0],C=g[1],R=g[2],z=(M=Math.sqrt(_*_+w*w+T*T)*Math.sqrt(E*E+C*C+R*R))&&zi(d,g)/M,Math.acos(Math.min(Math.max(z,-1),1));var d,g,_,w,T,E,C,R,M,z}function FE(l,i){return ck(l,i)>Math.PI/2*1.01}const uk=fi(85),y8=Math.cos(uk),v8=Math.sin(uk),x8=oe(),hk=l=>{const i=[];return l.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function dk(l,i,s,u,d,g,_,w,T){if(g&&l.queryGeometry.isAboveHorizon)return!1;g&&(T*=l.pixelToTileUnitsFactor);const E=l.tileID.canonical,C=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(const R of i)for(const M of R){const z=M.add(w),F=d&&s.elevation?s.elevation.exaggeration()*d.getElevationAt(z.x,z.y,!0):0,G=s.projection.projectTilePoint(z.x,z.y,E);if(F>0){const ne=s.projection.upVector(E,z.x,z.y);G.x+=ne[0]*C*F,G.y+=ne[1]*C*F,G.z+=ne[2]*C*F}const H=g?z:w8(G.x,G.y,G.z,u),K=g?l.tilespaceRays.map(ne=>T8(ne,F)):l.queryGeometry.screenGeometry,ie=Es([],[G.x,G.y,G.z,1],u);if(!_&&g?T*=ie[3]/s.cameraToCenterDistance:_&&!g&&(T*=s.cameraToCenterDistance/ie[3]),g){const ne=re((M.y/Bt+E.y)/(1<<E.z));T/=s.projection.pixelsPerMeter(ne,1)/Z(1,ne)}if(ns(K,H,T))return!0}return!1}function w8(l,i,s,u){const d=Es([],[l,i,s,1],u);return new bt(d[0]/d[3],d[1]/d[3])}const fk=Hn(0,0,0),b8=Hn(0,0,1);function T8(l,i){const s=De();return fk[2]=i,l.intersectsPlane(fk,b8,s),new bt(s[0],s[1])}class pk extends Di{}let mk,gk,_k,yk;function vk(l,{width:i,height:s},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==i*s*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(i*s*u);return l.width=i,l.height=s,l.data=d,l}function xk(l,i,s){const{width:u,height:d}=i;u===l.width&&d===l.height||(NE(l,i,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,u),height:Math.min(l.height,d)},s,null),l.width=u,l.height=d,l.data=i.data)}function NE(l,i,s,u,d,g,_,w){if(d.width===0||d.height===0)return i;if(d.width>l.width||d.height>l.height||s.x>l.width-d.width||s.y>l.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>i.width||d.height>i.height||u.x>i.width-d.width||u.y>i.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const T=l.data,E=i.data,C=g===4&&w;for(let R=0;R<d.height;R++){const M=((s.y+R)*l.width+s.x)*g,z=((u.y+R)*i.width+u.x)*g;if(C)for(let F=0;F<d.width;F++){const G=M+F*g+3,H=z+F*g;E[H+0]=255,E[H+1]=255,E[H+2]=255,E[H+3]=T[G]}else if(_)for(let F=0;F<d.width;F++){const G=M+F*g,H=z+F*g,K=new wi(T[G+0]/255,T[G+1]/255,T[G+2]/255,T[G+3]).toNonPremultipliedRenderColor(_).toArray();E[H+0]=K[0],E[H+1]=K[1],E[H+2]=K[2],E[H+3]=K[3]}else for(let F=0;F<d.width*g;F++)E[z+F]=T[M+F]}return i}Xt(pk,"HeatmapBucket",{omit:["layers"]});class od{constructor(i,s){vk(this,i,1,s)}resize(i){xk(this,new od(i),1)}clone(){return new od({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,u,d,g){NE(i,s,u,d,g,1,null)}}class lo{constructor(i,s){vk(this,i,4,s)}resize(i){xk(this,new lo(i),4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,u,d,g,_,w){NE(i,s,u,d,g,4,_,w)}}class wk{constructor(i,s){this.width=i.width,this.height=i.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function yy(l){const i={},s=l.resolution||256,u=l.clips?l.clips.length:1,d=l.image||new lo({width:s,height:u}),g=(_,w,T)=>{i[l.evaluationKey]=T;const E=l.expression.evaluate(i),C=E?E.toNonPremultipliedRenderColor(null):null;C&&(d.data[_+w+0]=Math.floor(255*C.r),d.data[_+w+1]=Math.floor(255*C.g),d.data[_+w+2]=Math.floor(255*C.b),d.data[_+w+3]=Math.floor(255*C.a))};if(l.clips)for(let _=0,w=0;_<u;++_,w+=4*s)for(let T=0,E=0;T<s;T++,E+=4){const C=T/(s-1),{start:R,end:M}=l.clips[_];g(w,E,R*(1-C)+M*C)}else for(let _=0,w=0;_<s;_++,w+=4)g(0,w,_/(s-1));return d}Xt(od,"AlphaImage"),Xt(lo,"RGBAImage");const E8=di([{name:"a_pos",components:2,type:"Int16"}],4),I8=di([{name:"a_road_z_offset",components:1,type:"Float32"}],4),S8=di([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),A8=di([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Im(l,i,s=2){const u=i&&i.length,d=u?i[0]*s:l.length;let g=bk(l,0,d,s,!0);const _=[];if(!g||g.next===g.prev)return _;let w,T,E;if(u&&(g=function(C,R,M,z){const F=[];for(let G=0,H=R.length;G<H;G++){const K=bk(C,R[G]*z,G<H-1?R[G+1]*z:C.length,z,!1);K===K.next&&(K.steiner=!0),F.push(O8(K))}F.sort(M8);for(let G=0;G<F.length;G++)M=D8(F[G],M);return M}(l,i,g,s)),l.length>80*s){w=l[0],T=l[1];let C=w,R=T;for(let M=s;M<d;M+=s){const z=l[M],F=l[M+1];z<w&&(w=z),F<T&&(T=F),z>C&&(C=z),F>R&&(R=F)}E=Math.max(C-w,R-T),E=E!==0?32767/E:0}return vy(g,_,s,w,T,E,0),_}function bk(l,i,s,u,d){let g;if(d===function(_,w,T,E){let C=0;for(let R=w,M=T-E;R<T;R+=E)C+=(_[M]-_[R])*(_[R+1]+_[M+1]),M=R;return C}(l,i,s,u)>0)for(let _=i;_<s;_+=u)g=Sk(_/u|0,l[_],l[_+1],g);else for(let _=s-u;_>=i;_-=u)g=Sk(_/u|0,l[_],l[_+1],g);return g&&Sm(g,g.next)&&(by(g),g=g.next),g}function Of(l,i){if(!l)return l;i||(i=l);let s,u=l;do if(s=!1,u.steiner||!Sm(u,u.next)&&Vs(u.prev,u,u.next)!==0)u=u.next;else{if(by(u),u=i=u.prev,u===u.next)break;s=!0}while(s||u!==i);return i}function vy(l,i,s,u,d,g,_){if(!l)return;!_&&g&&function(T,E,C,R){let M=T;do M.z===0&&(M.z=BE(M.x,M.y,E,C,R)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==T);M.prevZ.nextZ=null,M.prevZ=null,function(z){let F,G=1;do{let H,K=z;z=null;let ie=null;for(F=0;K;){F++;let ne=K,se=0;for(let we=0;we<G&&(se++,ne=ne.nextZ,ne);we++);let Se=G;for(;se>0||Se>0&&ne;)se!==0&&(Se===0||!ne||K.z<=ne.z)?(H=K,K=K.nextZ,se--):(H=ne,ne=ne.nextZ,Se--),ie?ie.nextZ=H:z=H,H.prevZ=ie,ie=H;K=ne}ie.nextZ=null,G*=2}while(F>1)}(M)}(l,u,d,g);let w=l;for(;l.prev!==l.next;){const T=l.prev,E=l.next;if(g?P8(l,u,d,g):C8(l))i.push(T.i,l.i,E.i),by(l),l=E.next,w=E.next;else if((l=E)===w){_?_===1?vy(l=R8(Of(l),i),i,s,u,d,g,2):_===2&&k8(l,i,s,u,d,g):vy(Of(l),i,s,u,d,g,1);break}}}function C8(l){const i=l.prev,s=l,u=l.next;if(Vs(i,s,u)>=0)return!1;const d=i.x,g=s.x,_=u.x,w=i.y,T=s.y,E=u.y,C=Math.min(d,g,_),R=Math.min(w,T,E),M=Math.max(d,g,_),z=Math.max(w,T,E);let F=u.next;for(;F!==i;){if(F.x>=C&&F.x<=M&&F.y>=R&&F.y<=z&&xy(d,w,g,T,_,E,F.x,F.y)&&Vs(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function P8(l,i,s,u){const d=l.prev,g=l,_=l.next;if(Vs(d,g,_)>=0)return!1;const w=d.x,T=g.x,E=_.x,C=d.y,R=g.y,M=_.y,z=Math.min(w,T,E),F=Math.min(C,R,M),G=Math.max(w,T,E),H=Math.max(C,R,M),K=BE(z,F,i,s,u),ie=BE(G,H,i,s,u);let ne=l.prevZ,se=l.nextZ;for(;ne&&ne.z>=K&&se&&se.z<=ie;){if(ne.x>=z&&ne.x<=G&&ne.y>=F&&ne.y<=H&&ne!==d&&ne!==_&&xy(w,C,T,R,E,M,ne.x,ne.y)&&Vs(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,se.x>=z&&se.x<=G&&se.y>=F&&se.y<=H&&se!==d&&se!==_&&xy(w,C,T,R,E,M,se.x,se.y)&&Vs(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ne&&ne.z>=K;){if(ne.x>=z&&ne.x<=G&&ne.y>=F&&ne.y<=H&&ne!==d&&ne!==_&&xy(w,C,T,R,E,M,ne.x,ne.y)&&Vs(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;se&&se.z<=ie;){if(se.x>=z&&se.x<=G&&se.y>=F&&se.y<=H&&se!==d&&se!==_&&xy(w,C,T,R,E,M,se.x,se.y)&&Vs(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function R8(l,i){let s=l;do{const u=s.prev,d=s.next.next;!Sm(u,d)&&Ek(u,s,s.next,d)&&wy(u,d)&&wy(d,u)&&(i.push(u.i,s.i,d.i),by(s),by(s.next),s=l=d),s=s.next}while(s!==l);return Of(s)}function k8(l,i,s,u,d,g){let _=l;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&z8(_,w)){let T=Ik(_,w);return _=Of(_,_.next),T=Of(T,T.next),vy(_,i,s,u,d,g,0),void vy(T,i,s,u,d,g,0)}w=w.next}_=_.next}while(_!==l)}function M8(l,i){let s=l.x-i.x;return s===0&&(s=l.y-i.y,s===0)&&(s=(l.next.y-l.y)/(l.next.x-l.x)-(i.next.y-i.y)/(i.next.x-i.x)),s}function D8(l,i){const s=function(d,g){let _=g;const w=d.x,T=d.y;let E,C=-1/0;if(Sm(d,_))return _;do{if(Sm(d,_.next))return _.next;if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){const G=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(G<=w&&G>C&&(C=G,E=_.x<_.next.x?_:_.next,G===w))return E}_=_.next}while(_!==g);if(!E)return null;const R=E,M=E.x,z=E.y;let F=1/0;_=E;do{if(w>=_.x&&_.x>=M&&w!==_.x&&Tk(T<z?w:C,T,M,z,T<z?C:w,T,_.x,_.y)){const G=Math.abs(T-_.y)/(w-_.x);wy(_,d)&&(G<F||G===F&&(_.x>E.x||_.x===E.x&&L8(E,_)))&&(E=_,F=G)}_=_.next}while(_!==R);return E}(l,i);if(!s)return i;const u=Ik(s,l);return Of(u,u.next),Of(s,s.next)}function L8(l,i){return Vs(l.prev,l,i.prev)<0&&Vs(i.next,l,l.next)<0}function BE(l,i,s,u,d){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-s)*d|0)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-u)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function O8(l){let i=l,s=l;do(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next;while(i!==l);return s}function Tk(l,i,s,u,d,g,_,w){return(d-_)*(i-w)>=(l-_)*(g-w)&&(l-_)*(u-w)>=(s-_)*(i-w)&&(s-_)*(g-w)>=(d-_)*(u-w)}function xy(l,i,s,u,d,g,_,w){return!(l===_&&i===w)&&Tk(l,i,s,u,d,g,_,w)}function z8(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(s,u){let d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==u.i&&d.next.i!==u.i&&Ek(d,d.next,s,u))return!0;d=d.next}while(d!==s);return!1}(l,i)&&(wy(l,i)&&wy(i,l)&&function(s,u){let d=s,g=!1;const _=(s.x+u.x)/2,w=(s.y+u.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&_<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==s);return g}(l,i)&&(Vs(l.prev,l,i.prev)||Vs(l,i.prev,i))||Sm(l,i)&&Vs(l.prev,l,l.next)>0&&Vs(i.prev,i,i.next)>0)}function Vs(l,i,s){return(i.y-l.y)*(s.x-i.x)-(i.x-l.x)*(s.y-i.y)}function Sm(l,i){return l.x===i.x&&l.y===i.y}function Ek(l,i,s,u){const d=aw(Vs(l,i,s)),g=aw(Vs(l,i,u)),_=aw(Vs(s,u,l)),w=aw(Vs(s,u,i));return d!==g&&_!==w||!(d!==0||!ow(l,s,i))||!(g!==0||!ow(l,u,i))||!(_!==0||!ow(s,l,u))||!(w!==0||!ow(s,i,u))}function ow(l,i,s){return i.x<=Math.max(l.x,s.x)&&i.x>=Math.min(l.x,s.x)&&i.y<=Math.max(l.y,s.y)&&i.y>=Math.min(l.y,s.y)}function aw(l){return l>0?1:l<0?-1:0}function wy(l,i){return Vs(l.prev,l,l.next)<0?Vs(l,i,l.next)>=0&&Vs(l,l.prev,i)>=0:Vs(l,i,l.prev)<0||Vs(l,l.next,i)<0}function Ik(l,i){const s=VE(l.i,l.x,l.y),u=VE(i.i,i.x,i.y),d=l.next,g=i.prev;return l.next=i,i.prev=l,s.next=d,d.prev=s,u.next=s,s.prev=u,g.next=u,u.prev=g,u}function Sk(l,i,s,u){const d=VE(l,i,s);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function by(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function VE(l,i,s){return{i:l,x:i,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Ty(l,i){const s=l.length;if(s<=1)return[l];const u=[];let d,g;for(let _=0;_<s;_++){const w=Tr(l[_]);w!==0&&(l[_].area=Math.abs(w),g===void 0&&(g=w<0),g===w<0?(d&&u.push(d),d=[l[_]]):d.push(l[_]))}if(d&&u.push(d),i>1)for(let _=0;_<u.length;_++)u[_].length<=i||(wo(u[_],i,1,u[_].length-1,F8),u[_]=u[_].slice(0,i));return u}function F8(l,i){return i.area-l.area}function Ak(l,i,s=1){if(!l)return null;const u=typeof l=="string"?Gi.from(l).getPrimary():l.getPrimary(),d=typeof l=="string"?null:l.getSecondary();for(const g of[u,d]){if(!g)continue;const _=g.id.toString();i.has(_)||i.set(_,[]),g.scaleSelf(s),i.get(_).push(g)}return{primary:u.toString(),secondary:d?d.toString():null}}function UE(l,i,s,u){const d=u.patternDependencies;let g=!1;for(const _ of i){const w=_.paint.get(`${l}-pattern`);w.isConstant()||(g=!0),Ak(w.constantOr(null),d,s)&&(g=!0)}return g}function jE(l,i,s,u,d,g){const _=g.patternDependencies;for(const w of i){const T=w.paint.get(`${l}-pattern`).value;if(T.kind!=="constant"){let E=T.evaluate({zoom:u},s,{},g.availableImages);E=E&&E.name?E.name:E;const C=Ak(E,_,d);if(!C)continue;const{primary:R,secondary:M}=C;R&&(s.patterns[w.id]=[R,M].filter(Boolean))}}return s}class Ck{constructor(){this.polygons=new Map}add(i,...s){this.polygons.has(i)?this.polygons.get(i).push(...s):this.polygons.set(i,s)}merge(i){for(const[s,u]of i.polygons)this.add(s,...u)}}class zf{constructor(){this.portals=[]}static evaluate(i){if(i.length===0)return new zf;let s=[];for(const E of i)s.push(...E.portals);if(s.length===0)return new zf;const u=(E,C)=>E<=0&&C<=0||E>=Bt&&C>=Bt;for(const E of s){const C=E.va,R=E.vb;(u(C.x,R.x)||u(C.y,R.y))&&(E.type="border")}const d=s.filter(E=>E.type!=="unevaluated"),g=s.filter(E=>E.type==="unevaluated");if(g.length===0)return new zf;g.sort((E,C)=>E.hash===C.hash?E.isTunnel===C.isTunnel?0:E.isTunnel?-1:1:E.hash<C.hash?1:-1),s=d.concat(g);let _=d.length,w=_,T=_;do if(w++,w===s.length||s[_].hash!==s[w].hash){if(w-_==2){T<_&&(s[T]=s[_],s[_]=null);const E=s[T],C=s[w-1];E.type=E.isTunnel!==C.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:C.connection.a},T++}_=w}while(_!==s.length);return s.splice(T),s.sort((E,C)=>E.hash<C.hash?1:-1),{portals:s}}}Xt(zf,"ElevationPortalGraph"),Xt(Ck,"ElevationPolygons");class N8{constructor(i,s,u){this.outPositions=i,this.outNormals=s,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(i,s,u){let d=i[2];u!=null&&(d*=u);const g=this.getVec3Bits(i)<<96n|this.getVec3Bits(s),_=this.vertexLookup.get(g);if(_!=null)return _;const w=this.outPositions.length;this.vertexLookup.set(g,w);const T=Math.trunc(16384*s[0]),E=Math.trunc(16384*s[1]),C=Math.trunc(16384*s[2]);return this.outPositions.emplaceBack(i[0],i[1],d),this.outNormals.emplaceBack(T,E,C),w}addTriangle(i,s,u){this.outIndices.emplaceBack(i,s,u)}addTriangles(i,s,u){if(i.length===0)return;const d=u.length===1,g=De(),_=De();for(let w=0;w<i.length;w+=3){const T=s[i[w+0]],E=s[i[w+1]],C=s[i[w+2]],R=d?u[0]:u[i[w+1]],M=d?u[0]:u[i[w+2]];Ln(g,T.x,T.y,d?u[0]:u[i[w+0]]);const z=this.addVertex(g,_);Ln(g,E.x,E.y,R);const F=this.addVertex(g,_);Ln(g,C.x,C.y,M);const G=this.addVertex(g,_);this.outIndices.emplaceBack(z,F,G)}}addQuad(i,s,u,d,g,_){const w=this.addVertex(i,g,_),T=this.addVertex(s,g,_),E=this.addVertex(u,g,_),C=this.addVertex(d,g,_);this.addTriangle(w,T,E),this.addTriangle(E,C,w)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(i){return this.view.setFloat32(0,i),BigInt(this.view.getUint32(0))}getVec3Bits(i){return this.getBits(i[0])<<64n|this.getBits(i[1])<<32n|this.getBits(i[2])}}class Fa{constructor(i,s,u,d){this.unevaluatedPortals=new zf,this.portalPolygons=new Ck,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Q_,this.vertexNormals=new J_,this.indexArray=new yr,this.tileToMeters=_e(i),this.bridgeProgramConfigurations=new Ma(s,{zoom:u,lut:d},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ma(s,{zoom:u,lut:d},g=>g!=="fill-bridge-guard-rail-color")}addVertices(i,s){const u=this.unevalVertices.length;for(let d=0;d<i.length;d++)this.unevalVertices.push(i[d]),this.unevalHeights.push(s[d]);return u}addTriangles(i,s,u){const d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of i)d.push(g+s)}addRenderableRing(i,s,u,d,g,_){const w=[new bt(g.min.x,g.min.y),new bt(g.max.x,g.min.y),new bt(g.max.x,g.max.y),new bt(g.min.x,g.max.y)];for(let T=0;T<u-1;T++){const E=s+T,C=E+1,R=this.unevalVertices[E],M=this.unevalVertices[C];if(!(R.x>=g.min.x&&R.x<=g.max.x&&R.y>=g.min.y&&R.y<=g.max.y||M.x>=g.min.x&&M.x<=g.max.x&&M.y>=g.min.y&&M.y<=g.max.y||Nr(R,M,w))||this.isOnBorder(R.x,M.x)||this.isOnBorder(R.y,M.y))continue;const z=Fa.computeEdgeHash(this.unevalVertices[E],this.unevalVertices[C]);let F,G=this.vertexHashLookup.get(Fa.computePosHash(R));G!=null?F=G.next:(G=this.vertexHashLookup.get(Fa.computePosHash(M)),F=G!=null?G.prev:z),this.unevalEdges.push({polygonIdx:i,a:E,b:C,hash:z,portalHash:F,isTunnel:d,type:"unevaluated",featureInfo:_})}}addPortalCandidates(i,s,u,d,g){if(s.length===0)return;this.portalPolygons.add(i,{geometry:s,zLevel:g});const _=s[0];this.vertexHashLookup.clear();let w=Fa.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let T=0;T<_.length-1;T++){const E=_[T+0],C=_[T+1],R=Ur(C.x-E.x,C.y-E.y),M=ss(R);if(M===0)continue;let z="unevaluated";const F=d.pointElevation(E),G=d.pointElevation(C);Math.abs(F)<.01&&Math.abs(G)<.01?z="entrance":(this.isOnBorder(E.x,C.x)||this.isOnBorder(E.y,C.y))&&(z="border");const H=Fa.computeEdgeHash(E,C);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:E,vb:C,vab:R,length:M,hash:H,isTunnel:u,type:z});const K=Fa.computePosHash(E);this.vertexHashLookup.set(K,{prev:w,next:H}),w=H}}construct(i){if(this.unevalVertices.length===0)return;const s=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=M=>{M.primitiveLength=this.indexArray.length-M.primitiveOffset},d=new N8(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const g=s(),_=s(),w=s(),T=(M,z)=>{M.sort((G,H)=>G.type===z&&H.type!==z?-1:G.type!==z&&H.type===z?1:0);const F=M.findIndex(G=>G.type!==z);return F>=0?F:M.length};let E=0;this.unevalEdges.length>0&&(E=T(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},this.tileToMeters)),u(w);const C=s(),R=s();if(this.unevalEdges.length>0){const M=this.unevalEdges.splice(E),z=T(M,"tunnel")+E;this.unevalEdges.push(...M),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:E},{min:E,max:z})}u(C),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(R),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(_),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=Cr.simpleSegment(0,R.primitiveOffset,0,R.primitiveLength),this.depthSegments=Cr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=Cr.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=Cr.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.shadowCasterSegments=Cr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(i,s,u,d,g,_,w,T){this.bridgeProgramConfigurations.updatePaintArrays(i,s,g,u,d,_,w,T),this.tunnelProgramConfigurations.updatePaintArrays(i,s,g,u,d,_,w,T)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,S8.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,A8.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,s,u,d,g){const _=(w,T)=>{for(let E=0;E<T.length-1;E++){const C=T[E].featureIndex,R=T[E+1].vertexStart,M=i.feature(C);w.populatePaintArrays(R,M,C,{},u,s,d,void 0,g)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,s,u,d,g){const _=new Map;for(let w=d;w<g;w++){const T=u[w],E=T.a,C=T.b,R=Fa.computePosHash(i[E]),M=Fa.computePosHash(i[C]);let z=_.get(R);z||(z={},_.set(R,z));let F=_.get(M);F||(F={},_.set(M,F)),s[E]<=0&&s[C]<=0||(z.to=C,F.from=E)}return _}isTerminalVertex(i,s){const u=Fa.computePosHash(this.unevalVertices[i]),d=s.get(u);return!d||!d.from||!d.to}constructBridgeStructures(i,s,u,d,g,_){i.clearVertexLookup();const w=this.computeVertexConnections(s,u,d,g.min,g.max),T=1/_,E=.5*T,C=(It,Rt)=>Ln(It,s[Rt].x,s[Rt].y,u[Rt]*T),R=De(),M=De(),z=De(),F=De(),G=De(),H=(It,Rt)=>{const st=w.get(Fa.computePosHash(s[Rt])),St=st.from,qe=st.to;if(!St||!qe)return;C(R,St),C(M,Rt),C(z,qe),Ea(F),Hs(R,M)||(Vi(G,M,R),qn(F,G)),Hs(z,M)||(Vi(G,z,M),ii(F,F,qn(G,G)));const ot=Ro(F);return ot>0?Pn(It,F,1/ot):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,(It,Rt)=>It.featureInfo.featureIndex-Rt.featureInfo.featureIndex);const ie=De(),ne=De(),se=De(),Se=De(),we=De(),Te=De(),Oe=De(),Ne=De(),at=De(),He=[De(),De(),De(),De()],ht=[De(),De(),De(),De()],Mt=[{coord:new bt(0,0),height:0},{coord:new bt(0,0),height:0}],gt=(It,Rt)=>It>Rt;for(let It=g.min;It<g.max;It++){const Rt=d[It];if(!Rt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Mt,s,u,Rt,gt))continue;const[st,St]=Mt;if(Ln(ie,st.coord.x,st.coord.y,T*st.height),Ln(ne,St.coord.x,St.coord.y,T*St.height),Hs(ie,ne))continue;Vi(se,ne,ie),qn(se,se);const qe=H(Ne,Rt.a)||se,ot=H(at,Rt.b)||se;Ln(Se,qe[1],-qe[0],0),qn(Se,Se),Ln(we,ot[1],-ot[0],0),qn(we,we),ar(Ne,Se,qe),qn(Te,Ne),ar(Ne,we,ot),qn(Oe,Ne),ii(He[0],ie,Pn(Ne,Vi(Ne,Se,Te),E)),ii(He[1],ie,Pn(Ne,ii(Ne,Se,Te),E)),ii(He[2],ie,Pn(Ne,Te,E)),He[3]=ie,ii(ht[0],ne,Pn(Ne,Vi(Ne,we,Oe),E)),ii(ht[1],ne,Pn(Ne,ii(Ne,we,Oe),E)),ii(ht[2],ne,Pn(Ne,Oe,E)),ht[3]=ne,K=this.addFeatureSection(Rt.featureInfo.featureIndex,K,this.bridgeFeatureSections,i);const zt=i.addVertex(He[0],Se,_),At=i.addVertex(He[1],Se,_),ln=i.addVertex(ht[0],we,_),Kt=i.addVertex(ht[1],we,_);i.addTriangle(zt,At,ln),i.addTriangle(At,Kt,ln);const Tt=i.addVertex(He[1],Te,_),Ct=i.addVertex(He[2],Te,_),Jt=i.addVertex(ht[1],Oe,_),Wt=i.addVertex(ht[2],Oe,_);i.addTriangle(Tt,Ct,Jt),i.addTriangle(Ct,Wt,Jt),Kr(Se,Se),Kr(we,we);const Vt=i.addVertex(He[2],Se,_),Zt=i.addVertex(He[3],Se,_),Tn=i.addVertex(ht[2],we,_),kn=i.addVertex(ht[3],we,_);i.addTriangle(Vt,Zt,Tn),i.addTriangle(Zt,kn,Tn);const Un=this.isTerminalVertex(Rt.a,w),On=this.isTerminalVertex(Rt.b,w);st.height<.01&&Un&&i.addQuad(He[3],He[2],He[1],He[0],Kr(qe,qe),_),St.height<.01&&On&&i.addQuad(ht[0],ht[1],ht[2],ht[3],ot,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,s,u,d,g,_){i.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const T=(K,ie)=>K.featureInfo.featureIndex-ie.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,T),this.sortSubarray(d,_.min,_.max,T);const E=K=>qn(K,K),C=[{coord:new bt(0,0),height:0},{coord:new bt(0,0),height:0}],R=(K,ie)=>K<ie,M=De(),z=De(),F=De(),G=De(),H=De();for(let K=g.min;K<g.max;K++){if(!this.prepareEdgePoints(C,s,u,d[K],R))continue;const[ie,ne]=C,se=E(Ln(H,-(ne.coord.y-ie.coord.y),ne.coord.x-ie.coord.x,0));w=this.addFeatureSection(d[K].featureInfo.featureIndex,w,this.tunnelFeatureSections,i),i.addQuad(Ln(M,ie.coord.x,ie.coord.y,ie.height),Ln(z,ne.coord.x,ne.coord.y,ne.height),Ln(F,ne.coord.x,ne.coord.y,d[K].isTunnel?-.1:0),Ln(G,ie.coord.x,ie.coord.y,d[K].isTunnel?-.1:0),se)}for(let K=_.min;K<_.max;K++){const ie=d[K];ie.isTunnel&&([ie.a,ie.b]=[ie.b,ie.a]);const ne=s[ie.a],se=s[ie.b],Se=E(Ln(H,-(se.y-ne.y),se.x-ne.x,0));w=this.addFeatureSection(ie.featureInfo.featureIndex,w,this.tunnelFeatureSections,i),i.addQuad(Ln(M,se.x,se.y,0),Ln(z,ne.x,ne.y,0),Ln(F,ne.x,ne.y,u[ie.a]+4),Ln(G,se.x,se.y,u[ie.b]+4),Se),i.addQuad(Ln(M,ne.x,ne.y,0),Ln(z,se.x,se.y,0),Ln(F,se.x,se.y,u[ie.b]+4),Ln(G,ne.x,ne.y,u[ie.a]+4),Se)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,s,u,d){i.coord.x=s,i.coord.y=u,i.height=d}prepareEdgePoints(i,s,u,d,g){let _=s[d.a].x,w=s[d.a].y,T=s[d.b].x,E=s[d.b].y,C=u[d.a],R=u[d.b];const M=g(C,0),z=g(R,0);if(M&&z)return this.setElevatedPoint(i[0],_,w,C),this.setElevatedPoint(i[1],T,E,R),!0;if(!M&&!z)return!1;if(M){if(!z){const F=R/(R-C);T=gn(T,_,F),E=gn(E,w,F),R=gn(R,C,F)}}else{const F=C/(C-R);_=gn(_,T,F),w=gn(w,E,F),C=gn(C,R,F)}return this.setElevatedPoint(i[0],_,w,C),this.setElevatedPoint(i[1],T,E,R),!0}prepareEdges(i,s){if(s.length===0)return;s.sort((w,T)=>w.hash===T.hash?T.polygonIdx-w.polygonIdx:T.hash>w.hash?1:-1);let u=0,d=0,g=0,_=s[u].polygonIdx;do d++,(d===s.length||s[u].hash!==s[d].hash)&&((d-u==1||s[d-1].polygonIdx!==_)&&(g<u&&(s[g]=s[u],s[u]=null),s[g].type="none",g++),u=d,u!==s.length&&(_=s[u].polygonIdx));while(u!==s.length);if(s.splice(g),s.length!==0&&i.length!==0){s.sort((E,C)=>E.portalHash<C.portalHash?1:-1);let w=0,T=0;for(;w!==s.length&&T!==i.length;){const E=s[w],C=i[T];E.portalHash>C.hash?w++:C.hash>E.portalHash?T++:(E.type=C.type,w++)}}}isOnBorder(i,s){return i<=0&&s<=0||i>=Bt&&s>=Bt}addFeatureSection(i,s,u,d){return i!==s&&(s=i,u.push({featureIndex:i,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),s}sortSubarray(i,s,u,d){const g=i.slice(s,u);g.sort(d),i.splice(s,g.length,...g)}static computeEdgeHash(i,s){return(i.y===s.y&&i.x>s.x||i.y>s.y)&&([i,s]=[s,i]),BigInt(Fa.computePosHash(i))<<32n|BigInt(Fa.computePosHash(s))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var Pk,Rk={exports:{}},kk=(Pk||(Pk=1,function(l,i){(function(s){function u(ce,ue){return ce>ue?1:ce<ue?-1:0}var d=function(ce,ue){ce===void 0&&(ce=u),ue===void 0&&(ue=!1),this._compare=ce,this._root=null,this._size=0,this._noDuplicates=!!ue},g={size:{configurable:!0}};function _(ce,ue,it,Ft,Gt){var jt=Gt-Ft;if(jt>0){var Yt=Ft+Math.floor(jt/2),An={key:ue[Yt],data:it[Yt],parent:ce};return An.left=_(An,ue,it,Ft,Yt),An.right=_(An,ue,it,Yt+1,Gt),An}return null}function w(ce,ue,it,Ft,Gt){if(!(it>=Ft)){for(var jt=ce[it+Ft>>1],Yt=it-1,An=Ft+1;;){do Yt++;while(Gt(ce[Yt],jt)<0);do An--;while(Gt(ce[An],jt)>0);if(Yt>=An)break;var ri=ce[Yt];ce[Yt]=ce[An],ce[An]=ri,ri=ue[Yt],ue[Yt]=ue[An],ue[An]=ri}w(ce,ue,it,An,Gt),w(ce,ue,An+1,Ft,Gt)}}d.prototype.rotateLeft=function(ce){var ue=ce.right;ue&&(ce.right=ue.left,ue.left&&(ue.left.parent=ce),ue.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=ue:ce.parent.right=ue:this._root=ue,ue&&(ue.left=ce),ce.parent=ue},d.prototype.rotateRight=function(ce){var ue=ce.left;ue&&(ce.left=ue.right,ue.right&&(ue.right.parent=ce),ue.parent=ce.parent),ce.parent?ce===ce.parent.left?ce.parent.left=ue:ce.parent.right=ue:this._root=ue,ue&&(ue.right=ce),ce.parent=ue},d.prototype._splay=function(ce){for(;ce.parent;){var ue=ce.parent;ue.parent?ue.left===ce&&ue.parent.left===ue?(this.rotateRight(ue.parent),this.rotateRight(ue)):ue.right===ce&&ue.parent.right===ue?(this.rotateLeft(ue.parent),this.rotateLeft(ue)):ue.left===ce&&ue.parent.right===ue?(this.rotateRight(ue),this.rotateLeft(ue)):(this.rotateLeft(ue),this.rotateRight(ue)):ue.left===ce?this.rotateRight(ue):this.rotateLeft(ue)}},d.prototype.splay=function(ce){for(var ue,it,Ft,Gt,jt;ce.parent;)(it=(ue=ce.parent).parent)&&it.parent?((Ft=it.parent).left===it?Ft.left=ce:Ft.right=ce,ce.parent=Ft):(ce.parent=null,this._root=ce),Gt=ce.left,jt=ce.right,ce===ue.left?(it&&(it.left===ue?(ue.right?(it.left=ue.right,it.left.parent=it):it.left=null,ue.right=it,it.parent=ue):(Gt?(it.right=Gt,Gt.parent=it):it.right=null,ce.left=it,it.parent=ce)),jt?(ue.left=jt,jt.parent=ue):ue.left=null,ce.right=ue,ue.parent=ce):(it&&(it.right===ue?(ue.left?(it.right=ue.left,it.right.parent=it):it.right=null,ue.left=it,it.parent=ue):(jt?(it.left=jt,jt.parent=it):it.left=null,ce.right=it,it.parent=ce)),Gt?(ue.right=Gt,Gt.parent=ue):ue.right=null,ce.left=ue,ue.parent=ce)},d.prototype.replace=function(ce,ue){ce.parent?ce===ce.parent.left?ce.parent.left=ue:ce.parent.right=ue:this._root=ue,ue&&(ue.parent=ce.parent)},d.prototype.minNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.left;)ce=ce.left;return ce},d.prototype.maxNode=function(ce){if(ce===void 0&&(ce=this._root),ce)for(;ce.right;)ce=ce.right;return ce},d.prototype.insert=function(ce,ue){var it=this._root,Ft=null,Gt=this._compare;if(this._noDuplicates)for(;it;){if(Ft=it,Gt(it.key,ce)===0)return;it=Gt(it.key,ce)<0?it.right:it.left}else for(;it;)Ft=it,it=Gt(it.key,ce)<0?it.right:it.left;return it={key:ce,data:ue,left:null,right:null,parent:Ft},Ft?Gt(Ft.key,it.key)<0?Ft.right=it:Ft.left=it:this._root=it,this.splay(it),this._size++,it},d.prototype.find=function(ce){for(var ue=this._root,it=this._compare;ue;){var Ft=it(ue.key,ce);if(Ft<0)ue=ue.right;else{if(!(Ft>0))return ue;ue=ue.left}}return null},d.prototype.contains=function(ce){for(var ue=this._root,it=this._compare;ue;){var Ft=it(ce,ue.key);if(Ft===0)return!0;ue=Ft<0?ue.left:ue.right}return!1},d.prototype.remove=function(ce){var ue=this.find(ce);if(!ue)return!1;if(this.splay(ue),ue.left)if(ue.right){var it=this.minNode(ue.right);it.parent!==ue&&(this.replace(it,it.right),it.right=ue.right,it.right.parent=it),this.replace(ue,it),it.left=ue.left,it.left.parent=it}else this.replace(ue,ue.left);else this.replace(ue,ue.right);return this._size--,!0},d.prototype.removeNode=function(ce){if(!ce)return!1;if(this.splay(ce),ce.left)if(ce.right){var ue=this.minNode(ce.right);ue.parent!==ce&&(this.replace(ue,ue.right),ue.right=ce.right,ue.right.parent=ue),this.replace(ce,ue),ue.left=ce.left,ue.left.parent=ue}else this.replace(ce,ce.left);else this.replace(ce,ce.right);return this._size--,!0},d.prototype.erase=function(ce){var ue=this.find(ce);if(ue){this.splay(ue);var it=ue.left,Ft=ue.right,Gt=null;it&&(it.parent=null,Gt=this.maxNode(it),this.splay(Gt),this._root=Gt),Ft&&(it?Gt.right=Ft:this._root=Ft,Ft.parent=Gt),this._size--}},d.prototype.pop=function(){var ce=this._root,ue=null;if(ce){for(;ce.left;)ce=ce.left;ue={key:ce.key,data:ce.data},this.remove(ce.key)}return ue},d.prototype.next=function(ce){var ue=ce;if(ue)if(ue.right)for(ue=ue.right;ue&&ue.left;)ue=ue.left;else for(ue=ce.parent;ue&&ue.right===ce;)ce=ue,ue=ue.parent;return ue},d.prototype.prev=function(ce){var ue=ce;if(ue)if(ue.left)for(ue=ue.left;ue&&ue.right;)ue=ue.right;else for(ue=ce.parent;ue&&ue.left===ce;)ce=ue,ue=ue.parent;return ue},d.prototype.forEach=function(ce){for(var ue=this._root,it=[],Ft=!1,Gt=0;!Ft;)ue?(it.push(ue),ue=ue.left):it.length>0?(ce(ue=it.pop(),Gt++),ue=ue.right):Ft=!0;return this},d.prototype.range=function(ce,ue,it,Ft){for(var Gt=[],jt=this._compare,Yt=this._root;Gt.length!==0||Yt;)if(Yt)Gt.push(Yt),Yt=Yt.left;else{if(jt((Yt=Gt.pop()).key,ue)>0)break;if(jt(Yt.key,ce)>=0&&it.call(Ft,Yt))return this;Yt=Yt.right}return this},d.prototype.keys=function(){for(var ce=this._root,ue=[],it=[],Ft=!1;!Ft;)ce?(ue.push(ce),ce=ce.left):ue.length>0?(ce=ue.pop(),it.push(ce.key),ce=ce.right):Ft=!0;return it},d.prototype.values=function(){for(var ce=this._root,ue=[],it=[],Ft=!1;!Ft;)ce?(ue.push(ce),ce=ce.left):ue.length>0?(ce=ue.pop(),it.push(ce.data),ce=ce.right):Ft=!0;return it},d.prototype.at=function(ce){for(var ue=this._root,it=[],Ft=!1,Gt=0;!Ft;)if(ue)it.push(ue),ue=ue.left;else if(it.length>0){if(ue=it.pop(),Gt===ce)return ue;Gt++,ue=ue.right}else Ft=!0;return null},d.prototype.load=function(ce,ue,it){if(ce===void 0&&(ce=[]),ue===void 0&&(ue=[]),it===void 0&&(it=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ft=ce.length;return it&&w(ce,ue,0,Ft-1,this._compare),this._root=_(null,ce,ue,0,Ft),this._size=Ft,this},d.prototype.min=function(){var ce=this.minNode(this._root);return ce?ce.key:null},d.prototype.max=function(){var ce=this.maxNode(this._root);return ce?ce.key:null},d.prototype.isEmpty=function(){return this._root===null},g.size.get=function(){return this._size},d.createTree=function(ce,ue,it,Ft,Gt){return new d(it,Gt).load(ce,ue,Ft)},Object.defineProperties(d.prototype,g);var T=0,E=1,C=2,R=3,M=0,z=1,F=2,G=3;function H(ce,ue,it){ue===null?(ce.inOut=!1,ce.otherInOut=!0):(ce.isSubject===ue.isSubject?(ce.inOut=!ue.inOut,ce.otherInOut=ue.otherInOut):(ce.inOut=!ue.otherInOut,ce.otherInOut=ue.isVertical()?!ue.inOut:ue.inOut),ue&&(ce.prevInResult=!K(ue,it)||ue.isVertical()?ue.prevInResult:ue));var Ft=K(ce,it);ce.resultTransition=Ft?function(Gt,jt){var Yt,An=!Gt.inOut,ri=!Gt.otherInOut;switch(jt){case M:Yt=An&&ri;break;case z:Yt=An||ri;break;case G:Yt=An^ri;break;case F:Yt=Gt.isSubject?An&&!ri:ri&&!An}return Yt?1:-1}(ce,it):0}function K(ce,ue){switch(ce.type){case T:switch(ue){case M:return!ce.otherInOut;case z:return ce.otherInOut;case F:return ce.isSubject&&ce.otherInOut||!ce.isSubject&&!ce.otherInOut;case G:return!0}break;case C:return ue===M||ue===z;case R:return ue===F;case E:return!1}return!1}var ie=function(ce,ue,it,Ft,Gt){this.left=ue,this.point=ce,this.otherEvent=it,this.isSubject=Ft,this.type=Gt||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ne={inResult:{configurable:!0}};function se(ce,ue){return ce[0]===ue[0]&&ce[1]===ue[1]}ie.prototype.isBelow=function(ce){var ue=this.point,it=this.otherEvent.point;return this.left?(ue[0]-ce[0])*(it[1]-ce[1])-(it[0]-ce[0])*(ue[1]-ce[1])>0:(it[0]-ce[0])*(ue[1]-ce[1])-(ue[0]-ce[0])*(it[1]-ce[1])>0},ie.prototype.isAbove=function(ce){return!this.isBelow(ce)},ie.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ne.inResult.get=function(){return this.resultTransition!==0},ie.prototype.clone=function(){var ce=new ie(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ce.contourId=this.contourId,ce.resultTransition=this.resultTransition,ce.prevInResult=this.prevInResult,ce.isExteriorRing=this.isExteriorRing,ce.inOut=this.inOut,ce.otherInOut=this.otherInOut,ce},Object.defineProperties(ie.prototype,ne);var Se=11102230246251565e-32,we=134217729,Te=(3+8*Se)*Se;function Oe(ce,ue,it,Ft,Gt){var jt,Yt,An,ri,si=ue[0],Wn=Ft[0],Xi=0,Dr=0;Wn>si==Wn>-si?(jt=si,si=ue[++Xi]):(jt=Wn,Wn=Ft[++Dr]);var Gn=0;if(Xi<ce&&Dr<it)for(Wn>si==Wn>-si?(An=jt-((Yt=si+jt)-si),si=ue[++Xi]):(An=jt-((Yt=Wn+jt)-Wn),Wn=Ft[++Dr]),jt=Yt,An!==0&&(Gt[Gn++]=An);Xi<ce&&Dr<it;)Wn>si==Wn>-si?(An=jt-((Yt=jt+si)-(ri=Yt-jt))+(si-ri),si=ue[++Xi]):(An=jt-((Yt=jt+Wn)-(ri=Yt-jt))+(Wn-ri),Wn=Ft[++Dr]),jt=Yt,An!==0&&(Gt[Gn++]=An);for(;Xi<ce;)An=jt-((Yt=jt+si)-(ri=Yt-jt))+(si-ri),si=ue[++Xi],jt=Yt,An!==0&&(Gt[Gn++]=An);for(;Dr<it;)An=jt-((Yt=jt+Wn)-(ri=Yt-jt))+(Wn-ri),Wn=Ft[++Dr],jt=Yt,An!==0&&(Gt[Gn++]=An);return jt===0&&Gn!==0||(Gt[Gn++]=jt),Gn}function Ne(ce){return new Float64Array(ce)}var at=33306690738754716e-32,He=22204460492503146e-32,ht=11093356479670487e-47,Mt=Ne(4),gt=Ne(8),It=Ne(12),Rt=Ne(16),st=Ne(4);function St(ce,ue,it){var Ft=function(Gt,jt,Yt,An,ri,si){var Wn=(jt-si)*(Yt-ri),Xi=(Gt-ri)*(An-si),Dr=Wn-Xi;if(Wn===0||Xi===0||Wn>0!=Xi>0)return Dr;var Gn=Math.abs(Wn+Xi);return Math.abs(Dr)>=at*Gn?Dr:-function(gr,rr,Ni,Rr,dr,sr,lr){var Hi,Zn,Ki,kr,Sn,yi,fr,Br,_r,gs,Ji,hs,la,co,eo,ca,uu,_s,Fs=gr-dr,uo=Ni-dr,Vo=rr-sr,Eo=Rr-sr;Mt[0]=(eo=(Br=Fs-(fr=(yi=we*Fs)-(yi-Fs)))*(gs=Eo-(_r=(yi=we*Eo)-(yi-Eo)))-((co=Fs*Eo)-fr*_r-Br*_r-fr*gs))-((Ji=eo-(uu=(Br=Vo-(fr=(yi=we*Vo)-(yi-Vo)))*(gs=uo-(_r=(yi=we*uo)-(yi-uo)))-((ca=Vo*uo)-fr*_r-Br*_r-fr*gs)))+(Sn=eo-Ji))+(Sn-uu),Mt[1]=(la=co-((hs=co+Ji)-(Sn=hs-co))+(Ji-Sn))-((Ji=la-ca)+(Sn=la-Ji))+(Sn-ca),Mt[2]=hs-((_s=hs+Ji)-(Sn=_s-hs))+(Ji-Sn),Mt[3]=_s;var fd=function(Nhe,GL){for(var $L=GL[0],WI=1;WI<4;WI++)$L+=GL[WI];return $L}(0,Mt),ev=He*lr;if(fd>=ev||-fd>=ev||(Hi=gr-(Fs+(Sn=gr-Fs))+(Sn-dr),Ki=Ni-(uo+(Sn=Ni-uo))+(Sn-dr),Zn=rr-(Vo+(Sn=rr-Vo))+(Sn-sr),kr=Rr-(Eo+(Sn=Rr-Eo))+(Sn-sr),Hi===0&&Zn===0&&Ki===0&&kr===0)||(ev=ht*lr+Te*Math.abs(fd),(fd+=Fs*kr+Eo*Hi-(Vo*Ki+uo*Zn))>=ev||-fd>=ev))return fd;st[0]=(eo=(Br=Hi-(fr=(yi=we*Hi)-(yi-Hi)))*(gs=Eo-(_r=(yi=we*Eo)-(yi-Eo)))-((co=Hi*Eo)-fr*_r-Br*_r-fr*gs))-((Ji=eo-(uu=(Br=Zn-(fr=(yi=we*Zn)-(yi-Zn)))*(gs=uo-(_r=(yi=we*uo)-(yi-uo)))-((ca=Zn*uo)-fr*_r-Br*_r-fr*gs)))+(Sn=eo-Ji))+(Sn-uu),st[1]=(la=co-((hs=co+Ji)-(Sn=hs-co))+(Ji-Sn))-((Ji=la-ca)+(Sn=la-Ji))+(Sn-ca),st[2]=hs-((_s=hs+Ji)-(Sn=_s-hs))+(Ji-Sn),st[3]=_s;var N9=Oe(4,Mt,4,st,gt);st[0]=(eo=(Br=Fs-(fr=(yi=we*Fs)-(yi-Fs)))*(gs=kr-(_r=(yi=we*kr)-(yi-kr)))-((co=Fs*kr)-fr*_r-Br*_r-fr*gs))-((Ji=eo-(uu=(Br=Vo-(fr=(yi=we*Vo)-(yi-Vo)))*(gs=Ki-(_r=(yi=we*Ki)-(yi-Ki)))-((ca=Vo*Ki)-fr*_r-Br*_r-fr*gs)))+(Sn=eo-Ji))+(Sn-uu),st[1]=(la=co-((hs=co+Ji)-(Sn=hs-co))+(Ji-Sn))-((Ji=la-ca)+(Sn=la-Ji))+(Sn-ca),st[2]=hs-((_s=hs+Ji)-(Sn=_s-hs))+(Ji-Sn),st[3]=_s;var B9=Oe(N9,gt,4,st,It);st[0]=(eo=(Br=Hi-(fr=(yi=we*Hi)-(yi-Hi)))*(gs=kr-(_r=(yi=we*kr)-(yi-kr)))-((co=Hi*kr)-fr*_r-Br*_r-fr*gs))-((Ji=eo-(uu=(Br=Zn-(fr=(yi=we*Zn)-(yi-Zn)))*(gs=Ki-(_r=(yi=we*Ki)-(yi-Ki)))-((ca=Zn*Ki)-fr*_r-Br*_r-fr*gs)))+(Sn=eo-Ji))+(Sn-uu),st[1]=(la=co-((hs=co+Ji)-(Sn=hs-co))+(Ji-Sn))-((Ji=la-ca)+(Sn=la-Ji))+(Sn-ca),st[2]=hs-((_s=hs+Ji)-(Sn=_s-hs))+(Ji-Sn),st[3]=_s;var V9=Oe(B9,It,4,st,Rt);return Rt[V9-1]}(Gt,jt,Yt,An,ri,si,Gn)}(ce[0],ce[1],ue[0],ue[1],it[0],it[1]);return Ft>0?-1:Ft<0?1:0}function qe(ce,ue){var it=ce.point,Ft=ue.point;return it[0]>Ft[0]?1:it[0]<Ft[0]?-1:it[1]!==Ft[1]?it[1]>Ft[1]?1:-1:function(Gt,jt,Yt,An){return Gt.left!==jt.left?Gt.left?1:-1:St(Yt,Gt.otherEvent.point,jt.otherEvent.point)!==0?Gt.isBelow(jt.otherEvent.point)?-1:1:!Gt.isSubject&&jt.isSubject?1:-1}(ce,ue,it)}function ot(ce,ue,it){var Ft=new ie(ue,!1,ce,ce.isSubject),Gt=new ie(ue,!0,ce.otherEvent,ce.isSubject);return se(ce.point,ce.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ce),Ft.contourId=Gt.contourId=ce.contourId,qe(Gt,ce.otherEvent)>0&&(ce.otherEvent.left=!0,Gt.left=!1),ce.otherEvent.otherEvent=Gt,ce.otherEvent=Ft,it.push(Gt),it.push(Ft),it}function zt(ce,ue){return ce[0]*ue[1]-ce[1]*ue[0]}function At(ce,ue){return ce[0]*ue[0]+ce[1]*ue[1]}function ln(ce,ue,it){var Ft=function(ri,si,Wn,Xi,Dr){var Gn=[si[0]-ri[0],si[1]-ri[1]],gr=[Xi[0]-Wn[0],Xi[1]-Wn[1]];function rr(yi,fr,Br){return[yi[0]+fr*Br[0],yi[1]+fr*Br[1]]}var Ni=[Wn[0]-ri[0],Wn[1]-ri[1]],Rr=zt(Gn,gr),dr=Rr*Rr,sr=At(Gn,Gn);if(dr>0){var lr=zt(Ni,gr)/Rr;if(lr<0||lr>1)return null;var Hi=zt(Ni,Gn)/Rr;return Hi<0||Hi>1?null:lr===0||lr===1?[rr(ri,lr,Gn)]:Hi===0||Hi===1?[rr(Wn,Hi,gr)]:[rr(ri,lr,Gn)]}if((dr=(Rr=zt(Ni,Gn))*Rr)>0)return null;var Zn=At(Gn,Ni)/sr,Ki=Zn+At(Gn,gr)/sr,kr=Math.min(Zn,Ki),Sn=Math.max(Zn,Ki);return kr<=1&&Sn>=0?kr===1?[rr(ri,kr>0?kr:0,Gn)]:Sn===0?[rr(ri,Sn<1?Sn:1,Gn)]:[rr(ri,kr>0?kr:0,Gn),rr(ri,Sn<1?Sn:1,Gn)]:null}(ce.point,ce.otherEvent.point,ue.point,ue.otherEvent.point),Gt=Ft?Ft.length:0;if(Gt===0||Gt===1&&(se(ce.point,ue.point)||se(ce.otherEvent.point,ue.otherEvent.point))||Gt===2&&ce.isSubject===ue.isSubject)return 0;if(Gt===1)return se(ce.point,Ft[0])||se(ce.otherEvent.point,Ft[0])||ot(ce,Ft[0],it),se(ue.point,Ft[0])||se(ue.otherEvent.point,Ft[0])||ot(ue,Ft[0],it),1;var jt=[],Yt=!1,An=!1;return se(ce.point,ue.point)?Yt=!0:qe(ce,ue)===1?jt.push(ue,ce):jt.push(ce,ue),se(ce.otherEvent.point,ue.otherEvent.point)?An=!0:qe(ce.otherEvent,ue.otherEvent)===1?jt.push(ue.otherEvent,ce.otherEvent):jt.push(ce.otherEvent,ue.otherEvent),Yt&&An||Yt?(ue.type=E,ce.type=ue.inOut===ce.inOut?C:R,Yt&&!An&&ot(jt[1].otherEvent,jt[0].point,it),2):An?(ot(jt[0],jt[1].point,it),3):jt[0]!==jt[3].otherEvent?(ot(jt[0],jt[1].point,it),ot(jt[1],jt[2].point,it),3):(ot(jt[0],jt[1].point,it),ot(jt[3].otherEvent,jt[2].point,it),3)}function Kt(ce,ue){if(ce===ue)return 0;if(St(ce.point,ce.otherEvent.point,ue.point)!==0||St(ce.point,ce.otherEvent.point,ue.otherEvent.point)!==0)return se(ce.point,ue.point)?ce.isBelow(ue.otherEvent.point)?-1:1:ce.point[0]===ue.point[0]?ce.point[1]<ue.point[1]?-1:1:qe(ce,ue)===1?ue.isAbove(ce.point)?-1:1:ce.isBelow(ue.point)?-1:1;if(ce.isSubject!==ue.isSubject)return ce.isSubject?-1:1;var it=ce.point,Ft=ue.point;return it[0]===Ft[0]&&it[1]===Ft[1]?(it=ce.otherEvent.point)[0]===(Ft=ue.otherEvent.point)[0]&&it[1]===Ft[1]?0:ce.contourId>ue.contourId?1:-1:qe(ce,ue)===1?1:-1}var Tt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Ct(ce,ue,it,Ft){var Gt,jt=ce+1,Yt=ue[ce].point,An=ue.length;for(jt<An&&(Gt=ue[jt].point);jt<An&&Gt[0]===Yt[0]&&Gt[1]===Yt[1];){if(!it[jt])return jt;++jt<An&&(Gt=ue[jt].point)}for(jt=ce-1;it[jt]&&jt>Ft;)jt--;return jt}Tt.prototype.isExterior=function(){return this.holeOf==null};var Jt=Vt,Wt=Vt;function Vt(ce,ue){if(!(this instanceof Vt))return new Vt(ce,ue);if(this.data=ce||[],this.length=this.data.length,this.compare=ue||Zt,this.length>0)for(var it=(this.length>>1)-1;it>=0;it--)this._down(it)}function Zt(ce,ue){return ce<ue?-1:ce>ue?1:0}Vt.prototype={push:function(ce){this.data.push(ce),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ce=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ce}},peek:function(){return this.data[0]},_up:function(ce){for(var ue=this.data,it=this.compare,Ft=ue[ce];ce>0;){var Gt=ce-1>>1,jt=ue[Gt];if(it(Ft,jt)>=0)break;ue[ce]=jt,ce=Gt}ue[ce]=Ft},_down:function(ce){for(var ue=this.data,it=this.compare,Ft=this.length>>1,Gt=ue[ce];ce<Ft;){var jt=1+(ce<<1),Yt=jt+1,An=ue[jt];if(Yt<this.length&&it(ue[Yt],An)<0&&(jt=Yt,An=ue[Yt]),it(An,Gt)>=0)break;ue[ce]=An,ce=jt}ue[ce]=Gt}},Jt.default=Wt;var Tn=Math.max,kn=Math.min,Un=0;function On(ce,ue,it,Ft,Gt,jt){var Yt,An,ri,si,Wn,Xi;for(Yt=0,An=ce.length-1;Yt<An;Yt++)if(si=ce[Yt+1],Wn=new ie(ri=ce[Yt],!1,void 0,ue),Xi=new ie(si,!1,Wn,ue),Wn.otherEvent=Xi,ri[0]!==si[0]||ri[1]!==si[1]){Wn.contourId=Xi.contourId=it,jt||(Wn.isExteriorRing=!1,Xi.isExteriorRing=!1),qe(Wn,Xi)>0?Xi.left=!0:Wn.left=!0;var Dr=ri[0],Gn=ri[1];Gt[0]=kn(Gt[0],Dr),Gt[1]=kn(Gt[1],Gn),Gt[2]=Tn(Gt[2],Dr),Gt[3]=Tn(Gt[3],Gn),Ft.push(Wn),Ft.push(Xi)}}var li=[];function Yn(ce,ue,it){typeof ce[0][0][0]=="number"&&(ce=[ce]),typeof ue[0][0][0]=="number"&&(ue=[ue]);var Ft=function(Gn,gr,rr){var Ni=null;return Gn.length*gr.length==0&&(rr===M?Ni=li:rr===F?Ni=Gn:rr!==z&&rr!==G||(Ni=Gn.length===0?gr:Gn)),Ni}(ce,ue,it);if(Ft)return Ft===li?null:Ft;var Gt=[1/0,1/0,-1/0,-1/0],jt=[1/0,1/0,-1/0,-1/0],Yt=function(Gn,gr,rr,Ni,Rr){var dr,sr,lr,Hi,Zn,Ki,kr=new Jt(null,qe);for(lr=0,Hi=Gn.length;lr<Hi;lr++)for(Zn=0,Ki=(dr=Gn[lr]).length;Zn<Ki;Zn++)(sr=Zn===0)&&Un++,On(dr[Zn],!0,Un,kr,rr,sr);for(lr=0,Hi=gr.length;lr<Hi;lr++)for(Zn=0,Ki=(dr=gr[lr]).length;Zn<Ki;Zn++)sr=Zn===0,Rr===F&&(sr=!1),sr&&Un++,On(dr[Zn],!1,Un,kr,Ni,sr);return kr}(ce,ue,Gt,jt,it);if(Ft=function(Gn,gr,rr,Ni,Rr){var dr=null;return(rr[0]>Ni[2]||Ni[0]>rr[2]||rr[1]>Ni[3]||Ni[1]>rr[3])&&(Rr===M?dr=li:Rr===F?dr=Gn:Rr!==z&&Rr!==G||(dr=Gn.concat(gr))),dr}(ce,ue,Gt,jt,it))return Ft===li?null:Ft;for(var An=function(Gn){var gr,rr,Ni=function(lr){var Hi,Zn,Ki,kr,Sn=[];for(Zn=0,Ki=lr.length;Zn<Ki;Zn++)((Hi=lr[Zn]).left&&Hi.inResult||!Hi.left&&Hi.otherEvent.inResult)&&Sn.push(Hi);for(var yi=!1;!yi;)for(yi=!0,Zn=0,Ki=Sn.length;Zn<Ki;Zn++)Zn+1<Ki&&qe(Sn[Zn],Sn[Zn+1])===1&&(kr=Sn[Zn],Sn[Zn]=Sn[Zn+1],Sn[Zn+1]=kr,yi=!1);for(Zn=0,Ki=Sn.length;Zn<Ki;Zn++)(Hi=Sn[Zn]).otherPos=Zn;for(Zn=0,Ki=Sn.length;Zn<Ki;Zn++)(Hi=Sn[Zn]).left||(kr=Hi.otherPos,Hi.otherPos=Hi.otherEvent.otherPos,Hi.otherEvent.otherPos=kr);return Sn}(Gn),Rr={},dr=[],sr=function(){if(!Rr[gr]){var lr=dr.length,Hi=function(Sn,yi,fr){var Br=new Tt;if(Sn.prevInResult!=null){var _r=Sn.prevInResult,gs=_r.outputContourId;if(_r.resultTransition>0){var Ji=yi[gs];if(Ji.holeOf!=null){var hs=Ji.holeOf;yi[hs].holeIds.push(fr),Br.holeOf=hs,Br.depth=yi[gs].depth}else yi[gs].holeIds.push(fr),Br.holeOf=gs,Br.depth=yi[gs].depth+1}else Br.holeOf=null,Br.depth=yi[gs].depth}else Br.holeOf=null,Br.depth=0;return Br}(Ni[gr],dr,lr),Zn=function(Sn){Rr[Sn]=!0,Sn<Ni.length&&Ni[Sn]&&(Ni[Sn].outputContourId=lr)},Ki=gr,kr=gr;for(Hi.points.push(Ni[gr].point);Zn(Ki),Zn(Ki=Ni[Ki].otherPos),Hi.points.push(Ni[Ki].point),!((Ki=Ct(Ki,Ni,Rr,kr))==kr||Ki>=Ni.length)&&Ni[Ki];);dr.push(Hi)}};for(gr=0,rr=Ni.length;gr<rr;gr++)sr();return dr}(function(Gn,gr,rr,Ni,Rr,dr){for(var sr,lr,Hi,Zn=new d(Kt),Ki=[],kr=Math.min(Ni[2],Rr[2]);Gn.length!==0;){var Sn=Gn.pop();if(Ki.push(Sn),dr===M&&Sn.point[0]>kr||dr===F&&Sn.point[0]>Ni[2])break;if(Sn.left){lr=sr=Zn.insert(Sn),sr=sr!==(Hi=Zn.minNode())?Zn.prev(sr):null,lr=Zn.next(lr);var yi=sr?sr.key:null;if(H(Sn,yi,dr),lr&&ln(Sn,lr.key,Gn)===2&&(H(Sn,yi,dr),H(lr.key,Sn,dr)),sr&&ln(sr.key,Sn,Gn)===2){var fr=sr;H(yi,(fr=fr!==Hi?Zn.prev(fr):null)?fr.key:null,dr),H(Sn,yi,dr)}}else lr=sr=Zn.find(Sn=Sn.otherEvent),sr&&lr&&(sr=sr!==Hi?Zn.prev(sr):null,lr=Zn.next(lr),Zn.remove(Sn),lr&&sr&&ln(sr.key,lr.key,Gn))}return Ki}(Yt,0,0,Gt,jt,it)),ri=[],si=0;si<An.length;si++){var Wn=An[si];if(Wn.isExterior()){for(var Xi=[Wn.points],Dr=0;Dr<Wn.holeIds.length;Dr++)Xi.push(An[Wn.holeIds[Dr]].points);ri.push(Xi)}}return ri}var hr={UNION:z,DIFFERENCE:F,INTERSECTION:M,XOR:G};s.diff=function(ce,ue){return Yn(ce,ue,F)},s.intersection=function(ce,ue){return Yn(ce,ue,M)},s.operations=hr,s.union=function(ce,ue){return Yn(ce,ue,z)},s.xor=function(ce,ue){return Yn(ce,ue,G)},Object.defineProperty(s,"__esModule",{value:!0})})(i)}(0,Rk.exports)),Rk.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function lw(l,i,s,u){const d=[],g=u===0?(_,w,T,E,C,R)=>{_.push(new bt(R,T+(R-w)/(E-w)*(C-T)))}:(_,w,T,E,C,R)=>{_.push(new bt(w+(R-T)/(C-T)*(E-w),R))};for(const _ of l){const w=[];for(const T of _){if(T.length<=2)continue;const E=[];for(let M=0;M<T.length-1;M++){const z=T[M].x,F=T[M].y,G=T[M+1].x,H=T[M+1].y,K=u===0?z:F,ie=u===0?G:H;K<i?ie>i&&g(E,z,F,G,H,i):K>s?ie<s&&g(E,z,F,G,H,s):E.push(T[M]),ie<i&&K>=i&&g(E,z,F,G,H,i),ie>s&&K<=s&&g(E,z,F,G,H,s)}let C=T[T.length-1];const R=u===0?C.x:C.y;R>=i&&R<=s&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),w.push(E))}w.length&&d.push(w)}return d}function B8(l,i){const s=GE(l),u=GE([i]),d=kk.intersection(s,u);return d==null?[]:Mk(d)}function V8(l,i){let u=GE(l,65536);for(;i.valid();i.next()){const[d,g]=i.get(),_=d.x*65536,w=d.y*65536,T=g.x*65536,E=g.y*65536,C=T-_,R=E-w,M=Math.hypot(C,R),z=Math.trunc(R/M*3),F=-Math.trunc(C/M*3);u=kk.diff(u,[[[_,w],[T,E],[T+z,E+F],[_+z,w+F],[_,w]]])}return Mk(u,1/65536)}function GE(l,i=1){return[l.map(s=>s.map(u=>[u.x*i,u.y*i]))]}function Mk(l,i=1){return l.map(s=>s.map((u,d)=>{const g=u.map(_=>new bt(_[0]*i,_[1]*i).round());return d>0&&g.reverse(),g}))}class $E{constructor(i,s){this.layoutVertexArray=new Ko,this.indexArray=new yr,this.lineIndexArray=new Hl,this.triangleSegments=new Cr,this.lineSegments=new Cr,this.programConfigurations=new Ma(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,s&&(this.elevatedLayoutVertexArray=new $u)}update(i,s,u,d,g,_,w,T){this.programConfigurations.updatePaintArrays(i,s,g,u,d,_,w,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,E8.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,I8.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,s,u,d,g,_,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,s,u,d,g,_,void 0,w)}}class HE{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new $E(i,!1),this.elevationBufferData=new $E(i,!0),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,u,d){this.hasPattern=UE("fill",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:w,id:T,index:E,sourceLayerIndex:C}of i){const R=this.layers[0]._featureFilter.needGeometry,M=rt(w,R);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom,{worldview:this.worldview}),M,u))continue;const z=g?g.evaluate(M,{},u,s.availableImages):void 0,F={id:T,properties:w.properties,type:w.type,sourceLayerIndex:C,index:E,geometry:R?M.geometry:Ce(w,u,d),patterns:{},sortKey:z};_.push(F)}g&&_.sort((w,T)=>w.sortKey-T.sortKey);for(const w of _){const{geometry:T,index:E,sourceLayerIndex:C}=w;if(this.hasPattern){const R=jE("fill",this.layers,w,this.zoom,this.pixelRatio,s);this.patternFeatures.push(R)}else this.addFeature(w,T,E,u,{},s.availableImages,s.brightness,s.elevationFeatures);s.featureIndex.insert(i[E].feature,T,E,C,this.index)}}update(i,s,u,d,g,_,w){this.bufferData.update(i,s,u,d,g,_,w,this.worldview),this.elevationBufferData.update(i,s,u,d,g,_,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,s,u,d,g,_,w,this.worldview)}addFeatures(i,s,u,d,g,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,s,u,d,_,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,s,u,d,g,_=[],w,T){const E=Ty(s,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,E,d,u,T):this.addGeometry(E,this.bufferData),this.bufferData.populatePaintArrays(i,u,g,_,d,w,this.worldview),this.elevationBufferData.populatePaintArrays(i,u,g,_,d,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,s,u,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(s,u,d,g,this.worldview))}addElevatedRoadFeature(i,s,u,d,g){const _=new Array,w=Pr.getElevationFeature(i,g);if(!w)return void this.addGeometry(s,this.bufferData);{const E=this.clipPolygonsToTile(s,1);E.length>0&&_.push({polygons:E,elevationFeature:w,elevationTileID:u})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},u),featureIndex:d};for(const E of _)if(E.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Fa(E.elevationTileID,this.layers,this.zoom,this.lut));const R=E.elevationFeature.isTunnel();let M=0;i.properties.hasOwnProperty(hn)&&(M=+i.properties[hn]);for(const z of E.polygons)this.elevatedStructures.addPortalCandidates(E.elevationFeature.id,z,R,E.elevationFeature,M)}E.elevationFeature.constantHeight==null&&(E.polygons=this.prepareElevatedPolygons(E.polygons,E.elevationFeature,E.elevationTileID));const C=new xi(u,E.elevationTileID);this.addElevatedGeometry(E.polygons,C,E.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,T)}}addElevatedGeometry(i,s,u,d,g,_){const w={elevation:u,elevationSampler:s,bias:d,index:g,featureInfo:_},[T,E]=this.addGeometry(i,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:E}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,E))}addGeometry(i,s,u){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,_=null;u&&(_=u.elevationSampler.constantElevation(u.elevation,u.bias),_!=null&&(d=_,g=_));const w=(T,E,C)=>{if(u!=null)if(E.push(T),_!=null)s.elevatedLayoutVertexArray.emplaceBack(_),C.push(_);else{const R=u.elevationSampler.pointElevation(T,u.elevation,u.bias);s.elevatedLayoutVertexArray.emplaceBack(R),C.push(R),d=Math.min(d,R),g=Math.max(g,R)}};for(const T of i){let E=0;for(const ne of T)E+=ne.length;const C=s.triangleSegments.prepareSegment(E,s.layoutVertexArray,s.indexArray),R=C.vertexLength,M=[],z=[],F=[],G=[],H=[],K=s.layoutVertexArray.length;for(const ne of T){if(ne.length===0)continue;ne!==T[0]&&z.push(M.length/2);const se=s.lineSegments.prepareSegment(ne.length,s.layoutVertexArray,s.lineIndexArray),Se=se.vertexLength;u&&H.push(s.layoutVertexArray.length-K),w(ne[0],F,G),s.layoutVertexArray.emplaceBack(ne[0].x,ne[0].y),s.lineIndexArray.emplaceBack(Se+ne.length-1,Se),M.push(ne[0].x),M.push(ne[0].y);for(let we=1;we<ne.length;we++)w(ne[we],F,G),s.layoutVertexArray.emplaceBack(ne[we].x,ne[we].y),s.lineIndexArray.emplaceBack(Se+we-1,Se+we),M.push(ne[we].x),M.push(ne[we].y);se.vertexLength+=ne.length,se.primitiveLength+=ne.length}const ie=Im(M,z);for(let ne=0;ne<ie.length;ne+=3)s.indexArray.emplaceBack(R+ie[ne],R+ie[ne+1],R+ie[ne+2]);if(ie.length>0&&u&&this.elevationMode==="hd-road-base"){const ne=u.elevation.isTunnel(),se=u.elevation.safeArea,Se=this.elevatedStructures.addVertices(F,G);this.elevatedStructures.addTriangles(ie,Se,ne);const we=H.length;if(we>0){for(let Te=0;Te<we-1;Te++)this.elevatedStructures.addRenderableRing(u.index,H[Te]+Se,H[Te+1]-H[Te],ne,se,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,H[we-1]+Se,F.length-H[we-1],ne,se,u.featureInfo)}}C.vertexLength+=E,C.primitiveLength+=ie.length/3}return[d,g]}prepareElevatedPolygons(i,s,u){const d=1/_e(u),g=[];for(const _ of i){const w=V8(_,new $i(s,d));g.push(...w)}return g}clipPolygonsToTile(i,s){const u=-s,d=-s,g=Bt+s,_=Bt+s;let w=0;const T=[],E=[];for(;w<i.length;w++){const M=i[w],z=h_(M);(z.min.x>=u&&z.max.x<=g&&z.min.y>=d&&z.max.y<=_?T:E).push(M)}if(T.length===i.length)return i;const C=[new bt(u,d),new bt(g,d),new bt(g,_),new bt(u,_),new bt(u,d)],R=T;for(const M of E)R.push(...B8(M,C));return R}}let Dk,Lk,Ok,zk;Xt(HE,"FillBucket",{omit:["layers","patternFeatures"]}),Xt($E,"FillBufferData"),Xt(Fa,"ElevatedStructures");class cw{constructor(i,s,u,d){if(this.triangleCount=s.length/3,this.min=new bt(0,0),this.max=new bt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[g,_]=[i[0].clone(),i[0].clone()];for(let R=1;R<i.length;++R){const M=i[R];g.x=Math.min(g.x,M.x),g.y=Math.min(g.y,M.y),_.x=Math.max(_.x,M.x),_.y=Math.max(_.y,M.y)}if(d){const R=Math.ceil(Math.max(_.x-g.x,_.y-g.y)/d);u=Math.max(u,R)}if(u===0)return;this.min=g,this.max=_;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const T=Math.max(w.x,w.y)/u;this.cellsX=Math.max(1,Math.ceil(w.x/T)),this.cellsY=Math.max(1,Math.ceil(w.y/T)),this.xScale=1/T,this.yScale=1/T;const E=[];for(let R=0;R<this.triangleCount;R++){const M=i[s[3*R+0]].sub(this.min),z=i[s[3*R+1]].sub(this.min),F=i[s[3*R+2]].sub(this.min),G=lu(Math.floor(Math.min(M.x,z.x,F.x)),this.xScale,this.cellsX),H=lu(Math.floor(Math.max(M.x,z.x,F.x)),this.xScale,this.cellsX),K=lu(Math.floor(Math.min(M.y,z.y,F.y)),this.yScale,this.cellsY),ie=lu(Math.floor(Math.max(M.y,z.y,F.y)),this.yScale,this.cellsY),ne=new bt(0,0),se=new bt(0,0),Se=new bt(0,0),we=new bt(0,0);for(let Te=K;Te<=ie;++Te){ne.y=se.y=Te*T,Se.y=we.y=(Te+1)*T;for(let Oe=G;Oe<=H;++Oe)ne.x=Se.x=Oe*T,se.x=we.x=(Oe+1)*T,(ps(M,z,F,ne,se,we)||ps(M,z,F,ne,we,Se))&&E.push({cellIdx:Te*this.cellsX+Oe,triIdx:R})}}if(E.length===0)return;E.sort((R,M)=>R.cellIdx-M.cellIdx||R.triIdx-M.triIdx);let C=0;for(;C<E.length;){const R=E[C].cellIdx,M={start:this.payload.length,len:0};for(;C<E.length&&E[C].cellIdx===R;)++M.len,this.payload.push(E[C++].triIdx);this.cells[R]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,s){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const u=lu(i.x-this.min.x,this.xScale,this.cellsX),d=lu(i.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+u];if(g){this._lazyInitLookup();for(let _=0;_<g.len;_++){const w=this.payload[g.start+_],T=Math.floor(w/8),E=1<<w%8;if(!(this.lookup[T]&E)&&(this.lookup[T]|=E,s.push(w),s.length===this.triangleCount))return}}}query(i,s,u){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>s.x||i.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const d=lu(i.x-this.min.x,this.xScale,this.cellsX),g=lu(s.x-this.min.x,this.xScale,this.cellsX),_=lu(i.y-this.min.y,this.yScale,this.cellsY),w=lu(s.y-this.min.y,this.yScale,this.cellsY);for(let T=_;T<=w;T++)for(let E=d;E<=g;E++){const C=this.cells[T*this.cellsX+E];if(C)for(let R=0;R<C.len;R++){const M=this.payload[C.start+R],z=Math.floor(M/8),F=1<<M%8;if(!(this.lookup[z]&F)&&(this.lookup[z]|=F,u.push(M),u.length===this.triangleCount))return}}}}function lu(l,i,s){return Math.max(0,Math.min(s-1,Math.floor(l*i)))}Xt(cw,"TriangleGridIndex");class Fk{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[],this.worldview=i.worldview}updateFootprints(i,s){for(const u of this.footprints)s.push({footprint:u,id:i})}populate(i,s,u,d){const g=[];for(const{feature:_,id:w,index:T,sourceLayerIndex:E}of i){const C=this.layers[0]._featureFilter.needGeometry,R=rt(_,C);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom,{worldview:this.worldview}),R,u))continue;const M={id:w,properties:_.properties,type:_.type,sourceLayerIndex:E,index:T,geometry:C?R.geometry:Ce(_,u,d),patterns:{}};g.push(M)}for(const _ of g){const{geometry:w,index:T,sourceLayerIndex:E}=_;this.addFeature(_,w,T,u,{},s.availableImages,s.brightness),s.featureIndex.insert(i[T].feature,w,T,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,s,u,d,g,_,w){}destroy(){}addFeature(i,s,u,d,g,_=[],w){for(const T of Ty(s,2)){const E=[],C=[],R=[],M=new bt(1/0,1/0),z=new bt(-1/0,-1/0);for(const H of T)if(H.length!==0){H!==T[0]&&R.push(C.length/2);for(let K=0;K<H.length;K++)C.push(H[K].x),C.push(H[K].y),E.push(H[K]),M.x=Math.min(M.x,H[K].x),M.y=Math.min(M.y,H[K].y),z.x=Math.max(z.x,H[K].x),z.y=Math.max(z.y,H[K].y)}const F=Im(C,R),G=new cw(E,F,8,256);this.footprints.push({vertices:E,indices:F,grid:G,min:M,max:z})}}}Xt(Fk,"ClipBucket",{omit:["layers"]});const U8=di([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),j8=di([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),G8=di([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$8=di([{name:"a_join_normal_inside",components:3,type:"Int16"}]),H8=di([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),q8=di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:W8}=U8,Ey=Number.MAX_SAFE_INTEGER,Nk=Ey-1;function Bk(l,i,s,u){return l.order<i||l.order===Ey||!(l.clipMask&s)||function(d,g){return g.length!==0&&g.find(_=>_===d)===void 0}(u,l.clipScope)}function uw(l,i){return l.x-i.x||l.y-i.y}function Vk(l,i){return uw(l.min,i.min)===0&&uw(l.max,i.max)===0}function qE(l,i){return!(l.min.x>i.max.x||l.max.x<i.min.x||l.min.y>i.max.y||l.max.y<i.min.y)}function hw(l,i){if(l.length!==i.length)return!1;for(let s=0;s<l.length;s++)if(l[s].sourceId!==i[s].sourceId||!Vk(l[s],i[s])||l[s].order!==i[s].order||l[s].clipMask!==i[s].clipMask||!Lo(l[s].clipScope,i[s].clipScope))return!1;return!0}function Uk(l,i,s){const u=1/Bt,d=1/(1<<s.canonical.z),g=(i.x*u+s.canonical.x)*d+s.wrap,_=(i.y*u+s.canonical.y)*d;return{min:new bt((l.x*u+s.canonical.x)*d+s.wrap,(l.y*u+s.canonical.y)*d),max:new bt(g,_)}}function Z8(l,i,s){const u=1<<s.canonical.z,d=((i.x-s.wrap)*u-s.canonical.x)*Bt,g=(i.y*u-s.canonical.y)*Bt;return{min:new bt(((l.x-s.wrap)*u-s.canonical.x)*Bt,(l.y*u-s.canonical.y)*Bt),max:new bt(d,g)}}function WE(l,i,s,u,d,g,_){const w=l.indices,T=l.vertices,E=[];for(let C=u;C<u+d;C+=3){const R=i[s[C+0]+g],M=i[s[C+1]+g],z=i[s[C+2]+g],F=Math.min(R.x,M.x,z.x),G=Math.max(R.x,M.x,z.x),H=Math.min(R.y,M.y,z.y),K=Math.max(R.y,M.y,z.y);E.length=0,l.grid.query(new bt(F,H),new bt(G,K),E);for(let ie=0;ie<E.length;ie++){const ne=E[ie];if(ps(T[w[3*ne+0]],T[w[3*ne+1]],T[w[3*ne+2]],R,M,z,_))return!0}}return!1}function jk(l,i,s,u){if(!l||!s)return!1;let d=l.vertices;if(!i.canonical.equals(u.canonical)||i.wrap!==u.wrap){if(s.vertices.length<l.vertices.length)return jk(s,u,l,i);const g=i.canonical,_=u.canonical,w=Math.pow(2,_.z-g.z);d=l.vertices.map(T=>new bt((T.x+g.x*Bt)*w-_.x*Bt,(T.y+g.y*Bt)*w-_.y*Bt))}return WE(s,d,l.indices,0,l.indices.length,0,0)}function Gk(l,i,s,u){const d=Math.pow(2,u.z-s.z);return new bt((l+s.x*Bt)*d-u.x*Bt,(i+s.y*Bt)*d-u.y*Bt)}function ZE(l,i){const s=[];i.grid.queryPoint(l,s);const u=i.indices,d=i.vertices;for(let g=0;g<s.length;g++){const _=s[g];if(ao([d[u[3*_+0]],d[u[3*_+1]],d[u[3*_+2]]],l))return!0}return!1}const XE=[new bt(0,0),new bt(Bt,0),new bt(Bt,Bt),new bt(0,Bt)];function $k(l,i){const s=[];let u=[];if(!i||l.length<2)return[l];if(l.length===2)return Nr(l[0],l[1],XE)?[l]:[];for(let d=0;d<l.length+2;d++){const g=l[d%l.length],_=l[(d+1)%l.length],w=Nr(d===0?l[l.length-1]:l[(d-1)%l.length],g,XE),T=Nr(g,_,XE),E=w||T;E&&u.push(g),E&&T||u.length>0&&(u.length>1&&s.push(u),u=[])}return u.length>1&&s.push(u),s}const KE=Ke.types,X8=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],K8=["fill-extrusion-flood-light-ground-radius"],Y8=Math.pow(2,13),Q8=Math.pow(2,15)-1,Hk=new bt(0,1),ad=2147483648;function Iy(l,i,s,u,d,g,_,w){l.emplaceBack((i<<1)+_,(s<<1)+g,(Math.floor(u*Y8)<<1)+d,Math.round(w))}function Sy(l,i,s){l.emplaceBack(i.x*Bt,i.y*Bt,s?1:0)}function dw(l,i,s,u,d,g){l.emplaceBack(i.x,i.y,(s.x<<1)+u,(s.y<<1)+d,g)}function Ay(l,i,s){l.emplaceBack(i.x,i.y,i.z,s[0]*16384,s[1]*16384,s[2]*16384)}class qk{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Wk{constructor(){this.centroidXY=new bt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new bt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new bt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new bt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Zk{constructor(){this.acc=new bt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,s){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=s.x,i.min.y=i.max.y=s.y)}appendEdge(i,s,u){this.accCount++,this.acc._add(s);let d=!!this.borders;s.x<i.min.x?(i.min.x=s.x,d=!0):s.x>i.max.x&&(i.max.x=s.x,d=!0),s.y<i.min.y?(i.min.y=s.y,d=!0):s.y>i.max.y&&(i.max.y=s.y,d=!0),((s.x===0||s.x===Bt)&&s.x===u.x)!=((s.y===0||s.y===Bt)&&s.y===u.y)&&this.processBorderOverlap(s,u),d&&this.checkBorderIntersection(s,u)}checkBorderIntersection(i,s){s.x<0!=i.x<0&&this.addBorderIntersection(0,gn(s.y,i.y,(0-s.x)/(i.x-s.x))),s.x>Bt!=i.x>Bt&&this.addBorderIntersection(1,gn(s.y,i.y,(Bt-s.x)/(i.x-s.x))),s.y<0!=i.y<0&&this.addBorderIntersection(2,gn(s.x,i.x,(0-s.y)/(i.y-s.y))),s.y>Bt!=i.y>Bt&&this.addBorderIntersection(3,gn(s.x,i.x,(Bt-s.y)/(i.y-s.y)))}addBorderIntersection(i,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[i];s<u[0]&&(u[0]=s),s>u[1]&&(u[1]=s)}processBorderOverlap(i,s){if(i.x===s.x){if(i.y===s.y)return;const u=i.x===0?0:1;this.addBorderIntersection(u,s.y),this.addBorderIntersection(u,i.y)}else{const u=i.y===0?2:3;this.addBorderIntersection(u,s.x),this.addBorderIntersection(u,i.x)}}centroid(){return this.accCount===0?new bt(0,0):new bt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,s)=>i+ +(s[0]!==Number.MAX_VALUE),0):0}}function Xk(l,i){const s=l.add(i)._unit(),u=he(l.x*s.x+l.y*s.y,-1,1);var d,g,_;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*Q8*((g=l).x*(_=i).y-g.y*_.x<0?-1:1)}const J8=[l=>l.x<0,l=>l.x>Bt,l=>l.y<0,l=>l.y>Bt];function eG(l,i,s,u){const d=[4];if(u===0)return d;s._mult(u);const g=l.sub(s),_=i.sub(s),w=[l,i,g,_];for(let T=0;T<4;T++)for(const E of w)if(J8[T](E)){d.push(T);break}return d}class YE{constructor(i){this.vertexArray=new pm,this.indexArray=new yr,this.programConfigurations=new Ma(i.layers,{zoom:i.zoom,lut:i.lut},s=>K8.includes(s)),this._segments=new Cr,this.hiddenByLandmarkVertexArray=new xm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Cr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,s,u,d=!1){const g=i.length;if(g>2){let _=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let T;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const E=i[0],C=i[1];T=Xk(E.sub(i[g-1])._perp()._unit(),C.sub(E)._perp()._unit())}for(let E=0;E<g;E++){const C=E===g-1?0:E+1,R=i[E],M=i[C],z=i[C===g-1?0:C+1],F=M.sub(R)._perp()._unit(),G=Xk(F,z.sub(M)._perp()._unit()),H=T,K=G;if(QE(R,M,s)||d&&Qk(R,s)&&Qk(M,s)){T=G;continue}const ie=w.vertexLength;dw(this.vertexArray,R,M,1,1,H),dw(this.vertexArray,R,M,1,0,H),dw(this.vertexArray,R,M,0,1,K),dw(this.vertexArray,R,M,0,0,K),w.vertexLength+=4;const ne=eG(R,M,F,u);for(const se of ne)this._segmentToGroundQuads[_].push({id:ie,region:se}),this._segmentToRegionTriCounts[_][se]+=2,w.primitiveLength+=2;T=G}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),s=i.length;for(let u=0;u<s;u++)this._segmentToGroundQuads[u].sort((d,g)=>d.region-g.region);for(let u=0;u<s;u++){const d=this._segmentToGroundQuads[u],g=i[u],_=this._segmentToRegionTriCounts[u];_.reduce((T,E)=>T+E,0);let w=0;for(let T=0;T<=4;T++){const E=_[T];if(E!==0){let C=this.regionSegments[T];C||(C=this.regionSegments[T]=new Cr);const R={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+w,vertexLength:g.vertexLength,primitiveLength:E};C.get().push(R)}w+=E}for(let T=0;T<d.length;T++){const E=d[T].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,s,u,d,g,_,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,s,u,d,g,_,void 0,w)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,j8.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,s,u,d,g,_,w,T){this.hasData()&&this.programConfigurations.updatePaintArrays(i,s,u,d,g,_,w,T)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&ad))}updateHiddenByLandmarkRange(i,s,u){if(!this.hasData())return;const d=s+i;if(s!==0){for(let g=i;g<d;++g)this.hiddenByLandmarkVertexArray.emplace(g,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,H8.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const s=this.regionSegments[i];s&&s.destroy()}}}}class fw{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new yr,this.footprintVertices=new Ko,this.footprintSegments=[],this.layoutVertexArray=new Zh,this.centroidVertexArray=new q0,this.wallVertexArray=new Z0,this.indexArray=new yr,this.programConfigurations=new Ma(i.layers,{zoom:i.zoom,lut:i.lut},s=>X8.includes(s)),this.segments=new Cr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new YE(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,u,d){this.features=[],this.hasPattern=UE("fill-extrusion",this.layers,this.pixelRatio,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=_e(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:_,index:w,sourceLayerIndex:T}of i){const E=this.layers[0]._featureFilter.needGeometry,C=rt(g,E);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom,{worldview:this.worldview}),C,u))continue;const R={id:_,sourceLayerIndex:T,index:w,geometry:E?C.geometry:Ce(g,u,d),properties:g.properties,type:g.type,patterns:{}},M=this.layoutVertexArray.length,z=KE[R.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:jE("fill-extrusion",this.layers,R,this.zoom,this.pixelRatio,s)});else if(this.wallMode)for(const F of R.geometry)for(const G of $k(F,z))this.addFeature(g.id,R,[G],w,u,{},s.availableImages,d,s.brightness);else this.addFeature(g.id,R,R.geometry,w,u,{},s.availableImages,d,s.brightness);s.featureIndex.insert(g,R.geometry,w,T,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,s,u,d,g,_){for(const{featureId:w,feature:T}of this.features){const E=KE[T.type]==="Polygon",{geometry:C}=T;if(this.wallMode)for(const R of C)for(const M of $k(R,E))this.addFeature(w,T,[M],T.index,s,u,d,g,_);else this.addFeature(w,T,C,T.index,s,u,d,g,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,s,u,d,g,_,w){this.programConfigurations.updatePaintArrays(i,s,g,u,d,_,w,this.worldview),this.groundEffect.update(i,s,g,u,d,_,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,W8),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,$8.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,q8.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,G8.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,u,d,g,_,w,T,E){const C=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(s,{})/this.tileToMeter,R=[new bt(0,0),new bt(Bt,Bt)],M=T.projection,z=M.name==="globe",F=this.wallMode||KE[s.type]==="Polygon",G=new Zk;G.centroidDataIndex=this.centroidData.length;const H=new Wk;H.buildingId=i,s.properties&&s.properties.hasOwnProperty("building_id")&&(H.buildingId=s.properties.building_id);const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(s,{},g)<=0,ie=this.layers[0].paint.get("fill-extrusion-height").evaluate(s,{},g);let ne;if(H.height=ie,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new gm),this.wallMode){if(z)return void ni("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;ne=function(He){const ht=He[0].x===He[He.length-1].x&&He[0].y===He[He.length-1].y;(function(Ct){let Jt=0;const Wt=Ct.length;for(let Vt=0;Vt<Wt;Vt++)Jt+=(Ct[(Vt+1)%Wt].x-Ct[Vt].x)*(Ct[(Vt+1)%Wt].y+Ct[Vt].y);return Jt>=0})(He)||(He=He.reverse());const gt={geometry:[],joinNormals:[],indices:[]},It=[],Rt=[],st=[];let St=He.length;for(;St>=2&&He[St-1].equals(He[St-2]);)St--;if(St<(ht?3:2))return gt;let qe,ot,zt,At,ln,Kt=0;for(;Kt<St-1&&He[Kt].equals(He[Kt+1]);)Kt++;ht&&(qe=He[St-2],ln=He[Kt].sub(qe)._unit()._perp());for(let Ct=Kt;Ct<St;Ct++){if(zt=Ct===St-1?ht?He[Kt+1]:void 0:He[Ct+1],zt&&He[Ct].equals(zt))continue;ln&&(At=ln),qe&&(ot=qe),qe=He[Ct],ln=zt?zt.sub(qe)._unit()._perp():At,At=At||ln;let Jt=At.add(ln);Jt.x===0&&Jt.y===0||Jt._unit();const Wt=Jt.x*ln.x+Jt.y*ln.y,Vt=Wt!==0?1/Wt:1/0,Zt=At.x*ln.y-At.y*ln.x>0;let Tn="miter";const kn=2;Tn==="miter"&&Vt>kn&&(Tn="bevel"),Tn==="bevel"&&(Vt>100&&(Tn="flipbevel"),Vt<kn&&(Tn="miter"));const Un=(On,li,Yn,hr)=>{const ce=new bt(On.x,On.y),ue=new bt(On.x,On.y);ce.x+=li.x*hr,ce.y+=li.y*hr,ue.x-=li.x*Math.max(Yn,1),ue.y-=li.y*Math.max(Yn,1),st.push(li),It.push(ce),Rt.push(ue)};if(Tn==="miter")Jt._mult(Vt),Un(qe,Jt,0,0);else if(Tn==="flipbevel")Jt=ln.mult(-1),Un(qe,Jt,0,0),Un(qe,Jt.mult(-1),0,0);else{const On=-Math.sqrt(Vt*Vt-1),li=Zt?On:0,Yn=Zt?0:On;ot&&Un(qe,At,li,Yn),zt&&Un(qe,ln,li,Yn)}}gt.geometry=[...It,...Rt.reverse(),It[0]],gt.joinNormals=[...st,...st.reverse(),st[st.length-1]];const Tt=gt.geometry.length-1;for(let Ct=0;Ct<Tt/2;Ct++)if(Ct+1<Tt/2){let Jt=Ct,Wt=Ct+1,Vt=Tt-1-Ct,Zt=Tt-2-Ct;Jt=Jt===0?Tt-1:Jt-1,Wt=Wt===0?Tt-1:Wt-1,Vt=Vt===0?Tt-1:Vt-1,Zt=Zt===0?Tt-1:Zt-1,gt.indices.push(Vt),gt.indices.push(Wt),gt.indices.push(Jt),gt.indices.push(Vt),gt.indices.push(Zt),gt.indices.push(Wt)}return gt}(u[0]),u=[ne.geometry]}const se=(He,ht)=>He<(ht.length-1)/2||He===ht.length-1,Se=this.wallMode?[u]:Ty(u,500);for(let He=Se.length-1;He>=0;He--){const ht=Se[He];(ht.length===0||(we=ht[0]).every(Mt=>Mt.x<=0)||we.every(Mt=>Mt.x>=Bt)||we.every(Mt=>Mt.y<=0)||we.every(Mt=>Mt.y>=Bt))&&Se.splice(He,1)}var we;let Te;if(z)Te=nM(Se,R,g);else{Te=[];for(const He of Se)Te.push({polygon:He,bounds:R})}const Oe=F?this.edgeRadius:0,Ne=Oe>0&&this.zoom<17,at=(He,ht)=>{if(He.length===0)return!1;const Mt=He[He.length-1];return ht.x===Mt.x&&ht.y===Mt.y};for(const{polygon:He,bounds:ht}of Te){let Mt=0,gt=0;for(const St of He)F&&!St[0].equals(St[St.length-1])&&St.push(St[0]),gt+=F?St.length-1:St.length;const It=this.segments.prepareSegment((F?5:4)*gt,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const Rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},st=new qk;if(st.vertexOffset=this.footprintVertices.length,st.indexOffset=3*this.footprintIndices.length,st.ringIndices=[],F){const St=[],qe=[];Mt=It.vertexLength;for(let zt=0;zt<He.length;zt++){const At=He[zt];At.length&&zt!==0&&qe.push(St.length/2);const ln=[];let Kt,Tt;Kt=At[1].sub(At[0])._perp()._unit(),st.ringIndices.push(At.length-1);for(let Ct=1;Ct<At.length;Ct++){const Jt=At[Ct],Wt=At[Ct===At.length-1?1:Ct+1],Vt=Jt.clone();if(Oe){Tt=Wt.sub(Jt)._perp()._unit();const Zt=Kt.add(Tt)._unit(),Tn=Oe*Math.min(4,1/(Kt.x*Zt.x+Kt.y*Zt.y));Vt.x+=Tn*Zt.x,Vt.y+=Tn*Zt.y,Vt.x=Math.round(Vt.x),Vt.y=Math.round(Vt.y),Kt=Tt}if(!K||Oe!==0&&!Ne||at(ln,Vt)||ln.push(Vt),Iy(this.layoutVertexArray,Vt.x,Vt.y,0,0,1,1,0),this.wallMode){const Zt=se(Ct,At);Sy(this.wallVertexArray,ne.joinNormals[Ct],!Zt)}It.vertexLength++,this.footprintVertices.emplaceBack(Jt.x,Jt.y),St.push(Jt.x,Jt.y),z&&Ay(this.layoutVertexExtArray,M.projectTilePoint(Vt.x,Vt.y,g),M.upVector(g,Vt.x,Vt.y))}K&&(Oe===0||Ne)&&(ln.length!==0&&at(ln,ln[0])&&ln.pop(),this.groundEffect.addData(ln,ht,C))}const ot=this.wallMode?ne.indices:Im(St,qe);for(let zt=0;zt<ot.length;zt+=3)this.footprintIndices.emplaceBack(st.vertexOffset+ot[zt+0],st.vertexOffset+ot[zt+1],st.vertexOffset+ot[zt+2]),this.indexArray.emplaceBack(Mt+ot[zt],Mt+ot[zt+2],Mt+ot[zt+1]),It.primitiveLength++;st.indexCount+=ot.length,st.vertexCount+=this.footprintVertices.length-st.vertexOffset}for(let St=0;St<He.length;St++){const qe=He[St];G.startRing(H,qe[0]);let ot=qe.length>4&&Jk(qe[qe.length-2],qe[0],qe[1]),zt=Oe?tG(qe[qe.length-2],qe[0],qe[1],Oe):0;const At=[];let ln,Kt,Tt;Kt=qe[1].sub(qe[0])._perp()._unit();let Ct=!0;for(let Jt=1,Wt=0;Jt<qe.length;Jt++){let Vt=qe[Jt-1],Zt=qe[Jt];const Tn=qe[Jt===qe.length-1?1:Jt+1];if(G.appendEdge(H,Zt,Vt),QE(Zt,Vt,ht)){Oe&&(Kt=Tn.sub(Zt)._perp()._unit(),Ct=!Ct);continue}const kn=Zt.sub(Vt)._perp(),Un=kn.x/(Math.abs(kn.x)+Math.abs(kn.y)),On=kn.y>0?1:0,li=Vt.dist(Zt);if(Wt+li>32768&&(Wt=0),Oe){Tt=Tn.sub(Zt)._perp()._unit();let ue=Yk(Vt,Zt,Tn,Kk(Kt,Tt),Oe);isNaN(ue)&&(ue=0);const it=Zt.sub(Vt)._unit();Vt=Vt.add(it.mult(zt))._round(),Zt=Zt.add(it.mult(-ue))._round(),zt=ue,Kt=Tt,K&&this.zoom>=17&&(at(At,Vt)||At.push(Vt),at(At,Zt)||At.push(Zt))}const Yn=It.vertexLength,hr=qe.length>4&&Jk(Vt,Zt,Tn);let ce=eM(Wt,ot,Ct);if(Iy(this.layoutVertexArray,Vt.x,Vt.y,Un,On,0,0,ce),Iy(this.layoutVertexArray,Vt.x,Vt.y,Un,On,0,1,ce),this.wallMode){const ue=se(Jt-1,qe),it=ne.joinNormals[Jt-1];Sy(this.wallVertexArray,it,ue),Sy(this.wallVertexArray,it,ue)}if(Wt+=li,ce=eM(Wt,hr,!Ct),ot=hr,Iy(this.layoutVertexArray,Zt.x,Zt.y,Un,On,0,0,ce),Iy(this.layoutVertexArray,Zt.x,Zt.y,Un,On,0,1,ce),this.wallMode){const ue=se(Jt,qe),it=ne.joinNormals[Jt];Sy(this.wallVertexArray,it,ue),Sy(this.wallVertexArray,it,ue)}if(It.vertexLength+=4,this.indexArray.emplaceBack(Yn+0,Yn+1,Yn+2),this.indexArray.emplaceBack(Yn+1,Yn+3,Yn+2),It.primitiveLength+=2,Oe){const ue=Mt+(Jt===1?qe.length-2:Jt-2),it=Jt===1?Mt:ue+1;if(this.indexArray.emplaceBack(Yn+1,ue,Yn+3),this.indexArray.emplaceBack(ue,it,Yn+3),It.primitiveLength+=2,ln===void 0&&(ln=Yn),!QE(Tn,qe[Jt],ht)){const Ft=Jt===qe.length-1?ln:It.vertexLength;this.indexArray.emplaceBack(Yn+2,Yn+3,Ft),this.indexArray.emplaceBack(Yn+3,Ft+1,Ft),this.indexArray.emplaceBack(Yn+3,it,Ft+1),It.primitiveLength+=3}Ct=!Ct}if(z){const ue=this.layoutVertexExtArray,it=M.projectTilePoint(Vt.x,Vt.y,g),Ft=M.projectTilePoint(Zt.x,Zt.y,g),Gt=M.upVector(g,Vt.x,Vt.y),jt=M.upVector(g,Zt.x,Zt.y);Ay(ue,it,Gt),Ay(ue,it,Gt),Ay(ue,Ft,jt),Ay(ue,Ft,jt)}}F&&(Mt+=qe.length-1),K&&Oe&&this.zoom>=17&&(At.length!==0&&at(At,At[0])&&At.pop(),this.groundEffect.addData(At,ht,C,Oe>0))}this.footprintSegments.push(st),Rt.triangleCount=this.indexArray.length-Rt.triangleArrayOffset,this.polygonSegments.push(Rt),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=G.borders?Hk:this.encodeCentroid(G,H),this.centroidData.push(H),G.borders){this.featuresOnBorder.push(G);const He=this.featuresOnBorder.length-1;for(let ht=0;ht<G.borders.length;ht++)G.borders[ht][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ht].push(He)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,d,_,w,g,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(s,d,_,w,g,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,ie)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((s,u)=>this.featuresOnBorder[s].borders[i][0]-this.featuresOnBorder[u].borders[i][0])}splitToSubtiles(){const i=[];for(let w=0;w<this.centroidData.length;w++){const T=this.centroidData[w],E=+(T.min.y+T.max.y>Bt),C=2*E+(+(T.min.x+T.max.x>Bt)^E);for(let R=0;R<T.polygonSegLen;R++){const M=T.polygonSegIdx+R;i.push({centroidIdx:w,subtile:C,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const s=new yr;i.sort((w,T)=>w.triangleSegmentIdx===T.triangleSegmentIdx?w.subtile-T.subtile:w.triangleSegmentIdx-T.triangleSegmentIdx);let u=0,d=0,g=0;for(const w of i){if(w.triangleSegmentIdx!==u)break;g++}const _=i.length;for(;d!==i.length;){u=i[d].triangleSegmentIdx;let w=0,T=d,E=d;for(let C=T;C<g&&i[C].subtile===w;C++)E++;for(;T!==g;){const C=i[T];w=C.subtile;const R=this.centroidData[C.centroidIdx].min.clone(),M=this.centroidData[C.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let F=T;F<E;F++){const G=i[F],H=this.polygonSegments[G.polygonSegmentIdx],K=this.centroidData[G.centroidIdx].min,ie=this.centroidData[G.centroidIdx].max,ne=this.indexArray.uint16;for(let se=H.triangleArrayOffset;se<H.triangleArrayOffset+H.triangleCount;se++)s.emplaceBack(ne[3*se],ne[3*se+1],ne[3*se+2]);z.primitiveLength+=H.triangleCount,R.x=Math.min(R.x,K.x),R.y=Math.min(R.y,K.y),M.x=Math.max(M.x,ie.x),M.y=Math.max(M.y,ie.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:R,max:M}),T=E;for(let F=T;F<g&&i[F].subtile===i[T].subtile;F++)E++}d=g;for(let C=d;C<_&&i[C].triangleSegmentIdx===i[d].triangleSegmentIdx;C++)g++}s._trim(),this.indexArray=s}getVisibleSegments(i,s,u){const d=new Cr;if(this.wallMode){for(const G of this.triangleSubSegments)d.segments.push(G.segment);return d}let g=0,_=0;const w=1<<i.canonical.z;if(s){const G=s.getMinMaxForTile(i);G&&(g=G.min,_=G.max)}_+=this.maxHeight;const T=i.toUnwrapped();let E;const C=[T.canonical.x/w+T.wrap,T.canonical.y/w],R=[(T.canonical.x+1)/w+T.wrap,(T.canonical.y+1)/w],M=(G,H,K)=>[G[0]*(1-K[0])+H[0]*K[0],G[1]*(1-K[1])+H[1]*K[1]],z=[],F=[];for(const G of this.triangleSubSegments){z[0]=G.min.x/Bt,z[1]=G.min.y/Bt,F[0]=G.max.x/Bt,F[1]=G.max.y/Bt;const H=M(C,R,z),K=M(C,R,F);if(new ti([H[0],H[1],g],[K[0],K[1],_]).intersectsPrecise(u)===0){E&&(d.segments.push(E),E=void 0);continue}const ie=G.segment;E&&E.vertexOffset!==ie.vertexOffset&&(d.segments.push(E),E=void 0),E?(E.vertexLength+=ie.vertexLength,E.primitiveLength+=ie.primitiveLength):E={vertexOffset:ie.vertexOffset,primitiveLength:ie.primitiveLength,vertexLength:ie.vertexLength,primitiveOffset:ie.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&d.segments.push(E),d}encodeCentroid(i,s){const u=i.centroid(),d=s.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),_=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new bt(he(u.x,1,Bt-1)<<3|g,he(u.y,1,Bt-1)<<3|_)}encodeBorderCentroid(i){if(!i.borders)return new bt(0,0);const s=i.borders,u=Number.MAX_VALUE;if(s[0][0]!==u||s[1][0]!==u){const d=s[0][0]!==u?0:1;return new bt(6|(s[0][0]!==u?0:65528),(s[d][0]+s[d][1])/2<<3|6)}{const d=s[2][0]!==u?2:3;return new bt((s[d][0]+s[d][1])/2<<3|6,6|(s[2][0]!==u?0:65528))}}showCentroid(i){const s=this.centroidData[i.centroidDataIndex];s.flags&=2147483647,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const s=i.vertexArrayOffset,u=i.vertexCount+i.vertexArrayOffset,d=i.flags&ad?Hk:i.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==d.y||g!==d.x){for(let _=s;_<u;++_)this.centroidVertexArray.emplace(_,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const d=s.getReplacementRegionsForTile(i.toUnwrapped());if(hw(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const g=[];for(const _ of this.activeReplacements){if(_.order<u)continue;const w=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));if(_.footprint.buildingId){const T=_.footprint.buildingId;for(const E of this.centroidData)E.buildingId===T&&(E.flags|=ad)}else for(const T of this.centroidData)if(!(T.flags&ad||_.min.x>T.max.x||T.min.x>_.max.x||_.min.y>T.max.y||T.min.y>_.max.y))for(let E=0;E<T.footprintSegLen;E++){const C=this.footprintSegments[T.footprintSegIdx+E];if(g.length=0,nG(this.footprintVertices,C.vertexOffset,C.vertexCount,_.footprintTileId.canonical,i.canonical,g),WE(_.footprint,g,this.footprintIndices.uint16,C.indexOffset,C.indexCount,-C.vertexOffset,-w)){T.flags|=ad;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,s,u){let d=!1;for(let g=0;g<u.footprintSegLen;g++){const _=this.footprintSegments[u.footprintSegIdx+g];let w=0;for(const T of _.ringIndices){for(let E=w,C=T+w-1;E<T+w;C=E++){const R=this.footprintVertices.int16[2*(E+_.vertexOffset)+0],M=this.footprintVertices.int16[2*(E+_.vertexOffset)+1],z=this.footprintVertices.int16[2*(C+_.vertexOffset)+1];M>s!=z>s&&i<(this.footprintVertices.int16[2*(C+_.vertexOffset)+0]-R)*(s-M)/(z-M)+R&&(d=!d)}w=T}}return d}getHeightAtTileCoord(i,s){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(i+Bt)*Bt+(s+Bt);if(this.partLookup.hasOwnProperty(g)){const _=this.partLookup[g];return _?{height:_.height,hidden:!!(_.flags&ad)}:void 0}for(const _ of this.centroidData)i>_.max.x||_.min.x>i||s>_.max.y||_.min.y>s||_.height<=u||this.footprintContainsPoint(i,s,_)&&(u=_.height,this.partLookup[g]=_,d=!!(_.flags&ad));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[g]=void 0}}function Kk(l,i){const s=l.add(i)._unit();return l.x*s.x+l.y*s.y}function tG(l,i,s,u){const d=i.sub(l)._perp()._unit(),g=s.sub(i)._perp()._unit();return Yk(l,i,s,Kk(d,g),u)}function Yk(l,i,s,u,d){const g=Math.sqrt(1-u*u);return Math.min(l.dist(i)/3,i.dist(s)/3,d*g/u)}function QE(l,i,s){return l.x<s[0].x&&i.x<s[0].x||l.x>s[1].x&&i.x>s[1].x||l.y<s[0].y&&i.y<s[0].y||l.y>s[1].y&&i.y>s[1].y}function Qk(l,i){return l.x<i[0].x||l.x>i[1].x||l.y<i[0].y||l.y>i[1].y}function Jk(l,i,s){if(l.x<0||l.x>=Bt||i.x<0||i.x>=Bt||s.x<0||s.x>=Bt)return!1;const u=s.sub(i),d=u.perp(),g=l.sub(i);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function eM(l,i,s){const u=i?2|l:-3&l;return s?1|u:-2&u}function tM(){const l=Math.PI/32,i=Math.tan(l),s=A;return s*Math.sqrt(1+2*i*i)-s}function nM(l,i,s){const u=1<<s.z,d=te(s.x/u),g=te((s.x+1)/u),_=re(s.y/u),w=re((s.y+1)/u);return function(T,E,C,R,M=0,z){const F=[];if(!T.length||!C||!R)return F;const G=(we,Te)=>{for(const Oe of we)F.push({polygon:Oe,bounds:Te})},H=Math.ceil(Math.log2(C)),K=Math.ceil(Math.log2(R)),ie=H-K,ne=[];for(let we=0;we<Math.abs(ie);we++)ne.push(ie>0?0:1);for(let we=0;we<Math.min(H,K);we++)ne.push(0),ne.push(1);let se=T;if(se=lw(se,E[0].y-M,E[1].y+M,1),se=lw(se,E[0].x-M,E[1].x+M,0),!se.length)return F;const Se=[];for(ne.length?Se.push({polygons:se,bounds:E,depth:0}):G(se,E);Se.length;){const we=Se.pop(),Te=we.depth,Oe=ne[Te],Ne=we.bounds[0],at=we.bounds[1],He=Oe===0?Ne.x:Ne.y,ht=Oe===0?at.x:at.y,Mt=z?z(Oe,He,ht):.5*(He+ht),gt=lw(we.polygons,He-M,Mt+M,Oe),It=lw(we.polygons,Mt-M,ht+M,Oe);if(gt.length){const Rt=[Ne,new bt(Oe===0?Mt:at.x,Oe===1?Mt:at.y)];ne.length>Te+1?Se.push({polygons:gt,bounds:Rt,depth:Te+1}):G(gt,Rt)}if(It.length){const Rt=[new bt(Oe===0?Mt:Ne.x,Oe===1?Mt:Ne.y),at];ne.length>Te+1?Se.push({polygons:It,bounds:Rt,depth:Te+1}):G(It,Rt)}}return F}(l,i,Math.ceil((g-d)/11.25),Math.ceil((_-w)/11.25),1,(T,E,C)=>{if(T===0)return .5*(E+C);{const R=re((s.y+E/Bt)/u);return(X(.5*(re((s.y+C/Bt)/u)+R))*u-s.y)*Bt}})}function nG(l,i,s,u,d,g){const _=Math.pow(2,u.z-d.z);for(let w=0;w<s;w++){let T=l.int16[2*(w+i)+0],E=l.int16[2*(w+i)+1];T=(T+d.x*Bt)*_-u.x*Bt,E=(E+d.y*Bt)*_-u.y*Bt,g.push(new bt(T,E))}}let iM,rM;Xt(fw,"FillExtrusionBucket",{omit:["layers","features"]}),Xt(Wk,"PartData"),Xt(qk,"FootprintSegment"),Xt(Zk,"BorderCentroidData"),Xt(YE,"GroundEffect");class Ff extends bt{constructor(i,s,u){super(i,s),this.z=u}}class sM extends Ff{constructor(i,s,u,d){super(i,s,u),this.w=d}}function oM(l,i,s,u){const d=s==="x"?"y":"x",g=(u-l[s])/(i[s]-l[s]);l[d]=Math.round(l[d]+(i[d]-l[d])*g),l[s]=u,l.hasOwnProperty("z")&&(l.z=gn(l.z,i.z,g)),l.hasOwnProperty("w")&&(l.w=gn(l.w,i.w,g))}function aM(l,i,s,u){const d=s,g=u;for(const _ of["x","y"]){let w=l,T=i;w[_]>=T[_]&&(w=i,T=l),w[_]<d&&T[_]>d&&oM(w,T,_,d),w[_]<g&&T[_]>g&&oM(T,w,_,g)}}function pw(l,i,s,u,d,g){const _=[];for(let w=0;w<l.length;w++){const T=l[w];let E;const C=_.length;let R=0;for(let M=0;M<T.length-1;M++){let z=T[M],F=T[M+1],G=0;const H=R;let K,ie;g&&(G=Math.hypot(F.x-z.x,F.y-z.y),R+=G,K=z,ie=F),z.x<i&&F.x<i||(z.x<i?z=new bt(i,z.y+(i-z.x)/(F.x-z.x)*(F.y-z.y))._round():F.x<i&&(F=new bt(i,z.y+(i-z.x)/(F.x-z.x)*(F.y-z.y))._round()),z.y<s&&F.y<s||(z.y<s?z=new bt(z.x+(s-z.y)/(F.y-z.y)*(F.x-z.x),s)._round():F.y<s&&(F=new bt(z.x+(s-z.y)/(F.y-z.y)*(F.x-z.x),s)._round()),z.x>=u&&F.x>=u||(z.x>=u?z=new bt(u,z.y+(u-z.x)/(F.x-z.x)*(F.y-z.y))._round():F.x>=u&&(F=new bt(u,z.y+(u-z.x)/(F.x-z.x)*(F.y-z.y))._round()),z.y>=d&&F.y>=d||(z.y>=d?z=new bt(z.x+(d-z.y)/(F.y-z.y)*(F.x-z.x),d)._round():F.y>=d&&(F=new bt(z.x+(d-z.y)/(F.y-z.y)*(F.x-z.x),d)._round()),E&&z.equals(E[E.length-1])||(E=[z],_.push(E),g&&g.push({progress:{min:H+lM(K,ie,z)*G,max:1},parentIndex:w,prevPoint:K,nextPoint:ie})),E.push(F),g&&(g[g.length-1].progress.max=H+lM(K,ie,F)*G,g[g.length-1].nextPoint=ie)))))}if(g&&R>0)for(let M=C;M<_.length;M++)g[M].progress.min/=R,g[M].progress.max/=R}return _}function iG(l,i,s,u,d){if(l.length<2)return void u.push(l);const g=[];for(;i.valid();){const[E,C]=i.get();for(let R=0;R<l.length-1;R++){const M=l[R],z=l[R+1],F=aa(M,z,E,C);if(F){const[G]=F,H=new bt(gn(M.x,z.x,G),gn(M.y,z.y,G));g.push({t:R+G,distance:0,point:H})}}i.next()}if(g.length===0)return void u.push(l);g.sort((E,C)=>E.t-C.t);let _=0,w=0,T=[];for(u.push(T);_!==l.length;){if(w===g.length){for(;_!==l.length;)T.length!==0&&T[T.length-1].equals(l[_])||T.push(l[_]),_++;break}g[w].t<=_?(T.length!==0&&T[T.length-1].equals(g[w].point)||T.push(g[w].point),Math.trunc(g[w].t),w++):(T.length!==0&&T[T.length-1].equals(l[_])||T.push(l[_]),_++)}}function lM(l,i,s){return l.x!==i.x?(s.x-l.x)/(i.x-l.x):l.y!==i.y?(s.y-l.y)/(i.y-l.y):0}function Cy(l,i){return l.x*i.x+l.y*i.y}function cM(l,i){if(l.length===1){let s=0;const u=i[s++];let d;for(;!d||u.equals(d);)if(d=i[s++],!d)return 1/0;for(;s<i.length;s++){const g=i[s],_=l[0],w=d.sub(u),T=g.sub(u),E=_.sub(u),C=Cy(w,w),R=Cy(w,T),M=Cy(T,T),z=Cy(E,w),F=Cy(E,T),G=C*M-R*R,H=(M*z-R*F)/G,K=(C*F-R*z)/G,ie=u.z*(1-H-K)+d.z*H+g.z*K;if(isFinite(ie))return ie}return 1/0}{let s=1/0;for(const u of i)s=Math.min(s,u.z);return s}}function uM(l,i,s,u,d,g,_,w){const T=_*d.getElevationAt(l,i,!0,!0),E=g[0]!==0,C=E?g[1]===0?_*(g[0]/7-450):_*function(R,M,z){const F=Math.floor(M[0]/8),G=Math.floor(M[1]/8),H=10*(M[0]-8*F),K=10*(M[1]-8*G),ie=R.getElevationAt(F,G,!0,!0),ne=R.getMeterToDEM(z),se=Math.floor(.5*(H*ne-1)),Se=Math.floor(.5*(K*ne-1)),we=R.tileCoordToPixel(F,G),Te=2*se+1,Oe=2*Se+1,Ne=function(It,Rt,st,St,qe){return[It.getElevationAtPixel(Rt,st,!0),It.getElevationAtPixel(Rt+qe,st,!0),It.getElevationAtPixel(Rt,st+qe,!0),It.getElevationAtPixel(Rt+St,st+qe,!0)]}(R,we.x-se,we.y-Se,Te,Oe),at=Math.abs(Ne[0]-Ne[1]),He=Math.abs(Ne[2]-Ne[3]),ht=Math.abs(Ne[0]-Ne[2])+Math.abs(Ne[1]-Ne[3]),Mt=Math.min(.25,.5*ne*(at+He)/Te),gt=Math.min(.25,.5*ne*ht/Oe);return ie+Math.max(Mt*H,gt*K)}(d,g,w):T;return{base:T+(s===0?-1:s),top:E?Math.max(C+u,T+s+2):T+u}}class rG{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class sG{constructor(){this.tasks={},this.taskQueue=[],_n(["process"],this),this.invoker=new rG(this.process),this.nextId=0}add(i,s){const u=this.nextId++,d=function({type:g,isSymbolTile:_,zoom:w}){return w=w||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-w:g==="maybePrepare"&&_?400-w:500:200-w:100-w}(s);if(d===0){try{i()}finally{}return null}return this.tasks[u]={fn:i,metadata:s,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const s=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let i=null,s=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<s&&(s=g.priority,i=d)}if(i===null)return null;const u=this.taskQueue[i];return this.taskQueue.splice(i,1),u}remove(){this.invoker.remove()}}class hM{constructor(i,s,u){this.target=i,this.parent=s,this.mapId=u,this.callbacks={},this.cancelCallbacks={},_n(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new sG}send(i,s,u,d,g=!1,_){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=_,this.callbacks[w]=u);const T=new Set;return this.target.postMessage({id:w,type:i,hasCallback:!!u,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:fc(s,T)},T),{cancel:()=>{u&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(i){const s=i.data;if(!s)return;const u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(s.mustQueue||gi(self)){const d=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,s),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,s)}processTask(i,s){if(delete this.cancelCallbacks[i],s.type==="<response>"){const u=this.callbacks[i];delete this.callbacks[i],u&&(s.error?u(Xo(s.error)):u(null,Xo(s.data)))}else{const u=new Set,d=s.hasCallback?(_,w)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?fc(_):null,data:fc(w,u)},u)}:()=>{},g=Xo(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,g,d);else if(this.parent.getWorkerSource){const _=s.type.split("."),{source:w,scope:T}=g;this.parent.getWorkerSource(s.sourceMapId,_[0],w,T)[_[1]](g,d)}else d(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Py={workerUrl:"",workerClass:null,workerParams:void 0};const JE="mapboxgl_preloaded_worker_pool";class Nf{constructor(){this.active={}}acquire(i,s=Nf.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<s;)this.workers.push(Py.workerClass!=null?new Py.workerClass:new self.Worker(Py.workerUrl,Py.workerParams));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[JE]}numActive(){return Object.keys(this.active).length}}Nf.workerCount=2;class Am{constructor(i,s,u="Worker",d=Nf.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=pt();const g=this.workerPool.acquire(this.id,d);for(let _=0;_<g.length;_++){const w=new Am.Actor(g[_],s,this.id);w.name=`${u} ${_}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,s,u){Fe(this.actors,(d,g)=>{d.send(i,s,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Ry,eI;function mw(){return Ry||(Ry=new Nf),Ry}Am.Actor=hM;class oG{constructor(i){this.module=i}createIntArray(i){const s=new Int32Array(i),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heap32.set(s,u/s.BYTES_PER_ELEMENT),u}createFloatArray(i){const s=new Float32Array(i),u=this.module.malloc(s.length*s.BYTES_PER_ELEMENT);return this.module.heapF32.set(s,u/s.BYTES_PER_ELEMENT),u}createStringBuffer(i){const s=this.module.malloc(i.length+1);for(let u=0;u<i.length;++u)this.module.heapU8[s+u]=i.charCodeAt(u);return this.module.heapU8[s+i.length]=0,s}readStringBuffer(i){let s="";for(;this.module.heapU8[i]!==0;)s+=String.fromCharCode(this.module.heapU8[i]),++i;return s}setStyle(i){const s=i.entranceColorRgb,u=i.facadeGlazingColorRgb,d=i.roofColorRgb,g=i.wallColorRgb,_=i.normalScale;this.module.setStyle(s[0],s[1],s[2],u[0],u[1],u[2],d[0],d[1],d[2],g[0],g[1],g[2],_[0],_[1],_[2],i.tileToMeters)}setAOOptions(i,s){this.module.setAOOptions(i?1:0,s)}setMetricOptions(i,s){this.module.setMetricOptions(i?1:0,s)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,s){this.module.setFacadeOptions(i,s?1:0)}setFauxFacadeOptions(i,s,u){this.module.setFauxFacadeOptions(i?1:0,s?1:0,u)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,s){for(const w of i){const T=this.createStringBuffer(w.roofType),E=[0],C=[];for(const z of w.coordinates)if(Array.isArray(z)){for(const F of z)C.push(F.x),C.push(F.y);E.push(C.length)}const R=this.createIntArray(E),M=this.createFloatArray(C);this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,T,w.roofType.length,M,R,E.length-1),this.module.free(T),this.module.free(R),this.module.free(M)}for(const w of s){let T;T=w.entrances?JSON.parse(w.entrances):[];const E=this.createFloatArray(T),C=[];for(const M of w.coordinates)C.push(M.x),C.push(M.y);const R=this.createFloatArray(C);this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,E,T.length,R,C.length),this.module.free(E),this.module.free(R)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const u=this.module.getMeshCount(),d=new Array(u);for(let w=0;w<u;w++){const T=this.module.getPositionsPtr(w),E=this.module.getPositionsLength(w),C=new Float32Array(this.module.heapF32.buffer,T,E),R=this.module.getNormalsPtr(w),M=this.module.getNormalsLength(w),z=new Float32Array(this.module.heapF32.buffer,R,M),F=this.module.getColorsPtr(w),G=this.module.getColorsLength(w),H=new Uint8Array(this.module.heapU8.buffer,F,G),K=this.module.getAOPtr(w),ie=this.module.getAOLength(w),ne=new Float32Array(this.module.heapF32.buffer,K,ie),se=this.module.getUVPtr(w),Se=this.module.getUVLength(w),we=new Float32Array(this.module.heapF32.buffer,se,Se),Te=this.module.getFauxFacadePtr(w),Oe=this.module.getFauxFacadeLength(w),Ne=new Uint8Array(this.module.heapU8.buffer,Te,Oe),at=this.module.getIndicesPtr(w),He=this.module.getIndicesLength(w),ht=new Int32Array(this.module.heap32.buffer,at,He),Mt=this.module.getBuildingPart(w),gt=this.readStringBuffer(Mt);d[w]={positions:C,normals:z,colors:H,ao:ne,uv:we,isFauxFacade:Ne,indices:ht,buildingPart:gt}}const g=this.module.getRingCount(),_=[];for(let w=0;w<g;w++){const T=this.module.getRingPtr(w),E=this.module.getRingLength(w),C=new Float32Array(this.module.heapF32.buffer,T,E);_.push(C)}return{meshes:d,modifiedPolygonRings:_}}}let ky,tI,mc,Cm,nI,Pm=null,Rm=null,dM=null,gw=null;function fM(){return gi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:tI||ye.DRACO_URL}function pM(){if(gi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Cm)return Cm;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Cm=WebAssembly.validate(l)?ye.MESHOPT_SIMD_URL:ye.MESHOPT_URL,Cm}function aG(){return gw}const _w={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lG={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},My={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function mM(l,i,s){const u=s.json.bufferViews.length,d=s.buffers.length;i.bufferView=u,s.json.bufferViews[u]={buffer:d,byteLength:l.byteLength},s.buffers[d]=l}const iI="KHR_draco_mesh_compression";function cG(l,i){const s=l.extensions&&l.extensions[iI];if(!s)return;const u=new mc.Decoder,d=vM(i,s.bufferView),g=new mc.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const _=i.json.accessors[l.indices],w=_w[_.componentType],T=_.count*w.BYTES_PER_ELEMENT,E=mc._malloc(T);w===Uint16Array?u.GetTrianglesUInt16Array(g,T,E):u.GetTrianglesUInt32Array(g,T,E),mM(mc.memory.buffer.slice(E,E+T),_,i),mc._free(E);for(const C of Object.keys(s.attributes)){const R=u.GetAttributeByUniqueId(g,s.attributes[C]),M=i.json.accessors[l.attributes[C]],z=lG[M.componentType],F=M.count*My[M.type]*_w[M.componentType].BYTES_PER_ELEMENT,G=mc._malloc(F);u.GetAttributeDataArrayForAllPoints(g,R,mc[z],F,G),mM(mc.memory.buffer.slice(G,G+F),M,i),mc._free(G)}u.destroy(),g.destroy(),delete l.extensions[iI]}const yw="EXT_meshopt_compression";function uG(l,i){if(!l.extensions||!l.extensions[yw])return;const s=l.extensions[yw],u=new Uint8Array(i.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),d=new Uint8Array(s.count*s.byteStride);nI.decodeGltfBuffer(d,s.count,s.byteStride,u,s.mode,s.filter),l.buffer=i.buffers.length,l.byteOffset=0,i.buffers[l.buffer]=d.buffer,delete l.extensions[yw]}const gM=1179937895,_M=new TextDecoder("utf8");function yM(l,i){return new URL(l,i).href}function hG(l,i,s,u){return fetch(yM(l.uri,u)).then(d=>d.arrayBuffer()).then(d=>{i.buffers[s]=d})}function vM(l,i){const s=l.json.bufferViews[i];return new Uint8Array(l.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function dG(l,i,s,u){if(l.uri){const d=yM(l.uri,u);return fetch(d).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{i.images[s]=g})}if(l.bufferView!==void 0){const d=vM(i,l.bufferView),g=new Blob([d],{type:l.mimeType});return createImageBitmap(g).then(_=>{i.images[s]=_})}}function xM(l,i=0,s){const u={json:null,images:[],buffers:[]};if(new Uint32Array(l,i,1)[0]===gM){const C=new Uint32Array(l,i);let R=2;const M=(C[R++]>>2)-3,z=C[R++]>>2;if(R++,u.json=JSON.parse(_M.decode(C.subarray(R,R+z))),R+=z,R<M){const F=C[R++];R++;const G=i+(R<<2);u.buffers[0]=l.slice(G,G+F)}}else u.json=JSON.parse(_M.decode(new Uint8Array(l,i)));const{buffers:d,images:g,meshes:_,extensionsUsed:w,bufferViews:T}=u.json;let E=Promise.resolve();if(d){const C=[];for(let R=0;R<d.length;R++){const M=d[R];M.uri?C.push(hG(M,u,R,s)):u.buffers[R]||(u.buffers[R]=null)}E=Promise.all(C)}return E.then(()=>{const C=[],R=w&&w.includes(iI),M=w&&w.includes(yw);if(R&&C.push(function(){if(!mc)return ky??(ky=function(z){let F,G=null;function H(){F=new Uint8Array(G.buffer)}function K(){throw new Error("Unexpected Draco error.")}const ie={a:{a:K,d:function(ne,se,Se){return F.copyWithin(ne,se,se+Se)},c:function(ne){const se=F.length,Se=Math.max(ne>>>0,Math.ceil(1.2*se)),we=Math.ceil((Se-se)/65536);try{return G.grow(we),H(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,ie):z.then(ne=>ne.arrayBuffer()).then(ne=>WebAssembly.instantiate(ne,ie))).then(ne=>{const{Rb:se,Qb:Se,P:we,T:Te,X:Oe,Ja:Ne,La:at,Qa:He,Va:ht,Wa:Mt,eb:gt,jb:It,f:Rt,e:st,yb:St,zb:qe,Ab:ot,Bb:zt,Db:At,Gb:ln}=ne.instance.exports;G=st;const Kt=(()=>{let Tt=0,Ct=0,Jt=0,Wt=0;return Vt=>{Jt&&(se(Wt),se(Tt),Ct+=Jt,Jt=Tt=0),Tt||(Ct+=128,Tt=Se(Ct));const Zt=Vt.length+7&-8;let Tn=Tt;Zt>=Ct&&(Jt=Zt,Tn=Wt=Se(Zt));for(let kn=0;kn<Vt.length;kn++)F[Tn+kn]=Vt[kn];return Tn}})();return H(),Rt(),{memory:st,_free:se,_malloc:Se,Mesh:class{constructor(){this.ptr=we()}destroy(){Te(this.ptr)}},Decoder:class{constructor(){this.ptr=Ne()}destroy(){It(this.ptr)}DecodeArrayToMesh(Tt,Ct,Jt){const Wt=Kt(Tt),Vt=at(this.ptr,Wt,Ct,Jt.ptr);return!!Oe(Vt)}GetAttributeByUniqueId(Tt,Ct){return{ptr:He(this.ptr,Tt.ptr,Ct)}}GetTrianglesUInt16Array(Tt,Ct,Jt){ht(this.ptr,Tt.ptr,Ct,Jt)}GetTrianglesUInt32Array(Tt,Ct,Jt){Mt(this.ptr,Tt.ptr,Ct,Jt)}GetAttributeDataArrayForAllPoints(Tt,Ct,Jt,Wt,Vt){gt(this.ptr,Tt.ptr,Ct.ptr,Jt,Wt,Vt)}},DT_INT8:St(),DT_UINT8:qe(),DT_INT16:ot(),DT_UINT16:zt(),DT_UINT32:At(),DT_FLOAT32:ln()}})}(fetch(fM())),ky.then(z=>{mc=z,ky=void 0}))}()),M&&C.push(function(){if(nI)return;const z=function(F){let G;const H=WebAssembly.instantiateStreaming(F,{}).then(ne=>{G=ne.instance,G.exports.__wasm_call_ctors()}),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ie={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(ne,se,Se,we,Te,Oe){(function(Ne,at,He,ht,Mt,gt,It){const Rt=Ne.exports.sbrk,st=ht+3&-4,St=Rt(st*Mt),qe=Rt(gt.length),ot=new Uint8Array(Ne.exports.memory.buffer);ot.set(gt,qe);const zt=at(St,ht,Mt,qe,gt.length);if(zt===0&&It&&It(St,st,Mt),He.set(ot.subarray(St,St+ht*Mt)),Rt(St-Rt(0)),zt!==0)throw new Error(`Malformed buffer data: ${zt}`)})(G,G.exports[ie[Te]],ne,se,Se,we,G.exports[K[Oe]])}}}(fetch(pM()));return z.ready.then(()=>{nI=z})}()),g)for(let z=0;z<g.length;z++)C.push(dG(g[z],u,z,s));return(C.length?Promise.all(C):Promise.resolve()).then(()=>{if(R&&_)for(const{primitives:z}of _)for(const F of z)cG(F,u);if(M&&_&&T)for(const z of T)uG(z,u);return u})})}function rI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function sI(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class oI{constructor(i,s,u,d){this.context=i,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=i.gl.createTexture(),this.update(s,{premultiply:d&&d.premultiply})}update(i,s){const u=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,d=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:g}=this,{gl:_}=g,{x:w,y:T}=s&&s.position?s.position:{x:0,y:0},E=w+u,C=T+d;!this.size||this.size[0]===E&&this.size[1]===C||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!s||s.premultiply!==!1));const R=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&E>0&&C>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(E,C)))+1:1;_.texStorage2D(_.TEXTURE_2D,M,this.format,E,C),this.size=[E,C]}if(this.size)if(R)_.texSubImage2D(_.TEXTURE_2D,0,w,T,rI(this.format),sI(this.format),i);else{const M=i.data;M&&_.texSubImage2D(_.TEXTURE_2D,0,w,T,u,d,rI(this.format),sI(this.format),M)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(i,s,u=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?i===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(i,s,u,d,g){const{context:_}=this,{gl:w}=_;w.bindTexture(w.TEXTURE_2D,this.texture),s!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,s),this.magFilter=s),i!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?i===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),u!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,g)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=g)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Dy{constructor(i,s){this.context=i,this.texture=s}bind(i,s){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,i),this.minFilter=i),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrapS=s)}}const fG=di([{name:"a_pos_3f",components:3,type:"Float32"}]),pG=di([{name:"a_color_3f",components:3,type:"Float32"}]),mG=di([{name:"a_color_4f",components:4,type:"Float32"}]),gG=di([{name:"a_uv_2f",components:2,type:"Float32"}]),_G=di([{name:"a_normal_3f",components:3,type:"Float32"}]),yG=di([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),vG=di([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function wM(l,i){const s=vw(l.projection,l.zoom,l.width,l.height),u=function(g,_,w,T,E){const C=new L(w.lng-180*ld,w.lat),R=new L(w.lng+180*ld,w.lat),M=g.project(C.lng,C.lat),z=g.project(R.lng,R.lat),F=-Math.atan2(z.y-M.y,z.x-M.x),G=ve.fromLngLat(w);G.y=he(G.y,-1+ld,1-ld);const H=G.toLngLat(),K=g.project(H.lng,H.lat),ie=ve.fromLngLat(H);ie.x+=ld;const ne=ie.toLngLat(),se=g.project(ne.lng,ne.lat),Se=TM(se.x-K.x,se.y-K.y,F),we=ve.fromLngLat(H);we.y+=ld;const Te=we.toLngLat(),Oe=g.project(Te.lng,Te.lat),Ne=TM(Oe.x-K.x,Oe.y-K.y,F),at=Math.abs(Se.x)/Math.abs(Ne.y),He=me([]);nt(He,He,-F*(1-(E?0:T)));const ht=me([]);return Re(ht,ht,[1,1-(1-at)*T,1]),ht[4]=-Ne.x/Ne.y*T,nt(ht,ht,F),de(ht,He,ht),ht}(l.projection,0,l.center,s,i),d=bM(l);return Re(u,u,[d,d,1]),u}function bM(l){const i=l.projection,s=vw(l.projection,l.zoom,l.width,l.height),u=aI(i,l.center),d=aI(i,L.convert(i.center));return Math.pow(2,u*s+(1-s)*d)}function vw(l,i,s,u,d=1/0){const g=l.range;if(!g)return 0;const _=Math.min(d,Math.max(s,u)),w=Math.log(_/1024)/Math.LN2;return Me(g[0]+w,g[1]+w,i)}const ld=1/4e4;function aI(l,i){const s=he(i.lat,-fe,fe),u=new L(i.lng-180*ld,s),d=new L(i.lng+180*ld,s),g=l.project(u.lng,s),_=l.project(d.lng,s),w=ve.fromLngLat(u),T=ve.fromLngLat(d),E=_.x-g.x,C=_.y-g.y,R=T.x-w.x,M=T.y-w.y,z=Math.sqrt((R*R+M*M)/(E*E+C*C));return Math.log(z)/Math.LN2}function TM(l,i,s){const u=Math.cos(s),d=Math.sin(s);return{x:l*u-i*d,y:l*d+i*u}}function EM(l,i,s){me(l),nt(l,l,fi(i[2])),_t(l,l,fi(i[0])),ct(l,l,fi(i[1])),Re(l,l,s),de(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function xw(l,i,s,u,d,g,_,w){const T=[s[0]-i[0],s[1]-i[1],0],E=[u[0]-i[0],u[1]-i[1],0];if(Be(T)<1e-12||Be(E)<1e-12)return io(l);const C=ar([],T,E);qn(C,C),Ii(E,u,i),T[2]=(g-d)*w,E[2]=(_-d)*w;const R=T;return ar(R,T,E),qn(R,R),er(l,C,R)}function lI(l,i,s=!1){const u=sd(i.zoom),d=function(g,_,w){const T=_.worldSize,E=[g[12],g[13],g[14]],C=re(E[1]/T),R=te(E[0]/T),M=me([]),z=Z(1,C)*T,F=Z(1,0)*T*Ee(C,_.zoom),G=1/zE(T);let H=F*G;if(w){const se=vw(_.projection,_.zoom,_.width,_.height,1024);H=G*_.projection.pixelSpaceConversion(_.center.lat,T,se)}const K=I(C,R);ii(K,K,Pn([],qn([],K),z*H*E[2]));const ie=function(se){const Se=[se[0],se[1],se[2]];let we=[0,1,0];const Te=ar([],we,Se);return ar(we,Se,Te),Xr(we)===0&&(we=[0,1,0],ar(Te,Se,we)),qn(Te,Te),qn(we,we),qn(Se,Se),[Te[0],Te[1],Te[2],0,we[0],we[1],we[2],0,Se[0],Se[1],Se[2],0,se[0],se[1],se[2],1]}(K);Re(M,M,[H,H,H*z]),ge(M,M,[-E[0],-E[1],-E[2]]);const ne=de([],_.globeMatrix,ie);return de(ne,ne,M),de(ne,ne,g),ne}(l,i,s);if(u>0){const g=function(_,w){const T=w.worldSize,E=Z(1,0)*T*Ee(w.center.lat,w.zoom)/zE(T),C=Z(1,w.center.lat)*T,R=me([]);return ct(R,R,fi(w.center.lng)),_t(R,R,fi(w.center.lat)),ge(R,R,[0,0,To]),Re(R,R,[E,E,E*C]),ge(R,R,[w.point.x-.5*T,w.point.y-.5*T,0]),de(R,R,_),de(R,w.globeMatrix,R)}(l,i);return function(_,w,T){const E=(F,G,H)=>{const K=Be(F),ie=Be(G),ne=Zu(F,G,H);return Pn(ne,ne,1/Be(ne)*gn(K,ie,H))},C=E([_[0],_[1],_[2]],[w[0],w[1],w[2]],T),R=E([_[4],_[5],_[6]],[w[4],w[5],w[6]],T),M=E([_[8],_[9],_[10]],[w[8],w[9],w[10]],T),z=Zu([_[12],_[13],_[14]],[w[12],w[13],w[14]],T);return[C[0],C[1],C[2],0,R[0],R[1],R[2],0,M[0],M[1],M[2],0,z[0],z[1],z[2],1]}(d,g,u)}return d}function IM(l,i,s,u){const d=ti.projectAabbCorners(u,s);let g=Number.MAX_VALUE,_=-1;for(let E=0;E<d.length;++E){const C=d[E];C[0]=(.5*C[0]+.5)*i.width,C[1]=(.5-.5*C[1])*i.height,C[2]<g&&(_=E,g=C[2])}const w=E=>new bt(d[E][0],d[E][1]);let T;switch(_){case 0:case 6:T=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:T=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:T=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:T=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(Qi(l,T))return g}const Bf=64,km={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function SM(l,i,s,u,d,g,_,w,T,E=!1){const C=s.zoom,R=s.project(u),M=Ee(u.lat,C),z=1/M;me(l),ge(l,l,[R.x+_[0]*z,R.y+_[1]*z,_[2]]);let F=1,G=1;const H=s.worldSize;if(E){if(s.projection.name==="mercator"){let se=0;s.elevation&&(se=s.elevation.getAtPointOrZero(new ve(R.x/H,R.y/H),0));const Se=Es([],[R.x,R.y,se,1],s.projMatrix)[3]/s.cameraToCenterDistance;F=Se,G=Se*Ee(s.center.lat,C)}else if(s.projection.name==="globe"){const se=lI(l,s),Se=[0,0,0,1];Es(Se,Se,de([],s.projMatrix,se));const we=Se[3]/s.cameraToCenterDistance,Te=sd(C),Oe=s.projection.pixelsPerMeter(u.lat,H)*Ee(u.lat,C),Ne=s.projection.pixelsPerMeter(s.center.lat,H)*Ee(s.center.lat,C);F=we/gn(Oe,be(s.center.lat),Te),G=we*M/Oe,F*=Ne,G*=Ne}}else F=z;Re(l,l,[F,F,G]);const K=[...l],ie=i.orientation,ne=[];if(EM(ne,[ie[0]+d[0],ie[1]+d[1],ie[2]+d[2]],g),de(l,K,ne),w&&s.elevation){let se=0;const Se=[];if(T&&s.elevation){se=function(Te,Oe,Ne,at,He){const ht=Oe.elevation;if(!ht)return 0;const Mt=ti.projectAabbCorners(Ne,at),gt=Z(1,He.lat)*Oe.worldSize,It=function(Ct,Jt){const Wt=[0,0,1],Vt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Zt of Vt){const Tn=Ct[Zt.corners[0]],kn=Ct[Zt.corners[1]],Un=Ct[Zt.corners[2]],On=[kn[0]-Tn[0],kn[1]-Tn[1],Jt*(kn[2]-Tn[2])],li=ar(On,On,[Un[0]-Tn[0],Un[1]-Tn[1],Jt*(Un[2]-Tn[2])]);qn(li,li),Zt.dotProductWithUp=zi(li,Wt)}return Vt.sort((Zt,Tn)=>Zt.dotProductWithUp-Tn.dotProductWithUp),Vt[0].corners}(Mt,gt),Rt=Mt[It[0]],st=Mt[It[1]],St=Mt[It[2]],qe=Mt[It[3]],ot=ht.getAtPointOrZero(new ve(Rt[0]/Oe.worldSize,Rt[1]/Oe.worldSize),0),zt=ht.getAtPointOrZero(new ve(st[0]/Oe.worldSize,st[1]/Oe.worldSize),0),At=ht.getAtPointOrZero(new ve(St[0]/Oe.worldSize,St[1]/Oe.worldSize),0),ln=ht.getAtPointOrZero(new ve(qe[0]/Oe.worldSize,qe[1]/Oe.worldSize),0),Kt=(ot+ln)/2,Tt=(zt+At)/2;return Kt>Tt?zt<At?xw(Te,st,qe,Rt,zt,ln,ot,gt):xw(Te,St,Rt,qe,At,ot,ln,gt):ot<ln?xw(Te,Rt,st,St,ot,zt,At,gt):xw(Te,qe,St,st,ln,At,zt,gt),Math.max(Kt,Tt)}(Se,s,i.aabb,l,u);const we=de([],ke([],Se),ne);de(l,K,we)}else se=s.elevation.getAtPointOrZero(new ve(R.x/H,R.y/H),0);se!==0&&(l[14]+=se)}}function Ly(l,i,s=!1){l.uploaded||(l.gfxTexture=new oI(i,l.image,s?i.gl.R8:i.gl.RGBA8,{useMipmap:l.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function xG(l,i,s){l.indexBuffer=i.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=i.createVertexBuffer(l.vertexArray,fG.members,!1,!0),l.normalArray&&(l.normalBuffer=i.createVertexBuffer(l.normalArray,_G.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=i.createVertexBuffer(l.texcoordArray,gG.members,!1,!0)),l.colorArray&&(l.colorBuffer=i.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?pG:mG).members,!1,!0)),l.featureArray&&(l.pbrBuffer=i.createVertexBuffer(l.featureArray,vG.members,!0)),l.segments=Cr.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const u=l.material;u.pbrMetallicRoughness.baseColorTexture&&Ly(u.pbrMetallicRoughness.baseColorTexture,i),u.pbrMetallicRoughness.metallicRoughnessTexture&&Ly(u.pbrMetallicRoughness.metallicRoughnessTexture,i),u.normalTexture&&Ly(u.normalTexture,i),u.occlusionTexture&&Ly(u.occlusionTexture,i,s),u.emissionTexture&&Ly(u.emissionTexture,i)}function cI(l,i,s){if(l.meshes)for(const u of l.meshes)xG(u,i,s);if(l.children)for(const u of l.children)cI(u,i,s)}function ww(l){if(l.meshes)for(const i of l.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(l.children)for(const i of l.children)ww(i)}function uI(l){if(l.meshes)for(const s of l.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((i=s.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(l.children)for(const s of l.children)uI(s)}function Vf(l,i){const s=l.json.bufferViews[i.bufferView],u=_w[i.componentType];return new u(l.buffers[s.buffer],(i.byteOffset||0)+(s.byteOffset||0),i.count*(s.byteStride&&s.byteStride!==My[i.type]*u.BYTES_PER_ELEMENT?s.byteStride/u.BYTES_PER_ELEMENT:My[i.type]))}function hI(l,i,s,u){const d=_w[i.componentType],g=function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),_=l.json.bufferViews[i.bufferView],w=_.byteStride?_.byteStride/d.BYTES_PER_ELEMENT:My[i.type],T=s.float32,E=T.length/s.capacity;for(let C=0,R=0;C<i.count*w;C+=w,R+=E)for(let M=0;M<E;M++)T[R+M]=u[C+M]*g;s._trim()}function wG(l,i,s){const u=l.indices,d=l.attributes,g={};g.indexArray=new yr;const _=i.json.accessors[u],w=_.count/3;g.indexArray.reserve(w);const T=Vf(i,_);for(let M=0;M<w;M++)g.indexArray.emplaceBack(T[3*M],T[3*M+1],T[3*M+2]);g.indexArray._trim(),g.vertexArray=new Ra;const E=i.json.accessors[d.POSITION];g.vertexArray.reserve(E.count);const C=Vf(i,E);for(let M=0;M<E.count;M++)g.vertexArray.emplaceBack(C[3*M],C[3*M+1],C[3*M+2]);if(g.vertexArray._trim(),g.aabb=new ti(E.min,E.max),g.centroid=function(M,z){const F=[0,0,0],G=M.length;if(G>0){for(let H=0;H<G;H++){const K=3*M[H];F[0]+=z[K],F[1]+=z[K+1],F[2]+=z[K+2]}F[0]/=G,F[1]/=G,F[2]/=G}return F}(T,C),d.COLOR_0!==void 0){const M=i.json.accessors[d.COLOR_0],z=My[M.type],F=Vf(i,M);g.colorArray=z===3?new Ra:new ru,g.colorArray.resize(M.count),hI(i,M,g.colorArray,F)}if(d.NORMAL!==void 0){g.normalArray=new Ra;const M=i.json.accessors[d.NORMAL];g.normalArray.resize(M.count);const z=Vf(i,M);hI(i,M,g.normalArray,z)}if(d.TEXCOORD_0!==void 0&&s.length>0){g.texcoordArray=new su;const M=i.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(M.count);const z=Vf(i,M);hI(i,M,g.texcoordArray,z)}if(d._FEATURE_ID_RGBA4444!==void 0){const M=i.json.accessors[d._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Vf(i,M))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Vf(i,i.json.accessors[d._FEATURE_RGBA4444]).buffer));const R=l.material;return g.material=function(M,z){const{emissiveFactor:F=[0,0,0],alphaMode:G="OPAQUE",alphaCutoff:H=.5,normalTexture:K,occlusionTexture:ie,emissiveTexture:ne,doubleSided:se}=M,{baseColorFactor:Se=[1,1,1,1],metallicFactor:we=1,roughnessFactor:Te=1,baseColorTexture:Oe,metallicRoughnessTexture:Ne}=M.pbrMetallicRoughness||{},at=ie?z[ie.index]:void 0;if(ie&&ie.extensions&&ie.extensions.KHR_texture_transform&&at){const He=ie.extensions.KHR_texture_transform;at.offsetScale=[He.offset[0],He.offset[1],He.scale[0],He.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new wi(...Se),metallicFactor:we,roughnessFactor:Te,baseColorTexture:Oe?z[Oe.index]:void 0,metallicRoughnessTexture:Ne?z[Ne.index]:void 0},doubleSided:se,emissiveFactor:new wi(...F),alphaMode:G,alphaCutoff:H,normalTexture:K?z[K.index]:void 0,occlusionTexture:at,emissionTexture:ne?z[ne.index]:void 0,defined:M.defined===void 0}}(R!==void 0?i.json.materials[R]:{defined:!1},s),g}function AM(l,i,s){const{matrix:u,rotation:d,translation:g,scale:_,mesh:w,extras:T,children:E}=l,C={};if(C.matrix=u||function(R,M,z,F){var G=M[0],H=M[1],K=M[2],ie=M[3],ne=G+G,se=H+H,Se=K+K,we=G*ne,Te=G*se,Oe=G*Se,Ne=H*se,at=H*Se,He=K*Se,ht=ie*ne,Mt=ie*se,gt=ie*Se,It=F[0],Rt=F[1],st=F[2];return R[0]=(1-(Ne+He))*It,R[1]=(Te+gt)*It,R[2]=(Oe-Mt)*It,R[3]=0,R[4]=(Te-gt)*Rt,R[5]=(1-(we+He))*Rt,R[6]=(at+ht)*Rt,R[7]=0,R[8]=(Oe+Mt)*st,R[9]=(at-ht)*st,R[10]=(1-(we+Ne))*st,R[11]=0,R[12]=z[0],R[13]=z[1],R[14]=z[2],R[15]=1,R}([],d||[0,0,0,1],g||[0,0,0],_||[1,1,1]),w!==void 0){C.meshes=s[w];const R=C.anchor=[0,0];for(const M of C.meshes){const{min:z,max:F}=M.aabb;R[0]+=z[0]+F[0],R[1]+=z[1]+F[1]}R[0]=Math.floor(R[0]/C.meshes.length/2),R[1]=Math.floor(R[1]/C.meshes.length/2)}if(T&&(T.id&&(C.id=T.id),T.lights&&(C.lights=function(R){if(!R.length)return[];const M=function(K){const ie=atob(K),ne=new Uint8Array(ie.length);for(let se=0;se<ie.length;se++)ne[se]=ie.codePointAt(se);return ne}(R),z=[],F=M.length/24,G=new Uint16Array(M.buffer),H=new Float32Array(M.buffer);for(let K=0;K<F;K++){const ie=G[2*K*6]/30,ne=G[2*K*6+1]/30,se=G[2*K*6+10]/100,Se=H[6*K+1],we=H[6*K+2],Te=H[6*K+3],Oe=H[6*K+4],Ne=Te-Se,at=Oe-we,He=Math.hypot(Ne,at);z.push({pos:[Se+.5*Ne,we+.5*at,ne],normal:[at/He,-Ne/He,0],width:He,height:ie,depth:se,points:[Se,we,Te,Oe]})}return z}(T.lights))),E){const R=[];for(const M of E)R.push(AM(i.json.nodes[M],i,s));C.children=R}return C}function bG(l){if(l.vertices.length===0||l.indices.length===0)return null;const i=new cw(l.vertices,l.indices,8,256),[s,u]=[i.min.clone(),i.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:i,min:s,max:u}}function TG(l){if(!l.extras||!l.extras.ground)return null;const i=l.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const s=i[0];if(!s||!Array.isArray(s)||s.length===0)return null;const u=[];for(const _ of s){if(!Array.isArray(_)||_.length!==2)continue;const w=_[0],T=_[1];typeof w=="number"&&typeof T=="number"&&u.push(new bt(w,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let _=0;_<u.length;_++){const w=u[_],T=u[(_+1)%u.length],E=u[(_+2)%u.length];d+=(w.x-T.x)*(E.y-T.y)-(E.x-T.x)*(w.y-T.y)}d>0&&u.reverse();const g=Im(u.flatMap(_=>[_.x,_.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function EG(l,i){const s=[],u=[];let d=0;const g=[];for(const _ of l){d=s.length;const w=_.vertexArray.float32,T=_.indexArray.uint16;for(let E=0;E<_.vertexArray.length;E++)g[0]=w[3*E+0],g[1]=w[3*E+1],g[2]=w[3*E+2],Wi(g,g,i),s.push(new bt(g[0],g[1]));for(let E=0;E<3*_.indexArray.length;E++)u.push(T[E]+d)}if(u.length%3!=0)return null;for(let _=0;_<u.length;_+=3){const w=s[u[_+0]],T=s[u[_+1]],E=s[u[_+2]];(w.x-T.x)*(E.y-T.y)-(E.x-T.x)*(w.y-T.y)>0&&([u[_+1],u[_+2]]=[u[_+2],u[_+1]])}return{vertices:s,indices:u}}function CM(l){const i=function(T,E){const C=[],R=WebGL2RenderingContext;if(T.json.textures)for(const M of T.json.textures){const z={magFilter:R.LINEAR,minFilter:R.NEAREST,wrapS:R.REPEAT,wrapT:R.REPEAT};M.sampler!==void 0&&Object.assign(z,T.json.samplers[M.sampler]),C.push({image:E[M.source],sampler:z,uploaded:!1})}return C}(l,l.images),s=function(T,E){const C=[];for(const R of T.json.meshes){const M=[];for(const z of R.primitives)M.push(wG(z,T,E));C.push(M)}return C}(l,i),{scenes:u,scene:d,nodes:g}=l.json,_=u?u[d||0].nodes:g,w=[];for(const T of _)w.push(AM(g[T],l,s));return function(T,E,C){const R={},M=new Set;for(let z=0;z<T.length;z++){const F=C[E[z]];if(!F.extras)continue;const G=F.extras["mapbox:footprint:version"],H=F.extras["mapbox:footprint:id"];(G||H)&&M.add(z),G==="1.0.0"&&H&&(R[H]=z)}for(let z=0;z<T.length;z++){if(M.has(z))continue;const F=T[z],G=C[E[z]];if(!G.extras)continue;let H=null;F.id in R&&(H=EG(T[R[F.id]].meshes,F.matrix)),H||(H=TG(G)),H&&(F.footprint=bG(H))}if(M.size>0){const z=Array.from(M.values()).sort((F,G)=>F-G);for(let F=z.length-1;F>=0;F--)T.splice(z[F],1)}}(w,_,l.json.nodes),w}function IG(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const i=l.vertexArray.float32,s=l.aabb.min[0]-1,u=l.aabb.min[1]-1,d=Bf/(l.aabb.max[0]-s+2),g=Bf/(l.aabb.max[1]-u+2);for(let _=0;_<i.length;_+=3){const w=i[_+2],T=(i[_+0]-s)*d|0,E=(i[_+1]-u)*g|0;w>l.heightmap[E*Bf+T]&&(l.heightmap[E*Bf+T]=w)}}function PM(l,i,s,u,d){s.reserve(s.length+4*l.length),u.reserve(u.length+10*l.length),d.reserve(d.length+10*l.length);let g=u.length;for(const _ of l){const w=Math.min(10,Math.max(4,1.3*_.height))*i,T=[-_.normal[1],_.normal[0],0],E=Math.min(.29,.1*_.width/_.depth),C=_.width-2*_.depth*i*(E+.01),R=oi([],_.pos,T,C/2),M=oi([],_.pos,T,-C/2),z=[R[0],R[1],R[2]+_.height],F=[M[0],M[1],M[2]+_.height],G=oi([],_.normal,T,E);Pn(G,G,w);const H=oi([],_.normal,T,-E);Pn(H,H,w),ii(G,R,G),ii(H,M,H),R[2]+=.1,M[2]+=.1,u.emplaceBack(G[0],G[1],G[2]),u.emplaceBack(H[0],H[1],H[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(M[0],M[1],M[2]),u.emplaceBack(z[0],z[1],z[2]),u.emplaceBack(F[0],F[1],F[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(M[0],M[1],M[2]),u.emplaceBack(G[0],G[1],G[2]),u.emplaceBack(H[0],H[1],H[2]);const K=C/w/2;d.emplaceBack(-K-E,-1,K,.8),d.emplaceBack(K+E,-1,K,.8),d.emplaceBack(-K,0,K,1.3),d.emplaceBack(K,0,K,1.3),d.emplaceBack(K+E,-.8,K,.7),d.emplaceBack(K+E,-.8,K,.7),d.emplaceBack(0,0,K,1.3),d.emplaceBack(0,0,K,1.3),d.emplaceBack(K+E,-1.2,K,.8),d.emplaceBack(K+E,-1.2,K,.8),s.emplaceBack(6+g,4+g,8+g),s.emplaceBack(7+g,9+g,5+g),s.emplaceBack(0+g,1+g,2+g),s.emplaceBack(1+g,3+g,2+g),g+=10}}function SG(l,i){const s={};s.indexArray=new yr,s.vertexArray=new Ra,s.colorArray=new ru,PM(l,i,s.indexArray,s.vertexArray,s.colorArray);const u={defined:!0};u.emissiveFactor=wi.black;const d={};return d.baseColorFactor=wi.white,u.pbrMetallicRoughness=d,s.material=u,s.aabb=new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}const RM=di([{name:"a_pos_3f",components:3,type:"Float32"}]),AG=di([{name:"a_normal_3",components:3,type:"Int16"}]),kM=di([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),CG=di([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),MM=Ke.types,dI=32767;function PG(l,i){const s=Bt+i;for(const u of l)for(const d of u)if(d.x<-i||d.x>s||d.y<-i||d.y>s)return!1;return!0}class DM{constructor(i){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.layoutVertexArray=new Ra,this.layoutNormalArray=new Wh,this.layoutColorArray=new Hl,this.indexArray=new yr,this.indexArrayForConflation=new yr,this.entranceBloom={layoutVertexArray:new Ra,layoutVertexBuffer:null,layoutAttenuationArray:new ru,layoutAttenuationBuffer:null,layoutColorArray:new Hl,layoutColorBuffer:null,indexArray:new yr,indexArrayForConflation:new yr,indexBuffer:null,segmentsBucket:new Cr},this.programConfigurations=new Ma(i.layers,{zoom:i.zoom,lut:i.lut}),this.segmentsBucket=new Cr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection,this.groundEffect=new YE(i)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(i,s){for(const u of this.footprints)s.push({footprint:u,id:i})}prepare(){return function(){if(gw!=null||dM!=null)return null;if(Rm!=null)return Rm;const i=fetch(ye.BUILDING_GEN_URL);return Rm=function(s){let u,d,g,_;function w(){u=new Uint8Array(_.buffer),d=new Int32Array(_.buffer),g=new Float32Array(_.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const E=()=>{},C={a:{a:T,f:function(R){const M=u.length,z=Math.max(R>>>0,Math.ceil(1.2*M)),F=Math.ceil((z-M)/65536);try{return _.grow(F),w(),!0}catch{return!1}},g:T,b:E,c:E,d:E,e:E}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,C):s.then(R=>R.arrayBuffer()).then(R=>WebAssembly.instantiate(R,C))).then(R=>{const M=R.instance.exports;return(0,M.g)(),_=M.f,w(),new oG({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setStructuralOptions:M.k,setFacadeOptions:M.l,setFauxFacadeOptions:M.m,setFacadeClassifierOptions:M.n,addFeature:M.o,addFacade:M.p,generateMesh:M.q,getLastError:M.r,getMeshCount:M.s,getPositionsPtr:M.t,getPositionsLength:M.u,getNormalsPtr:M.v,getNormalsLength:M.w,getColorsPtr:M.x,getColorsLength:M.y,getAOPtr:M.z,getAOLength:M.A,getUVPtr:M.B,getUVLength:M.C,getFauxFacadePtr:M.D,getFauxFacadeLength:M.E,getIndicesPtr:M.F,getIndicesLength:M.G,getBuildingPart:M.H,getRingCount:M.I,getRingPtr:M.J,getRingLength:M.K,free:M.L,malloc:M.M,heapU8:u,heap32:d,heapF32:g})})}(i).then(s=>(Rm=null,gw=s,gw)).catch(s=>{ni("Could not load building-gen"),Rm=null,dM=s}),Rm}()}populate(i,s,u,d){const g=aG();if(!g)return;const _=_e(u);this.tileToMeter=_,this.brightness=s.brightness,g.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(!1,!1,1),g.setFacadeClassifierOptions(3);const w=new Map;for(const{feature:T}of i){if(MM[T.type]!=="LineString")continue;const E=this.layers[0]._featureFilter.needGeometry,C=rt(T,E);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),C,u))continue;const R=E?C.geometry:Ce(T,u,d),M=[];for(const H of R)for(const K of H)M.push({x:K.x,y:K.y});const z={coordinates:M,crossPerc:T.properties.cross_perc,distanceToRoad:T.properties.distance_to_road,entrances:T.properties.entrances,sourceId:0},F=T.properties.source_id;let G=w.get(F);G||(G=[],w.set(F,G)),G.push(z)}this.maxHeight=0;for(const{feature:T,index:E}of i){if(MM[T.type]==="LineString")continue;const C=this.layers[0]._featureFilter.needGeometry,R=rt(T,C);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),R,u))continue;const M=C?R.geometry:Ce(T,u,d),z=Ty(M,500);if(!PG(M,163))continue;const F=this.layers[0],G=F.layout.get("building-base").evaluate(T,{},u),H=F.layout.get("building-height").evaluate(T,{},u),K=F.layout.get("building-roof-shape").evaluate(T,{},u),ie=F.paint.get("building-ambient-occlusion-intensity"),ne=F.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(K==="flat")continue;const se=T.properties.source_id;let Se;Se=w.has(se)?w.get(se):[];const we=[],Te=new bt(1/0,1/0),Oe=new bt(-1/0,-1/0);for(const Tt of z)if(Tt.length>0){const Ct=[];for(const Jt of Tt){const Wt=[];for(let Vt=Jt.length-1;Vt>=0;Vt--){const Zt=Jt[Vt];Wt.push({x:Zt.x,y:Zt.y}),Te.x=Math.min(Te.x,Zt.x),Te.y=Math.min(Te.y,Zt.y),Oe.x=Math.max(Oe.x,Zt.x),Oe.y=Math.max(Oe.y,Zt.y)}Ct.push(Wt)}we.push({id:T.id,height:H,minHeight:G,sourceId:0,roofType:K,coordinates:Ct})}const Ne=g.generateMesh(we,Se);if(typeof Ne=="string"||Ne.meshes.length===0||Ne.modifiedPolygonRings.length===0)continue;let at=0;for(const Tt of Ne.meshes)at+=Tt.positions.length/3;const He=this.segmentsBucket.prepareSegment(at,this.layoutVertexArray,this.indexArray),ht=[];let Mt=null,gt=0,It=-1;const Rt=this.indexArray.length;let st=0;for(const Tt of Ne.meshes){const Ct=this.layoutVertexArray.length;if(Tt.buildingPart==="entrance"){const Wt=new Array;for(let kn=0;kn<Tt.indices.length;kn+=12){const Un=Tt.positions[kn+0],On=Tt.positions[kn+1],li=Tt.positions[kn+3],Yn=Tt.positions[kn+4],hr=Tt.positions[kn+2],ce=Tt.positions[kn+8]-hr,ue=1,it=li-Un,Ft=Yn-On,Gt=Math.hypot(it,Ft);Wt.push({pos:[Un+.5*it,On+.5*Ft,hr],normal:[Ft/Gt,-it/Gt,0],width:Gt,height:ce,depth:ue,points:[Un,On,li,Yn]})}const Vt=this.entranceBloom.segmentsBucket.prepareSegment(10*Wt.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),Zt=this.entranceBloom.layoutVertexArray.length;gt=this.entranceBloom.indexArray.length,PM(Wt,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const Tn=this.entranceBloom.layoutVertexArray.length-Zt;It=this.entranceBloom.indexArray.length-gt;for(let kn=0;kn<Tn;kn++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Vt.vertexLength+=Tn,Vt.primitiveLength+=It,Mt={part:Tt.buildingPart,vertexOffset:Zt,vertexLength:Tn}}for(let Wt=0;Wt<Tt.positions.length;Wt+=3)st=Math.max(st,Tt.positions[Wt+2]),this.layoutVertexArray.emplaceBack(Tt.positions[Wt],Tt.positions[Wt+1],Tt.positions[Wt+2]);for(let Wt=0;Wt<Tt.normals.length;Wt+=3)this.layoutNormalArray.emplaceBack(Tt.normals[Wt+0]*dI,Tt.normals[Wt+1]*dI,Tt.normals[Wt+2]*dI);for(let Wt=0;Wt<Tt.ao.length;Wt++)this.layoutAOArray.push(Tt.ao[Wt]);for(let Wt=0;Wt<Tt.colors.length;Wt+=3){const Vt=1+(Tt.ao[Wt/3]-1)*ie;this.layoutColorArray.emplaceBack(Tt.colors[Wt]*Vt<<8|Tt.colors[Wt+1]*Vt,Tt.colors[Wt+2]*Vt<<8)}const Jt=He.vertexLength;for(let Wt=0;Wt<Tt.indices.length;Wt+=3)this.indexArray.emplaceBack(Jt+Tt.indices[Wt],Jt+Tt.indices[Wt+1],Jt+Tt.indices[Wt+2]);He.vertexLength+=Tt.positions.length/3,He.primitiveLength+=Tt.indices.length/3,(Tt.buildingPart==="roof"||Tt.buildingPart==="wall"||Tt.buildingPart==="facade_glazing"||Tt.buildingPart==="entrance")&&ht.push({part:Tt.buildingPart,vertexOffset:Ct,vertexLength:Tt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,st),this.buildingFeatures.push({feature:R,segment:He,parts:ht,buildingBloom:Mt});const St=this.indexArray.length-Rt,qe=[],ot=[],zt=new bt(1/0,1/0),At=new bt(-1/0,-1/0),ln=this.groundEffect.vertexArray.length;for(const Tt of Ne.modifiedPolygonRings){const Ct=[],Jt=new bt(1/0,1/0),Wt=new bt(-1/0,-1/0);for(let Vt=0;Vt<Tt.length;Vt+=2){const Zt=Tt.length-Vt-2;Jt.x=Math.min(Jt.x,Tt[Zt]),Jt.y=Math.min(Jt.y,Tt[Zt+1]),Wt.x=Math.max(Wt.x,Tt[Zt]),Wt.y=Math.max(Wt.y,Tt[Zt+1]);const Tn=new bt(Tt[Zt],Tt[Zt+1]);Ct.push(Tn),qe.push(Tn.x,Tn.y),ot.push(Tn.clone())}zt.x=Math.min(zt.x,Jt.x),zt.y=Math.min(zt.y,Jt.y),At.x=Math.max(At.x,Wt.x),At.y=Math.max(At.y,Wt.y),this.groundEffect.addData(Ct,[Jt,Wt],ne)}const Kt=this.groundEffect.vertexArray.length-ln;(Te.x<0||Oe.x>Bt||Te.y<0||Oe.y>Bt)&&this.featuresOnBorder.push({featureId:T.id,footprintIndex:this.footprints.length});{const Tt=Im(qe,null,2),Ct=new cw(ot,Tt,8,256);let Jt=T.id;T.properties&&T.properties.hasOwnProperty("building_id")&&(Jt=T.properties.building_id),this.footprints.push({vertices:ot,indices:Tt,grid:Ct,min:zt,max:At,buildingId:Jt,hiddenFlags:0,indicesOffset:Rt,indicesLength:St,bloomIndicesOffset:gt,bloomIndicesLength:It,groundEffectVertexOffset:ln,groundEffectVertexLength:Kt,segment:He,height:st})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,T,E,{},s.availableImages,u,s.brightness),this.groundEffect.addPaintPropertiesData(T,E,{},s.availableImages,u,s.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(i,s,u,d,g,_,w){this.programConfigurations.updatePaintArrays(i,s,g,u,d,_,w),this.groundEffect.update(i,s,g,u,d,_,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,RM.members),this.layoutNormalBuffer=i.createVertexBuffer(this.layoutNormalArray,AG.members),this.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(this.entranceBloom.layoutVertexArray,RM.members),this.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,CG.members),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(i,s,u=!0){let d=!1;const g=u?s:0,_=0|(u?-1:~s);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of i){const T=this.footprints[w],E=T.hiddenFlags&_|g;T.hiddenFlags!==E&&(T.hiddenFlags=E,d=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const s of this.footprints){const u=s.indicesOffset+s.indicesLength;if(s.hiddenFlags!==0){for(let g=s.indicesOffset;g<u;g++)this.indexArrayForConflation.uint16[3*g+0]=0,this.indexArrayForConflation.uint16[3*g+1]=0,this.indexArrayForConflation.uint16[3*g+2]=0;const d=s.bloomIndicesOffset+s.bloomIndicesLength;for(let g=s.bloomIndicesOffset;g<d;g++)this.entranceBloom.indexArrayForConflation.uint16[3*g+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*g+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*g+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=i.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=i.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(i){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=i.createVertexBuffer(this.layoutColorArray,kM.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=i.createVertexBuffer(this.entranceBloom.layoutColorArray,kM.members,!0)}evaluate(i){const s=i.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const d=u.feature;d.properties["building-part"]="roof";const g=i.paint.get("building-color").evaluate(d,{},this.canonical),_=i.paint.get("building-emissive-strength").evaluate(d,{},this.canonical);d.properties["building-part"]="wall";const w=i.paint.get("building-color").evaluate(d,{},this.canonical),T=i.paint.get("building-emissive-strength").evaluate(d,{},this.canonical);d.properties["building-part"]="window";const E=i.paint.get("building-color").evaluate(d,{},this.canonical),C=i.paint.get("building-emissive-strength").evaluate(d,{},this.canonical);d.properties["building-part"]="door";const R=i.paint.get("building-color").evaluate(d,{},this.canonical),M=i.paint.get("building-emissive-strength").evaluate(d,{},this.canonical);for(const F of u.parts){let G,H=g;F.part==="roof"?(H=g,G=_):F.part==="wall"?(H=w,G=T):F.part==="facade_glazing"?(H=E,G=C):F.part==="entrance"&&(H=R,G=M),G=he(G,0,1);for(let K=0;K<F.vertexLength;K++){const ie=F.vertexOffset+K,ne=1+(this.layoutAOArray[ie]-1)*s;this.layoutColorArray.emplace(ie,H.r*ne*255<<8|H.g*ne*255,H.b*ne*255<<8|255*G)}}const z=u.buildingBloom;if(z)for(let F=0;F<z.vertexLength;F++)this.bloomGeometry.layoutColorArray.emplace(z.vertexOffset+F,255*R.r<<8|255*R.g,255*R.b<<8|51*M)}}needsEvaluation(i,s){const u=i.transform.projectionOptions,d=i.style.getBrightness();return!(this.uploaded&&u.name===this.projection.name&&this.brightness===d||(this.projection=u,this.brightness=d,0))}updateReplacement(i,s,u){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const d=s.getReplacementRegionsForTile(i.toUnwrapped());if(hw(this.activeReplacements,d))return;this.activeReplacements=d;for(const _ of this.footprints)_.hiddenFlags&=-2;const g=[];for(const _ of this.activeReplacements){if(_.order<=Nk)continue;const w=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));for(const T of this.footprints)T.min.x>_.max.x||T.max.x<_.min.x||T.min.y>_.max.y||T.max.y<_.min.y||(g.length=0,RG(T.vertices,0,T.vertices.length,_.footprintTileId.canonical,i.canonical,g),WE(_.footprint,g,T.indices,0,T.indices.length,0,-w)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(i,s){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(i+Bt)*Bt+(s+Bt);if(this.footprintLookup.hasOwnProperty(g)){const w=this.footprintLookup[g];return w?{height:w.height,hidden:w.hiddenFlags!==0}:void 0}const _=new bt(i,s);for(const w of this.footprints)i>w.max.x||w.min.x>i||s>w.max.y||w.min.y>s||w.height<=u||ZE(_,w)&&(u=w.height,this.footprintLookup[g]=w,d=w.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.footprintLookup[g]=void 0}}function RG(l,i,s,u,d,g){const _=Math.pow(2,u.z-d.z);for(let w=0;w<s;w++){let T=l[w+i].x,E=l[w+i].y;T=(T+d.x*Bt)*_-u.x*Bt,E=(E+d.y*Bt)*_-u.y*Bt,g.push(new bt(T,E))}}let LM,OM;Xt(DM,"BuildingBucket",{omit:["layers"]});const kG=di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),MG=di([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:DG}=kG,LG=di([{name:"a_packed",components:3,type:"Float32"}]),{members:OG}=LG,zG=di([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:FG}=zG;class zM{constructor(i,s){this.width=i,this.height=s,this.nextRow=0,this.image=new od({width:i,height:s}),this.positions={},this.uploaded=!1}getDash(i,s){const u=this.getKey(i,s);return this.positions[u]}trim(){const i=this.width,s=this.height=sn(this.nextRow);this.image.resize({width:i,height:s})}getKey(i,s){return i.join(",")+s}getDashRanges(i,s,u){const d=[];let g=i.length%2==1?-i[i.length-1]*u:0,_=i[0]*u,w=!0;d.push({left:g,right:_,isDash:w,zeroLength:i[0]===0});let T=i[0];for(let E=1;E<i.length;E++){w=!w;const C=i[E];g=T*u,T+=C,_=T*u,d.push({left:g,right:_,isDash:w,zeroLength:C===0})}return d}addRoundDash(i,s,u){const d=s/2;for(let g=-u;g<=u;g++){const _=this.width*(this.nextRow+u+g);let w=0,T=i[w];for(let E=0;E<this.width;E++){E/T.right>1&&(T=i[++w]);const C=Math.abs(E-T.left),R=Math.abs(E-T.right),M=Math.min(C,R);let z;const F=g/u*(d+1);if(T.isDash){const G=d-Math.abs(F);z=Math.sqrt(M*M+G*G)}else z=d-Math.sqrt(M*M+F*F);this.image.data[_+E]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(i,s){for(let T=i.length-1;T>=0;--T){const E=i[T],C=i[T+1];E.zeroLength?i.splice(T,1):C&&C.isDash===E.isDash&&(C.left=E.left,i.splice(T,1))}const u=i[0],d=i[i.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const g=this.width*this.nextRow;let _=0,w=i[_];for(let T=0;T<this.width;T++){T/w.right>1&&(w=i[++_]);const E=Math.abs(T-w.left),C=Math.abs(T-w.right),R=Math.min(E,C);this.image.data[g+T]=Math.max(0,Math.min(255,(w.isDash?R:-R)+s+128))}}addDash(i,s){const u=this.getKey(i,s);if(this.positions[u])return this.positions[u];const d=s==="round",g=d?7:0,_=2*g+1;if(this.nextRow+_>this.height)return ni("LineAtlas out of space"),null;i.length===0&&i.push(1);let w=0;for(let C=0;C<i.length;C++)i[C]<0&&(ni("Negative value is found in line dasharray, replacing values with 0"),i[C]=0),w+=i[C];if(w!==0){const C=this.width/w,R=this.getDashRanges(i,this.width,C);d?this.addRoundDash(R,C,g):this.addRegularDash(R,s==="square"?.5*C:0)}const T=this.nextRow+g;this.nextRow+=_;const E={tl:[T,g],br:[w,0]};return this.positions[u]=E,E}}Xt(zM,"LineAtlas");const NG=Ke.types,BG=Math.cos(Math.PI/180*37.5),VG=Math.cos(Math.PI/180*5);class fI{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new mm,this.layoutVertexArray2=new Ra,this.patternVertexArray=new Ra,this.indexArray=new yr,this.programConfigurations=new Ma(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Cr,this.maxLineLength=0,this.zOffsetVertexArray=new Ra,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:Bt/64,this.worldview=i.worldview}updateFootprints(i,s){}populate(i,s,u,d){this.hasPattern=UE("line",this.layers,this.pixelRatio,s);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=_e(u);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),z=M.isConstant()&&!M.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&z?"none":"offset",this.elevationType==="offset"&&_==="none"&&ni(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const T=[];for(const{feature:M,id:z,index:F,sourceLayerIndex:G}of i){const H=this.layers[0]._featureFilter.needGeometry,K=rt(M,H);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom,{worldview:this.worldview}),K,u))continue;const ie=g?g.evaluate(K,{},u):void 0,ne={id:z,properties:M.properties,type:M.type,sourceLayerIndex:G,index:F,geometry:H?K.geometry:Ce(M,u,d),patterns:{},sortKey:ie};T.push(ne)}g&&T.sort((M,z)=>M.sortKey-z.sortKey);const{lineAtlas:E,featureIndex:C}=s,R=this.addConstantDashes(E);for(const M of T){const{geometry:z,index:F,sourceLayerIndex:G}=M;if(R&&this.addFeatureDashes(M,E),this.hasPattern){const H=jE("line",this.layers,M,this.zoom,this.pixelRatio,s);this.patternFeatures.push(H)}else this.addFeature(M,z,F,u,E.positions,s.availableImages,s.brightness,s.elevationFeatures);C.insert(i[F].feature,z,F,G,this.index)}}addConstantDashes(i){let s=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")s=!0;else{const _=g.value,w=d.value;if(!w)continue;i.addDash(w,_)}}return s}addFeatureDashes(i,s){const u=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let w,T;if(g.kind==="constant"){if(w=g.value,!w)continue}else w=g.evaluate({zoom:u},i);T=_.kind==="constant"?_.value:_.evaluate({zoom:u},i),s.addDash(w,T),i.patterns[d.id]=[s.getKey(w,T)]}}update(i,s,u,d,g,_,w,T){this.programConfigurations.updatePaintArrays(i,s,g,u,d,_,w,T)}addFeatures(i,s,u,d,g,_){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,s,u,d,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,OG)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,FG)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,MG.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,DG),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,u,d,g,_,w,T){const E=this.layers[0].layout,C=E.get("line-join").evaluate(i,{}),R=E.get("line-cap").evaluate(i,{}),M=E.get("line-miter-limit"),z=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=E.get("line-z-offset").value;const F=this.layers[0].paint.get("line-width").value;if(F.kind!=="constant"&&F.isLineProgressConstant===!1&&(this.variableWidthValue=F),this.elevationType==="road"){const G=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,s,d,T,C,R,M,z)){const[H,K]=this.clipRuntimeLinesToTile(s,1);for(let ie=0;ie<H.length;ie++){const ne=H[ie],se=K[ie],Se={progress:{min:se.progress.min,max:se.progress.max},nextDir:this.computeSegNextDir(se,ne),prevDir:this.computeSegPrevDir(se,ne)};this.addLine(ne,i,d,C,R,M,z,Se)}this.fillNonElevatedRoadSegment(G)}}else for(const G of s)this.addLine(G,i,d,C,R,M,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,g,_,d,w,void 0,this.worldview)}computeSegNextDir(i,s){return i.nextPoint.sub(s.at(-2)).unit()}computeSegPrevDir(i,s){return s[1].sub(i.prevPoint).unit()}clipLinesToTile(i,s){return pw(i,-s,-s,Bt+s,Bt+s)}clipRuntimeLinesToTile(i,s){const u=[];return[pw(i,-s,-s,Bt+s,Bt+s,u),u]}addElevatedRoadFeature(i,s,u,d,g,_,w,T){const E=[],C=Pr.getElevationFeature(i,d);if(C){const R=this.clipLinesToTile(s,1),M=this.prepareElevatedLines(R,C,u);for(const z of M)E.push({geometry:z,elevation:C,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(E.length===0)return!1;for(const R of E){const M=this.layoutVertexArray.length;this.addLine(R.geometry,i,u,g,_,w,T);const z=new xi(u,R.elevationTileID);if(R.elevation)for(let F=M;F<this.layoutVertexArray.length;F++){const G=new bt(this.layoutVertexArray.int16[6*F]>>1,this.layoutVertexArray.int16[6*F+1]>>1),H=z.pointElevation(G,R.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(i,s,u){if(s.constantHeight!=null)return i;const d=[],g=1/_e(u);for(const _ of i)iG(_,new $i(s,g),0,d);return d}fillNonElevatedRoadSegment(i){for(let s=i;s<this.layoutVertexArray.length;s++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,s,u,d,g,_,w,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const E=d==="none";this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=T&&T.progress.min>0,R=T&&T.progress.max<1;if(this.lineClips){let Oe={min:this.lineClips.start,max:this.lineClips.end},Ne=1;if(T){const ht=this.lineClips.end-this.lineClips.start;Oe=function(Mt,gt,It){return{min:fl(Mt.min,gt,It),max:fl(Mt.max,gt,It)}}(T.progress,{min:0,max:1},Oe),ht>0&&(Ne=(Oe.max-Oe.min)/ht)}const at=+s.properties.mapbox_clip_feature_len,He=+s.properties.mapbox_clip_seg_len;if(Number.isNaN(at)||Number.isNaN(He)){for(let Mt=0;Mt<i.length-1;Mt++)this.totalDistance+=i[Mt].dist(i[Mt+1]);const ht=this.totalDistance/(Oe.max-Oe.min);this.totalFeatureLength=Number.isFinite(ht)?ht:0,this.lineClips.start=Oe.min,this.lineClips.end=Oe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=at,this.distance=He*Ne,this.lineClips.start=Oe.min,this.lineClips.end=Oe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=NG[s.type]==="Polygon";let z=i.length;for(;z>=2&&i[z-1].equals(i[z-2]);)z--;let F=0;for(;F<z-1&&i[F].equals(i[F+1]);)F++;if(z<(M?3:2))return;d==="bevel"&&(_=1.05);const G=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let H,K,ie,ne,se,Se,we,Te;T&&T.prevDir&&(Se=T.prevDir.perp()),T&&T.nextDir&&(we=T.nextDir.perp()),this.e1=this.e2=-1,M&&(H=i[z-2],se=i[F].sub(H)._unit()._perp());for(let Oe=F;Oe<z;Oe++){if(ie=Oe===z-1?M?i[F+1]:void 0:i[Oe+1],ie&&i[Oe].equals(ie))continue;se&&(ne=se),H&&(K=H),H=i[Oe],Te=this.evaluateLineProgressFeatures(K?K.dist(H):0),se=ie?ie.sub(H)._unit()._perp():ne,ne=ne||se;const Ne=K&&ie;let at=Ne?d:M||E?"butt":g;const He=ne.x*se.x+ne.y*se.y;if(E){const qe=function(ot){if(ot.patternJoinNone){const zt=ot.segmentPoints.length/2,At=ot.lineSoFar-ot.segmentStart;for(let ln=0;ln<zt;++ln){const Kt=ot.segmentPoints[2*ln+1],Tt=Math.round(ot.segmentPoints[2*ln])+.5+.25*Kt;ot.patternVertexArray.emplaceBack(Tt,At,ot.segmentStart),ot.patternVertexArray.emplaceBack(Tt,At,ot.segmentStart)}ot.segmentPoints.length=0}ot.e1=ot.e2=-1};if(Ne&&He<VG){this.updateDistance(K,H),this.addCurrentVertex(H,ne,1,1,G,Te),qe(this),this.addCurrentVertex(H,se,-1,-1,G,Te);continue}if(K){if(!ie){this.updateDistance(K,H),this.addCurrentVertex(H,ne,1,1,G,Te),qe(this);continue}at="miter"}}let ht=ne.add(se);ht.x===0&&ht.y===0||ht._unit();const Mt=ht.x*se.x+ht.y*se.y,gt=Mt!==0?1/Mt:1/0,It=2*Math.sqrt(2-2*Mt),Rt=Mt<BG&&K&&ie,st=ne.x*se.y-ne.y*se.x>0,St=this.overscaling<=16?15*Bt/(512*this.overscaling):0;if(Ne&&at==="round"){if(gt<w)at="miter";else if(gt<=2){const qe=pI(H,-10,Bt+10);at=this.elevationType==="offset"&&(qe||this.hasCrossSlope)?"miter":"fakeround"}}if(at==="miter"&&gt>_&&(at="bevel"),at==="bevel"&&(gt>2&&(at="flipbevel"),gt<_&&(at="miter")),K&&!(at==="miter"&&Rt)&&this.updateDistance(K,H),at==="miter")if(Rt){const qe=H.dist(K);if(qe>2*St){const zt=H.sub(H.sub(K)._mult(St/qe)._round());this.updateDistance(K,zt),this.addCurrentVertex(zt,ne,0,0,G,Te),K=zt}this.updateDistance(K,H),ht._mult(gt),this.addCurrentVertex(H,ht,0,0,G,Te);const ot=H.dist(ie);if(ot>2*St){const zt=H.add(ie.sub(H)._mult(St/ot)._round());this.updateDistance(H,zt),this.addCurrentVertex(zt,se,0,0,G,Te),H=zt}}else ht._mult(gt),this.addCurrentVertex(H,ht,0,0,G,Te);else if(at==="flipbevel"){if(gt>100)ht=se.mult(-1);else{const qe=gt*ne.add(se).mag()/ne.sub(se).mag();ht._perp()._mult(qe*(st?-1:1))}this.addCurrentVertex(H,ht,0,0,G,Te),this.addCurrentVertex(H,ht.mult(-1),0,0,G,Te)}else if(at==="bevel"||at==="fakeround"){Te!=null&&K&&this.addCurrentVertex(H,we||ne,-1,-1,G,Te);const qe=H.dist(K)<=2*St&&at!=="bevel",ot=ht.mult(st?1:-1);ot._mult(gt);const zt=se.mult(st?-1:1),At=ne.mult(st?-1:1),ln=this.evaluateLineProgressFeatures(this.distance);if(Te==null&&(this.addHalfVertex(H,ot.x,ot.y,!1,!st,0,G,ln),qe||this.addHalfVertex(H,ot.x+2*At.x,ot.y+2*At.y,!1,st,0,G,ln)),at==="fakeround"){const Kt=Math.round(180*It/Math.PI/20);this.addHalfVertex(H,At.x,At.y,!1,st,0,G,ln);for(let Tt=0;Tt<Kt;Tt++){let Ct=Tt/Kt;if(Ct!==.5){const Wt=Ct-.5;Ct+=Ct*Wt*(Ct-1)*((1.0904+He*(He*(3.55645-1.43519*He)-3.2452))*Wt*Wt+(.848013+He*(.215638*He-1.06021)))}const Jt=zt.sub(At)._mult(Ct)._add(At)._unit();this.addHalfVertex(H,Jt.x,Jt.y,!1,st,0,G,ln)}this.addHalfVertex(H,zt.x,zt.y,!1,st,0,G,ln)}qe||Te!=null||this.addHalfVertex(H,ot.x+2*zt.x,ot.y+2*zt.y,!1,st,0,G,ln),Te!=null&&ie&&this.addCurrentVertex(H,Se||se,1,1,G,Te)}else if(at==="butt")this.addCurrentVertex(H,ht,0,0,G,Te);else if(at==="square"){if(!K){const qe=C?0:-1;this.addCurrentVertex(H,ht,qe,qe,G,Te)}if(this.addCurrentVertex(H,ht,0,0,G,Te),K){const qe=R?0:1;this.addCurrentVertex(H,ht,qe,qe,G,Te)}}else if(at==="round"){if(K){const qe=!Ne&&we?we:ne;this.addCurrentVertex(H,qe,0,0,G,Te),!Ne&&R||this.addCurrentVertex(H,qe,1,1,G,Te,!0)}if(ie){const qe=!Ne&&Se?Se:se;!Ne&&C||this.addCurrentVertex(H,qe,-1,-1,G,Te,!0),this.addCurrentVertex(H,qe,0,0,G,Te)}}}}addVerticesTo(i,s,u,d,g,_,w,T,E,C){const R=(s.w-i.w)/this.tessellationStep|0;let M=0;const z=this.scaledDistance;if(R>1){this.lineSoFar=i.w;const G=(s.x-i.x)/R,H=(s.y-i.y)/R,K=(s.z-i.z)/R,ie=(s.w-i.w)/R;for(let ne=1;ne<R;++ne){i.x+=G,i.y+=H,i.z+=K,this.lineSoFar+=ie,M+=ie;const se=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(i,u,d,C,!1,w,E,se),this.addHalfVertex(i,g,_,C,!0,-T,E,se)}}this.lineSoFar=s.w,this.scaledDistance=z;const F=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(s,u,d,C,!1,w,E,F),this.addHalfVertex(s,g,_,C,!0,-T,E,F)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):ni(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let s=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(s=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:s}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:s}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:s}}addCurrentVertex(i,s,u,d,g,_,w=!1){const T=s.x+s.y*u,E=s.y-s.x*u,C=s.y*d-s.x,R=-s.y-s.x*d;if(_!=null){const M=this.elevationType==="offset",z=-10,F=Bt+10,G=_.zOffset,H=new sM(i.x,i.y,G,this.lineSoFar),K=!!M&&pI(i,z,F),ie=this.lineSoFar,ne=this.distance;if(this.currentVertex)if(K){const se=this.currentVertexIsOutside,Se=this.currentVertex,we=new sM(i.x,i.y,G,this.lineSoFar);if(aM(Se,we,z,F),!pI(we,z,F)){if(se){this.e1=this.e2=-1,this.distance-=Se.dist(H),this.lineSoFar=Se.w;const Te=this.evaluateLineProgressFeatures(Se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Se,T,E,w,!1,u,g,Te),this.addHalfVertex(Se,C,R,w,!0,-d,g,Te),this.prevDistance=this.distance}this.distance=this.prevDistance+Se.dist(we),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Se,we,T,E,C,R,u,d,g,w),this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}}else{const se=this.currentVertex;if(this.currentVertexIsOutside){aM(se,H,z,F),this.e1=this.e2=-1,this.distance-=se.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=se.w;const Se=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,T,E,w,!1,u,g,Se),this.addHalfVertex(se,C,R,w,!0,-d,g,Se),this.prevDistance=this.distance,this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(se,H,T,E,C,R,u,d,g,w)}else K||(this.addHalfVertex(i,T,E,w,!1,u,g,_),this.addHalfVertex(i,C,R,w,!0,-d,g,_));this.currentVertex=H,this.currentVertexIsOutside=K,this.lineSoFar=ie}else this.addHalfVertex(i,T,E,w,!1,u,g,_),this.addHalfVertex(i,C,R,w,!0,-d,g,_)}addHalfVertex({x:i,y:s},u,d,g,_,w,T,E){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((i<<1)+(g?1:0),(s<<1)+(_?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const R=gn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,R)}const C=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),T.primitiveLength++),_?this.e2=C:this.e1=C,E!=null&&this.zOffsetVertexArray.emplaceBack(E.zOffset,E.variableWidth,E.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,s){this.prevDistance=this.distance,this.distance+=i.dist(s),this.updateScaledDistance()}}function pI(l,i,s){return l.x<i||l.x>s||l.y<i||l.y>s}let FM,NM;function BM(l,i,s){return i*(Bt/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Xt(fI,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const VM=(l,i,s)=>(1-s)*l+s*i;function UM(l,i){return 1/BM(l,1,i.tileZoom)}function jM(l,i,s,u){return l.translatePosMatrix(u||i.tileID.projMatrix,i,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const GM=l=>{const i=[];$M(l)&&i.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const s=l.paint.get("line-trim-offset");s[0]===0&&s[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const u=l.layout.get("line-join").constantOr("miter")==="none",d=!!l.paint.get("line-pattern").constantOr(1);return u&&d&&i.push("LINE_JOIN_NONE"),i};function $M(l){const i=l.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}let mI;const HM=()=>mI||(mI={layout:FM||(FM=new Gr({"line-cap":new Ht($e.layout_line["line-cap"]),"line-join":new Ht($e.layout_line["line-join"]),"line-miter-limit":new Lt($e.layout_line["line-miter-limit"]),"line-round-limit":new Lt($e.layout_line["line-round-limit"]),"line-sort-key":new Ht($e.layout_line["line-sort-key"]),"line-z-offset":new Ht($e.layout_line["line-z-offset"]),"line-elevation-reference":new Lt($e.layout_line["line-elevation-reference"]),"line-cross-slope":new Lt($e.layout_line["line-cross-slope"]),visibility:new Lt($e.layout_line.visibility),"line-width-unit":new Lt($e.layout_line["line-width-unit"])})),paint:NM||(NM=new Gr({"line-opacity":new Ht($e.paint_line["line-opacity"]),"line-color":new Ht($e.paint_line["line-color"]),"line-translate":new Lt($e.paint_line["line-translate"]),"line-translate-anchor":new Lt($e.paint_line["line-translate-anchor"]),"line-width":new Ht($e.paint_line["line-width"]),"line-gap-width":new Ht($e.paint_line["line-gap-width"]),"line-offset":new Ht($e.paint_line["line-offset"]),"line-blur":new Ht($e.paint_line["line-blur"]),"line-dasharray":new Ht($e.paint_line["line-dasharray"]),"line-pattern":new Ht($e.paint_line["line-pattern"]),"line-pattern-cross-fade":new Lt($e.paint_line["line-pattern-cross-fade"]),"line-gradient":new Gh($e.paint_line["line-gradient"]),"line-trim-offset":new Lt($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new Lt($e.paint_line["line-trim-fade-range"]),"line-trim-color":new Lt($e.paint_line["line-trim-color"]),"line-emissive-strength":new Lt($e.paint_line["line-emissive-strength"]),"line-border-width":new Ht($e.paint_line["line-border-width"]),"line-border-color":new Ht($e.paint_line["line-border-color"]),"line-occlusion-opacity":new Lt($e.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},mI);class UG extends Ht{possiblyEvaluate(i,s){return s=new Zi(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition,worldview:s.worldview}),super.possiblyEvaluate(i,s)}evaluate(i,s,u,d){return s=Xe({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(i,s,u,d)}}let Oy;function qM(l,i){return i>0?i+2*l:l}const jG=di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),GG=di([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$G=di([{name:"a_projected_pos",components:4,type:"Float32"}],4);di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const HG=di([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),qG=di([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),WG=di([{name:"a_texb",components:2,type:"Uint16"}]),ZG=di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),XG=di([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const WM=di([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),KG=di([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);di([{name:"triangle",components:3,type:"Uint16"}]),di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),di([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),di([{type:"Float32",name:"offsetX"}]),di([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ks=24;function YG(l,i,s){return l.sections.forEach(u=>{u.text=function(d,g,_){const w=g.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),Gl.applyArabicShaping&&(d=Gl.applyArabicShaping(d)),d}(u.text,i,s)}),l}const zy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function QG(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function JG(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}const gI=4294967296,ZM=1/gI,XM=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let bw=class{constructor(l=new Uint8Array(16)){this.buf=ArrayBuffer.isView(l)?l:new Uint8Array(l),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(l,i,s=this.length){for(;this.pos<s;){const u=this.readVarint(),d=u>>3,g=this.pos;this.type=7&u,l(d,i,this),this.pos===g&&this.skip(u)}return i}readMessage(l,i){return this.readFields(l,i,this.readVarint()+this.pos)}readFixed32(){const l=this.dataView.getUint32(this.pos,!0);return this.pos+=4,l}readSFixed32(){const l=this.dataView.getInt32(this.pos,!0);return this.pos+=4,l}readFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*gI;return this.pos+=8,l}readSFixed64(){const l=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*gI;return this.pos+=8,l}readFloat(){const l=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,l}readDouble(){const l=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,l}readVarint(l){const i=this.buf;let s,u;return u=i[this.pos++],s=127&u,u<128?s:(u=i[this.pos++],s|=(127&u)<<7,u<128?s:(u=i[this.pos++],s|=(127&u)<<14,u<128?s:(u=i[this.pos++],s|=(127&u)<<21,u<128?s:(u=i[this.pos],s|=(15&u)<<28,function(d,g,_){const w=_.buf;let T,E;if(E=w[_.pos++],T=(112&E)>>4,E<128||(E=w[_.pos++],T|=(127&E)<<3,E<128)||(E=w[_.pos++],T|=(127&E)<<10,E<128)||(E=w[_.pos++],T|=(127&E)<<17,E<128)||(E=w[_.pos++],T|=(127&E)<<24,E<128)||(E=w[_.pos++],T|=(1&E)<<31,E<128))return Mm(d,T,g);throw new Error("Expected varint not more than 10 bytes")}(s,l,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const l=this.readVarint();return l%2==1?(l+1)/-2:l/2}readBoolean(){return!!this.readVarint()}readString(){const l=this.readVarint()+this.pos,i=this.pos;return this.pos=l,l-i>=12&&XM?XM.decode(this.buf.subarray(i,l)):function(s,u,d){let g="",_=u;for(;_<d;){const w=s[_];let T,E,C,R=null,M=w>239?4:w>223?3:w>191?2:1;if(_+M>d)break;M===1?w<128&&(R=w):M===2?(T=s[_+1],(192&T)==128&&(R=(31&w)<<6|63&T,R<=127&&(R=null))):M===3?(T=s[_+1],E=s[_+2],(192&T)==128&&(192&E)==128&&(R=(15&w)<<12|(63&T)<<6|63&E,(R<=2047||R>=55296&&R<=57343)&&(R=null))):M===4&&(T=s[_+1],E=s[_+2],C=s[_+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(R=(15&w)<<18|(63&T)<<12|(63&E)<<6|63&C,(R<=65535||R>=1114112)&&(R=null))),R===null?(R=65533,M=1):R>65535&&(R-=65536,g+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),g+=String.fromCharCode(R),_+=M}return g}(this.buf,i,l)}readBytes(){const l=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,l);return this.pos=l,i}readPackedVarint(l=[],i){const s=this.readPackedEnd();for(;this.pos<s;)l.push(this.readVarint(i));return l}readPackedSVarint(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSVarint());return l}readPackedBoolean(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readBoolean());return l}readPackedFloat(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFloat());return l}readPackedDouble(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readDouble());return l}readPackedFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed32());return l}readPackedSFixed32(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed32());return l}readPackedFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readFixed64());return l}readPackedSFixed64(l=[]){const i=this.readPackedEnd();for(;this.pos<i;)l.push(this.readSFixed64());return l}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(l){const i=7&l;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(l,i){this.writeVarint(l<<3|i)}realloc(l){let i=this.length||16;for(;i<this.pos+l;)i*=2;if(i!==this.length){const s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeSFixed32(l){this.realloc(4),this.dataView.setInt32(this.pos,l,!0),this.pos+=4}writeFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*ZM),!0),this.pos+=8}writeSFixed64(l){this.realloc(8),this.dataView.setInt32(this.pos,-1&l,!0),this.dataView.setInt32(this.pos+4,Math.floor(l*ZM),!0),this.pos+=8}writeVarint(l){(l=+l||0)>268435455||l<0?function(i,s){let u,d;if(i>=0?(u=i%4294967296|0,d=i/4294967296|0):(u=~(-i%4294967296),d=~(-i/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,_,w){w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7)}(u,0,s),function(g,_){const w=(7&g)<<4;_.buf[_.pos++]|=w|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(d,s)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))}writeSVarint(l){this.writeVarint(l<0?2*-l-1:2*l)}writeBoolean(l){this.writeVarint(+l)}writeString(l){l=String(l),this.realloc(4*l.length),this.pos++;const i=this.pos;this.pos=function(u,d,g){for(let _,w,T=0;T<d.length;T++){if(_=d.charCodeAt(T),_>55295&&_<57344){if(!w){_>56319||T+1===d.length?(u[g++]=239,u[g++]=191,u[g++]=189):w=_;continue}if(_<56320){u[g++]=239,u[g++]=191,u[g++]=189,w=_;continue}_=w-55296<<10|_-56320|65536,w=null}else w&&(u[g++]=239,u[g++]=191,u[g++]=189,w=null);_<128?u[g++]=_:(_<2048?u[g++]=_>>6|192:(_<65536?u[g++]=_>>12|224:(u[g++]=_>>18|240,u[g++]=_>>12&63|128),u[g++]=_>>6&63|128),u[g++]=63&_|128)}return g}(this.buf,l,this.pos);const s=this.pos-i;s>=128&&KM(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeFloat(l){this.realloc(4),this.dataView.setFloat32(this.pos,l,!0),this.pos+=4}writeDouble(l){this.realloc(8),this.dataView.setFloat64(this.pos,l,!0),this.pos+=8}writeBytes(l){const i=l.length;this.writeVarint(i),this.realloc(i);for(let s=0;s<i;s++)this.buf[this.pos++]=l[s]}writeRawMessage(l,i){this.pos++;const s=this.pos;l(i,this);const u=this.pos-s;u>=128&&KM(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u}writeMessage(l,i,s){this.writeTag(l,2),this.writeRawMessage(i,s)}writePackedVarint(l,i){i.length&&this.writeMessage(l,e$,i)}writePackedSVarint(l,i){i.length&&this.writeMessage(l,t$,i)}writePackedBoolean(l,i){i.length&&this.writeMessage(l,r$,i)}writePackedFloat(l,i){i.length&&this.writeMessage(l,n$,i)}writePackedDouble(l,i){i.length&&this.writeMessage(l,i$,i)}writePackedFixed32(l,i){i.length&&this.writeMessage(l,s$,i)}writePackedSFixed32(l,i){i.length&&this.writeMessage(l,o$,i)}writePackedFixed64(l,i){i.length&&this.writeMessage(l,a$,i)}writePackedSFixed64(l,i){i.length&&this.writeMessage(l,l$,i)}writeBytesField(l,i){this.writeTag(l,2),this.writeBytes(i)}writeFixed32Field(l,i){this.writeTag(l,5),this.writeFixed32(i)}writeSFixed32Field(l,i){this.writeTag(l,5),this.writeSFixed32(i)}writeFixed64Field(l,i){this.writeTag(l,1),this.writeFixed64(i)}writeSFixed64Field(l,i){this.writeTag(l,1),this.writeSFixed64(i)}writeVarintField(l,i){this.writeTag(l,0),this.writeVarint(i)}writeSVarintField(l,i){this.writeTag(l,0),this.writeSVarint(i)}writeStringField(l,i){this.writeTag(l,2),this.writeString(i)}writeFloatField(l,i){this.writeTag(l,5),this.writeFloat(i)}writeDoubleField(l,i){this.writeTag(l,1),this.writeDouble(i)}writeBooleanField(l,i){this.writeVarintField(l,+i)}};function Mm(l,i,s){return s?4294967296*i+(l>>>0):4294967296*(i>>>0)+(l>>>0)}function KM(l,i,s){const u=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(u);for(let d=s.pos-1;d>=l;d--)s.buf[d+u]=s.buf[d]}function e$(l,i){for(let s=0;s<l.length;s++)i.writeVarint(l[s])}function t$(l,i){for(let s=0;s<l.length;s++)i.writeSVarint(l[s])}function n$(l,i){for(let s=0;s<l.length;s++)i.writeFloat(l[s])}function i$(l,i){for(let s=0;s<l.length;s++)i.writeDouble(l[s])}function r$(l,i){for(let s=0;s<l.length;s++)i.writeBoolean(l[s])}function s$(l,i){for(let s=0;s<l.length;s++)i.writeFixed32(l[s])}function o$(l,i){for(let s=0;s<l.length;s++)i.writeSFixed32(l[s])}function a$(l,i){for(let s=0;s<l.length;s++)i.writeFixed64(l[s])}function l$(l,i){for(let s=0;s<l.length;s++)i.writeSFixed64(l[s])}const _I=3;function c$(l,i,s){i.glyphs=[],l===1&&s.readMessage(u$,i)}function u$(l,i,s){if(l===3){const{id:u,bitmap:d,width:g,height:_,left:w,top:T,advance:E}=s.readMessage(h$,{});i.glyphs.push({id:u,bitmap:new od({width:g+2*_I,height:_+2*_I},d),metrics:{width:g,height:_,left:w,top:T,advance:E}})}else l===4?i.ascender=s.readSVarint():l===5&&(i.descender=s.readSVarint())}function h$(l,i,s){l===1?i.id=s.readVarint():l===2?i.bitmap=s.readBytes():l===3?i.width=s.readVarint():l===4?i.height=s.readVarint():l===5?i.left=s.readSVarint():l===6?i.top=s.readSVarint():l===7&&(i.advance=s.readVarint())}const YM=_I,Na={horizontal:1,vertical:2,horizontalOnly:3};class Fy{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,s){const u=new Fy;return u.scale=i||1,u.fontStack=s,u}static forImage(i){const s=new Fy;return s.image=i,s}}class Dm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s,u){const d=new Dm;for(let g=0;g<i.sections.length;g++){const _=i.sections[g];_.image?d.addImageSection(_,u):d.addTextSection(_,s)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(s,u){let d="";for(let g=0;g<s.length;g++){const _=s.charCodeAt(g+1)||null,w=s.charCodeAt(g-1)||null;d+=!u&&(_&&lm(_)&&!zy[s[g+1]]||w&&lm(w)&&!zy[s[g-1]])||!zy[s[g]]?s[g]:zy[s[g]]}return d}(this.text,i)}trim(){let i=0;for(let u=0;u<this.text.length&&Tw[this.text.charCodeAt(u)];u++)i++;let s=this.text.length;for(let u=this.text.length-1;u>=0&&u>=i&&Tw[this.text.charCodeAt(u)];u--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const u=new Dm;return u.text=this.text.substring(i,s),u.sectionIndex=this.sectionIndex.slice(i,s),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}addTextSection(i,s){this.text+=i.text,this.sections.push(Fy.forText(i.scale,i.fontStack||s));const u=this.sections.length-1;for(let d=0;d<i.text.length;++d)this.sectionIndex.push(u)}addImageSection(i,s){const u=i.image?i.image.getPrimary():null;if(!u)return void ni("Can't add FormattedSection with an empty image.");u.scaleSelf(s);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Fy.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ni("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yI(l,i,s,u,d,g,_,w,T,E,C,R,M,z,F,G=1){const H=Dm.fromFeature(l,d,G);R===Na.vertical&&H.verticalizePunctuation(M);let K=[];const ie=function(Te,Oe,Ne,at,He,ht){if(!Te)return[];const Mt=[],gt=function(St,qe,ot,zt,At,ln){let Kt=0;for(let Tt=0;Tt<St.length();Tt++){const Ct=St.getSection(Tt);Kt+=QM(St.getCodePoint(Tt),Ct,zt,At,qe,ln)}return Kt/Math.max(1,Math.ceil(Kt/ot))}(Te,Oe,Ne,at,He,ht),It=Te.text.indexOf("")>=0;let Rt=0;for(let St=0;St<Te.length();St++){const qe=Te.getSection(St),ot=Te.getCodePoint(St);if(Tw[ot]||(Rt+=QM(ot,qe,at,He,Oe,ht)),St<Te.length()-1){const zt=!((st=ot)<11904||!(In["Bopomofo Extended"](st)||In.Bopomofo(st)||In["CJK Compatibility Forms"](st)||In["CJK Compatibility Ideographs"](st)||In["CJK Compatibility"](st)||In["CJK Radicals Supplement"](st)||In["CJK Strokes"](st)||In["CJK Symbols and Punctuation"](st)||In["CJK Unified Ideographs Extension A"](st)||In["CJK Unified Ideographs"](st)||In["Enclosed CJK Letters and Months"](st)||In["Halfwidth and Fullwidth Forms"](st)||In.Hiragana(st)||In["Ideographic Description Characters"](st)||In["Kangxi Radicals"](st)||In["Katakana Phonetic Extensions"](st)||In.Katakana(st)||In["Vertical Forms"](st)||In["Yi Radicals"](st)||In["Yi Syllables"](st)));(d$[ot]||zt||qe.image)&&Mt.push(eD(St+1,Rt,gt,Mt,f$(ot,Te.getCodePoint(St+1),zt&&It),!1))}}var st;return tD(eD(Te.length(),Rt,gt,Mt,0,!0))}(H,E,g,i,u,z),{processBidirectionalText:ne,processStyledBidirectionalText:se}=Gl;if(ne&&H.sections.length===1){const Te=ne(H.toString(),ie);for(const Oe of Te){const Ne=new Dm;Ne.text=Oe,Ne.sections=H.sections;for(let at=0;at<Oe.length;at++)Ne.sectionIndex.push(0);K.push(Ne)}}else if(se){const Te=se(H.text,H.sectionIndex,ie);for(const Oe of Te){const Ne=new Dm;Ne.text=Oe[0],Ne.sectionIndex=Oe[1],Ne.sections=H.sections,K.push(Ne)}}else K=function(Te,Oe){const Ne=[],at=Te.text;let He=0;for(const ht of Oe)Ne.push(Te.substring(He,ht)),He=ht;return He<at.length&&Ne.push(Te.substring(He,at.length)),Ne}(H,ie);const Se=[],we={positionedLines:Se,text:H.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Te,Oe,Ne,at,He,ht,Mt,gt,It,Rt,st,St){let qe=0,ot=0,zt=0;const At=gt==="right"?1:gt==="left"?0:.5;let ln=!1;for(const Vt of He){const Zt=Vt.getSections();for(const Tn of Zt){if(Tn.image)continue;const kn=Oe[Tn.fontStack];if(kn&&(ln=kn.ascender!==void 0&&kn.descender!==void 0,!ln))break}if(!ln)break}let Kt=0;for(const Vt of He){Vt.trim();const Zt=Vt.getMaxScale(),Tn=(Zt-1)*Ks,kn={positionedGlyphs:[],lineOffset:0};Te.positionedLines[Kt]=kn;const Un=kn.positionedGlyphs;let On=0;if(!Vt.length()){ot+=ht,++Kt;continue}let li=0,Yn=0;for(let ce=0;ce<Vt.length();ce++){const ue=Vt.getSection(ce),it=Vt.getSectionIndex(ce),Ft=Vt.getCodePoint(ce);let Gt=ue.scale,jt=null,Yt=null,An=null,ri=Ks,si=0,Wn=It;Wn===Na.vertical&&((Tt=Ft)===12312||Tt===12313||Tt===12316||Tt===12540||Tt===12448)&&(Wn=Na.horizontal);const Xi=!(Wn===Na.horizontal||!st&&!am(Ft)||st&&(Tw[Ft]||D0(Ft)));if(ue.image){const Dr=at.get(ue.image.toString());if(!Dr)continue;An=ue.image,Te.iconsInText=Te.iconsInText||!0,Yt=Dr.paddedRect;const Gn=Dr.displaySize;Gt=Gt*Ks/St,jt={width:Gn[0],height:Gn[1],left:0,top:-YM,advance:Xi?Gn[1]:Gn[0],localGlyph:!1},si=ln?-jt.height*Gt:Zt*Ks-17-Gn[1]*Gt,ri=jt.advance;const gr=(Xi?Gn[0]:Gn[1])*Gt-Ks*Zt;gr>0&&gr>On&&(On=gr)}else{const Dr=Ne[ue.fontStack];if(!Dr)continue;Dr[Ft]&&(Yt=Dr[Ft]);const Gn=Oe[ue.fontStack];if(!Gn)continue;const gr=Gn.glyphs[Ft];if(!gr)continue;if(jt=gr.metrics,ri=Ft!==8203?Ks:0,ln){const rr=Gn.ascender!==void 0?Math.abs(Gn.ascender):0,Ni=Gn.descender!==void 0?Math.abs(Gn.descender):0,Rr=(rr+Ni)*Gt;li<Rr&&(li=Rr,Yn=(rr-Ni)/2*Gt),si=-rr*Gt}else si=(Zt-Gt)*Ks-17}Xi?(Te.verticalizable=!0,Un.push({glyph:Ft,image:An,x:qe,y:ot+si,vertical:Xi,scale:Gt,localGlyph:jt.localGlyph,fontStack:ue.fontStack,sectionIndex:it,metrics:jt,rect:Yt}),qe+=ri*Gt+Rt):(Un.push({glyph:Ft,image:An,x:qe,y:ot+si,vertical:Xi,scale:Gt,localGlyph:jt.localGlyph,fontStack:ue.fontStack,sectionIndex:it,metrics:jt,rect:Yt}),qe+=jt.advance*Gt+Rt)}Un.length!==0&&(zt=Math.max(qe-Rt,zt),ln?nD(Un,At,On,Yn,ht*Zt/2):nD(Un,At,On,0,ht/2)),qe=0;const hr=ht*Zt+On;kn.lineOffset=Math.max(On,Tn),ot+=hr,++Kt}var Tt;const Ct=ot,{horizontalAlign:Jt,verticalAlign:Wt}=vI(Mt);(function(Vt,Zt,Tn,kn,Un,On){const li=(Zt-Tn)*Un,Yn=-On*kn;for(const hr of Vt)for(const ce of hr.positionedGlyphs)ce.x+=li,ce.y+=Yn})(Te.positionedLines,At,Jt,Wt,zt,Ct),Te.top+=-Wt*Ct,Te.bottom=Te.top+Ct,Te.left+=-Jt*zt,Te.right=Te.left+zt,Te.hasBaseline=ln}(we,i,s,u,K,_,w,T,R,E,M,F),!function(Te){for(const Oe of Te)if(Oe.positionedGlyphs.length!==0)return!1;return!0}(Se))return we}const Tw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},d$={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function QM(l,i,s,u,d,g){if(i.image){const _=u.get(i.image.toString());return _?_.displaySize[0]*i.scale*Ks/g+d:0}{const _=s[i.fontStack],w=_&&_.glyphs[l];return w?w.metrics.advance*i.scale+d:0}}function JM(l,i,s,u){const d=Math.pow(l-i,2);return u?l<i?d/2:2*d:d+Math.abs(s)*s}function f$(l,i,s){let u=0;return l===10&&(u-=1e4),s&&(u+=150),l!==40&&l!==65288||(u+=50),i!==41&&i!==65289||(u+=50),u}function eD(l,i,s,u,d,g){let _=null,w=JM(i,s,d,g);for(const T of u){const E=JM(i-T.x,s,d,g)+T.badness;E<=w&&(_=T,w=E)}return{index:l,x:i,priorBreak:_,badness:w}}function tD(l){return l?tD(l.priorBreak).concat(l.index):[]}function vI(l){let i=.5,s=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function nD(l,i,s,u,d){if(!(i||s||u||d))return;const g=l.length-1,_=l[g],w=(_.x+_.metrics.advance*_.scale)*i;for(let T=0;T<=g;T++)l[T].x-=w,l[T].y+=s+u+d}function iD(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function p$(l,i,s,u){const{horizontalAlign:d,verticalAlign:g}=vI(u),_=s[0]-l.displaySize[0]*d,w=s[1]-l.displaySize[1]*g;return{imagePrimary:l,imageSecondary:i,top:w,bottom:w+l.displaySize[1],left:_,right:_+l.displaySize[0]}}function rD(l,i,s,u,d,g){const _=l.imagePrimary;let w;if(_.content){const H=_.content,K=_.pixelRatio||1;w=[H[0]/K,H[1]/K,_.displaySize[0]-H[2]/K,_.displaySize[1]-H[3]/K]}const T=i.left*g,E=i.right*g;let C,R,M,z;s==="width"||s==="both"?(z=d[0]+T-u[3],R=d[0]+E+u[1]):(z=d[0]+(T+E-_.displaySize[0])/2,R=z+_.displaySize[0]);const F=i.top*g,G=i.bottom*g;return s==="height"||s==="both"?(C=d[1]+F-u[0],M=d[1]+G+u[2]):(C=d[1]+(F+G-_.displaySize[1])/2,M=C+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:C,right:R,bottom:M,left:z,collisionPadding:w}}function sD(l){return!l.imagePrimary.stretchX}function oD(l){return!l.imagePrimary.stretchY}function aD(l){return{width:l.right-l.left,height:l.bottom-l.top}}const cu=128;function lD(l,i,s){const{expression:u}=i;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Zi(l+1,{worldview:s}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=u;let _=0;for(;_<d.length&&d[_]<=l;)_++;_=Math.max(0,_-1);let w=_;for(;w<d.length&&d[w]<l+1;)w++;w=Math.min(d.length-1,w);const T=d[_],E=d[w];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:E,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:E,minSize:u.evaluate(new Zi(T,{worldview:s})),maxSize:u.evaluate(new Zi(E,{worldview:s})),interpolationType:g}}}function xI(l,{uSize:i,uSizeT:s},{lowerSize:u,upperSize:d}){return l.kind==="source"?u/cu:l.kind==="composite"?gn(u/cu,d/cu,s):i}function Ny(l,i,s=1){let u=0,d=0;if(l.kind==="constant")d=l.layoutSize*s;else if(l.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:w}=l,T=g?he(Zo.interpolationFactor(g,i,_,w),0,1):0;l.kind==="camera"?d=gn(l.minSize,l.maxSize,T)*s:u=T*s}return{uSizeT:u,uSize:d}}class Xu extends bt{constructor(i,s,u,d,g){super(i,s),this.angle=d,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new Xu(this.x,this.y,this.z,this.angle,this.segment)}}function cD(l,i,s,u,d){if(i.segment===void 0)return!0;let g=i,_=i.segment+1,w=0;for(;w>-s/2;){if(_--,_<0)return!1;w-=l[_].dist(g),g=l[_]}w+=l[_].dist(l[_+1]),_++;const T=[];let E=0;for(;w<s/2;){const C=l[_],R=l[_+1];if(!R)return!1;let M=l[_-1].angleTo(C)-C.angleTo(R);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:M}),E+=M;w-T[0].distance>u;)E-=T.shift().angleDelta;if(E>d)return!1;_++,w+=C.dist(R)}return!0}function uD(l){let i=0;for(let s=0;s<l.length-1;s++)i+=l[s].dist(l[s+1]);return i}function hD(l,i,s){return l?.6*i*s:0}function dD(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function m$(l,i,s,u,d,g){const _=hD(s,d,g),w=dD(s,u)*g;let T=0;const E=uD(l)/2;for(let C=0;C<l.length-1;C++){const R=l[C],M=l[C+1],z=R.dist(M);if(T+z>E){const F=(E-T)/z,G=gn(R.x,M.x,F),H=gn(R.y,M.y,F),K=new Xu(G,H,0,M.angleTo(R),C);return!_||cD(l,K,w,_,i)?K:void 0}T+=z}}function g$(l,i,s,u,d,g,_,w,T){const E=hD(u,g,_),C=dD(u,d),R=C*_,M=l[0].x===0||l[0].x===T||l[0].y===0||l[0].y===T;return i-R<i/4&&(i=R+i/4),fD(l,M?i/2*w%i:(C/2+2*g)*_*w%i,i,E,s,R,M,!1,T)}function fD(l,i,s,u,d,g,_,w,T){const E=g/2,C=uD(l);let R=0,M=i-s,z=[];for(let F=0;F<l.length-1;F++){const G=l[F],H=l[F+1],K=G.dist(H),ie=H.angleTo(G);for(;M+s<R+K;){M+=s;const ne=(M-R)/K,se=gn(G.x,H.x,ne),Se=gn(G.y,H.y,ne);if(se>=0&&se<T&&Se>=0&&Se<T&&M-E>=0&&M+E<=C){const we=new Xu(se,Se,0,ie,F);u&&!cD(l,we,g,u,d)||z.push(we)}}R+=K}return w||z.length||_||(z=fD(l,R/2,s,u,d,g,_,!0,T)),z}function pD(l){let i=0,s=0;for(const _ of l)i+=_.w*_.h,s=Math.max(s,_.w);l.sort((_,w)=>w.h-_.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let d=0,g=0;for(const _ of l)for(let w=u.length-1;w>=0;w--){const T=u[w];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,g=Math.max(g,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===T.w&&_.h===T.h){const E=u.pop();E&&w<u.length&&(u[w]=E)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(u.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:d,h:g,fill:i/(d*g)||0}}Xt(Xu,"Anchor");const Uf=1;class By{static getImagePositionScale(i,s,u){if(s&&i&&i.options&&i.options.transform){const d=i.options.transform;return{x:d.a,y:d.d}}return{x:u,y:u}}constructor(i,s,u,d){this.paddedRect=i;const{pixelRatio:g,version:_,stretchX:w,stretchY:T,content:E,sdf:C,usvg:R}=s;this.pixelRatio=g,this.stretchX=w,this.stretchY=T,this.content=E,this.version=_,this.padding=u,this.sdf=C,this.usvg=R,this.scale=By.getImagePositionScale(d,R,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function wI(l,i,s){const u=xn.parse(l),d=function(g,_,w=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*w[0])+2*_,h:(g.data?g.data.height:g.height*w[1])+2*_}}(i,s,[u.options.transform.a,u.options.transform.d]);return{bin:d,imagePosition:new By(d,i,s,u),imageVariant:u}}class mD{constructor(i,s,u){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(i,d,Uf,_),this.addImages(s,g,2,_);const{w,h:T}=pD(_),E=new lo({width:w||1,height:T||1});for(const[C,R]of i.entries()){const M=d.get(C).paddedRect;lo.copy(R.data,E,{x:0,y:0},{x:M.x+Uf,y:M.y+Uf},R.data,u,R.sdf)}for(const[C,R]of s.entries()){const M=g.get(C),z=M.paddedRect;let F=M.padding;const G=z.x+F,H=z.y+F,K=R.data.width,ie=R.data.height;F=F>1?F-1:F,lo.copy(R.data,E,{x:0,y:0},{x:G,y:H},R.data,u),lo.copy(R.data,E,{x:0,y:ie-F},{x:G,y:H-F},{width:K,height:F},u),lo.copy(R.data,E,{x:0,y:0},{x:G,y:H+ie},{width:K,height:F},u),lo.copy(R.data,E,{x:K-F,y:0},{x:G-F,y:H},{width:F,height:ie},u),lo.copy(R.data,E,{x:0,y:0},{x:G+K,y:H},{width:F,height:ie},u),lo.copy(R.data,E,{x:K-F,y:ie-F},{x:G-F,y:H-F},{width:F,height:F},u),lo.copy(R.data,E,{x:0,y:ie-F},{x:G+K,y:H-F},{width:F,height:F},u),lo.copy(R.data,E,{x:0,y:0},{x:G+K,y:H+ie},{width:F,height:F},u),lo.copy(R.data,E,{x:K-F,y:0},{x:G-F,y:H+ie},{width:F,height:F},u)}this.lut=u,this.image=E,this.iconPositions=d,this.patternPositions=g}addImages(i,s,u,d){for(const[g,_]of i.entries()){const{bin:w,imagePosition:T,imageVariant:E}=wI(g,_,u);s.set(g,T),d.push(w),_.hasRenderCallback&&this.haveRenderCallbacks.push(E.id)}}patchUpdatedImages(i,s,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>i.hasImage(d,u)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d of i.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const _=xn.parse(g);if(Oo.isEqual(_.id,d)){const w=i.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(g),w,s)}}for(const g of this.patternPositions.keys()){const _=xn.parse(g);if(Oo.isEqual(_.id,d)){const w=i.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(g),w,s)}}}}patchUpdatedImage(i,s,u){if(!i||!s||i.version===s.version)return;i.version=s.version;const[d,g]=i.tl,_=i.sdf;if(this.lut||_){const w={width:s.data.width,height:s.data.height},T=new lo(w);lo.copy(s.data,T,{x:0,y:0},{x:0,y:0},w,this.lut,_),u.update(T,{position:{x:d,y:g}})}else u.update(s.data,{position:{x:d,y:g}})}}Xt(By,"ImagePosition"),Xt(mD,"ImageAtlas");const Vy=1e20;function gD(l,i,s,u,d,g,_,w,T){for(let E=i;E<i+u;E++)_D(l,s*g+E,g,d,_,w,T);for(let E=s;E<s+d;E++)_D(l,E*g+i,1,u,_,w,T)}function _D(l,i,s,u,d,g,_){g[0]=0,_[0]=-Vy,_[1]=Vy,d[0]=l[i];for(let w=1,T=0,E=0;w<u;w++){d[w]=l[i+w*s];const C=w*w;do{const R=g[T];E=(d[w]-d[R]+C-R*R)/(w-R)/2}while(E<=_[T]&&--T>-1);T++,g[T]=w,_[T]=E,_[T+1]=Vy}for(let w=0,T=0;w<u;w++){for(;_[T+1]<w;)T++;const E=g[T],C=w-E;l[i+w*s]=d[E]+C*C}}const gc=2,bI={none:0,ideographs:1,all:2};class Lm{constructor(i,s,u){this.requestManager=i,this.localGlyphMode=s,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,s){const u=[],d=this.url||ye.GLYPHS_URL;for(const g in i)for(const _ of i[g])u.push({stack:g,id:_});Fe(u,({stack:g,id:_},w)=>{let T=this.entries[g];T||(T=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=T.glyphs[_];if(E!==void 0)return void w(null,{stack:g,id:_,glyph:E});if(E=this._tinySDF(T,g,_),E)return T.glyphs[_]=E,void w(null,{stack:g,id:_,glyph:E});const C=Math.floor(_/256);if(256*C>65535)return ni("glyphs > 65535 not supported"),void w(null,{stack:g,id:_,glyph:E});if(T.ranges[C])return void w(null,{stack:g,id:_,glyph:E});let R=T.requests[C];R||(R=T.requests[C]=[],Lm.loadGlyphRange(g,C,d,this.requestManager,(M,z)=>{if(z){T.ascender=z.ascender,T.descender=z.descender;for(const F in z.glyphs)this._doesCharSupportLocalGlyph(+F)||(T.glyphs[+F]=z.glyphs[+F]);T.ranges[C]=!0}for(const F of R)F(M,z);delete T.requests[C]})),R.push((M,z)=>{M?w(M):z&&w(null,{stack:g,id:_,glyph:z.glyphs[_]||null})})},(g,_)=>{if(g)s(g);else if(_){const w={};for(const{stack:T,id:E,glyph:C}of _)w[T]===void 0&&(w[T]={}),w[T].glyphs===void 0&&(w[T].glyphs={}),w[T].glyphs[E]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},w[T].ascender=this.entries[T].ascender,w[T].descender=this.entries[T].descender;s(null,w)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==bI.none&&(this.localGlyphMode===bI.all?!!this.localFontFamily:!!this.localFontFamily&&(In["CJK Unified Ideographs"](i)||In["Hangul Syllables"](i)||In.Hiragana(i)||In.Katakana(i)||In["CJK Symbols and Punctuation"](i)||In["CJK Unified Ideographs Extension A"](i)||In["CJK Unified Ideographs Extension B"](i)||In.Osage(i)))}_tinySDF(i,s,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=i.tinySDF;if(!g){let G="400";/bold/i.test(s)?G="900":/medium/i.test(s)?G="500":/light/i.test(s)&&(G="200"),g=i.tinySDF=new Lm.TinySDF({fontFamily:d,fontWeight:G,fontSize:24*gc,buffer:3*gc,radius:8*gc}),g.fontWeight=G}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const _=String.fromCodePoint(u),{data:w,width:T,height:E,glyphWidth:C,glyphHeight:R,glyphLeft:M,glyphTop:z,glyphAdvance:F}=g.draw(_);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new od({width:T,height:E},w),metrics:{width:C/gc,height:R/gc,left:M/gc,top:z/gc-27,advance:F/gc,localGlyph:!0}}}}Lm.loadGlyphRange=function(l,i,s,u,d){const g=256*i,_=g+255,w=u.transformRequest(u.normalizeGlyphsURL(s).replace("{fontstack}",l).replace("{range}",`${g}-${_}`),Cu.Glyphs);Pu(w,(T,E)=>{if(T)d(T);else if(E){const C={},R=function(M){return new bw(M).readFields(c$,{})}(E);for(const M of R.glyphs)C[M.id]=M;d(null,{glyphs:C,ascender:R.ascender,descender:R.descender})}})},Lm.TinySDF=class{constructor({fontSize:l=24,buffer:i=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:_="normal"}={}){this.buffer=i,this.cutoff=u,this.radius=s;const w=this.size=l+4*i,T=this._createCanvas(w),E=this.ctx=T.getContext("2d",{willReadFrequently:!0});E.font=`${_} ${g} ${l}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(l){const i=document.createElement("canvas");return i.width=i.height=l,i}draw(l){const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(l),_=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),T=Math.min(this.size-this.buffer,_+Math.ceil(u)),E=w+2*this.buffer,C=T+2*this.buffer,R=Math.max(E*C,0),M=new Uint8ClampedArray(R),z={data:M,width:E,height:C,glyphWidth:w,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(w===0||T===0)return z;const{ctx:F,buffer:G,gridInner:H,gridOuter:K}=this;F.clearRect(G,G,w,T),F.fillText(l,G,G+_);const ie=F.getImageData(G,G,w,T);K.fill(Vy,0,R),H.fill(0,0,R);for(let ne=0;ne<T;ne++)for(let se=0;se<w;se++){const Se=ie.data[4*(ne*w+se)+3]/255;if(Se===0)continue;const we=(ne+G)*E+se+G;if(Se===1)K[we]=0,H[we]=Vy;else{const Te=.5-Se;K[we]=Te>0?Te*Te:0,H[we]=Te<0?Te*Te:0}}gD(K,0,0,E,C,E,this.f,this.v,this.z),gD(H,G,G,w,T,E,this.f,this.v,this.z);for(let ne=0;ne<R;ne++){const se=Math.sqrt(K[ne])-Math.sqrt(H[ne]);M[ne]=Math.round(255-255*(se/this.radius+this.cutoff))}return z}};const cd=Uf;function yD(l,i){return l+i[1]-i[0]}function vD(l,i,s,u,d=1){const g=[],_=l.imagePrimary,w=_.pixelRatio,T=_.paddedRect.w-2*cd,E=_.paddedRect.h-2*cd,C=(l.right-l.left)*d,R=(l.bottom-l.top)*d,M=_.stretchX||[[0,T]],z=_.stretchY||[[0,E]],F=M.reduce(yD,0),G=z.reduce(yD,0),H=T-F,K=E-G;let ie=0,ne=F,se=0,Se=G,we=0,Te=H,Oe=0,Ne=K;if(_.content&&u){const He=_.content;ie=Ew(M,0,He[0]),se=Ew(z,0,He[1]),ne=Ew(M,He[0],He[2]),Se=Ew(z,He[1],He[3]),we=He[0]-ie,Oe=He[1]-se,Te=He[2]-He[0]-ne,Ne=He[3]-He[1]-Se}const at=(He,ht,Mt,gt)=>{const It=Iw(He.stretch-ie,ne,C,l.left*d),Rt=Sw(He.fixed-we,Te,He.stretch,F),st=Iw(ht.stretch-se,Se,R,l.top*d),St=Sw(ht.fixed-Oe,Ne,ht.stretch,G),qe=Iw(Mt.stretch-ie,ne,C,l.left*d),ot=Sw(Mt.fixed-we,Te,Mt.stretch,F),zt=Iw(gt.stretch-se,Se,R,l.top*d),At=Sw(gt.fixed-Oe,Ne,gt.stretch,G),ln=new bt(It,st),Kt=new bt(qe,st),Tt=new bt(qe,zt),Ct=new bt(It,zt),Jt=new bt(Rt/w,St/w),Wt=new bt(ot/w,At/w),Vt=i*Math.PI/180;if(Vt){const li=Math.sin(Vt),Yn=Math.cos(Vt),hr=[Yn,-li,li,Yn];ln._matMult(hr),Kt._matMult(hr),Ct._matMult(hr),Tt._matMult(hr)}const Zt=He.stretch+He.fixed,Tn=Mt.stretch+Mt.fixed,kn=ht.stretch+ht.fixed,Un=gt.stretch+gt.fixed,On=l.imageSecondary;return{tl:ln,tr:Kt,bl:Ct,br:Tt,texPrimary:{x:_.paddedRect.x+cd+Zt,y:_.paddedRect.y+cd+kn,w:Tn-Zt,h:Un-kn},texSecondary:On?{x:On.paddedRect.x+cd+Zt,y:On.paddedRect.y+cd+kn,w:Tn-Zt,h:Un-kn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jt,pixelOffsetBR:Wt,minFontScaleX:Te/w/C,minFontScaleY:Ne/w/R,isSDF:s}};if(u&&(_.stretchX||_.stretchY)){const He=xD(M,H,F),ht=xD(z,K,G);for(let Mt=0;Mt<He.length-1;Mt++){const gt=He[Mt],It=He[Mt+1];for(let Rt=0;Rt<ht.length-1;Rt++)g.push(at(gt,ht[Rt],It,ht[Rt+1]))}}else g.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:E+1}));return g}function Ew(l,i,s){let u=0;for(const d of l)u+=Math.max(i,Math.min(s,d[1]))-Math.max(i,Math.min(s,d[0]));return u}function xD(l,i,s){const u=[{fixed:-cd,stretch:0}];for(const[d,g]of l){const _=u[u.length-1];u.push({fixed:d-_.stretch,stretch:_.stretch}),u.push({fixed:d-_.stretch,stretch:_.stretch+(g-d)})}return u.push({fixed:i+cd,stretch:s}),u}function Iw(l,i,s,u){return l/i*s+u}function Sw(l,i,s,u){return l-i*s/u}function _$(l,i,s,u){const d=i+l.positionedLines[u].lineOffset;return u===0?s+d/2:s+(d+(i+l.positionedLines[u-1].lineOffset))/2}function y$(l,i=1,s=!1){let u=1/0,d=1/0,g=-1/0,_=-1/0;const w=l[0];for(let z=0;z<w.length;z++){const F=w[z];(!z||F.x<u)&&(u=F.x),(!z||F.y<d)&&(d=F.y),(!z||F.x>g)&&(g=F.x),(!z||F.y>_)&&(_=F.y)}const T=Math.min(g-u,_-d);let E=T/2;const C=new zp([],v$);if(T===0)return new bt(u,d);for(let z=u;z<g;z+=T)for(let F=d;F<_;F+=T)C.push(new Om(z+E,F+E,E,l));let R=function(z){let F=0,G=0,H=0;const K=z[0];for(let ie=0,ne=K.length,se=ne-1;ie<ne;se=ie++){const Se=K[ie],we=K[se],Te=Se.x*we.y-we.x*Se.y;G+=(Se.x+we.x)*Te,H+=(Se.y+we.y)*Te,F+=3*Te}return new Om(G/F,H/F,0,z)}(l),M=C.length;for(;C.length;){const z=C.pop();(z.d>R.d||!R.d)&&(R=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,M)),z.max-R.d<=i||(E=z.h/2,C.push(new Om(z.p.x-E,z.p.y-E,E,l)),C.push(new Om(z.p.x+E,z.p.y-E,E,l)),C.push(new Om(z.p.x-E,z.p.y+E,E,l)),C.push(new Om(z.p.x+E,z.p.y+E,E,l)),M+=4)}return s&&(console.log(`num probes: ${M}`),console.log(`best distance: ${R.d}`)),R.p}function v$(l,i){return i.max-l.max}class Om{constructor(i,s,u,d){this.p=new bt(i,s),this.h=u,this.d=function(g,_){let w=!1,T=1/0;for(let E=0;E<_.length;E++){const C=_[E];for(let R=0,M=C.length,z=M-1;R<M;z=R++){const F=C[R],G=C[z];F.y>g.y!=G.y>g.y&&g.x<(G.x-F.x)*(g.y-F.y)/(G.y-F.y)+F.x&&(w=!w),T=Math.min(T,Da(g,F,G))}}return(w?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const x$=Object.keys,TI=Number.POSITIVE_INFINITY,w$=Math.sqrt(2);function wD(l,[i,s]){let u=0,d=0;if(s===TI){i<0&&(i=0);const g=i/w$;switch(l){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-i;break;case"top":d=i-7}switch(l){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=i;break;case"right":u=-i}}else{switch(i=Math.abs(i),s=Math.abs(s),l){case"top-right":case"top-left":case"top":d=s-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-s}switch(l){case"top-right":case"bottom-right":case"right":u=-i;break;case"top-left":case"bottom-left":case"left":u=i}}return[u,d]}function Aw(l,i,s,u,d,g,_,w,T){if(!i||!i.usvg)return;const E=aD(u),C=aD(d),R=g!=="both"&&g!=="width"||!sD(u)?1:C.width/E.width,M=g!=="both"&&g!=="height"||!oD(u)?1:C.height/E.height;s.scaleSelf(R,M);const z=s.toString();_.set(z,s),w.set(z,i);const{imagePosition:F}=wI(z,i,Uf);T.set(z,F)}function bD(l,i,s,u,d,g,_,w,T){if(!l)return;const E=function(C,R,M,z,F,G){if(C.kind==="camera")return C.maxSize;if(C.kind==="composite"){const H=R.possiblyEvaluate(new Zi(C.maxZoom,{worldview:G}),M).evaluate(F,{},M),K=R.possiblyEvaluate(new Zi(C.minZoom,{worldview:G}),M).evaluate(F,{},M);return Math.max(H,K)}return R.possiblyEvaluate(new Zi(z,{worldview:G})).evaluate(F,{},M)}(i,s,u,d,g,T);return l.scaleSelf(E*w*_)}function TD(l,i,s,u,d,g,_,w,T){return{iconPrimary:bD(l.getPrimary(),i,s,u,d,g,_,w,T),iconSecondary:bD(l.getSecondary(),i,s,u,d,g,_,w,T)}}function b$(l,i,s){if(!i)return;const u=s.get(l.toString()),d=s.get(i.toString());d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||ni(`Mismatch in icon variant sizes: ${l.toString()} and ${i.toString()}`),u.usvg!==d.usvg&&ni(`Mismatch in icon variant image types: ${l.id} and ${i.id}`))}function ED(l,i,s,u){if(!l)return;const d=i.get(s.toString());if(l.imagePrimary=d,u){const g=i.get(u.toString());l.imageSecondary=g}}function T$(l,i){for(const s in l.horizontal)ID(l.horizontal[s],i);ID(l.vertical,i)}function ID(l,i){if(l){for(const s of l.positionedLines)for(const u of s.positionedGlyphs)if(u.image!==null){const d=u.image.toString();u.rect=i.get(d).paddedRect}}}function EI(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function E$(l,i,s,u,d,g,_,w,T){const E=II(g.horizontal)||g.vertical,C=s.get("icon-text-fit-padding").evaluate(u,{},d);let R,M=i;return i&&T!=="none"&&(l.allowVerticalPlacement&&g.vertical&&(R=rD(i,g.vertical,T,C,w,_)),E&&(M=rD(i,E,T,C,w,_))),{defaultShapedIcon:M,verticallyShapedIcon:R}}function I$(l,i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K,ie,ne){let se=_.textMaxSize.evaluate(i,{},M);se===void 0?se=w*_.textScaleFactor:se*=_.textScaleFactor;const Se=l.layers[0].layout,we=II(s.horizontal)||s.vertical,Te=z.name==="globe",Oe=Ks,Ne=l.tilePixelRatio*se/Oe,at=(Rt=l.overscaling,l.zoom>18&&Rt>2&&(Rt>>=1),Math.max(Bt/(512*Rt),1)*Se.get("symbol-spacing")),He=Se.get("text-padding")*l.tilePixelRatio,ht=Se.get("icon-padding")*l.tilePixelRatio,Mt=fi(Se.get("text-max-angle")),gt=Se.get("icon-rotation-alignment")==="map"&&ne!=="point",It=at/2;var Rt;l.hasAnyIconTextFit===!1&&H!=="none"&&(l.hasAnyIconTextFit=!0);const st=i.properties?+i.properties[qt]:null,St=st&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(st):65535,qe=(ot,zt,At)=>{if(zt.x<0||zt.x>=Bt||zt.y<0||zt.y>=Bt)return;let ln=null;if(Te){const{x:Kt,y:Tt,z:Ct}=z.projectTilePoint(zt.x,zt.y,At);ln={anchor:new Xu(Kt,Tt,Ct,0,void 0),up:z.upVector(At,zt.x,zt.y)}}(function(Kt,Tt,Ct,Jt,Wt,Vt,Zt,Tn,kn,Un,On,li,Yn,hr,ce,ue,it,Ft,Gt,jt,Yt,An,ri,si,Wn,Xi,Dr,Gn,gr){const rr=Kt.addToLineVertexArray(Tt,Jt);let Ni,Rr,dr,sr,lr,Hi,Zn,Ki=0,kr=0,Sn=0,yi=0,fr=-1,Br=-1;const _r={};let gs=uc("");const Ji=Ct?Ct.anchor:Tt,hs=Gn!=="none";let la=0,co=0;if(kn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _s=kn.layout.get("text-offset").evaluate(Yt,{},Wn);la=_s[0]*Ks,co=_s[1]*Ks}else la=kn.layout.get("text-radial-offset").evaluate(Yt,{},Wn)*Ks,co=TI;if(Kt.allowVerticalPlacement&&Wt.vertical){const _s=Wt.vertical;if(ce)Hi=SI(_s),Tn&&(Zn=SI(Tn));else{const Fs=kn.layout.get("text-rotate").evaluate(Yt,{},Wn)+90;dr=Cw(Un,Ji,Tt,On,li,Yn,_s,hr,Fs,ue),Tn&&(sr=Cw(Un,Ji,Tt,On,li,Yn,Tn,Ft,Fs))}}if(Vt){const _s=Kt.iconSizeData,Fs=kn.layout.get("icon-rotate").evaluate(Yt,{},Wn),uo=vD(Vt,Fs,ri,hs,An.iconScaleFactor),Vo=Tn?vD(Tn,Fs,ri,hs,An.iconScaleFactor):void 0;Rr=Cw(Un,Ji,Tt,On,li,Yn,Vt,Ft,Fs,null),Ki=4*uo.length;let Eo=null;_s.kind==="source"?(Eo=[cu*kn.layout.get("icon-size").evaluate(Yt,{},Wn)*An.iconScaleFactor],Eo[0]>ud&&ni(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Uy}. Reduce your "icon-size".`)):_s.kind==="composite"&&(Eo=[cu*An.compositeIconSizes[0].evaluate(Yt,{},Wn)*An.iconScaleFactor,cu*An.compositeIconSizes[1].evaluate(Yt,{},Wn)*An.iconScaleFactor],(Eo[0]>ud||Eo[1]>ud)&&ni(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Uy}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,uo,Eo,jt,Gt,Yt,void 0,Ct,Tt,rr.lineStartIndex,rr.lineLength,-1,si,Wn,Xi,Dr),fr=Kt.icon.placedSymbolArray.length-1,Vo&&(kr=4*Vo.length,Kt.addSymbols(Kt.icon,Vo,Eo,jt,Gt,Yt,Na.vertical,Ct,Tt,rr.lineStartIndex,rr.lineLength,-1,si,Wn,Xi,Dr),Br=Kt.icon.placedSymbolArray.length-1)}for(const _s in Wt.horizontal){const Fs=_s,uo=Wt.horizontal[Fs];Ni||(gs=uc(uo.text),ce?lr=SI(uo):Ni=Cw(Un,Ji,Tt,On,li,Yn,uo,hr,kn.layout.get("text-rotate").evaluate(Yt,{},Wn),ue));const Vo=uo.positionedLines.length===1;if(Sn+=SD(Kt,Ct,Tt,uo,Zt,kn,ce,Yt,ue,rr,Wt.vertical?Na.horizontal:Na.horizontalOnly,Vo?x$(Wt.horizontal):[Fs],_r,fr,An,si,Wn,Xi),Vo)break}Wt.vertical&&(yi+=SD(Kt,Ct,Tt,Wt.vertical,Zt,kn,ce,Yt,ue,rr,Na.vertical,["vertical"],_r,Br,An,si,Wn,Xi));let eo=-1;const ca=(_s,Fs)=>_s?Math.max(_s,Fs):Fs;eo=ca(lr,eo),eo=ca(Hi,eo),eo=ca(Zn,eo);const uu=eo>-1?1:0;Kt.glyphOffsetArray.length>=65535&&ni("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yt.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,Yt.sortKey),Kt.symbolInstances.emplaceBack(Tt.x,Tt.y,Ji.x,Ji.y,Ji.z,_r.right>=0?_r.right:-1,_r.center>=0?_r.center:-1,_r.left>=0?_r.left:-1,_r.vertical>=0?_r.vertical:-1,fr,Br,gs,Ni!==void 0?Ni:Kt.collisionBoxArray.length,Ni!==void 0?Ni+1:Kt.collisionBoxArray.length,dr!==void 0?dr:Kt.collisionBoxArray.length,dr!==void 0?dr+1:Kt.collisionBoxArray.length,Rr!==void 0?Rr:Kt.collisionBoxArray.length,Rr!==void 0?Rr+1:Kt.collisionBoxArray.length,sr||Kt.collisionBoxArray.length,sr?sr+1:Kt.collisionBoxArray.length,On,Sn,yi,Ki,kr,uu,0,la,co,eo,0,hs?1:0,gr)})(l,zt,ln,ot,s,u,g,d,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,He,ie,E,0,ht,gt,K,i,_,C,R,M,F,G,H,St)};if(ne==="line")for(const ot of pw(i.geometry,0,0,Bt,Bt)){const zt=g$(ot,at,Mt,s.vertical||we,u,Oe,Ne,l.overscaling,Bt);for(const At of zt)we&&S$(l,we.text,It,At)||qe(ot,At,M)}else if(ne==="line-center"){for(const ot of i.geometry)if(ot.length>1){const zt=m$(ot,Mt,s.vertical||we,u,Oe,Ne);zt&&qe(ot,zt,M)}}else if(i.type==="Polygon")for(const ot of Ty(i.geometry,0)){const zt=y$(ot,16);qe(ot[0],new Xu(zt.x,zt.y,0,0,void 0),M)}else if(i.type==="LineString")for(const ot of i.geometry)qe(ot,new Xu(ot[0].x,ot[0].y,0,0,void 0),M);else if(i.type==="Point")for(const ot of i.geometry)for(const zt of ot)qe([zt],new Xu(zt.x,zt.y,0,0,void 0),M)}const Uy=255,ud=Uy*cu;function SD(l,i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H,K){const ie=function(Se,we,Te,Oe,Ne,at,He,ht){const Mt=[];if(we.positionedLines.length===0)return Mt;const gt=Oe.layout.get("text-rotate").evaluate(at,{})*Math.PI/180,It=function(ot){const zt=ot[0],At=ot[1],ln=zt*At;return ln>0?[zt,-At]:ln<0?[-zt,At]:zt===0?[At,zt]:[At,-zt]}(Te);let Rt=Math.abs(we.top-we.bottom);for(const ot of we.positionedLines)Rt-=ot.lineOffset;const st=we.positionedLines.length,St=Rt/st;let qe=we.top-Te[1];for(let ot=0;ot<st;++ot){const zt=we.positionedLines[ot];qe=_$(we,St,qe,ot);for(const At of zt.positionedGlyphs){if(!At.rect)continue;const ln=At.rect||{};let Kt=YM+1,Tt=!0,Ct=1,Jt=0;if(At.image){const Yt=He.get(At.image.toString());if(!Yt)continue;if(Yt.sdf){ni("SDF images are not supported in formatted text and will be ignored.");continue}Tt=!1,Ct=Yt.pixelRatio,Kt=Uf/Ct}const Wt=(Ne||ht)&&At.vertical,Vt=At.metrics.advance*At.scale/2,Zt=At.metrics,Tn=At.rect;if(Tn===null)continue;ht&&we.verticalizable&&(Jt=At.image?Vt-At.metrics.width*At.scale/2:0);const kn=Ne?[At.x+Vt,At.y]:[0,0];let Un=[0,0],On=[0,0],li=!1;Ne||(Wt?(On=[At.x+Vt+It[0],At.y+It[1]-Jt],li=!0):Un=[At.x+Vt+Te[0],At.y+Te[1]-Jt]);const Yn=Tn.w*At.scale/(Ct*(At.localGlyph?gc:1)),hr=Tn.h*At.scale/(Ct*(At.localGlyph?gc:1));let ce,ue,it,Ft;if(Wt){const Yt=At.y-qe,An=new bt(-Vt,Vt-Yt),ri=-Math.PI/2,si=new bt(...On);ce=new bt(-Vt+Un[0],Un[1]),ce._rotateAround(ri,An)._add(si),ce.x+=-Yt+Vt,ce.y-=(Zt.left-Kt)*At.scale;const Wn=At.image?Zt.advance*At.scale:Ks*At.scale,Xi=String.fromCodePoint(At.glyph);QG(Xi)?ce.x+=(1-Kt)*At.scale:JG(Xi)?ce.x+=Wn-Zt.height*At.scale+(-Kt-1)*At.scale:ce.x+=At.image||Zt.width+2*Kt===Tn.w&&Zt.height+2*Kt===Tn.h?(Wn-hr)/2:(Wn-(Zt.height+2*Kt)*At.scale)/2,ue=new bt(ce.x,ce.y-Yn),it=new bt(ce.x+hr,ce.y),Ft=new bt(ce.x+hr,ce.y-Yn)}else{const Yt=(Zt.left-Kt)*At.scale-Vt+Un[0],An=(-Zt.top-Kt)*At.scale+Un[1],ri=Yt+Yn,si=An+hr;ce=new bt(Yt,An),ue=new bt(ri,An),it=new bt(Yt,si),Ft=new bt(ri,si)}if(gt){let Yt;Yt=Ne?new bt(0,0):li?new bt(It[0],It[1]):new bt(Te[0],Te[1]),ce._rotateAround(gt,Yt),ue._rotateAround(gt,Yt),it._rotateAround(gt,Yt),Ft._rotateAround(gt,Yt)}const Gt=new bt(0,0),jt=new bt(0,0);Mt.push({tl:ce,tr:ue,bl:it,br:Ft,texPrimary:ln,texSecondary:void 0,writingMode:we.writingMode,glyphOffset:kn,sectionIndex:At.sectionIndex,isSDF:Tt,pixelOffsetTL:Gt,pixelOffsetBR:jt,minFontScaleX:0,minFontScaleY:0})}}return Mt}(0,u,T,g,_,w,d,l.allowVerticalPlacement),ne=l.textSizeData;let se=null;ne.kind==="source"?(se=[cu*g.layout.get("text-size").evaluate(w,{},H)*F.textScaleFactor],se[0]>ud&&ni(`${l.layerIds[0]}: Value for "text-size" is >= ${Uy}. Reduce your "text-size".`)):ne.kind==="composite"&&(se=[cu*F.compositeTextSizes[0].evaluate(w,{},H)*F.textScaleFactor,cu*F.compositeTextSizes[1].evaluate(w,{},H)*F.textScaleFactor],(se[0]>ud||se[1]>ud)&&ni(`${l.layerIds[0]}: Value for "text-size" is >= ${Uy}. Reduce your "text-size".`)),l.addSymbols(l.text,ie,se,T,_,w,C,i,s,E.lineStartIndex,E.lineLength,z,G,H,K,!1);for(const Se of R)M[Se]=l.text.placedSymbolArray.length-1;return 4*ie.length}function II(l){for(const i in l)return l[i];return null}function Cw(l,i,s,u,d,g,_,w,T,E){let C=_.top,R=_.bottom,M=_.left,z=_.right;if(iD(_)&&_.collisionPadding){const F=_.collisionPadding;M-=F[0],C-=F[1],z+=F[2],R+=F[3]}if(T){const F=new bt(M,C),G=new bt(z,C),H=new bt(M,R),K=new bt(z,R),ie=fi(T);let ne=new bt(0,0);E&&(ne=new bt(E[0],E[1])),F._rotateAround(ie,ne),G._rotateAround(ie,ne),H._rotateAround(ie,ne),K._rotateAround(ie,ne),M=Math.min(F.x,G.x,H.x,K.x),z=Math.max(F.x,G.x,H.x,K.x),C=Math.min(F.y,G.y,H.y,K.y),R=Math.max(F.y,G.y,H.y,K.y)}return l.emplaceBack(i.x,i.y,i.z,s.x,s.y,M,C,z,R,w,u,d,g),l.length-1}function SI(l){iD(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const i=l.bottom-l.top;return i>0?Math.max(10,i):null}function S$(l,i,s,u){const d=l.compareText;if(i in d){const g=d[i];for(let _=g.length-1;_>=0;_--)if(u.dist(g[_])<s)return!0}else d[i]=[];return d[i].push(u),!1}function AD(l,i){const s=l.fovAboveCenter,u=l.elevation?l.elevation.getMinElevationBelowMSL()*i:0,d=(l._camera.position[2]*l.worldSize-u)/Math.cos(l._pitch),g=Math.sin(s)*d/Math.sin(Math.max(Math.PI/2-l._pitch-s,.01));let _=Math.sin(l._pitch)*g+d;const w=d*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let T=Math.max(l.zoom-17,0);l.isOrthographic&&(T/=10),_*=1+T}return Math.min(1.01*_,w)}function jy(l,i){if(!i.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:i};const s=Math.pow(2,-l.z),u=l.x*s,d=(l.x+1)*s,g=l.y*s,_=(l.y+1)*s,w=te(u),T=te(d),E=re(g),C=re(_),R=i.project(w,E),M=i.project(T,E),z=i.project(T,C),F=i.project(w,C);let G=Math.min(R.x,M.x,z.x,F.x),H=Math.min(R.y,M.y,z.y,F.y),K=Math.max(R.x,M.x,z.x,F.x),ie=Math.max(R.y,M.y,z.y,F.y);const ne=s/16;function se(we,Te,Oe,Ne,at,He){const ht=(Oe+at)/2,Mt=(Ne+He)/2,gt=i.project(te(ht),re(Mt)),It=Math.max(0,G-gt.x,H-gt.y,gt.x-K,gt.y-ie);G=Math.min(G,gt.x),K=Math.max(K,gt.x),H=Math.min(H,gt.y),ie=Math.max(ie,gt.y),It>ne&&(se(we,gt,Oe,Ne,ht,Mt),se(gt,Te,ht,Mt,at,He))}se(R,M,u,g,d,g),se(M,z,d,g,d,_),se(z,F,d,_,u,_),se(F,R,u,_,u,g),G-=ne,H-=ne,K+=ne,ie+=ne;const Se=1/Math.max(K-G,ie-H);return{scale:Se,x:G*Se,y:H*Se,x2:K*Se,y2:ie*Se,projection:i}}function CD(l,{x:i,y:s},u=0){return new bt(((i-u)*l.scale-l.x)*Bt,(s*l.scale-l.y)*Bt)}const A$=me(new Float32Array(16));class hd{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,s){return{x:0,y:0,z:0}}unproject(i,s){return new L(0,0)}projectTilePoint(i,s,u){return{x:i,y:s,z:0}}locationPoint(i,s,u,d=!0){return i._coordinatePoint(i.locationCoordinate(s,u),d)}pixelsPerMeter(i,s){return Z(1,i)*s}pixelSpaceConversion(i,s,u){return 1}farthestPixelDistance(i){return AD(i,i.pixelsPerMeter)}pointCoordinate(i,s,u,d){const g=i.horizonLineFromTop(!1),_=new bt(s,Math.max(g,u));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,d))}pointCoordinate3D(i,s,u){const d=new bt(s,u);if(i.elevation)return i.elevation.pointCoordinate(d);{const g=this.pointCoordinate(i,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(i,s){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,s.x,s.y);const u=i.horizonLineFromTop();return s.y<u}createInversionMatrix(i,s){return A$}createTileMatrix(i,s,u){let d,g,_;const w=u.canonical,T=me(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=jy(w,this);d=1,g=E.x+u.wrap*E.scale,_=E.y,Re(T,T,[d/E.scale,d/E.scale,i.pixelsPerMeter/s])}else d=s/i.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*u.wrap)*d,_=w.y*d;return ge(T,T,[g,_,0]),Re(T,T,[d/Bt,d/Bt,1]),T}upVector(i,s,u){return[0,0,1]}upVectorScale(i,s,u){return{metersToTile:1}}}class C$ extends hd{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[s,u]=this.parallels=i.parallels||[29.5,45.5],d=Math.sin(fi(s));this.n=(d+Math.sin(fi(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(i,s){const{n:u,c:d,r0:g}=this,_=fi(i-this.center[0]),w=fi(s),T=Math.sqrt(d-2*u*Math.sin(w))/u;return{x:T*Math.sin(_*u),y:T*Math.cos(_*u)-g,z:0}}unproject(i,s){const{n:u,c:d,r0:g}=this,_=g+s;let w=Math.atan2(i,Math.abs(_))*Math.sign(_);_*u<0&&(w-=Math.PI*Math.sign(i)*Math.sign(_));const T=fi(this.center[0])*u;w=Je(w,-Math.PI-T,Math.PI-T);const E=he(Ge(w/u)+this.center[0],-180,180),C=Math.asin(he((d-(i*i+_*_)*u*u)/(2*u),-1,1)),R=he(Ge(C),-fe,fe);return new L(E,R)}}const Gy=1.340264,$y=-.081106,Hy=893e-6,qy=.003796,Pw=Math.sqrt(3)/2;class P$ extends hd{project(i,s){s=s/180*Math.PI,i=i/180*Math.PI;const u=Math.asin(Pw*Math.sin(s)),d=u*u,g=d*d*d;return{x:.5*(i*Math.cos(u)/(Pw*(Gy+3*$y*d+g*(7*Hy+9*qy*d)))/Math.PI+.5),y:1-.5*(u*(Gy+$y*d+g*(Hy+qy*d))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=u*u,g=d*d*d;for(let C,R,M,z=0;z<12&&(R=u*(Gy+$y*d+g*(Hy+qy*d))-s,M=Gy+3*$y*d+g*(7*Hy+9*qy*d),C=R/M,u=he(u-C,-Math.PI/3,Math.PI/3),d=u*u,g=d*d*d,!(Math.abs(C)<1e-12));++z);const _=Pw*i*(Gy+3*$y*d+g*(7*Hy+9*qy*d))/Math.cos(u),w=Math.asin(Math.sin(u)/Pw),T=he(180*_/Math.PI,-180,180),E=he(180*w/Math.PI,-fe,fe);return new L(T,E)}}class R$ extends hd{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){return{x:.5+i/360,y:.5-s/360,z:0}}unproject(i,s){const u=360*(i-.5),d=he(360*(.5-s),-fe,fe);return new L(u,d)}}const zm=Math.PI/2;function Rw(l){return Math.tan((zm+l)/2)}class k$ extends hd{constructor(i){super(i),this.center=i.center||[0,30];const[s,u]=this.parallels=i.parallels||[30,30];let d=fi(s),g=fi(u);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const _=Math.cos(d),w=Rw(d);this.n=d===g?Math.sin(d):Math.log(_/Math.cos(g))/Math.log(Rw(g)/w),this.f=_*Math.pow(Rw(d),this.n)/this.n}project(i,s){s=fi(s),this.southernCenter&&(s=-s),i=fi(i-this.center[0]);const u=1e-6,{n:d,f:g}=this;g>0?s<-zm+u&&(s=-zm+u):s>zm-u&&(s=zm-u);const _=g/Math.pow(Rw(s),d);let w=_*Math.sin(d*i),T=g-_*Math.cos(d*i);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(i,s){i=(2*i-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:u,f:d}=this,g=d-s,_=Math.sign(g),w=Math.sign(u)*Math.sqrt(i*i+g*g);let T=Math.atan2(i,Math.abs(g))*_;g*u<0&&(T-=Math.PI*Math.sign(i)*_);const E=he(Ge(T/u)+this.center[0],-180,180),C=he(Ge(2*Math.atan(Math.pow(d/w,1/u))-zm),-fe,fe);return new L(E,this.southernCenter?-C:C)}}class PD extends hd{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,s){return{x:$(i),y:X(s),z:0}}unproject(i,s){const u=te(i),d=re(s);return new L(u,d)}}const RD=fi(fe);class M$ extends hd{project(i,s){const u=(s=fi(s))*s,d=u*u;return{x:.5*((i=fi(i))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let u=s=(2*(1-s)-1)*Math.PI,d=25,g=0,_=u*u;do{_=u*u;const E=_*_;g=(u*(1.007226+_*(.015085+E*(.028874*_-.044475-.005916*E)))-s)/(1.007226+_*(.045255+E*(.259866*_-.311325-.005916*11*E))),u=he(u-g,-RD,RD)}while(Math.abs(g)>1e-6&&--d>0);_=u*u;const w=he(Ge(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=Ge(u);return new L(w,T)}}const kD=fi(fe);class D$ extends hd{project(i,s){s=fi(s),i=fi(i);const u=Math.cos(s),d=2/Math.PI,g=Math.acos(u*Math.cos(i/2)),_=Math.sin(g)/g,w=.5*(i*d+2*u*Math.sin(i/2)/_)||0,T=.5*(s+Math.sin(s)/_)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(i,s){let u=i=(2*i-.5)*Math.PI,d=s=(2*(1-s)-1)*Math.PI,g=25;const _=1e-6;let w=0,T=0;do{const E=Math.cos(d),C=Math.sin(d),R=2*C*E,M=C*C,z=E*E,F=Math.cos(u/2),G=Math.sin(u/2),H=2*F*G,K=G*G,ie=1-z*F*F,ne=ie?1/ie:0,se=ie?Math.acos(E*F)*Math.sqrt(1/ie):0,Se=.5*(2*se*E*G+2*u/Math.PI)-i,we=.5*(se*C+d)-s,Te=.5*ne*(z*K+se*E*F*M)+1/Math.PI,Oe=ne*(H*R/4-se*C*G),Ne=.125*ne*(R*G-se*C*z*H),at=.5*ne*(M*F+se*K*E)+.5,He=Oe*Ne-at*Te;w=(we*Oe-Se*at)/He,T=(Se*Ne-we*Te)/He,u=he(u-w,-Math.PI,Math.PI),d=he(d-T,-kD,kD)}while((Math.abs(w)>_||Math.abs(T)>_)&&--g>0);return new L(Ge(u),Ge(d))}}class MD extends hd{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){const{scale:u,cosPhi:d}=this;return{x:fi(i)*d*u+.5,y:-Math.sin(fi(s))/d*u+.5,z:0}}unproject(i,s){const{scale:u,cosPhi:d}=this,g=-(s-.5)/u,_=he(Ge((i-.5)/u)/d,-180,180),w=Math.asin(he(g*d,-1,1)),T=he(Ge(w),-fe,fe);return new L(_,T)}}class L$ extends PD{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,s,u){const d=_y(i,s,u);return Wi(d,d,sw(au(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(i,s,u){const d=I(s.lat,s.lng),g=qn([],d),_=u?i._centerAltitude+u:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(s),i._centerAltitude):i._centerAltitude;oi(d,d,g,Z(1,0)*Bt*_);const w=me(new Float64Array(16));return de(w,i.pixelMatrix,i.globeMatrix),Wi(d,d,w),new bt(d[0],d[1])}pixelsPerMeter(i,s){return Z(1,0)*s}pixelSpaceConversion(i,s,u){const d=Z(1,i)*s,g=gn(Z(1,45)*s,d,u);return this.pixelsPerMeter(i,s)/g}createTileMatrix(i,s,u){const d=OE(au(u.canonical));return de(new Float64Array(16),i.globeMatrix,d)}createInversionMatrix(i,s){const{center:u}=i,d=sw(au(s));return ct(d,d,fi(u.lng)),_t(d,d,fi(u.lat)),Re(d,d,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(i,s,u,d){return ik(i,s,u,!0)||new ve(0,0)}pointCoordinate3D(i,s,u){const d=this.pointCoordinate(i,s,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(i,s){return!ik(i,s.x,s.y,!1)}farthestPixelDistance(i){const s=function(d,g){const _=d.cameraToCenterDistance,w=d._centerAltitude*g,T=d._camera,E=d._camera.forward(),C=ii([],Pn([],E,-_),[0,0,w]),R=d.worldSize/(2*Math.PI),M=[0,0,-R],z=d.width/d.height,F=Math.tan(d.fovAboveCenter),G=Pn([],T.up(),F),H=Pn([],T.right(),F*z),K=qn([],ii([],ii([],E,G),H)),ie=[];let ne;if(new Ti(C,K).closestPointOnSphere(M,R,ie)){const se=ii([],ie,M),Se=Vi([],se,C);ne=Math.cos(d.fovAboveCenter)*Be(Se)}else{const se=Vi([],C,M),Se=Vi([],M,C);qn(Se,Se);const we=Be(se)-R;ne=Math.sqrt(we*(we+2*R));const Te=Math.acos(ne/(R+we))-Math.acos(zi(E,Se));ne*=Math.cos(Te)}return 1.01*ne}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),u=sd(i.zoom);if(u>0){const d=AD(i,Z(1,i.center.lat)*i.worldSize),g=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return gn(s,d+g*(1-Math.cos(_)),Math.pow(u,10))}return s}upVector(i,s,u){return _y(s,u,i,1)}upVectorScale(i){return{metersToTile:nw(rw(au(i)))}}}function DD(l){const i=l.parallels,s=!!i&&Math.abs(i[0]+i[1])<.01;switch(l.name){case"mercator":return new PD(l);case"equirectangular":return new R$(l);case"naturalEarth":return new M$(l);case"equalEarth":return new P$(l);case"winkelTripel":return new D$(l);case"albers":return s?new MD(l):new C$(l);case"lambertConformalConic":return s?new MD(l):new k$(l);case"globe":return new L$(l)}throw new Error(`Invalid projection name: ${l.name}`)}const O$=Ke.types,z$=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kw(l,i,s,u,d,g,_,w,T,E,C,R,M){const z=w?Math.min(ud,Math.round(w[0])):0,F=w?Math.min(ud,Math.round(w[1])):0;l.emplaceBack(i,s,Math.round(32*u),Math.round(32*d),g,_,(z<<1)+(T?1:0),F,16*E,16*C,256*R,256*M)}function Mw(l,i,s){l.emplaceBack(i,s)}function Dw(l,i,s,u,d,g,_){l.emplaceBack(i,s,u,d,g,_)}const Lw=(l,i,s,u)=>{for(let d=0;d<i;d++)l.emplaceBack(s[0],s[1],s[2],u[0],u[1],u[2])};function Ow(l,i,s,u,d){l.emplaceBack(i,s,u,d),l.emplaceBack(i,s,u,d),l.emplaceBack(i,s,u,d),l.emplaceBack(i,s,u,d)}function F$(l){for(const i of l.sections)if(xE(i.text))return!0;return!1}class AI{constructor(i){this.layoutVertexArray=new _m,this.indexArray=new yr,this.programConfigurations=i,this.segments=new Cr,this.dynamicLayoutVertexArray=new ru,this.opacityVertexArray=new ey,this.placedSymbolArray=new Pf,this.iconTransitioningVertexArray=new Hl,this.globeExtVertexArray=new Kh,this.zOffsetVertexArray=new $u,this.orientationVertexArray=new iy}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(i,s,u,d,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,jG.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,$G.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,z$,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,WG.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,GG.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,HG.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,qG.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Xt(AI,"SymbolBuffers");class CI{constructor(i,s,u){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new u,this.segments=new Cr,this.collisionVertexArray=new Qh,this.collisionVertexArrayExt=new ru}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,ZG.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,XG.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xt(CI,"CollisionBuffers");class zw{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=me([]),this.placementViewportMatrix=me([]);const s=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.textSizeData=lD(this.zoom,s["text-size"],this.worldview),this.iconSizeData=lD(this.zoom,s["icon-size"],this.worldview);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(_=>Na[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new AI(new Ma(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new AI(new Ma(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new hy,this.lineVertexArray=new $0,this.symbolInstances=new G0}calculateGlyphDependencies(i,s,u,d,g){for(const _ of i){const w=_.codePointAt(0);if(w===void 0)break;if(s[w]=!0,d&&g&&w<=65535){const T=zy[_];T&&(s[T.charCodeAt(0)]=!0)}}}updateFootprints(i,s){}updateReplacement(i,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!hw(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(i,s,u,d){const g=this.layers[0],_=g.layout,w=this.projection.name==="globe",T=_.get("text-font"),E=_.get("text-field"),C=_.get("icon-image"),[R,M]=_.get("icon-size-scale-range"),z=he(s.scaleFactor||1,R,M),F=(E.value.kind!=="constant"||E.value.value instanceof Ot&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),G=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,H=_.get("symbol-sort-key");if(this.features=[],!F&&!G)return;const K=s.iconDependencies,ie=s.glyphDependencies,ne=s.availableImages,se=new Zi(this.zoom,{worldview:this.worldview});for(const{feature:Se,id:we,index:Te,sourceLayerIndex:Oe}of i){const Ne=g._featureFilter.needGeometry,at=rt(Se,Ne);if(!g._featureFilter.filter(se,at,u))continue;if(Ne||(at.geometry=Ce(Se,u,d)),w&&Se.type!==1&&u.z<=5){const It=at.geometry,Rt=.98078528056,st=(St,qe)=>zi(_y(St.x,St.y,u,1),_y(qe.x,qe.y,u,1))<Rt;for(let St=0;St<It.length;St++)It[St]=Ye(It[St],st)}let He,ht;if(F){const It=g.getValueAndResolveTokens("text-field",at,u,ne),Rt=Ot.factory(It);F$(Rt)&&(this.hasRTLText=!0),(!this.hasRTLText||W_()==="unavailable"||this.hasRTLText&&Gl.isParsed())&&(He=YG(Rt,g,at))}if(G){const It=g.getValueAndResolveTokens("icon-image",at,u,ne);ht=typeof It=="string"?Gi.build(It):It}if(!He&&!ht)continue;const Mt=this.sortFeaturesByKey?H.evaluate(at,{},u):void 0,gt={id:we,text:He,icon:ht,index:Te,sourceLayerIndex:Oe,geometry:at.geometry,properties:Se.properties,type:O$[Se.type],sortKey:Mt};if(this.features.push(gt),ht){const It=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Rt,iconSecondary:st}=TD(ht,this.iconSizeData,It["icon-size"],u,this.zoom,gt,this.pixelRatio,z,this.worldview),St=Rt.id.toString();if(K.has(St)?K.get(St).push(Rt):K.set(St,[Rt]),st){this.hasAnySecondaryIcon=!0;const qe=st.id.toString();K.has(qe)?K.get(qe).push(st):K.set(qe,[st])}}if(He){const It=T.evaluate(at,{},u).join(","),Rt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Na.vertical)>=0;for(const st of He.sections)if(st.image){const St=st.image.getPrimary().scaleSelf(this.pixelRatio),qe=St.id.toString(),ot=K.get(qe)||[];ot.push(St),K.set(qe,ot)}else{const St=G_(He.toString()),qe=st.fontStack||It,ot=ie[qe]=ie[qe]||{};this.calculateGlyphDependencies(st.text,ot,Rt,this.allowVerticalPlacement,St)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(Se){const we={},Te={},Oe=[];let Ne=0;function at(gt){Oe.push(Se[gt]),Ne++}function He(gt,It,Rt){const st=Te[gt];return delete Te[gt],Te[It]=st,Oe[st].geometry[0].pop(),Oe[st].geometry[0]=Oe[st].geometry[0].concat(Rt[0]),st}function ht(gt,It,Rt){const st=we[It];return delete we[It],we[gt]=st,Oe[st].geometry[0].shift(),Oe[st].geometry[0]=Rt[0].concat(Oe[st].geometry[0]),st}function Mt(gt,It,Rt){const st=Rt?It[0][It[0].length-1]:It[0][0];return`${gt}:${st.x}:${st.y}`}for(let gt=0;gt<Se.length;gt++){const It=Se[gt],Rt=It.geometry,st=It.text?It.text.toString():null;if(!st){at(gt);continue}const St=Mt(st,Rt),qe=Mt(st,Rt,!0);if(St in Te&&qe in we&&Te[St]!==we[qe]){const ot=ht(St,qe,Rt),zt=He(St,qe,Oe[ot].geometry);delete we[St],delete Te[qe],Te[Mt(st,Oe[zt].geometry,!0)]=zt,Oe[ot].geometry=null}else St in Te?He(St,qe,Rt):qe in we?ht(St,qe,Rt):(at(gt),we[St]=Ne-1,Te[qe]=Ne-1)}return Oe.filter(gt=>gt.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",s.elevationFeatures){!this.elevationFeatures&&s.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Se of s.elevationFeatures)this.elevationFeatureIdToIndex.set(Se.id,this.elevationFeatures.length),this.elevationFeatures.push(Se)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Se,we)=>Se.sortKey-we.sortKey)}update(i,s,u,d,g,_,w){this.text.programConfigurations.updatePaintArrays(i,s,g,u,d,_,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,s,g,u,d,_,w,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let s=!1;const u=_e(i),d=1/u;let g=!1,_=!1;for(let w=0;w<this.symbolInstances.length;w++){const T=this.symbolInstances.get(w),E=Hn(1,0,0),C=Hn(0,1,0),{numHorizontalGlyphVertices:R,numVerticalGlyphVertices:M,numIconVertices:z,numVerticalIconVertices:F}=T,G=R>0||M>0,H=z>0,K=this.elevationFeatures[T.elevationFeatureIndex];if(K){const ie=new bt(T.tileAnchorX,T.tileAnchorY),ne=.075+K.pointElevation(ie);T.zOffset!==ne&&(s=!0,T.zOffset=ne);const se=K.computeSlopeNormal(ie,d),Se=er(ko(),Hn(0,0,1),se);Po(E,E,Se),Po(C,C,Se),E[2]*=u,C[2]*=u,E[0]===1&&E[1]===0&&E[2]===0&&C[0]===0&&C[1]===1&&C[2]===0||(g=g||G,_=_||H)}if(G&&(Lw(this.text.orientationVertexArray,R,E,C),Lw(this.text.orientationVertexArray,M,E,C)),H){const{placedIconSymbolIndex:ie,verticalPlacedIconSymbolIndex:ne}=T;ie>=0&&Lw(this.icon.orientationVertexArray,z,E,C),ne>=0&&Lw(this.icon.orientationVertexArray,F,E,C)}}g||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),s&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(g,_,w)=>{u+=_,u>g.length&&g.resize(u);for(let T=-_;T<0;T++)g.emplace(T+u,w)},s=(g,_,w)=>{d+=_,d>g.length&&g.resize(d);for(let T=-_;T<0;T++)g.emplace(T+d,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:T,numIconVertices:E}=_,C=_.zOffset,R=E>0;if((w>0||T>0)&&(i(this.text.zOffsetVertexArray,w,C),i(this.text.zOffsetVertexArray,T,C)),R){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:z}=_;M>=0&&s(this.icon.zOffsetVertexArray,E,C),z>=0&&s(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=DD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const u=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:d,y:g}of s)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(i,s,u,d,g,_,w,T,E,C,R,M,z,F,G,H){const K=i.indexArray,ie=i.layoutVertexArray,ne=i.globeExtVertexArray,se=i.segments.prepareSegment(4*s.length,ie,K,this.canOverlap?_.sortKey:void 0),Se=this.glyphOffsetArray.length,we=se.vertexLength,Te=this.allowVerticalPlacement&&w===Na.vertical?Math.PI/2:0,Oe=_.text&&_.text.sections;for(let at=0;at<s.length;at++){const{tl:He,tr:ht,bl:Mt,br:gt,texPrimary:It,texSecondary:Rt,pixelOffsetTL:st,pixelOffsetBR:St,minFontScaleX:qe,minFontScaleY:ot,glyphOffset:zt,isSDF:At,sectionIndex:ln}=s[at],Kt=se.vertexLength,Tt=zt[1];if(kw(ie,E.x,E.y,He.x,Tt+He.y,It.x,It.y,u,At,st.x,st.y,qe,ot),kw(ie,E.x,E.y,ht.x,Tt+ht.y,It.x+It.w,It.y,u,At,St.x,st.y,qe,ot),kw(ie,E.x,E.y,Mt.x,Tt+Mt.y,It.x,It.y+It.h,u,At,st.x,St.y,qe,ot),kw(ie,E.x,E.y,gt.x,Tt+gt.y,It.x+It.w,It.y+It.h,u,At,St.x,St.y,qe,ot),T){const{x:Ct,y:Jt,z:Wt}=T.anchor,[Vt,Zt,Tn]=T.up;Dw(ne,Ct,Jt,Wt,Vt,Zt,Tn),Dw(ne,Ct,Jt,Wt,Vt,Zt,Tn),Dw(ne,Ct,Jt,Wt,Vt,Zt,Tn),Dw(ne,Ct,Jt,Wt,Vt,Zt,Tn),Ow(i.dynamicLayoutVertexArray,Ct,Jt,Wt,Te)}else Ow(i.dynamicLayoutVertexArray,E.x,E.y,E.z,Te);if(H){const Ct=Rt||It;Mw(i.iconTransitioningVertexArray,Ct.x,Ct.y),Mw(i.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y),Mw(i.iconTransitioningVertexArray,Ct.x,Ct.y+Ct.h),Mw(i.iconTransitioningVertexArray,Ct.x+Ct.w,Ct.y+Ct.h)}K.emplaceBack(Kt,Kt+1,Kt+2),K.emplaceBack(Kt+1,Kt+2,Kt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zt[0]),at!==s.length-1&&ln===s[at+1].sectionIndex||i.programConfigurations.populatePaintArrays(ie.length,_,_.index,{},z,F,G,Oe&&Oe[ln],this.worldview)}const Ne=T?T.anchor:E;i.placedSymbolArray.emplaceBack(Ne.x,Ne.y,Ne.z,E.x,E.y,Se,this.glyphOffsetArray.length-Se,we,C,R,E.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],w,0,0,0,M,0)}_commitLayoutVertex(i,s,u,d,g,_,w){i.emplaceBack(s,u,d,g,_,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,s,u,d,g,_,w){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=T.vertexLength,C=w.tileAnchorX,R=w.tileAnchorY;for(let z=0;z<4;z++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,s,i.padding,w.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,g,_,C,R,new bt(i.x1,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,_,C,R,new bt(i.x2,i.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,_,C,R,new bt(i.x2,i.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,g,_,C,R,new bt(i.x1,i.y2)),T.vertexLength+=4;const M=u.indexArray;M.emplaceBack(E,E+1),M.emplaceBack(E+1,E+2),M.emplaceBack(E+2,E+3),M.emplaceBack(E+3,E),T.primitiveLength+=4}_addTextDebugCollisionBoxes(i,s,u,d,g,_){for(let w=d;w<g;w++){const T=u.get(w),E=this.getSymbolInstanceTextSize(i,_,s,w);this._addCollisionDebugVertices(T,E,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,s,u,d,g,_){for(let w=d;w<g;w++){const T=u.get(w),E=this.getSymbolInstanceIconSize(i,s,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,E,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,s,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new CI(ym,WM.members,Hl),this.iconCollisionBox=new CI(ym,WM.members,Hl);const d=Ny(this.iconSizeData,i),g=Ny(this.textSizeData,i,u);for(let _=0;_<this.symbolInstances.length;_++){const w=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,i,s,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(g,i,s,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(d,i,s,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(d,i,s,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(i,s,u,d){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:d),_=xI(this.textSizeData,i,g)/Ks;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,s,u){const d=this.icon.placedSymbolArray.get(u),g=xI(this.iconSizeData,i,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(i,s,u,d){i.emplaceBack(s,-u,-u,d),i.emplaceBack(s,u,-u,d),i.emplaceBack(s,u,u,d),i.emplaceBack(s,-u,u,d)}_updateTextDebugCollisionBoxes(i,s,u,d,g,_,w){for(let T=d;T<g;T++){const E=u.get(T),C=this.getSymbolInstanceTextSize(i,_,s,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,E.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(i,s,u,d,g,_,w){for(let T=d;T<g;T++){const E=u.get(T),C=this.getSymbolInstanceIconSize(i,s,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,E.padding,_.zOffset)}}updateCollisionDebugBuffers(i,s,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=Ny(this.iconSizeData,i,d),_=Ny(this.textSizeData,i,u);for(let w=0;w<this.symbolInstances.length;w++){const T=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(_,i,s,T.textBoxStartIndex,T.textBoxEndIndex,T,u),this._updateTextDebugCollisionBoxes(_,i,s,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,u),this._updateIconDebugCollisionBoxes(g,i,s,T.iconBoxStartIndex,T.iconBoxEndIndex,T,d),this._updateIconDebugCollisionBoxes(g,i,s,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,s,u,d,g,_,w,T,E){const C={};if(s<u){const{x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se,featureIndex:Se}=i.get(s);C.textBox={x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se},C.textFeatureIndex=Se}if(d<g){const{x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se,featureIndex:Se}=i.get(d);C.verticalTextBox={x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se},C.verticalTextFeatureIndex=Se}if(_<w){const{x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se,featureIndex:Se}=i.get(_);C.iconBox={x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se},C.iconFeatureIndex=Se}if(T<E){const{x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se,featureIndex:Se}=i.get(T);C.verticalIconBox={x1:R,y1:M,x2:z,y2:F,padding:G,projectedAnchorX:H,projectedAnchorY:K,projectedAnchorZ:ie,tileAnchorX:ne,tileAnchorY:se},C.verticalIconFeatureIndex=Se}return C}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,s){const u=i.placedSymbolArray.get(s),d=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<d;g+=4)i.indexArray.emplaceBack(g,g+1,g+2),i.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(i),u=Math.cos(i),d=[],g=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const T=this.symbolInstances.get(w);d.push(0|Math.round(s*T.tileAnchorX+u*T.tileAnchorY)),g.push(T.featureIndex)}return _.sort((w,T)=>d[w]-d[T]||g[T]-g[w]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,s){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===s?u.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const u=this.symbolInstances.get(s);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:E}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let LD,OD,PI;Xt(zw,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),zw.addDynamicAttributes=Ow;class zD{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:dc,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt(zD,"FormatSectionOverride",{omit:["defaultValue"]});const RI=()=>PI||(PI={layout:LD||(LD=new Gr({"symbol-placement":new Lt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Lt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Lt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ht($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Lt($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Lt($e.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Lt($e.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Lt($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Lt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Lt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Lt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ht($e.layout_symbol["icon-size"]),"icon-size-scale-range":new Lt($e.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ht($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ht($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ht($e.layout_symbol["icon-image"]),"icon-rotate":new Ht($e.layout_symbol["icon-rotate"]),"icon-padding":new Lt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Lt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Ht($e.layout_symbol["icon-offset"]),"icon-anchor":new Ht($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Lt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Lt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Lt($e.layout_symbol["text-rotation-alignment"]),"text-field":new Ht($e.layout_symbol["text-field"]),"text-font":new Ht($e.layout_symbol["text-font"]),"text-size":new Ht($e.layout_symbol["text-size"]),"text-size-scale-range":new Lt($e.layout_symbol["text-size-scale-range"]),"text-max-width":new Ht($e.layout_symbol["text-max-width"]),"text-line-height":new Ht($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Ht($e.layout_symbol["text-letter-spacing"]),"text-justify":new Ht($e.layout_symbol["text-justify"]),"text-radial-offset":new Ht($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Lt($e.layout_symbol["text-variable-anchor"]),"text-anchor":new Ht($e.layout_symbol["text-anchor"]),"text-max-angle":new Lt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Lt($e.layout_symbol["text-writing-mode"]),"text-rotate":new Ht($e.layout_symbol["text-rotate"]),"text-padding":new Lt($e.layout_symbol["text-padding"]),"text-keep-upright":new Lt($e.layout_symbol["text-keep-upright"]),"text-transform":new Ht($e.layout_symbol["text-transform"]),"text-offset":new Ht($e.layout_symbol["text-offset"]),"text-allow-overlap":new Lt($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Lt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Lt($e.layout_symbol["text-optional"]),visibility:new Lt($e.layout_symbol.visibility)})),paint:OD||(OD=new Gr({"icon-opacity":new Ht($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ht($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ht($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ht($e.paint_symbol["text-emissive-strength"]),"icon-color":new Ht($e.paint_symbol["icon-color"]),"icon-halo-color":new Ht($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ht($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ht($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Lt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Lt($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Lt($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ht($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ht($e.paint_symbol["text-occlusion-opacity"]),"text-color":new Ht($e.paint_symbol["text-color"],{runtimeType:zs,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ht($e.paint_symbol["text-halo-color"]),"text-halo-width":new Ht($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Ht($e.paint_symbol["text-halo-blur"]),"text-translate":new Lt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Lt($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Lt($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Lt($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Lt($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Lt($e.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ht($e.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},PI);class Fw extends bo{constructor(i,s,u,d){super(i,RI(),s,u,d),this._colorAdjustmentMatrix=me([]),this.hasInitialOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,s){super.recalculate(i,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const g of u)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,s,u,d){return this._saturation===i&&this._contrast===s&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(g,_,w,T){g=Os(g),_=Ls(_);const E=oe(),C=g/3,R=1-2*C,M=[R,C,C,0,C,R,C,0,C,C,R,0,0,0,0,1],z=.5-.5*_,F=T-w;return de(E,[F,0,0,0,0,F,0,0,0,0,F,0,w,w,w,1],[_,0,0,0,0,_,0,0,0,0,_,0,z,z,z,1]),de(E,E,M),E}(i,s,u,d),this._saturation=i,this._contrast=s,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,s,u,d){const g=this.layout.get(i).evaluate(s,{},u,d),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||B_(_.value)||!g?g:function(w,T){return T.replace(/{([^{}]+)}/g,(E,C)=>C in w?String(w[C]):"")}(s.properties,g)}createBucket(i){return new zw(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of RI().paint.overridableProperties){if(!Fw.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),u=new zD(s),d=new N_(u,s.property.specification,this.scope,this.options);let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new sm("source",d):new Jc("composite",d,s.value.zoomStops,s.value.interpolationType),this.paint._values[i]=new Gu(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,u){return!(!this.layout||s.isDataDriven()||u.isDataDriven())&&Fw.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const u=i.get("text-field"),d=RI().paint.properties[s];let g=!1;const _=w=>{for(const T of w)if(d.overrides&&d.overrides.hasOverride(T))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Ot)_(u.value.value.sections);else if(u.value.kind==="source"){const w=E=>{g||(E instanceof bn&&Ut(E.value)===jc?_(E.value.sections):E instanceof Rh?_(E.sections):E.eachChild(w))},T=u.value;T._styleExpression&&w(T._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,s,u){return{config:new No(this,{zoom:s,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let FD,ND,BD,VD;var kI=di([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Nw(l,i,s,u,d,g,_,w){const T=[l,i,1,s,u,1,d,g,1],E=[_,w,1],C=j([],T),[R,M,z]=$s(E,E,C);return Q(T,T,[R,0,0,0,M,0,0,0,z])}function UD(l,i,s,u,d,g,_,w){const T=function(E,C,R,M,z,F,G,H){const K=Nw(0,0,1,0,1,1,0,1),ie=Nw(E,C,R,M,z,F,G,H);return Q(ie,ie,j([],K))}(l,i,s,u,d,g,_,w);return[T[2]/T[8]/Bt,T[5]/T[8]/Bt]}function Bw(l){return[l[0],Math.min(Math.max(l[1],-fe),fe)]}class jD extends Nl{constructor(i,s,u,d){super(),this.id=i,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=s,this._dirty=!1}load(i,s){if(this._loaded=s||!1,this.fire(new $a("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=gl(this.map._requestManager.transformRequest(this.url,Cu.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new so(u)):d&&(this.image=d instanceof HTMLImageElement?fn.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Dy(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $a("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Dy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=i[0][1],u=i[0][1];for(const g of i)g[1]>u&&(u=g[1]),g[1]<s&&(s=g[1]);const d=(u+s)/2;if(d>fe?this.onNorthPole=!0:d<-fe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=i.map(ve.fromLngLat);this.tileID=function(_){let w=1/0,T=1/0,E=-1/0,C=-1/0;for(const G of _)w=Math.min(w,G.x),T=Math.min(T,G.y),E=Math.max(E,G.x),C=Math.max(C,G.y);const R=Math.max(E-w,C-T),M=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),z=Math.pow(2,M);let F=Math.floor((w+E)/2*z);return F>1&&(F-=1),new Oa(M,F,Math.floor((T+C)/2*z))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $a("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Dy||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const K in this.tiles){const ie=this.tiles[K];ie.state!=="loaded"&&(ie.state="loaded",ie.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=jy(new Oa(0,0,0),this.map.transform.projection),u=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(K){const ie=K[1].x-K[0].x,ne=K[1].y-K[0].y,se=K[2].x-K[1].x,Se=K[2].y-K[1].y,we=K[3].x-K[2].x,Te=K[3].y-K[2].y,Oe=K[0].x-K[3].x,Ne=K[0].y-K[3].y,at=ie*Se-se*ne,He=se*Te-we*Se,ht=we*Ne-Oe*Te,Mt=Oe*ne-ie*Ne;return at>0&&He>0&&ht>0&&Mt>0||at<0&&He<0&&ht<0&&Mt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=jy(this.tileID,this.map.transform.projection),[g,_,w,T]=this.coordinates.map(K=>{const ie=d.projection.project(K[0],K[1]);return CD(d,ie)._round()});this.perspectiveTransform=UD(g.x,g.y,_.x,_.y,w.x,w.y,T.x,T.y);const E=this._boundsArray=new Zh;E.emplaceBack(g.x,g.y,0,0),E.emplaceBack(_.x,_.y,Bt,0),E.emplaceBack(T.x,T.y,0,Bt),E.emplaceBack(w.x,w.y,Bt,Bt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(E,kI.members),this.boundsSegments=Cr.simpleSegment(0,0,4,2);const C=[],R=[Bw((M=this.coordinates)[0]),Bw(M[1]),Bw(M[2]),Bw(M[3])];var M;const[z,F,G,H]=function(K){let ie=K[0][0],ne=ie,se=K[0][1],Se=se;for(let we=1;we<K.length;we++)K[we][0]<ie?ie=K[we][0]:K[we][0]>ne&&(ne=K[we][0]),K[we][1]<se?se=K[we][1]:K[we][1]>Se&&(Se=K[we][1]);return[ie,se,ne-ie,Se-se]}(R);{const K=new Zh,[ie,ne,se,Se]=function(st){let St=st[0].x,qe=St,ot=st[0].y,zt=ot;for(let At=1;At<st.length;At++)st[At].x<St?St=st[At].x:st[At].x>qe&&(qe=st[At].x),st[At].y<ot?ot=st[At].y:st[At].y>zt&&(zt=st[At].y);return[St,ot,qe-St,zt-ot]}(u),we=st=>[(st.x-ie)/se,(st.y-ne)/Se],[Te,Oe,Ne,at]=u.map(we),He=function(st,St,qe,ot,zt,At,ln,Kt){const Tt=Nw(0,0,1,0,1,1,0,1);return Q(Tt,Tt,j([],Nw(st,St,qe,ot,zt,At,ln,Kt)))}(Te[0],Te[1],Oe[0],Oe[1],Ne[0],Ne[1],at[0],at[1]);this.elevatedGlobePerspectiveTransform=UD(Te[0],Te[1],Oe[0],Oe[1],Ne[0],Ne[1],at[0],at[1]);const ht=(st,St)=>{C.push(st.lng);const qe=Math.round((st.lng-z)/G*Bt),ot=Math.round((st.lat-F)/H*Bt),zt=we(St),At=$s([],[zt[0],zt[1],1],He),ln=Math.round(At[0]/At[2]*Bt),Kt=Math.round(At[1]/At[2]*Bt);K.emplaceBack(qe,ot,ln,Kt)},Mt=u[3].x-u[0].x,gt=u[3].y-u[0].y,It=u[2].x-u[1].x,Rt=u[2].y-u[1].y;for(let st=0;st<65;st++){const St=st/64,qe=[u[0].x+St*Mt,u[0].y+St*gt],ot=[u[1].x+St*It,u[1].y+St*Rt],zt=ot[0]-qe[0],At=ot[1]-qe[1];for(let ln=0;ln<65;ln++){const Kt=ln/64,Tt={x:qe[0]+zt*Kt,y:qe[1]+At*Kt};ht(s.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(K,kI.members)}{this.maxLongitudeTriangleSize=0;let K=[],ie=new yr;const ne=(se,Se,we)=>{ie.emplaceBack(se,Se,we);const Te=C[se],Oe=C[Se],Ne=C[we],at=Math.min(Math.min(Te,Oe),Ne),He=Math.max(Math.max(Te,Oe),Ne)-at;He>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=He),K.push(at+He/2)};for(let se=0;se<64;se++)for(let Se=0;Se<64;Se++){const we=65*se+Se,Te=we+1,Oe=we+65,Ne=Oe+1;ne(we,Oe,Te),ne(Te,Oe,Ne)}[K,ie]=function(se,Se){const we=Array.from({length:se.length},(Ne,at)=>at);we.sort((Ne,at)=>se[Ne]-se[at]);const Te=[],Oe=new yr;for(let Ne=0;Ne<we.length;Ne++){const at=we[Ne];Te.push(se[at]);const He=3*at,ht=He+1;Oe.emplaceBack(Se.uint16[He],Se.uint16[ht],Se.uint16[ht+1])}return[Te,Oe]}(K,ie),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(ie)}this.elevatedGlobeSegments=Cr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,G/Bt,0,H/Bt,0,0,F,z,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const s=this.map.painter.context,u=s.gl;!this._dirty||this.texture instanceof Dy||(this.texture?this.texture.update(this.image):(this.texture=new oI(s,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(s)}loadTile(i,s){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},s(null)):(i.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=i+180)+360*Math.round((u[0]-g)/360);var g;const _=new Cr,w=(R,M)=>{_.segments.push({vertexOffset:0,primitiveOffset:R,vertexLength:s.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=T){const R=ls(u,0,u.length,d+T);return R===u.length||w(R,cr(u,R+1,u.length,d+360-T)-R),_}d<u[0]&&(d+=360);const E=cr(u,0,u.length,d-T);if(E===u.length)return w(0,u.length),_;w(0,E-0);const C=ls(u,E+1,u.length,d+T);return C!==u.length&&w(C,u.length-C),_}}const N$=(Math.pow(256,2)-1)/16907520;class GD extends bo{constructor(i,s,u,d){super(i,{layout:BD||(BD=new Gr({visibility:new Lt($e.layout_raster.visibility)})),paint:VD||(VD=new Gr({"raster-opacity":new Lt($e.paint_raster["raster-opacity"]),"raster-color":new Gh($e.paint_raster["raster-color"]),"raster-color-mix":new Lt($e.paint_raster["raster-color-mix"]),"raster-color-range":new Lt($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new Lt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Lt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Lt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Lt($e.paint_raster["raster-saturation"]),"raster-contrast":new Lt($e.paint_raster["raster-contrast"]),"raster-resampling":new Lt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Lt($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Lt($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new Lt($e.paint_raster["raster-array-band"]),"raster-elevation":new Lt($e.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof jD&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=yy({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let $D,HD,qD,WD,ZD;class XD extends bo{constructor(i,s,u,d){super(i,{layout:$D||($D=new Gr({visibility:new Lt($e["layout_raster-particle"].visibility)})),paint:HD||(HD=new Gr({"raster-particle-array-band":new Lt($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Lt($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Gh($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Lt($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Lt($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Lt($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Lt($e["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Lt($e["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},s,u,d),this._updateColorRamp(),this.lastInvalidatedAt=fn.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=yy({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=fn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class B$ extends bo{constructor(i,s){super(i,{},s,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function MI(l,i,s){const u=[0,0,1],d=io([]);return ra(d,d,s?-fi(l)+Math.PI:fi(l)),Mo(d,d,-fi(i)),Po(u,u,d),qn(u,u)}const KD={None:0,Model:1,Symbol:2,FillExtrusion:4};class Vw{constructor(i,s,u,d){this.message=(i?`${i}: `:"")+u,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)}}function DI(l,i){const s=l.indexOf("://")===-1;try{return new URL(l,s&&i?"http://example.com":void 0),!0}catch{return!1}}class YD{constructor(i,s){this.feature=i,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class QD{constructor(){this.instancedDataArray=new vm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class LI{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs}updateFootprints(i,s){}populate(i,s,u,d){this.tileToMeter=_e(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:w,index:T,sourceLayerIndex:E}of i){const C=w??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),R=rt(_,g);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom,{worldview:this.worldview}),R,u))continue;const M={id:C,sourceLayerIndex:E,index:T,geometry:g?R.geometry:Ce(_,u,d),properties:_.properties,type:_.type,patterns:{}},z=this.addFeature(M,M.geometry,R);z&&s.featureIndex.insert(_,M.geometry,T,E,this.index,this.instancesPerModel[z].instancedDataArray.length,Bt/32)}this.lookup=null}update(i,s,u,d){for(const g in this.instancesPerModel){const _=this.instancesPerModel[g];for(const w in i)_.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(_.features[_.idToFeaturesIndex[w]],i[w],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];for(const d of u.features){const g=this.layers[0],_=d.feature,w=this.canonical,T=g.paint.get("model-rotation").evaluate(_,{},w),E=g.paint.get("model-scale").evaluate(_,{},w),C=g.paint.get("model-translation").evaluate(_,{},w);Hs(d.rotation,T)&&Hs(d.scale,E)&&Hs(d.translation,C)||(this.evaluate(d,d.featureStates,u,!0),i=!0)}}return i}updateReplacement(i,s,u,d){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const g=s.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(hw(this.activeReplacements,g))return!1;this.activeReplacements=g;let _=!1;for(const w in this.instancesPerModel){const T=this.instancesPerModel[w],E=T.instancedDataArray;for(const C of T.features){const R=C.instancedDataOffset,M=C.instancedDataCount;for(let z=0;z<M;z++){const F=16*(z+R);let G=E.float32[F+0];const H=G>Bt;G=H?G-Bt:G;const K=Math.floor(G),ie=E.float32[F+1];let ne=!1;for(const se of this.activeReplacements)if(!Bk(se,u,KD.Model,d)&&!(se.min.x>K||K>se.max.x||se.min.y>ie||ie>se.max.y)&&(ne=ZE(Gk(K,ie,i.canonical,se.footprintTileId.canonical),se.footprint),ne))break;E.float32[F]=ne?G+Bt:G,_=_||ne!==H}}}return _}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=i.createVertexBuffer(u.instancedDataArray,yG.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)i.removeModel(s,"",!0)}addFeature(i,s,u){const d=this.layers[0],g=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return ni(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),g;(DI(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new QD);const _=this.instancesPerModel[g],w=_.instancedDataArray,T=new YD(u,w.length);for(const E of s)for(const C of E){if(C.x<0||C.x>=Bt||C.y<0||C.y>=Bt)continue;const R=(this.lookupDim-1)/Bt,M=this.lookupDim*(C.y*R|0)+C.x*R|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const z=w.length;w.resize(z+1),_.instancesEvaluatedElevation.push(0),w.float32[16*z]=C.x,w.float32[16*z+1]=C.y}return T.instancedDataCount=_.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(i.id&&(_.idToFeaturesIndex[i.id]=_.features.length),_.features.push(T),this.evaluate(T,{},_,!1)),g}getModelUris(){return this.modelUris}evaluate(i,s,u,d){const g=this.layers[0],_=i.feature,w=this.canonical,T=i.rotation=g.paint.get("model-rotation").evaluate(_,s,w),E=i.scale=g.paint.get("model-scale").evaluate(_,s,w),C=i.translation=g.paint.get("model-translation").evaluate(_,s,w),R=g.paint.get("model-color").evaluate(_,s,w);R.a=g.paint.get("model-color-mix-intensity").evaluate(_,s,w);const M=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),EM(M,T,E);const z=Math.round(100*R.a)+R.b/1.05;for(let F=0;F<i.instancedDataCount;++F){const G=i.instancedDataOffset+F,H=16*G,K=u.instancedDataArray.float32;let ie=0;d&&(ie=K[H+6]-u.instancesEvaluatedElevation[G]);const ne=0|K[H+1];K[H]=(0|K[H])+R.r/1.05,K[H+1]=ne+R.g/1.05,K[H+2]=z,K[H+3]=1/(w.z>10?this.tileToMeter:_e(w,ne)),K[H+4]=C[0],K[H+5]=C[1],K[H+6]=C[2]+ie,K[H+7]=M[0],K[H+8]=M[1],K[H+9]=M[2],K[H+10]=M[4],K[H+11]=M[5],K[H+12]=M[6],K[H+13]=M[8],K[H+14]=M[9],K[H+15]=M[10],u.instancesEvaluatedElevation[G]=C[2]}}}let JD,eL;Xt(LI,"ModelBucket",{omit:["layers"]}),Xt(QD,"PerModelAttributes"),Xt(YD,"ModelFeature");class Fm{constructor(i,s,u){this._demTile=i,this._dem=this._demTile.dem,this._scale=s,this._offset=u}static create(i,s,u){const d=u||i.findDEMTileFor(s);if(!d||!d.dem)return;const g=d.dem,_=d.tileID,w=1<<s.canonical.z-_.canonical.z;return new Fm(d,g.dim/Bt/w,[(s.canonical.x/w-_.canonical.x)*g.dim,(s.canonical.y/w-_.canonical.y)*g.dim])}tileCoordToPixel(i,s){const u=s*this._scale+this._offset[1];return new bt(Math.floor(i*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(i,s,u,d){const g=i*this._scale+this._offset[0],_=s*this._scale+this._offset[1],w=Math.floor(g),T=Math.floor(_),E=this._dem;return d=!!d,u?gn(gn(E.get(w,T,d),E.get(w,T+1,d),_-T),gn(E.get(w+1,T,d),E.get(w+1,T+1,d),_-T),g-w):E.get(w,T,d)}getElevationAtPixel(i,s,u){return this._dem.get(i,s,!!u)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Z(1,i)*this._dem.stride}}const OI=new Float32Array(262144),jf=new Uint8Array(262144);function tL(l){let i=0;if(l.meshes)for(const s of l.meshes)i=Math.max(i,s.aabb.max[2]);if(l.children)for(const s of l.children)i=Math.max(i,tL(s));return i}function nL(l,i,s){if(l.meshes)for(const u of l.meshes){if(u.aabb.min[0]===1/0)continue;const d=ti.applyTransform(u.aabb,l.matrix);s.insert(i,d.min[0],d.min[1],d.max[0],d.max[1])}if(l.children)for(const u of l.children)nL(u,i,s)}const iL=["","wall","door","roof","window","lamp","logo"];class rL{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:tL(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const s=new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==i&&(u.transformedAabb=ti.applyTransformFast(u.aabb,this.node.matrix),s.encapsulate(u.transformedAabb)),i++;this.aabb=s}return this.aabb}}class Uw{constructor(i,s,u,d,g,_,w,T){this.id=u,this.layers=i,this.layerIds=this.layers.map(E=>E.fqid),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.modelTraits|=km.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=km.HasMapboxMeshFeatures),g&&(this.modelTraits|=km.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const E of s)this.nodesInfo.push(new rL(E)),nL(E,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,s){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&s.push({footprint:d.footprint,id:i})}}update(i){const s=Object.keys(i).length!==0;if(s&&!this.stateDependentLayers.length)return;const u=s?this.stateDependentLayers:this.layers;if(!Lo(i,this.states))for(const d of u)this.evaluate(d,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const u of s){const d=u.node;this.uploaded?this.updatePbrBuffer(d):cI(d,i,!0)}for(const u of s)ww(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let s=!1;if(!i.meshes)return s;for(const u of i.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),s=!0);return s}needsReEvaluation(i,s,u){const d=i.transform.projectionOptions,g=i.style.getBrightness(),_=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Wy(u.paint.get("model-color").value,_)||Wy(u.paint.get("model-color-mix-intensity").value,_)||Wy(u.paint.get("model-roughness").value,_)||Wy(u.paint.get("model-emissive-strength").value,_)||Wy(u.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=d,this.brightness=g;const w=this.getNodesInfo();for(const T of w)T.state=null;return!0}return!1}evaluateTransform(i,s){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const g of u){const _=g.feature;g.evaluatedTranslation=s.paint.get("model-translation").evaluate(_,{},d),g.evaluatedScale=s.paint.get("model-scale").evaluate(_,{},d)}}evaluate(i,s){const u=this.getNodesInfo();for(const d of u){if(!d.node.meshes)continue;const g=d.feature,_=s&&s[g.id];if(Lo(_,d.state))continue;d.state=structuredClone(_);const w=d.node.meshes&&d.node.meshes[0].featureData,T=d.evaluatedColor[2],E=d.evaluatedRMEA[2],C=this.id.canonical;if(d.hasTranslucentParts=!1,w){for(let R=0;R<iL.length;R++){const M=iL[R];M.length&&(g.properties.part=M);const z=i.paint.get("model-color").evaluate(g,_,C).toPremultipliedRenderColor(null),F=i.paint.get("model-color-mix-intensity").evaluate(g,_,C);d.evaluatedColor[R]=[z.r,z.g,z.b,F],d.evaluatedRMEA[R][0]=i.paint.get("model-roughness").evaluate(g,_,C),d.evaluatedRMEA[R][2]=i.paint.get("model-emissive-strength").evaluate(g,_,C),d.evaluatedRMEA[R][3]=z.a,d.emissionHeightBasedParams[R]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,_,C),!d.hasTranslucentParts&&z.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,U$(d,T!==d.evaluatedColor[2]||E!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(g,_,C);d.evaluatedTranslation=i.paint.get("model-translation").evaluate(g,_,C),d.evaluatedScale=i.paint.get("model-scale").evaluate(g,_,C),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,s,u,d){const g=i.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const _=Fm.create(i,u,g);if(!_)return;this.modelTraits&km.HasMapboxMeshFeatures&&this.updateDEM(i,_,u,d);for(const w of this.getNodesInfo()){const T=w.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const E=T.footprint.vertices;let C=_.getElevationAt(E[0].x,E[0].y,!0,!0);for(let R=1;R<E.length;R++)C=Math.min(C,_.getElevationAt(E[R].x,E[R].y,!0,!0));T.elevation=C}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=s}}updateDEM(i,s,u,d){let g=s._dem._modifiedForSources[d];if(g===void 0&&(s._dem._modifiedForSources[d]=[],g=s._dem._modifiedForSources[d]),g.includes(u.canonical))return;const _=s._dem.dim;g.push(u.canonical);let w=!1;for(const T of this.getNodesInfo()){const E=T.node;if(!E.footprint||!E.footprint.grid)continue;const C=E.footprint.grid,R=s.tileCoordToPixel(C.min.x,C.min.y),M=s.tileCoordToPixel(C.max.x,C.max.y),z=Math.min(Math.min(_-M.y,R.x),Math.min(R.y,_-M.x));if(z<0)continue;const F=he(z,2,5);let G=Math.max(0,R.x-F),H=Math.max(0,R.y-F),K=Math.min(M.x+F,_-1),ie=Math.min(M.y+F,_-1);for(let we=H;we<=ie;++we)for(let Te=G;Te<=K;++Te)jf[we*_+Te]=255;let ne=0,se=0;for(let we=0;we<C.cellsY;++we)for(let Te=0;Te<C.cellsX;++Te){if(!C.cells[we*C.cellsX+Te])continue;const Oe=s.tileCoordToPixel(C.min.x+Te/C.xScale,C.min.y+we/C.yScale),Ne=s.tileCoordToPixel(C.min.x+(Te+1)/C.xScale,C.min.y+(we+1)/C.yScale);for(let at=Oe.y;at<=Math.min(Ne.y+1,_-1);++at)for(let He=Oe.x;He<=Math.min(Ne.x+1,_-1);++He)jf[at*_+He]===255&&(jf[at*_+He]=0,ne+=s.getElevationAtPixel(He,at),se++)}const Se=ne/se;G=Math.max(1,R.x-F),H=Math.max(1,R.y-F),K=Math.min(M.x+F,_-2),ie=Math.min(M.y+F,_-2),w=!0;for(let we=H;we<=ie;++we)for(let Te=G;Te<=K;++Te)jf[we*_+Te]===0&&(OI[we*_+Te]=s._dem.set(Te,we,Se));for(let we=1;we<F;++we){G=Math.max(1,R.x-we),H=Math.max(1,R.y-we),K=Math.min(M.x+we,_-2),ie=Math.min(M.y+we,_-2);for(let Te=H;Te<=ie;++Te)for(let Oe=G;Oe<=K;++Oe){const Ne=Te*_+Oe;if(jf[Ne]===255){let at=0,He=0,ht=-1,Mt=-1;for(let gt=-1;gt<=1;++gt)for(let It=-1;It<=1;++It){const Rt=(Te+gt)*_+Oe+It;if(jf[Rt]>=we)continue;const st=OI[Rt],St=Math.abs(st);St>He&&(at=st,He=St,ht=It,Mt=gt)}if(He>.1){const gt=1-(we+.5*Math.abs(ht*Mt))/F;let It=s._dem.get(Oe,Te)+at*gt;const Rt=s._dem.get(Oe+ht,Te+Mt),st=s._dem.get(Oe-ht,Te-Mt,!0);(It-Rt)*(It-st)>0&&(It=(Rt+st)/2),OI[Ne]=s._dem.set(Oe,Te,It),jf[Ne]=we}}}}}w&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=fn.now())}setFilter(i){this.filter=i?$h(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new Zi(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const s of i)ww(s.node),uI(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const u=s.getReplacementRegionsForTile(i.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!u.find(_=>_.footprint===g)}}getHeightAtTileCoord(i,s){const u=[],d=[0,0,0],g=me([]);for(const _ of this.getNodesInfo()){const w=_.node.meshes[0],T=w.transformedAabb;if(i<T.min[0]||s<T.min[1]||i>T.max[0]||s>T.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};Ue(g,_.node.matrix),d[0]=i,d[1]=s,Wi(d,d,g);const E=(d[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*Bf|0,C=Math.min(63,(d[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*Bf|0)*Bf+Math.min(63,E),R=w.heightmap[C];if(!(R<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:R,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new bt(i,s),new bt(i,s),u),u.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Wy(l,i){return l instanceof sm&&!l.isLightConstant&&i}function V$(l,i,s,u,d,g,_,w){let T=(61440&i|(61440&i)>>4)>>8,E=(3840&i|(3840&i)>>4)>>4,C=240&i|(240&i)>>4;s[3]>0&&(T=gn(T,255*s[0],s[3]),E=gn(E,255*s[1],s[3]),C=gn(C,255*s[2],s[3]));const R=T<<8|E,M=C<<8|Math.floor(255*u[3]),z=function(we){const Te=he(we,0,2);return Math.min(Math.round(.5*Te*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],F=he(d[0],0,1),G=he(d[1],0,1),H=he(d[2],0,1),K=he(d[3],0,1);let ie,ne,se,Se;if(F!==G&&_!==g&&G!==F){const we=_-g;ne=1/(we*(G-F)),se=-(g+we*F)/(we*(G-F));const Te=he(d[4],-1,1);Se=Math.pow(10,Te),ie=255*H<<8|255*K}else ie=65535,ne=0,se=1,Se=1;if(l.emplaceBack(R,M,z,ie,ne,se,Se),w){const we=w.length;w.clear();for(let Te=0;Te<we;Te++)w.emplaceBack(R,M,z,ie,ne,se,Se)}}function U$(l,i,s){const u=l.node;let d=0;const g=s&km.HasMeshoptCompression;for(const _ of u.meshes){if(u.lights&&u.lightMeshIndex===d||!_.featureData)continue;_.featureArray=new ed,_.featureArray.reserve(_.featureData.length);let w=i;for(const T of _.featureData){const E=g?65535&T:T>>16&65535,C=g?T>>16&65535:65535&T,R=(15&C)<8?15&C:0,M=l.evaluatedRMEA[R],z=l.evaluatedColor[R],F=l.emissionHeightBasedParams[R];let G;if(w&&R===2&&u.lights&&(G=new ed,G.resize(10*u.lights.length)),V$(_.featureArray,E,z,M,F,_.aabb.min[2],_.aabb.max[2],G),G&&w){w=!1;const H=u.meshes[u.lightMeshIndex];H.featureArray=G,H.featureArray._trim()}}_.featureArray._trim(),d++}}function sL(l,i,s,u){const d=1<<l.z;i.lat=re((u/Bt+l.y)/d),i.lng=te((s/Bt+l.x)/d)}function j$(l,i,s,u){const d=l.getNodesInfo()[i];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const _=d.node,w=s.tile,T=u.calculatePosMatrix(w.tileID.toUnwrapped(),u.worldSize),E=d.evaluatedScale;let C=0;u.elevation&&_.elevation&&(C=_.elevation*u.elevation.exaggeration()),ge(T,T,[(_.anchor?_.anchor[0]:0)*(E[0]-1),(_.anchor?_.anchor[1]:0)*(E[1]-1),C]),Re(T,T,E);const R=s.queryGeometry,M=R.isPointQuery()?R.screenBounds:R.screenGeometry,z=function(G){const H=de([],T,G.matrix);de(H,u.expandedFarZProjMatrix,H);for(let K=0;K<G.meshes.length;++K){const ie=G.meshes[K];if(K===G.lightMeshIndex)continue;const ne=IM(M,u,H,ie.aabb);ne!=null&&(g=Math.min(ne,g))}if(G.children)for(const K of G.children)z(K)};if(z(_),g===Number.MAX_VALUE)return;const F=new L(0,0);return sL(w.tileID.canonical,F,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:F,feature:d.feature}}Xt(Uw,"Tiled3dModelBucket",{omit:["layers"]}),Xt(rL,"Tiled3dModelFeature");const G$={circle:class extends bo{constructor(l,i,s,u){super(l,{layout:ou||(ou=new Gr({"circle-sort-key":new Ht($e.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Lt($e.layout_circle["circle-elevation-reference"]),visibility:new Lt($e.layout_circle.visibility)})),paint:id||(id=new Gr({"circle-radius":new Ht($e.paint_circle["circle-radius"]),"circle-color":new Ht($e.paint_circle["circle-color"]),"circle-blur":new Ht($e.paint_circle["circle-blur"]),"circle-opacity":new Ht($e.paint_circle["circle-opacity"]),"circle-translate":new Lt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Lt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Lt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Lt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ht($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ht($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ht($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Lt($e.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u)}createBucket(l){return new Di(l)}queryRadius(l){const i=l;return Xs("circle-radius",this,i)+Xs("circle-stroke-width",this,i)+Wr(this.paint.get("circle-translate"))}queryIntersectsFeature(l,i,s,u,d,g,_,w){const T=qu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s);return dk(l,u,g,_,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,i,s){const u=hk(this);return{config:new No(this,{zoom:i,lut:s}),defines:u,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends bo{createBucket(l){return new pk(l)}constructor(l,i,s,u){super(l,{layout:mk||(mk=new Gr({visibility:new Lt($e.layout_heatmap.visibility)})),paint:gk||(gk=new Gr({"heatmap-radius":new Ht($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ht($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Lt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gh($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Lt($e.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(l){return Xs("heatmap-radius",this,l)}queryIntersectsFeature(l,i,s,u,d,g,_,w){const T=this.paint.get("heatmap-radius").evaluate(i,s);return dk(l,u,g,_,w,!0,!0,new bt(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,i,s){return l==="heatmap"?{config:new No(this,{zoom:i,lut:s}),overrideFog:!1}:{}}},hillshade:class extends bo{constructor(l,i,s,u){super(l,{layout:_k||(_k=new Gr({visibility:new Lt($e.layout_hillshade.visibility)})),paint:yk||(yk=new Gr({"hillshade-illumination-direction":new Lt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Lt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Lt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Lt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Lt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Lt($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Lt($e.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,i,s){return{overrideFog:!1}}},fill:class extends bo{constructor(l,i,s,u){super(l,{layout:Dk||(Dk=new Gr({"fill-sort-key":new Ht($e.layout_fill["fill-sort-key"]),visibility:new Lt($e.layout_fill.visibility),"fill-elevation-reference":new Lt($e.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ht($e.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Lk||(Lk=new Gr({"fill-antialias":new Lt($e.paint_fill["fill-antialias"]),"fill-opacity":new Ht($e.paint_fill["fill-opacity"]),"fill-color":new Ht($e.paint_fill["fill-color"]),"fill-outline-color":new Ht($e.paint_fill["fill-outline-color"]),"fill-translate":new Lt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Lt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ht($e.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Lt($e.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Lt($e.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ht($e.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ht($e.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ht($e.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u)}getProgramIds(){const l=this.paint.get("fill-pattern"),i=l&&l.constantOr(1),s=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(l,i,s){return{config:new No(this,{zoom:i,lut:s}),overrideFog:!1}}recalculate(l,i){super.recalculate(l,i);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new HE(l)}queryRadius(){return Wr(this.paint.get("fill-translate"))}queryIntersectsFeature(l,i,s,u,d,g){return!l.queryGeometry.isAboveHorizon&&Yr(La(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?i&&!l:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends bo{constructor(l,i,s,u){super(l,{layout:iM||(iM=new Gr({visibility:new Lt($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Lt($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:rM||(rM=new Gr({"fill-extrusion-opacity":new Lt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ht($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Lt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Lt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ht($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Lt($e["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ht($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ht($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Lt($e["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Lt($e["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Lt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Lt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Lt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Lt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Lt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Lt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Lt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Lt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ht($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ht($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Lt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Lt($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Lt($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Lt($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ht($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ht($e["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Lt($e["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new fw(l)}queryRadius(){return Wr(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,i,s,u,d,g,_,w,T){const E=qu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(i,s),R=this.paint.get("fill-extrusion-base").evaluate(i,s),M=[0,0],z=w&&g.elevation,F=g.elevation?g.elevation.exaggeration():1,G=l.tile.getBucket(this);if(z&&G instanceof fw){const se=G.centroidVertexArray,Se=T+1;Se<se.length&&(M[0]=se.geta_centroid_pos0(Se),M[1]=se.geta_centroid_pos1(Se))}if(M[0]===0&&M[1]===1)return!1;g.projection.name==="globe"&&(u=nM([u],[new bt(0,0),new bt(Bt,Bt)],l.tileID.canonical).map(se=>se.polygon).flat());const H=z?w:null,[K,ie]=function(se,Se,we,Te,Oe,Ne,at,He,ht,Mt,gt){return se.projection.name==="globe"?function(It,Rt,st,St,qe,ot,zt,At,ln,Kt,Tt){const Ct=[],Jt=[],Wt=It.projection.upVectorScale(Tt,It.center.lat,It.worldSize).metersToTile,Vt=[0,0,0,1],Zt=[0,0,0,1],Tn=(Un,On,li,Yn)=>{Un[0]=On,Un[1]=li,Un[2]=Yn,Un[3]=1},kn=tM();st>0&&(st+=kn),St+=kn;for(const Un of Rt){const On=[],li=[];for(const Yn of Un){const hr=Yn.x+qe.x,ce=Yn.y+qe.y,ue=It.projection.projectTilePoint(hr,ce,Tt),it=It.projection.upVector(Tt,Yn.x,Yn.y);let Ft=st,Gt=St;if(zt){const jt=uM(hr,ce,st,St,zt,At,ln,Kt);Ft+=jt.base,Gt+=jt.top}st!==0?Tn(Vt,ue.x+it[0]*Wt*Ft,ue.y+it[1]*Wt*Ft,ue.z+it[2]*Wt*Ft):Tn(Vt,ue.x,ue.y,ue.z),Tn(Zt,ue.x+it[0]*Wt*Gt,ue.y+it[1]*Wt*Gt,ue.z+it[2]*Wt*Gt),Wi(Vt,Vt,ot),Wi(Zt,Zt,ot),On.push(new Ff(Vt[0],Vt[1],Vt[2])),li.push(new Ff(Zt[0],Zt[1],Zt[2]))}Ct.push(On),Jt.push(li)}return[Ct,Jt]}(se,Se,we,Te,Oe,Ne,at,He,ht,Mt,gt):at?function(It,Rt,st,St,qe,ot,zt,At,ln){const Kt=[],Tt=[],Ct=[0,0,0,1];for(const Jt of It){const Wt=[],Vt=[];for(const Zt of Jt){const Tn=Zt.x+St.x,kn=Zt.y+St.y,Un=uM(Tn,kn,Rt,st,ot,zt,At,ln);Ct[0]=Tn,Ct[1]=kn,Ct[2]=Un.base,Ct[3]=1,Es(Ct,Ct,qe),Ct[3]=Math.max(Ct[3],1e-5);const On=new Ff(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Ct[0]=Tn,Ct[1]=kn,Ct[2]=Un.top,Ct[3]=1,Es(Ct,Ct,qe),Ct[3]=Math.max(Ct[3],1e-5);const li=new Ff(Ct[0]/Ct[3],Ct[1]/Ct[3],Ct[2]/Ct[3]);Wt.push(On),Vt.push(li)}Kt.push(Wt),Tt.push(Vt)}return[Kt,Tt]}(Se,we,Te,Oe,Ne,at,He,ht,Mt):function(It,Rt,st,St,qe){const ot=[],zt=[],At=qe[8]*Rt,ln=qe[9]*Rt,Kt=qe[10]*Rt,Tt=qe[11]*Rt,Ct=qe[8]*st,Jt=qe[9]*st,Wt=qe[10]*st,Vt=qe[11]*st;for(const Zt of It){const Tn=[],kn=[];for(const Un of Zt){const On=Un.x+St.x,li=Un.y+St.y,Yn=qe[0]*On+qe[4]*li+qe[12],hr=qe[1]*On+qe[5]*li+qe[13],ce=qe[2]*On+qe[6]*li+qe[14],ue=qe[3]*On+qe[7]*li+qe[15],it=Yn+At,Ft=hr+ln,Gt=ce+Kt,jt=Math.max(ue+Tt,1e-5),Yt=Yn+Ct,An=hr+Jt,ri=ce+Wt,si=Math.max(ue+Vt,1e-5);Tn.push(new Ff(it/jt,Ft/jt,Gt/jt)),kn.push(new Ff(Yt/si,An/si,ri/si))}ot.push(Tn),zt.push(kn)}return[ot,zt]}(Se,we,Te,Oe,Ne)}(g,u,R,C,E,_,H,M,F,g.center.lat,l.tileID.canonical),ne=l.queryGeometry;return function(se,Se,we){let Te=1/0;Yr(we,Se)&&(Te=cM(we,Se[0]));for(let Oe=0;Oe<Se.length;Oe++){const Ne=Se[Oe],at=se[Oe];for(let He=0;He<Ne.length-1;He++){const ht=Ne[He],Mt=[ht,Ne[He+1],at[He+1],at[He],ht];Qi(we,Mt)&&(Te=Math.min(Te,cM(we,Mt)))}}return Te!==1/0&&Te}(K,ie,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},building:class extends bo{constructor(l,i,s,u){super(l,{layout:LM||(LM=new Gr({visibility:new Lt($e.layout_building.visibility),"building-facade":new Ht($e.layout_building["building-facade"]),"building-facade-floors":new Ht($e.layout_building["building-facade-floors"]),"building-facade-window":new Ht($e.layout_building["building-facade-window"]),"building-roof-shape":new Ht($e.layout_building["building-roof-shape"]),"building-height":new Ht($e.layout_building["building-height"]),"building-base":new Ht($e.layout_building["building-base"])})),paint:OM||(OM=new Gr({"building-opacity":new Lt($e.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Lt($e.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Lt($e.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Lt($e.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Lt($e.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Lt($e.paint_building["building-vertical-scale"]),"building-cast-shadows":new Lt($e.paint_building["building-cast-shadows"]),"building-color":new Ht($e.paint_building["building-color"]),"building-emissive-strength":new Ht($e.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Lt($e.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Lt($e.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new DM(l)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(l){return!0}},line:class extends bo{constructor(l,i,s,u){const d=HM();super(l,d,i,s,u),d.layout&&(this.layout=new vl(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof gf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,i){super.recalculate(l,i),this.paint._values["line-floorwidth"]=(()=>{if(Oy)return Oy;const s=HM();return Oy=new UG(s.paint.properties["line-width"].specification),Oy.useIntegerZoom=!0,Oy})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new fI(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,i,s){const u=GM(this);return{config:new No(this,{zoom:i,lut:s}),defines:u,overrideFog:!1}}queryRadius(l){const i=l,s=qM(Xs("line-width",this,i),Xs("line-gap-width",this,i)),u=Xs("line-offset",this,i);return s/2+Math.abs(u)+Wr(this.paint.get("line-translate"))}queryIntersectsFeature(l,i,s,u,d,g){if(l.queryGeometry.isAboveHorizon)return!1;const _=La(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,l.pixelToTileUnitsFactor),w=l.pixelToTileUnitsFactor/2*qM(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),T=this.paint.get("line-offset").evaluate(i,s);return T&&(u=function(E,C){const R=[],M=new bt(0,0);for(let z=0;z<E.length;z++){const F=E[z],G=[];for(let H=0;H<F.length;H++){const K=F[H],ie=F[H+1],ne=H===0?M:K.sub(F[H-1])._unit()._perp(),se=H===F.length-1?M:ie.sub(K)._unit()._perp(),Se=ne._add(se)._unit();Se._mult(1/(Se.x*se.x+Se.y*se.y)),G.push(Se._mult(C)._add(K))}R.push(G)}return R}(u,T*l.pixelToTileUnitsFactor)),function(E,C,R){for(let M=0;M<C.length;M++){const z=C[M];if(E.length>=3){for(let F=0;F<z.length;F++)if(ao(E,z[F]))return!0}if(os(E,z,R))return!0}return!1}(_,u,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Fw,background:class extends bo{constructor(l,i,s,u){super(l,{layout:FD||(FD=new Gr({visibility:new Lt($e.layout_background.visibility)})),paint:ND||(ND=new Gr({"background-pitch-alignment":new Lt($e.paint_background["background-pitch-alignment"]),"background-color":new Lt($e.paint_background["background-color"]),"background-pattern":new Lt($e.paint_background["background-pattern"]),"background-opacity":new Lt($e.paint_background["background-opacity"]),"background-emissive-strength":new Lt($e.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,i,s){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:GD,"raster-particle":XD,sky:class extends bo{constructor(l,i,s,u){super(l,{layout:qD||(qD=new Gr({visibility:new Lt($e.layout_sky.visibility)})),paint:WD||(WD=new Gr({"sky-type":new Lt($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new Lt($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Lt($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Lt($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Lt($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new Gh($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Lt($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Lt($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Lt($e.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=yy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(l,i){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,g=l.style.light,_=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&ni("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?MI(_.azimuthal,90-_.polar,i):MI(u[0],90-u[1],i)}const s=this.paint.get("sky-gradient-center");return MI(s[0],90-s[1],i)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends bo{constructor(l,i,s,u){super(l,{paint:ZD||(ZD=new Gr({}))},i,null)}},model:class extends bo{constructor(l,i,s,u){super(l,{layout:JD||(JD=new Gr({visibility:new Lt($e.layout_model.visibility),"model-id":new Ht($e.layout_model["model-id"])})),paint:eL||(eL=new Gr({"model-opacity":new Ht($e.paint_model["model-opacity"]),"model-rotation":new Ht($e.paint_model["model-rotation"]),"model-scale":new Ht($e.paint_model["model-scale"]),"model-translation":new Ht($e.paint_model["model-translation"]),"model-color":new Ht($e.paint_model["model-color"]),"model-color-mix-intensity":new Ht($e.paint_model["model-color-mix-intensity"]),"model-type":new Lt($e.paint_model["model-type"]),"model-cast-shadows":new Lt($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new Lt($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Lt($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ht($e.paint_model["model-emissive-strength"]),"model-roughness":new Ht($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ht($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Lt($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Lt($e.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ht({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new LI(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof Uw?Bt-1:0}queryIntersectsFeature(l,i,s,u,d,g){if(!this.modelManager)return!1;const _=this.modelManager,w=l.tile.getBucket(this);if(!(w&&w instanceof LI))return!1;for(const T in w.instancesPerModel){const E=w.instancesPerModel[T],C=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(C)){const R=E.features[E.idToFeaturesIndex[C]],M=_.getModel(T,this.scope);if(!M)return!1;let z=oe();const F=new L(0,0),G=w.canonical;let H=Number.MAX_VALUE;for(let K=0;K<R.instancedDataCount;++K){const ie=16*(R.instancedDataOffset+K),ne=E.instancedDataArray.float32,se=[ne[ie+4],ne[ie+5],ne[ie+6]];sL(G,F,ne[ie],0|ne[ie+1]),SM(z,M,g,F,R.rotation,R.scale,se,!1,!1,!1),g.projection.name==="globe"&&(z=lI(z,g));const Se=de([],g.projMatrix,z),we=l.queryGeometry,Te=IM(we.isPointQuery()?we.screenBounds:we.screenGeometry,g,Se,M.aabb);Te!=null&&(H=Math.min(Te,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(l,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const i=this._transitionablePaint._values[l];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof Jc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends bo{constructor(l,i,s,u){super(l,{layout:Ok||(Ok=new Gr({"clip-layer-types":new Lt($e.layout_clip["clip-layer-types"]),"clip-layer-scope":new Lt($e.layout_clip["clip-layer-scope"])})),paint:zk||(zk=new Gr({}))},i,s,u)}recalculate(l,i){super.recalculate(l,i)}createBucket(l){return new Fk(l)}is3D(l){return!0}}},zI=new wi(0,0,0),FI={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},NI={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},jw={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},$$={PAINT_ORDER_FILL_AND_STROKE:1},Zy={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},oL={MASK_TYPE_LUMINANCE:1};function H$(l,i,s){l===1&&i.icons.push(function(u,d){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:_}=g;if(_.content_area){const{content_area:w}=_;w.top==null&&(w.top=w.left),w.width==null&&(w.width=g.usvg_tree.width),w.height==null&&(w.height=w.width)}return _.stretch_x&&_.stretch_x.length&&aL(_,"x"),_.stretch_y&&_.stretch_y.length&&aL(_,"y"),g}(u.readFields(q$,{name:void 0},d))}(s,s.readVarint()+s.pos))}function aL(l,i){const s=[],u=l[`stretch_${i}`];let d=null;for(let g=0;g<u.length;g++)d===null?d=s.length===0?u[0]:s[s.length-1][1]+u[g]:(s.push([d,d+u[g]]),d=null);l[`stretch_${i}_areas`]=s}function q$(l,i,s){l===1?i.name=s.readString():l===2?i.metadata=function(u,d){return u.readFields(W$,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)}(s,s.readVarint()+s.pos):l===3&&(i.usvg_tree=function(u,d){return u.readFields(K$,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)}(s,s.readVarint()+s.pos),i.data="usvg_tree")}function W$(l,i,s){l===1?i.stretch_x=s.readPackedVarint():l===2?i.stretch_y=s.readPackedVarint():l===3?i.content_area=function(u,d){return u.readFields(Z$,{left:0},d)}(s,s.readVarint()+s.pos):l===4&&i.variables.push(function(u,d){return u.readFields(X$,{name:void 0},d)}(s,s.readVarint()+s.pos))}function Z$(l,i,s){l===1?i.left=s.readVarint():l===2?i.width=s.readVarint():l===3?i.top=s.readVarint():l===4&&(i.height=s.readVarint())}function X$(l,i,s){l===1?i.name=s.readString():l===2&&(i.rgb_color=Hw(s.readVarint()),i.value="rgb_color")}function K$(l,i,s){l===1?i.width=i.height=s.readVarint():l===2?i.height=s.readVarint():l===3?i.children.push(Gw(s,s.readVarint()+s.pos)):l===4?i.linear_gradients.push(function(u,d){return u.readFields(i9,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)}(s,s.readVarint()+s.pos)):l===5?i.radial_gradients.push(function(u,d){return u.readFields(s9,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)}(s,s.readVarint()+s.pos)):l===7?i.clip_paths.push(function(u,d){return u.readFields(o9,{children:[]},d)}(s,s.readVarint()+s.pos)):l===8&&i.masks.push(function(u,d){const g=u.readFields(a9,{left:0,width:20,mask_type:oL.MASK_TYPE_LUMINANCE,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(s,s.readVarint()+s.pos))}function Gw(l,i){return l.readFields(Y$,{},i)}function Y$(l,i,s){l===1?(i.group=function(u,d){return u.readFields(Q$,{opacity:255,children:[]},d)}(s,s.readVarint()+s.pos),i.node="group"):l===2&&(i.path=function(u,d){return u.readFields(e9,{paint_order:1,commands:[],step:1,diffs:[],rule:FI.PATH_RULE_NON_ZERO},d)}(s,s.readVarint()+s.pos),i.node="path")}function Q$(l,i,s){l===1?i.transform=$w(s,s.readVarint()+s.pos):l===2?i.opacity=s.readVarint():l===5?i.clip_path_idx=s.readVarint():l===6?i.mask_idx=s.readVarint():l===7&&i.children.push(Gw(s,s.readVarint()+s.pos))}function $w(l,i){return l.readFields(J$,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function J$(l,i,s){l===1?i.sx=s.readFloat():l===2?i.ky=s.readFloat():l===3?i.kx=s.readFloat():l===4?i.sy=s.readFloat():l===5?i.tx=s.readFloat():l===6&&(i.ty=s.readFloat())}function e9(l,i,s){l===1?i.fill=function(u,d){return u.readFields(t9,{rgb_color:zI,paint:"rgb_color",opacity:255},d)}(s,s.readVarint()+s.pos):l===2?i.stroke=function(u,d){return u.readFields(n9,{rgb_color:zI,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)}(s,s.readVarint()+s.pos):l===3?i.paint_order=s.readVarint():l===5?s.readPackedVarint(i.commands):l===6?i.step=s.readFloat():l===7?s.readPackedSVarint(i.diffs):l===8&&(i.rule=s.readVarint())}function t9(l,i,s){l===1?(i.rgb_color=Hw(s.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=s.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=s.readVarint(),i.paint="radial_gradient_idx"):l===5&&(i.opacity=s.readVarint())}function Hw(l){return new wi((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function n9(l,i,s){l===1?(i.rgb_color=Hw(s.readVarint()),i.paint="rgb_color"):l===2?(i.linear_gradient_idx=s.readVarint(),i.paint="linear_gradient_idx"):l===3?(i.radial_gradient_idx=s.readVarint(),i.paint="radial_gradient_idx"):l===5?s.readPackedFloat(i.dasharray):l===6?i.dashoffset=s.readFloat():l===7?i.miterlimit=s.readFloat():l===8?i.opacity=s.readVarint():l===9?i.width=s.readFloat():l===10?i.linecap=s.readVarint():l===11&&(i.linejoin=s.readVarint())}function i9(l,i,s){l===1?i.transform=$w(s,s.readVarint()+s.pos):l===2?i.spread_method=s.readVarint():l===3?i.stops.push(lL(s,s.readVarint()+s.pos)):l===4?i.x1=s.readFloat():l===5?i.y1=s.readFloat():l===6?i.x2=s.readFloat():l===7&&(i.y2=s.readFloat())}function lL(l,i){return l.readFields(r9,{offset:0,opacity:255,rgb_color:zI},i)}function r9(l,i,s){l===1?i.offset=s.readFloat():l===2?i.opacity=s.readVarint():l===3&&(i.rgb_color=Hw(s.readVarint()))}function s9(l,i,s){l===1?i.transform=$w(s,s.readVarint()+s.pos):l===2?i.spread_method=s.readVarint():l===3?i.stops.push(lL(s,s.readVarint()+s.pos)):l===4?i.cx=s.readFloat():l===5?i.cy=s.readFloat():l===6?i.r=s.readFloat():l===7?i.fx=s.readFloat():l===8?i.fy=s.readFloat():l===9&&(i.fr=s.readFloat())}function o9(l,i,s){l===1?i.transform=$w(s,s.readVarint()+s.pos):l===2?i.clip_path_idx=s.readVarint():l===3&&i.children.push(Gw(s,s.readVarint()+s.pos))}function a9(l,i,s){l===1?i.left=i.top=s.readFloat():l===2?i.width=i.height=s.readFloat():l===3?i.top=s.readFloat():l===4?i.height=s.readFloat():l===5?i.mask_type=s.readVarint():l===6?i.mask_idx=s.readVarint():l===7&&i.children.push(Gw(s,s.readVarint()+s.pos))}class l9{static calculate(i={},s=[]){const u=new Map,d=new Map;if(Object.keys(i).length===0)return u;s.forEach(g=>{d.set(g.name,g.rgb_color||new wi(0,0,0))});for(const[g,_]of Object.entries(i))d.has(g)?u.set(d.get(g).toString(),_):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function Nm(l,i=255,s){const u=i/255,d=l.toString(),g=s.has(d)?s.get(d).clone():l.clone();return g.a*=u,g.toString()}function Xy(l,i){if(!un()){const s=document.createElement("canvas");return s.width=l,s.height=i,s}return new OffscreenCanvas(l,i)}function c9(l,i){const s=l9.calculate(i.params,l.metadata?l.metadata.variables:[]),u=l.usvg_tree,d=u.width,g=u.height,_=i.transform?i.transform:new DOMMatrix,w=Math.max(1,Math.round(d*_.a)),T=Math.max(1,Math.round(g*_.d)),E=new DOMMatrix([w/d,0,0,T/g,0,0]),C=Xy(w,T).getContext("2d");return BI(C,E,u,u,s),C.getImageData(0,0,w,T)}function BI(l,i,s,u,d){for(const g of u.children)cL(l,i,s,g,d)}function cL(l,i,s,u,d){u.group?(l.save(),function(g,_,w,T,E){const C=T.mask_idx!=null?w.masks[T.mask_idx]:null,R=T.clip_path_idx!=null?w.clip_paths[T.clip_path_idx]:null;if(T.transform&&(_=Bm(T.transform).preMultiplySelf(_)),!function(F,G,H){return F.opacity!==255||G||H}(T,R!=null,C!=null))return void BI(g,_,w,T,E);const M=Xy(g.canvas.width,g.canvas.height),z=M.getContext("2d");BI(z,_,w,T,E),R&&gL(z,_,w,R),C&&_L(z,_,w,C,E),g.globalAlpha=T.opacity/255,g.drawImage(M,0,0)}(l,i,s,u.group,d),l.restore()):u.path&&(l.save(),function(g,_,w,T,E){g.setTransform(_),T.paint_order===$$.PAINT_ORDER_FILL_AND_STROKE?(uL(g,w,T,E),dL(g,w,T,E)):(dL(g,w,T,E),uL(g,w,T,E))}(l,i,s,u.path,d),l.restore())}function uL(l,i,s,u){const d=s.fill;if(!d)return;const g=d.opacity/255;switch(l.save(),l.beginPath(),yL(s,l),d.paint){case"rgb_color":l.fillStyle=Nm(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{const _=i.linear_gradients[d.linear_gradient_idx];_.transform&&l.setTransform(Bm(_.transform).preMultiplySelf(l.getTransform())),l.fillStyle=fL(l,_,g,u);break}case"radial_gradient_idx":{const _=i.radial_gradients[d.radial_gradient_idx];_.transform&&l.setTransform(Bm(_.transform).preMultiplySelf(l.getTransform())),l.fillStyle=pL(l,_,g,u)}}l.fill(hL(s)),l.restore()}function hL(l){return l.rule===FI.PATH_RULE_NON_ZERO?"nonzero":l.rule===FI.PATH_RULE_EVEN_ODD?"evenodd":void 0}function dL(l,i,s,u){const d=s.stroke;if(!d)return;const g=vL(s);l.lineWidth=d.width,l.miterLimit=d.miterlimit,l.setLineDash(d.dasharray),l.lineDashOffset=d.dashoffset;const _=d.opacity/255;switch(d.paint){case"rgb_color":l.strokeStyle=Nm(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":l.strokeStyle=fL(l,i.linear_gradients[d.linear_gradient_idx],_,u,!0);break;case"radial_gradient_idx":l.strokeStyle=pL(l,i.radial_gradients[d.radial_gradient_idx],_,u,!0)}switch(d.linejoin){case jw.LINE_JOIN_MITER_CLIP:case jw.LINE_JOIN_MITER:l.lineJoin="miter";break;case jw.LINE_JOIN_ROUND:l.lineJoin="round";break;case jw.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(d.linecap){case NI.LINE_CAP_BUTT:l.lineCap="butt";break;case NI.LINE_CAP_ROUND:l.lineCap="round";break;case NI.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(g)}function fL(l,i,s,u,d=!1){if(i.stops.length===1){const M=i.stops[0];return Nm(M.rgb_color,M.opacity*s,u)}const{x1:g,y1:_,x2:w,y2:T}=i;let E=new DOMPoint(g,_),C=new DOMPoint(w,T);if(d){const M=Bm(i.transform);E=M.transformPoint(E),C=M.transformPoint(C)}const R=l.createLinearGradient(E.x,E.y,C.x,C.y);for(const M of i.stops)R.addColorStop(M.offset,Nm(M.rgb_color,M.opacity*s,u));return R}function pL(l,i,s,u,d=!1){if(i.stops.length===1){const K=i.stops[0];return Nm(K.rgb_color,K.opacity*s,u)}const g=Bm(i.transform),{fx:_,fy:w,fr:T,cx:E,cy:C,r:R}=i;let M=new DOMPoint(_,w),z=new DOMPoint(E,C),F=T,G=R;if(d){M=g.transformPoint(M),z=g.transformPoint(z);const K=(g.a+g.d)/2;F=T*K,G=i.r*K}const H=l.createRadialGradient(M.x,M.y,F,z.x,z.y,G);for(const K of i.stops)H.addColorStop(K.offset,Nm(K.rgb_color,K.opacity*s,u));return H}function mL(l,i,s,u){const d=u.transform?Bm(u.transform).preMultiplySelf(i):i,g=Xy(l.canvas.width,l.canvas.height),_=g.getContext("2d");for(const T of u.children)if(T.group)mL(_,d,s,T.group);else if(T.path){const E=T.path,C=new Path2D;C.addPath(vL(E),d),_.fill(C,hL(E))}const w=u.clip_path_idx!=null?s.clip_paths[u.clip_path_idx]:null;w&&gL(_,d,s,w),l.globalCompositeOperation="source-over",l.drawImage(g,0,0)}function gL(l,i,s,u){const d=Xy(l.canvas.width,l.canvas.height);mL(d.getContext("2d"),i,s,u),l.globalCompositeOperation="destination-in",l.drawImage(d,0,0)}function _L(l,i,s,u,d){if(u.children.length===0)return;const g=u.mask_idx!=null?s.masks[u.mask_idx]:null;g&&_L(l,i,s,g,d);const _=l.canvas.width,w=l.canvas.height,T=Xy(_,w),E=T.getContext("2d"),C=u.width,R=u.height,M=u.left,z=u.top,F=new Path2D,G=new Path2D;G.rect(M,z,C,R),F.addPath(G,i),E.clip(F);for(const ie of u.children)cL(E,i,s,ie,d);const H=E.getImageData(0,0,_,w),K=H.data;if(u.mask_type===oL.MASK_TYPE_LUMINANCE)for(let ie=0;ie<K.length;ie+=4)K[ie+3]=K[ie+3]/255*(.2126*K[ie]+.7152*K[ie+1]+.0722*K[ie+2]);E.putImageData(H,0,0),l.globalCompositeOperation="destination-in",l.drawImage(T,0,0)}function Bm(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function yL(l,i){const s=l.step;let u=l.diffs[0]*s,d=l.diffs[1]*s;i.moveTo(u,d);for(let g=0,_=2;g<l.commands.length;g++)switch(l.commands[g]){case Zy.PATH_COMMAND_MOVE:u+=l.diffs[_++]*s,d+=l.diffs[_++]*s,i.moveTo(u,d);break;case Zy.PATH_COMMAND_LINE:u+=l.diffs[_++]*s,d+=l.diffs[_++]*s,i.lineTo(u,d);break;case Zy.PATH_COMMAND_QUAD:{const w=u+l.diffs[_++]*s,T=d+l.diffs[_++]*s;u=w+l.diffs[_++]*s,d=T+l.diffs[_++]*s,i.quadraticCurveTo(w,T,u,d);break}case Zy.PATH_COMMAND_CUBIC:{const w=u+l.diffs[_++]*s,T=d+l.diffs[_++]*s,E=w+l.diffs[_++]*s,C=T+l.diffs[_++]*s;u=E+l.diffs[_++]*s,d=C+l.diffs[_++]*s,i.bezierCurveTo(w,T,E,C,u,d);break}case Zy.PATH_COMMAND_CLOSE:i.closePath()}return i}function vL(l){return yL(l,new Path2D)}class qw{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const s=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,s),s}put(i,s){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,s)}delete(i){this.cache.delete(i)}}Xt(qw,"LRUCache");class VI{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new lo(i,i.data)}getFromCache(i,s,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new qw(150)),this.cacheMap.get(u).get(qh(i.toString(),s))}setInCache(i,s,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new qw(150));const g=this.cacheDependenciesMap.get(d),_=qh(i.id.toString(),u);g.get(_)||g.set(_,new Set);const w=this.cacheMap.get(d),T=i.toString();g.get(_).add(T),w.put(qh(i.toString(),u),s)}removeImagesFromCacheByIds(i,s,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const d=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const _ of i){const w=qh(_.toString(),s);if(g.has(w)){for(const T of g.get(w))d.delete(T);g.delete(w)}}}rasterize(i,s,u,d,g=c9){const _=this.getFromCache(i,u,d);if(_)return _.clone();const w=g(s.icon,i.options),T=VI._getImage(w);return this.setInCache(i,T,u,d),T.clone()}}class xL{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,s){const u=this.toIdx(i,s);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(i,s){return this.leaves[this.toIdx(i,s)]}toIdx(i,s){return s*this.size+i}}function wL(l,i,s,u){let d=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(u[_])<1e-15){if(s[_]<l[_]||s[_]>i[_])return null}else{const w=1/u[_];let T=(l[_]-s[_])*w,E=(i[_]-s[_])*w;if(T>E){const C=T;T=E,E=C}if(T>d&&(d=T),E<g&&(g=E),d>g)return null}return d}function bL(l,i,s,u,d,g,_,w,T,E,C){const R=u-l,M=d-i,z=g-s,F=_-l,G=w-i,H=T-s,K=C[1]*H-C[2]*G,ie=C[2]*F-C[0]*H,ne=C[0]*G-C[1]*F,se=R*K+M*ie+z*ne;if(Math.abs(se)<1e-15)return null;const Se=1/se,we=E[0]-l,Te=E[1]-i,Oe=E[2]-s,Ne=(we*K+Te*ie+Oe*ne)*Se;if(Ne<0||Ne>1)return null;const at=Te*z-Oe*M,He=Oe*R-we*z,ht=we*M-Te*R,Mt=(C[0]*at+C[1]*He+C[2]*ht)*Se;return Mt<0||Ne+Mt>1?null:(F*at+G*He+H*ht)*Se}function TL(l,i,s){return(l-i)/(s-i)}function EL(l,i,s,u,d,g,_,w,T){const E=1<<s,C=g-u,R=_-d,M=(l+1)/E*C+u,z=(i+0)/E*R+d,F=(i+1)/E*R+d;w[0]=(l+0)/E*C+u,w[1]=z,T[0]=M,T[1]=F}class IL{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const _=Math.ceil(Math.log2(g.dim/8)),w=[];let T=Math.ceil(Math.pow(2,_));const E=1/T,C=(z,F,G,H,K)=>{const ie=H?1:0,ne=(z+1)*G-ie,se=F*G,Se=(F+1)*G-ie;K[0]=z*G,K[1]=se,K[2]=ne,K[3]=Se};let R=new xL(T);const M=[];for(let z=0;z<T*T;z++){C(z%T,Math.floor(z/T),E,!1,M);const F=dd(M[0],M[1],g),G=dd(M[2],M[1],g),H=dd(M[2],M[3],g),K=dd(M[0],M[3],g);R.minimums.push(Math.min(F,G,H,K)),R.maximums.push(Math.max(F,G,H,K)),R.leaves.push(1)}for(w.push(R),T/=2;T>=1;T/=2){const z=w[w.length-1];R=new xL(T);for(let F=0;F<T*T;F++){C(F%T,Math.floor(F/T),2,!0,M);const G=z.getElevation(M[0],M[1]),H=z.getElevation(M[2],M[1]),K=z.getElevation(M[2],M[3]),ie=z.getElevation(M[0],M[3]),ne=z.isLeaf(M[0],M[1]),se=z.isLeaf(M[2],M[1]),Se=z.isLeaf(M[2],M[3]),we=z.isLeaf(M[0],M[3]),Te=Math.min(G.min,H.min,K.min,ie.min),Oe=Math.max(G.max,H.max,K.max,ie.max),Ne=ne&&se&&Se&&we;R.maximums.push(Oe),R.minimums.push(Te),R.leaves.push(Oe-Te<=5&&Ne?1:0)}w.push(R)}return w}(this.dem),u=s.length-1,d=s[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(s,0,0,u,0)}raycastRoot(i,s,u,d,g,_,w=1){return wL([i,s,-100],[u,d,this.maximums[0]*w],g,_)}raycast(i,s,u,d,g,_,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(i,s,u,d,g,_,w);if(T==null)return null;const E=[],C=[],R=[],M=[],z=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:F,t:G,nodex:H,nodey:K,depth:ie}=z.pop();if(this.leaves[F]){EL(H,K,ie,i,s,u,d,R,M);const se=1<<ie,Se=(H+0)/se,we=(H+1)/se,Te=(K+0)/se,Oe=(K+1)/se,Ne=dd(Se,Te,this.dem)*w,at=dd(we,Te,this.dem)*w,He=dd(we,Oe,this.dem)*w,ht=dd(Se,Oe,this.dem)*w,Mt=bL(R[0],R[1],Ne,M[0],R[1],at,M[0],M[1],He,g,_),gt=bL(M[0],M[1],He,R[0],M[1],ht,R[0],R[1],Ne,g,_),It=Math.min(Mt!==null?Mt:Number.MAX_VALUE,gt!==null?gt:Number.MAX_VALUE);if(It!==Number.MAX_VALUE)return It;{const Rt=oi([],g,_,G);if(SL(Ne,at,ht,He,TL(Rt[0],R[0],M[0]),TL(Rt[1],R[1],M[1]))>=Rt[2])return G}continue}let ne=0;for(let se=0;se<this._siblingOffset.length;se++){EL((H<<1)+this._siblingOffset[se][0],(K<<1)+this._siblingOffset[se][1],ie+1,i,s,u,d,R,M),R[2]=-100,M[2]=this.maximums[this.childOffsets[F]+se]*w;const Se=wL(R,M,g,_);if(Se!=null){const we=Se;E[se]=we;let Te=!1;for(let Oe=0;Oe<ne&&!Te;Oe++)we>=E[C[Oe]]&&(C.splice(Oe,0,se),Te=!0);Te||(C[ne]=se),ne++}}for(let se=0;se<ne;se++){const Se=C[se];z.push({idx:this.childOffsets[F]+Se,t:E[Se],nodex:(H<<1)+this._siblingOffset[Se][0],nodey:(K<<1)+this._siblingOffset[Se][1],depth:ie+1})}}return null}_addNode(i,s,u){return this.minimums.push(i),this.maximums.push(s),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(i,s,u,d,g){if(i[d].isLeaf(s,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=d-1,w=i[_];let T=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const R=2*s+this._siblingOffset[C][0],M=2*u+this._siblingOffset[C][1],z=w.getElevation(R,M),F=w.isLeaf(R,M),G=this._addNode(z.min,z.max,F);F&&(T|=1<<C),E||(E=G)}for(let C=0;C<this._siblingOffset.length;C++)T&1<<C||this._construct(i,2*s+this._siblingOffset[C][0],2*u+this._siblingOffset[C][1],_,E+C)}}function SL(l,i,s,u,d,g){return gn(gn(l,s,g),gn(i,u,g),d)}function dd(l,i,s){const u=s.dim,d=he(l*u-.5,0,u-1),g=he(i*u-.5,0,u-1),_=Math.floor(d),w=Math.floor(g),T=Math.min(_+1,u-1),E=Math.min(w+1,u-1);return SL(s.get(_,w),s.get(T,w),s.get(_,E),s.get(T,E),d-_,g-w)}const u9={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function h9(l,i,s){return(256*l*256+256*i+s)/10-1e4}function d9(l,i,s){return 256*l+i+s/256-32768}class Ww{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,s,u,d=!1){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void ni(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const g=this.dim=s.height-2,_=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let T=0;T<g;T++)_[this._idx(-1,T)]=_[this._idx(0,T)],_[this._idx(g,T)]=_[this._idx(g-1,T)],_[this._idx(T,-1)]=_[this._idx(T,0)],_[this._idx(T,g)]=_[this._idx(T,g-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(g,-1)]=_[this._idx(g-1,0)],_[this._idx(-1,g)]=_[this._idx(0,g-1)],_[this._idx(g,g)]=_[this._idx(g-1,g-1)]}const w=u==="terrarium"?d9:h9;for(let T=0;T<_.length;++T){const E=4*T;this.floatView[T]=w(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=fn.now()}_buildQuadTree(){this._tree=new IL(this)}get(i,s,u=!1){u&&(i=he(i,-1,this.dim),s=he(s,-1,this.dim));const d=this._idx(i,s);return this.floatView[d]}set(i,s,u){const d=this._idx(i,s),g=this.floatView[d];return this.floatView[d]=u,u-g}static getUnpackVector(i){return u9[i]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}static pack(i,s){const u=[0,0,0,0],d=Ww.getUnpackVector(s);let g=Math.floor((i+d[3])/d[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new wk({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,s,u){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,g=s*this.dim+this.dim,_=u*this.dim,w=u*this.dim+this.dim;switch(s){case-1:d=g-1;break;case 1:g=d+1}switch(u){case-1:_=w-1;break;case 1:w=_+1}const T=-s*this.dim,E=-u*this.dim;for(let C=_;C<w;C++)for(let R=d;R<g;R++){const M=4*this._idx(R,C),z=4*this._idx(R+T,C+E);this.pixels[M+0]=i.pixels[z+0],this.pixels[M+1]=i.pixels[z+1],this.pixels[M+2]=i.pixels[z+2],this.pixels[M+3]=i.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function f9(l,i,s){l===1?i.headerLength=s.readFixed32():l===2?i.x=s.readVarint():l===3?i.y=s.readVarint():l===4?i.z=s.readVarint():l===5&&i.layers.push(function(u,d){return u.readFields(y9,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)}(s,s.readVarint()+s.pos))}function p9(l,i,s){l===1?(i.delta_filter=function(u,d){return u.readFields(m9,{blockSize:0},d)}(s,s.readVarint()+s.pos),i.filter="delta_filter"):l===2?(s.readVarint(),i.filter="zigzag_filter"):l===3?(s.readVarint(),i.filter="bitshuffle_filter"):l===4&&(s.readVarint(),i.filter="byteshuffle_filter")}function m9(l,i,s){l===1&&(i.blockSize=s.readVarint())}function g9(l,i,s){l===1?(s.readVarint(),i.codec="gzip_data"):l===2?(s.readVarint(),i.codec="jpeg_image"):l===3?(s.readVarint(),i.codec="webp_image"):l===4&&(s.readVarint(),i.codec="png_image")}function _9(l,i,s){let u=0,d=0;l===1?i.firstByte=s.readFixed64():l===2?i.lastByte=s.readFixed64():l===3?i.filters.push(function(g,_){return g.readFields(p9,{},_)}(s,s.readVarint()+s.pos)):l===4?i.codec=function(g,_){return g.readFields(g9,{},_)}(s,s.readVarint()+s.pos):l===5?d=s.readFloat():l===6?u=s.readFloat():l===7?i.bands.push(s.readString()):l===8?i.offset=s.readDouble():l===9&&(i.scale=s.readDouble()),i.offset===0&&(i.offset=d),i.scale===0&&(i.scale=u)}function y9(l,i,s){l===1?i.version=s.readVarint():l===2?i.name=s.readString():l===3?i.units=s.readString():l===4?i.tileSize=s.readVarint():l===5?i.buffer=s.readVarint():l===6?i.pixelFormat=s.readVarint():l===7&&i.dataIndex.push(function(u,d){return u.readFields(_9,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)}(s,s.readVarint()+s.pos))}function v9(l,i,s){if(l===2)(function(u,d,g){u.readFields(x9,g,d)})(s,s.readVarint()+s.pos,i);else if(l===3)throw new Error("Not implemented")}function x9(l,i,s){if(l===1){let u=0;const d=s.readVarint()+s.pos;for(;s.pos<d;)i[u++]=s.readVarint()}}function w9(l,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let s=i[3];for(let u=2;u>=1;u--){const d=u===1?1:0,g=u===2?1:0;for(let _=0;_<i[0];_++){const w=i[1]*_;for(let T=d;T<i[1];T++){const E=i[2]*(T+w);for(let C=g;C<i[2];C++){const R=i[3]*(C+E);for(let M=0;M<i[3];M++){const z=R+M;l[z]+=l[z-s]}}}}s*=i[u]}return l}function b9(l){for(let i=0,s=l.length;i<s;i++)l[i]=l[i]>>>1^-(1&l[i]);return l}function T9(l,i){switch(i){case"uint32":return l;case"uint16":for(let s=0;s<l.length;s+=2){const u=l[s],d=l[s+1];l[s]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,l[s+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return l;case"uint8":for(let s=0;s<l.length;s+=4){const u=l[s],d=l[s+1],g=l[s+2],_=l[s+3];l[s+0]=(192&u)>>6|(192&d)>>4|(192&g)>>2|192&_,l[s+1]=(48&u)>>4|(48&d)>>2|48&g|(48&_)<<2,l[s+2]=(12&u)>>2|12&d|(12&g)<<2|(12&_)<<4,l[s+3]=3&u|(3&d)<<2|(3&g)<<4|(3&_)<<6}return l;default:throw new Error(`Invalid pixel format, "${i}"`)}}Xt(Ww,"DEMData"),Xt(IL,"DemMinMaxQuadTree",{omit:["dem"]});var wl=Uint8Array,Ky=Uint16Array,E9=Int32Array,AL=new wl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),CL=new wl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),I9=new wl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),PL=function(l,i){for(var s=new Ky(31),u=0;u<31;++u)s[u]=i+=1<<l[u-1];var d=new E9(s[30]);for(u=1;u<30;++u)for(var g=s[u];g<s[u+1];++g)d[g]=g-s[u]<<5|u;return{b:s,r:d}},RL=PL(AL,2),kL=RL.b,S9=RL.r;kL[28]=258,S9[258]=28;for(var A9=PL(CL,0).b,ML=new Ky(32768),Ss=0;Ss<32768;++Ss){var Vm=(43690&Ss)>>1|(21845&Ss)<<1;ML[Ss]=((65280&(Vm=(61680&(Vm=(52428&Vm)>>2|(13107&Vm)<<2))>>4|(3855&Vm)<<4))>>8|(255&Vm)<<8)>>1}var Yy=function(l,i,s){for(var u=l.length,d=0,g=new Ky(i);d<u;++d)l[d]&&++g[l[d]-1];var _,w=new Ky(i);for(d=1;d<i;++d)w[d]=w[d-1]+g[d-1]<<1;_=new Ky(1<<i);var T=15-i;for(d=0;d<u;++d)if(l[d])for(var E=d<<4|l[d],C=i-l[d],R=w[l[d]-1]++<<C,M=R|(1<<C)-1;R<=M;++R)_[ML[R]>>T]=E;return _},Qy=new wl(288);for(Ss=0;Ss<144;++Ss)Qy[Ss]=8;for(Ss=144;Ss<256;++Ss)Qy[Ss]=9;for(Ss=256;Ss<280;++Ss)Qy[Ss]=7;for(Ss=280;Ss<288;++Ss)Qy[Ss]=8;var DL=new wl(32);for(Ss=0;Ss<32;++Ss)DL[Ss]=5;var C9=Yy(Qy,9),P9=Yy(DL,5),UI=function(l){for(var i=l[0],s=1;s<l.length;++s)l[s]>i&&(i=l[s]);return i},_c=function(l,i,s){var u=i/8|0;return(l[u]|l[u+1]<<8)>>(7&i)&s},jI=function(l,i){var s=i/8|0;return(l[s]|l[s+1]<<8|l[s+2]<<16)>>(7&i)},R9=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yc=function(l,i,s){var u=new Error(i||R9[l]);if(u.code=l,Error.captureStackTrace&&Error.captureStackTrace(u,yc),!s)throw u;return u},k9=new wl(0),M9=typeof TextDecoder<"u"&&new TextDecoder;try{M9.decode(k9,{stream:!0})}catch{}const D9={gzip_data:"gzip"};class Zl extends Error{constructor(i){super(i),this.name="MRTError"}}const L9={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},LL={uint32:1,uint16:2,uint8:4},O9={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let GI;class Zw{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const s=this.layers[i];if(!s)throw new Zl(`Layer '${i}' not found`);return s}getHeaderLength(i){const s=new Uint8Array(i),u=new DataView(i);if(s[0]!==13)throw new Zl("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(i){const s=new Uint8Array(i),u=this.getHeaderLength(i);if(s.length<u)throw new Zl(`Expected header with length >= ${u} but got buffer of length ${s.length}`);const d=new GI(s.subarray(0,u)).readFields(f9,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Zl(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new OL(g,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const s=[],u=this.getLayer(i.layerName);for(let d of i.blockIndices){const g=u.dataIndex[d],_=g.firstByte-i.firstByte,w=g.lastByte-i.firstByte;if(u._blocksInProgress.has(d))continue;const T={layerName:u.name,firstByte:_,lastByte:w,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(E=>E.filter)};u._blocksInProgress.add(d),s.push(T)}return new zL(s,()=>{s.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,g)=>{if(s.forEach(_=>u._blocksInProgress.delete(_.blockIndex)),d)throw d;g.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class OL{constructor({version:i,name:s,units:u,tileSize:d,pixelFormat:g,buffer:_,dataIndex:w},T){if(this.version=i,this.version!==1)throw new Zl(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=s,this.units=u,this.tileSize=d,this.buffer=_,this.pixelFormat=L9[g],this.dataIndex=w,this.bandShape=[d+2*_,d+2*_,LL[this.pixelFormat]],this._decodedBlocks=new qw(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return LL[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const s=i.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,i.data)}getBlockForBand(i){let s=0;switch(typeof i){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[g,_]of d.bands.entries())if(_===i)return{bandIndex:s+g,blockIndex:u,blockBandIndex:g};s+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(i>=s&&i<s+d.bands.length)return{bandIndex:i,blockIndex:u,blockBandIndex:i-s};s+=d.bands.length}break;default:throw new Zl(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let s=1/0,u=-1/0;const d=[],g=new Set;for(const _ of i){const{blockIndex:w}=this.getBlockForBand(_);if(w<0)throw new Zl(`Invalid band: ${JSON.stringify(_)}`);const T=this.dataIndex[w];d.includes(w)||d.push(w),g.add(w),s=Math.min(s,T.firstByte),u=Math.max(u,T.lastByte)}if(g.size>this.cacheSize)throw new Zl(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:u,blockIndices:d}}hasBand(i){const{blockIndex:s}=this.getBlockForBand(i);return s>=0}hasDataForBand(i){const{blockIndex:s}=this.getBlockForBand(i);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(i){const{blockIndex:s,blockBandIndex:u}=this.getBlockForBand(i);if(s<0)throw new Zl(`Band not found: ${JSON.stringify(i)}`);const d=this._decodedBlocks.get(s.toString());if(!d)throw new Zl(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[s],_=this.bandShape.reduce((E,C)=>E*C,1),w=u*_,T=d.subarray(w,w+_);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}Zw.setPbf=function(l){GI=l};class zL{constructor(i,s,u){this.tasks=i,this._onCancel=s,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,s){this._finalized||(this._onComplete(i,s),this._finalized=!0)}}Zw.performDecoding=function(l,i){const s=new Uint8Array(l);return Promise.all(i.tasks.map(u=>{const{layerName:d,firstByte:g,lastByte:_,pixelFormat:w,blockShape:T,blockIndex:E,filters:C,codec:R}=u,M=s.subarray(g,_+1),z=new Uint32Array(T[0]*T[1]*T[2]);let F;if(R!=="gzip_data")throw new Zl(`Unhandled codec: ${R}`);return F=function(G,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve(((se=function(Te){Te[0]==31&&Te[1]==139&&Te[2]==8||yc(6,"invalid gzip data");var Oe=Te[3],Ne=10;4&Oe&&(Ne+=2+(Te[10]|Te[11]<<8));for(var at=(Oe>>3&1)+(Oe>>4&1);at>0;at-=!Te[Ne++]);return Ne+(2&Oe)}(ne=G))+8>ne.length&&yc(6,"invalid gzip data"),function(Te,Oe,Ne,at){var He=Te.length;if(!He||Oe.f&&!Oe.l)return Ne||new wl(0);var ht=!Ne,Mt=ht||Oe.i!=2,gt=Oe.i;ht&&(Ne=new wl(3*He));var It,Rt,st=function(Rr){var dr=Ne.length;if(Rr>dr){var sr=new wl(Math.max(2*dr,Rr));sr.set(Ne),Ne=sr}},St=Oe.f||0,qe=Oe.p||0,ot=Oe.b||0,zt=Oe.l,At=Oe.d,ln=Oe.m,Kt=Oe.n,Tt=8*He;do{if(!zt){St=_c(Te,qe,1);var Ct=_c(Te,qe+1,3);if(qe+=3,!Ct){var Jt=Te[(ce=4+((qe+7)/8|0))-4]|Te[ce-3]<<8,Wt=ce+Jt;if(Wt>He){gt&&yc(0);break}Mt&&st(ot+Jt),Ne.set(Te.subarray(ce,Wt),ot),Oe.b=ot+=Jt,Oe.p=qe=8*Wt,Oe.f=St;continue}if(Ct==1)zt=C9,At=P9,ln=9,Kt=5;else if(Ct==2){var Vt=_c(Te,qe,31)+257,Zt=_c(Te,qe+10,15)+4,Tn=Vt+_c(Te,qe+5,31)+1;qe+=14;for(var kn=new wl(Tn),Un=new wl(19),On=0;On<Zt;++On)Un[I9[On]]=_c(Te,qe+3*On,7);qe+=3*Zt;var li=UI(Un),Yn=(1<<li)-1,hr=Yy(Un,li);for(On=0;On<Tn;){var ce,ue=hr[_c(Te,qe,Yn)];if(qe+=15&ue,(ce=ue>>4)<16)kn[On++]=ce;else{var it=0,Ft=0;for(ce==16?(Ft=3+_c(Te,qe,3),qe+=2,it=kn[On-1]):ce==17?(Ft=3+_c(Te,qe,7),qe+=3):ce==18&&(Ft=11+_c(Te,qe,127),qe+=7);Ft--;)kn[On++]=it}}var Gt=kn.subarray(0,Vt),jt=kn.subarray(Vt);ln=UI(Gt),Kt=UI(jt),zt=Yy(Gt,ln),At=Yy(jt,Kt)}else yc(1);if(qe>Tt){gt&&yc(0);break}}Mt&&st(ot+131072);for(var Yt=(1<<ln)-1,An=(1<<Kt)-1,ri=qe;;ri=qe){var si=(it=zt[jI(Te,qe)&Yt])>>4;if((qe+=15&it)>Tt){gt&&yc(0);break}if(it||yc(2),si<256)Ne[ot++]=si;else{if(si==256){ri=qe,zt=null;break}var Wn=si-254;si>264&&(Wn=_c(Te,qe,(1<<(Gn=AL[On=si-257]))-1)+kL[On],qe+=Gn);var Xi=At[jI(Te,qe)&An],Dr=Xi>>4;if(Xi||yc(3),qe+=15&Xi,jt=A9[Dr],Dr>3){var Gn=CL[Dr];jt+=jI(Te,qe)&(1<<Gn)-1,qe+=Gn}if(qe>Tt){gt&&yc(0);break}Mt&&st(ot+131072);var gr=ot+Wn;if(ot<jt){var rr=0-jt,Ni=Math.min(jt,gr);for(rr+ot<0&&yc(3);ot<Ni;++ot)Ne[ot]=(void 0)[rr+ot]}for(;ot<gr;++ot)Ne[ot]=Ne[ot-jt]}}Oe.l=zt,Oe.p=ri,Oe.b=ot,Oe.f=St,zt&&(St=1,Oe.m=ln,Oe.d=At,Oe.n=Kt)}while(!St);return ot!=Ne.length&&ht?(It=Ne,((Rt=ot)==null||Rt>It.length)&&(Rt=It.length),new wl(It.subarray(0,Rt))):Ne.subarray(0,ot)}(ne.subarray(se,-8),{i:2},new wl(((K=ne)[(ie=K.length)-4]|K[ie-3]<<8|K[ie-2]<<16|K[ie-1]<<24)>>>0))));var K,ie,ne,se;const Se=D9[H];if(!Se)throw new Error(`Unhandled codec: ${H}`);const we=new globalThis.DecompressionStream(Se);return new Response(new Blob([G]).stream().pipeThrough(we)).arrayBuffer().then(Te=>new Uint8Array(Te))}(M,R).then(G=>(function(H,K){H.readFields(v9,K)}(new GI(G),z),new O9[w](z.buffer))),F.then(G=>{for(let H=C.length-1;H>=0;H--)switch(C[H]){case"delta_filter":w9(G,T);break;case"zigzag_filter":b9(G);break;case"bitshuffle_filter":T9(G,w);break;default:throw new Zl(`Unhandled filter "${C[H]}"`)}return{layerName:d,blockIndex:E,data:G}}).catch(G=>{throw G})}))},Xt(zL,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Xt(Zw,"MapboxRasterTile"),Xt(OL,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class FL{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const u=i[s];this._stringToNumber[u]=s,this._numberToString[s]=u}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const z9=["id","tile","layer","source","sourceLayer","state"];class Um{constructor(i,s,u,d,g){this.type="Feature",this._vectorTileFeature=i,this._z=s,this._x=u,this._y=d,this.properties=i.properties,this.id=g}clone(){const i=new Um(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of z9)this[s]!==void 0&&(i[s]=this[s]);return i}}class NL{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new eu(Bt,16,0),this.featureIndexArray=new H0,this.promoteId=s,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,s,u,d,g,_=0,w=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,g,_);const E=this.grid;for(let C=0;C<s.length;C++){const R=s[C],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<R.length;z++){const F=R[z];M[0]=Math.min(M[0],F.x),M[1]=Math.min(M[1],F.y),M[2]=Math.max(M[2],F.x),M[3]=Math.max(M[3],F.y)}w!==0&&(M[0]-=w,M[1]-=w,M[2]+=w,M[3]+=w),M[0]<Bt&&M[1]<Bt&&M[2]>=0&&M[3]>=0&&E.insert(T,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new tn(new bw(this.rawTileData)).layers,this.sourceLayerCoder=new FL(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,s){const{tilespaceGeometry:u,transform:d,tileTransform:g,pixelPosMatrix:_,availableImages:w,worldview:T}=s;this.loadVTLayers(),this.serializedLayersCache.clear();const E=u.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(F,G,H,K)=>qr(u.bufferedTilespaceGeometry,F,G,H,K));C.sort(F9);let R=null;d.elevation&&C.length>0&&(R=Fm.create(d.elevation,this.tileID));const M={};let z;for(let F=0;F<C.length;F++){const G=C[F];if(G===z)continue;z=G;const H=this.featureIndexArray.get(G);let K=null;this.is3DTile?this.loadMatchingModelFeature(M,H,i,u,d,T):this.loadMatchingFeature(M,H,i,w,T,(ie,ne,se,Se=0)=>(K||(K=Ce(ie,this.tileID.canonical,g)),ne.queryIntersectsFeature(u,ie,se,K,this.z,d,_,R,Se)))}return M}loadMatchingFeature(i,s,u,d,g,_){const{featureIndex:w,bucketIndex:T,sourceLayerIndex:E,layoutVertexArrayOffset:C}=s,R=this.bucketLayerIDs[T],M=u.layers,z=Object.keys(M);if(z.length&&!Jn(z,R))return;const F=u.sourceCache,G=this.sourceLayerCoder.decode(E),H=this.vtLayers[G].feature(w),K=this.getId(H,G);for(let ie=0;ie<R.length;ie++){const ne=R[ie];if(!M[ne])continue;const{styleLayer:se,targets:Se}=M[ne];let we={};K!==void 0&&(we=F.getFeatureState(se.sourceLayer,K));const Te=!_||_(H,se,we,C);if(!Te)continue;const Oe=new Um(H,this.z,this.x,this.y,K);Oe.tile=this.tileID.canonical,Oe.state=we;let Ne=this.serializedLayersCache.get(ne);Ne||(Ne=se.serialize(),Ne.id=ne,this.serializedLayersCache.set(ne,Ne)),Oe.source=Ne.source,Oe.sourceLayer=Ne["source-layer"],Oe.layer=Xe({},Ne),Oe.layer.paint=BL(Ne.paint,se.paint,H,we,d),Oe.layer.layout=BL(Ne.layout,se.layout,H,we,d);let at=!1;for(const He of Se){this.updateFeatureProperties(Oe,He);const{filter:ht}=He;if(ht){if(H.properties=Oe.properties,ht.needGeometry){const Mt=rt(H,!0);if(!ht.filter(new Zi(this.tileID.overscaledZ,{worldview:g}),Mt,this.tileID.canonical))continue}else if(!ht.filter(new Zi(this.tileID.overscaledZ,{worldview:g}),H))continue}at=!0,He.targetId&&this.addFeatureVariant(Oe,He)}at&&this.appendToResult(i,ne,w,Oe,Te)}}loadMatchingModelFeature(i,s,u,d,g,_){const{featureIndex:w,bucketIndex:T}=s,E=this.bucketLayerIDs[T],C=u.layers,R=Object.keys(C);if(!R.length||Jn(R,E))for(let M=0;M<E.length;M++){const z=E[M],{styleLayer:F,targets:G}=C[z];if(F.type!=="model")continue;const H=d.tile,K=H.getBucket(F);if(!(K&&K instanceof Uw))continue;const ie=j$(K,w,d,g);if(!ie)continue;const{z:ne,x:se,y:Se}=H.tileID.canonical,{feature:we,intersectionZ:Te,position:Oe}=ie;let Ne={};we.id!==void 0&&(Ne=u.sourceCache.getFeatureState(F.sourceLayer,we.id));const at=new Um({},ne,se,Se,we.id);at.tile=this.tileID.canonical,at.state=Ne,at.properties=we.properties,at.geometry={type:"Point",coordinates:[Oe.lng,Oe.lat]};let He=this.serializedLayersCache.get(z);He||(He=F.serialize(),He.id=z,this.serializedLayersCache.set(z,He)),at.source=He.source,at.sourceLayer=He["source-layer"],at.layer=Xe({},He);let ht=!1;for(const Mt of G){this.updateFeatureProperties(at,Mt);const{filter:gt}=Mt;if(gt){if(we.properties=at.properties,gt.needGeometry){if(!gt.filter(new Zi(this.tileID.overscaledZ,{worldview:_}),we,this.tileID.canonical))continue}else if(!gt.filter(new Zi(this.tileID.overscaledZ,{worldview:_}),we))continue}ht=!0,Mt.targetId&&this.addFeatureVariant(at,Mt)}ht&&this.appendToResult(i,z,w,at,Te)}}updateFeatureProperties(i,s,u){if(s.properties){const d={};for(const g in s.properties){const _=s.properties[g].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,u);_!=null&&(d[g]=_)}i.properties=d}}addFeatureVariant(i,s,u){const d={target:s.target,namespace:s.namespace,uniqueFeatureID:s.uniqueFeatureID};s.properties&&(d.properties=i.properties),i.variants=i.variants||{},i.variants[s.targetId]=i.variants[s.targetId]||[],i.variants[s.targetId].push(d)}appendToResult(i,s,u,d,g){let _=i[s];_===void 0&&(_=i[s]=[]),_.push({featureIndex:u,feature:d,intersectionZ:g})}lookupSymbolFeatures(i,s,u,d,g,_){const w={};this.loadVTLayers();for(const T of i)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:u,featureIndex:T,layoutVertexArrayOffset:0},d,g,_);return w}loadFeature(i){const{featureIndex:s,sourceLayerIndex:u}=i;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),g=this.vtFeatures[d];if(g[s])return g[s];const _=this.vtLayers[d].feature(s);return g[s]=_,_}hasLayer(i){for(const s of this.bucketLayerIDs)for(const u of s)if(i===u)return!0;return!1}getId(i,s){let u=i.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[s];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=Uu(d);if(g.result!=="success"){const _=g.value.map(w=>`${w.key}: ${w.message}`).join(", ");return void ni(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=g.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new hf),u=this.promoteIdExpression.evaluate({zoom:0},i)}else u=i.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function BL(l,i,s,u,d){return Cn(l,(g,_)=>{const w=i instanceof vl?i.get(_):null;return w&&w.evaluate?w.evaluate(s,u,void 0,d):w})}function F9(l,i){return i-l}Xt(NL,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const VL=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $I{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,u]=new Uint8Array(i,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=VL[15&u];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new $I(w,_,g,i)}constructor(i,s=64,u=Float64Array,d){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=u,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const g=VL.indexOf(this.ArrayType),_=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+T),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+T,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=i,this.coords[this._pos++]=s,u}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return HI(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:w}=this,T=[0,g.length-1,0],E=[];for(;T.length;){const C=T.pop()||0,R=T.pop()||0,M=T.pop()||0;if(R-M<=w){for(let H=M;H<=R;H++){const K=_[2*H],ie=_[2*H+1];K>=i&&K<=u&&ie>=s&&ie<=d&&E.push(g[H])}continue}const z=M+R>>1,F=_[2*z],G=_[2*z+1];F>=i&&F<=u&&G>=s&&G<=d&&E.push(g[z]),(C===0?i<=F:s<=G)&&(T.push(M),T.push(z-1),T.push(1-C)),(C===0?u>=F:d>=G)&&(T.push(z+1),T.push(R),T.push(1-C))}return E}within(i,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:_}=this,w=[0,d.length-1,0],T=[],E=u*u;for(;w.length;){const C=w.pop()||0,R=w.pop()||0,M=w.pop()||0;if(R-M<=_){for(let H=M;H<=R;H++)jL(g[2*H],g[2*H+1],i,s)<=E&&T.push(d[H]);continue}const z=M+R>>1,F=g[2*z],G=g[2*z+1];jL(F,G,i,s)<=E&&T.push(d[z]),(C===0?i-u<=F:s-u<=G)&&(w.push(M),w.push(z-1),w.push(1-C)),(C===0?i+u>=F:s+u>=G)&&(w.push(z+1),w.push(R),w.push(1-C))}return T}}function HI(l,i,s,u,d,g){if(d-u<=s)return;const _=u+d>>1;UL(l,i,_,u,d,g),HI(l,i,s,u,_-1,1-g),HI(l,i,s,_+1,d,1-g)}function UL(l,i,s,u,d,g){for(;d>u;){if(d-u>600){const E=d-u+1,C=s-u+1,R=Math.log(E),M=.5*Math.exp(2*R/3),z=.5*Math.sqrt(R*M*(E-M)/E)*(C-E/2<0?-1:1);UL(l,i,s,Math.max(u,Math.floor(s-C*M/E+z)),Math.min(d,Math.floor(s+(E-C)*M/E+z)),g)}const _=i[2*s+g];let w=u,T=d;for(Jy(l,i,u,s),i[2*d+g]>_&&Jy(l,i,u,d);w<T;){for(Jy(l,i,w,T),w++,T--;i[2*w+g]<_;)w++;for(;i[2*T+g]>_;)T--}i[2*u+g]===_?Jy(l,i,u,T):(T++,Jy(l,i,T,d)),T<=s&&(u=T+1),s<=T&&(d=T-1)}}function Jy(l,i,s,u){qI(l,s,u),qI(i,2*s,2*u),qI(i,2*s+1,2*u+1)}function qI(l,i,s){const u=l[i];l[i]=l[s],l[s]=u}function jL(l,i,s,u){const d=l-s,g=i-u;return d*d+g*g}o.$=Ws,o.A=$a,o.B=xn,o.C=qh,o.D=Am,o.E=Nl,o.F=2,o.G=By,o.H=pD,o.I=Oo,o.J=Gc,o.K=class extends Vw{},o.L=Bl,o.M=N0,o.N=im,o.O=nm,o.P=bt,o.Q=C0,o.R=Cu,o.S=B_,o.T=oI,o.U=Ef,o.V=Vw,o.W=V_,o.X=Uu,o.Y=jp,o.Z=Fh,o._=zh,o.a=function(l){return ye.API_CDN_URL_REGEX.test(l)},o.a$=pt,o.a0=Mu,o.a1=If,o.a2=rm,o.a3=A0,o.a4=function(l){const i=l.value;let s=[];if(!i)return s;const u=Gc(i);return u!=="string"?(s=s.concat([new Vw(l.key,i,`string expected, "${u}" found`)]),s):(DI(i,!0)||(s=s.concat([new Vw(l.key,i,`invalid url "${i}"`)])),s)},o.a5=$e,o.a6=Tf,o.a7=Gr,o.a8=Lt,o.a9=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return jr(l.expression.evaluate(i))}interpolate(l,i,s){return{x:gn(l.x,i.x,s),y:gn(l.y,i.y,s),z:gn(l.z,i.z,s),azimuthal:gn(l.azimuthal,i.azimuthal,s),polar:gn(l.polar,i.polar,s)}}},o.aA=Es,o.aB=To,o.aC=ao,o.aD=$,o.aE=Le,o.aF=function(l,i){const s={};for(let u=0;u<i.length;u++){const d=i[u];d in l&&(s[d]=l[d])}return s},o.aG=B,o.aH=X,o.aI=class{constructor(l){this.entries={},this.scheduler=l}request(l,i,s,u){const d=this.entries[l]=this.entries[l]||{callbacks:[]};if(d.result){const[g,_]=d.result;return this.scheduler?this.scheduler.add(()=>{u(g,_)},i):u(g,_),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=s((g,_)=>{d.result=[g,_];for(const w of d.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,_)},i):w(g,_);setTimeout(()=>delete this.entries[l],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==u),d.callbacks.length||(d.cancel(),delete this.entries[l]))}}},o.aJ=function(l,i,s){const u=JSON.stringify(l.request);return l.data&&(this.deduped.entries[u]={result:[null,l.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},d=>{const g=Pu(l.request,(_,w,T,E)=>{_?d(_):w&&d(null,{vectorTile:s?void 0:new tn(new bw(w)),rawData:w,cacheControl:T,expires:E})});return()=>{g.cancel(),d()}},i)},o.aK=function(l){oc++,oc>pr&&(l.getActor().send("enforceCacheSizeLimit",Fi),oc=0)},o.aL=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},o.aM=ms,o.aN=GD,o.aO=XD,o.aP=jD,o.aQ=function(l,i){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){i(null,s)};for(let u=0;u<l.length;u++){const d=document.createElement("source");c_(l[u])||(s.crossOrigin="Anonymous"),d.src=l[u],s.appendChild(d)}return{cancel:()=>{}}},o.aR=Dy,o.aS=function(l){return fetch(l).then(i=>i.arrayBuffer()).then(i=>xM(i,0,l))},o.aT=CM,o.aU=class{constructor(l,i,s,u){this.id=l,this.position=i!=null?new L(i[0],i[1]):new L(0,0),this.orientation=s??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new ti([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,i){if(de(l.matrix,i,l.matrix),l.meshes)for(const s of l.meshes){const u=ti.applyTransformFast(s.aabb,l.matrix);this.aabb.encapsulate(u)}if(l.children)for(const s of l.children)this._applyTransformations(s,l.matrix)}computeBoundsAndApplyParent(){const l=me([]);for(const i of this.nodes)this._applyTransformations(i,l)}computeModelMatrix(l,i,s,u,d,g,_=!1){SM(this.matrix,this,l.transform,this.position,i,s,u,d,g,_)}upload(l){if(!this.uploaded){for(const i of this.nodes)cI(i,l);for(const i of this.nodes)ww(i);this.uploaded=!0}}destroy(){for(const l of this.nodes)uI(l)}},o.aV=_n,o.aW=jy,o.aX=te,o.aY=re,o.aZ=Zh,o.a_=yr,o.aa=Zi,o.ab=Jc,o.ac=ve,o.ad=Wi,o.ae=Be,o.af=Me,o.ag=vl,o.ah=sd,o.ai=gn,o.aj=Bt,o.ak=Vc,o.al=fi,o.am=wi,o.an=class{constructor(l){this.specification=l}possiblyEvaluate(l,i){return function([s,u]){const d=jr([1,s,u]);return{x:d.x,y:d.y,z:d.z}}(l.expression.evaluate(i))}interpolate(l,i,s){return{x:gn(l.x,i.x,s),y:gn(l.y,i.y,s),z:gn(l.z,i.z,s)}}},o.ao=function(l,i,s=0,u=!0){const d=new bt(s,s),g=l.sub(d),_=i.add(d),w=[g,new bt(_.x,g.y),_,new bt(g.x,_.y)];return u&&w.push(g.clone()),w},o.ap=function(l,i){const s=[];for(let u=0;u<l.length;u++){const d=Je(u-1,-1,l.length-1),g=Je(u+1,-1,l.length-1),_=l[u],w=l[g],T=l[d].sub(_).unit(),E=w.sub(_).unit(),C=E.angleWithSep(T.x,T.y),R=T.add(E).unit().mult(-1*i/Math.sin(C/2));s.push(_.add(R))}return s},o.aq=CD,o.ar=qr,o.as=function(l,i,s=0){return Hn(((i.x-s)*l.scale-l.x)*Bt,(i.y*l.scale-l.y)*Bt,ae(i.z,i.y))},o.at=Vi,o.au=qn,o.av=Ti,o.aw=BM,o.ax=function(l){let i=1/0,s=1/0,u=-1/0,d=-1/0;for(const g of l)i=Math.min(i,g.x),s=Math.min(s,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return{min:new bt(i,s),max:new bt(u,d)}},o.ay=he,o.az=de,o.b=function(l){return ye.API_FONTS_REGEX.test(l)},o.b$=EI,o.b0=j0,o.b1=zw,o.b2=function(){Gl.isLoading()||Gl.isLoaded()||W_()!=="deferred"||O0()},o.b3=$h,o.b4=rt,o.b5=Um,o.b6=ci,o.b7=fI,o.b8=HE,o.b9=Ce,o.bA=function(l,i){const{x:s,y:u}=l.point,d=lk(s,u,l.worldSize/l._pixelsPerMercatorPixel,0,0);return de(d,d,OE(au(i)))},o.bB=N,o.bC=Ea,o.bD=function(l,i){return Math.hypot(i[0]-l[0],i[1]-l[1],i[2]-l[2])},o.bE=oi,o.bF=ar,o.bG=zi,o.bH=Ny,o.bI=Na,o.bJ=xI,o.bK=function(l,i,s,u,d){const g=5*i+2;l.float32[g+0]=s,l.float32[g+1]=u,l.float32[g+2]=d},o.bL=Ow,o.bM=Ur,o.bN=qs,o.bO=fs,o.bP=Bs,o.bQ=Je,o.bR=function(l,i,s,u){var d=new P(4);return d[0]=l,d[1]=i,d[2]=s,d[3]=u,d},o.bS=pw,o.bT=Qi,o.bU=Ks,o.bV=Bk,o.bW=KD,o.bX=Gk,o.bY=ZE,o.bZ=vI,o.b_=wD,o.ba=Ko,o.bb=ay,o.bc=nk,o.bd=Cr,o.be=Im,o.bf=kI,o.bg=function(l,i){const s=sd(i.zoom);if(s===0)return au(l);const u=iw(l),d=LE(u),g=$(u.getWest())*i.worldSize,_=$(u.getEast())*i.worldSize,w=X(u.getNorth())*i.worldSize,T=X(u.getSouth())*i.worldSize,E=[g,w,0],C=[_,w,0],R=[g,T,0],M=[_,T,0],z=Ue([],i.globeMatrix);return Wi(E,E,z),Wi(C,C,z),Wi(R,R,z),Wi(M,M,z),d[0]=Zu(d[0],R,s),d[1]=Zu(d[1],M,s),d[2]=Zu(d[2],C,s),d[3]=Zu(d[3],E,s),ti.fromPoints(d)},o.bh=sw,o.bi=Ue,o.bj=_y,o.bk=Zu,o.bl=Wh,o.bm=m8,o.bn=Pe,o.bo=ge,o.bp=Zw,o.bq=bw,o.br=Pu,o.bs=function(l,i){const s=[];for(const u in l)u in i||s.push(u);return s},o.bt=Fe,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=Lo,o.bw=function(l){var i=new P(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},o.bx=me,o.by=nt,o.bz=oe,o.c=ze,o.c$=45,o.c0=$I,o.c1=Pn,o.c2=Ro,o.c3=io,o.c4=function(l,i,s){s*=.5;var u=i[0],d=i[1],g=i[2],_=i[3],w=Math.sin(s),T=Math.cos(s);return l[0]=u*T+d*w,l[1]=d*T-u*w,l[2]=g*T+_*w,l[3]=_*T-g*w,l},o.c5=Mo,o.c6=tr,o.c7=function(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l[3]=i[3],l},o.c8=ke,o.c9=function(l,i,s,u,d){var g,_=1/Math.tan(i/2);return l[0]=_/s,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,d!=null&&d!==1/0?(l[10]=(d+u)*(g=1/(u-d)),l[14]=2*d*u*g):(l[10]=-1,l[14]=-2*u),l},o.cA=Oa,o.cB=sk,o.cC=function(l,i,s,u,d,g,_,w,T){if(T.name==="globe")return sk(l,i,new Oa(s,u,d),!1);const E=jy({z:s,x:u,y:d},T);return new ti([(g+E.x/E.scale)*i,i*(E.y/E.scale),_],[(g+E.x2/E.scale)*i,i*(E.y2/E.scale),w])},o.cD=function(l,i,s){return l[0]=Math.min(i[0],s[0]),l[1]=Math.min(i[1],s[1]),l[2]=Math.min(i[2],s[2]),l[3]=Math.min(i[3],s[3]),l},o.cE=function(l,i,s){return l[0]=Math.max(i[0],s[0]),l[1]=Math.max(i[1],s[1]),l[2]=Math.max(i[2],s[2]),l[3]=Math.max(i[3],s[3]),l},o.cF=function(l){const i=Math.round((l+45+360)%360/90)%4;return Y[i]},o.cG=fe,o.cH=Qs,o.cI=f,o.cJ=function(l){const i=me(new Float64Array(16));de(i,l.pixelMatrix,l.globeMatrix);const s=[0,y,0],u=[0,x,0];return Wi(s,s,i),Wi(u,u,i),[s[0]>0&&s[0]<=l.width&&s[1]>0&&s[1]<=l.height&&!FE(l,new L(l.center.lat,90)),u[0]>0&&u[0]<=l.width&&u[1]>0&&u[1]<=l.height&&!FE(l,new L(l.center.lat,-90))]},o.cK=function(l,i){const{scale:s}=l.tileTransform,u=s*Bt/(l.tileSize*Math.pow(2,i.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(d,g,_){var w=g[1],T=g[2],E=g[3],C=_[0],R=_[1];return d[0]=g[0]*C,d[1]=w*C,d[2]=T*R,d[3]=E*R,d}(new Float32Array(4),i.inverseAdjustmentMatrix,[u,u])},o.cL=vw,o.cM=Ve,o.cN=wM,o.cO=function(l){const i=wM(l,!0);return N([],[i[0],i[1],i[4],i[5]])},o.cP=Re,o.cQ=Ri,o.cR=_t,o.cS=function(l){const{x:i,y:s}=l.point,{lng:u,lat:d}=l._center;return lk(i,s,l.worldSize,u,d)},o.cT=vn,o.cU=Ge,o.cV=za,o.cW=Nr,o.cX=ew,o.cY=function(l,i,s){let u=0;for(let d=0;d<2;++d)l[d]>0&&(u+=(l[d]-0)*(l[d]-0)),i[d]<0&&(u+=(0-i[d])*(0-i[d]));return u},o.cZ=function(l){return l*l*l*l*l},o.c_=q,o.ca=function(l,i,s,u,d,g,_){var w=1/(i-s),T=1/(u-d),E=1/(g-_);return l[0]=-2*w,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*T,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*E,l[11]=0,l[12]=(i+s)*w,l[13]=(d+u)*T,l[14]=(_+g)*E,l[15]=1,l},o.cb=Z,o.cc=function(l,i,s){l[4*i+0]=s[0],l[4*i+1]=s[1],l[4*i+2]=s[2],l[4*i+3]=s[3]},o.cd=Em,o.ce=td,o.cf=ts,o.cg=ql,o.ch=Df,o.ci=L,o.cj=DD,o.ck=function(){var l=new P(4);return P!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},o.cl=function(l,i,s){var u=i[0],d=i[1],g=i[2],_=i[3],w=Math.sin(s),T=Math.cos(s);return l[0]=u*T+g*w,l[1]=d*T+_*w,l[2]=u*-w+g*T,l[3]=d*-w+_*T,l},o.cm=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]},o.cn=Hs,o.co=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},o.cp=vi,o.cq=Po,o.cr=Wl,o.cs=3,o.ct=2,o.cu=7,o.cv=6,o.cw=rs,o.cx=De,o.cy=Mi,o.cz=bM,o.d=function(l){return ye.API_TILEJSON_REGEX.test(l)},o.d$=(l,i,s,u,d,g,_,w,T,E)=>{const C=l.transform,R=C.calculatePixelsToTileUnitsMatrix(i),M=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none",z=C.pitch<15?VM(.07,.7,he((14-C.zoom)/5,0,1)):.07;return{u_matrix:jM(l,i,s,u),u_pixels_to_tile_units:R,u_device_pixel_ratio:g,u_width_scale:_,u_floor_width_scale:w,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:$M(s)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:UM(i,l.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:z,u_tile_to_meter:_e(i.tileID.canonical,0),u_ground_shadow_factor:E}},o.d0=Mf,o.d1=function(l,i,s){const u=Math.sqrt(l*l+i*i+s*s),d=u>0?Math.acos(s/u)*Ia:0;let g=l!==0||i!==0?Math.atan2(-i,-l)*Ia+90:0;return g<0&&(g+=360),[u,g,d]},o.d2=Hn,o.d3=jr,o.d4=_e,o.d5=ii,o.d6=ti,o.d7=Ii,o.d8=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},o.d9=DI,o.dA=iw,o.dB=function(l){const i=fe-5;l=he(l,-i,i)/i*90;const s=Math.pow(Math.abs(Math.sin(fi(l))),3);return Math.round(s*(p.length-1))},o.dC=function(l,i,s,u){const d=i.getNorth(),g=i.getSouth(),_=i.getWest(),w=i.getEast(),T=1<<l.z,E=w-_,C=d-g,R=E/c,M=-C/p[s],z=[0,R,0,M,0,0,d,_,0];if(l.z>0){const F=180/u;Q(z,z,[F/E+1,0,0,0,F/C+1,0,-.5*F/R,.5*F/M,1])}return z[2]=T,z[5]=l.x,z[8]=l.y,z},o.dD=au,o.dE=function(l,i,s){const u=me(new Float64Array(16)),d=(i/(1<<l)-.5)*Math.PI*2;return ct(u,s.globeMatrix,d),Float32Array.from(u)},o.dF=class{isDataAvailableAtPoint(l){const i=this._source();if(this.isUsingMockSource()||!i||l.y<0||l.y>1)return!1;const s=i.getSource().maxzoom,u=1<<s,d=Math.floor(l.x),g=Math.floor((l.x-d)*u),_=Math.floor(l.y*u),w=this.findDEMTileFor(new ms(s,d,s,g,_));return!(!w||!w.dem)}getAtPointOrZero(l,i=0){return this.getAtPoint(l,i)||0}getAtPoint(l,i,s=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const u=this._source();if(!u||l.y<0||l.y>1)return i;const d=u.getSource().maxzoom,g=1<<d,_=Math.floor(l.x),w=l.x-_,T=new ms(d,_,d,Math.floor(w*g),Math.floor(l.y*g)),E=this.findDEMTileFor(T);if(!E||!E.dem)return i;const C=E.dem,R=1<<E.tileID.canonical.z,M=(w*R-E.tileID.canonical.x)*C.dim,z=(l.y*R-E.tileID.canonical.y)*C.dim,F=Math.floor(M),G=Math.floor(z);return(s?this.exaggeration():1)*gn(gn(C.get(F,G),C.get(F,G+1),z-G),gn(C.get(F+1,G),C.get(F+1,G+1),z-G),M-F)}getAtTileOffset(l,i,s){const u=1<<l.canonical.z;return this.getAtPointOrZero(new ve(l.wrap+(l.canonical.x+i/Bt)/u,(l.canonical.y+s/Bt)/u))}getAtTileOffsetFunc(l,i,s,u){return d=>{const g=this.getAtTileOffset(l,d.x,d.y),_=u.upVector(l.canonical,d.x,d.y);return Pn(_,_,g*u.upVectorScale(l.canonical,i,s).metersToTile),_}}getForTilePoints(l,i,s,u){if(this.isUsingMockSource())return!1;const d=Fm.create(this,l,u);return!!d&&(i.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(l);if(!i||!i.dem)return null;const s=i.dem.tree,u=i.tileID,d=1<<l.canonical.z-u.canonical.z;let g=l.canonical.x/d-u.canonical.x,_=l.canonical.y/d-u.canonical.y,w=0;for(let T=0;T<l.canonical.z-u.canonical.z&&!s.leaves[w];T++){g*=2,_*=2;const E=2*Math.floor(_)+Math.floor(g);w=s.childOffsets[w]+E,g%=1,_%=1}return{min:this.exaggeration()*s.minimums[w],max:this.exaggeration()*s.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,i,s){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let i=!1,s=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of l){const g=this.getMinMaxForTile(d.tileID);g&&(s=Math.min(s,g.min),u=Math.max(u,g.max),i=!0)}return i?{min:s,max:u}:null}},o.dG=wk,o.dH=nw,o.dI=function(l,i){return[Math.pow(l[0],2.2)*i,Math.pow(l[1],2.2)*i,Math.pow(l[2],2.2)*i]},o.dJ=V,o.dK=function(l,i){var s=Math.sin(i),u=Math.cos(i);return l[0]=u,l[1]=s,l[2]=0,l[3]=-s,l[4]=u,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},o.dL=$s,o.dM=ak,o.dN=Ls,o.dO=Os,o.dP=256,o.dQ=function(l,i){const s=[0,0,0];return Wi(s,s,sw(au(i.canonical))),Wi(s,s,l),s},o.dR=l=>({u_matrix:new Df(l),u_texsize:new ql(l),u_pixels_to_tile_units:new my(l),u_device_pixel_ratio:new ts(l),u_width_scale:new ts(l),u_floor_width_scale:new ts(l),u_image:new Em(l),u_units_to_pixels:new ql(l),u_tile_units_to_pixels:new ts(l),u_alpha_discard_threshold:new ts(l),u_trim_offset:new ql(l),u_trim_fade_range:new ql(l),u_trim_color:new Mf(l),u_emissive_strength:new ts(l),u_zbias_factor:new ts(l),u_tile_to_meter:new ts(l),u_ground_shadow_factor:new td(l),u_pattern_transition:new ts(l)}),o.dS=l=>({u_matrix:new Df(l),u_pixels_to_tile_units:new my(l),u_device_pixel_ratio:new ts(l),u_width_scale:new ts(l),u_floor_width_scale:new ts(l),u_units_to_pixels:new ql(l),u_dash_image:new Em(l),u_gradient_image:new Em(l),u_image_height:new ts(l),u_texsize:new ql(l),u_tile_units_to_pixels:new ts(l),u_alpha_discard_threshold:new ts(l),u_trim_offset:new ql(l),u_trim_fade_range:new ql(l),u_trim_color:new Mf(l),u_emissive_strength:new ts(l),u_zbias_factor:new ts(l),u_tile_to_meter:new ts(l),u_ground_shadow_factor:new td(l)}),o.dT=l=>({u_camera_to_center_distance:new ts(l),u_extrude_scale:new my(l),u_device_pixel_ratio:new ts(l),u_matrix:new Df(l),u_inv_rot_matrix:new Df(l),u_merc_center:new ql(l),u_tile_id:new td(l),u_zoom_transition:new ts(l),u_up_dir:new td(l),u_emissive_strength:new ts(l)}),o.dU=Yh,o.dV=KG,o.dW=hk,o.dX=(l,i,s,u,d,g)=>{const _=l.transform,w=_.projection.name==="globe";let T;if(g.paint.get("circle-pitch-alignment")==="map")if(w){const C=ak(_.zoom,i.canonical)*_._pixelsPerMercatorPixel;T=Float32Array.from([C,0,0,C])}else T=_.calculatePixelsToTileUnitsMatrix(s);else T=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(_.projection),u_matrix:l.translatePosMatrix(i.projMatrix,s,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:fn.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:x8,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(w){E.u_inv_rot_matrix=u,E.u_merc_center=d,E.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],E.u_zoom_transition=sd(_.zoom);const C=d[0]*Bt,R=d[1]*Bt;E.u_up_dir=_.projection.upVector(new Oa(0,0,0),C,R)}return E},o.dY=GM,o.dZ=Gi,o.d_=(l,i,s,u,d,g,_,w,T,E)=>{const C=l.transform,R=C.pitch<15?VM(.07,.7,he((14-C.zoom)/5,0,1)):.07,M=s.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:jM(l,i,s,u),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:UM(i,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:_e(i.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:E}},o.da=function(l,i){return l.readFields(H$,{icons:[]},i)},o.db=mw,o.dc=Lm,o.dd=bI,o.de=Ah,o.df=L0,o.dg=ui,o.dh=uc,o.di=Nn,o.dj=function(l){const i=l.indexOf(Sf);return i>=0?l.slice(0,i):l},o.dk=function(l){return l.indexOf(Sf)>=0},o.dl=function(l){const i=l.lastIndexOf(Sf);return i>=0?l.slice(i+1):""},o.dm=function(l){const i=[],s=l.id;return s===void 0&&i.push({message:`layers.${s}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${s}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},o.dn=function(l,i,s,u){return l.type==="custom"?new B$(l,i):new G$[l.type](l,i,s,u)},o.dp=Qn,o.dq=function(l){const i=l.indexOf(Sf);return i>=0?l.slice(i+1):""},o.dr=class extends Um{constructor(l,i){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},o.ds=q_,o.dt=Wo,o.du=function(l){return l({pluginStatus:Fo,pluginURL:tu}),q_.on("pluginStateChange",l),l},o.dv=py,o.dw=class extends Xa{constructor(l){super(l),this.current=CE}set(l,i,s){if(this.fetchUniformLocation(l,i)){for(let u=0;u<9;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},o.dx=J,o.dy=function(l,i,s){const u=sd(s.zoom),d=l.style.map._antialias,g=l.terrain&&l.terrain.exaggeration()>0;return u===0&&!d&&!g},o.dz=function(l){const i=l.pixelsPerMeter,s=i/Z(1,l.center.lat),u=me(new Float64Array(16));return ge(u,u,[l.point.x,l.point.y,0]),Re(u,u,[s,s,i]),Float32Array.from(u)},o.e=ye,o.e$=W_,o.e0=sn,o.e1=yy,o.e2=ae,o.e3=Wu,o.e4=fw,o.e5=tM,o.e6=ad,o.e7=450,o.e8=7,o.e9=Ee,o.eA=function(l,i,s,u,d,g,_,w,T,E,C,R,M,z,F,G){var H=new P(16);return H[0]=l,H[1]=i,H[2]=s,H[3]=u,H[4]=d,H[5]=g,H[6]=_,H[7]=w,H[8]=T,H[9]=E,H[10]=C,H[11]=R,H[12]=M,H[13]=z,H[14]=F,H[15]=G,H},o.eB=A,o.eC=sy,o.eD=Cf,o.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new bt(1/0,1/0),max:new bt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,i=!1){const s=Uk(new bt(0,0),new bt(Bt,Bt),l),u=[];if(i&&!qE(s,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!qE(s,d))continue;const g=Z8(d.min,d.max,l);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(l){this._setSources(l.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const s=[];for(const u of i.cache.getVisibleCoordinates()){const d=i.cache.getTile(u).buckets[i.layer];d&&d.updateFootprints(u.toUnwrapped(),s)}return s},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(l){const i=l.getFootprints();if(i.length===0)return;const s=l.getOrder(),u=l.getClipMask(),d=l.getClipScope();for(const g of i){if(!g.footprint)continue;const _=Uk(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:s,clipMask:u,clipScope:d})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,s)=>i.priority-s.priority||uw(i.min,s.min)||uw(i.max,s.max)||i.order-s.order||i.clipMask-s.clipMask||function(u,d){const g=(_,w)=>_+w;return u.length-d.length||u.reduce(g,"").localeCompare(d.reduce(g,""))}(i.clipScope,s.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let i=0;for(;!l&&i!==this._activeRegions.length;){const s=this._activeRegions[i],u=this._prevRegions[i];l=s.priority!==u.priority||!Vk(s,u)||s.order!==u.order||s.clipMask!==u.clipMask||!Lo(s.clipScope,u.clipScope),++i}}if(l){++this._updateTime;for(const s of this._activeRegions)s.order!==Ey&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const i=s=>{const u=this._activeRegions;if(s>=u.length)return s;const d=u[s].priority;for(;s<u.length&&u[s].priority===d;)++s;return s};if(this._sourceIds.length>1){let s=0,u=i(s);for(;s!==u;){let d=s;const g=s;for(;d!==u;){const _=this._activeRegions[d];_.hiddenByOverlap=!1;for(let w=0;w<g;w++){const T=this._activeRegions[w];if(!T.hiddenByOverlap&&_.order===Ey&&qE(_,T)&&(_.hiddenByOverlap=jk(_.footprint,_.tileId,T.footprint,T.tileId),_.hiddenByOverlap))break}++d}s=u,u=i(s)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=l.length-1;i>=0;i--)this._addSource(l[i]);this._computeReplacement()}},o.eF=Ey,o.eG=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,i){const s=new Ko,u=new yr,d=[],g=l+1+2,_=i[0]+1,w=i[0]+1+(1+i.length),T=(E,C,R)=>{let M=E===g-1?E-2:E===0?E:E-1;return M+=R?24575:0,[M,C]};for(let E=0;E<g;++E)s.emplaceBack(...T(E,0,!0));for(let E=0;E<_;++E)for(let C=0;C<g;++C)s.emplaceBack(...T(C,E,(C===0||C===g-1)&&!0));for(let E=0;E<i.length;++E){const C=i[E];for(let R=0;R<g;++R)s.emplaceBack(...T(R,C,!0))}for(let E=0;E<i.length;++E){const C=u.length,R=i[E]+1+2,M=new yr;for(let G=0;G<R-1;G++){const H=G===R-2,K=H?g*(w-i.length+E-G):g;for(let ie=0;ie<g-1;ie++){const ne=G*g+ie;G===0||H||ie===0||ie===g-2?(M.emplaceBack(ne+1,ne,ne+K),M.emplaceBack(ne+K,ne+K+1,ne+1)):(u.emplaceBack(ne+1,ne,ne+K),u.emplaceBack(ne+K,ne+K+1,ne+1))}}const z=Cr.simpleSegment(0,C,s.length,u.length-C);for(let G=0;G<M.uint16.length;G+=3)u.emplaceBack(M.uint16[G],M.uint16[G+1],M.uint16[G+2]);const F=Cr.simpleSegment(0,C,s.length,u.length-C);d.push({withoutSkirts:z,withSkirts:F})}return{vertices:s,indices:u,segments:d}}_createGrid(l){const i=this._fillGridMeshWithLods(c,p);this._gridSegments=i.segments,this._gridBuffer=l.createVertexBuffer(i.vertices,nk.members),this._gridIndexBuffer=l.createIndexBuffer(i.indices,!0)}_createPoles(l){const i=new yr;for(let _=0;_<=c;_++)i.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=l.createIndexBuffer(i,!0);const s=new Hu,u=new Hu,d=new Hu,g=new Hu;this._poleSegments=[];for(let _=0,w=0;_<ew;_++){const T=360/(1<<_);s.emplaceBack(0,-To,0,.5,0),u.emplaceBack(0,-To,0,.5,1),d.emplaceBack(0,-To,0,.5,.5),g.emplaceBack(0,-To,0,.5,.5);for(let E=0;E<=c;E++){let C=E/c,R=0;const M=gn(0,T,C),[z,F,G]=b(y8,v8,M,To);s.emplaceBack(z,F,G,C,R),u.emplaceBack(z,F,G,C,1-R);const H=fi(M);C=.5+.5*Math.sin(H),R=.5+.5*Math.cos(H),d.emplaceBack(z,F,G,C,R),g.emplaceBack(z,F,G,C,1-R)}this._poleSegments.push(Cr.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(s,tw,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(u,tw,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(d,tw,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(g,tw,!1)}getGridBuffers(l,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},o.eH=Nk,o.eI=le,o.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eK=Ie,o.eL=pe,o.eM=function(l,i,s){return l[0]=i[0]/s[0],l[1]=i[1]/s[1],l[2]=i[2]/s[2],l},o.eN=Ts,o.eO=I,o.eP=Xr,o.eQ=Ln,o.eR=function([l,i,s]){const u=Math.hypot(l,i,s),d=Math.atan2(l,s),g=.5*Math.PI-Math.acos(-i/u);return new L(Ge(d),Ge(g))},o.eS=ds,o.eT=aI,o.eU=function(l){const i=l.navigator?l.navigator.userAgent:null;return!!function(s){if(ji==null){const u=s.navigator?s.navigator.userAgent:null;ji=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ji}(l)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eV=function(l,i){Fi=l,pr=i},o.eW=FE,o.eX=ck,o.eY=function(l){const i=[0,0,0],s=me(new Float64Array(16));return de(s,l.pixelMatrix,l.globeMatrix),Wi(i,i,s),new bt(i[0],i[1])},o.eZ=function(){const l=Ry;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(JE),Ry=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.e_=function(){mw().acquire(JE)},o.ea=function(l,i){if(l===i){var s=i[1],u=i[2],d=i[3],g=i[6],_=i[7],w=i[11];l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=s,l[6]=i[9],l[7]=i[13],l[8]=u,l[9]=g,l[11]=i[14],l[12]=d,l[13]=_,l[14]=w}else l[0]=i[0],l[1]=i[4],l[2]=i[8],l[3]=i[12],l[4]=i[1],l[5]=i[5],l[6]=i[9],l[7]=i[13],l[8]=i[2],l[9]=i[6],l[10]=i[10],l[11]=i[14],l[12]=i[3],l[13]=i[7],l[14]=i[11],l[15]=i[15];return l},o.eb=N$,o.ec=di,o.ed=ly,o.ee=256,o.ef=OE,o.eg=Ra,o.eh=ct,o.ei=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[4],l[4]=i[5],l[5]=i[6],l[6]=i[8],l[7]=i[9],l[8]=i[10],l},o.ej=Hu,o.ek=ry,o.el=E0,o.em=function(l,i,s,u,d){return he((l-i)/(s-i)*(d-u)+u,u,d)},o.en=ra,o.eo=function(l,i){var s=i[0],u=i[1],d=i[2],g=i[3],_=i[4],w=i[5],T=i[6],E=i[7],C=i[8],R=C*_-w*E,M=-C*g+w*T,z=E*g-_*T,F=s*R+u*M+d*z;return F?(l[0]=R*(F=1/F),l[1]=(-C*u+d*E)*F,l[2]=(w*u-d*_)*F,l[3]=M*F,l[4]=(C*s-d*T)*F,l[5]=(-w*s+d*g)*F,l[6]=z*F,l[7]=(-E*s+u*T)*F,l[8]=(_*s-u*g)*F,l):null},o.ep=2,o.eq=Kr,o.er=lI,o.es=[1,1,1],o.et=class{constructor(l,i,s,u){this.context=l,this.format=u,this.size=s,this.texture=l.gl.createTexture();const[d,g,_]=this.size,{gl:w}=l;w.bindTexture(w.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,d,g,_,0,rI(this.format),sI(this.format),i.data)}bind(l,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_3D,this.texture),l!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,l),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,l),this.minFilter=l),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},o.eu=Fm,o.ev=ia,o.ew=function(l,i,s,u){var d=i[0],g=i[1],_=i[2],w=i[3];return l[0]=d+u*(s[0]-d),l[1]=g+u*(s[1]-g),l[2]=_+u*(s[2]-_),l[3]=w+u*(s[3]-w),l},o.ex=km,o.ey=Hl,o.ez=su,o.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(i,s)=>String.fromCharCode(+("0x"+s))))},o.f0=function(l,i,s=!1){if(Fo===oa.deferred||Fo===oa.loading||Fo===oa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");tu=fn.resolveURL(l),Fo=oa.deferred,$_=i,H_(),s||O0()},o.f1=function(l){Cm=fn.resolveURL(l),Pm||(Pm=new Am(mw(),new Nl)),Pm.broadcast("setMeshoptUrl",Cm)},o.f2=pM,o.f3=function(l){tI=fn.resolveURL(l),Pm||(Pm=new Am(mw(),new Nl)),Pm.broadcast("setDracoUrl",tI)},o.f4=fM,o.f5=Py,o.f6=function(l){const i=Sa();if(!i)return;const s=i.delete(jn);l&&s.then(()=>l()).catch(l)},o.f7=Nf,o.f8=Xt,o.f9=od,o.fa=gc,o.fb=FL,o.fc=NL,o.fd=zM,o.fe=qt,o.ff="hd_road_elevation",o.fg=Pr,o.fh=Cn,o.fi=zf,o.fj=wI,o.fk=Uf,o.fl=function(l,i,s,u,d,g,_,w=1,T,E,C){l.createArrays(),l.tilePixelRatio=Bt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const R=l.layers[0].layout,M=l.layers[0]._unevaluatedLayout._values,z={};z.scaleFactor=w,z.textSizeScaleRange=R.get("text-size-scale-range"),z.iconSizeScaleRange=R.get("icon-size-scale-range");const[F,G]=z.textSizeScaleRange,[H,K]=z.iconSizeScaleRange;z.textScaleFactor=he(z.scaleFactor,F,G),z.iconScaleFactor=he(z.scaleFactor,H,K);const ie=M["text-size"],ne=M["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:Ne,maxZoom:at}=l.textSizeData;z.compositeTextSizes=[ie.possiblyEvaluate(new Zi(Ne,{worldview:C}),g),ie.possiblyEvaluate(new Zi(at,{worldview:C}),g)]}if(l.iconSizeData.kind==="composite"){const{minZoom:Ne,maxZoom:at}=l.iconSizeData;z.compositeIconSizes=[ne.possiblyEvaluate(new Zi(Ne,{worldview:C}),g),ne.possiblyEvaluate(new Zi(at,{worldview:C}),g)]}z.layoutTextSize=ie.possiblyEvaluate(new Zi(_+1,{worldview:C}),g),z.layoutIconSize=ne.possiblyEvaluate(new Zi(_+1,{worldview:C}),g),z.textMaxSize=ie.possiblyEvaluate(new Zi(18,{worldview:C}),g);const se=R.get("symbol-placement"),Se=R.get("text-rotation-alignment")==="map"&&se!=="point",we=R.get("text-size");let Te=!1;const Oe=[];for(const Ne of l.features){const at=R.get("text-font").evaluate(Ne,{},g).join(","),He=we.evaluate(Ne,{},g)*z.textScaleFactor,ht=z.layoutTextSize.evaluate(Ne,{},g)*z.textScaleFactor,Mt=z.layoutIconSize.evaluate(Ne,{},g)*z.iconScaleFactor,gt={horizontal:{},vertical:void 0},It=Ne.text;let Rt,st=[0,0];if(It){const Zt=It.toString(),Tn=R.get("text-letter-spacing").evaluate(Ne,{},g)*Ks,kn=R.get("text-line-height").evaluate(Ne,{},g)*Ks,Un=_E(Zt)?Tn:0,On=R.get("text-anchor").evaluate(Ne,{},g),li=R.get("text-variable-anchor");if(!li){const it=R.get("text-radial-offset").evaluate(Ne,{},g);if(it)st=wD(On,[it*Ks,TI]);else{const Ft=R.get("text-offset").evaluate(Ne,{},g);st=[Ft[0]*Ks,Ft[1]*Ks]}}let Yn=Se?"center":R.get("text-justify").evaluate(Ne,{},g);const hr=se==="point",ce=hr?R.get("text-max-width").evaluate(Ne,{},g)*Ks:1/0,ue=it=>{l.allowVerticalPlacement&&G_(Zt)&&(gt.vertical=yI(It,i,s,d,at,ce,kn,On,it,Un,st,Na.vertical,!0,ht,He,T))};if(!Se&&li){const it=Yn==="auto"?li.map(Gt=>EI(Gt)):[Yn];let Ft=!1;for(let Gt=0;Gt<it.length;Gt++){const jt=it[Gt];if(!gt.horizontal[jt])if(Ft)gt.horizontal[jt]=gt.horizontal[0];else{const Yt=yI(It,i,s,d,at,ce,kn,"center",jt,Un,st,Na.horizontal,!1,ht,He,T);Yt&&(gt.horizontal[jt]=Yt,Ft=Yt.positionedLines.length===1)}}ue("left")}else{if(Yn==="auto"&&(Yn=EI(On)),hr||R.get("text-writing-mode").indexOf("horizontal")>=0||!G_(Zt)){const it=yI(It,i,s,d,at,ce,kn,On,Yn,Un,st,Na.horizontal,!1,ht,He,T);it&&(gt.horizontal[Yn]=it)}ue(hr?"left":Yn)}}let St,qe,ot,zt,At,ln,Kt=!1;const Tt=R.get("icon-text-fit").evaluate(Ne,{},g);if(Ne.icon&&Ne.icon.hasPrimary()){const Zt=TD(Ne.icon,l.iconSizeData,M["icon-size"],g,l.zoom,Ne,T,z.iconScaleFactor,C);St=Zt.iconPrimary,ot=Zt.iconSecondary;const Tn=St.toString();if(qe=u.get(Tn),qe&&(At=R.get("icon-offset").evaluate(Ne,{},g),ln=R.get("icon-anchor").evaluate(Ne,{},g),Rt=p$(d.get(Tn),ot?d.get(ot.toString()):void 0,At,ln),Kt=qe.sdf,l.sdfIcons===void 0?l.sdfIcons=qe.sdf:l.sdfIcons!==qe.sdf&&ni("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(qe.pixelRatio!==l.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),ot){const kn=ot.toString();zt=u.get(kn)}}Te=Te||!(!Ne.icon||!Ne.icon.hasSecondary());const Ct=II(gt.horizontal)||gt.vertical;l.iconsInText||(l.iconsInText=!!Ct&&Ct.iconsInText);const Jt=ht*z.textScaleFactor/Ks,{defaultShapedIcon:Wt,verticallyShapedIcon:Vt}=E$(l,Rt,R,Ne,g,gt,Jt,At,Tt);Tt!=="none"&&Rt&&(sD(Rt)||oD(Rt))&&(Aw(0,qe,St,Rt,Wt,Tt,E,u,d),Aw(0,zt,ot,Rt,Wt,Tt,E,u,d),Vt&&(Aw(0,qe,St,Rt,Vt,Tt,E,u,d),Aw(0,zt,ot,Rt,Vt,Tt,E,u,d))),Rt=Wt,Oe.push({feature:Ne,shapedTextOrientations:gt,shapedText:Ct,shapedIcon:Rt,iconPrimary:St,iconSecondary:ot,iconOffset:At,iconAnchor:ln,verticallyShapedIcon:Vt,layoutTextSize:ht,layoutIconSize:Mt,textOffset:st,isSDFIcon:Kt,iconTextFit:Tt})}return{featureData:Oe,sizes:z,hasAnySecondaryIcon:Te,textAlongLine:Se,symbolPlacement:se}},o.fm=mD,o.fn=function(l,i,s,u,d,g,_,w,T,E){const{featureData:C,hasAnySecondaryIcon:R,sizes:M,textAlongLine:z,symbolPlacement:F}=i;for(const G of C){const{shapedIcon:H,verticallyShapedIcon:K,feature:ie,shapedTextOrientations:ne,shapedText:se,layoutTextSize:Se,textOffset:we,isSDFIcon:Te,iconPrimary:Oe,iconSecondary:Ne,iconTextFit:at,iconOffset:He}=G;ED(H,E.iconPositions,Oe,Ne),ED(K,E.iconPositions,Oe,Ne),T$(ne,E.iconPositions),b$(Oe,Ne,E.iconPositions),(se||H)&&I$(l,ie,ne,H,K,T,M,Se,0,we,Te,u,d,_,w,R,at,He,z,F)}s&&l.generateCollisionDebugBuffers(g,l.collisionBoxArray,M.textScaleFactor)},o.fo=tn,o.fp=Ww,o.fq=Ke,o.fr=function(l){let i=0;if(new Uint32Array(l,0,1)[0]!==gM){const s=new Uint32Array(l,0,7),[,,u,d,g,_]=s;i=s.byteLength+d+g+_+g,(u!==l.byteLength||i>=l.byteLength)&&ni("Invalid b3dm header information.")}return xM(l,i)},o.fs=function(l,i){const s=CM(l);for(const u of s){for(const d of u.meshes)IG(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(SG(u.lights,i)))}return s},o.ft=Uw,o.fu=gi,o.fv=hM,o.fw=Gl,o.fx=oa,o.fy=function(l){zl(),cs!=null&&cs.then(i=>{i.keys().then(s=>{for(let u=0;u<s.length-l;u++)i.delete(s[u]).catch(d=>ni(d.message))}).catch(s=>ni(s.message))}).catch(i=>ni(i.message))},o.g=function(l,i){return Wo(Xe(l,{method:"GET"}),i)},o.h=Xe,o.i=function(l){return ye.API_STYLE_REGEX.test(l)&&!ze(l)},o.j=function(l){return l.indexOf("mapbox:")===0},o.k=tt,o.l=Sh,o.m=function(l){return decodeURIComponent(atob(l).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.n=function(l,i){return Wo(Xe(l,{type:"json"}),i)},o.o=gl,o.p=function(l,i){return Wo(Xe(l,{method:"POST"}),i)},o.q=fn,o.r=lo,o.s=function(l){try{const i=self[l];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=un,o.u=function(){return function l(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},o.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},o.w=ni,o.x=function(){return eI||(eI=new Nf),eI},o.y=VI,o.z=so}),m(["./shared"],function(o){function S(Ge){const Y=Ge?Ge.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function P(Ge){if(typeof Ge=="number"||typeof Ge=="boolean"||typeof Ge=="string"||Ge==null)return JSON.stringify(Ge);if(Array.isArray(Ge)){let J="[";for(const le of Ge)J+=`${P(le)},`;return`${J}]`}let Y="{";for(const J of Object.keys(Ge).sort())Y+=`${J}:${P(Ge[J])},`;return`${Y}}`}function N(Ge){let Y="";for(const J of o.bu)Y+=`/${P(Ge[J])}`;return Y}class V{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,J){this._layerConfigs={},this._layers={},this.update(Y,[],J)}update(Y,J,le){this._options=le;for(const he of Y)this._layerConfigs[he.id]=he,(this._layers[he.id]=o.dn(he,this.scope,null,this._options)).compileFilter(le),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of J)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const Ie=function(he,Me){const Je={};for(let Xe=0;Xe<he.length;Xe++){const Pt=he[Xe];let pt=Me&&Me[Pt.id];pt||(Pt.type==="symbol"?pt=Pt.id:(pt=N(Pt),Pt.type==="line"&&Pt.paint&&function _n(Cn){return typeof Cn=="string"&&Cn==="line-progress"||(Array.isArray(Cn)?Cn.some(_n):!(!Cn||typeof Cn!="object")&&Object.values(Cn).some(_n))}(Pt.paint["line-width"])&&(pt+=`/${P(Pt.paint["line-width"])}`))),Me&&(Me[Pt.id]=pt);let sn=Je[pt];sn||(sn=Je[pt]=[]),sn.push(Pt)}const Fe=[];for(const Xe in Je)Fe.push(Je[Xe]);return Fe}(Object.values(this._layerConfigs),this.keyCache);for(const he of Ie){const Me=he.map(sn=>this._layers[sn.id]),Je=Me[0];if(Je.visibility==="none")continue;const Fe=Je.source||"";let Xe=this.familiesBySource[Fe];Xe||(Xe=this.familiesBySource[Fe]={});const Pt=Je.sourceLayer||"_geojsonTileLayer";let pt=Xe[Pt];pt||(pt=Xe[Pt]=[]),pt.push(Me)}}}const j=1*o.fa;class Q{constructor(Y){const J={},le=[];for(const Je in Y){const Fe=Y[Je],Xe=J[Je]={};for(const Pt in Fe.glyphs){const pt=Fe.glyphs[+Pt];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const sn=pt.metrics.localGlyph?j:1,_n={x:0,y:0,w:pt.bitmap.width+2*sn,h:pt.bitmap.height+2*sn};le.push(_n),Xe[Pt]=_n}}const{w:Ie,h:he}=o.H(le),Me=new o.f9({width:Ie||1,height:he||1});for(const Je in Y){const Fe=Y[Je];for(const Xe in Fe.glyphs){const Pt=Fe.glyphs[+Xe];if(!Pt||Pt.bitmap.width===0||Pt.bitmap.height===0)continue;const pt=J[Je][Xe],sn=Pt.metrics.localGlyph?j:1;o.f9.copy(Pt.bitmap,Me,{x:0,y:0},{x:pt.x+sn,y:pt.y+sn},Pt.bitmap)}}this.image=Me,this.positions=J}}o.f8(Q,"GlyphAtlas");class oe{constructor(Y){this.tileID=new o.aM(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=o.aW(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor,this.worldview=Y.worldview}parse(Y,J,le,Ie,he,Me){this.status="parsing",this.data=Y,this.collisionBoxArray=new o.b0;const Je=new o.fb(Object.keys(Y.layers).sort()),Fe=new o.fc(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const Xe={},Pt=new o.fd(256,256),pt={featureIndex:Fe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Pt,availableImages:le,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},sn=[],_n=J.familiesBySource[this.source];for(const Qn in _n){const Nn=Y.layers[Qn];if(!Nn)continue;let Jn=!1,Ui=!1,ni=!1;for(const gi of _n[Qn])gi[0].type==="symbol"?Jn=!0:Ui=!0,gi[0].is3D()&&gi[0].type!=="model"&&(ni=!0);if(this.extraShadowCaster&&!ni||this.isSymbolTile===!0&&!Jn||this.isSymbolTile===!1&&!Ui)continue;Nn.version===1&&o.w(`Vector tile source "${this.source}" layer "${Qn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const br=Je.encode(Qn),Tr=[];let jr=!1;for(let gi=0,ci=0;gi<Nn.length;gi++){const ji=Nn.feature(gi),tr=Fe.getId(ji,Qn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Qn)){const cr=ji.properties?ji.properties.worldview:null;if(this.worldview&&typeof cr=="string")if(cr==="all")ji.properties.$localized=!0;else{if(!cr.split(",").includes(this.worldview))continue;ji.properties.$localized=!0,ji.properties.worldview=this.worldview}}!jr&&ji.properties&&ji.properties.hasOwnProperty(o.fe)&&(jr=!0),Tr.push({feature:ji,id:tr,index:ci,sourceLayerIndex:br}),ci++}jr&&!pt.elevationFeatures&&Y.layers.hasOwnProperty(o.ff)&&(pt.elevationFeatures=o.fg.parseFrom(Y.layers[o.ff],this.canonical));for(const gi of _n[Qn]){const ci=gi[0];if(this.extraShadowCaster&&(!ci.is3D()||ci.type==="model")||this.isSymbolTile!==void 0&&ci.type==="symbol"!==this.isSymbolTile||ci.minzoom&&this.zoom<Math.floor(ci.minzoom)||ci.maxzoom&&this.zoom>=ci.maxzoom||ci.visibility==="none")continue;me(gi,this.zoom,pt.brightness,le,this.worldview);const ji=Xe[ci.id]=ci.createBucket({index:Fe.bucketLayerIDs.length,layers:gi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:br,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ie,worldview:this.worldview});Fe.bucketLayerIDs.push(gi.map(cr=>o.C(cr.id,cr.scope)));let tr=ji.prepare?ji.prepare():null;tr!=null?(tr=tr.then(()=>ji.populate(Tr,pt,this.tileID.canonical,this.tileTransform)),sn.push(tr)):ji.populate(Tr,pt,this.tileID.canonical,this.tileTransform)}}const Cn=()=>{let Qn,Nn,Jn,Ui,ni,br;Pt.trim();const Tr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},jr=()=>{if(Qn)return this.status="done",Me(Qn);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values(Xe).filter(ci=>!ci.isEmpty()),featureIndex:Fe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:pt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Nn&&Jn&&Ui){const ci=new Q(Nn),ji=new Map;for(const[ls,Ls]of Jn.entries()){const{imagePosition:Os}=o.fj(ls,Ls,o.fk);ji.set(ls,Os)}const tr={};for(const ls in Xe){const Ls=Xe[ls];Ls instanceof o.b1&&(me(Ls.layers,this.zoom,pt.brightness,le,this.worldview),tr[ls]=o.fl(Ls,Nn,ci.positions,Jn,ji,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ni,this.worldview))}const cr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(he,Jn,ni,()=>{cr.iconsPending=!1,gi(tr,ci,cr)}),this.rasterizeIfNeeded(he,Ui,br,()=>{cr.patternsPending=!1,gi(tr,ci,cr)})}},gi=(ci,ji,tr,cr)=>{if(tr.iconsPending||tr.patternsPending)return;const ls=new o.fm(Jn,Ui,this.lut);for(const Ls in Xe){const Os=Xe[Ls];if(Ls in ci)o.fn(Os,ci[Ls],this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Jn,ls);else if(Os.hasPattern&&(Os instanceof o.b7||Os instanceof o.b8||Os instanceof o.e4)){me(Os.layers,this.zoom,pt.brightness,le,this.worldview);const fl=Object.fromEntries(ls.patternPositions);Os.addFeatures(pt,this.tileID.canonical,fl,le,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values(Xe).filter(Ls=>!Ls.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ji.image,lineAtlas:Pt,imageAtlas:ls,brightness:pt.brightness})};if(!this.extraShadowCaster){const ci=o.fh(pt.glyphDependencies,cr=>Object.keys(cr).map(Number));Object.keys(ci).length?he.send("getGlyphs",{uid:this.uid,stacks:ci},(cr,ls)=>{Qn||(Qn=cr,Nn=ls,jr())},void 0,!1,Tr):Nn={};const ji=Array.from(pt.iconDependencies.keys()).map(cr=>o.I.parse(cr));ji.length?he.send("getImages",{images:ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(cr,ls)=>{Qn||(Qn=cr,Jn=new Map,ni=this.updateImageMapAndGetImageTaskQueue(Jn,ls,pt.iconDependencies),jr())},void 0,!1,Tr):(Jn=new Map,ni=new Map);const tr=Array.from(pt.patternDependencies.keys()).map(cr=>o.I.parse(cr));tr.length?he.send("getImages",{images:tr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(cr,ls)=>{Qn||(Qn=cr,Ui=new Map,br=this.updateImageMapAndGetImageTaskQueue(Ui,ls,pt.patternDependencies),jr())},void 0,!1,Tr):(Ui=new Map,br=new Map)}if(pt.elevationFeatures&&pt.elevationFeatures.length>0){const ci=[];for(const tr of Object.values(Xe))if(tr instanceof o.b8){const cr=tr.getUnevaluatedPortalGraph();cr&&ci.push(cr)}const ji=o.fi.evaluate(ci);for(const tr of Object.values(Xe))if(tr instanceof o.b8){const cr=Y.layers[Je.decode(tr.sourceLayerIndex)];tr.setEvaluatedPortalGraph(ji,cr,this.tileID.canonical,pt.availableImages,pt.brightness)}}jr()};sn.length>0?Promise.allSettled(sn).then(Cn).catch(Me):Cn()}rasterizeIfNeeded(Y,J,le,Ie){Array.from(J.values()).some(he=>he.usvg)?this.rasterize(Y,J,le,Ie):Ie()}updateImageMapAndGetImageTaskQueue(Y,J,le){const Ie=new Map;for(const he of J.keys()){const Me=le.get(he)||[];for(const Je of Me){const Fe=Je.toString(),Xe=J.get(Je.id.toString());Xe.usvg?Ie.has(Fe)||(Ie.set(Fe,Je),Y.set(Fe,Object.assign({},Xe))):Y.set(Fe,Xe)}}return Ie}rasterize(Y,J,le,Ie){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:le},(he,Me)=>{if(!he)for(const[Je,Fe]of Me.entries()){const Xe=Object.assign(J.get(Je),{data:Fe});J.set(Je,Xe)}Ie()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function me(Ge,Y,J,le,Ie){const he=new o.aa(Y,{brightness:J,worldview:Ie});for(const Me of Ge)Me.recalculate(he,le)}class Ue extends o.E{constructor(Y,J,le,Ie,he,Me,Je){super(),this.actor=Y,this.layerIndex=J,this.availableImages=le,this.availableModels=Ie,this.loadVectorData=Me||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(Y.scheduler),this.isSpriteLoaded=he,this.scheduler=Y.scheduler,this.brightness=Je}loadTile(Y,J){const le=Y.uid,Ie=Y&&Y.request,he=Ie&&Ie.collectResourceTiming,Me=this.loading[le]=new oe(Y);Me.abort=this.loadVectorData(Y,(Je,Fe)=>{const Xe=!this.loading[le];if(delete this.loading[le],Me.cancelRasterize(),Xe||Je||!Fe)return Me.status="done",Xe||(this.loaded[le]=Me),J(Je);const Pt=Fe.rawData,pt={};Fe.expires&&(pt.expires=Fe.expires),Fe.cacheControl&&(pt.cacheControl=Fe.cacheControl),Me.vectorTile=Fe.vectorTile||new o.fo(new o.bq(Pt));const sn=()=>{Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(_n,Cn)=>{if(_n||!Cn)return J(_n);const Qn={};if(he){const Nn=S(Ie);Nn.length>0&&(Qn.resourceTiming=JSON.parse(JSON.stringify(Nn)))}J(null,o.h({rawTileData:Pt.slice(0)},Cn,pt,Qn))})};this.isSpriteLoaded?sn():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(sn,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):sn()}),this.loaded=this.loaded||{},this.loaded[le]=Me})}reloadTile(Y,J){const le=this.loaded,Ie=Y.uid;if(le&&le[Ie]){const he=le[Ie];he.scaleFactor=Y.scaleFactor,he.showCollisionBoxes=Y.showCollisionBoxes,he.projection=Y.projection,he.brightness=Y.brightness,he.tileTransform=o.aW(Y.tileID.canonical,Y.projection),he.extraShadowCaster=Y.extraShadowCaster,he.lut=Y.lut,he.worldview=Y.worldview;const Me=(Je,Fe)=>{const Xe=he.reloadCallback;Xe&&(delete he.reloadCallback,he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xe)),J(Je,Fe)};he.status==="parsing"?he.reloadCallback=Me:he.status==="done"&&(he.vectorTile?he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Me):Me())}else J(null,void 0)}abortTile(Y,J){const le=Y.uid,Ie=this.loading[le];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[le]),J()}removeTile(Y,J){const le=this.loaded,Ie=Y.uid;le&&le[Ie]&&delete le[Ie],J()}}class de{loadTile(Y,J){const{uid:le,encoding:Ie,rawImageData:he,padding:Me}=Y,Je=ImageBitmap&&he instanceof ImageBitmap?this.getImageData(he,Me):he;J(null,new o.fp(le,Je,Ie,Me<1))}reloadTile(Y,J){J(null,null)}abortTile(Y,J){J()}removeTile(Y,J){J()}getImageData(Y,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const le=this.offscreenCanvasContext.getImageData(-J,-J,Y.width+2*J,Y.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}o.bp.setPbf(o.bq);class ge{constructor(Y){this._mrt=new o.bp(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,J){const le=this._mrt;this.status="parsing",this._entireBuffer=Y;try{le.parseHeader(Y),this._isHeaderLoaded=!0;const Ie=[];for(const he in le.layers){const Me=le.getLayer(he),Je=Me.getDataRange(Me.getBandList()),Fe=le.createDecodingTask(Je),Xe=Y.slice(Je.firstByte,Je.lastByte+1),Pt=o.bp.performDecoding(Xe,Fe).then(pt=>Fe.complete(null,pt)).catch(pt=>Fe.complete(pt,null));Ie.push(Pt)}Promise.allSettled(Ie).then(()=>J(null,le)).catch(he=>J(he))}catch(Ie){J(Ie)}}}class Re{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,J){const le=Y.uid,Ie=Y.request,he=this.loading[le]=new ge(Y),{cancel:Me}=o.br(Ie,(Je,Fe,Xe,Pt)=>{const pt=!this.loading[le];if(delete this.loading[le],pt||Je||!Fe)return he.status="done",pt||(this.loaded[le]=he),J(Je);he.parse(Fe,(sn,_n)=>{if(sn||!_n)return J(sn);J(null,_n,Xe,Pt)}),this.loaded[le]=he});he.abort=Me}reloadTile(Y,J){J(null,void 0)}abortTile(Y,J){const le=Y.uid,Ie=this.loading[le];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[le]),J()}removeTile(Y,J){const le=Y.uid;this.loaded[le]&&delete this.loaded[le],J()}decodeRasterArray(Y,J){o.bp.performDecoding(Y.buffer,Y.task).then(le=>J(null,le)).catch(le=>J(le))}}const _t=o.fq.prototype.toGeoJSON;class ct{constructor(Y){this._feature=Y,this.extent=o.aj,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const J of this._feature.geometry)Y.push([new o.P(J[0],J[1])]);return Y}{const Y=[];for(const J of this._feature.geometry){const le=[];for(const Ie of J)le.push(new o.P(Ie[0],Ie[1]));Y.push(le)}return Y}}toGeoJSON(Y,J,le){return _t.call(this,Y,J,le)}}class nt{constructor(Y,J){this.name=Y,this.extent=o.aj,this.length=J.length,this._jsonFeatures=J}feature(Y){return new ct(this._jsonFeatures[Y])}}class Pe{constructor(Y){this.layers={},this.extent=o.aj;for(const J of Object.keys(Y))this.layers[J]=new nt(J,Y[J])}}const xe=64/4096,ke=128;class Ve{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],J){for(const le of Y){const Ie=le.id;if(Ie==null)continue;let he=this.features.get(Ie);he&&this.updateCache(he,J),le.geometry?(he=Qe(le),this.updateCache(he,J),this.features.set(Ie,he)):this.features.delete(Ie),this.updateCache(he,J)}}updateCache(Y,J){for(const{canonical:le,uid:Ie}of Object.values(J)){const{z:he,x:Me,y:Je}=le;De(Y,Math.pow(2,he),Me,Je)&&delete J[Ie]}}getTile(Y,J,le){const Ie=Math.pow(2,Y),he=[];for(const Me of this.features.values())De(Me,Ie,J,le)&&he.push(ii(Me,Ie,J,le));return{features:he}}getFeatures(){return[...this.features.values()]}}function De({minX:Ge,minY:Y,maxX:J,maxY:le},Ie,he,Me){return Ge<(he+1+xe)/Ie&&Y<(Me+1+xe)/Ie&&J>(he-xe)/Ie&&le>(Me-xe)/Ie}function Qe(Ge){const{id:Y,geometry:J,properties:le}=Ge;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ie,coordinates:he}=J,Me={id:Y,type:1,geometry:[],tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Je=Me.geometry;if(Ie==="Point")Be(he,Je,Me);else if(Ie==="MultiPoint")for(const Fe of he)Be(Fe,Je,Me);else if(Ie==="LineString")Me.type=2,Hn(he,Je,Me);else if(Ie==="MultiLineString")Me.type=2,Ln(he,Je,Me);else if(Ie==="Polygon")Me.type=3,Ln(he,Je,Me,!0);else{if(Ie!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Me.type=3;for(const Fe of he)Ln(Fe,Je,Me,!0)}return Me}function Be([Ge,Y],J,le){const Ie=o.aD(Ge);let he=o.aH(Y);he=he<0?0:he>1?1:he,J.push(Ie,he),le.minX=Math.min(le.minX,Ie),le.minY=Math.min(le.minY,he),le.maxX=Math.max(le.maxX,Ie),le.maxY=Math.max(le.maxY,he)}function Hn(Ge,Y,J,le=!1,Ie=!1){const he=[];for(const Me of Ge)Be(Me,he,J);Y.push(he),le&&function(Me,Je){let Fe=0;for(let Xe=0,Pt=Me.length,pt=Pt-2;Xe<Pt;pt=Xe,Xe+=2)Fe+=(Me[Xe]-Me[pt])*(Me[Xe+1]+Me[pt+1]);if(Fe>0===Je)for(let Xe=0,Pt=Me.length;Xe<Pt/2;Xe+=2){const pt=Me[Xe],sn=Me[Xe+1];Me[Xe]=Me[Pt-2-Xe],Me[Xe+1]=Me[Pt-1-Xe],Me[Pt-2-Xe]=pt,Me[Pt-1-Xe]=sn}}(he,Ie)}function Ln(Ge,Y,J,le=!1){for(let Ie=0;Ie<Ge.length;Ie++)Hn(Ge[Ie],Y,J,le,Ie===0)}function ii(Ge,Y,J,le){const{id:Ie,type:he,geometry:Me,tags:Je}=Ge,Fe=[];if(he===1)(function(Xe,Pt,pt,sn,_n){for(let Cn=0;Cn<Xe.length;Cn+=2){const Qn=Math.round(o.aj*(Xe[Cn+0]*Pt-pt)),Nn=Math.round(o.aj*(Xe[Cn+1]*Pt-sn));_n.push([Qn,Nn])}})(Me,Y,J,le,Fe);else for(const Xe of Me)Ii(Xe,Y,J,le,Fe);return{id:Ie,type:he,geometry:Fe,tags:Je}}function Ii(Ge,Y,J,le,Ie){const he=-ke,Me=o.aj+ke;let Je;for(let Fe=0;Fe<Ge.length-2;Fe+=2){let Xe=Math.round(o.aj*(Ge[Fe+0]*Y-J)),Pt=Math.round(o.aj*(Ge[Fe+1]*Y-le)),pt=Math.round(o.aj*(Ge[Fe+2]*Y-J)),sn=Math.round(o.aj*(Ge[Fe+3]*Y-le));const _n=pt-Xe,Cn=sn-Pt;Xe<he&&pt<he||(Xe<he?(Pt+=Math.round(Cn*((he-Xe)/_n)),Xe=he):pt<he&&(sn=Pt+Math.round(Cn*((he-Xe)/_n)),pt=he),Pt<he&&sn<he||(Pt<he?(Xe+=Math.round(_n*((he-Pt)/Cn)),Pt=he):sn<he&&(pt=Xe+Math.round(_n*((he-Pt)/Cn)),sn=he),Xe>=Me&&pt>=Me||(Xe>=Me?(Pt+=Math.round(Cn*((Me-Xe)/_n)),Xe=Me):pt>=Me&&(sn=Pt+Math.round(Cn*((Me-Xe)/_n)),pt=Me),Pt>=Me&&sn>=Me||(Pt>=Me?(Xe+=Math.round(_n*((Me-Pt)/Cn)),Pt=Me):sn>=Me&&(pt=Xe+Math.round(_n*((Me-Pt)/Cn)),sn=Me),Je&&Xe===Je[Je.length-1][0]&&Pt===Je[Je.length-1][1]||(Je=[[Xe,Pt]],Ie.push(Je)),Je.push([pt,sn])))))}}function vn({name:Ge,features:Y},J){J.writeStringField(1,Ge),J.writeVarintField(5,o.aj);const le=new Map,Ie=new Map,he={keys:le,values:Ie,feature:null};for(const Me of Y)he.feature=Me,J.writeMessage(2,Vn,he);for(const Me of le.keys())J.writeStringField(3,Me);for(const Me of Ie.keys())J.writeMessage(4,Xr,Me)}function Vn(Ge,Y){const J=Ge.feature;J.id===void 0||isNaN(+J.id)||Y.writeVarintField(1,+J.id),J.tags&&Y.writeMessage(2,je,Ge),Y.writeVarintField(3,J.type),Y.writeMessage(4,et,J)}function je({keys:Ge,values:Y,feature:J},le){for(const Ie of Object.keys(J.tags)){let he=J.tags[Ie];if(he===null)continue;let Me=Ge.get(Ie);Me===void 0&&(Me=Ge.size,Ge.set(Ie,Me)),le.writeVarint(Me);const Je=typeof he;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(he=JSON.stringify(he));let Fe=Y.get(he);Fe===void 0&&(Fe=Y.size,Y.set(he,Fe)),le.writeVarint(Fe)}}function Pn(Ge,Y){return(Y<<3)+(7&Ge)}function oi(Ge){return Ge<<1^Ge>>31}function et(Ge,Y){const{geometry:J,type:le}=Ge;let Ie=0,he=0;if(le===1){Y.writeVarint(Pn(1,J.length));for(const Me of J){const Je=Me[0]-Ie,Fe=Me[1]-he;Y.writeVarint(oi(Je)),Y.writeVarint(oi(Fe)),Ie+=Je,he+=Fe}}else for(const Me of J){Y.writeVarint(Pn(1,1));const Je=Me.length-(le===3?1:0);for(let Fe=0;Fe<Je;Fe++){Fe===1&&Y.writeVarint(Pn(2,Je-1));const Xe=Me[Fe][0]-Ie,Pt=Me[Fe][1]-he;Y.writeVarint(oi(Xe)),Y.writeVarint(oi(Pt)),Ie+=Xe,he+=Pt}le===3&&Y.writeVarint(Pn(7,1))}}function Xr(Ge,Y){const J=typeof Ge;J==="string"?Y.writeStringField(1,Ge):J==="boolean"?Y.writeBooleanField(7,Ge):J==="number"&&(Ge%1!=0?Y.writeDoubleField(3,Ge):Ge<0?Y.writeSVarintField(6,Ge):Y.writeVarintField(5,Ge))}const Kr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ge=>Ge},qn=Math.fround||(zi=new Float32Array(1),Ge=>(zi[0]=+Ge,zi[0]));var zi;const ar=3,rs=5,Wi=6;class $s{constructor(Y){this.options=Object.assign(Object.create(Kr),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:J,minZoom:le,maxZoom:Ie}=this.options;J&&console.time("total time");const he=`prepare ${Y.length} points`;J&&console.time(he),this.points=Y;const Me=[];for(let Fe=0;Fe<Y.length;Fe++){const Xe=Y[Fe];if(!Xe.geometry)continue;const[Pt,pt]=Xe.geometry.coordinates,sn=qn(Hs(Pt)),_n=qn(Vi(pt));Me.push(sn,_n,1/0,Fe,-1,1),this.options.reduce&&Me.push(0)}let Je=this.trees[Ie+1]=this._createTree(Me);J&&console.timeEnd(he);for(let Fe=Ie;Fe>=le;Fe--){const Xe=+Date.now();Je=this.trees[Fe]=this._createTree(this._cluster(Je,Fe)),J&&console.log("z%d: %d clusters in %dms",Fe,Je.numItems,+Date.now()-Xe)}return J&&console.timeEnd("total time"),this}getClusters(Y,J){let le=((Y[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,Y[1]));let he=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)le=-180,he=180;else if(le>he){const pt=this.getClusters([le,Ie,180,Me],J),sn=this.getClusters([-180,Ie,he,Me],J);return pt.concat(sn)}const Je=this.trees[this._limitZoom(J)],Fe=Je.range(Hs(le),Vi(Me),Hs(he),Vi(Ie)),Xe=Je.data,Pt=[];for(const pt of Fe){const sn=this.stride*pt;Pt.push(Xe[sn+rs]>1?Po(Xe,sn,this.clusterProps):this.points[Xe[sn+ar]])}return Pt}getChildren(Y){const J=this._getOriginId(Y),le=this._getOriginZoom(Y),Ie="No cluster with the specified id.",he=this.trees[le];if(!he)throw new Error(Ie);const Me=he.data;if(J*this.stride>=Me.length)throw new Error(Ie);const Je=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Fe=he.within(Me[J*this.stride],Me[J*this.stride+1],Je),Xe=[];for(const Pt of Fe){const pt=Pt*this.stride;Me[pt+4]===Y&&Xe.push(Me[pt+rs]>1?Po(Me,pt,this.clusterProps):this.points[Me[pt+ar]])}if(Xe.length===0)throw new Error(Ie);return Xe}getLeaves(Y,J,le){const Ie=[];return this._appendLeaves(Ie,Y,J=J||10,le=le||0,0),Ie}getTile(Y,J,le){const Ie=this.trees[this._limitZoom(Y)],he=Math.pow(2,Y),{extent:Me,radius:Je}=this.options,Fe=Je/Me,Xe=(le-Fe)/he,Pt=(le+1+Fe)/he,pt={features:[]};return this._addTileFeatures(Ie.range((J-Fe)/he,Xe,(J+1+Fe)/he,Pt),Ie.data,J,le,he,pt),J===0&&this._addTileFeatures(Ie.range(1-Fe/he,Xe,1,Pt),Ie.data,he,le,he,pt),J===he-1&&this._addTileFeatures(Ie.range(0,Xe,Fe/he,Pt),Ie.data,-1,le,he,pt),pt.features.length?pt:null}getClusterExpansionZoom(Y){let J=this._getOriginZoom(Y)-1;for(;J<=this.options.maxZoom;){const le=this.getChildren(Y);if(J++,le.length!==1)break;Y=le[0].properties.cluster_id}return J}_appendLeaves(Y,J,le,Ie,he){const Me=this.getChildren(J);for(const Je of Me){const Fe=Je.properties;if(Fe&&Fe.cluster?he+Fe.point_count<=Ie?he+=Fe.point_count:he=this._appendLeaves(Y,Fe.cluster_id,le,Ie,he):he<Ie?he++:Y.push(Je),Y.length===le)break}return he}_createTree(Y){const J=new o.c0(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<Y.length;le+=this.stride)J.add(Y[le],Y[le+1]);return J.finish(),J.data=Y,J}_addTileFeatures(Y,J,le,Ie,he,Me){for(const Je of Y){const Fe=Je*this.stride,Xe=J[Fe+rs]>1;let Pt,pt,sn;if(Xe)Pt=Ea(J,Fe,this.clusterProps),pt=J[Fe],sn=J[Fe+1];else{const Qn=this.points[J[Fe+ar]];Pt=Qn.properties;const[Nn,Jn]=Qn.geometry.coordinates;pt=Hs(Nn),sn=Vi(Jn)}const _n={type:1,geometry:[[Math.round(this.options.extent*(pt*he-le)),Math.round(this.options.extent*(sn*he-Ie))]],tags:Pt};let Cn;Cn=Xe||this.options.generateId?J[Fe+ar]:this.points[J[Fe+ar]].id,Cn!==void 0&&(_n.id=Cn),Me.features.push(_n)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,J){const{radius:le,extent:Ie,reduce:he,minPoints:Me}=this.options,Je=le/(Ie*Math.pow(2,J)),Fe=Y.data,Xe=[],Pt=this.stride;for(let pt=0;pt<Fe.length;pt+=Pt){if(Fe[pt+2]<=J)continue;Fe[pt+2]=J;const sn=Fe[pt],_n=Fe[pt+1],Cn=Y.within(Fe[pt],Fe[pt+1],Je),Qn=Fe[pt+rs];let Nn=Qn;for(const Jn of Cn){const Ui=Jn*Pt;Fe[Ui+2]>J&&(Nn+=Fe[Ui+rs])}if(Nn>Qn&&Nn>=Me){let Jn,Ui=sn*Qn,ni=_n*Qn,br=-1;const Tr=(pt/Pt<<5)+(J+1)+this.points.length;for(const jr of Cn){const gi=jr*Pt;if(Fe[gi+2]<=J)continue;Fe[gi+2]=J;const ci=Fe[gi+rs];Ui+=Fe[gi]*ci,ni+=Fe[gi+1]*ci,Fe[gi+4]=Tr,he&&(Jn||(Jn=this._map(Fe,pt,!0),br=this.clusterProps.length,this.clusterProps.push(Jn)),he(Jn,this._map(Fe,gi)))}Fe[pt+4]=Tr,Xe.push(Ui/Nn,ni/Nn,1/0,Tr,-1,Nn),he&&Xe.push(br)}else{for(let Jn=0;Jn<Pt;Jn++)Xe.push(Fe[pt+Jn]);if(Nn>1)for(const Jn of Cn){const Ui=Jn*Pt;if(!(Fe[Ui+2]<=J)){Fe[Ui+2]=J;for(let ni=0;ni<Pt;ni++)Xe.push(Fe[Ui+ni])}}}}return Xe}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,J,le){if(Y[J+rs]>1){const Me=this.clusterProps[Y[J+Wi]];return le?Object.assign({},Me):Me}const Ie=this.points[Y[J+ar]].properties,he=this.options.map(Ie);return le&&he===Ie?Object.assign({},he):he}}function Po(Ge,Y,J){return{type:"Feature",id:Ge[Y+ar],properties:Ea(Ge,Y,J),geometry:{type:"Point",coordinates:[(le=Ge[Y],360*(le-.5)),Ts(Ge[Y+1])]}};var le}function Ea(Ge,Y,J){const le=Ge[Y+rs],Ie=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,he=Ge[Y+Wi],Me=he===-1?{}:Object.assign({},J[he]);return Object.assign(Me,{cluster:!0,cluster_id:Ge[Y+ar],point_count:le,point_count_abbreviated:Ie})}function Hs(Ge){return Ge/360+.5}function Vi(Ge){const Y=Math.sin(Ge*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function Ts(Ge){const Y=(180-360*Ge)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function Ro(Ge,Y,J,le){let Ie=le;const he=Y+(J-Y>>1);let Me,Je=J-Y;const Fe=Ge[Y],Xe=Ge[Y+1],Pt=Ge[J],pt=Ge[J+1];for(let sn=Y+3;sn<J;sn+=3){const _n=ia(Ge[sn],Ge[sn+1],Fe,Xe,Pt,pt);if(_n>Ie)Me=sn,Ie=_n;else if(_n===Ie){const Cn=Math.abs(sn-he);Cn<Je&&(Me=sn,Je=Cn)}}Ie>le&&(Me-Y>3&&Ro(Ge,Y,Me,le),Ge[Me+2]=Ie,J-Me>3&&Ro(Ge,Me,J,le))}function ia(Ge,Y,J,le,Ie,he){let Me=Ie-J,Je=he-le;if(Me!==0||Je!==0){const Fe=((Ge-J)*Me+(Y-le)*Je)/(Me*Me+Je*Je);Fe>1?(J=Ie,le=he):Fe>0&&(J+=Me*Fe,le+=Je*Fe)}return Me=Ge-J,Je=Y-le,Me*Me+Je*Je}function Qs(Ge,Y,J,le){const Ie={id:Ge??null,type:Y,geometry:J,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")ds(Ie,J);else if(Y==="Polygon")ds(Ie,J[0]);else if(Y==="MultiLineString")for(const he of J)ds(Ie,he);else if(Y==="MultiPolygon")for(const he of J)ds(Ie,he[0]);return Ie}function ds(Ge,Y){for(let J=0;J<Y.length;J+=3)Ge.minX=Math.min(Ge.minX,Y[J]),Ge.minY=Math.min(Ge.minY,Y[J+1]),Ge.maxX=Math.max(Ge.maxX,Y[J]),Ge.maxY=Math.max(Ge.maxY,Y[J+1])}function Es(Ge,Y,J,le){if(!Y.geometry)return;const Ie=Y.geometry.coordinates;if(Ie&&Ie.length===0)return;const he=Y.geometry.type,Me=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let Je=[],Fe=Y.id;if(J.promoteId?Fe=Y.properties[J.promoteId]:J.generateId&&(Fe=le||0),he==="Point")ko(Ie,Je);else if(he==="MultiPoint")for(const Xe of Ie)ko(Xe,Je);else if(he==="LineString")io(Ie,Je,Me,!1);else if(he==="MultiLineString"){if(J.lineMetrics){for(const Xe of Ie)Je=[],io(Xe,Je,Me,!1),Ge.push(Qs(Fe,"LineString",Je,Y.properties));return}Mo(Ie,Je,Me,!1)}else if(he==="Polygon")Mo(Ie,Je,Me,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const Xe of Y.geometry.geometries)Es(Ge,{id:Fe,geometry:Xe,properties:Y.properties},J,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Ie){const Pt=[];Mo(Xe,Pt,Me,!0),Je.push(Pt)}}Ge.push(Qs(Fe,he,Je,Y.properties))}function ko(Ge,Y){Y.push(ra(Ge[0]),Dt(Ge[1]),0)}function io(Ge,Y,J,le){let Ie,he,Me=0;for(let Fe=0;Fe<Ge.length;Fe++){const Xe=ra(Ge[Fe][0]),Pt=Dt(Ge[Fe][1]);Y.push(Xe,Pt,0),Fe>0&&(Me+=le?(Ie*Pt-Xe*he)/2:Math.sqrt(Math.pow(Xe-Ie,2)+Math.pow(Pt-he,2))),Ie=Xe,he=Pt}const Je=Y.length-3;Y[2]=1,Ro(Y,0,Je,J),Y[Je+2]=1,Y.size=Math.abs(Me),Y.start=0,Y.end=Y.size}function Mo(Ge,Y,J,le){for(let Ie=0;Ie<Ge.length;Ie++){const he=[];io(Ge[Ie],he,J,le),Y.push(he)}}function ra(Ge){return Ge/360+.5}function Dt(Ge){const Y=Math.sin(Ge*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function Qt(Ge,Y,J,le,Ie,he,Me,Je){if(le/=Y,he>=(J/=Y)&&Me<le)return Ge;if(Me<J||he>=le)return null;const Fe=[];for(const Xe of Ge){const Pt=Xe.geometry;let pt=Xe.type;const sn=Ie===0?Xe.minX:Xe.minY,_n=Ie===0?Xe.maxX:Xe.maxY;if(sn>=J&&_n<le){Fe.push(Xe);continue}if(_n<J||sn>=le)continue;let Cn=[];if(pt==="Point"||pt==="MultiPoint")ai(Pt,Cn,J,le,Ie);else if(pt==="LineString")vi(Pt,Cn,J,le,Ie,!1,Je.lineMetrics);else if(pt==="MultiLineString")wr(Pt,Cn,J,le,Ie,!1);else if(pt==="Polygon")wr(Pt,Cn,J,le,Ie,!0);else if(pt==="MultiPolygon")for(const Qn of Pt){const Nn=[];wr(Qn,Nn,J,le,Ie,!0),Nn.length&&Cn.push(Nn)}if(Cn.length){if(Je.lineMetrics&&pt==="LineString"){for(const Qn of Cn)Fe.push(Qs(Xe.id,pt,Qn,Xe.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(Cn.length===1?(pt="LineString",Cn=Cn[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=Cn.length===3?"Point":"MultiPoint"),Fe.push(Qs(Xe.id,pt,Cn,Xe.tags))}}return Fe.length?Fe:null}function ai(Ge,Y,J,le,Ie){for(let he=0;he<Ge.length;he+=3){const Me=Ge[he+Ie];Me>=J&&Me<=le&&Ur(Y,Ge[he],Ge[he+1],Ge[he+2])}}function vi(Ge,Y,J,le,Ie,he,Me){let Je=er(Ge);const Fe=Ie===0?fs:Ds;let Xe,Pt,pt=Ge.start;for(let Nn=0;Nn<Ge.length-3;Nn+=3){const Jn=Ge[Nn],Ui=Ge[Nn+1],ni=Ge[Nn+2],br=Ge[Nn+3],Tr=Ge[Nn+4],jr=Ie===0?Jn:Ui,gi=Ie===0?br:Tr;let ci=!1;Me&&(Xe=Math.sqrt(Math.pow(Jn-br,2)+Math.pow(Ui-Tr,2))),jr<J?gi>J&&(Pt=Fe(Je,Jn,Ui,br,Tr,J),Me&&(Je.start=pt+Xe*Pt)):jr>le?gi<le&&(Pt=Fe(Je,Jn,Ui,br,Tr,le),Me&&(Je.start=pt+Xe*Pt)):Ur(Je,Jn,Ui,ni),gi<J&&jr>=J&&(Pt=Fe(Je,Jn,Ui,br,Tr,J),ci=!0),gi>le&&jr<=le&&(Pt=Fe(Je,Jn,Ui,br,Tr,le),ci=!0),!he&&ci&&(Me&&(Je.end=pt+Xe*Pt),Y.push(Je),Je=er(Ge)),Me&&(pt+=Xe)}let sn=Ge.length-3;const _n=Ge[sn],Cn=Ge[sn+1],Qn=Ie===0?_n:Cn;Qn>=J&&Qn<=le&&Ur(Je,_n,Cn,Ge[sn+2]),sn=Je.length-3,he&&sn>=3&&(Je[sn]!==Je[0]||Je[sn+1]!==Je[1])&&Ur(Je,Je[0],Je[1],Je[2]),Je.length&&Y.push(Je)}function er(Ge){const Y=[];return Y.size=Ge.size,Y.start=Ge.start,Y.end=Ge.end,Y}function wr(Ge,Y,J,le,Ie,he){for(const Me of Ge)vi(Me,Y,J,le,Ie,he,!1)}function Ur(Ge,Y,J,le){Ge.push(Y,J,le)}function fs(Ge,Y,J,le,Ie,he){const Me=(he-Y)/(le-Y);return Ur(Ge,he,J+(Ie-J)*Me,1),Me}function Ds(Ge,Y,J,le,Ie,he){const Me=(he-J)/(Ie-J);return Ur(Ge,Y+(le-Y)*Me,he,1),Me}function qs(Ge,Y){const J=[];for(let le=0;le<Ge.length;le++){const Ie=Ge[le],he=Ie.type;let Me;if(he==="Point"||he==="MultiPoint"||he==="LineString")Me=ss(Ie.geometry,Y);else if(he==="MultiLineString"||he==="Polygon"){Me=[];for(const Je of Ie.geometry)Me.push(ss(Je,Y))}else if(he==="MultiPolygon"){Me=[];for(const Je of Ie.geometry){const Fe=[];for(const Xe of Je)Fe.push(ss(Xe,Y));Me.push(Fe)}}J.push(Qs(Ie.id,he,Me,Ie.tags))}return J}function ss(Ge,Y){const J=[];J.size=Ge.size,Ge.start!==void 0&&(J.start=Ge.start,J.end=Ge.end);for(let le=0;le<Ge.length;le+=3)J.push(Ge[le]+Y,Ge[le+1],Ge[le+2]);return J}function Js(Ge,Y){if(Ge.transformed)return Ge;const J=1<<Ge.z,le=Ge.x,Ie=Ge.y;for(const he of Ge.features){const Me=he.geometry,Je=he.type;if(he.geometry=[],Je===1)for(let Fe=0;Fe<Me.length;Fe+=2)he.geometry.push(mi(Me[Fe],Me[Fe+1],Y,J,le,Ie));else for(let Fe=0;Fe<Me.length;Fe++){const Xe=[];for(let Pt=0;Pt<Me[Fe].length;Pt+=2)Xe.push(mi(Me[Fe][Pt],Me[Fe][Pt+1],Y,J,le,Ie));he.geometry.push(Xe)}}return Ge.transformed=!0,Ge}function mi(Ge,Y,J,le,Ie,he){return[Math.round(J*(Ge*le-Ie)),Math.round(J*(Y*le-he))]}function Ll(Ge,Y,J,le,Ie){const he=Y===Ie.maxZoom?0:Ie.tolerance/((1<<Y)*Ie.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:Ge.length,source:null,x:J,y:le,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Je of Ge)vo(Me,Je,he,Ie);return Me}function vo(Ge,Y,J,le){const Ie=Y.geometry,he=Y.type,Me=[];if(Ge.minX=Math.min(Ge.minX,Y.minX),Ge.minY=Math.min(Ge.minY,Y.minY),Ge.maxX=Math.max(Ge.maxX,Y.maxX),Ge.maxY=Math.max(Ge.maxY,Y.maxY),he==="Point"||he==="MultiPoint")for(let Je=0;Je<Ie.length;Je+=3)Me.push(Ie[Je],Ie[Je+1]),Ge.numPoints++,Ge.numSimplified++;else if(he==="LineString")Bs(Me,Ie,Ge,J,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let Je=0;Je<Ie.length;Je++)Bs(Me,Ie[Je],Ge,J,he==="Polygon",Je===0);else if(he==="MultiPolygon")for(let Je=0;Je<Ie.length;Je++){const Fe=Ie[Je];for(let Xe=0;Xe<Fe.length;Xe++)Bs(Me,Fe[Xe],Ge,J,!0,Xe===0)}if(Me.length){let Je=Y.tags||null;if(he==="LineString"&&le.lineMetrics){Je={};for(const Xe in Y.tags)Je[Xe]=Y.tags[Xe];Je.mapbox_clip_start=Ie.start/Ie.size,Je.mapbox_clip_end=Ie.end/Ie.size}const Fe={geometry:Me,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:Je};Y.id!==null&&(Fe.id=Y.id),Ge.features.push(Fe)}}function Bs(Ge,Y,J,le,Ie,he){const Me=le*le;if(le>0&&Y.size<(Ie?Me:le))return void(J.numPoints+=Y.length/3);const Je=[];for(let Fe=0;Fe<Y.length;Fe+=3)(le===0||Y[Fe+2]>Me)&&(J.numSimplified++,Je.push(Y[Fe],Y[Fe+1])),J.numPoints++;Ie&&function(Fe,Xe){let Pt=0;for(let pt=0,sn=Fe.length,_n=sn-2;pt<sn;_n=pt,pt+=2)Pt+=(Fe[pt]-Fe[_n])*(Fe[pt+1]+Fe[_n+1]);if(Pt>0===Xe)for(let pt=0,sn=Fe.length;pt<sn/2;pt+=2){const _n=Fe[pt],Cn=Fe[pt+1];Fe[pt]=Fe[sn-2-pt],Fe[pt+1]=Fe[sn-1-pt],Fe[sn-2-pt]=_n,Fe[sn-1-pt]=Cn}}(Je,he),Ge.push(Je)}const dl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ol{constructor(Y,J){const le=(J=this.options=function(he,Me){for(const Je in Me)he[Je]=Me[Je];return he}(Object.create(dl),J)).debug;if(le&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ie=function(he,Me){const Je=[];if(he.type==="FeatureCollection")for(let Fe=0;Fe<he.features.length;Fe++)Es(Je,he.features[Fe],Me,Fe);else Es(Je,he.type==="Feature"?he:{geometry:he},Me);return Je}(Y,J);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(he,Me){const Je=Me.buffer/Me.extent;let Fe=he;const Xe=Qt(he,1,-1-Je,Je,0,-1,2,Me),Pt=Qt(he,1,1-Je,2+Je,0,-1,2,Me);return(Xe||Pt)&&(Fe=Qt(he,1,-Je,1+Je,0,-1,2,Me)||[],Xe&&(Fe=qs(Xe,1).concat(Fe)),Pt&&(Fe=Fe.concat(qs(Pt,-1)))),Fe}(Ie,J),Ie.length&&this.splitTile(Ie,0,0,0),le&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,J,le,Ie,he,Me,Je){const Fe=[Y,J,le,Ie],Xe=this.options,Pt=Xe.debug;for(;Fe.length;){Ie=Fe.pop(),le=Fe.pop(),J=Fe.pop(),Y=Fe.pop();const pt=1<<J,sn=Do(J,le,Ie);let _n=this.tiles[sn];if(!_n&&(Pt>1&&console.time("creation"),_n=this.tiles[sn]=Ll(Y,J,le,Ie,Xe),this.tileCoords.push({z:J,x:le,y:Ie}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,le,Ie,_n.numFeatures,_n.numPoints,_n.numSimplified),console.timeEnd("creation"));const ci=`z${J}`;this.stats[ci]=(this.stats[ci]||0)+1,this.total++}if(_n.source=Y,he==null){if(J===Xe.indexMaxZoom||_n.numPoints<=Xe.indexMaxPoints)continue}else{if(J===Xe.maxZoom||J===he)continue;if(he!=null){const ci=he-J;if(le!==Me>>ci||Ie!==Je>>ci)continue}}if(_n.source=null,Y.length===0)continue;Pt>1&&console.time("clipping");const Cn=.5*Xe.buffer/Xe.extent,Qn=.5-Cn,Nn=.5+Cn,Jn=1+Cn;let Ui=null,ni=null,br=null,Tr=null,jr=Qt(Y,pt,le-Cn,le+Nn,0,_n.minX,_n.maxX,Xe),gi=Qt(Y,pt,le+Qn,le+Jn,0,_n.minX,_n.maxX,Xe);Y=null,jr&&(Ui=Qt(jr,pt,Ie-Cn,Ie+Nn,1,_n.minY,_n.maxY,Xe),ni=Qt(jr,pt,Ie+Qn,Ie+Jn,1,_n.minY,_n.maxY,Xe),jr=null),gi&&(br=Qt(gi,pt,Ie-Cn,Ie+Nn,1,_n.minY,_n.maxY,Xe),Tr=Qt(gi,pt,Ie+Qn,Ie+Jn,1,_n.minY,_n.maxY,Xe),gi=null),Pt>1&&console.timeEnd("clipping"),Fe.push(Ui||[],J+1,2*le,2*Ie),Fe.push(ni||[],J+1,2*le,2*Ie+1),Fe.push(br||[],J+1,2*le+1,2*Ie),Fe.push(Tr||[],J+1,2*le+1,2*Ie+1)}}getTile(Y,J,le){Y=+Y,J=+J,le=+le;const Ie=this.options,{extent:he,debug:Me}=Ie;if(Y<0||Y>24)return null;const Je=1<<Y,Fe=Do(Y,J=J+Je&Je-1,le);if(this.tiles[Fe])return Js(this.tiles[Fe],he);Me>1&&console.log("drilling down to z%d-%d-%d",Y,J,le);let Xe,Pt=Y,pt=J,sn=le;for(;!Xe&&Pt>0;)Pt--,pt>>=1,sn>>=1,Xe=this.tiles[Do(Pt,pt,sn)];return Xe&&Xe.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",Pt,pt,sn),console.time("drilling down")),this.splitTile(Xe.source,Pt,pt,sn,Y,J,le),Me>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Js(this.tiles[Fe],he):null):null}}function Do(Ge,Y,J){return 32*((1<<Ge)*J+Y)+Ge}function bt(Ge,Y){const J=Ge.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const le=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!le)return void Y(null,null);const Ie=Xe=>Xe.tags&&"3d_elevation_id"in Xe.tags&&"source"in Xe.tags&&Xe.tags.source==="elevation",he=le.features.filter(Xe=>Ie(Xe));let Me={_geojsonTileLayer:le.features};he.length>0&&(Me={_geojsonTileLayer:le.features.filter(Xe=>!Ie(Xe)),hd_road_elevation:he});const Je=new Pe(Me),Fe=function(Xe){const Pt=new o.bq;for(const pt of Object.keys(Xe))Pt.writeMessage(3,vn,{name:pt,features:Xe[pt]});return Pt.finish()}(Me).buffer;Y(null,{vectorTile:Je,rawData:Fe})}class Lo extends Ue{constructor(Y,J,le,Ie,he,Me,Je){super(Y,J,le,Ie,he,bt,Je),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new Ve}loadData(Y,J){const le=Y&&Y.request,Ie=le&&le.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Y,(he,Me)=>{if(he||!Me)return J(he);if(typeof Me!="object")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Fe=o.X(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Fe.result==="error")throw new Error(Fe.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));Me.features=Me.features.filter(Xe=>Fe.value.evaluate({zoom:0},Xe))}Y.dynamic?(Me.type==="Feature"&&(Me={type:"FeatureCollection",features:[Me]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Me.features,this.loaded),Y.cluster&&(Me.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new $s(function({superclusterOptions:Fe,clusterProperties:Xe}){if(!Xe||!Fe)return Fe;const Pt={},pt={},sn={accumulated:null,zoom:0},_n={properties:null},Cn=Object.keys(Xe);for(const Qn of Cn){const[Nn,Jn]=Xe[Qn],Ui=o.X(Jn),ni=o.X(typeof Nn=="string"?[Nn,["accumulated"],["get",Qn]]:Nn);Pt[Qn]=Ui.value,pt[Qn]=ni.value}return Fe.map=Qn=>{_n.properties=Qn;const Nn={};for(const Jn of Cn)Nn[Jn]=Pt[Jn].evaluate(sn,_n);return Nn},Fe.reduce=(Qn,Nn)=>{_n.properties=Nn;for(const Jn of Cn)sn.accumulated=Qn[Jn],Qn[Jn]=pt[Jn].evaluate(sn,_n)},Fe}(Y)).load(Me.features):Y.dynamic?this._dynamicIndex:function(Fe,Xe){return new Ol(Fe,Xe)}(Me,Y.geojsonVtOptions)}catch(Fe){return J(Fe)}const Je={};if(Ie){const Fe=S(le);Fe&&(Je.resourceTiming={},Je.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Fe)))}J(null,Je)}})}reloadTile(Y,J){const le=this.loaded;return le&&le[Y.uid]?Y.partial?J(null,void 0):super.reloadTile(Y,J):this.loadTile(Y,J)}loadGeoJSON(Y,J){if(Y.request)o.n(Y.request,J);else{if(typeof Y.data!="string")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return J(null,JSON.parse(Y.data))}catch{return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Y,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(le){J(le)}}getClusterChildren(Y,J){try{J(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(le){J(le)}}getClusterLeaves(Y,J){try{J(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(le){J(le)}}}class zc{constructor(Y,J,le){this.tileID=new o.aM(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=J,this.worldview=le}parse(Y,J,le,Ie){this.status="parsing";const he=new o.aM(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),Me=[],Je=J.familiesBySource[le.source],Fe=new o.fc(he,le.promoteId);Fe.bucketLayerIDs=[],Fe.is3DTile=!0,o.fr(Y).then(Xe=>{if(!Xe)return Ie(new Error("Could not parse tile"));const Pt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,pt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),sn=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const _n in Je)for(const Cn of Je[_n]){const Qn=Cn[0];Fe.bucketLayerIDs.push(Cn.map(Ui=>o.C(Ui.id,Ui.scope))),Qn.recalculate(sn,[]);const Nn=o.fs(Xe,1/o.d4(le.tileID.canonical)),Jn=new o.ft(Cn,Nn,he,Pt,pt,this.brightness,Fe,this.worldview);Pt||(Jn.needsUpload=!0),Me.push(Jn),Jn.evaluate(Qn)}this.status="done",Ie(null,{buckets:Me,featureIndex:Fe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xe=>Ie(new Error(Xe.message)))}}class Ia{constructor(Y,J,le,Ie,he,Me,Je,Fe){this.actor=Y,this.layerIndex=J,this.availableImages=le,this.availableModels=Ie,this.brightness=Je,this.loading={},this.loaded={},this.worldview=Fe}loadTile(Y,J){const le=Y.uid,Ie=this.loading[le]=new zc(Y,this.brightness,this.worldview);o.br(Y.request,(he,Me)=>{const Je=!this.loading[le];return delete this.loading[le],Je||he?(Ie.status="done",Je||(this.loaded[le]=Ie),J(he)):Me&&Me.byteLength!==0?void Ie.parse(Me,this.layerIndex,Y,(Fe,Xe)=>{Ie.status="done",this.loaded=this.loaded||{},this.loaded[le]=Ie,Fe||!Xe?J(Fe):J(null,Xe)}):(Ie.status="done",this.loaded[le]=Ie,J())})}reloadTile(Y,J){const le=this.loaded,Ie=Y.uid;if(le&&le[Ie]){const he=le[Ie];he.projection=Y.projection,he.brightness=Y.brightness;const Me=(Je,Fe)=>{he.reloadCallback&&(delete he.reloadCallback,this.loadTile(Y,J)),J(Je,Fe)};he.status==="parsing"?he.reloadCallback=Me:he.status==="done"&&this.loadTile(Y,J)}}abortTile(Y,J){const le=Y.uid;this.loading[le]&&delete this.loading[le],J()}removeTile(Y,J){const le=this.loaded,Ie=Y.uid;le&&le[Ie]&&delete le[Ie],J()}}class fi{constructor(Y){this.self=Y,this.actor=new o.fv(Y,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cj({name:"mercator"}),this.workerSourceTypes={vector:Ue,geojson:Lo,"raster-dem":de,"raster-array":Re,"batched-model":Ia},this.workerSources={},this.self.registerWorkerSource=(J,le)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=le},this.self.registerRTLTextPlugin=J=>{if(o.fw.isParsed())throw new Error("RTL text plugin already registered.");o.fw.setState({pluginStatus:o.fx.parsed,pluginURL:o.fw.getPluginURL()}),o.fw.applyArabicShaping=J.applyArabicShaping,o.fw.processBidirectionalText=J.processBidirectionalText,o.fw.processStyledBidirectionalText=J.processStyledBidirectionalText;for(const le of this.rtlPluginParsingListeners)le(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Y,J,le){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.availableModels[Y],delete this.workerSources[Y],le()}checkIfReady(Y,J,le){le()}setReferrer(Y,J){this.referrer=J}spriteLoaded(Y,J){this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={});const{scope:le,isLoaded:Ie}=J;if(this.isSpriteLoaded[Y][le]=Ie,this.workerSources[Y]&&this.workerSources[Y][le])for(const he in this.workerSources[Y][le]){const Me=this.workerSources[Y][le][he];for(const Je in Me){const Fe=Me[Je];Fe instanceof Ue&&(Fe.isSpriteLoaded=Ie,Fe.fire(new o.A("isSpriteLoaded")))}}}setImages(Y,J,le){this.availableImages[Y]||(this.availableImages[Y]={});const{scope:Ie,images:he}=J;if(this.availableImages[Y][Ie]=he,this.workerSources[Y]&&this.workerSources[Y][Ie]){for(const Me in this.workerSources[Y][Ie]){const Je=this.workerSources[Y][Ie][Me];for(const Fe in Je)Je[Fe].availableImages=he}le()}else le()}setModels(Y,{scope:J,models:le},Ie){if(this.availableModels[Y]||(this.availableModels[Y]={}),this.availableModels[Y][J]=le,this.workerSources[Y]&&this.workerSources[Y][J]){for(const he in this.workerSources[Y][J]){const Me=this.workerSources[Y][J][he];for(const Je in Me)Me[Je].availableModels=le}Ie()}else Ie()}setProjection(Y,J){this.projections[Y]=o.cj(J)}setBrightness(Y,J,le){this.brightness=J,le()}setWorldview(Y,J,le){this.worldview=J,le()}setLayers(Y,J,le){this.getLayerIndex(Y,J.scope).replace(J.layers,J.options),le()}updateLayers(Y,J,le){this.getLayerIndex(Y,J.scope).update(J.layers,J.removedIds,J.options),le()}loadTile(Y,J,le){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).loadTile(J,le)}decodeRasterArray(Y,J,le){this.getWorkerSource(Y,J.type,J.source,J.scope).decodeRasterArray(J,le)}reloadTile(Y,J,le){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).reloadTile(J,le)}abortTile(Y,J,le){this.getWorkerSource(Y,J.type,J.source,J.scope).abortTile(J,le)}removeTile(Y,J,le){this.getWorkerSource(Y,J.type,J.source,J.scope).removeTile(J,le)}removeSource(Y,J,le){if(!(this.workerSources[Y]&&this.workerSources[Y][J.scope]&&this.workerSources[Y][J.scope][J.type]&&this.workerSources[Y][J.scope][J.type][J.source]))return;const Ie=this.workerSources[Y][J.scope][J.type][J.source];delete this.workerSources[Y][J.scope][J.type][J.source],Ie.removeSource!==void 0?Ie.removeSource(J,le):le()}loadWorkerSource(Y,J,le){try{this.self.importScripts(J.url),le()}catch(Ie){le(Ie.toString())}}syncRTLPluginState(Y,J,le){if(o.fw.isParsed())le(null,!0);else if(o.fw.isParsing())this.rtlPluginParsingListeners.push(le);else try{o.fw.setState(J);const Ie=o.fw.getPluginURL();!o.fw.isLoaded()||o.fw.isParsed()||o.fw.isParsing()||Ie==null||(o.fw.setState({pluginStatus:o.fx.parsing,pluginURL:o.fw.getPluginURL()}),this.self.importScripts(Ie),o.fw.isParsed()?le(null,!0):this.rtlPluginParsingListeners.push(le))}catch(Ie){le(Ie.toString())}}setDracoUrl(Y,J){this.dracoUrl=J}getAvailableImages(Y,J){this.availableImages[Y]||(this.availableImages[Y]={});let le=this.availableImages[Y][J];return le||(le=[]),le}getAvailableModels(Y,J){this.availableModels[Y]||(this.availableModels[Y]={});let le=this.availableModels[Y][J];return le||(le={}),le}getLayerIndex(Y,J){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let le=this.layerIndexes[Y][J];return le||(le=this.layerIndexes[Y][J]=new V,le.scope=J),le}getWorkerSource(Y,J,le,Ie){const he=this.workerSources;return he[Y]||(he[Y]={}),he[Y][Ie]||(he[Y][Ie]={}),he[Y][Ie][J]||(he[Y][Ie][J]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),he[Y][Ie][J][le]||(he[Y][Ie][J][le]=new this.workerSourceTypes[J]({send:(Me,Je,Fe,Xe,Pt,pt)=>this.actor.send(Me,Je,Fe,Y,Pt,pt),scheduler:this.actor.scheduler},this.getLayerIndex(Y,Ie),this.getAvailableImages(Y,Ie),this.getAvailableModels(Y,Ie),this.isSpriteLoaded[Y][Ie],void 0,this.brightness,this.worldview)),he[Y][Ie][J][le]}rasterizeImagesWorker(Y,J,le){const Ie=new Map;for(const[he,{image:Me,imageVariant:Je}]of J.tasks.entries()){const Fe=this.imageRasterizer.rasterize(Je,Me,J.scope,Y);Ie.set(he,Fe)}le(void 0,Ie)}removeRasterizedImages(Y,J,le){this.imageRasterizer.removeImagesFromCacheByIds(J.imageIds,J.scope,Y),le()}enforceCacheSizeLimit(Y,J){o.fy(J)}getWorkerPerformanceMetrics(Y,J,le){le(void 0,void 0)}}return o.fu(self)&&(self.worker=new fi(self)),fi}),m(["./shared"],function(o){var S="3.14.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(f){performance.mark(f)},measure(f,r,c){performance.measure(f,r,c)}};function V(f){const r=f.name.split("?")[0];return o.a(r)&&r.includes("mapbox-gl.js")?"javascript":o.a(r)&&r.includes("mapbox-gl.css")?"css":o.b(r)?"fontRange":o.c(r)?"sprite":o.i(r)?"style":o.d(r)?"tilejson":"other"}var j,Q={},oe=function(){if(j)return Q;function f(p){return!r(p)}function r(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,b,I=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(I);try{b=new Worker(A),x=!0}catch{x=!1}return b&&b.terminate(),URL.revokeObjectURL(A),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var b=x.getContext("2d");if(!b)return!1;var I=b.getImageData(0,0,1,1);return I&&I.width===x.width}()?(c[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[y]=function(x){var b,I=function(A){var D=document.createElement("canvas"),L=Object.create(f.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=A,D.getContext("webgl2",L)}(x);if(!I)return!1;try{b=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!b||I.isContextLost())&&(I.shaderSource(b,"void main() {}"),I.compileShader(b),I.getShaderParameter(b,I.COMPILE_STATUS)===!0)}(y)),c[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}j=1,Q.supported=f,Q.notSupportedReason=r;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Q}();function me(f,r,c){const p=document.createElement(f);return r!=null&&(p.className=r),c&&c.appendChild(p),p}function Ue(f,r,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(r))p.setAttributeNS(null,y,String(r[y]));return c&&c.appendChild(p),p}const de=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ge=de&&de.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Re;function _t(){de&&ge&&(Re=de[ge],de[ge]="none")}function ct(){de&&ge&&(de[ge]=Re)}function nt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",nt,!0)}function Pe(){window.addEventListener("click",nt,!0),window.setTimeout(()=>{window.removeEventListener("click",nt,!0)},0)}function xe(f,r){const c=f.getBoundingClientRect();return De(f,c,r)}function ke(f,r){const c=f.getBoundingClientRect(),p=[];for(let y=0;y<r.length;y++)p.push(De(f,c,r[y]));return p}function Ve(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function De(f,r,c){const p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new o.P((c.clientX-r.left)*p,(c.clientY-r.top)*p)}const Qe="01",Be="NO_ACCESS_TOKEN";class Hn{constructor(r,c,p){this._transformRequestFn=r,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const r=function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qe,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,c){return this._transformRequestFn&&this._transformRequestFn(r,c)||{url:r}}normalizeStyleURL(r,c){if(!o.j(r))return r;const p=ii(r);return p.params.push(`sdk=js-${S}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(r,c){if(!o.j(r))return r;const p=ii(r);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(r,c){if(!o.j(r))return r;const p=ii(r);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(r,c,p,y){if(!o.j(r))return r;const x=ii(r);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),p&&x.params.push(`language=${p}`),y&&x.params.push(`worldview=${y}`),this._makeAPIURL(x,this._customAccessToken||c)}normalizeIconsetURL(r,c){const p=ii(r);return o.j(r)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Ii(p)}normalizeSpriteURL(r,c,p,y){const x=ii(r);return o.j(r)?(x.path=`/styles/v1${x.path}/sprite${c}${p}`,this._makeAPIURL(x,this._customAccessToken||y)):(x.path+=`${c}${p}`,Ii(x))}normalizeTileURL(r,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!o.j(r))return r;const y=ii(r);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&y.authority!=="raster"&&p===512?"@2x":""}${o.l.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${o.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${o.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${o.e.TILE_URL_VERSION}${y.path}`);const x=this._customAccessToken||function(b){for(const I of b){const A=I.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(y.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,x)}canonicalizeTileURL(r,c){const p=ii(r);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return r;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let x=p.params;return c&&(x=x.filter(b=>!b.match(/^access_token=/))),x.length&&(y+=`?${x.join("&")}`),y}canonicalizeTileset(r,c){const p=!!c&&o.j(c),y=[];for(const x of r.tiles||[])o.k(x)?y.push(this.canonicalizeTileURL(x,p)):y.push(x);return y}_makeAPIURL(r,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=ii(o.e.API_URL);if(r.protocol=y.protocol,r.authority=y.authority,r.protocol==="http"){const x=r.params.indexOf("secure");x>=0&&r.params.splice(x,1)}if(y.path!=="/"&&(r.path=`${y.path}${r.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Ii(r);if(c=c||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return r.params=r.params.filter(x=>x.indexOf("access_token")===-1),r.params.push(`access_token=${c||""}`),Ii(r)}}const Ln=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ii(f){const r=f.match(Ln);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Ii(f){const r=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${r}`}const vn="mapbox.eventData";function Vn(f){if(!f)return null;const r=f.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(o.m(r[1]))}catch{return null}}class je{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const c=Vn(o.e.ACCESS_TOKEN);let p="";return p=c&&c.u?o.f(c.u):o.e.ACCESS_TOKEN||"",r?`${vn}.${r}:${p}`:`${vn}:${p}`}fetchEventData(){const r=o.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid");if(r)try{const y=localStorage.getItem(c);y&&(this.eventData=JSON.parse(y));const x=localStorage.getItem(p);x&&(this.anonId=x)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const r=o.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.anonId;if(r&&y)try{localStorage.setItem(p,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,c,p,y){if(!o.e.EVENTS_URL)return;const x=ii(o.e.EVENTS_URL);x.params.push(`access_token=${y||o.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(r).toISOString()},I=c?o.h(b,c):b,A={url:Ii(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=o.p(A,D=>{this.pendingRequest=null,p(D),this.saveEventData(),this.processRequests(y)})}queueRequest(r,c){this.queue.push(r),this.processRequests(c)}}const Pn=new class extends je{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,r){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>o.j(c)||o.k(c))&&this.queueRequest(Date.now(),r)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Vn(o.e.ACCESS_TOKEN),c=r?r.u:o.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),b=new Date(y),I=(y-this.eventData.lastSuccess)/864e5;p=p||I>=1||I<-1||x.getDate()!==b.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Qe,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=y,this.eventData.tokenU=c)},f):this.processRequests()}},oi=Pn.postTurnstileEvent.bind(Pn),et=new class extends je{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,r,c,p){this.skuToken=r,this.errorCb=p,o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Be)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:S,skuId:Qe,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f))}remove(){this.errorCb=null}},Xr=et.postMapLoadEvent.bind(et),Kr=new class extends je{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let r=this.mapInstanceIdMap.get(f);return r||(r=o.u(),this.mapInstanceIdMap.set(f,r)),r}getEventId(f){const r=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,r+1),r}postStyleLoadEvent(f,r){const{map:c,style:p,importedStyles:y}=r;if(!o.e.EVENTS_URL||!f&&!o.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(c),b={mapInstanceId:x,eventId:this.getEventId(x),style:p};y.length&&(b.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:b},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:c}=this.queue.shift();this.postEvent(r,c,()=>{},f)}},qn=Kr.postStyleLoadEvent.bind(Kr),zi=new class extends je{constructor(){super("gljs.performance")}postPerformanceEvent(f,r){o.e.EVENTS_URL&&(f||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:c}=this.queue.shift(),p=function(y){const x=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),I=function(U){const q={};if(U){for(const $ in U)if($!=="other")for(const X of U[$]){const Z=`${$}ResolveRangeMin`,te=`${$}ResolveRangeMax`,re=`${$}RequestCount`,ae=`${$}RequestCachedCount`;q[Z]=Math.min(q[Z]||1/0,X.startTime),q[te]=Math.max(q[te]||-1/0,X.responseEnd);const fe=be=>{q[be]===void 0&&(q[be]=0),++q[be]};X.transferSize!==void 0&&X.transferSize===0&&fe(ae),fe(re)}}return q}(function(U,q){const $={};if(U)for(const X of U){const Z=q(X);$[Z]===void 0&&($[Z]=[]),$[Z].push(X)}return $}(x,V)),A=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=D?D.effectiveType:void 0,B={counters:[],metadata:[],attributes:[]},O=(U,q,$)=>{$!=null&&U.push({name:q,value:$.toString()})};for(const U in I)O(B.counters,U,I[U]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(O(B.counters,"interactionRangeMin",y.interactionRange[0]),O(B.counters,"interactionRangeMax",y.interactionRange[1])),b)for(const U of Object.keys(P)){const q=P[U],$=b.find(X=>X.name===q);$&&O(B.counters,q,$.startTime)}return O(B.counters,"visibilityHidden",y.visibilityHidden),O(B.attributes,"style",function(U){if(U)for(const q of U){const $=q.name.split("?")[0];if(o.i($)){const X=$.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(x)),O(B.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),O(B.attributes,"fogEnabled",y.fogEnabled?"true":"false"),O(B.attributes,"projection",y.projection),O(B.attributes,"zoom",y.zoom),O(B.metadata,"devicePixelRatio",A),O(B.metadata,"connectionEffectiveType",L),O(B.metadata,"navigatorUserAgent",navigator.userAgent),O(B.metadata,"screenWidth",window.screen.width),O(B.metadata,"screenHeight",window.screen.height),O(B.metadata,"windowWidth",window.innerWidth),O(B.metadata,"windowHeight",window.innerHeight),O(B.metadata,"mapWidth",y.width/A),O(B.metadata,"mapHeight",y.height/A),O(B.metadata,"webglRenderer",y.renderer),O(B.metadata,"webglVendor",y.vendor),O(B.metadata,"sdkVersion",S),O(B.metadata,"sdkIdentifier","mapbox-gl-js"),B}(c);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(r,p,()=>{},f)}},ar=zi.postPerformanceEvent.bind(zi),rs=new class extends je{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,r,c,p){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const y=ii(o.e.API_URL+o.e.SESSION_PATH);y.params.push(`sku=${r||""}`),y.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);const x={url:Ii(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(x,b=>{this.pendingRequest=null,c(b),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,r,c,p){this.skuToken=r,this.errorCb=p,o.e.SESSION_PATH&&o.e.API_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Be)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f)}remove(){this.errorCb=null}},Wi=rs.getSessionAPI.bind(rs),$s=new Set;function Po(f,r){r?$s.add(f):$s.delete(f)}class Ea{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,c){this._updatedSourceCaches[r]=c,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const c=r.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(r.id),this.setDirty()}removeLayer(r){const c=r.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][r.id]=r,this._updatedLayers[c].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const c in this._updatedLayers)r[c]=r[c]||{},r[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)r[c]=r[c]||{},r[c].removedIds=Object.keys(this._removedLayers[c]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(o.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Hs(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class Vi extends o.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new o.r({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const c=this.atlasTexture.get(r);c&&(c.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(r.id,r)}removeImageProvider(r,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(r)}getPendingImageProviders(){const r=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&r.push(p);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,c){if(this.loaded.get(c)!==r&&(this.loaded.set(c,r),r)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,c,y);this.requestors=[]}}hasImage(r,c){return!!this.getImage(r,c)}getImage(r,c){return this.images.get(c).get(r.toString())}addImage(r,c,p){this._validate(r,p)&&this.images.get(c).set(r.toString(),p)}_validate(r,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "content" value`))),p=!1),p}_validateStretch(r,c){if(!r)return!0;let p=0;for(const y of r){if(y[0]<p||y[1]<y[0]||c<y[1])return!1;p=y[1]}return!0}_validateContent(r,c){return r?r.length!==4||!c.usvg&&(r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,c,p){const y=this.images.get(c).get(r.toString());p.version=y.version+1,this.images.get(c).set(r.toString(),p),this.updatedImages.get(c).add(r),this.removeFromImageRasterizerCache(r,c)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,c){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([r],c))}removeImage(r,c){const p=this.images.get(c),y=p.get(r.toString());p.delete(r.toString()),this.patterns.get(c).delete(r.toString()),this.removeFromImageRasterizerCache(r,c),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(c=>o.I.from(c))}getImages(r,c,p){const y=[],x=[],b=this.imageProviders.get(c);for(const L of r){if(!L.iconsetId){y.push(L);continue}const B=b.get(L.iconsetId);B&&(this.getImage(L,c)?x.push(L):B.addPendingRequest(L))}if(y.length===0)return void this._notify(x,c,p);let I=!0;const A=!!this.loaded.get(c),D=this.images.get(c);if(!A)for(const L of y)D.has(L.toString())||(I=!1);A||I?this._notify(y,c,p):this.requestors.push({ids:y,scope:c,callback:p})}rasterizeImages(r,c){const p=new Map,{tasks:y,scope:x}=r;for(const[b,I]of y.entries()){const A=this.getImage(I.id,x);A&&p.set(b,{image:A,imageVariant:I})}this._rasterizeImages(x,p,c)}_rasterizeImages(r,c,p){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:r},p);else{const y=new Map;for(const[x,{image:b,imageVariant:I}]of c.entries())y.set(x,this.imageRasterizer.rasterize(I,b,r,0));p(void 0,y)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,c,p){const y=this.images.get(c),x=new Map;for(const b of r){if(!y.get(b.toString())){if(b.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:b.name}))}const I=y.get(b.toString());if(!I){o.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(A,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),x.set(o.I.toString(b),A)}p(null,x)}getPixelSize(r){const{width:c,height:p}=this.atlasImage.get(r);return{width:c,height:p}}getPattern(r,c,p){const y=r.toString(),x=this.patterns.get(c),b=x.get(y),I=this.getImage(r,c);if(!I)return null;if(b){if(b.position.version===I.version)return b.position;b.position.version=I.version}else{if(I.usvg&&!I.data){const A=this.getPatternInFlightId(y,c);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const D=new o.B(r).scaleSelf(o.q.devicePixelRatio),L=new Map([[D.toString(),{image:I,imageVariant:D}]]);return this._rasterizeImages(c,L,(B,O)=>this.storePatternImage(D,c,I,p,O)),null}this.storePattern(r,c,I)}return this._updatePatternAtlas(c,p),x.get(y).position}getPatternInFlightId(r,c){return o.C(r,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,c,p,y,x){const b=r.toString(),I=x?x.get(b):void 0;I&&(p.data=I,this.storePattern(r.id,c,p),this._updatePatternAtlas(c,y),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),c)))}storePattern(r,c,p){const y={w:p.data.width+2*o.F,h:p.data.height+2*o.F,x:0,y:0},x=new o.G(y,p,o.F);this.patterns.get(c).set(r.toString(),{bin:y,position:x})}destroyAtlasTextures(){for(const r of this.atlasTexture.values())r&&r.destroy();this.atlasTexture.clear()}bind(r,c){const p=r.gl;let y=this.atlasTexture.get(c);y?this.dirty&&(y.update(this.atlasImage.get(c)),this.dirty=!1):(y=new o.T(r,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,y)),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(r,c){const p=this.patterns.get(r),y=Array.from(p.values()).map(({bin:D})=>D),{w:x,h:b}=o.H(y),I=this.atlasImage.get(r);I.resize({width:x||1,height:b||1});const A=this.images.get(r);for(const[D,{bin:L,position:B}]of p.entries()){let O=B.padding;const U=L.x+O,q=L.y+O,$=A.get(D).data,X=$.width,Z=$.height;O=O>1?O-1:O,o.r.copy($,I,{x:0,y:0},{x:U,y:q},{width:X,height:Z},c),o.r.copy($,I,{x:0,y:Z-O},{x:U,y:q-O},{width:X,height:O},c),o.r.copy($,I,{x:0,y:0},{x:U,y:q+Z},{width:X,height:O},c),o.r.copy($,I,{x:X-O,y:0},{x:U-O,y:q},{width:O,height:Z},c),o.r.copy($,I,{x:0,y:0},{x:U+X,y:q},{width:O,height:Z},c),o.r.copy($,I,{x:X-O,y:Z-O},{x:U-O,y:q-O},{width:O,height:O},c),o.r.copy($,I,{x:0,y:Z-O},{x:U+X,y:q-O},{width:O,height:O},c),o.r.copy($,I,{x:0,y:0},{x:U+X,y:q+Z},{width:O,height:O},c),o.r.copy($,I,{x:X-O,y:0},{x:U-O,y:q+Z},{width:O,height:O},c)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,c){const p=this.images.get(c);for(const y of r){if(this.callbackDispatchedThisFrame.get(c).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(y.toString());const x=p.get(y.toString());Hs(x)&&this.updateImage(y,c,x)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Ts(f){const r=f.key,c=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},x=f.style,b=f.styleSpec;let I=[];const A=o.J(c);if(A!=="object")return[new o.V(r,c,`object expected, ${A} found`)];for(const D in c){const L=D.split(".")[0];let B;y[L]?B=y[L]:p[L]?B=mi:y["*"]?B=y["*"]:p["*"]&&(B=mi),B?I=I.concat(B({key:(r&&`${r}.`)+D,value:c[D],valueSpec:p[L]||p["*"],style:x,styleSpec:b,object:c,objectKey:D},c)):I.push(new o.K(r,c[D],`unknown property "${D}"`))}for(const D in p)y[D]||p[D].required&&p[D].default===void 0&&c[D]===void 0&&I.push(new o.V(r,c,`missing required property "${D}"`));return I}function Ro(f){const r=f.value,c=f.valueSpec,p=f.style,y=f.styleSpec,x=f.key,b=f.arrayElementValidator||mi;if(o.J(r)!=="array")return[new o.V(x,r,`array expected, ${o.J(r)} found`)];if(c.length&&r.length!==c.length)return[new o.V(x,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new o.V(x,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let I={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};y.$version<7&&(I.function=c.function),o.J(c.value)==="object"&&(I=c.value);let A=[];for(let D=0;D<r.length;D++)A=A.concat(b({array:r,arrayIndex:D,value:r[D],valueSpec:I,style:p,styleSpec:y,key:`${x}[${D}]`},!0));return A}function ia(f){const r=f.key,c=f.value,p=f.valueSpec;let y=o.J(c);if(y==="number"&&c!=c&&(y="NaN"),y!=="number")return[new o.V(r,c,`number expected, ${y} found`)];if("minimum"in p){let x=p.minimum;if(o.J(p.minimum)==="array"&&(x=p.minimum[f.arrayIndex]),c<x)return[new o.V(r,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(o.J(p.maximum)==="array"&&(x=p.maximum[f.arrayIndex]),c>x)return[new o.V(r,c,`${c} is greater than the maximum value ${x}`)]}return[]}function Qs(f){const r=f.valueSpec,c=o.M(f.value.type);let p,y,x,b={};const I=c!=="categorical"&&f.value.property===void 0,A=!I,D=o.J(f.value.stops)==="array"&&o.J(f.value.stops[0])==="array"&&o.J(f.value.stops[0][0])==="object",L=Ts({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(U){if(c==="identity")return[new o.V(U.key,U.value,'identity function may not have a "stops" property')];let q=[];const $=U.value;return q=q.concat(Ro({key:U.key,value:$,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:B})),o.J($)==="array"&&$.length===0&&q.push(new o.V(U.key,$,"array must have at least one stop")),q},default:function(U){return mi({key:U.key,value:U.value,valueSpec:r,style:U.style,styleSpec:U.styleSpec})}}});return c==="identity"&&I&&L.push(new o.V(f.key,f.value,'missing required property "property"')),c==="identity"||f.value.stops||L.push(new o.V(f.key,f.value,'missing required property "stops"')),c==="exponential"&&f.valueSpec.expression&&!o.N(f.valueSpec)&&L.push(new o.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(A&&!o.O(f.valueSpec)?L.push(new o.V(f.key,f.value,"property functions not supported")):I&&!o.Q(f.valueSpec)&&L.push(new o.V(f.key,f.value,"zoom functions not supported"))),c!=="categorical"&&!D||f.value.property!==void 0||L.push(new o.V(f.key,f.value,'"property" property is required')),L;function B(U){let q=[];const $=U.value,X=U.key;if(o.J($)!=="array")return[new o.V(X,$,`array expected, ${o.J($)} found`)];if($.length!==2)return[new o.V(X,$,`array length 2 expected, length ${$.length} found`)];if(D){if(o.J($[0])!=="object")return[new o.V(X,$,`object expected, ${o.J($[0])} found`)];if($[0].zoom===void 0)return[new o.V(X,$,"object stop key must have zoom")];if($[0].value===void 0)return[new o.V(X,$,"object stop key must have value")];const Z=o.M($[0].zoom);if(typeof Z!="number")return[new o.V(X,$[0].zoom,"stop zoom values must be numbers")];if(x&&x>Z)return[new o.V(X,$[0].zoom,"stop zoom values must appear in ascending order")];Z!==x&&(x=Z,y=void 0,b={}),q=q.concat(Ts({key:`${X}[0]`,value:$[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:ia,value:O}}))}else q=q.concat(O({key:`${X}[0]`,value:$[0],style:U.style,styleSpec:U.styleSpec},$));return o.S(o.U($[1]))?q.concat([new o.V(`${X}[1]`,$[1],"expressions are not allowed in function stops.")]):q.concat(mi({key:`${X}[1]`,value:$[1],valueSpec:r,style:U.style,styleSpec:U.styleSpec}))}function O(U,q){const $=o.J(U.value),X=o.M(U.value),Z=U.value!==null?U.value:q;if(p){if($!==p)return[new o.V(U.key,Z,`${$} stop domain type must match previous stop domain type ${p}`)]}else p=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new o.V(U.key,Z,"stop domain value must be a number, string, or boolean")];if($!=="number"&&c!=="categorical"){let te=`number expected, ${$} found`;return o.O(r)&&c===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(U.key,Z,te)]}return c!=="categorical"||$!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?c!=="categorical"&&$==="number"&&typeof X=="number"&&typeof y=="number"&&y!==void 0&&X<y?[new o.V(U.key,Z,"stop domain values must appear in ascending order")]:(y=X,c==="categorical"&&X in b?[new o.V(U.key,Z,"stop domain values must be unique")]:(b[X]=!0,[])):[new o.V(U.key,Z,`integer expected, found ${String(X)}`)]}}function ds(f){const r=(f.expressionContext==="property"?o.W:o.X)(o.U(f.value),f.valueSpec);if(r.result==="error")return r.value.map(p=>new o.V(`${f.key}${p.key}`,f.value,p.message));const c=r.value.expression||r.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new o.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!o.Y(c))return[new o.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Es(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!o.Z(c,["zoom","feature-state"]))return[new o.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!o._(c))return[new o.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Es(f,r){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const y of r.valueSpec.expression.parameters)c.delete(y);if(c.size===0)return[];const p=[];return f instanceof o.$&&c.has(f.name)?[new o.V(r.key,r.value,`["${f.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(f.eachChild(y=>{p.push(...Es(y,r))}),p)}function ko(f){const r=f.key,c=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(o.M(c))===-1&&y.push(new o.V(r,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(o.M(c))===-1&&y.push(new o.V(r,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),y}function io(f){return o.a1(o.U(f.value))?ds(o.L({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Mo(f)}function Mo(f){const r=f.value,c=f.key;if(o.J(r)!=="array")return[new o.V(c,r,`array expected, ${o.J(r)} found`)];const p=f.styleSpec;let y,x=[];if(r.length<1)return[new o.V(c,r,"filter array must have at least 1 element")];switch(x=x.concat(ko({key:`${c}[0]`,value:r[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),o.M(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.M(r[1])==="$type"&&x.push(new o.V(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new o.V(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(y=o.J(r[1]),y!=="string"&&x.push(new o.V(`${c}[1]`,r[1],`string expected, ${y} found`)));for(let b=2;b<r.length;b++)y=o.J(r[b]),o.M(r[1])==="$type"?x=x.concat(ko({key:`${c}[${b}]`,value:r[b],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&x.push(new o.V(`${c}[${b}]`,r[b],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)x=x.concat(Mo({key:`${c}[${b}]`,value:r[b],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":y=o.J(r[1]),r.length!==2?x.push(new o.V(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):y!=="string"&&x.push(new o.V(`${c}[1]`,r[1],`string expected, ${y} found`))}return x}function ra(f,r){const c=f.key,p=f.style,y=f.layer,x=f.styleSpec,b=f.value,I=f.objectKey,A=x[`${r}_${f.layerType}`];if(!A)return[];const D=I.match(/^(.*)-use-theme$/);if(r==="paint"&&D&&A[D[1]])return o.S(b)?[].concat(mi({key:f.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:I})):mi({key:c,value:b,valueSpec:{type:"string"},style:p,styleSpec:x});const L=I.match(/^(.*)-transition$/);if(r==="paint"&&L&&A[L[1]]&&A[L[1]].transition)return mi({key:c,value:b,valueSpec:x.transition,style:p,styleSpec:x});const B=f.valueSpec||A[I];if(!B)return[new o.K(c,b,`unknown property "${I}"`)];let O;if(o.J(b)==="string"&&o.O(B)&&!B.tokens&&(O=/^{([^}]+)}$/.exec(b))){const q=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new o.V(c,b,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const U=[];if(f.layerType==="symbol")I!=="text-field"||!p||p.glyphs||p.imports||U.push(new o.V(c,b,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&o.a2(o.U(b))&&o.M(b.type)==="identity"&&U.push(new o.V(c,b,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&r==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&o.O(B)&&(o.a3(B)||o.Q(B))){const q=o.W(o.U(b),B),$=q.value.expression||q.value._styleExpression.expression;$&&!o.Z($,["measure-light"])&&(I==="model-emissive-strength"&&o._($)&&o.Y($)||U.push(new o.V(c,b,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return U.concat(mi({key:f.key,value:b,valueSpec:B,style:p,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:I}))}function Dt(f){return ra(f,"paint")}function Qt(f){return ra(f,"layout")}function ai(f){let r=[];const c=f.value,p=f.key,y=f.style,x=f.styleSpec;c.type||c.ref||r.push(new o.V(p,c,'either "type" or "ref" is required'));let b=o.M(c.type);const I=o.M(c.ref);if(c.id){const A=o.M(c.id);for(let D=0;D<f.arrayIndex;D++){const L=y.layers[D];o.M(L.id)===A&&r.push(new o.V(p,c.id,`duplicate layer id "${c.id}", previously used at line ${L.id.__line__}`))}}if("ref"in c){let A;["type","source","source-layer","filter","layout"].forEach(D=>{D in c&&r.push(new o.V(p,c[D],`"${D}" is prohibited for ref layers`))}),y.layers.forEach(D=>{o.M(D.id)===I&&(A=D)}),A?A.ref?r.push(new o.V(p,c.ref,"ref cannot reference another ref layer")):b=o.M(A.type):typeof I=="string"&&r.push(new o.V(p,c.ref,`ref layer "${I}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(c.source){const A=y.sources&&y.sources[c.source],D=A&&o.M(A.type);A?D==="vector"&&b==="raster"?r.push(new o.V(p,c.source,`layer "${c.id}" requires a raster source`)):D==="raster"&&b!=="raster"?r.push(new o.V(p,c.source,`layer "${c.id}" requires a vector source`)):D!=="vector"||c["source-layer"]?D==="raster-dem"&&b!=="hillshade"?r.push(new o.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(b)?b==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&D==="geojson"&&!A.lineMetrics?r.push(new o.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):b==="raster-particle"&&D!=="raster-array"&&r.push(new o.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):r.push(new o.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new o.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new o.V(p,c.source,`source "${c.source}" not found`))}else r.push(new o.V(p,c,'missing required property "source"'));return r=r.concat(Ts({key:p,value:c,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>mi({key:`${p}.type`,value:c.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:A=>io(o.L({layerType:b},A)),layout:A=>Ts({layer:c,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":D=>Qt(o.L({layerType:b},D))}}),paint:A=>Ts({layer:c,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":D=>Dt(o.L({layerType:b,layer:c},D))}})}})),r}function vi(f){const r=f.value,c=f.key,p=o.J(r);return p!=="string"?[new o.V(c,r,`string expected, ${p} found`)]:[]}const er={promoteId:function f({key:r,value:c}){if(o.J(c)==="string")return vi({key:r,value:c});if(Array.isArray(c)){const p=[],y=o.U(c),x=o.X(y);return x.result==="error"&&x.value.forEach(b=>{p.push(new o.V(`${r}${b.key}`,null,`${b.message}`))}),o.Z(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new o.V(`${r}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const y in c)p.push(...f({key:`${r}.${y}`,value:c[y]}));return p}}};function wr(f){const r=f.value,c=f.key,p=f.styleSpec,y=f.style;if(!r.type)return[new o.V(c,r,'"type" is required')];const x=o.M(r.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(r.url||r.tiles||b.push(new o.K(c,r,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Ts({key:c,value:r,valueSpec:p[`source_${x.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:er})),b;case"geojson":if(b=Ts({key:c,value:r,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:er}),r.cluster)for(const I in r.clusterProperties){const[A,D]=r.clusterProperties[I],L=typeof A=="string"?[A,["accumulated"],["get",I]]:A;b.push(...ds({key:`${c}.${I}.map`,value:D,expressionContext:"cluster-map"})),b.push(...ds({key:`${c}.${I}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return b;case"video":return Ts({key:c,value:r,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return Ts({key:c,value:r,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new o.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ko({key:`${c}.type`,value:r.type,valueSpec:{values:Ur(p)}})}}function Ur(f){return f.source.reduce((r,c)=>{const p=f[c];return p.type.type==="enum"&&(r=r.concat(Object.keys(p.type.values))),r},[])}function fs(f){const r=f.value,c=f.styleSpec,p=c.light,y=f.style;let x=[];const b=o.J(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new o.V("light",r,`object expected, ${b} found`)]),x;for(const I in r){const A=I.match(/^(.*)-transition$/),D=I.match(/^(.*)-use-theme$/);x=x.concat(D&&p[D[1]]?mi({key:I,value:r[I],valueSpec:{type:"string"},style:y,styleSpec:c}):A&&p[A[1]]&&p[A[1]].transition?mi({key:I,value:r[I],valueSpec:c.transition,style:y,styleSpec:c}):p[I]?mi({key:I,value:r[I],valueSpec:p[I],style:y,styleSpec:c}):[new o.V(I,r[I],`unknown property "${I}"`)])}return x}function Ds(f){const r=f.value;let c=[];if(!r)return c;const p=o.J(r);if(p!=="object")return c=c.concat([new o.V("light-3d",r,`object expected, ${p} found`)]),c;const y=f.styleSpec,x=y["light-3d"],b=f.key,I=f.style,A=f.style.lights;for(const B of["type","id"])if(!(B in r))return c=c.concat([new o.V("light-3d",r,`missing property ${B} on light`)]),c;if(r.type&&A)for(let B=0;B<f.arrayIndex;B++){const O=o.M(r.type),U=A[B];o.M(U.type)===O&&c.push(new o.V(b,r.id,`duplicate light type "${r.type}", previously defined at line ${U.id.__line__}`))}const D=`properties_light_${r.type}`;if(!(D in y))return c=c.concat([new o.V("light-3d",r,`Invalid light type ${r.type}`)]),c;const L=y[D];for(const B in r)if(B==="properties"){const O=r[B],U=o.J(O);if(U!=="object")return c=c.concat([new o.V("properties",O,`object expected, ${U} found`)]),c;for(const q in O){const $=q.match(/^(.*)-transition$/),X=q.match(/^(.*)-use-theme$/);c=c.concat(X&&L[X[1]]?mi({key:B,value:O[q],valueSpec:{type:"string"},style:I,styleSpec:y}):$&&L[$[1]]&&L[$[1]].transition?mi({key:B,value:r[B],valueSpec:y.transition,style:I,styleSpec:y}):L[q]?mi({key:q,value:O[q],valueSpec:L[q],style:I,styleSpec:y}):[new o.K(f.key,O[q],`unknown property "${q}"`)])}}else c=c.concat(x[B]?mi({key:B,value:r[B],valueSpec:x[B],style:I,styleSpec:y}):[new o.K(B,r[B],`unknown property "${B}"`)]);return c}function qs(f){const r=f.value,c=f.key,p=f.style,y=f.styleSpec,x=y.terrain;let b=[];const I=o.J(r);if(r===void 0||I==="null")return b;if(I!=="object")return b=b.concat([new o.V("terrain",r,`object expected, ${I} found`)]),b;for(const A in r){const D=A.match(/^(.*)-transition$/),L=A.match(/^(.*)-use-theme$/);b=b.concat(L&&x[L[1]]?mi({key:A,value:r[A],valueSpec:{type:"string"},style:p,styleSpec:y}):D&&x[D[1]]&&x[D[1]].transition?mi({key:A,value:r[A],valueSpec:y.transition,style:p,styleSpec:y}):x[A]?mi({key:A,value:r[A],valueSpec:x[A],style:p,styleSpec:y}):[new o.K(A,r[A],`unknown property "${A}"`)])}if(r.source){const A=p.sources&&p.sources[r.source],D=A&&o.M(A.type);A?D!=="raster-dem"&&b.push(new o.V(c,r.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):b.push(new o.V(c,r.source,`source "${r.source}" not found`))}else b.push(new o.V(c,r,'terrain is missing required property "source"'));return b}function ss(f){const r=f.value,c=f.style,p=f.styleSpec,y=p.fog;let x=[];const b=o.J(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new o.V("fog",r,`object expected, ${b} found`)]),x;for(const I in r){const A=I.match(/^(.*)-transition$/),D=I.match(/^(.*)-use-theme$/);x=x.concat(D&&y[D[1]]?mi({key:I,value:r[I],valueSpec:{type:"string"},style:c,styleSpec:p}):A&&y[A[1]]&&y[A[1]].transition?mi({key:I,value:r[I],valueSpec:p.transition,style:c,styleSpec:p}):y[I]?mi({key:I,value:r[I],valueSpec:y[I],style:c,styleSpec:p}):[new o.K(I,r[I],`unknown property "${I}"`)])}return x}const Js={"*":()=>[],array:Ro,boolean:function(f){const r=f.value,c=f.key,p=o.J(r);return p!=="boolean"?[new o.V(c,r,`boolean expected, ${p} found`)]:[]},number:ia,color:function(f){const r=f.key,c=f.value,p=o.J(c);return p!=="string"?[new o.V(r,c,`color expected, ${p} found`)]:o.a0.parseCSSColor(c)===null?[new o.V(r,c,`color expected, "${c}" found`)]:[]},enum:ko,filter:io,function:Qs,layer:ai,object:Ts,source:wr,model:o.a4,light:fs,"light-3d":Ds,terrain:qs,fog:ss,string:vi,formatted:function(f){return vi(f).length===0?[]:ds(f)},resolvedImage:function(f){return vi(f).length===0?[]:ds(f)},projection:function(f){const r=f.value,c=f.styleSpec,p=c.projection,y=f.style;let x=[];const b=o.J(r);if(b==="object")for(const I in r)x=x.concat(mi({key:I,value:r[I],valueSpec:p[I],style:y,styleSpec:c}));else b!=="string"&&(x=x.concat([new o.V("projection",r,`object or string expected, ${b} found`)]));return x},import:function(f){const{value:r,styleSpec:c}=f,{data:p,...y}=r;Object.defineProperty(y,"__line__",{value:r.__line__,enumerable:!1});let x=Ts(o.L({},f,{value:y,valueSpec:c.import}));return o.M(y.id)===""&&x.push(new o.V(`${f.key}.id`,y,"import id can't be an empty string")),p&&(x=x.concat(vo(p,c,{key:`${f.key}.data`}))),x},iconset:function(f){const r=f.value,c=f.key,p=f.styleSpec,y=f.style;if(!r.type)return[new o.V(c,r,'"type" is required')];const x=o.M(r.type);let b=[];if(b=b.concat(Ts({key:c,value:r,valueSpec:p[`iconset_${x}`],style:y,styleSpec:p})),x==="source"&&r.source){const I=y.sources&&y.sources[r.source],A=I&&o.M(I.type);I?A!=="raster-array"&&b.push(new o.V(c,r.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):b.push(new o.V(c,r.source,`source "${r.source}" not found`))}return b}};function mi(f,r=!1){const c=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression&&o.a2(o.M(c)))return Qs(f);if(p.expression&&o.S(o.U(c)))return ds(f);if(p.type&&Js[p.type]){const x=Js[p.type](f);return r===!0&&x.length>0&&o.J(f.value)==="array"?ds(f):x}return Ts(o.L({},f,{valueSpec:p.type?y[p.type]:p}))}function Ll(f){const r=f.value,c=f.key,p=vi(f);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new o.V(c,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new o.V(c,r,'"glyphs" url must include a "{range}" token'))),p}function vo(f,r=o.a5,c={}){return mi({key:c.key||"",value:f,valueSpec:r.$root,styleSpec:r,style:f,objectElementValidators:{glyphs:Ll,"*":()=>[]}})}function Bs(f,r=o.a5){return Ie(vo(f,r))}const dl=f=>Ie(wr(f)),Ol=f=>Ie(fs(f)),Do=f=>Ie(Ds(f)),bt=f=>Ie(qs(f)),Lo=f=>Ie(ss(f)),zc=f=>Ie(function(r){const c=r.value,p=r.style,y=r.styleSpec,x=y.snow;let b=[];const I=o.J(c);if(c===void 0)return b;if(I!=="object")return b=b.concat([new o.V("snow",c,`object expected, ${I} found`)]),b;for(const A in c){const D=A.match(/^(.*)-transition$/);b=b.concat(D&&x[D[1]]&&x[D[1]].transition?mi({key:A,value:c[A],valueSpec:y.transition,style:p,styleSpec:y}):x[A]?mi({key:A,value:c[A],valueSpec:x[A],style:p,styleSpec:y}):[new o.K(A,c[A],`unknown property "${A}"`)])}return b}(f)),Ia=f=>Ie(function(r){const c=r.value,p=r.style,y=r.styleSpec,x=y.rain;let b=[];const I=o.J(c);if(c===void 0)return b;if(I!=="object")return b=b.concat([new o.V("rain",c,`object expected, ${I} found`)]),b;for(const A in c){const D=A.match(/^(.*)-transition$/);b=b.concat(D&&x[D[1]]&&x[D[1]].transition?mi({key:A,value:c[A],valueSpec:y.transition,style:p,styleSpec:y}):x[A]?mi({key:A,value:c[A],valueSpec:x[A],style:p,styleSpec:y}):[new o.K(A,c[A],`unknown property "${A}"`)])}return b}(f)),fi=f=>Ie(ai(f)),Ge=f=>Ie(io(f)),Y=f=>Ie(Dt(f)),J=f=>Ie(Qt(f)),le=f=>Ie(o.a4(f));function Ie(f){return f.slice().sort((r,c)=>r.line&&c.line?r.line-c.line:0)}function he(f,r){let c=!1;if(r&&r.length)for(const p of r)p instanceof o.K?o.w(p.message):(f.fire(new o.z(new Error(p.message))),c=!0);return c}let Me;class Je extends o.E{constructor(r,c="flat"){super(),this._transitionable=new o.a6(Me||(Me=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(r,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c,p={}){this._validate(Ol,r,p)||(this._transitionable.setTransitionOrValue(r),this.id=c)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&he(this,r.call(Bs,o.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Fe=class extends o.E{constructor(f,r,c,p,y){super(),this.scope=c,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=y}get(){return this._transitionable.serialize()}set(f,r){this._transitionable.setTransitionOrValue(f,r)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new o.aa(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const r=f.value.expression;if(!r)return null;let c=-1,p=-1,y=1;for(const x of r.zoomStops)y=r.evaluate(new o.aa(x,{worldview:this.worldview})),y>.01?(c=x,p=-1):p=x;return y<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof o.ab}};const Xe=45,Pt=65,pt=.05;function sn(f,r,c,p){const y=o.af(Xe,Pt,c),[x,b]=_n(f,p);let I=1-Math.min(1,Math.exp((r-x)/(b-x)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*f.alpha}function _n(f,r){const c=.5/Math.tan(.5*r);return[f.range[0]+c,f.range[1]+c]}function Cn(f,r,c,p,y){const x=o.ad([],[r,c,p],y.mercatorFogMatrix);return sn(f,o.ae(x),y.pitch,y._fov)}function Qn(f,r,c,p,y,x,b){const I=[[c,p,0],[y,p,0],[y,x,0],[c,x,0]];let A=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const L of I){const B=o.ad([],L,r),O=o.ae(B);A=Math.min(A,O),D=Math.max(D,O)}return[sn(f,A,b.pitch,b._fov),sn(f,D,b.pitch,b._fov)]}class Nn extends o.E{constructor(r,c,p,y){super();const x=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(x,p,new Map(y)),this.set(r,y),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.ag(x),this.scope=p}get state(){const r=this._transform,c=r.projection.name==="globe",p=o.ah(r.zoom),y=this.properties.get("range"),x=[.5,3];return{range:c?[o.ai(x[0],y[0],p),o.ai(x[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c,p={}){if(this._validate(Lo,r,p))return;const y=o.h({},r);for(const x of Object.keys(o.a5.fog))y[x]===void 0&&(y[x]=o.a5.fog[x].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(Xe,Pt,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(p,y,x){const b=o.ac.fromLngLat(y),I=x.elevation?x.elevation.getAtPointOrZero(b):0;return Cn(p,b.x,b.y,I,x)}(this.state,r,c):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(r.toUnwrapped());return Qn(this.state,c,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(r,c,p,y,x){return this._transform.projection.supportsFog?Qn(this.state,r,c,p,y,x,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?_n(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const y=r.points[p];let x;if(y[2]>=0)x=y;else{const b=r.points[p-4];x=o.ak(b,y,b[2]/(b[2]-y[2]))}if(Cn(this.state,x[0],x[1],0,this._transform)>=pt)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&he(this,r.call(Bs,o.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Jn,Ui,ni,br,Tr=class extends o.E{constructor(f,r,c,p){super();const y=Jn||(Jn=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(y,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(y),this.scope=c}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=o.al(c[0]),y=-Math.max(o.al(c[1]),.01),x=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],b=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(r.r,r.g,r.b,r.a*f),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate(zc,f,c))return;const p=o.h({},f);for(const y of Object.keys(o.a5.snow))p[y]===void 0&&(p[y]=o.a5.snow[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&he(this,f.call(Bs,o.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},jr=class extends o.E{constructor(f,r,c,p){super();const y=Ui||(Ui=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(y,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(y),this.scope=c}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=o.al(c[0]),y=-Math.max(o.al(c[1]),.01),x=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(r.r,r.g,r.b,r.a*f),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate(Ia,f,c))return;const p=o.h({},f);for(const y of Object.keys(o.a5.rain))p[y]===void 0&&(p[y]=o.a5.rain[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&he(this,f.call(Bs,o.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class gi extends o.E{constructor(r,c,p,y){super(),this.scope=p,this._options=r,this.properties=new o.ag(c),this._transitionable=new o.a6(c,p,new Map(y)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,c){this._options=r,this._transitionable.setTransitionOrValue(r.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ci{constructor(r,c,p){this.screenBounds=r,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(r,c){let p,y;if(r instanceof o.P||typeof r[0]=="number"){const x=o.P.convert(r);p=[x],y=c.isPointAboveHorizon(x)}else{const x=o.P.convert(r[0]),b=o.P.convert(r[1]),I=x.add(b)._div(2);p=[x,b],y=o.ao(x,b).every(A=>c.isPointAboveHorizon(A))&&c.isPointAboveHorizon(I)}return new ci(p,y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.ao(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),o.ap(y,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.ao(c,p,r),x=this.cameraPoint.clone();switch(3*((x.y>c.y)+(x.y>p.y))+((x.x>c.x)+(x.x>p.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(r,c,p,y=0){const x=r.queryPadding/c._pixelsPerMercatorPixel+1,b=p?this._bufferedCameraMercator(x,c):this._bufferedScreenMercator(x,c);let I=r.tileID.wrap+(b.unwrapped?y:0);const A=b.polygon.map(X=>o.aq(r.tileTransform,X,I));if(!o.ar(A,0,0,o.aj,o.aj))return;I=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const D=this.screenGeometryMercator.polygon.map(X=>o.as(r.tileTransform,X,I)),L=D.map(X=>new o.P(X[0],X[1])),B=c.getFreeCameraOptions().position||new o.ac(0,0,0),O=o.as(r.tileTransform,B,I),U=D.map(X=>{const Z=o.at(X,X,O);return o.au(Z,Z),new o.av(O,Z)}),q=o.aw(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:U,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:($=o.ax(A),$.min.x=o.ay($.min.x,0,o.aj),$.min.y=o.ay($.min.y,0,o.aj),$.max.x=o.ay($.max.x,0,o.aj),$.max.y=o.ay($.max.y,0,o.aj),$),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:q};var $}_bufferedScreenMercator(r,c){const p=cr(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(r,c){const p=cr(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(x=>c.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(r,c){const p=function(x,b){const I=o.az([],b.pixelMatrix,b.globeMatrix),A=[0,-o.aB,0,1],D=[0,o.aB,0,1],L=[0,0,0,1];o.aA(A,A,I),o.aA(D,D,I),o.aA(L,L,I);const B=new o.P(A[0]/A[3],A[1]/A[3]),O=new o.P(D[0]/D[3],D[1]/D[3]),U=o.aC(x,B)&&A[3]<L[3],q=o.aC(x,O)&&D[3]<L[3];if(!U&&!q)return null;const $=function(Ee,pe,_e){for(let ve=1;ve<Ee.length;ve++){const We=tr(pe.pointCoordinate3D(Ee[ve-1]).x),Le=tr(pe.pointCoordinate3D(Ee[ve]).x);if(_e<0){if(We<Le)return{idx:ve,t:-We/(Le-1-We)}}else if(Le<We)return{idx:ve,t:(1-We)/(Le+1-We)}}return null}(x,b,U?-1:1);if(!$)return null;const{idx:X,t:Z}=$;let te=X>1?ji(x.slice(0,X),b):[],re=X<x.length?ji(x.slice(X),b):[];te=te.map(Ee=>new o.P(tr(Ee.x),Ee.y)),re=re.map(Ee=>new o.P(tr(Ee.x),Ee.y));const ae=[...te];ae.length===0&&ae.push(re[re.length-1]);const fe=o.ai(ae[ae.length-1].y,(re.length===0?te[0]:re[0]).y,Z);let be;return be=U?[new o.P(0,fe),new o.P(0,0),new o.P(1,0),new o.P(1,fe)]:[new o.P(1,fe),new o.P(1,1),new o.P(0,1),new o.P(0,fe)],ae.push(...be),re.length===0?ae.push(te[0]):ae.push(...re),{polygon:ae.map(Ee=>new o.ac(Ee.x,Ee.y)),unwrapped:!1}}(r,c);if(p)return p;const y=function(x,b){let I=!1,A=-1/0,D=0;for(let B=0;B<x.length-1;B++)x[B].x>A&&(A=x[B].x,D=B);for(let B=0;B<x.length-1;B++){const O=(D+B)%(x.length-1),U=x[O],q=x[O+1];Math.abs(U.x-q.x)>.5&&(U.x<q.x?(U.x+=1,O===0&&(x[x.length-1].x+=1)):(q.x+=1,O+1===x.length-1&&(x[0].x+=1)),I=!0)}const L=o.aD(b.center.lng);return I&&L<Math.abs(L-1)&&x.forEach(B=>{B.x-=1}),{polygon:x,unwrapped:I}}(ji(r,c).map(x=>new o.P(tr(x.x),x.y)),c);return{polygon:y.polygon.map(x=>new o.ac(x.x,x.y)),unwrapped:y.unwrapped}}}function ji(f,r){return o.aE(f,c=>{const p=r.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function tr(f){return f<0?1+f%1:f%1}function cr(f){return 100*f|0}function ls(f,r,c,p,y){const x=function(I,A){if(I)return y(I);if(A){if(f.url&&A.tiles&&f.tiles&&delete f.tiles,A.variants){if(!Array.isArray(A.variants))return y(new Error("variants must be an array"));for(const L of A.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return y(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){A=o.h(A,L);break}}}const D=o.aF(o.h({},A,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=r.canonicalizeTileset(D,f.url),y(null,D)}},b=function(I,A,D){if(!I)return null;if(!A&&!D)return I;D=D||I.worldview_default;const L=Object.values(I.language||{});if(L.length===0)return null;const B=Object.values(I.worldview||{});if(B.length===0)return null;const O=L.every(q=>q===A),U=B.every(q=>q===D);return O&&U?I:A in(I.language_options||{})||D in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(f.data,c,p);return b?o.q.frame(()=>x(null,b)):f.url?o.n(r.transformRequest(r.normalizeSourceURL(f.url,null,c,p),o.R.Source),x):o.q.frame(()=>{const{data:I,...A}=f;x(null,A)})}function Ls(f,r){const c=Math.pow(2,r.z),p=Math.floor(o.aD(f.getWest())*c),y=Math.floor(o.aH(f.getNorth())*c),x=Math.ceil(o.aD(f.getEast())*c),b=Math.ceil(o.aH(f.getSouth())*c);return r.x>=p&&r.x<x&&r.y>=y&&r.y<b}class Os{constructor(r,c,p){this.bounds=r?o.aG.convert(this.validateBounds(r)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const c of r)this.extraBounds.push(o.aG.convert(this.validateBounds(c)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!Ls(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(Ls(c,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const c=new Os(r.bounds,r.minzoom,r.maxzoom);return c.addExtraBounds(r.extra_bounds),c}}class fl extends o.E{constructor(r,c,p,y){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(c,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new o.aI}load(r){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=ls(this._options,this.map._requestManager,c,p,(y,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new o.z(y));else if(x){if(o.h(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of x.vector_layers)this.vectorLayerIds.push(b.id),x.worldview&&x.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=Os.fromTileJSON(x),oi(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}r&&r(y)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(r,c){const p=r.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),x=this.map._requestManager.transformRequest(y,o.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,I=b?{image:b.image.clone()}:null,A={request:x,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(p)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=c:r.request=r.actor.send("reloadTile",A,D.bind(this));else if(r.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",A,D.bind(this),void 0,!0);else{const L=o.aJ.call({deduped:this._deduped},A,(B,O)=>{B||!O?D.call(this,B):(A.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},r.actor&&r.actor.send("loadTile",A,D.bind(this),void 0,!0))},!0);r.request={cancel:L}}function D(L,B){return delete r.request,r.aborted?c(null):L&&L.status!==404?c(L):(B&&B.resourceTiming&&(r.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&r.setExpiryData(B),r.loadVectorData(B,this.map.painter),o.aK(this.dispatcher),c(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ye extends o.E{constructor(r,c,p,y){super(),this.id=r,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},c),o.h(this,o.aF(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=ls(this._options,this.map._requestManager,null,c,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new o.z(p)):y&&(o.h(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),this.tileBounds=Os.fromTileJSON(y),oi(y.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),r&&r(p)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const p=o.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=o.o(this.map._requestManager.transformRequest(y,o.R.Tile),(x,b,I,A)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):x?(r.state="errored",c(x)):b?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:I,expires:A}),r.setTexture(b,this.map.painter),r.state="loaded",o.aK(this.dispatcher),void c(null)):c(null)))}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c&&c()}unloadTile(r,c){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class tt extends ye{constructor(r,c,p,y){super(r,c,p,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},c)}triggerRepaint(r){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,r.tileID),this.map.triggerRepaint()}loadTile(r,c){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,o.R.Tile),x={request:y,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=y,r.actor||(r.actor=this.dispatcher.getActor());const b=(I,A,D,L)=>{if(delete r.request,r.aborted)return r.state="unloaded",c(null);if(I)return I.name==="AbortError"?void 0:(r.state="errored",c(I));if(this.map._refreshExpiredTiles&&A&&r.setExpiryData({cacheControl:D,expires:L}),this.partial)r.state="empty";else{if(!A)return c(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=A}c(null)};r.request=this.partial?r.fetchHeader(void 0,b.bind(this)):r.actor.send("loadTile",x,b.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){const p=r.texturePerLayer;if(r.flushAllQueues(),p.size){r.destroy(!0);for(const y of p.values())this.map.painter.saveTileTexture(y)}else r.destroy()}prepareTile(r,c,p,y){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(c,p,y,(x,b)=>{if(x)return r.state="errored",this.fire(new o.z(x)),void this.triggerRepaint(r);b&&(r._isHeaderLoaded=!0,r.setTexturePerLayer(p,b,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:x})=>x===r),p=c&&c.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(r,c,p){if(!r)return;const y=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let x=null;c instanceof o.aN?x=c.paint.get("raster-array-band"):c instanceof o.aO&&(x=c.paint.get("raster-particle-array-band"));const b=x||this.getInitialBand(y);if(b==null)return;if(!r.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(r,y,c.id,b);if(r.updateNeeded(c.id,b)&&!p)return;const I=r.textureDescriptorPerLayer.get(c.id);return Object.assign({},I,{texture:r.texturePerLayer.get(c.id)})}getImages(r,c){const p=new Map;for(const y of r)for(const x of c){const[b,I]=x.split("/"),A=y.getLayer(b);if(!A||!A.hasBand(I)||!A.hasDataForBand(I))continue;const{bytes:D,tileSize:L,buffer:B}=A.getBandView(I),O=L+2*B,U={data:new o.r({width:O,height:O},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(x,U)}return p}}const ze={vector:fl,raster:ye,"raster-dem":class extends ye{constructor(f,r,c,p){super(f,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,x){y&&(f.state="errored",r(y)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=o.o(this.map._requestManager.transformRequest(c,o.R.Tile),(function(y,x,b,I){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(y)f.state="errored",r(y);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:b,expires:I});const A=ImageBitmap&&x instanceof ImageBitmap&&o.t(),D=1-(x.width-o.aL(x.width))/2;D<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const L=A?x:o.q.getImageData(x,D),B={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:D};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",B,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const r=f.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,y=r.x===0?f.wrap-1:f.wrap,x=(r.x+1+c)%c,b=r.x+1===c?f.wrap+1:f.wrap,I={};return I[new o.aM(f.overscaledZ,y,r.z,p,r.y).key]={backfilled:!1},I[new o.aM(f.overscaledZ,b,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(I[new o.aM(f.overscaledZ,y,r.z,p,r.y-1).key]={backfilled:!1},I[new o.aM(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},I[new o.aM(f.overscaledZ,b,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<c&&(I[new o.aM(f.overscaledZ,y,r.z,p,r.y+1).key]={backfilled:!1},I[new o.aM(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},I[new o.aM(f.overscaledZ,b,r.z,x,r.y+1).key]={backfilled:!1}),I}},"raster-array":tt,geojson:class extends o.E{constructor(f,r,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=o.h({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*y,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*y,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.aj,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const c of this._data.features)r.set(c.id,c);for(const c of f.features)r.set(c.id,c);this._data.features=[...r.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterLeaves(f,r,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:r,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const r=o.h({append:f},this.workerOptions);r.scope=this.scope;const c=this._data;typeof c=="string"?(r.request=this.map._requestManager.transformRequest(o.q.resolveURL(c),o.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new o.z(p));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(x.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new o.A("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=o.C(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,r){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,x=this._partialReload,b={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x,worldview:this.map.getWorldview()};f.request=this.actor.send(c,b,(I,A)=>x&&!A?(f.state="loaded",r(null)):(delete f.request,f.destroy(),f.aborted?r(null):I?r(I):(f.loadVectorData(A,this.map.painter,c==="reloadTile"),r(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,r){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(f,r,c,p){super(f,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aQ(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new o.z(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(f,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(f,r,c,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const f=[];for(const r in this._options.models){const c=this._options.models[r],p=o.aS(this.map._requestManager.transformRequest(c.uri,o.R.Model).url).then(y=>{if(!y)return;const x=o.aT(y),b=new o.aU(r,c.position,c.orientation,x);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(y=>{this.fire(new o.z(new Error(`Could not load model ${r} from ${c.uri}: ${y.message}`)))});f.push(p)}Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${r.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,r){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(f,r,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=ls(this._options,this.map._requestManager,r,c,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.z(p))):y&&(o.h(this,y),y.bounds&&(this.tileBounds=new Os(y.bounds,this.minzoom,this.maxzoom)),oi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=r;else{if(f.buckets){const x=Object.values(f.buckets);for(const b of x)b.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(x,b){return f.aborted?r(null):x&&x.status!==404?r(x):(this.map._refreshExpiredTiles&&b&&f.setExpiryData(b),f.loadModelData(b,this.map.painter),f.state="loaded",void r(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(f,r,c,p){super(f,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(x=>typeof x!="number"))||this.fire(new o.z(new o.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends o.E{constructor(f,r,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Os(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:r,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:c,y:p,z:y}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:y},{signal:x.signal})).then((function(b){return delete f.request,f.aborted?(f.state="unloaded",r(null)):b===void 0?(f.state="errored",r(null)):b===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(b)?(this.loadTileData(f,b),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(b=>{b.name!=="AbortError"&&(f.state="errored",r(b))}),f.request.cancel=()=>x.abort()}loadTileData(f,r){f.setTexture(r,this.map.painter)}unloadTile(f,r){if(f.texture&&f.texture instanceof o.T?(f.destroy(!0),f.texture&&f.texture instanceof o.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:y})}r&&r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=o.C(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},dt=function(f,r,c,p){const y=new ze[r.type](f,r,c,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return o.aV(["load","abort","unload","serialize","prepare"],y),y};function mt(f,r,c=""){return`${c}:${r.id||""}:${r.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:y,importId:x}=p;return`featureset:${y}${x?`:import:${x}`:""}`}}(f.target)}`}function ut(f,r,c,p=""){if(f.uniqueFeatureID){const y=mt(f,r,p);if(c.has(y))return!0;c.add(y)}return!1}function $t(f,r,c,p,y=!1){const x=r.sourceCache.transform,b=r.sourceCache.tilesIn(f,r.has3DLayers,y);b.sort(un);const I=[];for(const A of b){const D=A.tile.queryRenderedFeatures(r,A,c,p,x,y);Object.keys(D).length&&I.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:D})}return I.length===0?{}:function(A){const D={},L={};for(const B of A){const O=B.queryResults,U=B.wrappedTileID,q=L[U]=L[U]||{};for(const $ in O){const X=O[$],Z=q[$]=q[$]||{},te=D[$]=D[$]||[];for(const re of X)Z[re.featureIndex]||(Z[re.featureIndex]=!0,te.push(re))}}return D}(I)}function rn(f,r,c,p,y,x){const b={},I=p.queryRenderedSymbols(f),A=[];for(const D of Object.keys(I).map(Number))A.push(y[D]);A.sort(un);for(const D of A){const L=D.featureIndex.lookupSymbolFeatures(I[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,r,c,x);for(const B in L){const O=b[B]=b[B]||[],U=L[B];U.sort((q,$)=>{const X=D.featureSortOrder;if(X){const Z=X.indexOf(q.featureIndex);return X.indexOf($.featureIndex)-Z}return $.featureIndex-q.featureIndex});for(const q of U)O.push(q)}}return b}function cn(f,r){const c=f.getRenderableIds().map(x=>f.getTileByID(x)),p=[],y={};for(let x=0;x<c.length;x++){const b=c[x],I=b.tileID.canonical.key;y[I]||(y[I]=!0,b.querySourceFeatures(p,r))}return p}function un(f,r){const c=f.tileID,p=r.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function fn(f,r){const c={};if(!r)return c;for(const p of f){const y=p.layerIds.map(x=>r.getLayer(x)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(x=>y.filter(b=>b.id===x)[0]));for(const x of y)c[x.fqid]=p}}return c}const Mn=32,ui=33,jn=new Uint16Array(8184);for(let f=0;f<2046;f++){let r=f+2,c=0,p=0,y=0,x=0,b=0,I=0;for(1&r?y=x=b=Mn:c=p=I=Mn;(r>>=1)>1;){const D=c+y>>1,L=p+x>>1;1&r?(y=c,x=p,c=b,p=I):(c=y,p=x,y=b,x=I),b=D,I=L}const A=4*f;jn[A+0]=c,jn[A+1]=p,jn[A+2]=y,jn[A+3]=x}const Fi=new Uint16Array(2178),pr=new Uint8Array(1089),Ar=new Uint16Array(1089);function cs(f){return f===0?-.03125:f===32?.03125:0}const sa={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class Sa{constructor(r,c,p,y,x,b){this.tileID=r,this.uid=o.a$(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=b}registerFadeDuration(r){const c=r+this.timeAdded;c<o.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,c,p){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=fn(r.buckets,c.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof o.b1){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof o.b1&&x.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y],b=c.style.getOwnLayer(y);if(!b)continue;const I=b.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,I)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,c,p){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,fn(r.buckets,c.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const y in this.buckets){const x=this.buckets[y];x.uploadPending()&&x.upload(r)}const c=r.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new o.T(r,p.image,c.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(r,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=c.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(r,c,p,y,x,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(A,D){const L=o.bn([],[.5*A.width,.5*-A.height,1]);return o.bo(L,L,[1,-1,0]),o.az(L,L,A.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(L)}(x,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:c,pixelPosMatrix:I,transform:y,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(r,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),x=c?c.sourceLayer:"",b=y._geojsonTileLayer||y[x];if(!b)return;const I=o.b3(c&&c.filter),{z:A,x:D,y:L}=this.tileID.canonical,B={z:A,x:D,y:L};for(let O=0;O<b.length;O++){const U=b.feature(O);if(I.needGeometry){const X=o.b4(U,!0);if(!I.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),X,this.tileID.canonical))continue}else if(!I.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),U))continue;const q=p.getId(U,x),$=new o.b5(U,A,D,L,q);$.tile=B,r.push($)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const c=this.expirationTime;if(r.cacheControl){const p=o.b6(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(c)if(this.expirationTime<c)y=!0;else{const x=this.expirationTime-c;x?this.expirationTime=p+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,c){if(!this.latestFeatureIndex||!r.style)return;const p=this.latestFeatureIndex.loadVTLayers(),y=r.style.listImages(),x=r.style.getBrightness();for(const b in this.buckets){if(!r.style.hasLayer(b))continue;const I=this.buckets[b],A=I.layers[0],D=A.sourceLayer||"_geojsonTileLayer",L=p[D],B=r.style.getLayerSourceCache(A);let O={};B&&(O=B._state.getState(D,void 0));const U=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},q=Object.keys(O).length>0&&!c;q&&!I.stateDependentLayers.length&&!c||I.update(O,L,y,U,q?I.stateDependentLayers:I.layers,c,x),(I instanceof o.b7||I instanceof o.b8)&&r._terrain&&r._terrain.enabled&&B&&I.uploadPending()&&r._terrain._clearRenderCacheForTile(B.id,this.tileID);const $=r&&r.style&&r.style.getOwnLayer(b);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.q.now()+r}setTexture(r,c){const p=c.context,y=p.gl;this.texture=this.texture||c.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r):(this.texture=new o.T(p,r,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(r,c){const p={};for(const y of c)p[y]=!0;this.dependencies[r]=p}hasDependency(r,c){for(const p of r){const y=this.dependencies[p];if(y){for(const x of c)if(y[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=o.b9(sa,this.tileID.canonical,this.tileTransform)[0],y=new o.ba,x=new o.bb;for(let b=0;b<p.length;b++){const{x:I,y:A}=p[b];y.emplaceBack(I,A),x.emplaceBack(b)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(y,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,y.length,x.length)}_makeTileBoundsBuffers(r,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=o.b9(sa,this.tileID.canonical,this.tileTransform)[0];let y,x;if(this.isRaster){const b=function(I,A){const D=o.aW(I,A),L=Math.pow(2,I.z);for(let X=0;X<ui;X++)for(let Z=0;Z<ui;Z++){const te=o.aX((I.x+(Z+cs(Z))/Mn)/L),re=o.aY((I.y+(X+cs(X))/Mn)/L),ae=A.project(te,re),fe=X*ui+Z;Fi[2*fe+0]=Math.round((ae.x*D.scale-D.x)*o.aj),Fi[2*fe+1]=Math.round((ae.y*D.scale-D.y)*o.aj)}pr.fill(0),Ar.fill(0);for(let X=2045;X>=0;X--){const Z=4*X,te=jn[Z+0],re=jn[Z+1],ae=jn[Z+2],fe=jn[Z+3],be=te+ae>>1,Ee=re+fe>>1,pe=be+Ee-re,_e=Ee+te-be,ve=re*ui+te,We=fe*ui+ae,Le=Ee*ui+be,lt=Math.hypot((Fi[2*ve+0]+Fi[2*We+0])/2-Fi[2*Le+0],(Fi[2*ve+1]+Fi[2*We+1])/2-Fi[2*Le+1])>=16;pr[Le]=pr[Le]||(lt?1:0),X<1022&&(pr[Le]=pr[Le]||pr[(re+_e>>1)*ui+(te+pe>>1)]||pr[(fe+_e>>1)*ui+(ae+pe>>1)])}const B=new o.aZ,O=new o.a_;let U=0;function q(X,Z){const te=Z*ui+X;return Ar[te]===0&&(B.emplaceBack(Fi[2*te+0],Fi[2*te+1],X*o.aj/Mn,Z*o.aj/Mn),Ar[te]=++U),Ar[te]-1}function $(X,Z,te,re,ae,fe){const be=X+te>>1,Ee=Z+re>>1;if(Math.abs(X-ae)+Math.abs(Z-fe)>1&&pr[Ee*ui+be])$(ae,fe,X,Z,be,Ee),$(te,re,ae,fe,be,Ee);else{const pe=q(X,Z),_e=q(te,re),ve=q(ae,fe);O.emplaceBack(pe,_e,ve)}}return $(0,0,Mn,Mn,Mn,0),$(Mn,Mn,0,0,0,Mn),{vertices:B,indices:O}}(this.tileID.canonical,c);y=b.vertices,x=b.indices}else{y=new o.aZ,x=new o.a_;for(const{x:I,y:A}of p)y.emplaceBack(I,A,0,0);const b=o.be(y.int16.subarray(0,4*y.length),void 0,4);for(let I=0;I<b.length;I+=3)x.emplaceBack(b[I],b[I+1],b[I+2])}this._tileBoundsBuffer=r.createVertexBuffer(y,o.bf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=o.bd.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugBuffers(r,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const y=this.tileID.canonical,x=o.bg(y,c),b=o.bh(x),I=o.ah(c.zoom);let A;I>0&&(A=o.bi(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,y,c,b,A,I),this._makeGlobeTileDebugTextBuffer(r,y,c,b,A,I)}_globePoint(r,c,p,y,x,b,I){let A=o.bj(r,c,p);if(b){const D=1<<p.z,L=o.aD(y.center.lng),B=o.aH(y.center.lat),O=(p.x+.5)/D-L;let U=0;O>.5?U=-1:O<-.5&&(U=1);let q=(r/o.aj+p.x)/D+U,$=(c/o.aj+p.y)/D;q=(q-L)*y._pixelsPerMercatorPixel+L,$=($-B)*y._pixelsPerMercatorPixel+B;const X=[q*y.worldSize,$*y.worldSize,0];o.ad(X,X,b),A=o.bk(A,X,I)}return o.ad(A,A,x)}_makeGlobeTileDebugBorderBuffer(r,c,p,y,x,b){const I=new o.ba,A=new o.bb,D=new o.bl,L=(O,U,q,$,X)=>{const Z=(q-O)/(X-1),te=($-U)/(X-1),re=I.length;for(let ae=0;ae<X;ae++){const fe=O+ae*Z,be=U+ae*te;I.emplaceBack(fe,be);const Ee=this._globePoint(fe,be,c,p,y,x,b);D.emplaceBack(Ee[0],Ee[1],Ee[2]),A.emplaceBack(re+ae)}},B=o.aj;L(0,0,B,0,16),L(B,0,B,B,16),L(B,B,0,B,16),L(0,B,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(A),this._tileDebugBuffer=r.createVertexBuffer(I,o.bc.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(D,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,I.length,A.length)}_makeGlobeTileDebugTextBuffer(r,c,p,y,x,b){const I=o.aj/4,A=new o.ba,D=new o.a_,L=new o.bl,B=25;D.reserve(32),A.reserve(B),L.reserve(B);const O=(U,q)=>B*U+q;for(let U=0;U<B;U++){const q=U*I;for(let $=0;$<B;$++){const X=$*I;A.emplaceBack(X,q);const Z=this._globePoint(X,q,c,p,y,x,b);L.emplaceBack(Z[0],Z[1],Z[2])}}for(let U=0;U<4;U++)for(let q=0;q<4;q++){const $=O(U,q),X=O(U,q+1),Z=O(U+1,q),te=O(U+1,q+1);D.emplaceBack($,X,Z),D.emplaceBack(Z,X,te)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(D),this._tileDebugTextBuffer=r.createVertexBuffer(A,o.bc.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(L,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,B,32)}destroy(r=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class zl extends Sa{constructor(r,c,p,y,x){super(r,c,p,y,x),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexturePerLayer(r,c,p){const y=p.context,x=y.gl;let b=this.texturePerLayer.get(r)||p.getTileTexture(c.width);b&&b instanceof o.T?b.update(c,{premultiply:!1}):b=new o.T(y,c,x.RGBA8,{premultiply:!1}),this.texturePerLayer.has(r)||this.texturePerLayer.set(r,b)}flushQueues(r){const c=this._workQueuePerLayer.get(r)||[],p=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const r of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}for(const r of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}}fetchHeader(r=16384,c){const p=this._mrt=new o.bp(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.br(y,(x,b,I,A)=>{if(x)c(x);else try{const D=p.getHeaderLength(b);if(D>r)return void(this.request=this.fetchHeader(D,c));p.parseHeader(b),this._isHeaderLoaded=!0;let L=0;for(const B of Object.values(p.layers))L=Math.max(L,B.dataIndex[B.dataIndex.length-1].lastByte);b.byteLength>=L&&(this.entireBuffer=b),c(null,this.entireBuffer||b,I,A)}catch(D){c(D)}}),this.request}fetchBand(r,c,p,y){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void y(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void y(new Error("Can't fetch tile band without an actor"));let I;const A=(O,U)=>{if(I.complete(O,U),O)return void y(O);this.updateTextureDescriptor(r,c,p);const q=this.textureDescriptorPerLayer.get(c);y(null,q&&q.img)},D=(O,U)=>{if(O)return y(O);const q=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:U,task:I},A,void 0,!0),$=this._workQueuePerLayer.get(c)||[];$.push(()=>{q&&q.cancel(),I.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,$)},L=x.getLayer(r);if(!L)return void y(new Error(`Unknown sourceLayer "${r}"`));if(L.hasDataForBand(p)){this.updateTextureDescriptor(r,c,p);const O=this.textureDescriptorPerLayer.get(c);return void y(null,O?O.img:null)}const B=L.getDataRange([p]);if(I=x.createDecodingTask(B),!I||I.tasks.length)if(this.flushQueues(c),this.entireBuffer)D(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{const O=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),U=o.br(O,D),q=this._fetchQueuePerLayer.get(c)||[];q.push(()=>{U.cancel(),I.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,q)}else y(null)}updateNeeded(r,c){return(!this.textureDescriptorPerLayer.get(r)||this.textureDescriptorPerLayer.get(r).band!==c)&&this.state!=="errored"}updateTextureDescriptor(r,c,p){if(!this._mrt)return;const y=this._mrt.getLayer(r);if(!y||!y.hasBand(p)||!y.hasDataForBand(p))return;const{bytes:x,tileSize:b,buffer:I,offset:A,scale:D}=y.getBandView(p),L=b+2*I,B=new o.r({width:L,height:L},x),O=this.texturePerLayer.get(c);O&&O instanceof o.T&&O.update(B,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:r,band:p,img:B,buffer:I,offset:A,tileSize:b,format:y.pixelFormat,mix:[D,256*D,65536*D,16777216*D]})}destroy(r=!1){if(super.destroy(r),delete this._mrt,!r)for(const c of this.texturePerLayer.values())c&&c instanceof o.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class oc{constructor(r,c){this.max=r,this.onRemove=c,this.reset()}reset(){for(const r in this.data)for(const c of this.data[r])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(r,c,p){const y=r.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const x={value:c,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(r,x)},p)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const c=this.data[r].shift();return c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),c.value}getByKey(r){const c=this.data[r];return c?c[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,c){if(!this.has(r))return this;const p=r.wrapped().key,y=c===void 0?0:this.data[p].indexOf(c),x=this.data[p][y];return this.data[p].splice(y,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(r){const c=[];for(const p in this.data)for(const y of this.data[p])r(y.value)||c.push(y);for(const p of c)this.remove(p.value.tileID,p)}}class Sh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,c,p){const y=String(c);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][y]=this.stateChanges[r][y]||{},o.h(this.stateChanges[r][y],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==y&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][y]===null){this.deletedStates[r][y]={};for(const x in this.state[r][y])p[x]||(this.deletedStates[r][y][x]=null)}else for(const x in p)this.deletedStates[r]&&this.deletedStates[r][y]&&this.deletedStates[r][y][x]===null&&delete this.deletedStates[r][y][x]}removeFeatureState(r,c,p){if(this.deletedStates[r]===null)return;const y=String(c);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&c!==void 0)this.deletedStates[r][y]!==null&&(this.deletedStates[r][y]=this.deletedStates[r][y]||{},this.deletedStates[r][y][p]=null);else if(c!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][y])for(p in this.deletedStates[r][y]={},this.stateChanges[r][y])this.deletedStates[r][y][p]=null;else this.deletedStates[r][y]=null;else this.deletedStates[r]=null}getState(r,c){const p=this.state[r]||{},y=this.stateChanges[r]||{},x=this.deletedStates[r];if(x===null)return{};if(c!==void 0){const I=String(c),A=o.h({},p[I],y[I]);if(x){const D=x[c];if(D===null)return{};for(const L in D)delete A[L]}return A}const b=o.h({},p,y);if(x)for(const I in x)delete b[I];return b}initializeTileState(r,c){r.refreshFeatureState(c)}coalesceChanges(r,c){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const b in this.stateChanges[y])this.state[y][b]||(this.state[y][b]={}),o.h(this.state[y][b],this.stateChanges[y][b]),x[b]=this.state[y][b];p[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(this.deletedStates[y]===null)for(const b in this.state[y])x[b]={},this.state[y][b]={};else for(const b in this.deletedStates[y]){if(this.deletedStates[y][b]===null)this.state[y][b]={};else if(this.state[y][b])for(const I of Object.keys(this.deletedStates[y][b]))delete this.state[y][b][I];x[b]=this.state[y][b]}p[y]=p[y]||{},o.h(p[y],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in r)r[y].refreshFeatureState(c)}}class Is extends o.E{constructor(r,c,p){super(),this.id=r,this._onlySymbols=p,c.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new oc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Sh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,c){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,c)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(r),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(ro).map(r=>r.key)}getRenderableIds(r,c){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,r,c)&&p.push(this._tiles[y]);return r?p.sort((y,x)=>{const b=y.tileID,I=x.tileID,A=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),D=new o.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-I.overscaledZ||D.y-A.y||D.x-A.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(ro).map(y=>y.key)}hasRenderableParent(r){const c=this.findLoadedParent(r,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(r,c,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(c||!this._tiles[r].holdingForFade())&&(p||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,c){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,r,c)))}_tileLoaded(r,c,p,y){if(y)if(r.state="errored",y.status!==404)this._source.fire(new o.z(y,{tile:r}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=o.q.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(c,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const c=this.getRenderableIds();for(let y=0;y<c.length;y++){const x=c[y];if(r.neighboringTiles&&r.neighboringTiles[x]){const b=this.getTileByID(x);p(r,b),p(b,r)}}function p(y,x){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let b=x.tileID.canonical.x-y.tileID.canonical.x;const I=x.tileID.canonical.y-y.tileID.canonical.y,A=Math.pow(2,y.tileID.canonical.z),D=x.tileID.key;b===0&&I===0||Math.abs(I)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,b,I),y.neighboringTiles&&y.neighboringTiles[D]&&(y.neighboringTiles[D].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,c,p,y){for(const x in this._tiles){let b=this._tiles[x];if(y[x]||!b.hasData()||b.tileID.overscaledZ<=c||b.tileID.overscaledZ>p)continue;let I=b.tileID;for(;b&&b.tileID.overscaledZ>c+1;){const D=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[D.key],b&&b.hasData()&&(I=D)}let A=I;for(;A.overscaledZ>c;)if(A=A.scaledTo(A.overscaledZ-1),r[A.key]){y[I.key]=I;break}}}findLoadedParent(r,c){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=r.overscaledZ-1;p>=c;p--){const y=r.scaledTo(p),x=this._getLoadedTile(y);if(x)return x}}_getLoadedTile(r){const c=this._tiles[r.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,c){c=c||this._source.tileSize;const p=Math.ceil(r.width/c)+1,y=Math.ceil(r.height/c)+1,x=Math.floor(p*y*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(I)}handleWrapJump(r){const c=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,c){const p={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),p[x.tileID.key]=x}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(r,c,p,y,x){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(r,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b=this._source.type==="batched-model";let I,A=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const O=D.attenuationRange()[0],U=Math.floor(O)-Math.log2(D.getDemUpscale());A>U&&(A=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.aM(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=r.clone();O.tileCoverLift=this.tileCoverLift,I=O.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&r.projection.name==="globe"&&(I.push(new o.aM(1,0,1,0,0)),I.push(new o.aM(1,0,1,1,0)),I.push(new o.aM(1,0,1,0,1)),I.push(new o.aM(1,0,1,1,1)))}else if(I=r.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);I=I.filter(U=>O(U))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!pl(this._source.type)){const O=r.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),U=Math.min(O,this._source.maxzoom);if(b){const q=r.extendTileCover(I,U);for(const $ of q)I.push($)}else if(x){const q=r.extendTileCoverToNearPlane(I,this.transform.getFrustum(U),U);for(const $ of q)I.push($)}else if(this.castsShadows&&y){const q=r.extendTileCover(I,U,y);for(const $ of q)this._shadowCasterTiles[$.key]=!0,I.push($)}}const L=this._updateRetainedTiles(I);if(pl(this._source.type)&&I.length!==0){const O={},U={},q=Object.keys(L);for(const X of q){const Z=L[X],te=this._tiles[X];if(!te||te.fadeEndTime&&te.fadeEndTime<=o.q.now())continue;const re=this.findLoadedParent(Z,Math.max(Z.overscaledZ-Is.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),O[re.tileID.key]=re.tileID),U[X]=Z}const $=I[I.length-1].overscaledZ;for(const X in this._tiles){const Z=this._tiles[X];if(L[X]||!Z.hasData())continue;let te=Z.tileID;for(;te.overscaledZ>$;){te=te.scaledTo(te.overscaledZ-1);const re=this._tiles[te.key];if(re&&re.hasData()&&U[te.key]){L[X]=Z.tileID;break}}}for(const X in O)L[X]||(this._coveredTiles[X]=!0,L[X]=O[X])}for(const O in L)this._tiles[O].clearFadeHold();const B=o.bs(this._tiles,L);for(const O of B){const U=this._tiles[O];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const c={};if(r.length===0)return c;const p={},y=r.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),x=r[0].overscaledZ,b=Math.max(x-Is.maxOverzooming,this._source.minzoom),I=Math.max(x+Is.maxUnderzooming,this._source.minzoom),A={};for(const D of r){const L=this._addTile(D);c[D.key]=D,L.hasData()||y<this._source.maxzoom&&(A[D.key]=D)}this._retainLoadedChildren(A,y,I,c);for(const D of r){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const O=D.children(this._source.maxzoom)[0],U=this.getTile(O);if(U&&U.hasData()){c[O.key]=O;continue}}else{const O=D.children(this._source.maxzoom);if(c[O[0].key]&&c[O[1].key]&&c[O[2].key]&&c[O[3].key])continue}let B=L.wasRequested();for(let O=D.overscaledZ-1;O>=b;--O){const U=D.scaledTo(O);if(p[U.key]||(p[U.key]=!0,L=this.getTile(U),!L&&B&&(L=this._addTile(U)),L&&(c[U.key]=U,B=L.wasRequested(),L.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const c=[];let p,y=this._tiles[r].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}c.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;y=x}for(const x of c)this._loadedParentTiles[x]=p}}_addTile(r){let c=this._tiles[r.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),c;c=this._cache.getAndRemove(r),c&&(this._setTileReloadTimer(r.key,c),c.tileID=r,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,c)));const p=!!c;if(!p){const y=this.map?this.map.painter:null,x=this._source.tileSize*r.overscaleFactor();c=this._source.type==="raster-array"?new zl(r,x,this.transform.tileZoom,y,this._isRaster):new Sa(r,x,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,r.key,c.state))}return c.uses++,this._tiles[r.key]=c,p||this._source.fire(new o.A("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(r,c){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=c.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const c=this._tiles[r];c&&(c.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,c,p){const y=[],x=this.transform;if(!x)return y;const b=x.projection.name==="globe",I=o.aD(x.center.lng);for(const A in this._tiles){const D=this._tiles[A];if(p&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(b){const B=D.tileID.canonical;if(B.z===0){const O=[Math.abs(o.ay(I,...ac(B,-1))-I),Math.abs(o.ay(I,...ac(B,1))-I)];L=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(o.ay(I,...ac(B,-1))-I),Math.abs(o.ay(I,...ac(B,0))-I),Math.abs(o.ay(I,...ac(B,1))-I)];L=[O.indexOf(Math.min(...O))-1]}}else L=[0];for(const B of L){const O=r.containsTile(D,x,c,B);O&&y.push(O)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,c){const p=this.getRenderableIds(r,c).map(x=>this._tiles[x].tileID),y=this.transform.projection.name==="globe";for(const x of p)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=y?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return p}sortCoordinatesByDistance(r){const c=r.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),x={};for(const b of c){const I=1/(1<<b.canonical.z);x[b.key]=((b.canonical.x+.5)*I+b.wrap-p[0])*y[0]+((b.canonical.y+.5)*I-p[1])*y[1]-p[2]*y[2]}return c.sort((b,I)=>x[b.key]-x[I.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(pl(this._source.type))for(const r in this._tiles){const c=this._tiles[r];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(r,c,p){this._state.updateState(r=r||"_geojsonTileLayer",c,p)}removeFeatureState(r,c,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",c,p)}getFeatureState(r,c){return this._state.getState(r=r||"_geojsonTileLayer",c)}setDependencies(r,c,p){const y=this._tiles[r];y&&y.setDependencies(c,p)}reloadTilesForDependencies(r,c){for(const p in this._tiles)this._tiles[p].hasDependency(r,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(r,c))}_preloadTiles(r,c){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(r,c))};return void this._source.on("data",A)}const p=new Map,y=Array.isArray(r)?r:[r],x=this.map.painter.terrain,b=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const A of y){const D=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of D)p.set(L.key,L);this.usedForTerrain&&A.updateElevation(!1)}const I=Array.from(p.values());o.bt(I,(A,D)=>{const L=new Sa(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,B=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),D(B,L)})},c)}}function ro(f,r){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return f.overscaledZ-r.overscaledZ||p-c||r.canonical.y-f.canonical.y||r.canonical.x-f.canonical.x}function pl(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function ac(f,r){const c=1<<f.z;return[f.x/c+r,(f.x+1)/c+r]}Is.maxOverzooming=10,Is.maxUnderzooming=3;class uf{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,c=!1;for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:r,visibilityChanged:c});else if(y.type==="model"){const x=this.style.getLayerSource(y);x&&x.type==="batched-model"&&this.layers.push({layer:y,visible:r,visibilityChanged:c})}}}onNewFrame(r){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let y=!1;p.type==="fill-extrusion"?y=!p.isHidden(r)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?y=!p.isHidden(r)&&p.paint.get("building-opacity")>0:p.type==="model"&&(y=!p.isHidden(r)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&c.visible,c.visible=y}}updateZOffset(r,c){this.currentBuildingBuckets=[];for(const y of this.layers){const x=y.layer,b=this.style.getLayerSourceCache(x);let I=1;x.type==="fill-extrusion"?I=y.visible?x.paint.get("fill-extrusion-vertical-scale"):0:x.type==="building"&&(I=y.visible?x.paint.get("building-vertical-scale"):0);let A=b?b.getTile(c):null;if(!A&&b)for(const D in b._tiles){const L=b._tiles[D];if(c.canonical.isChildOf(L.tileID.canonical)){A=L;break}}this.currentBuildingBuckets.push({bucket:A?A.getBucket(x):null,tileID:A?A.tileID:c,verticalScale:I})}r.hasAnyZOffset=!1;let p=!1;for(let y=0;y<r.symbolInstances.length;y++){const x=r.symbolInstances.get(y),b=x.zOffset,I=this._getHeightAtTileOffset(c,x.tileAnchorX,x.tileAnchorY);x.zOffset=I!==Number.NEGATIVE_INFINITY?I:b,p||b===x.zOffset||(p=!0),r.hasAnyZOffset||x.zOffset===0||(r.hasAnyZOffset=!0)}p&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,c,p,y){let x=c,b=p;if(r.canonical.z!==y.canonical.z){const I=y.canonical,A=1/(1<<r.canonical.z-I.z);x=(c+r.canonical.x*o.aj)*A-I.x*o.aj|0,b=(p+r.canonical.y*o.aj)*A-I.y*o.aj|0}return{tileX:x,tileY:b}}_getHeightAtTileOffset(r,c,p){let y,x;for(let b=0;b<this.layers.length;++b){const I=this.layers[b].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:A,tileID:D,verticalScale:L}=this.currentBuildingBuckets[b];if(!A)continue;const{tileX:B,tileY:O}=this._mapCoordToOverlappingTile(r,c,p,D),U=A.getHeightAtTileCoord(B,O);U&&U.height!==void 0&&(U.hidden?y=U.height:x=Math.max(U.height*L,x||0))}if(x!==void 0)return x;for(let b=0;b<this.layers.length;++b){const I=this.layers[b];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:A,tileID:D}=this.currentBuildingBuckets[b];if(!A)continue;const{tileX:L,tileY:B}=this._mapCoordToOverlappingTile(r,c,p,D),O=A.getHeightAtTileCoord(L,B);if(O&&!O.hidden)return O.height===void 0&&y!==void 0?Math.min(O.maxHeight,y)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function lc(f,r){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return o.bu.forEach(p=>{p in r&&(c[p]=r[p])}),c}function Cu(f){f=f.slice();const r=Object.create(null);for(let c=0;c<f.length;c++)r[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=lc(f[c],r[f[c].ref]));return f}const _i={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ah(f,r,c){c.push({command:_i.addSource,args:[f,r[f]]})}function Wo(f,r,c){r.push({command:_i.removeSource,args:[f]}),c[f]=!0}function Pu(f,r,c,p){Wo(f,c,p),Ah(f,r,c)}function c_(f,r,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!o.bv(f[c][p],r[c][p]))return!1;for(p in r[c])if(r[c].hasOwnProperty(p)&&p!=="data"&&!o.bv(f[c][p],r[c][p]))return!1;return!0}function Fl(f,r,c,p,y,x){let b;for(b in r=r||{},f=f||{})f.hasOwnProperty(b)&&(o.bv(f[b],r[b])||c.push({command:x,args:[p,b,r[b],y]}));for(b in r)r.hasOwnProperty(b)&&!f.hasOwnProperty(b)&&(o.bv(f[b],r[b])||c.push({command:x,args:[p,b,r[b],y]}))}function Ga(f){return f.id}function ml(f,r){return f[r.id]=r,f}function gl(f,r,c){const p=r.createTileMatrix(f,f.worldSize,c.toUnwrapped());return o.az(new Float32Array(16),f.projMatrix,p)}function Fc(f,r,c){if(r.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(r.projection),gl(p,r.getProjection(),f)}function Ru(f,r,c){return r.name===c.projection.name?f.projMatrix:gl(c,r,f)}class Ch{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.ay(r,0,1);let c=1,p=this._distances[c];const y=r*this.paddedLength+this.padding;for(;p<y&&c<this._distances.length;)p=this._distances[++c];const x=c-1,b=this._distances[x],I=p-b,A=I>0?(y-b)/I:0;return this.points[x].mult(1-A).add(this.points[c].mult(A))}}class $r{constructor(r,c,p){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(c/p);for(let b=0;b<this.xCellCount*this.yCellCount;b++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,p,y,x){this._forEachCell(c,p,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(r,c,p,y){this._forEachCell(c-y,p-y,c+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(p),this.circles.push(y)}_insertBoxCell(r,c,p,y,x,b){this.boxCells[x].push(b)}_insertCircleCell(r,c,p,y,x,b){this.circleCells[x].push(b)}_query(r,c,p,y,x,b){if(p<0||r>this.width||y<0||c>this.height)return!x&&[];const I=[];if(r<=0&&c<=0&&this.width<=p&&this.height<=y){if(x)return!0;for(let A=0;A<this.boxKeys.length;A++)I.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const D=this.circles[3*A],L=this.circles[3*A+1],B=this.circles[3*A+2];I.push({key:this.circleKeys[A],x1:D-B,y1:L-B,x2:D+B,y2:L+B})}return b?I.filter(b):I}return this._forEachCell(r,c,p,y,this._queryCell,I,{hitTest:x,seenUids:{box:{},circle:{}}},b),x?I.length>0:I}_queryCircle(r,c,p,y,x){const b=r-p,I=r+p,A=c-p,D=c+p;if(I<0||b>this.width||D<0||A>this.height)return!y&&[];const L=[];return this._forEachCell(b,A,I,D,this._queryCellCircle,L,{hitTest:y,circle:{x:r,y:c,radius:p},seenUids:{box:{},circle:{}}},x),y?L.length>0:L}query(r,c,p,y,x){return this._query(r,c,p,y,!1,x)}hitTest(r,c,p,y,x){return this._query(r,c,p,y,!0,x)}hitTestCircle(r,c,p,y){return this._queryCircle(r,c,p,!0,y)}_queryCell(r,c,p,y,x,b,I,A){const D=I.seenUids,L=this.boxCells[x];if(L!==null){const O=this.bboxes;for(const U of L)if(!D.box[U]){D.box[U]=!0;const q=4*U;if(r<=O[q+2]&&c<=O[q+3]&&p>=O[q+0]&&y>=O[q+1]&&(!A||A(this.boxKeys[U]))){if(I.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[U],x1:O[q],y1:O[q+1],x2:O[q+2],y2:O[q+3]})}}}const B=this.circleCells[x];if(B!==null){const O=this.circles;for(const U of B)if(!D.circle[U]){D.circle[U]=!0;const q=3*U;if(this._circleAndRectCollide(O[q],O[q+1],O[q+2],r,c,p,y)&&(!A||A(this.circleKeys[U]))){if(I.hitTest)return b.push(!0),!0;{const $=O[q],X=O[q+1],Z=O[q+2];b.push({key:this.circleKeys[U],x1:$-Z,y1:X-Z,x2:$+Z,y2:X+Z})}}}}}_queryCellCircle(r,c,p,y,x,b,I,A){const D=I.circle,L=I.seenUids,B=this.boxCells[x];if(B!==null){const U=this.bboxes;for(const q of B)if(!L.box[q]){L.box[q]=!0;const $=4*q;if(this._circleAndRectCollide(D.x,D.y,D.radius,U[$+0],U[$+1],U[$+2],U[$+3])&&(!A||A(this.boxKeys[q])))return b.push(!0),!0}}const O=this.circleCells[x];if(O!==null){const U=this.circles;for(const q of O)if(!L.circle[q]){L.circle[q]=!0;const $=3*q;if(this._circlesCollide(U[$],U[$+1],U[$+2],D.x,D.y,D.radius)&&(!A||A(this.circleKeys[q])))return b.push(!0),!0}}}_forEachCell(r,c,p,y,x,b,I,A){const D=this._convertToXCellCoord(r),L=this._convertToYCellCoord(c),B=this._convertToXCellCoord(p),O=this._convertToYCellCoord(y);for(let U=D;U<=B;U++)for(let q=L;q<=O;q++)if(x.call(this,r,c,p,y,this.xCellCount*q+U,b,I,A))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,p,y,x,b){const I=y-r,A=x-c,D=p+b;return D*D>I*I+A*A}_circleAndRectCollide(r,c,p,y,x,b,I){const A=(b-y)/2,D=Math.abs(r-(y+A));if(D>A+p)return!1;const L=(I-x)/2,B=Math.abs(c-(x+L));if(B>L+p)return!1;if(D<=A||B<=L)return!0;const O=D-A,U=B-L;return O*O+U*U<=p*p}}const cc={unknown:0,flipRequired:1,flipNotRequired:2},Rp=Math.tan(85*Math.PI/180);function Nc(f,r,c,p,y,x,b){const I=o.bz();if(c)if(x.name==="globe"){const A=o.bA(y,r);o.az(I,I,A)}else{const A=o.bB([],b);I[0]=A[0],I[1]=A[1],I[4]=A[2],I[5]=A[3],p||o.by(I,I,y.angle)}else o.az(I,y.labelPlaneMatrix,f);return I}function uc(f,r,c,p,y,x,b){const I=Nc(f,r,c,p,y,x,b);return x.name==="globe"&&c||(I[2]=I[6]=I[10]=I[14]=0),I}function $a(f,r,c,p,y,x,b){if(c){if(x.name==="globe"){const I=Nc(f,r,c,p,y,x,b);return o.bi(I,I),o.az(I,f,I),I}{const I=o.bw(f),A=o.bx([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],o.az(I,I,A),p||o.by(I,I,-y.angle),I}}return y.glCoordMatrix}function so(f,r,c,p){const y=[f,r,c,1];c?o.aA(y,y,p):kp(y,y,p);const x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function Ph(f,r){return Math.min(.5+f/r*.5,1.5)}function Aa(f,r){const c=f[0]/f[3],p=f[1]/f[3];return c>=-r[0]&&c<=r[0]&&p>=-r[1]&&p<=r[1]}function Nl(f,r,c,p,y,x,b,I,A,D){const L=c.transform,B=p?f.textSizeData:f.iconSizeData,O=o.bH(B,c.transform.zoom),U=L.projection.name==="globe",q=[256/c.width*2+1,256/c.height*2+1],$=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;$.clear();let X=null;U&&(X=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const Z=f.lineVertexArray,te=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,re=c.transform.width/c.transform.height;let ae,fe=!1;for(let be=0;be<te.length;be++){const Ee=te.get(be),{numGlyphs:pe,writingMode:_e}=Ee;if(_e!==o.bI.vertical||fe||ae===o.bI.horizontal||(fe=!0),ae=_e,(Ee.hidden||_e===o.bI.vertical)&&!fe){_l(pe,$);continue}fe=!1;const ve=new o.P(Ee.tileAnchorX,Ee.tileAnchorY);let{x:We,y:Le,z:lt}=L.projection.projectTilePoint(ve.x,ve.y,D.canonical);if(A){const[tn,dn,qt]=A(ve);We+=tn,Le+=dn,lt+=qt}const Ye=[We,Le,lt,1];if(o.aA(Ye,Ye,r),!Aa(Ye,q)){_l(pe,$);continue}const ft=Ye[3],kt=Ph(c.transform.getCameraToCenterDistance(L.projection),ft),Ze=o.bJ(B,O,Ee),Ce=b?Ze/kt:Ze*kt,rt=so(We,Le,lt,y);if(rt[3]<=0){_l(pe,$);continue}let Ke={};const xt=o.al(f.layers[0].layout.get("text-max-angle")),wt=Math.cos(xt),Et=b?null:A,Nt=ku(Ee,Ce,!1,I,r,y,x,f.glyphOffsetArray,Z,$,X,rt,ve,Ke,re,Et,L.projection,D,b,wt);fe=Nt.useVertical,Et&&Nt.needsFlipping&&(Ke={}),(Nt.notEnoughRoom||fe||Nt.needsFlipping&&ku(Ee,Ce,!0,I,r,y,x,f.glyphOffsetArray,Z,$,X,rt,ve,Ke,re,Et,L.projection,D,b,wt).notEnoughRoom)&&_l(pe,$)}p?(f.text.dynamicLayoutVertexBuffer.updateData($),X&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(X)):(f.icon.dynamicLayoutVertexBuffer.updateData($),X&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(X))}function Oo(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X){const{lineStartIndex:Z,glyphStartIndex:te,segment:re}=I,ae=te+I.numGlyphs,fe=Z+I.lineLength,be=r.getoffsetX(te),Ee=r.getoffsetX(ae-1),pe=Bc(f*be,c,p,y,x,b,re,Z,fe,A,D,L,B,O,!0,U,q,$,X);if(!pe)return null;const _e=Bc(f*Ee,c,p,y,x,b,re,Z,fe,A,D,L,B,O,!0,U,q,$,X);return _e?{first:pe,last:_e}:null}function hc(f,r,c,p){return f===o.bI.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===o.bI.vertical?p>0?{needsFlipping:!0}:null:r!==cc.unknown&&function(y,x){return y===0||Math.abs(x/y)>Rp}(c,p)?r===cc.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function ku(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z,te,re){const ae=r/24,fe=f.lineOffsetX*ae,be=f.lineOffsetY*ae,{lineStartIndex:Ee,glyphStartIndex:pe,numGlyphs:_e,segment:ve,writingMode:We,flipState:Le}=f,lt=Ee+f.lineLength,Ye=ft=>{if(L){const[rt,Ke,xt]=ft.up,wt=D.length;o.bK(L,wt+0,rt,Ke,xt),o.bK(L,wt+1,rt,Ke,xt),o.bK(L,wt+2,rt,Ke,xt),o.bK(L,wt+3,rt,Ke,xt)}const[kt,Ze,Ce]=ft.point;o.bL(D,kt,Ze,Ce,ft.angle)};if(_e>1){const ft=Oo(ae,I,fe,be,c,B,O,f,A,x,U,$,!1,X,Z,te,re);if(!ft)return{notEnoughRoom:!0};if(p&&!c){let[kt,Ze,Ce]=ft.first.point,[rt,Ke,xt]=ft.last.point;[kt,Ze]=so(kt,Ze,Ce,b),[rt,Ke]=so(rt,Ke,xt,b);const wt=hc(We,Le,(rt-kt)*q,Ke-Ze);if(f.flipState=wt&&wt.needsFlipping?cc.flipRequired:cc.flipNotRequired,wt)return wt}Ye(ft.first);for(let kt=pe+1;kt<pe+_e-1;kt++){const Ze=Bc(ae*I.getoffsetX(kt),fe,be,c,B,O,ve,Ee,lt,A,x,U,$,!1,!1,X,Z,te,re);if(!Ze)return D.length-=4*(kt-pe),{notEnoughRoom:!0};Ye(Ze)}Ye(ft.last)}else{if(p&&!c){const kt=so(O.x,O.y,0,y),Ze=Ee+ve+1,Ce=new o.P(A.getx(Ze),A.gety(Ze)),rt=so(Ce.x,Ce.y,0,y),Ke=rt[3]>0?rt:wi(O,Ce,kt,1,y,void 0,X,Z.canonical),xt=hc(We,Le,(Ke[0]-kt[0])*q,Ke[1]-kt[1]);if(f.flipState=xt&&xt.needsFlipping?cc.flipRequired:cc.flipNotRequired,xt)return xt}const ft=Bc(ae*I.getoffsetX(pe),fe,be,c,B,O,ve,Ee,lt,A,x,U,$,!1,!1,X,Z,te,re);if(!ft)return{notEnoughRoom:!0};Ye(ft)}return{}}function Mu(f,r,c,p,y){const{x,y:b,z:I}=p.projectTilePoint(f.x,f.y,r);if(!y)return so(x,b,I,c);const[A,D,L]=y(f);return so(x+A,b+D,I+L,c)}function wi(f,r,c,p,y,x,b,I){const A=Mu(f.sub(r)._unit()._add(f),I,y,b,x);return o.at(A,c,A),o.au(A,A),o.bE(A,c,A,p)}function Bc(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z,te){const re=p?f-r:f+r;let ae=re>0?1:-1,fe=0;p&&(ae*=-1,fe=Math.PI),ae<0&&(fe+=Math.PI);let be=I+b+(ae>0?0:1)|0,Ee=y,pe=y,_e=0,ve=0;const We=Math.abs(re),Le=[],lt=[];let Ye=x,ft=Ye,kt=o.bC([]);const Ze=()=>wi(ft,Ye,pe,We-_e+1,L,O,$,X.canonical);for(;_e+ve<=We;){if(be+=ae,be<I||be>=A)return null;if(pe=Ee,ft=Ye,Le.push(pe),U&&lt.push(ft),Ye=new o.P(D.getx(be),D.gety(be)),Ee=B[be],!Ee){const qt=Mu(Ye,X.canonical,L,$,O);Ee=qt[3]>0?B[be]=qt:Ze()}_e+=ve;const tn=o.at([],Ee,pe),dn=o.bD(pe,Ee);if(c&&dn>0&&ve>0&&o.bG(kt,tn)/(ve*dn)<te)return null;ve=dn,kt=tn}q&&O&&(B[be]&&(Ee=Ze(),ve=o.bD(pe,Ee),kt=o.at([],Ee,pe)),B[be]=Ee);const Ce=(We-_e)/ve,rt=Ye.sub(ft)._mult(Ce)._add(ft),Ke=o.bE([],pe,kt,Ce);let xt=[0,0,1],wt=kt[0],Et=kt[1];if(Z&&(xt=$.upVector(X.canonical,rt.x,rt.y),xt[0]!==0||xt[1]!==0||xt[2]!==1)){const tn=[xt[2],0,-xt[0]],dn=o.bF([],xt,tn);o.au(tn,tn),o.au(dn,dn),wt=o.bG(kt,tn),Et=o.bG(kt,dn)}if(c){const tn=o.bF([],xt,kt);o.au(tn,tn),o.bE(Ke,Ke,tn,c*ae)}const Nt=fe+Math.atan2(Et,wt);return Le.push(Ke),U&&lt.push(rt),{point:Ke,angle:Nt,path:Le,tilePath:lt,up:xt}}function _l(f,r){const c=r.length,p=c+4*f;r.resize(p),r.float32.fill(-1/0,4*c,4*p)}function kp(f,r,c){const p=r[0],y=r[1];return f[0]=c[0]*p+c[4]*y+c[12],f[1]=c[1]*p+c[5]*y+c[13],f[3]=c[3]*p+c[7]*y+c[15],f}const gn=100;class Vc{constructor(r,c,p=new $r(r.width+200,r.height+200,25),y=new $r(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+gn,this.screenBottomBoundary=r.height+gn,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,p,y,x,b,I,A,D,L,B){let O=p.projectedAnchorX,U=p.projectedAnchorY,q=p.projectedAnchorZ;const $=p.tileAnchorX,X=p.tileAnchorY,Z=p.elevation,te=p.tileID,re=r.getProjection();if(Z&&te){const[lt,Ye,ft]=re.upVector(te.canonical,p.tileAnchorX,p.tileAnchorY),kt=re.upVectorScale(te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=lt*Z*kt,U+=Ye*Z*kt,q+=ft*Z*kt}const ae=r.projection.name==="globe",fe=r.projection.name==="globe"?o.ah(this.transform.zoom):0;if(te&&ae&&fe<1&&!b){const lt=1<<te.canonical.z,Ye=o.bM($,X);o.bN(Ye,Ye,1/o.aj),o.bO(Ye,Ye,o.bM(te.canonical.x,te.canonical.y)),o.bN(Ye,Ye,1/lt),o.bP(Ye,Ye,o.bM(y[0],y[1])),Ye[0]=o.bQ(Ye[0],-.5,.5),o.bN(Ye,Ye,o.aj);const ft=o.bR(Ye[0],Ye[1],o.aj/(2*Math.PI),1);o.aA(ft,ft,x),O=o.ai(O,ft[0],fe),U=o.ai(U,ft[1],fe),q=o.ai(q,ft[2],fe)}const be=this.projectAndGetPerspectiveRatio(L,O,U,q,p.tileID,re.name==="globe"||!!Z||this.transform.pitch>0,re),Ee=D*be.perspectiveRatio,pe=(p.x1*c+I.x-p.padding)*Ee+be.point.x,_e=(p.y1*c+I.y-p.padding)*Ee+be.point.y,ve=(p.x2*c+I.x+p.padding)*Ee+be.point.x,We=(p.y2*c+I.y+p.padding)*Ee+be.point.y,Le=be.perspectiveRatio<=.55||be.occluded;return!this.isInsideGrid(pe,_e,ve,We)||!A&&this.grid.hitTest(pe,_e,ve,We,B)||Le?{box:[],offscreen:!1,occluded:be.occluded}:{box:[pe,_e,ve,We],offscreen:this.isOffscreen(pe,_e,ve,We),occluded:!1}}placeCollisionCircles(r,c,p,y,x,b,I,A,D,L,B,O,U,q,$){const X=[],Z=this.transform.elevation,te=r.getProjection(),re=Z?Z.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,te):null,ae=new o.P(p.tileAnchorX,p.tileAnchorY);let{x:fe,y:be,z:Ee}=te.projectTilePoint(ae.x,ae.y,$.canonical);if(re){const[xt,wt,Et]=re(ae);fe+=xt,be+=wt,Ee+=Et}const pe=te.name==="globe",_e=this.projectAndGetPerspectiveRatio(I,fe,be,Ee,$,pe||!!Z||this.transform.pitch>0,te),{perspectiveRatio:ve}=_e,We=(B?b/ve:b*ve)/o.bU,Le=so(fe,be,Ee,A),lt=p.lineOffsetX*We,Ye=p.lineOffsetY*We,ft=o.al(r.layers[0].layout.get("text-max-angle")),kt=Math.cos(ft),Ze=_e.signedDistanceFromCamera>0?Oo(We,x,lt,Ye,!1,Le,ae,p,y,A,{},Z&&!B?re:null,B&&!!Z,te,$,B,kt):null;let Ce=!1,rt=!1,Ke=!0;if(Ze&&!_e.occluded){const xt=.5*U*ve+q,wt=new o.P(-100,-100),Et=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new Ch,{first:tn,last:dn}=Ze,qt=tn.path.length;let hn=[];for(let Fn=qt-1;Fn>=1;Fn--)hn.push(tn.path[Fn]);for(let Fn=1;Fn<dn.path.length;Fn++)hn.push(dn.path[Fn]);const an=2.5*xt;D&&(hn=hn.map(([Fn,ei,bi],Dn)=>(re&&!pe&&(bi=re(Dn<qt-1?tn.tilePath[qt-1-Dn]:dn.tilePath[Dn-qt+2])[2]),so(Fn,ei,bi,D))),hn.some(Fn=>Fn[3]<=0)&&(hn=[]));let Rn=[];if(hn.length>0){let Fn=1/0,ei=-1/0,bi=1/0,Dn=-1/0;for(const Ti of hn)Fn=Math.min(Fn,Ti[0]),bi=Math.min(bi,Ti[1]),ei=Math.max(ei,Ti[0]),Dn=Math.max(Dn,Ti[1]);ei>=wt.x&&Fn<=Et.x&&Dn>=wt.y&&bi<=Et.y&&(Rn=[hn.map(Ti=>new o.P(Ti[0],Ti[1]))],(Fn<wt.x||ei>Et.x||bi<wt.y||Dn>Et.y)&&(Rn=o.bS(Rn,wt.x,wt.y,Et.x,Et.y)))}for(const Fn of Rn){Nt.reset(Fn,.25*xt);let ei=0;ei=Nt.length<=.5*xt?1:Math.ceil(Nt.paddedLength/an)+1;for(let bi=0;bi<ei;bi++){const Dn=bi/Math.max(ei-1,1),Ti=Nt.lerp(Dn),Ri=Ti.x+gn,nr=Ti.y+gn;X.push(Ri,nr,xt,0);const Kn=Ri-xt,Ei=nr-xt,Ci=Ri+xt,Mi=nr+xt;if(Ke=Ke&&this.isOffscreen(Kn,Ei,Ci,Mi),rt=rt||this.isInsideGrid(Kn,Ei,Ci,Mi),!c&&this.grid.hitTestCircle(Ri,nr,xt,O)&&(Ce=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ce,occluded:!1}}}}return{circles:!L&&Ce||!rt?[]:X,offscreen:Ke,collisionDetected:Ce,occluded:_e.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,y=1/0,x=-1/0,b=-1/0;for(const L of r){const B=new o.P(L.x+gn,L.y+gn);p=Math.min(p,B.x),y=Math.min(y,B.y),x=Math.max(x,B.x),b=Math.max(b,B.y),c.push(B)}const I=this.grid.query(p,y,x,b).concat(this.ignoredGrid.query(p,y,x,b)),A={},D={};for(const L of I){const B=L.key;if(A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]={}),A[B.bucketInstanceId][B.featureIndex])continue;const O=[new o.P(L.x1,L.y1),new o.P(L.x2,L.y1),new o.P(L.x2,L.y2),new o.P(L.x1,L.y2)];o.bT(c,O)&&(A[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(r,c,p,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,p,y,x){const b=c?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:y,collisionGroupID:x};for(let A=0;A<r.length;A+=4)b.insertCircle(I,r[A],r[A+1],r[A+2])}projectAndGetPerspectiveRatio(r,c,p,y,x,b,I){const A=[c,p,y,1];let D=!1;y||this.transform.pitch>0?(o.aA(A,A,r),this.fogState&&x&&I.name!=="globe"&&(D=function(O,U,q,$,X,Z){const te=Z.calculateFogTileMatrix(X),re=[U,q,$];return o.ad(re,re,te),sn(O,o.ae(re),Z.pitch,Z._fov)}(this.fogState,c,p,y,x.toUnwrapped(),this.transform)>.9)):kp(A,A,r);const L=A[3];return{point:new o.P((A[0]/L+1)/2*this.transform.width+gn,(-A[1]/L+1)/2*this.transform.height+gn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/L*.5,1.5),signedDistanceFromCamera:L,occluded:b&&A[2]>L||D}}isOffscreen(r,c,p,y){return p<gn||r>=this.screenRightBoundary||y<gn||c>this.screenBottomBoundary}isInsideGrid(r,c,p,y){return p>=0&&r<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=o.bx([]);return o.bo(r,r,[-100,-100,0]),r}}class Uc{constructor(r,c,p,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Bl{constructor(r,c,p,y,x,b=!1){this.text=new Uc(r?r.text:null,c,p,x),this.icon=new Uc(r?r.icon:null,c,y,x),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xo{constructor(r,c,p,y=!1){this.text=r,this.icon=c,this.skipFade=p,this.clipped=y}}class Du{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class dc{constructor(r,c,p,y,x){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=x}}class on{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[r]}}function Si(f,r,c,p,y){const{horizontalAlign:x,verticalAlign:b}=o.bZ(f),I=-(x-.5)*r,A=-(b-.5)*c,D=o.b_(f,p);return new o.P(I+D[0]*y,A+D[1]*y)}function Ai(f,r,c,p,y){const x=new o.P(f,r);return c&&x._rotate(p?y:-y),x}class zs{constructor(r,c,p,y,x,b){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Vc(this.transform,x),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new on(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,p,y,x=1){const b=p.getBucket(c),I=p.latestFeatureIndex;if(!b||!I||c.fqid!==b.layerIds[0])return;const A=b.layers[0].layout,D=b.layers[0].paint,L=p.collisionBoxArray,B=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),O=p.tileSize/o.aj,U=p.tileID.toUnwrapped();this.transform.setProjection(b.projection);const q=($=p.tileID,X=b.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix($.toUnwrapped()):gl(Z,X,$));var $,X,Z;const te=A.get("text-pitch-alignment")==="map",re=A.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const ae=c.dynamicFilter(),fe=c.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(p),Ee=uc(q,p.tileID.canonical,te,re,this.transform,b.getProjection(),be);let pe=null;const _e=b.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(te){const Ce=$a(q,p.tileID.canonical,te,re,this.transform,b.getProjection(),be);pe=o.az([],this.transform.labelPlaneMatrix,Ce)}let ve=null;ae&&p.latestFeatureIndex&&(ve={unwrappedTileID:U,dynamicFilter:ae,dynamicFilterNeedsFeature:fe}),this.retainedQueryData[b.bucketInstanceId]=new dc(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,p.tileID);const[We,Le]=b.layers[0].layout.get("text-size-scale-range"),lt=o.ay(x,We,Le),[Ye,ft]=A.get("icon-size-scale-range"),kt=o.ay(x,Ye,ft),Ze={bucket:b,layout:A,paint:D,posMatrix:q,invMatrix:_e,mercatorCenter:[o.aD(this.transform.center.lng),o.aH(this.transform.center.lat)],textLabelPlaneMatrix:Ee,labelToScreenMatrix:pe,clippingData:ve,scale:B,textPixelRatio:O,holdingForFade:p.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:o.bH(b.textSizeData,this.transform.zoom,lt),partiallyEvaluatedIconSize:o.bH(b.iconSizeData,this.transform.zoom,kt),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const Ce of b.sortKeyRanges){const{sortKey:rt,symbolInstanceStart:Ke,symbolInstanceEnd:xt}=Ce;r.push({sortKey:rt,symbolInstanceStart:Ke,symbolInstanceEnd:xt,parameters:Ze})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z,te,re,ae,fe){const{textOffset0:be,textOffset1:Ee,crossTileID:pe}=$,_e=[be,Ee],ve=Si(r,b,I,_e,A),We=this.collisionIndex.placeCollisionBox(Z,A,c,p,y,x,Ai(ve.x,ve.y,D,L,this.transform.angle),q,B,O,U.predicate);if(re){const Le=Z.getSymbolInstanceIconSize(fe,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,Le,re,p,y,x,Ai(ve.x,ve.y,D,L,this.transform.angle),q,B,O,U.predicate).box.length===0)return}if(We.box.length>0){let Le;return this.prevPlacement&&this.prevPlacement.variableOffsets[pe]&&this.prevPlacement.placements[pe]&&this.prevPlacement.placements[pe].text&&(Le=this.prevPlacement.variableOffsets[pe].anchor),this.variableOffsets[pe]={textOffset:_e,width:b,height:I,anchor:r,textScale:A,prevAnchor:Le},this.markUsedJustification(Z,r,$,te),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,te,$),this.placedOrientations[pe]=te),{shift:ve,placedGlyphBoxes:We}}}placeLayerBucketPart(r,c,p,y,x=1){const{bucket:b,layout:I,paint:A,posMatrix:D,textLabelPlaneMatrix:L,labelToScreenMatrix:B,clippingData:O,textPixelRatio:U,mercatorCenter:q,invMatrix:$,holdingForFade:X,collisionBoxArray:Z,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:re,collisionGroup:ae,latestFeatureIndex:fe}=r.parameters,be=I.get("text-optional"),Ee=I.get("icon-optional"),pe=I.get("text-allow-overlap"),_e=I.get("icon-allow-overlap"),ve=I.get("text-rotation-alignment")==="map",We=I.get("icon-rotation-alignment")==="map",Le=I.get("text-pitch-alignment")==="map",lt=A.get("symbol-z-offset"),Ye=I.get("symbol-elevation-reference")==="sea",ft=I.get("symbol-placement"),[kt,Ze]=I.get("text-size-scale-range"),[Ce,rt]=I.get("icon-size-scale-range"),Ke=o.ay(x,kt,Ze),xt=o.ay(x,Ce,rt),wt=I.get("text-variable-anchor"),Et=ve&&ft!=="point",Nt=We&&ft!=="point",tn=wt&&b.hasTextData(),dn=b.hasIconTextFit()&&tn&&b.hasIconData();this.transform.setProjection(b.projection);const qt=tn||Et,hn=Nt||dn;let an=pe&&(_e||!b.hasIconData()||Ee),Rn=_e&&(pe||!b.hasTextData()||be);const Fn=!lt.isConstant();!b.collisionArrays&&Z&&b.deserializeCollisionBoxes(Z),p&&y&&b.updateCollisionDebugBuffers(this.transform.zoom,Z,Ke,xt);const ei=(Dn,Ti,Ri)=>{const{crossTileID:nr,numVerticalGlyphVertices:Kn}=Dn;let Ei=null;if(O&&O.dynamicFilterNeedsFeature||Fn){const qr=this.retainedQueryData[b.bucketInstanceId];Ei=fe.loadFeature({featureIndex:Dn.featureIndex,bucketIndex:qr.bucketIndex,sourceLayerIndex:qr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ei,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new o.P(Dn.tileAnchorX,Dn.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[nr]=new xo(!1,!1,!1,!0),void c.add(nr);const Ci=lt.evaluate(Ei,{});if(c.has(nr))return;if(X)return void(this.placements[nr]=new xo(!1,!1,!1));let Mi=!1,ti=!1,$i=!0,ki=!1,Pr=!1,xi=null,Di={box:null,offscreen:null,occluded:null},Qi={box:null},ns=null,Yr=null,os=null,Zs=0,xl=0,Bo=0;Ri.textFeatureIndex?Zs=Ri.textFeatureIndex:Dn.useRuntimeCollisionCircles&&(Zs=Dn.featureIndex),Ri.verticalTextFeatureIndex&&(xl=Ri.verticalTextFeatureIndex);const aa=qr=>{qr.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Nr=this.transform.elevation;qr.elevation=Ye?Ci:Ci+(Nr?Nr.getAtTileOffset(qr.tileID,qr.tileAnchorX,qr.tileAnchorY):0),qr.elevation+=Dn.zOffset},oo=Ri.textBox;if(oo){aa(oo);const qr=ir=>{let ps=o.bI.horizontal;if(b.allowVerticalPlacement&&!ir&&this.prevPlacement){const Xs=this.prevPlacement.placedOrientations[nr];Xs&&(this.placedOrientations[nr]=Xs,ps=Xs,this.markUsedOrientation(b,ps,Dn))}return ps},Nr=(ir,ps)=>{if(b.allowVerticalPlacement&&Kn>0&&Ri.verticalTextBox){for(const Xs of b.writingModes)if(Xs===o.bI.vertical?(Di=ps(),Qi=Di):Di=ir(),Di&&Di.box&&Di.box.length)break}else Di=ir()};if(wt){let ir=wt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[nr]){const Wr=this.prevPlacement.variableOffsets[nr];ir.indexOf(Wr.anchor)>0&&(ir=ir.filter(La=>La!==Wr.anchor),ir.unshift(Wr.anchor))}const ps=(Wr,La,qu)=>{const ou=b.getSymbolInstanceTextSize(te,Dn,this.transform.zoom,Ti),id=(Wr.x2-Wr.x1)*ou+2*Wr.padding,rd=(Wr.y2-Wr.y1)*ou+2*Wr.padding,Oa=Dn.hasIconTextFit&&!_e?La:null;Oa&&aa(Oa);let Wl={box:[],offscreen:!1,occluded:!1};const ms=pe?2*ir.length:ir.length;for(let za=0;za<ms;++za){const Wu=this.attemptAnchorPlacement(ir[za%ir.length],Wr,q,$,qt,id,rd,ou,ve,Le,U,D,ae,za>=ir.length,Dn,Ti,b,qu,Oa,te,re);if(Wu&&(Wl=Wu.placedGlyphBoxes,Wl&&Wl.box&&Wl.box.length)){Mi=!0,xi=Wu.shift;break}}return Wl};Nr(()=>ps(oo,Ri.iconBox,o.bI.horizontal),()=>{const Wr=Ri.verticalTextBox;return Wr&&aa(Wr),b.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&Kn>0&&Wr?ps(Wr,Ri.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),Di&&(Mi=Di.box,$i=Di.offscreen,ki=Di.occluded);const Xs=qr(!(!Di||!Di.box));if(!Mi&&this.prevPlacement){const Wr=this.prevPlacement.variableOffsets[nr];Wr&&(this.variableOffsets[nr]=Wr,this.markUsedJustification(b,Wr.anchor,Dn,Xs))}}else{const ir=(ps,Xs)=>{const Wr=b.getSymbolInstanceTextSize(te,Dn,this.transform.zoom,Ti,x),La=this.collisionIndex.placeCollisionBox(b,Wr,ps,q,$,qt,new o.P(0,0),pe,U,D,ae.predicate);return La&&La.box&&La.box.length&&(this.markUsedOrientation(b,Xs,Dn),this.placedOrientations[nr]=Xs),La};Nr(()=>ir(oo,o.bI.horizontal),()=>{const ps=Ri.verticalTextBox;return b.allowVerticalPlacement&&Kn>0&&ps?(aa(ps),ir(ps,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),qr(!!(Di&&Di.box&&Di.box.length))}}if(ns=Di,Mi=ns&&ns.box&&ns.box.length>0,$i=ns&&ns.offscreen,ki=ns&&ns.occluded,Dn.useRuntimeCollisionCircles){const qr=b.text.placedSymbolArray.get(Dn.centerJustifiedTextSymbolIndex>=0?Dn.centerJustifiedTextSymbolIndex:Dn.verticalPlacedTextSymbolIndex),Nr=o.bJ(b.textSizeData,te,qr),ir=I.get("text-padding");Yr=this.collisionIndex.placeCollisionCircles(b,pe,qr,b.lineVertexArray,b.glyphOffsetArray,Nr,D,L,B,p,Le,ae.predicate,Dn.collisionCircleDiameter*Nr/o.bU,ir,this.retainedQueryData[b.bucketInstanceId].tileID),Mi=pe||Yr.circles.length>0&&!Yr.collisionDetected,$i=$i&&Yr.offscreen,ki=Yr.occluded}if(Ri.iconFeatureIndex&&(Bo=Ri.iconFeatureIndex),Ri.iconBox){const qr=Nr=>{aa(Nr);const ir=Dn.hasIconTextFit&&xi?Ai(xi.x,xi.y,ve,Le,this.transform.angle):new o.P(0,0),ps=b.getSymbolInstanceIconSize(re,this.transform.zoom,Dn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,ps,Nr,q,$,hn,ir,_e,U,D,ae.predicate)};Qi&&Qi.box&&Qi.box.length&&Ri.verticalIconBox?(os=qr(Ri.verticalIconBox),ti=os.box.length>0):(os=qr(Ri.iconBox),ti=os.box.length>0),$i=$i&&os.offscreen,Pr=os.occluded}const Da=be||Dn.numHorizontalGlyphVertices===0&&Kn===0,Ya=Ee||Dn.numIconVertices===0;if(Da||Ya?Ya?Da||(ti=ti&&Mi):Mi=ti&&Mi:ti=Mi=ti&&Mi,Mi&&ns&&ns.box&&this.collisionIndex.insertCollisionBox(ns.box,I.get("text-ignore-placement"),b.bucketInstanceId,Qi&&Qi.box&&xl?xl:Zs,ae.ID),ti&&os&&this.collisionIndex.insertCollisionBox(os.box,I.get("icon-ignore-placement"),b.bucketInstanceId,Bo,ae.ID),Yr&&(Mi&&this.collisionIndex.insertCollisionCircles(Yr.circles,I.get("text-ignore-placement"),b.bucketInstanceId,Zs,ae.ID),p)){const qr=b.bucketInstanceId;let Nr=this.collisionCircleArrays[qr];Nr===void 0&&(Nr=this.collisionCircleArrays[qr]=new Du);for(let ir=0;ir<Yr.circles.length;ir+=4)Nr.circles.push(Yr.circles[ir+0]),Nr.circles.push(Yr.circles[ir+1]),Nr.circles.push(Yr.circles[ir+2]),Nr.circles.push(Yr.collisionDetected?1:0)}const ao=b.projection.name!=="globe";an=an&&(ao||!ki),Rn=Rn&&(ao||!Pr),this.placements[nr]=new xo(Mi||an,ti||Rn,$i||b.justReloaded),c.add(nr)},bi=this.retainedQueryData[b.bucketInstanceId].tileID;if(b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,bi),b.elevationType==="road"&&b.updateRoadElevation(bi.canonical),b.updateZOffset(),b.sortFeaturesByY){const Dn=b.getSortedSymbolIndexes(this.transform.angle);for(let Ti=Dn.length-1;Ti>=0;--Ti){const Ri=Dn[Ti];ei(b.symbolInstances.get(Ri),Ri,b.collisionArrays[Ri])}b.hasAnyZOffset&&o.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const Dn=b.getSortedIndexesByZOffset();for(let Ti=0;Ti<Dn.length;++Ti){const Ri=Dn[Ti];ei(b.symbolInstances.get(Ri),Ri,b.collisionArrays[Ri])}}else for(let Dn=r.symbolInstanceStart;Dn<r.symbolInstanceEnd;Dn++)ei(b.symbolInstances.get(Dn),Dn,b.collisionArrays[Dn]);if(p&&b.bucketInstanceId in this.collisionCircleArrays){const Dn=this.collisionCircleArrays[b.bucketInstanceId];o.bi(Dn.invProjMatrix,D),Dn.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(r,c,p,y){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:A,crossTileID:D}=p,L=o.b$(c),B=y===o.bI.vertical?A:L==="left"?x:L==="center"?b:L==="right"?I:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=B>=0&&x!==B?0:D),b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=B>=0&&b!==B?0:D),I>=0&&(r.text.placedSymbolArray.get(I).crossTileID=B>=0&&I!==B?0:D),A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=B>=0&&A!==B?0:D)}markUsedOrientation(r,c,p){const y=c===o.bI.horizontal||c===o.bI.horizontalOnly?c:0,x=c===o.bI.vertical?c:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:D}=p,L=r.text.placedSymbolArray;b>=0&&(L.get(b).placedOrientation=y),I>=0&&(L.get(I).placedOrientation=y),A>=0&&(L.get(A).placedOrientation=y),D>=0&&(L.get(D).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(r):1,x=c?c.opacities:{},b=c?c.variableOffsets:{},I=c?c.placedOrientations:{};for(const A in this.placements){const D=this.placements[A],L=x[A];L?(this.opacities[A]=new Bl(L,y,D.text,D.icon,null,D.clipped),p=p||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[A]=new Bl(null,y,D.text,D.icon,D.skipFade,D.clipped),p=p||D.text||D.icon)}for(const A in x){const D=x[A];if(!this.opacities[A]){const L=new Bl(D,y,!1,!1);L.isHidden()||(this.opacities[A]=L,p=p||D.text.placed||D.icon.placed)}}for(const A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(const A in I)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=I[A]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c,p,y){const x=new Set;for(const b of c){const I=b.getBucket(r);I&&b.latestFeatureIndex&&r.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,x,b,b.collisionBoxArray,p,y,b.tileID,r.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,b.tileID),I.elevationType==="road"&&I.updateRoadElevation(b.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(r,c,p,y,x,b,I,A){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const D=r.layers[0].layout,L=r.layers[0].paint,B=!!r.layers[0].dynamicFilter(),O=new Bl(null,0,!1,!1,!0),U=D.get("text-allow-overlap"),q=D.get("icon-allow-overlap"),$=D.get("text-variable-anchor"),X=D.get("text-rotation-alignment")==="map",Z=D.get("text-pitch-alignment")==="map",te=L.get("symbol-z-offset"),re=D.get("symbol-elevation-reference")==="sea",ae=!te.isConstant(),fe=new Bl(null,0,U&&(q||!r.hasIconData()||D.get("icon-optional")),q&&(U||!r.hasTextData()||D.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const be=(pe,_e,ve)=>{for(let We=0;We<_e/4;We++)pe.opacityVertexArray.emplaceBack(ve)};let Ee=0;b&&r.updateReplacement(I,b);for(let pe=0;pe<r.symbolInstances.length;pe++){const _e=r.symbolInstances.get(pe),{numHorizontalGlyphVertices:ve,numVerticalGlyphVertices:We,crossTileID:Le,numIconVertices:lt,tileAnchorX:Ye,tileAnchorY:ft}=_e;let kt=null;const Ze=this.retainedQueryData[r.bucketInstanceId];ae&&_e&&Ze&&(kt=p.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:Ze.bucketIndex,sourceLayerIndex:Ze.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ce=te.evaluate(kt,{}),rt=c.has(Le);let Ke=this.opacities[Le];rt?Ke=O:Ke||(Ke=fe,this.opacities[Le]=Ke),c.add(Le);const xt=ve>0||We>0,wt=lt>0,Et=this.placedOrientations[Le],Nt=Et===o.bI.vertical,tn=Et===o.bI.horizontal||Et===o.bI.horizontalOnly;!xt&&!wt||Ke.isHidden()||Ee++;let dn=!1;if((xt||wt)&&b)for(const qt of r.activeReplacements){if(o.bV(qt,x,o.bW.Symbol,A)||qt.min.x>Ye||Ye>qt.max.x||qt.min.y>ft||ft>qt.max.y)continue;const hn=o.bX(Ye,ft,I.canonical,qt.footprintTileId.canonical);if(dn=o.bY(hn,qt.footprint),dn)break}if(xt){const qt=dn?k:Ca(Ke.text);be(r.text,ve,Nt?k:qt),be(r.text,We,tn?k:qt);const hn=Ke.text.isHidden(),{leftJustifiedTextSymbolIndex:an,centerJustifiedTextSymbolIndex:Rn,rightJustifiedTextSymbolIndex:Fn,verticalPlacedTextSymbolIndex:ei}=_e,bi=r.text.placedSymbolArray,Dn=hn||Nt?1:0;an>=0&&(bi.get(an).hidden=Dn),Rn>=0&&(bi.get(Rn).hidden=Dn),Fn>=0&&(bi.get(Fn).hidden=Dn),ei>=0&&(bi.get(ei).hidden=hn||tn?1:0);const Ti=this.variableOffsets[Le];Ti&&this.markUsedJustification(r,Ti.anchor,_e,Et);const Ri=this.placedOrientations[Le];Ri&&(this.markUsedJustification(r,"left",_e,Ri),this.markUsedOrientation(r,Ri,_e))}if(wt){const qt=dn?k:Ca(Ke.icon),{placedIconSymbolIndex:hn,verticalPlacedIconSymbolIndex:an}=_e,Rn=r.icon.placedSymbolArray,Fn=Ke.icon.isHidden()?1:0;hn>=0&&(be(r.icon,lt,Nt?k:qt),Rn.get(hn).hidden=Fn),an>=0&&(be(r.icon,_e.numVerticalIconVertices,tn?k:qt),Rn.get(an).hidden=Fn)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const qt=r.collisionArrays[pe];if(qt){let hn=new o.P(0,0),an=!0;if(qt.textBox||qt.verticalTextBox){if($){const Fn=this.variableOffsets[Le];Fn?(hn=Si(Fn.anchor,Fn.width,Fn.height,Fn.textOffset,Fn.textScale),X&&hn._rotate(Z?this.transform.angle:-this.transform.angle)):an=!1}B&&(an=!Ke.clipped),qt.textBox&&Ha(r.textCollisionBox.collisionVertexArray,Ke.text.placed,!an||Nt,Ce,re,hn.x,hn.y),qt.verticalTextBox&&Ha(r.textCollisionBox.collisionVertexArray,Ke.text.placed,!an||tn,Ce,re,hn.x,hn.y)}const Rn=an&&!!(!tn&&qt.verticalIconBox);qt.iconBox&&Ha(r.iconCollisionBox.collisionVertexArray,Ke.icon.placed,Rn,Ce,re,_e.hasIconTextFit?hn.x:0,_e.hasIconTextFit?hn.y:0),qt.verticalIconBox&&Ha(r.iconCollisionBox.collisionVertexArray,Ke.icon.placed,!Rn,Ce,re,_e.hasIconTextFit?hn.x:0,_e.hasIconTextFit?hn.y:0)}}}if(r.fullyClipped=Ee===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=pe.invProjMatrix,r.placementViewportMatrix=pe.viewportMatrix,r.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Ha(f,r,c,p,y,x,b){f.emplaceBack(r?1:0,c?1:0,x||0,b||0,p,y?1:0),f.emplaceBack(r?1:0,c?1:0,x||0,b||0,p,y?1:0),f.emplaceBack(r?1:0,c?1:0,x||0,b||0,p,y?1:0),f.emplaceBack(r?1:0,c?1:0,x||0,b||0,p,y?1:0)}const Pi=Math.pow(2,25),Lu=Math.pow(2,24),jc=Math.pow(2,17),Vl=Math.pow(2,16),Fr=Math.pow(2,9),es=Math.pow(2,8),Mp=Math.pow(2,1);function Ca(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const r=f.placed?1:0,c=Math.floor(127*f.opacity);return c*Pi+r*Lu+c*jc+r*Vl+c*Fr+r*es+c*Mp+r}const k=0;class W{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,c,p,y,x,b){const I=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(I,y,r[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((A,D)=>A.sortKey-D.sortKey));this._currentPartIndex<I.length;){const A=I[this._currentPartIndex];if(c.placeLayerBucketPart(A,this._seenCrossTileIDs,p,A.symbolInstanceStart===0,b),this._currentPartIndex++,x())return!0}return!1}}class ee{constructor(r,c,p,y,x,b,I,A,D){this.placement=new zs(r,x,b,I,A,D),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,c,p,y,x){const b=o.q.now(),I=()=>{const A=o.q.now()-b;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=c[r[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=D)&&(!A.maxzoom||A.maxzoom>D)){const L=A,B=L.layout.get("symbol-z-elevate"),O=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=L.layout.get("symbol-z-order"),q=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&O),$=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),X=q&&$,Z=this._inProgressLayer=this._inProgressLayer||new W(L),te=o.C(A.source,A.scope);if(Z.continuePlacement(B||X?y[te]:p[te],this.placement,this._showCollisionBoxes,A,I,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Ae=512/o.aj/2;class vt{constructor(r,c,p){this.tileID=r,this.bucketInstanceId=p,this.index=new o.c0(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=r.canonical.x*o.aj,x=r.canonical.y*o.aj;for(let b=0;b<c.length;b++){const{key:I,crossTileID:A,tileAnchorX:D,tileAnchorY:L}=c.get(b),B=Math.floor((y+D)*Ae),O=Math.floor((x+L)*Ae);this.index.add(B,O),this.keys.push(I),this.crossTileIDs.push(A)}this.index.finish()}findMatches(r,c,p){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),x=Ae/Math.pow(2,c.canonical.z-this.tileID.canonical.z),b=c.canonical.x*o.aj,I=c.canonical.y*o.aj;for(let A=0;A<r.length;A++){const D=r.get(A);if(D.crossTileID)continue;const{key:L,tileAnchorX:B,tileAnchorY:O}=D,U=Math.floor((b+B)*x),q=Math.floor((I+O)*x),$=this.index.range(U-y,q-y,U+y,q+y).sort((X,Z)=>X-Z);for(const X of $){const Z=this.crossTileIDs[X];if(this.keys[X]===L&&!p.has(Z)){p.add(Z),D.crossTileID=Z;break}}}}}class Ot{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(c!==0)for(const p in this.indexes){const y=this.indexes[p],x={};for(const b in y){const I=y[b];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+c),x[I.tileID.key]=I}this.indexes[p]=x}this.lng=r}addBucket(r,c,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const y=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const b=this.indexes[x];if(Number(x)>r.overscaledZ)for(const I in b){const A=b[I];A.tileID.isChildOf(r)&&A.findMatches(c.symbolInstances,r,y)}else{const I=b[r.scaledTo(Number(x)).key];I&&I.findMatches(c.symbolInstances,r,y)}}for(let x=0;x<c.symbolInstances.length;x++){const b=c.symbolInstances.get(x);b.crossTileID||(b.crossTileID=p.generate(),y.add(b.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new vt(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let c=!1;for(const p in this.indexes){const y=this.indexes[p];for(const x in y)r[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[x]),delete y[x],c=!0)}return c}}class Gi{constructor(){this.layerIndexes={},this.crossTileIDs=new Ot,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,p,y){let x=this.layerIndexes[r.fqid];x===void 0&&(x=this.layerIndexes[r.fqid]=new xn);let b=!1;const I={};y.name!=="globe"&&x.handleWrapJump(p);for(const A of c){const D=A.getBucket(r);D&&r.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(A.tileID,D,this.crossTileIDs)&&(b=!0),I[D.bucketInstanceId]=!0)}return x.removeStaleBuckets(I)&&(b=!0),b}pruneUnusedLayers(r){const c={};r.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const us=771;class pn{constructor(r,c,p,y){this.blendFunction=r,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=y}}pn.Replace=[1,0,1,0],pn.disabled=new pn(pn.Replace,o.am.transparent,[!1,!1,!1,!1]),pn.unblended=new pn(pn.Replace,o.am.transparent,[!0,!0,!0,!0]),pn.alphaBlended=new pn([1,us,1,us],o.am.transparent,[!0,!0,!0,!0]),pn.alphaBlendedNonPremultiplied=new pn([770,us,770,us],o.am.transparent,[!0,!0,!0,!0]),pn.multiply=new pn([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class Ut{constructor(r,c,p){this.func=r,this.mask=c,this.range=p}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);const Hr=7680;class bn{constructor(r,c,p,y,x,b){this.test=r,this.ref=c,this.mask=p,this.fail=y,this.depthFail=x,this.pass=b}}bn.disabled=new bn({func:519,mask:0},0,0,Hr,Hr,Hr);const ur=1029,Ul=2305;class yn{constructor(r,c,p){this.enable=r,this.mode=c,this.frontFace=p}}function Rh(f,r){const c=o.c6(f,3);o.c8(f,r),o.cc(f,3,c)}function kh(f,r){const c=o.c3([]);return o.c4(c,c,-r),o.c5(c,c,-f),c}function Gc(f,r){const c=[f[0],f[1],0],p=[r[0],r[1],0];if(o.ae(c)>=1e-15){const b=o.au([],c);o.c1(p,b,o.bG(p,b)),r[0]=p[0],r[1]=p[1]}const y=o.bF([],r,f);if(o.c2(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return kh(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}yn.disabled=new yn(!1,ur,Ul),yn.backCCW=new yn(!0,ur,Ul),yn.backCW=new yn(!0,ur,2304),yn.frontCW=new yn(!0,1028,2304),yn.frontCCW=new yn(!0,1028,Ul);class i0{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof o.ac?r:new o.ac(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=o.bQ(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const p=this.position,y=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(r)):0,x=o.ac.fromLngLat(r,y),b=[x.x-p.x,x.y-p.y,x.z-p.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Gc(b,c)}setPitchBearing(r,c){this.orientation=kh(o.al(r),o.al(-c))}}class qa{constructor(r,c){this._transform=o.bx([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new o.ac(r[0],r[1],r[2])}get position(){const r=o.c6(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&o.cc(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.c3([]),r&&Rh(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=kh(r,c),Rh(this._transform,this._orientation)}forward(){const r=o.c6(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.c6(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.c6(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const p=new Float64Array(16);return o.bi(p,this.getWorldToCamera(r,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,c,p){const y=this.position;o.c1(y,y,-r);const x=new Float64Array(16);return o.bn(x,[p,p,p]),o.bo(x,x,y),x[10]*=c,x}getWorldToCamera(r,c){const p=new Float64Array(16),y=new Float64Array(4),x=this.position;return o.c7(y,this._orientation),o.c1(x,x,-r),o.c8(p,y),o.bo(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(r,c,p,y){const x=new Float64Array(16);return o.c9(x,r,c,p,y),x}getCameraToClipOrthographic(r,c,p,y,x,b){const I=new Float64Array(16);return o.ca(I,r,c,p,y,x,b),I}getDistanceToElevation(r,c=!1){const p=r===0?0:o.cb(r,c?o.aY(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new qa([...this.position],[...this.orientation])}}const zo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class hf{constructor(r=0,c=0,p=0,y=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=p,this.right=y}interpolate(r,c,p){return c.top!=null&&r.top!=null&&(this.top=o.ai(r.top,c.top,p)),c.bottom!=null&&r.bottom!=null&&(this.bottom=o.ai(r.bottom,c.bottom,p)),c.left!=null&&r.left!=null&&(this.left=o.ai(r.left,c.left,p)),c.right!=null&&r.right!=null&&(this.right=o.ai(r.right,c.right,p)),this}getCenter(r,c){const p=o.ay((this.left+r-this.right)/2,0,r),y=o.ay((this.top+c-this.bottom)/2,0,c);return new o.P(p,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new hf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ws=15;class u_{constructor(r,c,p,y,x,b,I){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(b),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new o.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new u_(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ws}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=o.cj(this.projectionOptions);const p=this.getProjection(),y=!o.bv(c,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cj({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bQ(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.ck(),o.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=o.ay(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.al(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,x=0;for(let b=0;b<c.length;b++){const I=new o.P(c[b][0]*this.width,p+c[b][1]*(this.height-p)),A=r.pointCoordinate(I);if(!A)continue;const D=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);y+=A[3]*D,x+=D}return x===0?NaN:y/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),b=Math.max(y-p,x);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const y=o.ae(o.at([],this._camera.position,p));return o.ay(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!o.cm(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];o.cn(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new i0;return c.position=new o.ac(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!o.co(r))return!1;o.cp(r,r);const c=o.cq([],[0,0,-1],r),p=o.cq([],[0,-1,0],r);if(p[2]<0)return!1;const y=Gc(c,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=o.ay(r[2],y/p,y/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,p){this._unmodified=!1,this._edgeInsets.interpolate(r,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new o.cr(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new o.P(0,0)),y=this.pointCoordinate(new o.P(this.width,0)),x=this.pointCoordinate(new o.P(this.width,this.height)),b=this.pointCoordinate(new o.P(0,this.height)),I=Math.floor(Math.min(p.x,y.x,x.x,b.x)),A=Math.floor(Math.max(p.x,y.x,x.x,b.x)),D=1;for(let L=I-D;L<=A+D;L++)L!==0&&c.push(new o.cr(L,r))}return c}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,c,p){let y=[];const x=p!=null,b=!x;if(b&&this.zoom<c||x&&p[0]===0&&p[1]===0)return y;const I=new Set,A=(L,B,O,U,q)=>{const $=o.cV(B,L,O,U,q);I.has($)||(y.push(new o.aM(L,B,O,U,q)),I.add($))};for(let L=0;L<r.length;L++){const B=r[L];if(b&&B.canonical.z!==c)continue;const O=B.canonical,U=B.overscaledZ,q=B.wrap,$=1<<O.z,X=O.x+1<$,Z=O.x>0,te=O.y+1<$,re=O.y>0,ae=B.wrap-(Z?0:1),fe=B.wrap+(X?0:1),be=Z?O.x-1:$-1,Ee=X?O.x+1:0;if(x)p[0]<0?(A(U,fe,O.z,Ee,O.y),p[1]<0&&te&&(A(U,q,O.z,O.x,O.y+1),A(U,fe,O.z,Ee,O.y+1)),p[1]>0&&re&&(A(U,q,O.z,O.x,O.y-1),A(U,fe,O.z,Ee,O.y-1))):p[0]>0?(A(U,ae,O.z,be,O.y),p[1]<0&&te&&(A(U,q,O.z,O.x,O.y+1),A(U,ae,O.z,be,O.y+1)),p[1]>0&&re&&(A(U,q,O.z,O.x,O.y-1),A(U,ae,O.z,be,O.y-1))):p[1]<0&&te?A(U,q,O.z,O.x,O.y+1):re&&A(U,q,O.z,O.x,O.y-1);else{const pe=B.visibleQuadrants;1&pe&&(A(U,ae,O.z,be,O.y),re&&(A(U,q,O.z,O.x,O.y-1),A(U,ae,O.z,be,O.y-1))),2&pe&&(A(U,fe,O.z,Ee,O.y),re&&(A(U,q,O.z,O.x,O.y-1),A(U,fe,O.z,Ee,O.y-1))),4&pe&&(A(U,ae,O.z,be,O.y),te&&(A(U,q,O.z,O.x,O.y+1),A(U,ae,O.z,be,O.y+1))),8&pe&&(A(U,fe,O.z,Ee,O.y),te&&(A(U,q,O.z,O.x,O.y+1),A(U,fe,O.z,Ee,O.y+1)))}}const D=[];for(const L of y)y.some(B=>L.isChildOf(B))||D.push(L);if(y=D.filter(L=>!r.some(B=>!!(L.overscaledZ<c&&B.isChildOf(L))||L.equals(B)||L.isChildOf(B))),b){const L=1<<c,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[L*B.x,L*B.y],U=4,q=U*U;y=y.filter($=>{const X=$.canonical.x+.5-O[0],Z=$.canonical.y+.5-O[1];return X*X+Z*Z<q})}return y}extendTileCoverToNearPlane(r,c,p){const y=[],x=new Set;for(const te of r)x.add(te.key);const b=(te,re,ae,fe,be)=>{const Ee=o.cV(re,te,ae,fe,be);x.has(Ee)||(y.push(new o.aM(te,re,ae,fe,be)),x.add(Ee))},I=r.reduce((te,re)=>Math.max(te,re.overscaledZ),p),A=1<<p,D=[new o.P(0,0),new o.P(o.aj,0),new o.P(o.aj,o.aj),new o.P(0,o.aj)],L=new o.P(0,0),B=new o.P(0,0),O=(te,re)=>{const ae=Math.floor(te[0]),fe=Math.floor(te[1]),be=(te[0]-ae)*o.aj,Ee=(te[1]-fe)*o.aj,pe=Math.floor(re[0]),_e=Math.floor(re[1]),ve=(re[0]-pe)*o.aj,We=(re[1]-_e)*o.aj;for(let Le=-1;Le<=1;Le++){const lt=ae+Le;if(!(lt<0||lt>=A)){L.x=be-Le*o.aj,B.x=ve-(lt-pe)*o.aj;for(let Ye=-1;Ye<=1;Ye++){const ft=fe+Ye;L.y=Ee-Ye*o.aj,B.y=We-(ft-_e)*o.aj,o.cW(L,B,D)&&b(I,0,p,lt,ft)}}}},U=c.points,q=U[o.cs],$=U[o.ct],X=this._projectToGround(q,U[o.cu]),Z=this._projectToGround($,U[o.cv]);return O(q,X),O($,Z),y}_projectToGround(r,c){return o.cw(o.cx(),r,c,r[2]/(r[2]-c[2]))}coveringTiles(r){let c=this.coveringZoomLevel(r);const p=c,y=this.elevation&&this.elevation.exaggeration(),x=y&&!r.isTerrainDEM,b=this.projection.name==="mercator";if(r.minzoom!==void 0&&c<r.minzoom)return[];r.maxzoom!==void 0&&c>r.maxzoom&&(c=r.maxzoom);const I=this.locationCoordinate(this.center),A=this.center.lat,D=1<<c,L=[D*I.x,D*I.y,0],B=this.projection.name==="globe",O=!B,U=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,O),q=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=D*o.cb(1,this.center.lat),X=this._camera.position[2]/o.cb(1,this.center.lat),Z=[D*q.x,D*q.y,X*(O?1:$)],te=B||y,re=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ae=this.isLODDisabled(!0)?c:0;let fe;if(this._elevation&&r.isTerrainDEM)fe=1e4*this._elevation.exaggeration();else if(this._elevation){const Ce=this._elevation.getMinMaxForVisibleTiles();fe=Ce?Ce.max:this._centerAltitude}else fe=this._centerAltitude;const be=r.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?o.cz(this):1,pe=Ce=>{const Ke=new o.ac(Ce.x+25e-6,Ce.y,Ce.z),xt=new o.ac(Ce.x,Ce.y+25e-6,Ce.z),wt=Ce.toLngLat(),Et=Ke.toLngLat(),Nt=xt.toLngLat(),tn=this.locationCoordinate(wt),dn=this.locationCoordinate(Et),qt=this.locationCoordinate(Nt),hn=Math.hypot(dn.x-tn.x,dn.y-tn.y),an=Math.hypot(qt.x-tn.x,qt.y-tn.y);return Math.sqrt(hn*an)*Ee/25e-6},_e=Ce=>{const rt=fe,Ke=be;return{aabb:o.cC(this,D,0,0,0,Ce,Ke,rt,this.projection),zoom:0,x:0,y:0,minZ:Ke,maxZ:rt,wrap:Ce,fullyVisible:!1}},ve=[];let We=[];const Le=c,lt=r.reparseOverscaled?p:c,Ye=(X-this._centerAltitude)*$,ft=Ce=>{if(!this._elevation||!Ce.tileID||!b)return;const rt=this._elevation.getMinMaxForTile(Ce.tileID),Ke=Ce.aabb;rt?(Ke.min[2]=rt.min,Ke.max[2]=rt.max,Ke.center[2]=(Ke.min[2]+Ke.max[2])/2):(Ce.shouldSplit=Ze(Ce),Ce.shouldSplit||(Ke.min[2]=Ke.max[2]=Ke.center[2]=this._centerAltitude))},kt=(Ce,rt)=>{if(.707*rt<Ce)return 1;const Ke=rt/Ce;return Ke/(1.4144271570014144+(Math.pow(1.1,Ke-1.4144271570014144+1)-1)/(1.1-1)-1)},Ze=Ce=>{if(Ce.zoom<ae)return!0;if(Ce.zoom===Le)return!1;if(Ce.shouldSplit!=null)return Ce.shouldSplit;const rt=Ce.aabb.distanceX(Z),Ke=Ce.aabb.distanceY(Z);let xt=Ye,wt=1;if(B){xt=Ce.aabb.distanceZ(Z);const an=Math.pow(2,Ce.zoom),Rn=o.aY((Ce.y+1)/an),Fn=o.aY(Ce.y/an),ei=Math.min(Math.max(A,Rn),Fn),bi=o.c_(ei)/o.c_(A);if(wt=ei===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,bi/this._mercatorScaleRatio),this.zoom<=o.cX&&Ce.zoom===Le-1&&bi>=.9)return!0}else if(x&&(xt=Ce.aabb.distanceZ(Z)*$),this.projection.isReprojectedInTileSpace&&p<=5){const an=Math.pow(2,Ce.zoom),Rn=pe(new o.ac((Ce.x+.5)/an,(Ce.y+.5)/an));wt=Rn>.85?1:Rn}if(!b){const an=Math.sqrt(rt*rt+Ke*Ke+xt*xt);let Rn=(1<<Le-Ce.zoom)*re*wt;return Rn*=kt(Math.max(xt,Ye),an),an<Rn}let Et=Number.MAX_VALUE,Nt=0;const tn=Ce.aabb.getCorners(),dn=[];for(const an of tn){o.at(dn,an,Z),B||(x?dn[2]*=$:dn[2]=Ye);const Rn=o.bG(dn,this._camera.forward());Rn<Et&&(Et=Rn,Nt=Math.abs(dn[2]))}let qt=(1<<Le-Ce.zoom)*re*wt;if(qt*=kt(Math.max(Nt,Ye),Et),Et<qt)return!0;const hn=Ce.aabb.closestPoint(L);return hn[0]===L[0]&&hn[1]===L[1]};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)ve.push(_e(-Ce)),ve.push(_e(Ce));for(ve.push(_e(0));ve.length>0;){const Ce=ve.pop(),rt=Ce.x,Ke=Ce.y;let xt=Ce.fullyVisible;const wt=()=>this.projection.name==="globe"&&(Ce.y===0||Ce.y===(1<<Ce.zoom)-1);if(!xt){let Et=te?Ce.aabb.intersects(U):Ce.aabb.intersectsFlat(U);if(Et===0&&wt()){const Nt=new o.cA(Ce.zoom,rt,Ke);Et=o.cB(this,D,Nt,!0).intersects(U)}if(Et===0)continue;xt=Et===2}if(Ce.zoom!==Le&&Ze(Ce))for(let Et=0;Et<4;Et++){const Nt=(rt<<1)+Et%2,tn=(Ke<<1)+(Et>>1),dn={aabb:b?Ce.aabb.quadrant(Et):o.cC(this,D,Ce.zoom+1,Nt,tn,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:Nt,y:tn,wrap:Ce.wrap,fullyVisible:xt,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};x&&!B&&(dn.tileID=new o.aM(Ce.zoom+1===Le?lt:Ce.zoom+1,Ce.wrap,Ce.zoom+1,Nt,tn),ft(dn)),ve.push(dn)}else{const Et=Ce.zoom===Le?lt:Ce.zoom;if(r.minzoom&&r.minzoom>Et)continue;let Nt=0;if(!xt){let hn=te?Ce.aabb.intersectsPrecise(U):Ce.aabb.intersectsPreciseFlat(U);if(hn===0&&wt()){const an=new o.cA(Ce.zoom,rt,Ke);hn=o.cB(this,D,an,!0).intersectsPrecise(U)}if(hn===0)continue;if(r.calculateQuadrantVisibility)if(U.containsPoint(Ce.aabb.center))Nt=15;else for(let an=0;an<4;an++)Ce.aabb.quadrant(an).intersects(U)!==0&&(Nt|=1<<an)}const tn=L[0]-(.5+rt+(Ce.wrap<<Ce.zoom))*(1<<c-Ce.zoom),dn=L[1]-.5-Ke,qt=Ce.tileID?Ce.tileID:new o.aM(Et,Ce.wrap,Ce.zoom,rt,Ke);r.calculateQuadrantVisibility&&(qt.visibleQuadrants=Nt),We.push({tileID:qt,distanceSq:tn*tn+dn*dn})}}if(this.fogCullDistSq){const Ce=this.fogCullDistSq,rt=this.horizonLineFromTop();We=We.filter(Ke=>{const xt=[0,0,0,1],wt=[o.aj,o.aj,0,1],Et=this.calculateFogTileMatrix(Ke.tileID.toUnwrapped());o.aA(xt,xt,Et),o.aA(wt,wt,Et);const Nt=o.cD([],xt,wt),tn=o.cE([],xt,wt),dn=o.cY(Nt,tn);if(dn===0)return!0;let qt=!1;const hn=this._elevation;if(hn&&dn>Ce&&rt!==0){const an=this.calculateProjMatrix(Ke.tileID.toUnwrapped());let Rn;r.isTerrainDEM||(Rn=hn.getMinMaxForTile(Ke.tileID)),Rn||(Rn={min:be,max:fe});const Fn=o.cF(this.rotation),ei=[Fn[0]*o.aj,Fn[1]*o.aj,Rn.max];o.ad(ei,ei,an),qt=(1-ei[1])*this.height*.5<rt}return dn<Ce||qt})}return We.sort((Ce,rt)=>Ce.distanceSq-rt.distanceSq).map(Ce=>Ce.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=o.ay(r.lat,-o.cG,o.cG),p=this.projection.project(r.lng,c);return new o.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let p,y;const x=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;p=(c.x-x.x)/I,y=(c.y-x.y)/I}else{const I=this.pointCoordinate(c),A=this.pointCoordinate(x);p=I.x-A.x,y=I.y-A.y}const b=this.locationCoordinate(r);this.setLocation(new o.ac(b.x-p,b.y-y))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,c){return this.projection.locationPoint(this,r,c)}locationPoint3D(r,c){return this.projection.locationPoint(this,r,c,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,c){return this.coordinateLocation(this.pointCoordinate3D(r,c))}locationCoordinate(r,c){const p=c?o.cb(c,r.lat):void 0,y=this.projection.project(r.lng,r.lat);return new o.ac(y.x,y.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const p=c??this._centerAltitude,y=[r.x,r.y,0,1],x=[r.x,r.y,1,1];o.aA(y,y,this.pixelMatrixInverse),o.aA(x,x,this.pixelMatrixInverse);const b=x[3];o.cH(y,y,1/y[3]),o.cH(x,x,1/b);const I=y[2],A=x[2];return{p0:y,p1:x,t:I===A?0:(p-I)/(A-I)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return o.aA(c,c,this.pixelMatrixInverse),o.aA(p,p,this.pixelMatrixInverse),o.cH(c,c,1/c[3]),o.cH(p,p,1/p[3]),c[2]=o.cb(c[2],this._center.lat)*this.worldSize,p[2]=o.cb(p[2],this._center.lat)*this.worldSize,o.cH(c,c,1/this.worldSize),o.cH(p,p,1/this.worldSize),new o.av([c[0],c[1],c[2]],o.au([],o.at([],p,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:p,t:y}=r,x=o.cb(c[2],this._center.lat),b=o.cb(p[2],this._center.lat);return new o.ac(o.ai(c[0],p[0],y)/this.worldSize,o.ai(c[1],p[1],y)/this.worldSize,o.ai(x,b,y))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r,c){if(!this.elevation)return this.pointCoordinate(r,c);let p=this.projection.pointCoordinate3D(this,r.x,r.y);if(p)return new o.ac(p[0],p[1],p[2]);let y=0,x=this.horizonLineFromTop();if(r.y>x)return this.pointCoordinate(r,c);const b=.02*x,I=r.clone();for(let A=0;A<10&&x-y>b;A++){I.y=o.ai(y,x,.66);const D=this.projection.pointCoordinate3D(this,I.x,I.y);D?(x=I.y,p=D):y=I.y}return p?new o.ac(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.cI)return!this.isPointAboveHorizon(r);const c=this.pointCoordinate(r);return c.y>=0&&c.y<=1}_coordinatePoint(r,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return o.aA(y,y,this.pixelMatrix),y[3]>0?new o.P(y[0]/y[3],y[1]/y[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new o.P(c,r)),b=this.pointLocation3D(new o.P(y,r)),I=this.pointLocation3D(new o.P(y,p)),A=this.pointLocation3D(new o.P(c,p));let D=Math.min(x.lng,b.lng,I.lng,A.lng),L=Math.max(x.lng,b.lng,I.lng,A.lng),B=Math.min(x.lat,b.lat,I.lat,A.lat),O=Math.max(x.lat,b.lat,I.lat,A.lat);const U=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,$=(X,Z,te,re,ae)=>{const fe=(X+te)/2,be=(Z+re)/2,Ee=new o.P(fe,be),{lng:pe,lat:_e}=this.pointLocation3D(Ee),ve=Math.max(0,D-pe,B-_e,pe-L,_e-O);D=Math.min(D,pe),L=Math.max(L,pe),B=Math.min(B,_e),O=Math.max(O,_e),(ae<q||ve>U)&&($(X,Z,fe,be,ae+1),$(fe,be,te,re,ae+1))};if($(c,r,y,r,1),$(y,r,y,p,1),$(y,p,c,p,1),$(c,p,c,r,1),this.projection.name==="globe"){const[X,Z]=o.cJ(this);X?(O=90,L=180,D=-180):Z&&(B=-90,L=180,D=-180)}return new o.aG(new o.ci(D,B),new o.ci(L,O))}_getBoundsRectangular(r,c){const{top:p,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,I=new o.P(y,p),A=new o.P(b,p),D=new o.P(b,x),L=new o.P(y,x);let B=this.pointCoordinate(I,r),O=this.pointCoordinate(A,r);const U=this.pointCoordinate(D,c),q=this.pointCoordinate(L,c),$=(X,Z)=>(Z.y-X.y)/(Z.x-X.x);return B.y>1&&O.y>=0?B=new o.ac((1-q.y)/$(q,B)+q.x,1):B.y<0&&O.y<=1&&(B=new o.ac(-q.y/$(q,B)+q.x,0)),O.y>1&&B.y>=0?O=new o.ac((1-U.y)/$(U,O)+U.x,1):O.y<0&&B.y<=1&&(O=new o.ac(-U.y/$(U,O)+U.x,0)),new o.aG().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((p,y)=>{if(y.dem){const x=y.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.cG,this.maxLat=o.cG,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,p=this._distanceTileDataCache;if(p[c])return p[c];const y=r.canonical,x=1/this.height,b=this.cameraWorldSize,I=b/this.zoomScale(y.z),A=(y.x+Math.pow(2,y.z)*r.wrap)*I,D=y.y*I,L=this.point;L.x*=b/this.worldSize,L.y*=b/this.worldSize;const B=this.angle,O=Math.sin(-B),U=-Math.cos(-B);return p[c]={bearing:[O,U],center:[(L.x-A)*x,(L.y-D)*x],scale:I/o.aj*x},p[c]}calculateFogTileMatrix(r){const c=r.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.az(y,this.worldToFogMatrix,y),p[c]=new Float32Array(y),p[c]}calculateProjMatrix(r,c=!1,p=!1){const y=r.key;let x;if(x=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,x[y])return x[y];const b=this.calculatePosMatrix(r,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.az(b,I,b),x[y]=new Float32Array(b),x[y]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const y=o.cK(r,this);return p[c]=y,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,c=o.bn([],[r,r,r]);return o.az(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const c=o.cb(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),y=this._camera.forward(),x=o.cb(1,this._center.lat);p[2]/=x,y[2]/=x,o.au(y,y);const b=r.raycast(p,y,r.exaggeration());if(b){const I=o.bE([],p,y,b),A=new o.ac(I[0],I[1],o.cb(I[2],o.aY(I[1]))),D=(A.z+o.ae([A.x-p[0],A.y-p[1],A.z-p[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,p=o.cb(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),x=c.getAtPointOrZero(new o.ac(...y)),b=this.pixelsPerMeter/this.worldSize*x,I=this._minimumHeightOverTerrain(),A=y[2]-b;if(A<=I)if(A<0||r){const D=this.locationCoordinate(this._center,this._centerAltitude),L=[y[0],y[1],D.z-y[2]],B=o.ae(L);L[2]-=(I-A)/this._pixelsPerMercatorPixel;const O=o.ae(L);if(O===0)return;o.c1(L,L,B/O*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],D.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const O=this.center;return O.lat=o.ay(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(O.lng=o.ay(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const c=this._unmodified,{x:p,y}=this.point;let x=0,b=p,I=y;const A=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(y-D<L&&(I=L+D),y+D>B&&(I=B-D),B-L<this.height&&(x=Math.max(x,this.height/(B-L)),I=(B+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,q=this.worldSize/2-(O+U)/2;b=(p+q+this.worldSize)%this.worldSize-q,b-A<O&&(b=O+A),b+A>U&&(b=U-A),U-O<this.width&&(x=Math.max(x,this.width/(U-O)),b=(U+O)/2)}b===p&&I===y||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(b,I))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cb(1,this.center.lat)/o.cb(1,o.c$));const y=o.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?p:1,b=this._camera.getWorldToCamera(this.worldSize,x);let I;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-r.x/this.width,A[9]=2*r.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ve=_e*this.aspect,We=-ve,Le=-_e;ve-=r.x,We-=r.x,_e+=r.y,Le+=r.y,I=this._camera.getCameraToClipOrthographic(We,ve,Le,_e,this._nearZ,this._farZ),((lt,Ye,ft,kt)=>{for(let Ze=0;Ze<16;Ze++)lt[Ze]=o.ai(Ye[Ze],ft[Ze],kt)})(I,I,A,o.cZ(this.pitch>=Ws?1:this.pitch/Ws))}else I=A;const D=o.cM([],A,b);let L=o.cM([],I,b);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),ve=o.bx([]);o.bo(ve,ve,[_e.x*this.worldSize,_e.y*this.worldSize,0]),o.az(ve,ve,o.cN(this)),o.bo(ve,ve,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),o.az(L,L,ve),o.az(D,D,ve),this.inverseAdjustmentMatrix=o.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cP([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),c){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-r.x/this.width,_e[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.cM([],_e,b)}else this.expandedFarZProjMatrix=this.projMatrix;const B=o.bi([],I);this.frustumCorners=o.cQ.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const O=new Float32Array(16);o.bx(O),o.cP(O,O,[1,-1,1]),o.cR(O,O,this._pitch),o.by(O,O,this.angle);const U=o.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(U);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-r.x/this.width,U[9]=2*(r.y+q)/this.height,this.skyboxMatrix=o.az(O,U,O);const $=this.point,X=$.x,Z=$.y,te=this.width%2/2,re=this.height%2/2,ae=Math.cos(this.angle),fe=Math.sin(this.angle),be=X-Math.round(X)+ae*te+fe*re,Ee=Z-Math.round(Z)+ae*re+fe*te,pe=new Float64Array(L);if(o.bo(pe,pe,[be>.5?be-1:be,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=pe,L=o.bz(),o.cP(L,L,[this.width/2,-this.height/2,1]),o.bo(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=o.bz(),o.cP(L,L,[1,-1,1]),o.bo(L,L,[-1,-1,0]),o.cP(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},L=o.bi(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cS(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(_e,_e,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,c];o.c1(x,x,y),o.c1(p,p,-1),o.cT(p,p,x);const b=o.bz();o.bo(b,b,p),o.cP(b,b,x),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,y)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*x,y.y/this.worldSize-p[1]*x,r/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=r[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((c-p)/y,1)),this._camera.position=o.bE([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),x=o.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),I=Math.max((r[2]-x)/Math.cos(p),b),A=this._zoomFromMercatorZ(I);o.bE(r,r,c,I),this._pitch=o.ay(p,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bQ(y,-Math.PI,Math.PI),this._setZoom(o.ay(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,p=o.cI,y=0,x=1/0;for(;p-c>1e-6&&p>c;){const b=c+.5*(p-c),I=this.tileSize*Math.pow(2,b),A=this.getCameraToCenterDistance(this.projection,b,I),D=this.scaleZoom(A/(Math.max(0,r)*this.tileSize)),L=Math.abs(b-D);L<x&&(x=L,y=b),b<D?c=b:p=b}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const p=Math.min(r.x,c.x),y=Math.max(r.x,c.x),x=Math.min(r.y,c.y),b=Math.max(r.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new o.P(p,x),new o.P(y,b),new o.P(p,b),new o.P(y,x)],A=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const L of I){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const O=this.rayIntersectionCoordinate(B);if(O.x<A||O.y<0||O.x>D||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,c){const p=o.ae(o.at([],this._camera.position,r)),y=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([c,p,y],x){const b=[c,p,y,1];o.aA(b,b,x);const I=b[3]=Math.max(b[3],1e-6);return b[0]/=I,b[1]/=I,b[2]/=I,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,c=this.zoom,p=this.worldSize){const y=o.cL(r,c,this.width,this.height,1024),x=r.pixelSpaceConversion(this.center.lat,p,y);let b=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(b=o.ai(1,b,o.cZ(this.pitch>=Ws?1:this.pitch/Ws))),b}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(r,r,this.globeMatrix),r}getFrustum(r){return o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const jl=(f,r)=>{if(r>0&&f.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),y=c.isLODDisabled(!1)?o.af(60,45,c.pitch):o.af(30,15,c.pitch),x=c._farZ-c._nearZ,b=r*c.height,I=((1-(A=y))*c.cameraToCenterDistance+A*(c._farZ+b))*p;var A;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(I-c._nearZ)/x,(I-b-c._nearZ)/x]}}},wo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class df{constructor(r,c){this.aabb=r,this.lastCascade=c}}class tE{add(r,c){const p=this.receivers[r.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[r.key]=new df(c,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,c,p){const y=o.d6.fromPoints(r.points);let x=0;for(const b in this.receivers){const I=this.receivers[b];if(!I||!y.intersectsAabb(I.aabb))continue;I.aabb.min=y.closestPoint(I.aabb.min),I.aabb.max=y.closestPoint(I.aabb.max);const A=I.aabb.getCorners();for(let D=0;D<p.length;D++){let L=!0;for(const B of A){const O=[B[0]*c,B[1]*c,B[2]];if(o.ad(O,O,p[D].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){L=!1;break}}if(I.lastCascade=D,x=Math.max(x,D),L)break}}return x+1}}class nE{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new tE,this._depthMode=new Ut(r.context.gl.LEQUAL,Ut.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(wo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(wo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(wo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,c){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const y=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((q,$)=>{const X=p.style._mergedLayers[$];return q+(X.hasShadowPass()&&!X.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=p.context,b=wo.shadowMapResolution,I=wo.shadowMapResolution;if(this._cascades.length===0||wo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<wo.cascadeCount;++q){const $=p._shadowMapDebug,X=x.gl,Z=x.createFramebuffer(b,I,$,"texture"),te=new o.T(x,{width:b,height:I,data:null},X.DEPTH_COMPONENT16);if(Z.depthAttachment.set(te.texture),$){const re=new o.T(x,{width:b,height:I,data:null},X.RGBA8);Z.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:Z,texture:te,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cy,scale:0})}}this.shadowDirection=Mh(c);let A=0;if(r.elevation){const q=r.elevation,$=[1e4,-1e4];q.visibleDemTiles.filter(X=>X.dem).forEach(X=>{const Z=X.dem.tree;$[0]=Math.min($[0],Z.minimums[0]),$[1]=Math.max($[1],Z.maximums[0])}),$[0]!==1e4&&(A=($[1]-$[0])*q.exaggeration())}const D=1.5*r.cameraToCenterDistance,L=3*D,B=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const $=this._cascades[q];let X=r.height/50,Z=1;wo.cascadeCount===1?Z=L:q===0?Z=D:(X=D,Z=L);const[te,re]=Dh(r,this.shadowDirection,X,Z,wo.shadowMapResolution,A);$.scale=r.scale,$.matrix=te,$.boundingSphereRadius=re,o.bi(B,$.matrix),$.frustum=o.cy.fromInvProjectionMatrix(B,1,0,!0),$.far=Z}const O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/wo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=wo.shadowMapResolution,this._uniformValues.u_shadowmap_0=zo.ShadowMap0,this._uniformValues.u_shadowmap_1=zo.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const U=p.transform.elevation;for(const q of this._groundShadowTiles){let $={min:0,max:0};if(U){const X=U.getMinMaxForTile(q);X&&($=X)}this.addShadowReceiver(q.toUnwrapped(),$.min,$.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,c){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,wo.shadowMapResolution,wo.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){p.currentShadowCascade=x,y.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),y.clear({color:o.am.white,depth:1});for(const b of r.order){const I=r._mergedLayers[b];if(!I.hasShadowPass()||I.isHidden(p.transform.zoom))continue;const A=r.getLayerSourceCache(I),D=A?c[A.id]:void 0;(I.type==="model"||D&&D.length)&&p.renderLayer(p,A,I,D)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,c=r.style,p=r.context,y=p.gl,x=c.directionalLight,b=c.ambientLight;if(!x||!b)return;const I=[],A=jl(r,r.longestCutoffRange);A.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const D=Ou(c,x,b),L=new Ut(y.LEQUAL,Ut.ReadOnly,r.depthRangeFor3D),B=new bn({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const O of this._groundShadowTiles){const U=O.toUnwrapped(),q=r.isTileAffectedByFog(O),$=r.getOrCreateProgram("groundShadow",{defines:I,overrideFog:q});this.setupShadows(U,$),r.uploadCommonUniforms(p,$,U,null,A);const X={u_matrix:r.transform.calculateProjMatrix(U),u_ground_shadow_factor:D};$.draw(r,y.TRIANGLES,L,B,pn.multiply,yn.disabled,X,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?pn.unblended:pn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const c=this.painter.transform,p=c.calculatePosMatrix(r,c.worldSize);return o.az(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(r){return o.az(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,c,p){if(!this.enabled)return;const y=this.painter.transform,x=this.painter.context,b=x.gl,I=this._uniformValues,A=new Float64Array(16),D=y.calculatePosMatrix(r,y.worldSize);for(let L=0;L<this._cascades.length;L++)o.az(A,this._cascades[L].matrix,D),I[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),x.activeTexture.set(b.TEXTURE0+zo.ShadowMap0+L),this._cascades[L].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const L=o.d4(r.canonical),B=2/y.tileSize*o.aj/wo.shadowMapResolution,O=B*this._cascades[0].boundingSphereRadius,U=B*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(p==="vector-tile"?1:3)*function($,X,Z,te,re){const ae=o.ay(($-22)/-22,0,1);return .125*(1-ae)+4*ae}(y.zoom);I.u_shadow_normal_offset=[L,O*q,U*q],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(x,I)}setupShadowsFromMatrix(r,c,p=!1){if(!this.enabled)return;const y=this.painter.context,x=y.gl,b=this._uniformValues,I=new Float64Array(16);for(let A=0;A<wo.cascadeCount;A++)o.az(I,this._cascades[A].matrix,r),b[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),y.activeTexture.set(x.TEXTURE0+zo.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=p,p){const A=wo.normalOffset;b.u_shadow_normal_offset=[1,A,A],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(y,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,c,p,y){if(y[2]>=0)return{};const x=function(A,D,L){const B=L/(1<<A.canonical.z);return new o.d6([A.canonical.x*B+A.wrap*L,A.canonical.y*B+A.wrap*L,0],[(A.canonical.x+1)*B+A.wrap*L,(A.canonical.y+1)*B+A.wrap*L,D])}(r,c,p).getCorners(),b=c/-y[2];y[0]<0?(o.d5(x[0],x[0],[y[0]*b,0,0]),o.d5(x[3],x[3],[y[0]*b,0,0])):y[0]>0&&(o.d5(x[1],x[1],[y[0]*b,0,0]),o.d5(x[2],x[2],[y[0]*b,0,0])),y[1]<0?(o.d5(x[0],x[0],[0,y[1]*b,0]),o.d5(x[1],x[1],[0,y[1]*b,0])):y[1]>0&&(o.d5(x[2],x[2],[0,y[1]*b,0]),o.d5(x[3],x[3],[0,y[1]*b,0]));const I={};return I.vertices=x,I.planes=[$c(x[1],x[0],x[4]),$c(x[2],x[1],x[5]),$c(x[3],x[2],x[6]),$c(x[0],x[3],x[7])],I}addShadowReceiver(r,c,p){this._receivers.add(r,o.d6.fromTileIdAndHeight(r,c,p))}getMaxCascadeForTile(r){const c=this._receivers.get(r);return c&&c.lastCascade?c.lastCascade:0}}function $c(f,r,c){const p=o.at([],c,r),y=o.at([],f,r),x=o.bF([],p,y),b=o.ae(x);return b===0?[0,0,1,0]:(o.c1(x,x,1/b),[x[0],x[1],x[2],-o.bG(x,r)])}function Mh(f){const r=f.properties.get("direction"),c=o.d1(r.x,r.y,r.z);c[2]=o.ay(c[2],0,75);const p=o.d3([c[0],c[1],c[2]]);return o.d2(p.x,p.y,p.z)}function Ou(f,r,c){const p=r.properties.get("color-use-theme")==="none",y=r.properties.get("color"),x=r.properties.get("intensity"),b=r.properties.get("direction"),I=[b.x,b.y,b.z],A=c.properties.get("color-use-theme")==="none",D=c.properties.get("color"),L=c.properties.get("intensity"),B=Math.max(o.bG([0,0,1],I),0),O=[0,0,0];o.c1(O,D.toPremultipliedRenderColor(A?null:f.getLut(r.scope)).toArray01Linear().slice(0,3),L);const U=[0,0,0];return o.c1(U,y.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),B*x),o.d8([O[0]>0?O[0]/(O[0]+U[0]):0,O[1]>0?O[1]/(O[1]+U[1]):0,O[2]>0?O[2]/(O[2]+U[2]):0])}function Dh(f,r,c,p,y,x){const b=f.zoom,I=f.scale,A=f.worldSize,D=1/A,L=f.aspect,B=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),O=B*B,U=p-c,q=p+c;let $,X;O>U/q?($=p,X=p*B):($=.5*q*(1+O),X=.5*Math.sqrt(U*U+2*(p*p+c*c)*O+q*q*O*O));const Z=f.projection.pixelsPerMeter(f.center.lat,A),te=f._camera.getCameraToWorldMercator(),re=[0,0,-$*D];o.ad(re,re,te);let ae=X*D;const fe=f._edgeInsets;if(!(fe.left===0&&fe.top===0&&fe.right===0&&fe.bottom===0||fe.left===fe.right&&fe.top===fe.bottom)){const xt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Z:1),wt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);wt[8]=2*-f.centerOffset.x/f.width,wt[9]=2*f.centerOffset.y/f.height;const Et=new Float64Array(16);o.cM(Et,wt,xt);const Nt=new Float64Array(16);o.bi(Nt,Et);const tn=o.cy.fromInvProjectionMatrix(Nt,A,b,!0);for(const dn of tn.points){const qt=((be=dn)[0]/=I,be[1]/=I,be[2]=o.cb(be[2],f._center.lat),be);ae=Math.max(ae,o.c2(o.d7([],re,qt)))}}var be;ae*=y/(y-1);const Ee=Math.acos(r[2]),pe=Math.atan2(-r[0],-r[1]),_e=new qa;_e.position=re,_e.setPitchBearing(Ee,pe);const ve=_e.getWorldToCamera(A,Z),We=ae*A,Le=Math.min(f._mercatorZfromZoom(17)*A*-2,-2*We),lt=_e.getCameraToClipOrthographic(-We,We,-We,We,Le,(We+x*Z)/r[2]),Ye=new Float64Array(16);o.az(Ye,lt,ve);const ft=o.d2(Math.floor(1e6*re[0])/1e6*A,Math.floor(1e6*re[1])/1e6*A,0),kt=.5*y,Ze=[0,0,0];o.ad(Ze,ft,Ye),o.c1(Ze,Ze,kt);const Ce=[Math.floor(Ze[0]),Math.floor(Ze[1]),Math.floor(Ze[2])],rt=[0,0,0];o.at(rt,Ze,Ce),o.c1(rt,rt,-1/kt);const Ke=new Float64Array(16);return o.bx(Ke),o.bo(Ke,Ke,rt),o.az(Ye,Ke,Ye),[Ye,We]}class r0 extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,c){return o.aS(this.requestManager.transformRequest(c,o.R.Model).url).then(p=>{if(!p)return;const y=o.aT(p),x=new o.aU(r,void 0,void 0,y);return x.computeBoundsAndApplyParent(),x}).catch(p=>{if(p&&p.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${r} from ${c}: ${p.message}`)))})}load(r,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const y=Object.keys(r),x=[],b=[];for(const I of y){const A=r[I];this.hasURLBeenRequested(A)&&!p.forceReload||(this.modelByURL[A]={modelId:I,scope:c},x.push(this.loadModel(I,A)),b.push(I)),this.models[c][I]||(this.models[c][I]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+b.length,Promise.allSettled(x).then(I=>{for(let A=0;A<I.length;A++){const{status:D}=I[A];if(D==="rejected")continue;const{value:L}=I[A];this.models[c][b[A]]||(this.models[c][b[A]]={model:null,numReferences:1}),this.models[c][b[A]].model=L}this.numModelsLoading[c]-=b.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(I=>{this.fire(new o.z(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(r,c):this.getModelByURL(this.modelUris[c][r]))}getModel(r,c){return this.models[c]||(this.models[c]={}),this.models[c][r]?this.models[c][r].model:void 0}getModelByURL(r){if(!r)return null;const c=this.modelByURL[r];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(r,c){return this.models[c]&&this.models[c][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const y=this.requestManager.normalizeModelURL(c);if((this.hasModel(r,p,{exactIdMatch:!0})||this.hasModelBeenAdded(r,p))&&this.modelUris[p][r]===y)this.models[p][r].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:x,modelId:b}=this.modelByURL[y];this.models[x][b].numReferences++}else this.modelUris[p][r]=y,this.load({[r]:this.modelUris[p][r]},p)}addModelURLs(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const y in r)p[y]=this.requestManager.normalizeModelURL(r[y])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const y of r)this.hasModel(y,c,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[c][y].numReferences++:this.modelUris[c][y]&&!this.hasURLBeenRequested(y)?p[y]=this.modelUris[c][y]:!this.hasURLBeenRequested(y)&&o.d9(y,!1)&&(this.modelUris[c][y]=this.requestManager.normalizeModelURL(y),p[y]=this.modelUris[c][y]);this.load(p,c)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,c,p=!1,y=!1){if(this.models[c]&&this.models[c][r]&&(this.models[c][r].numReferences--,this.models[c][r].numReferences===0||y)){const x=this.modelUris[c][r];p||delete this.modelUris[c][r],delete this.modelByURL[x];const b=this.models[c][r].model;if(!b)return;delete this.models[c][r],b.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const c of Object.keys(this.models[r])){const p=this.models[r][c].model;delete this.models[r][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(r.context)}}const Dp=new o.a7({data:new o.a8(o.a5.colorTheme.data)});class h_{constructor(r){this._scope=r,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(r){const c=this._makeBuildingsQueryArea(r),p=this._makeFloorsQueryArea(r),y=r.queryRenderedFeatures(c,this._buildingQueryParams).filter(I=>I.properties.shape_type==="building").reduce((I,A)=>{const D=A.properties.id;return A.properties.shape_type!=="building"||I.some(L=>L.properties.id===D)||I.push(A),I},[]),x=r.queryRenderedFeatures(p,this._floorQueryParams).filter(I=>I.properties.shape_type==="floor").reduce((I,A)=>{const D=A.properties.id;return A.properties.shape_type!=="floor"||I.some(L=>L.properties.id===D)||I.push(A),I},[]),b=[r.getCenter().lng,r.getCenter().lat];return{floors:x,building:this._findBuildingAtCenter(b,y)||(y.length>0?y[0]:null)}}_makeBuildingsQueryArea(r){const c=r.transform.width,p=r.transform.height,y=Math.min(c,p),x=y*(1/8),b=y*(1/8),I=.5*(c-x),A=.5*(p-b);return[new o.P(I,A),new o.P(I+x,A+b)]}_makeFloorsQueryArea(r){const c=r.transform.width,p=r.transform.height,y=c*(2/3),x=p*(2/3),b=.5*(c-y),I=.5*(p-x);return[new o.P(b,I),new o.P(b+y,I+x)]}_findBuildingAtCenter(r,c){for(const p of c)if(p.geometry.type==="Polygon"&&this._pointInPolygon(r,p.geometry.coordinates[0]))return p;return null}_pointInPolygon(r,c){let p=!1;for(let y=0,x=c.length-1;y<c.length;x=y++){const b=c[y][0],I=c[y][1],A=c[x][1];I>r[1]!=A>r[1]&&r[0]<(c[x][0]-b)*(r[1]-I)/(A-I)+b&&(p=!p)}return p}}class Hc{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(r){this._selectedBuildingId=r}setFloors(r){if(this._floors=r.filter(c=>c.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(c=>c.properties.id).includes(this._selectedFloorId)){const c=this._floors.map(p=>({id:p.properties.id,level:p.properties.floor_level})).reduce((p,y)=>{const x=Math.abs(p.level-1),b=Math.abs(y.level-1);return b<x||b===x&&y.level>p.level?y:p});this._selectedFloorId=c.id}}setFloorId(r){this._selectedFloorId=r}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const iE={"mbx-indoor-level-selected":{default:["literal",[]]}};function s0(f){return f=f||{},Object.assign(f,iE)}class rE extends o.E{constructor(r){super(),o.aV(["_onLoad","_onMove"],this),this._map=r,this._floorSelectionState=new Hc,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=r.scope,this._indoorDataQuery=new h_(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const r=this._indoorDataQuery.execute(this._map);r&&r.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(r)):this._clearIndoorData()}_selectFloors(r){if(r.building)this._floorSelectionState.setBuildingId(r.building.properties.id),this._floorSelectionState.setFloors(r.floors),this._updateUI();else{const c=this._floorSelectionState.getSelectedFloorId();if(c&&r.floors.some(p=>p.properties.id===c))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const r=this._floorSelectionState.getCurrentBuildingFloors().map(p=>({id:p.properties.id,name:p.properties.name,shortName:p.properties.floor_level,levelOrder:p.properties.floor_level})),c=this._floorSelectionState.getSelectedFloorId();c?(this._updateIndoorConfig(),this.fire(new o.A("indoorupdate",{selectedFloorId:c,floors:r}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const r=this._floorSelectionState.getSelectedFloorId();r?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[r]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(r){this._floorSelectionState.setFloorId(r),this._updateIndoorConfig()}}function o0(f){if(!f.metadata||!f.metadata.content_area)return;const r=o.q.devicePixelRatio,{left:c,top:p,width:y,height:x}=f.metadata.content_area,b=c*r,I=p*r;return[b,I,b+y*r,I+x*r]}function a0(f){if(f)return f.map(([r,c])=>[r*o.q.devicePixelRatio,c*o.q.devicePixelRatio])}class d_{constructor(r,c,p){this.id=r,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return r;const p=this.sourceCache.getSource();if(!(p instanceof tt))return r;const y=c.map(b=>this.sourceCache.getTile(b)),x=p.getImages(y,Array.from(this.pendingRequests));for(const[b,I]of x)r.set(o.I.from({name:b,iconsetId:this.id}),I),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),r}}const qc=(f,r)=>he(f,r&&r.filter(c=>c.identifier!=="source.canvas")),l0=o.aF(_i,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),c0=o.aF(_i,["setCenter","setZoom","setBearing","setPitch"]),Lp=new Set(["background","sky","slot","custom"]),Wc={version:8,layers:[],sources:{}},ff={duration:300,delay:0};class Wa extends o.E{constructor(r,c={}){super(),this.map=r,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=o.h({},ff),this._buildingIndex=new uf(this),this.crossTileSymbolIndex=new Gi,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Ea,this.dispatcher=c.dispatcher?c.dispatcher:new o.D(o.db(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Vi(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.dc(r._requestManager,c.localFontFamily?o.dd.all:c.localIdeographFontFamily?o.dd.ideographs:o.dd.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new r0(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",o.de());const p=this;this._rtlTextPluginCallback=Wa.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,b)=>{if(o.df(x),b&&b.every(I=>I))for(const I in p._sourceCaches){const A=p._sourceCaches[I],D=A.getSource().type;D!=="vector"&&D!=="geojson"||A.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.getOwnSource(y.sourceId);if(x&&x.vectorLayerIds)for(const b in this._layers){const I=this._layers[b];I.source===x.id&&this._validateLayer(I)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(o.j(r))return r;const c=o.dg(r);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${o.dh(JSON.stringify(r))}`}_diffStyle(r,c,p){this.globalId=this._getGlobalId(r);const y=(x,b)=>{try{b(null,this.setState(x,p))}catch(I){b(I,!1)}};if(typeof r=="string"){const x=this.map._requestManager.normalizeStyleURL(r),b=this.map._requestManager.transformRequest(x,o.R.Style);o.n(b,(I,A)=>{I?this.fire(new o.z(I)):A&&y(A,c)})}else typeof r=="object"&&y(r,c)}loadURL(r,c={}){this.fire(new o.A("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!o.j(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,c.accessToken),this.resolvedImports.add(r);const y=this.importsCache.get(r);if(y)return this._load(y,p);const x=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.n(x,(b,I)=>{if(this._request=null,b)this.fire(new o.z(b));else if(I)return this.importsCache.set(r,I),this._load(I,p)})}loadJSON(r,c={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=o.q.frame(()=>{this._request=null,this._load(r,c.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(Wc,!1)}_loadImports(r,c,p){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const x of r){const b=this._createFragmentStyle(x),I=new Promise(L=>{b.once("style.import.load",L),b.once("error",L)}).then(()=>this.mergeAll());if(y.push(I),this.resolvedImports.has(x.url)){b.loadEmpty();continue}const A=x.data||this.importsCache.get(x.url);A?(b.loadJSON(A,{validate:c}),this._isInternalStyle(A)&&(b.globalId=null)):x.url?b.loadURL(x.url,{validate:c}):b.loadEmpty();const D={style:b,id:x.id,config:x.config};if(p){const L=this.fragments.findIndex(({id:B})=>B===p);this.fragments=this.fragments.slice(0,L).concat(D).concat(this.fragments.slice(L))}else this.fragments.push(D)}return Promise.allSettled(y)}getImportGlobalIds(r=this,c=new Set){for(const p of r.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(r){const c=this.scope?o.C(r.id,this.scope):r.id;let p;const y=this._initialConfig&&this._initialConfig[c];(r.config||y)&&(p=o.h({},r.config,y));const x=new Wa(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,c){const p=r.indoor?s0(r.schema):r.schema;if(this._isInternalStyle(r)){const b=o.h({},Wc,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(b,c)}if(this.updateConfig(this._config,p),c&&qc(this,Bs(r)))return;this._loaded=!0,this.stylesheet=o.di(r);const y=()=>{for(const D in r.sources)this.addSource(D,r.sources[D],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const D in r.iconsets)this.addIconset(D,r.iconsets[D]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&r.glyphs&&this.glyphManager.setURL(r.glyphs);const b=Cu(this.stylesheet.layers);if(this._order=b.map(D=>D.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new Je(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Je(this.stylesheet.light)),this._layers={};for(const D of b){const L=o.dn(D,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const B=this.getOwnLayerSourceCache(L),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&L.canCastShadows()&&O&&(B.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const A=this.isRootStyle();r.imports?this._loadImports(r.imports,c).then(()=>{this._reloadImports(),this.fire(new o.A(A?"style.load":"style.import.load"))}).catch(D=>{this.fire(new o.z(new Error("Failed to load imports",D))),this.fire(new o.A(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const b=this._evaluateColorThemeData(x);this._loadColorTheme(b).then(()=>{y()}).catch(I=>{o.w(`Couldn't load color theme from the stylesheet: ${I}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,c,p,y,x,b,I,A,D,L;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(r=O.light),O.stylesheet.lights)for(const U of O.stylesheet.lights)U.type==="ambient"&&O.ambientLight!=null&&(c=O.ambientLight),U.type==="directional"&&O.directionalLight!=null&&(p=O.directionalLight);y=this._prioritizeTerrain(y,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(x=O.fog),O.stylesheet.snow&&O.snow!=null&&(b=O.snow),O.stylesheet.rain&&O.rain!=null&&(I=O.rain),O.stylesheet.camera!=null&&(L=O.stylesheet.camera),O.stylesheet.projection!=null&&(A=O.stylesheet.projection),O.stylesheet.transition!=null&&(D=O.stylesheet.transition),B[O.scope]=O._styleColorTheme}}),this.light=r,this.ambientLight=c,this.directionalLight=p,this.fog=x,this.snow=b,this.rain=I,this._styleColorThemeForScope=B,y===null?delete this.terrain:this.terrain=y,this.camera=L||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=o.h({},ff,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const c=p=>{for(const y of p.fragments)c(y.style);r(p)};c(this)}_prioritizeTerrain(r,c,p){const y=r&&r.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:y?r:null:c!=null&&(!r||y||c&&c.drapeRenderMode===1)?c:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{r=this._prioritizeTerrain(r,c.terrain,c.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(r=c.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},c={},p={};this.forEachFragmentStyle(y=>{for(const x in y._sourceCaches){const b=o.C(x,y.scope);r[b]=y._sourceCaches[x]}for(const x in y._otherSourceCaches){const b=o.C(x,y.scope);c[b]=y._otherSourceCaches[x]}for(const x in y._symbolSourceCaches){const b=o.C(x,y.scope);p[b]=y._symbolSourceCaches[x]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeLayers(){const r={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const b of x._order){const I=x._layers[b];if(I.type==="slot"){const A=o.dj(b);if(r[A])continue;r[A]=[]}I.slot&&r[I.slot]?r[I.slot].push(I):c.push(I)}}),this._mergedOrder=[];const y=(x=[])=>{for(const b of x)if(b.type==="slot"){const I=o.dj(b.id);r[I]&&y(r[I]),this._mergedSlots.push(I)}else{const I=o.C(b.id,b.scope);this._mergedOrder.push(I),p[I]=b,b.is3D(!!this.terrain)&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};y(c),this._mergedOrder.sort((x,b)=>{const I=p[x],A=p[b];return I.hasInitialOcclusionOpacityProperties?A.is3D(!!this.terrain)?1:0:I.is3D(!!this.terrain)&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=o.h({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(c,p,y,x){const b=o.h({},p);for(const A of Object.keys(o.a5.colorTheme))b[A]===void 0&&(b[A]=o.a5.colorTheme[A].default);const I=new o.a6(Dp,c,new Map(y));return I.setTransitionOrValue(b,y),I.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const x="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let b=r;b.startsWith(x)||(b=x+b);const I=o.I.from("mapbox-reserved-lut"),A=new Image;A.src=b,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:D,height:L,data:B}=o.q.getImageData(A);if(L>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==L*L)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new o.r({width:D,height:L},B),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(I,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:r},p()):y(new Error("Missing LUT image."))}})}getLut(r){const c=this._styleColorThemeForScope[r];return c?c.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(c,p,y){let x,b,I;const A=o.q.devicePixelRatio>1?"@2x":"";let D=o.n(p.transformRequest(p.normalizeSpriteURL(c,A,".json"),o.R.SpriteJSON),(O,U)=>{D=null,I||(I=O,x=U,B())}),L=o.o(p.transformRequest(p.normalizeSpriteURL(c,A,".png"),o.R.SpriteImage),(O,U)=>{L=null,I||(I=O,b=U,B())});function B(){if(I)y(I);else if(x&&b){const O=o.q.getImageData(b),U={};for(const q in x){const{width:$,height:X,x:Z,y:te,sdf:re,pixelRatio:ae,stretchX:fe,stretchY:be,content:Ee}=x[q],pe=new o.r({width:$,height:X});o.r.copy(O,pe,{x:Z,y:te},{x:0,y:0},{width:$,height:X},null),U[q]={data:pe,pixelRatio:ae,sdf:re,stretchX:fe,stretchY:be,content:Ee,usvg:!1}}y(null,U)}}return{cancel(){D&&(D.cancel(),D=null),L&&(L.cancel(),L=null)}}}(r,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new o.z(c));else if(p){const y=new Map;for(const x in p)y.set(o.I.from(x),p[x]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(r,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new o.z(new Error(`Source "${c.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const y=p.getSource();if(y.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${c.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const x=new d_(r,this.scope,p);this.imageManager.addImageProvider(x,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!o.j(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const c=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(x,b)=>{if(this._spriteRequest=null,x)c?this._loadSprite(r):this.fire(new o.z(x));else if(b){const I=new Map;for(const A in b)I.set(o.I.from(A),b[A]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(r),o.R.Iconset),(x,b)=>{if(x)return void y(x);const I={},A=o.da(new o.bq(b));for(const D of A.icons){const L={version:1,pixelRatio:o.q.devicePixelRatio,content:o0(D),stretchX:D.metadata?a0(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?a0(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};I[D.name]=L}y(null,I)}))}_validateLayer(r){const c=this.getOwnSource(r.source);if(!c)return;const p=r.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.z(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,c)=>{const p=this.fragments[c];return p&&p.style&&(r.data=p.style.serialize()),r})}_serializeSources(){const r={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();r[p.id]||(r[p.id]=p.serialize())}return r}_serializeLayers(r){const c=[];for(const p of r){const y=this._layers[p];y&&y.type!=="custom"&&c.push(y.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const c=this.getOwnLayer(r);if(c)return c;this.fire(new o.z(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const c=this.getOwnSource(r);if(c)return c;this.fire(new o.z(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,c){const p=this.map.painter;if(p)for(let y=r.minzoom||0;y<(r.maxzoom||25.5);y++){const x=r.getProgramIds();if(x)for(const b of x){const I=r.getDefaultProgramParams(b,c.zoom,this._styleColorTheme.lut);I&&(p.style=this,this.fog&&(p._fogVisible=!0,I.overrideFog=!0,p.getOrCreateProgram(b,I)),p._fogVisible=!1,I.overrideFog=!1,p.getOrCreateProgram(b,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,p.getOrCreateProgram(b,I)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const c=this.calculateLightsBrightness();r.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const A in I){const{updatedIds:D,removedIds:L}=I[A];(D||L)&&(this._updateWorkerLayers(A,D,L),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const x={};for(const I in this._mergedSourceCaches){const A=this._mergedSourceCaches[I];x[I]=A.used,A.used=!1,A.tileCoverLift=0}for(const I of this._mergedOrder){const A=this._mergedLayers[I];if(A.recalculate(r,this._availableImages),!A.isHidden(r.zoom)){const D=this.getLayerSourceCache(A);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,r)}):this.precompilePrograms(A,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const I of b)I.sourceCache.used=!0;for(const I in x){const A=this._mergedSourceCaches[I];x[I]!==A.used&&A.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const c of r){const p=c.resolvePendingRequests(),y=this.getFragmentStyle(c.scope);y&&y.addImages(p)}}_updateTilesForChangedImages(){const r={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;r[p]=r[p]||this._changes.getUpdatedImages(p),r[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r[p])}for(const c in r)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(r,c,p){const y=this.getFragmentStyle(r);y&&this.dispatcher.broadcast("updateLayers",{layers:c?y._serializeLayers(c):[],scope:r,removedIds:p||[],options:y.options})}setState(r,c){if(this._checkLoaded(),qc(this,Bs(r)))return!1;(r=o.di(r)).layers=Cu(r.layers);const p=function(b,I){if(!b)return[{command:_i.setStyle,args:[I]}];let A=[];try{if(!o.bv(b.version,I.version))return[{command:_i.setStyle,args:[I]}];if(o.bv(b.center,I.center)||A.push({command:_i.setCenter,args:[I.center]}),o.bv(b.zoom,I.zoom)||A.push({command:_i.setZoom,args:[I.zoom]}),o.bv(b.bearing,I.bearing)||A.push({command:_i.setBearing,args:[I.bearing]}),o.bv(b.pitch,I.pitch)||A.push({command:_i.setPitch,args:[I.pitch]}),o.bv(b.sprite,I.sprite)||A.push({command:_i.setSprite,args:[I.sprite]}),o.bv(b.glyphs,I.glyphs)||A.push({command:_i.setGlyphs,args:[I.glyphs]}),o.bv(b.imports,I.imports)||function(U=[],q=[],$){q=q||[];const X=(U=U||[]).map(Ga),Z=q.map(Ga),te=U.reduce(ml,{}),re=q.reduce(ml,{}),ae=X.slice();let fe,be,Ee,pe;for(fe=0,be=0;fe<X.length;fe++)Ee=X[fe],re.hasOwnProperty(Ee)?be++:($.push({command:_i.removeImport,args:[Ee]}),ae.splice(ae.indexOf(Ee,be),1));for(fe=0,be=0;fe<Z.length;fe++)Ee=Z[Z.length-1-fe],ae[ae.length-1-fe]!==Ee&&(te.hasOwnProperty(Ee)?($.push({command:_i.removeImport,args:[Ee]}),ae.splice(ae.lastIndexOf(Ee,ae.length-be),1)):be++,pe=ae[ae.length-fe],$.push({command:_i.addImport,args:[re[Ee],pe]}),ae.splice(ae.length-fe,0,Ee));for(const _e of q){const ve=te[_e.id];ve&&(delete ve.data,o.bv(ve,_e)||$.push({command:_i.updateImport,args:[_e.id,_e]}))}}(b.imports,I.imports,A),o.bv(b.transition,I.transition)||A.push({command:_i.setTransition,args:[I.transition]}),o.bv(b.light,I.light)||A.push({command:_i.setLight,args:[I.light]}),o.bv(b.fog,I.fog)||A.push({command:_i.setFog,args:[I.fog]}),o.bv(b.snow,I.snow)||A.push({command:_i.setSnow,args:[I.snow]}),o.bv(b.rain,I.rain)||A.push({command:_i.setRain,args:[I.rain]}),o.bv(b.projection,I.projection)||A.push({command:_i.setProjection,args:[I.projection]}),o.bv(b.lights,I.lights)||A.push({command:_i.setLights,args:[I.lights]}),o.bv(b.camera,I.camera)||A.push({command:_i.setCamera,args:[I.camera]}),o.bv(b.iconsets,I.iconsets)||function(U,q,$){let X;for(X in q=q||{},U=U||{})U.hasOwnProperty(X)&&(q.hasOwnProperty(X)||$.push({command:_i.removeIconset,args:[X]}));for(X in q){if(!q.hasOwnProperty(X))continue;const Z=q[X];U.hasOwnProperty(X)?o.bv(U[X],Z)||($.push({command:_i.removeIconset,args:[X]}),$.push({command:_i.addIconset,args:[X,Z]})):$.push({command:_i.addIconset,args:[X,Z]})}}(b.iconsets,I.iconsets,A),!o.bv(b["color-theme"],I["color-theme"]))return[{command:_i.setStyle,args:[I]}];const D={},L=[];(function(U,q,$,X){let Z;for(Z in q=q||{},U=U||{})U.hasOwnProperty(Z)&&(q.hasOwnProperty(Z)||Wo(Z,$,X));for(Z in q){if(!q.hasOwnProperty(Z))continue;const te=q[Z];U.hasOwnProperty(Z)?o.bv(U[Z],te)||(U[Z].type==="geojson"&&te.type==="geojson"&&c_(U,q,Z)?$.push({command:_i.setGeoJSONSourceData,args:[Z,te.data]}):Pu(Z,q,$,X)):Ah(Z,q,$)}})(b.sources,I.sources,L,D);const B=[];b.layers&&b.layers.forEach(U=>{U.source&&D[U.source]?A.push({command:_i.removeLayer,args:[U.id]}):B.push(U)});let O=b.terrain;O&&D[O.source]&&(A.push({command:_i.setTerrain,args:[void 0]}),O=void 0),A=A.concat(L),o.bv(O,I.terrain)||A.push({command:_i.setTerrain,args:[I.terrain]}),function(U,q,$){q=q||[];const X=(U=U||[]).map(Ga),Z=q.map(Ga),te=U.reduce(ml,{}),re=q.reduce(ml,{}),ae=X.slice(),fe=Object.create(null);let be,Ee,pe,_e,ve,We,Le;for(be=0,Ee=0;be<X.length;be++)pe=X[be],re.hasOwnProperty(pe)?Ee++:($.push({command:_i.removeLayer,args:[pe]}),ae.splice(ae.indexOf(pe,Ee),1));for(be=0,Ee=0;be<Z.length;be++)pe=Z[Z.length-1-be],ae[ae.length-1-be]!==pe&&(te.hasOwnProperty(pe)?($.push({command:_i.removeLayer,args:[pe]}),ae.splice(ae.lastIndexOf(pe,ae.length-Ee),1)):Ee++,We=ae[ae.length-be],$.push({command:_i.addLayer,args:[re[pe],We]}),ae.splice(ae.length-be,0,pe),fe[pe]=!0);for(be=0;be<Z.length;be++)if(pe=Z[be],_e=te[pe],ve=re[pe],!fe[pe]&&!o.bv(_e,ve))if(o.bv(_e.source,ve.source)&&o.bv(_e["source-layer"],ve["source-layer"])&&o.bv(_e.type,ve.type)){for(Le in Fl(_e.layout,ve.layout,$,pe,null,_i.setLayoutProperty),Fl(_e.paint,ve.paint,$,pe,null,_i.setPaintProperty),o.bv(_e.slot,ve.slot)||$.push({command:_i.setSlot,args:[pe,ve.slot]}),o.bv(_e.filter,ve.filter)||$.push({command:_i.setFilter,args:[pe,ve.filter]}),o.bv(_e.minzoom,ve.minzoom)&&o.bv(_e.maxzoom,ve.maxzoom)||$.push({command:_i.setLayerZoomRange,args:[pe,ve.minzoom,ve.maxzoom]}),_e)_e.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?Fl(_e[Le],ve[Le],$,pe,Le.slice(6),_i.setPaintProperty):o.bv(_e[Le],ve[Le])||$.push({command:_i.setLayerProperty,args:[pe,Le,ve[Le]]}));for(Le in ve)ve.hasOwnProperty(Le)&&!_e.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?Fl(_e[Le],ve[Le],$,pe,Le.slice(6),_i.setPaintProperty):o.bv(_e[Le],ve[Le])||$.push({command:_i.setLayerProperty,args:[pe,Le,ve[Le]]}))}else $.push({command:_i.removeLayer,args:[pe]}),We=ae[ae.lastIndexOf(pe)+1],$.push({command:_i.addLayer,args:[ve,We]})}(B,I.layers,A)}catch(D){console.warn("Unable to compute style diff:",D),A=[{command:_i.setStyle,args:[I]}]}return A}(this.serialize(),r).filter(b=>!(b.command in c0));if(p.length===0)return!1;const y=p.filter(b=>!(b.command in l0));if(y.length>0)throw new Error(`Unimplemented: ${y.map(b=>b.command).join(", ")}.`);const x=[];return p.forEach(b=>{x.push(this[b.command](...b.args))}),c&&Promise.all(x).then(c).catch(c),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){if(r.size===0)return this;for(const[c,p]of r.entries()){if(this.getImage(c))return this.fire(new o.z(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(r,c){return this.getImage(r)?this.fire(new o.z(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(r,c,p=!1){this.imageManager.updateImage(r,this.scope,c),p&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(r){return this.modelManager.addModelURLs(r,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(r,c,p={}){return this._checkLoaded(),this._validate(le,`models.${r}`,c,null,p)||(this.modelManager.addModel(r,c,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope,!1,!0),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,c,p={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(dl,`sources.${r}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=dt(r,c,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const x=b=>{const I=(b?"symbol:":"other:")+y.id,A=o.C(I,this.scope),D=this._sourceCaches[I]=new Is(A,y,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=D,D.onAdd(this.map)};x(!1),c.type!=="vector"&&c.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const c=this.getOwnSource(r);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([x,b])=>b.type==="source"&&b.source===r);if(y)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while iconset "${y[0]}" is using it.`)))}const p=this.getOwnSourceCaches(r);for(const y of p){const x=o.dj(y.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(y.id),y.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getOwnSource(r).setData(c),this._changes.setDirty()}getOwnSource(r){const c=this.getOwnSourceCache(r);return c&&c.getSource()}getOwnSources(){const r=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&r.push(p.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const c in r){const p=r[c]._tiles;for(const y in p){const x=p[y];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const x of r){if(this._validate(Do,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(x),b.updateTransitions(c)}else this.ambientLight=new gi(x,ni||(ni=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(x),b.updateTransitions(c)}else this.directionalLight=new gi(x,br||(br=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),y=new o.aa(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,c=this.ambientLight;if(!r||!c)return;const p=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),y=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),x=r.properties.get("intensity"),b=r.properties.get("direction"),I=1-o.d1(b.x,b.y,b.z)[2]/90,A=p(y)*x*I,D=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=c.properties.get("intensity"),B=p(D)*L;return Number(((A+B)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(o.dk(r)){const c=o.dl(r),p=this.fragments.find(({id:x})=>x===c);if(!p)return;const y=o.dj(r);return p.style.getFragmentStyle(y)}{const c=this.fragments.find(({id:p})=>p===r);return c?c.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const c={},p=(y,x="")=>`${y}::${x}`;this._featuresetSelectors={};for(const y in r){const x=this._featuresetSelectors[y]=[];for(const b of r[y].selectors){if(b.featureNamespace){const A=this.getOwnLayer(b.layer);if(!A){o.w(`Layer is undefined for selector: ${b.layer}`);continue}const D=p(A.source,A.sourceLayer);if(D in c&&c[D]!==b.featureNamespace){o.w(`"featureNamespace ${b.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}c[D]=b.featureNamespace}let I;if(b.properties)for(const A in b.properties){const D=o.X(b.properties[A]);D.result==="success"&&(I=I||{},I[A]=D.value)}x.push({layerId:b.layer,namespace:b.featureNamespace,properties:I,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const c=this.getFragmentStyle(r);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const y in c.stylesheet.featuresets)p.push({featuresetId:y,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(r,c){const p=this.getFragmentStyle(c),y=p.stylesheet.featuresets;if(!y||!y[r])return this.fire(new o.z(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const b of y[r].selectors){const I=p.getOwnLayer(b.layer);I&&x.push(I)}return x}getConfigProperty(r,c){const p=this.getFragmentStyle(r);if(!p)return null;const y=o.C(c,p.scope),x=p.options.get(y),b=x?x.value||x.default:null;return b?b.serialize():null}setConfigProperty(r,c,p){const y=this.getFragmentStyle(r);if(!y)return;const x=y.stylesheet.indoor?s0(y.stylesheet.schema):y.stylesheet.schema;if(!x||!x[c])return;const b=o.X(p);if(b.result!=="success")return void qc(this,b.value);const I=b.value.expression,A=o.C(c,y.scope),D=y.options.get(A);if(!D)return;let L;const{minValue:B,maxValue:O,stepValue:U,type:q,values:$}=x[c],X=o.X(x[c].default);X.result==="success"&&(L=X.value.expression),L?(this.options.set(A,Object.assign({},D,{value:I,default:L,minValue:B,maxValue:O,stepValue:U,type:q,values:$})),this.updateConfigDependencies(c)):this.fire(new o.z(new Error(`No schema defined for the config option "${c}" in the "${r}" fragment.`)))}getConfig(r){const c=this.getFragmentStyle(r);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const y={};for(const x in p){const b=o.C(x,c.scope),I=c.options.get(b),A=I?I.value||I.default:null;y[x]=A?A.serialize():null}return y}setConfig(r,c){const p=this.getFragmentStyle(r);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const c=this.getFragmentStyle(r);return c?c.stylesheet.schema:null}setSchema(r,c){const p=this.getFragmentStyle(r);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(r,c){if(this._config=r,r||c)if(c)for(const p in c){let y,x;const b=o.X(c[p].default);if(b.result==="success"&&(y=b.value.expression),r&&r[p]!==void 0){const O=o.X(r[p]);O.result==="success"&&(x=O.value.expression)}const{minValue:I,maxValue:A,stepValue:D,type:L,values:B}=c[p];if(y){const O=o.C(p,this.scope);this.options.set(O,{default:y,value:x,minValue:I,maxValue:A,stepValue:D,type:L,values:B})}else this.fire(new o.z(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const c of this._configDependentLayers){const p=this.getLayer(c);if(p){if(r&&!p.configDependencies.has(r))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const y=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&y!==""||c._styleColorTheme.lut&&y!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(r,c,p={}){this._checkLoaded();const y=r.id;if(this._layers[y])return void this.fire(new o.z(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(r.type==="custom"){if(qc(this,o.dm(r)))return;x=o.dn(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(y,r.source),r=o.di(r),r=o.h(r,{source:y})),this._validate(fi,`layers.${y}`,r,{arrayIndex:-1},p))return;x=o.dn(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let b=this._order.length;if(c){const L=this._order.indexOf(c);if(L===-1)return void this.fire(new o.z(new Error(`Layer with id "${c}" does not exist on this map.`)));x.slot===this._layers[c].slot?b=L:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const I=this.getOwnLayerSourceCache(x),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&x.canCastShadows()&&A&&(I.castsShadows=!0);const D=this._changes.getRemovedLayer(x);if(D&&x.source&&I&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const L=o.C(x.source,x.scope);D.type!==x.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),I.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(r,c){this._checkLoaded();const p=this._checkLayer(r);if(!p||r===c)return;const y=this._order.indexOf(r);this._order.splice(y,1);let x=this._order.length;if(c){const b=this._order.indexOf(c);if(b===-1)return void this.fire(new o.z(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?x=b:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const c=this._checkLayer(r);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const y=this.getOwnLayerSourceCache(c);if(y&&y.castsShadows){let x=!1;for(const b in this._layers)if(this._layers[b].source===c.source&&this._layers[b].canCastShadows()){x=!0;break}y.castsShadows=x}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,p){this._checkLoaded();const y=this._checkLayer(r);y&&(y.minzoom===c&&y.maxzoom===p||(c!=null&&(y.minzoom=c),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,c){this._checkLoaded();const p=this._checkLayer(r);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(r,c,p={}){this._checkLoaded();const y=this._checkLayer(r);if(y&&!o.bv(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(Ge,`layers.${y.id}.filter`,c,{layerType:y.type},p)||(y.filter=o.di(c),this._updateLayer(y)))}getFilter(r){const c=this._checkLayer(r);if(c)return o.di(c.filter)}setLayoutProperty(r,c,p,y={}){this._checkLoaded();const x=this._checkLayer(r);if(x&&!o.bv(x.getLayoutProperty(c),p)){if(p!=null&&(!y||y.validate!==!1)&&qc(x,J.call(Bs,{key:`layers.${r}.layout.${c}`,layerType:x.type,objectKey:c,value:p,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(c,p),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(r,c){const p=this._checkLayer(r);if(p)return p.getLayoutProperty(c)}setPaintProperty(r,c,p,y={}){this._checkLoaded();const x=this._checkLayer(r);if(!x||o.bv(x.getPaintProperty(c),p)||p!=null&&(!y||y.validate!==!1)&&qc(x,Y.call(Bs,{key:`layers.${r}.paint.${c}`,layerType:x.type,objectKey:c,value:p,styleSpec:o.a5})))return;const b=x.setPaintProperty(c,p);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),b&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(r,c){const p=this._checkLayer(r);if(p)return p.getPaintProperty(c)}setFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:A,importId:D}=r.target,L=this.getFragmentStyle(D),B=L.getFeaturesetLayers(A);for(const{source:O,sourceLayer:U}of B)L.setFeatureState({id:r.id,source:O,sourceLayer:U},c)}else if("layerId"in r.target){const{layerId:A}=r.target,D=this.getLayer(A);this.setFeatureState({id:r.id,source:D.source,sourceLayer:D.sourceLayer},c)}return}const p=r.source,y=r.sourceLayer,x=this._checkSource(p);if(!x)return;const b=x.type;if(b==="geojson"&&y)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!y)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(p);for(const A of I)A.setFeatureState(y,r.id,c)}removeFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:A,importId:D}=r.target,L=this.getFragmentStyle(D),B=L.getFeaturesetLayers(A);for(const{source:O,sourceLayer:U}of B)L.removeFeatureState({id:r.id,source:O,sourceLayer:U},c)}else if("layerId"in r.target){const{layerId:A}=r.target,D=this.getLayer(A);this.removeFeatureState({id:r.id,source:D.source,sourceLayer:D.sourceLayer},c)}return}const p=r.source,y=this._checkSource(p);if(!y)return;const x=y.type,b=x==="vector"?r.sourceLayer:void 0;if(x==="vector"&&!b)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(p);for(const A of I)A.removeFeatureState(b,r.id,c)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let x;if("featuresetId"in r.target){const{featuresetId:b,importId:I}=r.target,A=this.getFragmentStyle(I),D=A.getFeaturesetLayers(b);for(const{source:L,sourceLayer:B}of D){const O=A.getFeatureState({id:r.id,source:L,sourceLayer:B});if(O&&!x)x=O;else if(!o.bv(x,O))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:b}=r.target,I=this.getLayer(b);x=this.getFeatureState({id:r.id,source:I.source,sourceLayer:I.sourceLayer})}return x}const c=r.source,p=r.sourceLayer,y=this._checkSource(c);if(y){if(y.type!=="vector"||p)return r.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,r.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=o.h({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),c=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(r){for(const c of Object.values(this._mergedLayers))r(c)&&this._updateLayer(c)}_updateLayer(r){this._changes.updateLayer(r);const c=this.getLayerSourceCache(r),p=o.C(r.source,r.scope),y=this._changes.getUpdatedSourceCaches();r.source&&!y[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=I=>this._mergedLayers[I].is3D(!!this.terrain),p=this.order,y={},x=[];for(let I=p.length-1;I>=0;I--){const A=p[I];if(c(A)){y[A]=I;for(const D of r){const L=D[A];if(L)for(const B of L)x.push(B)}}}x.sort((I,A)=>A.intersectionZ-I.intersectionZ);const b=[];for(let I=p.length-1;I>=0;I--){const A=p[I];if(c(A))for(let D=x.length-1;D>=0;D--){const L=x[D].feature;if(L.layer&&y[L.layer.id]<I)break;b.push(L),x.pop()}else for(const D of r){const L=D[A];if(L)for(const B of L)b.push(B.feature)}}return b}queryRenderedFeatures(r,c,p){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ge,"queryRenderedFeatures.filter",c.filter,null,c),y=o.b3(c.filter));const x={},b=L=>{if(Lp.has(L.type))return;const B=this.getOwnLayerSourceCache(L),O=x[B.id]=x[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[L.fqid]=O.layers[L.fqid]||{styleLayer:L,targets:[]},O.layers[L.fqid].targets.push({filter:y})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const L of c.layers){const B=this._layers[L];if(!B)return this.fire(new o.z(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];b(B)}}else for(const L in this._layers)b(this._layers[L]);const I=this._queryRenderedFeatures(r,x,p),A=this._flattenAndSortRenderedFeatures(I),D=[];for(const L of A)o.dq(L.layer.id)===this.scope&&D.push(L);return D}queryRenderedFeatureset(r,c,p){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ge,"queryRenderedFeatures.filter",c.filter,null,c),y=o.b3(c.filter));const x="mock",b=[];if(c&&c.target)b.push(Object.assign({},c,{targetId:x,filter:y}));else{const L=this.getFeaturesetDescriptors();for(const B of L)b.push({targetId:x,filter:y,target:B});for(const{style:B}of this.fragments){const O=B.getFeaturesetDescriptors();for(const U of O)b.push({targetId:x,filter:y,target:U})}}const I=this.queryRenderedTargets(r,b,p),A=[],D=new Set;for(const L of I)for(const B of L.variants[x])ut(B,L,D)||A.push(new o.dr(L,B));return A}queryRenderedTargets(r,c,p){const y={},x=(I,A,D,L)=>{const B=y[A.id]=y[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(B.layers[I.fqid]=B.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(B.has3DLayers=!0),!L)return D.uniqueFeatureID=!1,void B.layers[I.fqid].targets.push(D);B.layers[I.fqid].targets.push(Object.assign({},D,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const I of c)if("featuresetId"in I.target){const{featuresetId:A,importId:D}=I.target,L=this.getFragmentStyle(D);if(!L||!L._featuresetSelectors)continue;const B=L._featuresetSelectors[A];if(!B){this.fire(new o.z(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of B){const U=L.getOwnLayer(O.layerId);U&&!Lp.has(U.type)&&x(U,L.getOwnLayerSourceCache(U),I,O)}}else if("layerId"in I.target){const{layerId:A}=I.target,D=this.getLayer(A);if(!D||Lp.has(D.type))continue;x(D,this.getLayerSourceCache(D),I)}const b=this._queryRenderedFeatures(r,y,p);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(r,c,p){const y=[],x=!!this.map._showQueryGeometry,b=ci.createFromScreenPoints(r,p);for(const I in c){const A=$t(b,c[I],this._availableImages,p,x);Object.keys(A).length&&y.push(A)}if(this.placement)for(const I in c){if(!c[I].sourceCache._onlySymbols)continue;const A=rn(b.screenGeometry,c[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&y.push(A)}return y}querySourceFeatures(r,c){const p=c&&c.filter;p&&this._validate(Ge,"querySourceFeatures.filter",p,null,c);let y=[];const x=this.getOwnSourceCaches(r);for(const b of x)y=y.concat(cn(b,c));return y}addSourceType(r,c,p){return Wa.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Wa.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,c,p={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const I in r)if(!o.bv(r[I],y[I])){x=!0;break}if(!x)return;const b=this._getTransitionParameters();this.light.setLight(r,c,p),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,c=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=r;const y=r.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const I="terrain-dem-src";this.addSource(I,p.source),p=o.di(p),p=o.h(p,{source:I})}const x=o.h({},p),b={};if(this.terrain&&y){x.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(b.style=I.serialize())}if(this._validate(bt,"terrain",x,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new o.A("data",{dataType:"style"}))}else{const x=this.terrain,b=x.get();for(const I of Object.keys(o.a5.terrain))!p.hasOwnProperty(I)&&o.a5.terrain[I].default&&(p[I]=o.a5.terrain[I].default);for(const I in r)if(!o.bv(r[I],b[I])){x.set(r,this.options),this.stylesheet.terrain=r;const A=this._getTransitionParameters({duration:0});x.updateTransitions(A),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new Nn(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(r){const c=this.snow=new Tr(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(r){const c=this.rain=new jr(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!o.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!o.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!o.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void r();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new o.A("colorthemeset")),r()}).catch(y=>{o.w(`Couldn't set color theme: ${y}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,c){const p=this.getFragmentStyle(r);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(r){return{now:o.q.now(),transition:o.h(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?r.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const p=this.terrain=new Fe(r,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="symbol"&&this._updateLayer(c)}}_validate(r,c,p,y,x={}){if(x&&x.validate===!1)return!1;const b=o.h({},this.serialize());return qc(this,r.call(Bs,o.h({key:c,style:b,value:p,styleSpec:o.a5},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const c=this.getSourceCaches(r);for(const p of c)p.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}clearLayers(){for(const r in this._mergedLayers){const c=this._mergedLayers[r];c._clear&&c._clear()}}reloadSource(r){const c=this.getSourceCaches(r);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let c;this.directionalLight&&(c=Mh(this.directionalLight));const p=new Set;for(const y in this._mergedLayers){const x=this._mergedLayers[y];x.hasElevation()&&!p.has(x.source)&&p.add(x.source)}for(const y in this._mergedSourceCaches){const x=this._mergedSourceCaches[y],b=p.has(x._source.id);x.update(r,void 0,void 0,c,b)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,p,y,x,b,I=!1){let A=!1,D=!1;const L={},B={};for(const O of this._mergedOrder){const U=this._mergedLayers[O];if(U.type!=="symbol")continue;const q=o.C(U.source,U.scope);let $=L[q];if(!$){const Z=this.getLayerSourceCache(U);if(!Z)continue;const te=Z.getRenderableIds(!0).map(re=>Z.getTileByID(re));B[q]=te.slice(),$=L[q]=te.sort((re,ae)=>ae.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ae.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(U,$,c.center.lng,c.projection);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),c.zoom))&&(this.pauseablePlacement=new ee(c,this._mergedOrder,I,p,y,x,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,B,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),D=!0),A&&this.pauseablePlacement.placement.setStale()),D||A){this._buildingIndex.onNewFrame(c.zoom);for(let O=0;O<this._mergedOrder.length;O++){const U=this._mergedLayers[this._mergedOrder[O]];if(U.type!=="symbol")continue;const q=this.isLayerClipped(U);this.placement.updateLayerOpacities(U,L[o.C(U.source,U.scope)],O,q?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:x})=>x===r.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!c)return p.push(r),this._loadImports([r],!0);const y=p.findIndex(({id:x})=>x===c);return y===-1&&this.fire(new o.z(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(r).concat(p.slice(y)),this._loadImports([r],!0,c)}updateImport(r,c){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);return y===-1?this:typeof c=="string"?(this.setImportUrl(r,c),this):(c.url&&c.url!==p[y].url&&this.setImportUrl(r,c.url),o.bv(c.config,p[y].config)||this.setImportConfig(r,c.config,c.data.schema),o.bv(c.data,p[y].data)||this.setImportData(r,c.data),this)}moveImport(r,c){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(r);if(y===-1)return this;const x=this.getImportIndex(c);if(x===-1)return this;const b=p[y],I=this.fragments[y];return p=p.filter(({id:A})=>A!==r),this.fragments=this.fragments.filter(({id:A})=>A!==r),this.stylesheet.imports=p.slice(0,x).concat(b).concat(p.slice(x)),this.fragments=this.fragments.slice(0,x).concat(I).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(r,c){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);if(y===-1)return this;p[y].url=c;const x=this.fragments[y];return x.style=this._createFragmentStyle(p[y]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(c),this}setImportData(r,c){this._checkLoaded();const p=this.getImportIndex(r),y=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(r,y[p].url))}setImportConfig(r,c,p){this._checkLoaded();const y=this.getImportIndex(r),x=this.stylesheet.imports||[];if(y===-1)return this;c?x[y].config=c:delete x[y].config;const b=this.fragments[y];p&&b.style.stylesheet&&(b.style.stylesheet.schema=p);const I=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=c,b.style.updateConfig(c,I),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(r);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(r){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===r);return c===-1&&this.fire(new o.z(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),c}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&r.push(p.getSource())}return r}getSource(r,c){const p=this.getSourceCache(r,c);return p&&p.getSource()}getLayerSource(r){const c=this.getLayerSourceCache(r);return c&&c.getSource()}getSourceCache(r,c){const p=o.C(r,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(r){const c=o.C(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[r]&&c.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&c.push(this._mergedSymbolSourceCaches[r]),c}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const c in r){const p=r[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(r){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const y=this.getLayer(p);y&&y.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r)}getImages(r,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const y=b=>{if(b){const I=c.images.map(A=>o.I.toString(A));b.setDependencies(c.tileID.key,c.type,I)}},x=o.C(c.source,c.scope);y(this._mergedOtherSourceCaches[x]),y(this._mergedSymbolSourceCaches[x]),c.images.some(b=>b.iconsetId)&&this.fire(new o.A("data",{dataType:"style"}))}rasterizeImages(r,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(r,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(r,c,p){return o.dt(c,p)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this.getOwnSourceCaches(r);return c.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${r}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,c){if(!this._clipLayerPresent&&r.type!=="fill-extrusion"&&r.type!=="building")return!1;const p=r.type==="fill-extrusion"&&(r.sourceLayer==="building"||r.sourceLayer==="procedural_buildings"),y=r.type==="building";if(r.is3D(!!this.terrain)){if(p||y||c&&c.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wa.getSourceType=function(f){return ze[f]},Wa.setSourceType=function(f,r){ze[f]=r},Wa.registerForPluginStateChange=o.du;var f_=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Lh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Oh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,p_="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Op=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Pa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,zp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Bt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,m_=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Fp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Np=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const pf=[];yl(f_,pf),yl(Oh,pf),yl(Lh,pf);const zu={"_prelude_fog.vertex.glsl":Pa,"_prelude_terrain.vertex.glsl":Op,"_prelude_shadow.vertex.glsl":Fp,"_prelude_fog.fragment.glsl":zp,"_prelude_shadow.fragment.glsl":Np,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Bt,"_prelude_raster_particle.glsl":m_},Za={};hi("",Op),hi(zp,Pa),hi(Np,Fp),hi(Bt,""),hi(m_,"");const Bp=hi(Lh,Oh),Zc=f_;var mf={background:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:hi(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:hi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:hi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:hi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:hi(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:hi(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:hi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:hi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:hi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:hi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:hi("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:hi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:hi(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:hi(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:hi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:hi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,p_),skyboxGradient:hi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,p_),skyboxCapture:hi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:hi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:hi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:hi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:hi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:hi("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:hi("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:hi("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:hi("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function yl(f,r){const c=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const x of y)r.includes(x)||r.push(x)}}function hi(f,r){const c=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(D=>{const L=D.split(" ");return L[L.length-1]}),y=[...new Set(y)]);const x={},b=[],I=[];if(f=f.replace(c,(D,L)=>(I.push(L),"")),(r=r.replace(c,(D,L)=>(b.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...pf];yl(f,A),yl(r,A);for(const D of[...b,...I])zu[D]||console.error(`Undefined include: ${D}`),Za[D]||(Za[D]=[],yl(zu[D],Za[D])),A=[...A,...Za[D]];return{fragmentSource:f=f.replace(p,(D,L,B,O,U)=>(x[U]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${B} ${O} ${U};
#else
uniform ${B} ${O} u_${U};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${B} ${O} ${U} = u_${U};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${B} ${O} ${U};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(p,(D,L,B,O,U)=>{const q=O==="float"?"vec2":O,$=U.match(/color/)?"color":q;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${B} ${O} a_${U};
#endif
`:x[U]?L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${B} ${q} a_${U};
out ${B} ${O} ${U};
#else
uniform ${B} ${O} u_${U};
#endif
`:L==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${B} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${$}(a_${U}, u_${U}_t);
#else
    ${B} ${O} ${U} = u_${U};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${B} ${O} a_${U};
    out ${B} ${O} ${U};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${B} ${q} a_${U};
#else
uniform ${B} ${O} u_${U};
#endif
`:L==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${B} ${O} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${q} a_${U};
#else
uniform ${B} ${O} u_${U};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${B} ${O} ${U} = a_${U};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${B} ${O} ${U} = a_${U};
#else
    ${B} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${B} ${O} ${U} = unpack_mix_${$}(a_${U}, u_${U}_t);
#else
    ${B} ${O} ${U} = u_${U};
#endif
`}),staticAttributes:y,usedDefines:A,vertexIncludes:b,fragmentIncludes:I}}class sE{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,p,y,x,b,I,A){this.context=r;let D=this.boundPaintVertexBuffers.length!==y.length;for(let B=0;!D&&B<y.length;B++)this.boundPaintVertexBuffers[B]!==y[B]&&(D=!0);let L=this.boundDynamicVertexBuffers.length!==I.length;for(let B=0;!L&&B<I.length;B++)this.boundDynamicVertexBuffers[B]!==I[B]&&(L=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||D||L||this.boundIndexBuffer!==x||this.boundVertexOffset!==b)this.freshBind(c,p,y,x,b,I,A);else{r.bindVertexArrayOES.set(this.vao);for(const B of I)B&&(B.bind(),A&&B.instanceCount&&B.setVertexAttribDivisor(r.gl,c,A));x&&x.dynamicDraw&&x.bind()}}freshBind(r,c,p,y,x,b,I){const A=r.numAttributes,D=this.context,L=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=b,c.enableAttributes(L,r),c.bind(),c.setVertexAttribPointers(L,r,x);for(const B of p)B.enableAttributes(L,r),B.bind(),B.setVertexAttribPointers(L,r,x);for(const B of b)B&&(B.enableAttributes(L,r),B.bind(),B.setVertexAttribPointers(L,r,x),I&&B.instanceCount&&B.setVertexAttribDivisor(L,r,I));y&&y.bind(),D.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function g_(f,r){const c=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new o.ac(0,p/c).toLngLat().lat,new o.ac(0,(p+1)/c).toLngLat().lat]}function oE(f,r,c,p,y,x,b){const I=f.context,A=I.gl,D=c.hillshadeFBO;if(!D)return;f.prepareDrawTile();const L=f.isTileAffectedByFog(r),B=f.getOrCreateProgram("hillshade",{overrideFog:L});I.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,D.colorAttachment.get());const O=((X,Z,te,re)=>{const ae=te.paint.get("hillshade-shadow-color"),fe=te.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=te.paint.get("hillshade-highlight-color"),Ee=te.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",pe=te.paint.get("hillshade-accent-color"),_e=te.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ve=te.paint.get("hillshade-emissive-strength");let We=o.al(te.paint.get("hillshade-illumination-direction"));if(te.paint.get("hillshade-illumination-anchor")==="viewport")We-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){const lt=X.style.directionalLight.properties.get("direction"),Ye=o.d1(lt.x,lt.y,lt.z);We=o.al(Ye[1])}const Le=!X.options.moving;return{u_matrix:re||X.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),Le),u_image:0,u_latrange:g_(0,Z.tileID),u_light:[te.paint.get("hillshade-exaggeration"),We],u_shadow:ae.toPremultipliedRenderColor(fe?null:te.lut),u_highlight:be.toPremultipliedRenderColor(Ee?null:te.lut),u_emissive_strength:ve,u_accent:pe.toPremultipliedRenderColor(_e?null:te.lut)}})(f,c,p,f.terrain?r.projMatrix:null);f.uploadCommonUniforms(I,B,r.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:q,tileBoundsSegments:$}=f.getTileBoundsBuffers(c);B.draw(f,A.TRIANGLES,y,x,b,yn.disabled,O,p.id,U,q,$)}function __(f,r,c){if(!r.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(c.stride);const x=c.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new o.T(p,x,y.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function u0(f,r,c){const p=f.context,y=p.gl;if(!r.dem)return;const x=r.dem;if(p.activeTexture.set(y.TEXTURE1),__(f,r,x),!r.demTexture)return;r.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const b=x.dim;p.activeTexture.set(y.TEXTURE0);let I=r.hillshadeFBO;if(!I){const O=new o.T(p,{width:b,height:b,data:null},y.RGBA8);O.bind(y.LINEAR,y.CLAMP_TO_EDGE),I=r.hillshadeFBO=p.createFramebuffer(b,b,!0,"renderbuffer"),I.colorAttachment.set(O.texture)}p.bindFramebuffer.set(I.framebuffer),p.viewport.set([0,0,b,b]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:D,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),B=[];f.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(f,y.TRIANGLES,Ut.disabled,bn.disabled,pn.unblended,yn.disabled,((O,U)=>{const q=U.stride,$=o.bz();return o.ca($,0,o.aj,-o.aj,0,0,1),o.bo($,$,[0,-o.aj,0]),{u_matrix:$,u_image:1,u_dimension:[q,q],u_zoom:O.overscaledZ}})(r.tileID,x),c.id,A,D,L),r.needsHillshadePrepare=!1}class Er{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class aE extends Er{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class lE extends Er{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class cE extends Er{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class uE extends Er{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class h0 extends Er{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class hE extends Er{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Vp extends Er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class dE extends Er{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class d0 extends Er{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class y_ extends Er{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Up extends Er{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class v_ extends Er{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Fu extends Er{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class zh extends Er{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class jp extends Er{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Gp extends Er{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Fh extends Er{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class f0 extends Er{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class x_ extends Er{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let p0=class extends Er{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Nh extends Er{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class $p extends Er{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Hp extends Er{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class w_ extends Er{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class qp extends Er{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class gf extends Er{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class m0 extends Er{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class g0 extends Er{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class _0 extends Er{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Bh extends Er{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class y0 extends Er{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class b_ extends Er{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class fE extends b_{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class v0 extends b_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class T_ extends b_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class E_ extends v0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const I_=(f,r,c)=>({u_matrix:f,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:c}),Wp=(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:b,u_frustum_tr:I,u_frustum_br:A,u_frustum_bl:D,u_globe_pos:L,u_globe_radius:B,u_viewport:O,u_grid_matrix:$?Float32Array.from($):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:q});function S_(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}const Nu=new class{constructor(){this.operations={}}newMorphing(f,r,c,p,y){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:y,from:r,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const c=this.operations[r];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},x0={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Vh(f,r,c){if(r===0)return 0;const p=r<1&&c===514?.25/r:1;return 6*Math.pow(1.5,22-f)*Math.max(r,1)*p}function _f(f,r){const c=1<<f.z;return!r&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}const Zp=f=>({u_matrix:f});function Zo(f,r,c,p,y){if(y>0){const x=o.q.now(),b=(x-f.timeAdded)/y,I=r?(x-r.timeAdded)/y:-1,A=c.getSource(),D=p.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),L=!r||Math.abs(r.tileID.overscaledZ-D)>Math.abs(f.tileID.overscaledZ-D),B=L&&f.refreshedUponExpiration?1:o.ay(L?b:1-I,0,1);return f.refreshedUponExpiration&&b>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class A_ extends Is{constructor(r){const c=dt("mock-dem",{type:"raster-dem",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class Xp extends Is{constructor(r){const c=dt("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,p){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,b)=>{if(x[b.key]="",!this._tiles[b.key]){const I=new Sa(b,this._source.tileSize*b.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[b.key]=I}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const c=this.proxyCachedFBO[r];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class yf extends o.aM{constructor(r,c,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class Kp extends o.dF{constructor(r,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,x]=function(A){const D=new o.ba,L=new o.a_,B=131;D.reserve(17161),L.reserve(33800);const O=o.aj/128,U=o.aj+O/2,q=U+O;for(let X=-O;X<q;X+=O)for(let Z=-O;Z<q;Z+=O){const te=Z<0||Z>U||X<0||X>U?24575:0,re=o.ay(Math.round(Z),0,o.aj),ae=o.ay(Math.round(X),0,o.aj);D.emplaceBack(re+te,ae)}const $=(X,Z)=>{const te=Z*B+X;L.emplaceBack(te+1,te,te+B),L.emplaceBack(te+B,te+B+1,te+1)};for(let X=1;X<129;X++)for(let Z=1;Z<129;Z++)$(Z,X);return[0,129].forEach(X=>{for(let Z=0;Z<130;Z++)$(Z,X),$(X,Z)}),[D,L,32768]}(),b=r.context;this.gridBuffer=b.createVertexBuffer(p,o.bc.members),this.gridIndexBuffer=b.createIndexBuffer(y),this.gridSegments=o.bd.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Xp(c.map),this.orthoMatrix=o.bz(),o.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const I=b.gl;this._overlapStencilMode=new bn({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new A_(c.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,p){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const y=r.terrain.properties,x=r.terrain.drapeRenderMode===0,b=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const I=r.terrain&&r.terrain.scope,A=y.get("source"),D=x?this._mockSourceCache:r.getSourceCache(A,I);if(!D)return void o.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=D,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(c):y.get("exaggeration"),!c.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(c,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const c=this._previousCameraAltitude,p=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=p;const y=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const x=r.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(x);let I=x-this._previousZoom;const A=this._previousUpdateTimestamp;let D=x;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(x-D)>.5&&(I=.5*(x-D+I)),I*y<0&&(D+=I)),this._evaluationZoom=D;const L=b.getExaggeration(D),B=L===b.getExaggeration(Math.max(0,D-.1));if(B&&Math.abs(L-this._exaggeration)<.01)return L;let O=Math.min(.1,.00375*(this._updateTimestamp-A));return(B||L<.1||Math.abs(I)<1e-4)&&(O=Math.min(.2,4*O)),o.ai(this._exaggeration,L,O)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(A=>{const D=c.getTileByID(A).tileID;return D.projMatrix=p.calculateProjMatrix(D.toUnwrapped()),D});(function(A,D){const L=D.transform.pointCoordinate(D.transform.getCameraPoint()),B=new o.P(L.x,L.y);A.sort((O,U)=>{if(U.overscaledZ-O.overscaledZ)return U.overscaledZ-O.overscaledZ;const q=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),$=new o.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),X=B.mult(1<<O.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(q)-X.distSqr($)})})(y,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const A in b){const D=b[A];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,r[A],x),D.usedForTerrain))continue;const L=r[A];D.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=y.map(A=>new yf(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const D=this.terrainTileForTile[A.key];if(!D)continue;const L=D.tileID.key;L in I||(this._visibleDemTiles.push(D),I[L]=L)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),__(this.painter,y,x))}}_prepareDemTileUniforms(r,c,p,y){if(!c||c.demTexture==null)return!1;const x=r.tileID.canonical,b=Math.pow(2,c.tileID.canonical.z-x.z),I=y||"";return p[`u_dem_tl${I}`]=[x.x*b%1,x.y*b%1],p[`u_dem_scale${I}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const c=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const x=y.dem.tree.minimums[0];return x>0&&r++,p+x},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new o.dG({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(r,y,c.R32F,{premultiply:!1}),x}setupElevationDraw(r,c,p){const y=this.painter.context,x=y.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let I=null,A=null,D=1;if(p&&p.morphing&&this._useVertexMorphing){const U=p.morphing.srcDemTile,q=p.morphing.dstDemTile;D=p.morphing.phase,U&&q&&(this._prepareDemTileUniforms(r,U,b,"_prev")&&(A=U),this._prepareDemTileUniforms(r,q,b)&&(I=q))}const L=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let B=null;var O;if(this.enabled?A&&I?(B=I.demTexture,y.activeTexture.set(x.TEXTURE4),A.demTexture.bind(L(A),x.CLAMP_TO_EDGE),b.u_dem_lerp=D):(I=this.terrainTileForTile[r.tileID.key],B=this._prepareDemTileUniforms(r,I,b)?I.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,y.activeTexture.set(x.TEXTURE2),B&&(b.u_dem_size=(O=B).size[0]===1?1:O.size[0]-2,B.bind(L(I),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,b),p&&p.useMeterToDem&&I){const U=(1<<I.tileID.canonical.z)*o.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=U}if(p&&p.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(y,b),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,U)}}globeUniformValues(r,c,p){const y=r.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,o.aj,0),u_tile_br_up:y.upVector(c,o.aj,o.aj),u_tile_bl_up:y.upVector(c,0,o.aj),u_tile_up_scale:p?o.dH(1):y.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,x,b,I,A){if(y.transform.projection.name==="globe")(function(D,L,B,O,U){const q=D.context,$=q.gl;let X,Z;const te=D.transform,re=o.dy(D,q,te),ae=(lt,Ye)=>{if(Z===Ye)return;const ft=[x0[Ye],"PROJECTION_GLOBE_VIEW"];re&&ft.push("CUSTOM_ANTIALIASING");const kt=D.isTileAffectedByFog(lt);X=D.getOrCreateProgram("globeRaster",{defines:ft,overrideFog:kt}),Z=Ye},fe=D.colorModeForRenderPass(),be=new Ut($.LEQUAL,Ut.ReadWrite,D.depthRangeFor3D);Nu.update(U);const Ee=o.dz(te),pe=[o.aD(te.center.lng),o.aH(te.center.lat)],_e=D.globeSharedBuffers,ve=[te.width*o.q.devicePixelRatio,te.height*o.q.devicePixelRatio],We=Float32Array.from(te.globeMatrix),Le={useDenormalizedUpVectorScale:!0};{const lt=D.transform,Ye=Vh(lt.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Z=-1;const ft=$.TRIANGLES;for(const kt of O){const Ze=B.getTile(kt),Ce=bn.disabled,rt=L.prevTerrainTileForTile[kt.key],Ke=L.terrainTileForTile[kt.key];S_(rt,Ke)&&Nu.newMorphing(kt.key,rt,Ke,U,250),q.activeTexture.set($.TEXTURE0),Ze.texture&&Ze.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const xt=Nu.getMorphValuesForProxy(kt.key),wt=xt?1:0;xt&&o.L(Le,{morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:o.dx(xt.phase)}});const Et=o.dA(kt.canonical),Nt=o.dB(Et.getCenter().lat),tn=o.dC(kt.canonical,Et,Nt,lt.worldSize/lt._pixelsPerMercatorPixel),dn=o.bh(o.dD(kt.canonical)),qt=Wp(lt.expandedFarZProjMatrix,We,Ee,dn,o.ah(lt.zoom),pe,lt.frustumCorners.TL,lt.frustumCorners.TR,lt.frustumCorners.BR,lt.frustumCorners.BL,lt.globeCenterInViewSpace,lt.globeRadius,ve,Ye,lt._farZ,tn);if(ae(kt,wt),X&&(L.setupElevationDraw(Ze,X,Le),D.uploadCommonUniforms(q,X,kt.toUnwrapped()),_e)){const[hn,an,Rn]=_e.getGridBuffers(Nt,Ye!==0);X.draw(D,ft,be,Ce,fe,yn.backCCW,qt,"globe_raster",hn,an,Rn)}}}if(_e&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&lt.push("CUSTOM_ANTIALIASING"),X=D.getOrCreateProgram("globeRaster",{defines:lt});for(const Ye of O){const{x:ft,y:kt,z:Ze}=Ye.canonical,Ce=kt===0,rt=kt===(1<<Ze)-1,[Ke,xt,wt,Et]=_e.getPoleBuffers(Ze,!1);if(Et&&(Ce||rt)){const Nt=B.getTile(Ye);q.activeTexture.set($.TEXTURE0),Nt.texture&&Nt.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let tn=o.dE(Ze,ft,te);const dn=o.bh(o.dD(Ye.canonical)),qt=(hn,an)=>hn.draw(D,$.TRIANGLES,be,bn.disabled,fe,yn.disabled,Wp(te.expandedFarZProjMatrix,tn,tn,dn,0,pe,te.frustumCorners.TL,te.frustumCorners.TR,te.frustumCorners.BR,te.frustumCorners.BL,te.globeCenterInViewSpace,te.globeRadius,ve,0,te._farZ),"globe_pole_raster",an,wt,Et);L.setupElevationDraw(Nt,X,Le),D.uploadCommonUniforms(q,X,Ye.toUnwrapped()),Ce&&D.renderDefaultNorthPole&&qt(X,Ke),rt&&D.renderDefaultSouthPole&&(tn=o.cP(o.bz(),tn,[1,-1,1]),qt(X,xt))}}}})(y,x,b,I,A);else{const D=y.context,L=D.gl;let B,O;const U=y.shadowRenderer,q=jl(y,y.longestCutoffRange),$=fe=>{if(O===fe)return;const be=[];be.push(x0[fe]),q.shouldRenderCutoff&&be.push("RENDER_CUTOFF"),U&&(be.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&be.push("NORMAL_OFFSET")),B=y.getOrCreateProgram("terrainRaster",{defines:be}),O=fe},X=y.colorModeForRenderPass(),Z=new Ut(L.LEQUAL,Ut.ReadWrite,y.depthRangeFor3D);Nu.update(A);const te=y.transform,re=Vh(te.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let ae=[0,0,0];if(U){const fe=y.style.directionalLight,be=y.style.ambientLight;fe&&be&&(ae=Ou(y.style,fe,be))}{O=-1;const fe=L.TRIANGLES,[be,Ee]=[x.gridIndexBuffer,x.gridSegments];for(const pe of I){const _e=b.getTile(pe),ve=bn.disabled,We=x.prevTerrainTileForTile[pe.key],Le=x.terrainTileForTile[pe.key];S_(We,Le)&&Nu.newMorphing(pe.key,We,Le,A,250),D.activeTexture.set(L.TEXTURE0),_e.texture&&_e.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const lt=Nu.getMorphValuesForProxy(pe.key),Ye=lt?1:0;let ft;lt&&(ft={morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:o.dx(lt.phase)}});const kt=I_(pe.projMatrix,_f(pe.canonical,te.renderWorldCopies)?re/10:re,ae);if($(Ye),!B)continue;x.setupElevationDraw(_e,B,ft);const Ze=pe.toUnwrapped();U&&U.setupShadows(Ze,B),y.uploadCommonUniforms(D,B,Ze,null,q),B.draw(y,fe,Z,ve,X,yn.backCCW,kt,"terrain_raster",x.gridBuffer,be,Ee)}}}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],b=this._drapedRenderBatches.shift(),I=c.style.order,A=[];let D=0;for(const L of x){const B=y.getTileByID(L.proxyTileKey),O=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][r]:void 0,U=O!==void 0?y.renderCache[O]:this.pool[D++],q=O!==void 0;if(B.texture=U.tex,q&&!U.dirty){A.push(B.tileID);continue}let $;p.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(p.clear({color:o.am.transparent,stencil:0}),U.dirty=!1);for(let X=b.start;X<=b.end;++X){const Z=c.style._mergedLayers[I[X]];if(Z.isHidden(c.transform.zoom))continue;const te=c.style.getLayerSourceCache(Z),re=te?this.proxyToSource[L.key][te.id]:[L];if(!re)continue;const ae=re;p.viewport.set([0,0,U.fb.width,U.fb.height]),$!==(te?te.id:null)&&(this._setupStencil(U,re,Z,te),$=te?te.id:null),c.renderLayer(c,te,Z,ae)}if(this._drapedRenderBatches.length===0)for(const X of this._pendingGroundEffectLayers){const Z=c.style._mergedLayers[I[X]];if(Z.isHidden(c.transform.zoom))continue;const te=c.style.getLayerSourceCache(Z),re=te?this.proxyToSource[L.key][te.id]:[L];if(!re)continue;const ae=re;p.viewport.set([0,0,U.fb.width,U.fb.height]),$!==(te?te.id:null)&&(this._setupStencil(U,re,Z,te),$=te?te.id:null),c.renderLayer(c,te,Z,ae)}this.renderedToTile?(U.dirty=!0,A.push(B.tileID)):q||--D,D===5&&(D=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),b.end+1}postRender(){}isLayerOrderingCorrect(r){const c=r.order.length;let p=-1,y=c;for(let x=0;x<c;++x)this._style.isLayerDraped(r._mergedLayers[r.order[x]])?p=Math.max(p,x):y=Math.min(y,x);return y>p}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,c,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const b=x.tileID,I=1<<b.overscaledZ,{x:A,y:D}=b.canonical,L=A/I,B=(A+1)/I,O=D/I,U=(D+1)/I;return{minx:L,miny:O,maxx:B,maxy:U,t:x.dem.tree.raycastRoot(L,O,B,U,r,c,p),tile:x}});y.sort((x,b)=>(x.t!==null?x.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const x of y){if(x.t==null)return null;const b=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,c,p);if(b!=null)return b}return null}_createFBO(){const r=this.painter.context,c=r.gl,p=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const y=new o.T(r,{width:p[0],height:p[1],data:null},c.RGBA8);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=r.createFramebuffer(p[0],p[1],!0,null);return x.colorAttachment.set(y.texture),x.depthAttachment=new E_(r,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._mergedLayers[r],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style.getSources())if(p instanceof fl){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(y);if(x&&!c[x.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof o.ab){c[x.id]=!0;for(const b of this.proxyCoords){const I=this.proxyToSource[b.key][x.id];if(I)for(const A of I)this._clearRenderCacheForTile(x.id,A)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof ye){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],x=this._style.getLayerSourceCache(y);if(!x||c[x.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const b=y.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const A=this.proxyToSource[I.key][x.id];if(A)for(const D of A){const L=Zo(x.getTile(D),x.findLoadedParent(D,0),x,this.painter.transform,b);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(x.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,c=r.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let y,x=0,b=this._style._mergedLayers[r[x]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++x<c;)b=this._style._mergedLayers[r[x]];for(;x<c;++x){const I=this._style._mergedLayers[r[x]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?y===void 0&&(y=x):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),y!==void 0&&(p.push({start:y,end:x-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:x-1}),p.length!==0){const I=p[p.length-1];this._pendingGroundEffectLayers.every(A=>A>I.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const b=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let I=0;I<b.length;++I){const A=Object.values(b[I]);c.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let b=p.length-1;b>=0;b--){const I=p[b];if(c.getTileByID(I.key),c.proxyCachedFBO[I.key]!==void 0){const A=r[I.key],D=this.proxyToSource[I.key];let L=0;for(const B in D){const O=D[B],U=A[B];if(!U||U.length!==O.length||O.some((q,$)=>q!==U[$]||y[B]&&y[B].hasOwnProperty(q.key))){L=-1;break}++L}for(const B in c.proxyCachedFBO[I.key])c.renderCache[c.proxyCachedFBO[I.key][B]].dirty=L<0||L!==Object.values(A).length}}const x=[...this._drapedRenderBatches];x.sort((b,I)=>I.end-I.start-(b.end-b.start));for(const b of x)for(const I of p){if(c.proxyCachedFBO[I.key])continue;let A=c.renderCachePool.pop();A===void 0&&c.renderCache.length<50&&(A=c.renderCache.length,c.renderCache.push(this._createFBO())),A!==void 0&&(c.proxyCachedFBO[I.key]={},c.proxyCachedFBO[I.key][b.start]=A,c.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,b=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=c.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):bn.disabled}_renderTileClippingMasks(r,c){const p=this.painter,y=this.painter.context,x=y.gl;p._tileClippingMaskIDs={},y.setColorMode(pn.disabled),y.setDepthMode(Ut.disabled);const b=p.getOrCreateProgram("clippingMask");for(const I of r){const A=p._tileClippingMaskIDs[I.key]=--c;b.draw(p,x.TRIANGLES,Ut.disabled,new bn({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),pn.disabled,yn.disabled,Zp(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const p=[r.x,r.y,1,1];o.aA(p,p,c.pixelMatrixInverse),o.cH(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const y=c._camera.position,x=o.cb(1,c.center.lat),b=[y[0],y[1],y[2]/x,0],I=o.d7([],p.slice(0,3),b);o.au(I,I);const A=this.raycast(b,I,this._exaggeration);return A!==null&&A?(o.bE(b,b,I,A),b[3]=b[2],b[2]*=x,b):null}_setupProxiedCoordsForOrtho(r,c,p){if(r.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(r,c,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let A=0;A<x.length;A++){const D=x[A],L=this._findTileCoveringTileID(D,r);if(L){const B=this._createProxiedId(D,L,p[D.key]&&p[D.key][r.id]);y.push(B),this.proxyToSource[D.key][r.id]=[B]}}let b=!1;const I=new Set;for(let A=0;A<c.length;A++){const D=r.getTile(c[A]);if(!D||!D.hasData())continue;const L=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==D.tileID.canonical.z){const B=this.proxyToSource[L.tileID.key][r.id],O=this._createProxiedId(L.tileID,D,p[L.tileID.key]&&p[L.tileID.key][r.id]);B?B.splice(B.length-1,0,O):this.proxyToSource[L.tileID.key][r.id]=[O];const U=this.proxyToSource[L.tileID.key][r.id];I.has(U)||I.add(U),y.push(O),b=!0}}if(this._sourceTilesOverlap[r.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const A of I)A.sort((D,L)=>L.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(r,c,p){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],x=this.proxyCoords,b=r.getSource(),I=b.tileID;if(!I)return;const A=new o.P(I.x,I.y)._div(1<<I.z),D=b.coordinates.map(o.ac.fromLngLat).reduce((B,O)=>(B.min.x=Math.min(B.min.x,O.x-A.x),B.min.y=Math.min(B.min.y,O.y-A.y),B.max.x=Math.max(B.max.x,O.x-A.x),B.max.y=Math.max(B.max.y,O.y-A.y),B),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(B,O)=>{const U=B.wrap+B.canonical.x/(1<<B.canonical.z),q=B.canonical.y/(1<<B.canonical.z),$=o.aj/(1<<B.canonical.z),X=O.wrap+O.canonical.x/(1<<O.canonical.z),Z=O.canonical.y/(1<<O.canonical.z);return U+$<X+D.min.x||U>X+D.max.x||q+$<Z+D.min.y||q>Z+D.max.y};for(let B=0;B<x.length;B++){const O=x[B];for(let U=0;U<c.length;U++){const q=r.getTile(c[U]);if(!q||!q.hasData()||L(O,q.tileID))continue;const $=this._createProxiedId(O,q,p[O.key]&&p[O.key][r.id]),X=this.proxyToSource[O.key][r.id];X?X.push($):this.proxyToSource[O.key][r.id]=[$],y.push($)}}}_createProxiedId(r,c,p){let y=this.orthoMatrix;if(p){const x=p.find(b=>b.key===c.tileID.key);if(x)return x}if(c.tileID.key!==r.key){const x=r.canonical.z-c.tileID.canonical.z;let b,I,A;y=o.bz();const D=c.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(b=o.aj>>x,I=b*((c.tileID.canonical.x<<x)-r.canonical.x+D),A=b*((c.tileID.canonical.y<<x)-r.canonical.y)):(b=o.aj<<-x,I=o.aj*(c.tileID.canonical.x-(r.canonical.x+D<<-x)),A=o.aj*(c.tileID.canonical.y-(r.canonical.y<<-x))),o.ca(y,0,b,0,b,0,1),o.bo(y,y,[I,A,0])}return new yf(c.tileID,r.key,y)}_findTileCoveringTileID(r,c){let p=c.getTile(r);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[c.id],x=y[r.key];if(p=x?c.getTileByID(x):null,p&&p.hasData()||x===null)return p;let b=p?p.tileID:r,I=b.overscaledZ;const A=c.getSource().minzoom,D=[];if(!x){const B=c.getSource().maxzoom;if(r.canonical.z>=B){const O=r.canonical.z-B;c.getSource().reparseOverscaled?(I=Math.max(r.canonical.z+2,c.transform.tileZoom),b=new o.aM(I,r.wrap,B,r.canonical.x>>O,r.canonical.y>>O)):O!==0&&(I=B,b=new o.aM(I,r.wrap,B,r.canonical.x>>O,r.canonical.y>>O))}b.key!==r.key&&(D.push(b.key),p=c.getTile(b))}const L=B=>{D.forEach(O=>{y[O]=B}),D.length=0};for(I-=1;I>=A&&(!p||!p.hasData());I--){p&&L(p.tileID.key);const B=b.calculateScaledKey(I);if(p=c.getTileByID(B),p&&p.hasData())break;const O=y[B];if(O===null)break;O===void 0?D.push(B):p=c.getTileByID(O)}return L(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[c.key]=!0}}function C_(f,r,c){const p=function(I,A,D){const L=o.bG(A,I),B=o.bG(D,[.2126,.7152,.0722]),O=(q,$,X)=>(1-X)*q+X*$,U=O(1-.3*Math.min(B,1),1,Math.min(L+1,1));return O(.92,1,Math.asin(o.ay(A[2],-1,1))/Math.PI+.5)*U}(f,[0,0,1],r),y=[0,0,0];o.c1(y,c.slice(0,3),p);const x=[0,0,0];o.c1(x,r.slice(0,3),f[2]);const b=[0,0,0];return o.d5(b,y,x),o.d8(b)}const P_=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Yp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Qp{static cacheKey(r,c,p,y){let x=`${c}${y?y.cacheKey:""}`;for(const b of p)r.usedDefines.includes(b)&&(x+=`/${b}`);return x}constructor(r,c,p,y,x,b){const I=r.gl;this.program=I.createProgram(),this.configuration=y,this.name=c,this.fixedDefines=[...b];const A=y?y.getBinderAttributes():[],D=(p.staticAttributes||[]).concat(A);let L=y?y.defines():[];L=L.concat(b.map(X=>`#define ${X}`));const B=`#version 300 es
`;let O=B+L.concat("precision mediump float;",Zc,Bp.fragmentSource).join(`
`);for(const X of p.fragmentIncludes)O+=`
${zu[X]}`;O+=`
${p.fragmentSource}`;let U=B+L.concat("precision highp float;",Zc,Bp.vertexSource).join(`
`);for(const X of p.vertexIncludes)U+=`
${zu[X]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(U+=`
uniform int u_instanceID;
`),U+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(U=U.replaceAll("gl_InstanceID","u_instanceID"));const q=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(q,O),I.compileShader(q),I.attachShader(this.program,q);const $=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource($,U),I.compileShader($),I.attachShader(this.program,$),this.attributes={},this.numAttributes=D.length;for(let X=0;X<this.numAttributes;X++)if(D[X]){const Z=D[X].startsWith("a_")?D[X]:`a_${D[X]}`;I.bindAttribLocation(this.program,X,Z),this.attributes[Z]=X}I.linkProgram(this.program),I.deleteShader($),I.deleteShader(q),this.fixedUniforms=x(r),this.binderUniforms=y?y.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(X=>({u_instanceID:new o.cd(X)}))(r)),(b.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new o.cd(X),u_dem_prev:new o.cd(X),u_dem_tl:new o.cg(X),u_dem_scale:new o.cf(X),u_dem_tl_prev:new o.cg(X),u_dem_scale_prev:new o.cf(X),u_dem_size:new o.cf(X),u_dem_lerp:new o.cf(X),u_exaggeration:new o.cf(X),u_depth:new o.cd(X),u_depth_size_inv:new o.cg(X),u_depth_range_unpack:new o.cg(X),u_occluder_half_size:new o.cf(X),u_occlusion_depth_offset:new o.cf(X),u_meter_to_dem:new o.cf(X),u_label_plane_matrix_inv:new o.ch(X)}))(r)),b.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new o.ce(X),u_tile_tr_up:new o.ce(X),u_tile_br_up:new o.ce(X),u_tile_bl_up:new o.ce(X),u_tile_up_scale:new o.cf(X)}))(r)),b.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new o.ch(X),u_fog_range:new o.cg(X),u_fog_color:new o.d0(X),u_fog_horizon_blend:new o.cf(X),u_fog_vertical_limit:new o.cg(X),u_fog_temporal_offset:new o.cf(X),u_frustum_tl:new o.ce(X),u_frustum_tr:new o.ce(X),u_frustum_br:new o.ce(X),u_frustum_bl:new o.ce(X),u_globe_pos:new o.ce(X),u_globe_radius:new o.cf(X),u_globe_transition:new o.cf(X),u_is_globe:new o.cd(X),u_viewport:new o.cg(X)}))(r)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new o.d0(X)}))(r)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new o.ce(X),u_lighting_directional_dir:new o.ce(X),u_lighting_directional_color:new o.ce(X),u_ground_radiance:new o.ce(X)}))(r)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new o.ch(X),u_light_matrix_1:new o.ch(X),u_fade_range:new o.cg(X),u_shadow_normal_offset:new o.ce(X),u_shadow_intensity:new o.cf(X),u_shadow_texel_size:new o.cf(X),u_shadow_map_resolution:new o.cf(X),u_shadow_direction:new o.ce(X),u_shadow_bias:new o.ce(X),u_shadowmap_0:new o.cd(X),u_shadowmap_1:new o.cd(X)}))(r))}}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y]&&p[y].set(this.program,y,c[y])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y]&&p[y].set(this.program,y,c[y])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}setCutoffUniformValues(r,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}setLightsUniformValues(r,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}}setShadowUniformValues(r,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;r.program.set(this.program);for(const y in c)p[y].set(this.program,y,c[y])}_drawDebugWireframe(r,c,p,y,x,b,I,A,D,L){const B=r.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;const O=r.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||r._terrain&&r._terrain.renderingToTexture||!P_.includes(this.name))||!(!B.layers3D||!Yp.includes(this.name))))return;const U=O.gl,q=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,x,O);if(!q)return;const $=[...this.fixedDefines];$.push("DEBUG_WIREFRAME");const X=r.getOrCreateProgram(this.name,{config:this.configuration,defines:$});O.program.set(X.program);const Z=(ae,fe,be)=>{if(fe[ae]&&be[ae])for(const Ee in fe[ae])be[ae][Ee]&&be[ae][Ee].set(be.program,Ee,fe[ae][Ee].current)};D&&D.setUniforms(X.program,O,X.binderUniforms,I,{zoom:A}),Z("fixedUniforms",this,X),Z("terrainUniforms",this,X),Z("globeUniforms",this,X),Z("fogUniforms",this,X),Z("lightsUniforms",this,X),Z("shadowUniforms",this,X),q.bind(),O.setColorMode(new pn([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],o.am.transparent,[!0,!0,!0,!1])),O.setDepthMode(new Ut(c.func===U.LESS?U.LEQUAL:c.func,Ut.ReadOnly,c.range)),O.setStencilMode(bn.disabled);const te=3*b.primitiveLength*2,re=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ae=L||1;for(let fe=0;fe<ae;++fe)X.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",fe),U.drawElements(U.LINES,te,U.UNSIGNED_SHORT,re)}else L&&L>1?U.drawElementsInstanced(U.LINES,te,U.UNSIGNED_SHORT,re,L):U.drawElements(U.LINES,te,U.UNSIGNED_SHORT,re);x.bind(),O.program.set(this.program),O.setDepthMode(c),O.setStencilMode(p),O.setColorMode(y)}checkUniforms(r,c,p){if(this.fixedDefines.includes(c)){for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${y} not set but required by ${c} being defined`)}}draw(r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X){const Z=r.context,te=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(p),Z.setStencilMode(y),Z.setColorMode(x),Z.setCullFace(b);for(const fe of Object.keys(this.fixedUniforms))this.fixedUniforms[fe].set(this.program,fe,I[fe]);q&&q.setUniforms(this.program,Z,this.binderUniforms,O,{zoom:U});const re={[te.POINTS]:1,[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[c];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ae=X&&X>0?1:void 0;for(const fe of B.get()){const be=fe.vaos||(fe.vaos={});if((be[A]||(be[A]=new sE)).bind(Z,this,D,q?q.getPaintVertexBuffers():[],L,fe.vertexOffset,$||[],ae),this.forceManualRenderingForInstanceIDShaders){const Ee=X||1;for(let pe=0;pe<Ee;++pe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",pe),L?te.drawElements(c,fe.primitiveLength*re,te.UNSIGNED_SHORT,fe.primitiveOffset*re*2):te.drawArrays(c,fe.vertexOffset,fe.vertexLength)}else X&&X>1?te.drawElementsInstanced(c,fe.primitiveLength*re,te.UNSIGNED_SHORT,fe.primitiveOffset*re*2,X):L?te.drawElements(c,fe.primitiveLength*re,te.UNSIGNED_SHORT,fe.primitiveOffset*re*2):te.drawArrays(c,fe.vertexOffset,fe.vertexLength);c===te.TRIANGLES&&L&&this._drawDebugWireframe(r,p,y,x,L,fe,O,U,q,X)}}}function Jp(f,r,c=0){const p=Math.pow(2,r.tileID.overscaledZ),y=r.tileSize*Math.pow(2,f.transform.tileZoom)/p,x=y*(r.tileID.canonical.x+r.tileID.wrap*p),b=y*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(r,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,b>>16],u_pixel_coord_lower:[65535&x,65535&b],u_pattern_transition:c}}const Bu={terrain:0,flat:1},R_=o.bz(),k_=(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z)=>{const te=r.style.light,re=te.properties.get("position"),ae=[re.x,re.y,re.z],fe=o.dJ();te.properties.get("anchor")==="viewport"&&(o.dK(fe,-r.transform.angle),o.dL(ae,ae,fe));const be=te.properties.get("color").toPremultipliedRenderColor(null),Ee=r.transform,pe={u_matrix:f,u_lightpos:ae,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:R_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Bu[D],u_base_type:Bu[L],u_ao:y,u_edge_radius:x,u_width_scale:b,u_flood_light_color:q,u_vertical_scale:$,u_flood_light_intensity:X,u_ground_shadow_factor:Z};return Ee.projection.name==="globe"&&(pe.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],pe.u_zoom_transition=B,pe.u_inv_rot_matrix=U,pe.u_merc_center=O,pe.u_up_dir=Ee.projection.upVector(new o.cA(0,0,0),O[0]*o.aj,O[1]*o.aj),pe.u_height_lift=A),pe},w0=(f,r,c,p,y,x)=>({u_matrix:f,u_edge_radius:r,u_width_scale:c,u_vertical_scale:p,u_height_type:Bu[y],u_base_type:Bu[x]}),Uh=(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z)=>{const te=k_(f,r,c,p,y,x,b,I,D,L,B,O,U,q,$,X,1,[0,0,0]),re={u_height_factor:-Math.pow(2,I.overscaledZ)/A.tileSize/8};return o.h(te,Jp(r,A,Z),re)},b0=(f,r,c)=>({u_matrix:f,u_emissive_strength:r,u_ground_shadow_factor:c}),T0=(f,r,c,p,y,x=0)=>o.h(b0(f,r,y),Jp(c,p,x)),pE=(f,r,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:r,u_ground_shadow_factor:p}),mE=(f,r,c,p,y,x,b=0)=>o.h(T0(f,r,c,p,x,b),{u_world:y}),gE=(f,r)=>({u_matrix:f,u_ground_shadow_factor:r}),em=(f,r,c,p,y)=>({u_matrix:f,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:y}),M_=(f,r)=>({u_matrix:f,u_normal_matrix:r,u_opacity:1}),D_=f=>({u_matrix:f}),E0=f=>({u_matrix:f}),jh=(f,r,c,p,y,x,b,I)=>{const A=o.aj/x.tileSize;return{u_matrix:f,u_inv_rot_matrix:r,u_camera_to_center_distance:c.getCameraToCenterDistance(I),u_extrude_scale:[c.pixelsToGLUnits[0]/A,c.pixelsToGLUnits[1]/A],u_zoom_transition:p,u_tile_id:b,u_merc_center:y}},L_=(f,r,c=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:c}),I0=o.bz(),S0=(f,r,c,p,y,x,b)=>{const I=f.transform,A=I.projection.name==="globe",D=A?o.dM(I.zoom,r.canonical)*I._pixelsPerMercatorPixel:o.aw(c,1,x),L={u_matrix:r.projMatrix,u_extrude_scale:D,u_intensity:b,u_inv_rot_matrix:I0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){L.u_inv_rot_matrix=p,L.u_merc_center=y,L.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],L.u_zoom_transition=o.ah(I.zoom);const B=y[0]*o.aj,O=y[1]*o.aj;L.u_up_dir=I.projection.upVector(new o.cA(0,0,0),B,O)}return L};function tm(f,[r,c,p,y],[x,b]){if(x===b)return[0,0,0,0];const I=255*(f-1)/(f*(b-x));return[r*I,c*I,p*I,y*I]}function Xc(f,r,[c,p]){return c===p?0:.5/f+(r-c)*(f-1)/(f*(p-c))}const O_=(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z,te,re,ae)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:o.dO(B.paint.get("raster-saturation")),u_contrast_factor:o.dN(B.paint.get("raster-contrast")),u_spin_weights:Kc(B.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:I,u_cutoff_params:A,u_colorization_mix:tm(o.dP,$,Z),u_colorization_offset:Xc(o.dP,X,Z),u_color_ramp:q,u_texture_offset:[re/(te+2*re),te/(te+2*re)],u_texture_res:[te+2*re,te+2*re],u_emissive_strength:ae});function Kc(f){f*=Math.PI/180;const r=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const Yc=.05,nm=(f,r,c,p,y,x,b,I,A,D,L,B)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:b,u_merc_center:I,u_cutoff_params:A}),A0=(f,r,c,p,y,x,b,I,A,D)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_tile_offset:c,u_velocity:p,u_color_ramp:x,u_velocity_res:y,u_max_speed:b,u_uv_offset:I,u_data_scale:[255*A[0],255*A[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Yc,Yc]}),C0=(f,r,c,p,y,x,b,I,A,D)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_velocity:c,u_velocity_res:p,u_max_speed:y,u_speed_factor:x,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*A[0],255*A[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Yc,Yc]}),im=o.bz(),rm=(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z,te,re,ae,fe,be,Ee)=>{const pe=y.transform,_e={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:pe.getCameraToCenterDistance(te),u_rotate_symbol:+c,u_aspect_ratio:pe.width/pe.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:b,u_coord_matrix:I,u_is_text:+D,u_elevation_from_sea:A?1:0,u_pitch_with_map:+p,u_texsize:L,u_texsize_icon:B,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:im,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:im,u_up_vector:[0,-1,0],u_color_adj_mat:fe,u_icon_transition:be||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(te)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Ee||1,u_ground_shadow_factor:re,u_inv_matrix:o.bi(o.bz(),b),u_normal_scale:ae};return te.name==="globe"&&(_e.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],_e.u_zoom_transition=q,_e.u_inv_rot_matrix=X,_e.u_merc_center=$,_e.u_camera_forward=pe._camera.forward(),_e.u_ecef_origin=o.dQ(pe.globeMatrix,U.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(pe.globeMatrix),_e.u_up_vector=Z),_e},P0=(f,r,c,p)=>({u_matrix:f,u_emissive_strength:r,u_opacity:c,u_color:p}),z_=(f,r,c,p,y,x,b,I,A)=>o.h(function(D,L,B,O,U,q){const{width:$,height:X}=O.imageManager.getPixelSize(L),Z=Math.pow(2,q.tileID.overscaledZ),te=q.tileSize*Math.pow(2,O.transform.tileZoom)/Z,re=te*(q.tileID.canonical.x+q.tileID.wrap*Z),ae=te*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[$,X],u_pattern_size:B.displaySize,u_pattern_units_to_pixels:U?[O.transform.width,-1*O.transform.height]:[1/o.aw(q,1,O.transform.tileZoom),1/o.aw(q,1,O.transform.tileZoom)],u_pixel_coord_upper:[re>>16,ae>>16],u_pixel_coord_lower:[65535&re,65535&ae]}}(0,x,b,p,I,A),{u_matrix:f,u_emissive_strength:r,u_opacity:c}),Vu=new Float32Array(o.bx([])),F_=(f,r,c,p,y,x,b,I,A,D,L,B,O,U=[0,0,0],q)=>{const $=y.style.light,X=$.properties.get("position"),Z=[-X.x,-X.y,X.z],te=o.dJ();$.properties.get("anchor")==="viewport"&&(o.dK(te,-y.transform.angle),o.dL(Z,Z,te));const re=L.alphaMode==="MASK",ae=$.properties.get("color").toNonPremultipliedRenderColor(null),fe=O.paint.get("model-ambient-occlusion-intensity"),be=O.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return be.a=O.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:r,u_normal_matrix:c,u_node_matrix:p||Vu,u_lightpos:Z,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:U,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:D,u_baseColorTexture:zo.BaseColor,u_metallicRoughnessTexture:zo.MetallicRoughness,u_normalTexture:zo.Normal,u_occlusionTexture:zo.Occlusion,u_emissionTexture:zo.Emission,u_lutTexture:zo.LUT,u_color_mix:be.toArray01(),u_aoIntensity:fe,u_emissive_strength:B,u_occlusionTextureTransform:q||[0,0,0,0]}},R0=(f,r=Vu,c=Vu)=>({u_matrix:f,u_instance:r,u_node_matrix:c}),k0={fillExtrusion:f=>({u_matrix:new o.ch(f),u_lightpos:new o.ce(f),u_lightintensity:new o.cf(f),u_lightcolor:new o.ce(f),u_vertical_gradient:new o.cf(f),u_opacity:new o.cf(f),u_edge_radius:new o.cf(f),u_width_scale:new o.cf(f),u_ao:new o.cg(f),u_height_type:new o.cd(f),u_base_type:new o.cd(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_up_dir:new o.ce(f),u_height_lift:new o.cf(f),u_flood_light_color:new o.ce(f),u_vertical_scale:new o.cf(f),u_flood_light_intensity:new o.cf(f),u_ground_shadow_factor:new o.ce(f)}),fillExtrusionDepth:f=>({u_matrix:new o.ch(f),u_edge_radius:new o.cf(f),u_width_scale:new o.cf(f),u_vertical_scale:new o.cf(f),u_height_type:new o.cd(f),u_base_type:new o.cd(f)}),fillExtrusionPattern:f=>({u_matrix:new o.ch(f),u_lightpos:new o.ce(f),u_lightintensity:new o.cf(f),u_lightcolor:new o.ce(f),u_vertical_gradient:new o.cf(f),u_height_factor:new o.cf(f),u_edge_radius:new o.cf(f),u_width_scale:new o.cf(f),u_ao:new o.cg(f),u_height_type:new o.cd(f),u_base_type:new o.cd(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_up_dir:new o.ce(f),u_height_lift:new o.cf(f),u_image:new o.cd(f),u_texsize:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_tile_units_to_pixels:new o.cf(f),u_opacity:new o.cf(f),u_pattern_transition:new o.cf(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new o.ch(f),u_opacity:new o.cf(f),u_ao_pass:new o.cf(f),u_meter_to_tile:new o.cf(f),u_ao:new o.cg(f),u_flood_light_intensity:new o.cf(f),u_flood_light_color:new o.ce(f),u_attenuation:new o.cf(f),u_edge_radius:new o.cf(f),u_fb:new o.cd(f),u_fb_size:new o.cf(f),u_dynamic_offset:new o.cf(f)}),fill:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_ground_shadow_factor:new o.ce(f)}),fillPattern:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_image:new o.cd(f),u_texsize:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_tile_units_to_pixels:new o.cf(f),u_ground_shadow_factor:new o.ce(f),u_pattern_transition:new o.cf(f)}),fillOutline:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_world:new o.cg(f),u_ground_shadow_factor:new o.ce(f)}),fillOutlinePattern:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_world:new o.cg(f),u_image:new o.cd(f),u_texsize:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_tile_units_to_pixels:new o.cf(f),u_ground_shadow_factor:new o.ce(f),u_pattern_transition:new o.cf(f)}),building:f=>({u_matrix:new o.ch(f),u_normal_matrix:new o.ch(f),u_opacity:new o.cf(f)}),buildingBloom:f=>({u_matrix:new o.ch(f)}),buildingDepth:f=>({u_matrix:new o.ch(f)}),elevatedStructuresDepth:f=>({u_matrix:new o.ch(f),u_depth_bias:new o.cf(f)}),elevatedStructures:f=>({u_matrix:new o.ch(f),u_ground_shadow_factor:new o.ce(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new o.ch(f),u_camera_pos:new o.ce(f),u_depth_bias:new o.cf(f),u_height_scale:new o.cf(f),u_reset_depth:new o.cf(f)}),circle:o.dT,collisionBox:f=>({u_matrix:new o.ch(f),u_inv_rot_matrix:new o.ch(f),u_camera_to_center_distance:new o.cf(f),u_extrude_scale:new o.cg(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_tile_id:new o.ce(f)}),collisionCircle:f=>({u_matrix:new o.ch(f),u_inv_matrix:new o.ch(f),u_camera_to_center_distance:new o.cf(f),u_viewport_size:new o.cg(f)}),debug:f=>({u_color:new o.dv(f),u_matrix:new o.ch(f),u_overlay:new o.cd(f),u_overlay_scale:new o.cf(f)}),clippingMask:f=>({u_matrix:new o.ch(f)}),heatmap:f=>({u_extrude_scale:new o.cf(f),u_intensity:new o.cf(f),u_matrix:new o.ch(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_up_dir:new o.ce(f)}),heatmapTexture:f=>({u_image:new o.cd(f),u_color_ramp:new o.cd(f),u_opacity:new o.cf(f)}),hillshade:f=>({u_matrix:new o.ch(f),u_image:new o.cd(f),u_latrange:new o.cg(f),u_light:new o.cg(f),u_shadow:new o.dv(f),u_highlight:new o.dv(f),u_emissive_strength:new o.cf(f),u_accent:new o.dv(f)}),hillshadePrepare:f=>({u_matrix:new o.ch(f),u_image:new o.cd(f),u_dimension:new o.cg(f),u_zoom:new o.cf(f)}),line:o.dS,linePattern:o.dR,raster:f=>({u_matrix:new o.ch(f),u_normalize_matrix:new o.ch(f),u_globe_matrix:new o.ch(f),u_merc_matrix:new o.ch(f),u_grid_matrix:new o.dw(f),u_tl_parent:new o.cg(f),u_scale_parent:new o.cf(f),u_fade_t:new o.cf(f),u_opacity:new o.cf(f),u_image0:new o.cd(f),u_image1:new o.cd(f),u_brightness_low:new o.cf(f),u_brightness_high:new o.cf(f),u_saturation_factor:new o.cf(f),u_contrast_factor:new o.cf(f),u_spin_weights:new o.ce(f),u_perspective_transform:new o.cg(f),u_raster_elevation:new o.cf(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_cutoff_params:new o.d0(f),u_colorization_mix:new o.d0(f),u_colorization_offset:new o.cf(f),u_color_ramp:new o.cd(f),u_texture_offset:new o.cg(f),u_texture_res:new o.cg(f),u_emissive_strength:new o.cf(f)}),rasterParticle:f=>({u_matrix:new o.ch(f),u_normalize_matrix:new o.ch(f),u_globe_matrix:new o.ch(f),u_merc_matrix:new o.ch(f),u_grid_matrix:new o.dw(f),u_tl_parent:new o.cg(f),u_scale_parent:new o.cf(f),u_fade_t:new o.cf(f),u_opacity:new o.cf(f),u_image0:new o.cd(f),u_image1:new o.cd(f),u_raster_elevation:new o.cf(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_cutoff_params:new o.d0(f)}),rasterParticleTexture:f=>({u_texture:new o.cd(f),u_opacity:new o.cf(f)}),rasterParticleDraw:f=>({u_particle_texture:new o.cd(f),u_particle_texture_side_len:new o.cf(f),u_tile_offset:new o.cg(f),u_velocity:new o.cd(f),u_color_ramp:new o.cd(f),u_velocity_res:new o.cg(f),u_max_speed:new o.cf(f),u_uv_offset:new o.cg(f),u_data_scale:new o.cg(f),u_data_offset:new o.cf(f),u_particle_pos_scale:new o.cf(f),u_particle_pos_offset:new o.cg(f)}),rasterParticleUpdate:f=>({u_particle_texture:new o.cd(f),u_particle_texture_side_len:new o.cf(f),u_velocity:new o.cd(f),u_velocity_res:new o.cg(f),u_max_speed:new o.cf(f),u_speed_factor:new o.cf(f),u_reset_rate:new o.cf(f),u_rand_seed:new o.cf(f),u_uv_offset:new o.cg(f),u_data_scale:new o.cg(f),u_data_offset:new o.cf(f),u_particle_pos_scale:new o.cf(f),u_particle_pos_offset:new o.cg(f)}),symbol:f=>({u_is_size_zoom_constant:new o.cd(f),u_is_size_feature_constant:new o.cd(f),u_size_t:new o.cf(f),u_size:new o.cf(f),u_camera_to_center_distance:new o.cf(f),u_rotate_symbol:new o.cd(f),u_aspect_ratio:new o.cf(f),u_fade_change:new o.cf(f),u_matrix:new o.ch(f),u_label_plane_matrix:new o.ch(f),u_coord_matrix:new o.ch(f),u_is_text:new o.cd(f),u_elevation_from_sea:new o.cd(f),u_pitch_with_map:new o.cd(f),u_texsize:new o.cg(f),u_texsize_icon:new o.cg(f),u_texture:new o.cd(f),u_texture_icon:new o.cd(f),u_gamma_scale:new o.cf(f),u_device_pixel_ratio:new o.cf(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_camera_forward:new o.ce(f),u_tile_matrix:new o.ch(f),u_up_vector:new o.ce(f),u_ecef_origin:new o.ce(f),u_is_halo:new o.cd(f),u_icon_transition:new o.cf(f),u_color_adj_mat:new o.ch(f),u_scale_factor:new o.cf(f),u_ground_shadow_factor:new o.ce(f),u_inv_matrix:new o.ch(f),u_normal_scale:new o.cf(f)}),background:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_opacity:new o.cf(f),u_color:new o.dv(f)}),backgroundPattern:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_opacity:new o.cf(f),u_image:new o.cd(f),u_pattern_tl:new o.cg(f),u_pattern_br:new o.cg(f),u_texsize:new o.cg(f),u_pattern_size:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_pattern_units_to_pixels:new o.cg(f)}),terrainRaster:f=>({u_matrix:new o.ch(f),u_image0:new o.cd(f),u_skirt_height:new o.cf(f),u_ground_shadow_factor:new o.ce(f)}),skybox:f=>({u_matrix:new o.ch(f),u_sun_direction:new o.ce(f),u_cubemap:new o.cd(f),u_opacity:new o.cf(f),u_temporal_offset:new o.cf(f)}),skyboxGradient:f=>({u_matrix:new o.ch(f),u_color_ramp:new o.cd(f),u_center_direction:new o.ce(f),u_radius:new o.cf(f),u_opacity:new o.cf(f),u_temporal_offset:new o.cf(f)}),skyboxCapture:f=>({u_matrix_3f:new o.dw(f),u_sun_direction:new o.ce(f),u_sun_intensity:new o.cf(f),u_color_tint_r:new o.d0(f),u_color_tint_m:new o.d0(f),u_luminance:new o.cf(f)}),globeRaster:f=>({u_proj_matrix:new o.ch(f),u_globe_matrix:new o.ch(f),u_normalize_matrix:new o.ch(f),u_merc_matrix:new o.ch(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_image0:new o.cd(f),u_grid_matrix:new o.dw(f),u_skirt_height:new o.cf(f),u_far_z_cutoff:new o.cf(f),u_frustum_tl:new o.ce(f),u_frustum_tr:new o.ce(f),u_frustum_br:new o.ce(f),u_frustum_bl:new o.ce(f),u_globe_pos:new o.ce(f),u_globe_radius:new o.cf(f),u_viewport:new o.cg(f)}),globeAtmosphere:f=>({u_frustum_tl:new o.ce(f),u_frustum_tr:new o.ce(f),u_frustum_br:new o.ce(f),u_frustum_bl:new o.ce(f),u_horizon:new o.cf(f),u_transition:new o.cf(f),u_fadeout_range:new o.cf(f),u_color:new o.d0(f),u_high_color:new o.d0(f),u_space_color:new o.d0(f),u_temporal_offset:new o.cf(f),u_horizon_angle:new o.cf(f)}),model:f=>({u_matrix:new o.ch(f),u_lighting_matrix:new o.ch(f),u_normal_matrix:new o.ch(f),u_node_matrix:new o.ch(f),u_lightpos:new o.ce(f),u_lightintensity:new o.cf(f),u_lightcolor:new o.ce(f),u_camera_pos:new o.ce(f),u_opacity:new o.cf(f),u_baseColorFactor:new o.d0(f),u_emissiveFactor:new o.d0(f),u_metallicFactor:new o.cf(f),u_roughnessFactor:new o.cf(f),u_baseTextureIsAlpha:new o.cd(f),u_alphaMask:new o.cd(f),u_alphaCutoff:new o.cf(f),u_baseColorTexture:new o.cd(f),u_metallicRoughnessTexture:new o.cd(f),u_normalTexture:new o.cd(f),u_occlusionTexture:new o.cd(f),u_emissionTexture:new o.cd(f),u_lutTexture:new o.cd(f),u_color_mix:new o.d0(f),u_aoIntensity:new o.cf(f),u_emissive_strength:new o.cf(f),u_occlusionTextureTransform:new o.d0(f)}),modelDepth:f=>({u_matrix:new o.ch(f),u_instance:new o.ch(f),u_node_matrix:new o.ch(f)}),groundShadow:f=>({u_matrix:new o.ch(f),u_ground_shadow_factor:new o.ce(f)}),stars:f=>({u_matrix:new o.ch(f),u_up:new o.ce(f),u_right:new o.ce(f),u_intensity_multiplier:new o.cf(f)}),snowParticle:f=>({u_modelview:new o.ch(f),u_projection:new o.ch(f),u_time:new o.cf(f),u_cam_pos:new o.ce(f),u_velocityConeAperture:new o.cf(f),u_velocity:new o.cf(f),u_horizontalOscillationRadius:new o.cf(f),u_horizontalOscillationRate:new o.cf(f),u_boxSize:new o.cf(f),u_billboardSize:new o.cf(f),u_simpleShapeParameters:new o.cg(f),u_screenSize:new o.cg(f),u_thinningCenterPos:new o.cg(f),u_thinningShape:new o.ce(f),u_thinningAffectedRatio:new o.cf(f),u_thinningParticleOffset:new o.cf(f),u_particleColor:new o.d0(f),u_direction:new o.ce(f)}),rainParticle:f=>({u_modelview:new o.ch(f),u_projection:new o.ch(f),u_time:new o.cf(f),u_cam_pos:new o.ce(f),u_texScreen:new o.cd(f),u_velocityConeAperture:new o.cf(f),u_velocity:new o.cf(f),u_boxSize:new o.cf(f),u_rainDropletSize:new o.cg(f),u_distortionStrength:new o.cf(f),u_rainDirection:new o.ce(f),u_color:new o.d0(f),u_screenSize:new o.cg(f),u_thinningCenterPos:new o.cg(f),u_thinningShape:new o.ce(f),u_thinningAffectedRatio:new o.cf(f),u_thinningParticleOffset:new o.cf(f),u_shapeDirectionalPower:new o.cf(f),u_shapeNormalPower:new o.cf(f),u_mode:new o.cf(f)}),vignette:f=>({u_vignetteShape:new o.ce(f),u_vignetteColor:new o.d0(f)}),occlusion:f=>({u_matrix:new o.ch(f),u_anchorPos:new o.ce(f),u_screenSizePx:new o.cg(f),u_occluderSizePx:new o.cg(f),u_color:new o.d0(f)})};class Qc{constructor(r,c,p,y){this.id=Qc.uniqueIdxCounter,Qc.uniqueIdxCounter++,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=Qc.uniqueIdxCounter,Qc.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Qc.uniqueIdxCounter=0;const N_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class B_{constructor(r,c,p,y,x,b){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.instanceCount=b,this.context=r;const I=r.gl;this.buffer=I.createBuffer(),r.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let p=0;p<this.attributes.length;p++){const y=c.attributes[this.attributes[p].name];y!==void 0&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,c,p){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],b=c.attributes[x.name];b!==void 0&&r.vertexAttribPointer(b,x.components,r[N_[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(r,c,p){for(let y=0;y<this.attributes.length;y++){const x=c.attributes[this.attributes[y].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(x,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Uu{constructor(r,c,p,y,x){this.context=r,this.width=c,this.height=p;const b=this.framebuffer=r.gl.createFramebuffer();y&&(this.colorAttachment=new fE(r,b)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new v0(r,b):new T_(r,b))}destroy(){const r=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&r.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&r.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&r.deleteTexture(c)}r.deleteFramebuffer(this.framebuffer)}}class sm{constructor(r,c){this.gl=r,this.clearColor=new aE(this),this.clearDepth=new lE(this),this.clearStencil=new cE(this),this.colorMask=new uE(this),this.depthMask=new h0(this),this.stencilMask=new hE(this),this.stencilFunc=new Vp(this),this.stencilOp=new dE(this),this.stencilTest=new d0(this),this.depthRange=new y_(this),this.depthTest=new Up(this),this.depthFunc=new v_(this),this.blend=new Fu(this),this.blendFunc=new zh(this),this.blendColor=new jp(this),this.blendEquation=new Gp(this),this.cullFace=new Fh(this),this.cullFaceSide=new f0(this),this.frontFace=new x_(this),this.program=new p0(this),this.activeTexture=new Nh(this),this.viewport=new $p(this),this.bindFramebuffer=new Hp(this),this.bindRenderbuffer=new w_(this),this.bindTexture=new qp(this),this.bindVertexBuffer=new gf(this),this.bindElementBuffer=new m0(this),this.bindVertexArrayOES=new g0(this),this.pixelStoreUnpack=new _0(this),this.pixelStoreUnpackPremultiplyAlpha=new Bh(this),this.pixelStoreUnpackFlipY=new y0(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c,p){return new Qc(this,r,c,p)}createVertexBuffer(r,c,p,y,x){return new B_(this,r,c,p,y,x)}createRenderbuffer(r,c,p){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,r,c,p),this.bindRenderbuffer.set(null),x}createFramebuffer(r,c,p,y){return new Uu(this,r,c,p,y)}clear({color:r,depth:c,stencil:p,colorMask:y}){const x=this.gl;let b=0;r&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),c!==void 0&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),x.clear(b)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.bv(r.blendFunction,pn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Jc;function V_(f,r,c,p,y,x,b){const I=f.context,A=I.gl,D=f.transform,L=[o.aD(D.center.lng),o.aH(D.center.lat)],B=c.layout.get("symbol-placement"),O=c.layout.get("text-variable-anchor"),U=c.layout.get("icon-rotation-alignment")==="map",q=c.layout.get("text-rotation-alignment")==="map",$=B!=="point",X=[];let Z=0,te=0;for(let _e=0;_e<p.length;_e++){const ve=p[_e],We=r.getTile(ve),Le=We.getBucket(c);if(!Le)continue;const lt=Le.getProjection().createInversionMatrix(D,ve.canonical),Ye=[],ft=Fc(ve,Le,D),kt=!b&&U&&$,Ze=b&&q&&$,Ce=O&&Le.hasTextData(),rt=Le.hasIconTextFit()&&Ce&&Le.hasIconData(),Ke=kt||Ze||b&&Ce||rt,xt=Le.projection.name==="globe",wt=xt?o.ah(D.zoom):0;xt&&(Ye.push("PROJECTION_GLOBE_VIEW"),Ke&&Ye.push("PROJECTED_POS_ON_VIEWPORT"));const Et=f.getOrCreateProgram("collisionBox",{defines:Ye});let Nt=ft;y[0]===0&&y[1]===0||(Nt=f.translatePosMatrix(ft,We,y,x));const tn=b?Le.textCollisionBox:Le.iconCollisionBox,dn=Le.collisionCircleArray;if(dn.length>0){const hn=o.bz(),an=Nt;o.cM(hn,Le.placementInvProjMatrix,D.glCoordMatrix),o.cM(hn,hn,Le.placementViewportMatrix),X.push({circleArray:dn,circleOffset:te,transform:an,invTransform:hn,projection:Le.getProjection()}),Z+=dn.length/4,te=Z}if(!tn)continue;f.terrain&&f.terrain.setupElevationDraw(We,Et);const qt=xt?[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z]:[0,0,0];Et.draw(f,A.LINES,Ut.disabled,bn.disabled,f.colorModeForRenderPass(),yn.disabled,jh(Nt,lt,D,wt,L,We,qt,Le.getProjection()),c.id,tn.layoutVertexBuffer,tn.indexBuffer,tn.segments,null,D.zoom,null,[tn.collisionVertexBuffer,tn.collisionVertexBufferExt])}if(!b||!X.length)return;const re=f.getOrCreateProgram("collisionCircle"),ae=new o.dU;ae.resize(4*Z),ae._trim();let fe=0;for(const _e of X)for(let ve=0;ve<_e.circleArray.length/4;ve++){const We=4*ve,Le=_e.circleArray[We+0],lt=_e.circleArray[We+1],Ye=_e.circleArray[We+2],ft=_e.circleArray[We+3];ae.emplace(fe++,Le,lt,Ye,ft,0),ae.emplace(fe++,Le,lt,Ye,ft,1),ae.emplace(fe++,Le,lt,Ye,ft,2),ae.emplace(fe++,Le,lt,Ye,ft,3)}(!Jc||Jc.length<2*Z)&&(Jc=function(_e){const ve=2*_e,We=new o.a_;We.resize(ve),We._trim();for(let Le=0;Le<ve;Le++){const lt=6*Le;We.uint16[lt+0]=4*Le+0,We.uint16[lt+1]=4*Le+1,We.uint16[lt+2]=4*Le+2,We.uint16[lt+3]=4*Le+2,We.uint16[lt+4]=4*Le+3,We.uint16[lt+5]=4*Le+0}return We}(Z));const be=I.createIndexBuffer(Jc,!0),Ee=I.createVertexBuffer(ae,o.dV.members,!0);for(const _e of X){const ve={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(pe=D).getCameraToCenterDistance(_e.projection),u_viewport_size:[pe.width,pe.height]};re.draw(f,A.TRIANGLES,Ut.disabled,bn.disabled,f.colorModeForRenderPass(),yn.disabled,ve,c.id,Ee,be,o.bd.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,D.zoom)}var pe;Ee.destroy(),be.destroy()}const ju=o.bz();function vf(f){const r=f._camera.getWorldToCamera(f.worldSize,1),c=o.az([],r,f.globeMatrix);o.bi(c,c);const p=[0,0,0],y=[0,1,0,0];return o.aA(y,y,c),p[0]=y[0],p[1]=y[1],p[2]=y[2],o.au(p,p),p}function U_({width:f,height:r,anchor:c,textOffset:p,textScale:y},x){const{horizontalAlign:b,verticalAlign:I}=o.bZ(c),A=-(b-.5)*f,D=-(I-.5)*r,L=o.b_(c,p);return new o.P((A/y+L[0])*x,(D/y+L[1])*x)}function M0(f,r,c,p,y,x,b,I,A,D){const L=f.text.placedSymbolArray,B=f.text.dynamicLayoutVertexArray,O=f.icon.dynamicLayoutVertexArray,U={},q=f.getProjection(),$=Ru(b,q,y),X=y.elevation,Z=q.upVectorScale(b.canonical,y.center.lat,y.worldSize).metersToTile;B.clear();for(let te=0;te<L.length;te++){const re=L.get(te),{tileAnchorX:ae,tileAnchorY:fe,numGlyphs:be}=re,Ee=re.hidden||!re.crossTileID||f.allowVerticalPlacement&&!re.placedOrientation?null:p[re.crossTileID];if(Ee){let pe=0,_e=0,ve=0;if(X){const rt=X?X.getAtTileOffset(b,ae,fe):0,[Ke,xt,wt]=q.upVector(b.canonical,ae,fe);pe=rt*Ke*Z,_e=rt*xt*Z,ve=rt*wt*Z}let[We,Le,lt,Ye]=so(re.projectedAnchorX+pe,re.projectedAnchorY+_e,re.projectedAnchorZ+ve,c?$:x);const ft=Ph(y.getCameraToCenterDistance(q),Ye);let kt=o.bJ(f.textSizeData,A,re)*ft/o.bU;c&&(kt*=f.tilePixelRatio/I);const Ze=U_(Ee,kt);c?({x:We,y:Le,z:lt}=q.projectTilePoint(ae+Ze.x,fe+Ze.y,b.canonical),[We,Le,lt]=so(We+pe,Le+_e,lt+ve,x)):(r&&Ze._rotate(-y.angle),We+=Ze.x,Le+=Ze.y,lt=0);const Ce=f.allowVerticalPlacement&&re.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let rt=0;rt<be;rt++)o.bL(B,We,Le,lt,Ce);D&&re.associatedIconIndex>=0&&(U[re.associatedIconIndex]={x:We,y:Le,z:lt,angle:Ce})}else _l(be,B)}if(D){O.clear();const te=f.icon.placedSymbolArray;for(let re=0;re<te.length;re++){const ae=te.get(re),{numGlyphs:fe}=ae,be=U[re];if(ae.hidden||!be)_l(fe,O);else{const{x:Ee,y:pe,z:_e,angle:ve}=be;for(let We=0;We<fe;We++)o.bL(O,Ee,pe,_e,ve)}}f.icon.dynamicLayoutVertexBuffer.updateData(O)}f.text.dynamicLayoutVertexBuffer.updateData(B)}function j_(f,r,c,p,y,x,b={}){const I=c.paint.get("icon-translate"),A=c.paint.get("text-translate"),D=c.paint.get("icon-translate-anchor"),L=c.paint.get("text-translate-anchor"),B=c.layout.get("icon-rotation-alignment"),O=c.layout.get("text-rotation-alignment"),U=c.layout.get("icon-pitch-alignment"),q=c.layout.get("text-pitch-alignment"),$=c.layout.get("icon-keep-upright"),X=c.layout.get("text-keep-upright"),Z=c.paint.get("icon-color-saturation"),te=c.paint.get("icon-color-contrast"),re=c.paint.get("icon-color-brightness-min"),ae=c.paint.get("icon-color-brightness-max"),fe=c.layout.get("symbol-elevation-reference")==="sea",be=f.context,Ee=be.gl,pe=f.transform,_e=B==="map",ve=O==="map",We=U==="map",Le=q==="map",lt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ye=!1;const ft=f.depthModeForSublayer(0,Ut.ReadOnly),kt=new Ut(f.context.gl.LEQUAL,Ut.ReadOnly,f.depthRangeFor3D),Ze=[o.aD(pe.center.lng),o.aH(pe.center.lat)],Ce=c.layout.get("text-variable-anchor"),rt=pe.projection.name==="globe",Ke=[],xt=[0,-1,0];for(const wt of p){const Et=r.getTile(wt),Nt=Et.getBucket(c);if(!Nt||Nt.projection.name==="mercator"&&rt||Nt.fullyClipped)continue;const tn=Nt.projection.name==="globe",dn=tn?o.ah(pe.zoom):0,qt=Ru(wt,Nt.getProjection(),pe),hn=pe.calculatePixelsToTileUnitsMatrix(Et),an=Ce&&Nt.hasTextData(),Rn=Nt.hasIconTextFit()&&an&&Nt.hasIconData(),Fn=Nt.getProjection().createInversionMatrix(pe,wt.canonical),ei=(1<<Et.tileID.canonical.z)*o.aj/f.transform.worldSize,bi=$i=>{let ki=[0,0,0];if($i){const Pr=f.style.directionalLight,xi=f.style.ambientLight;Pr&&xi&&(ki=Ou(f.style,Pr,xi))}return ki},Dn=$i=>{pe.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||f.terrain)&&($i.push("DEPTH_D24"),$i.push("DEPTH_OCCLUSION"))},Ti=()=>{const $i=_e&&c.layout.get("symbol-placement")!=="point",ki=[];Dn(ki);const Pr=$i||Rn,xi=Nt.elevationType==="road",Di=f.shadowRenderer,Qi=xi&&We&&!!Di&&Di.enabled,ns=bi(Qi),Yr=xi&&We&&!f.terrain?kt:ft,os=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&We&&ki.push("PITCH_WITH_MAP_TERRAIN"),tn&&(ki.push("PROJECTION_GLOBE_VIEW"),Pr&&ki.push("PROJECTED_POS_ON_VIEWPORT")),os>0&&Nt.hasAnySecondaryIcon&&ki.push("ICON_TRANSITION"),!Nt.icon.zOffsetVertexBuffer||xi&&f.terrain||ki.push("Z_OFFSET"),Z===0&&te===0&&re===0&&ae===1||ki.push("COLOR_ADJUSTMENT"),Nt.sdfIcons&&ki.push("RENDER_SDF"),Qi&&ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xi&&We&&!f.terrain&&Nt.icon.orientationVertexBuffer&&ki.push("ELEVATED_ROADS");const Zs=Nt.icon.programConfigurations.get(c.id),xl=f.getOrCreateProgram("symbol",{config:Zs,defines:ki}),Bo=Et.imageAtlasTexture?Et.imageAtlasTexture.size:[0,0],aa=Nt.iconSizeData,oo=o.bH(aa,pe.zoom),Da=We||!pe.isOrthographic,Ya=Nc(qt,Et.tileID.canonical,We,_e,pe,Nt.getProjection(),hn),ao=$a(qt,Et.tileID.canonical,We,_e,pe,Nt.getProjection(),hn),qr=f.translatePosMatrix(ao,Et,I,D,!0),Nr=f.translatePosMatrix(qt,Et,I,D),ir=Pr?ju:Ya,ps=_e&&!We&&!$i;let Xs=xt;!rt&&!pe.mercatorFromTransition||_e||(Xs=vf(pe));const Wr=tn?Xs:xt,La=c.getColorAdjustmentMatrix(Z,te,re,ae),qu=rm(aa.kind,oo,ps,We,f,Nr,ir,qr,fe,!1,Bo,[0,0],0,wt,dn,Ze,Fn,Wr,Nt.getProjection(),ns,ei,La,os,null),ou=Et.imageAtlasTexture?Et.imageAtlasTexture:null,id=c.layout.get("icon-size").constantOr(0)!==1||Nt.iconsNeedLinear,rd=Nt.sdfIcons||f.options.rotating||f.options.zooming||id||Da?Ee.LINEAR:Ee.NEAREST,Oa=Nt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Wl=f.terrain&&We&&$i?o.bi(o.bz(),Ya):ju;if($i&&Nt.icon){const ms=pe.elevation,za=ms?ms.getAtTileOffsetFunc(wt,pe.center.lat,pe.worldSize,Nt.getProjection()):null,Wu=uc(qt,Et.tileID.canonical,We,_e,pe,Nt.getProjection(),hn);Nl(Nt,qt,f,!1,Wu,ao,We,$,za,wt)}return{program:xl,buffers:Nt.icon,uniformValues:qu,atlasTexture:ou,atlasTextureIcon:null,atlasInterpolation:rd,atlasInterpolationIcon:null,isSDF:Nt.sdfIcons,hasHalo:Oa,depthMode:Yr,tile:Et,renderWithShadows:Qi,labelPlaneMatrixInv:Wl}},Ri=()=>{const $i=ve&&c.layout.get("symbol-placement")!=="point",ki=[],Pr=$i||Ce||Rn,xi=Nt.elevationType==="road",Di=f.shadowRenderer,Qi=xi&&Le&&!!Di&&Di.enabled,ns=bi(Qi),Yr=xi&&Le&&!f.terrain?kt:ft;f.terrainRenderModeElevated()&&Le&&ki.push("PITCH_WITH_MAP_TERRAIN"),tn&&(ki.push("PROJECTION_GLOBE_VIEW"),Pr&&ki.push("PROJECTED_POS_ON_VIEWPORT")),!Nt.text.zOffsetVertexBuffer||xi&&f.terrain||ki.push("Z_OFFSET"),Nt.iconsInText&&ki.push("RENDER_TEXT_AND_SYMBOL"),ki.push("RENDER_SDF"),Qi&&ki.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xi&&Le&&!f.terrain&&Nt.text.orientationVertexBuffer&&ki.push("ELEVATED_ROADS"),Dn(ki);const os=Nt.text.programConfigurations.get(c.id),Zs=f.getOrCreateProgram("symbol",{config:os,defines:ki});let xl,Bo=[0,0],aa=null;const oo=Nt.textSizeData;Nt.iconsInText&&(Bo=Et.imageAtlasTexture?Et.imageAtlasTexture.size:[0,0],aa=Et.imageAtlasTexture?Et.imageAtlasTexture:null,xl=Le||!pe.isOrthographic||f.options.rotating||f.options.zooming||oo.kind==="composite"||oo.kind==="camera"?Ee.LINEAR:Ee.NEAREST);const Da=Et.glyphAtlasTexture?Et.glyphAtlasTexture.size:[0,0],Ya=c.layout.get("text-size-scale-range"),ao=o.ay(f.scaleFactor,Ya[0],Ya[1]),qr=o.bH(oo,pe.zoom,ao),Nr=Nc(qt,Et.tileID.canonical,Le,ve,pe,Nt.getProjection(),hn),ir=$a(qt,Et.tileID.canonical,Le,ve,pe,Nt.getProjection(),hn),ps=f.translatePosMatrix(ir,Et,A,L,!0),Xs=f.translatePosMatrix(qt,Et,A,L),Wr=Pr?ju:Nr,La=ve&&!Le&&!$i;let qu=xt;!rt&&!pe.mercatorFromTransition||ve||(qu=vf(pe));const ou=rm(oo.kind,qr,La,Le,f,Xs,Wr,ps,fe,!0,Da,Bo,0,wt,dn,Ze,Fn,tn?qu:xt,Nt.getProjection(),ns,ei,null,null,ao),id=Et.glyphAtlasTexture?Et.glyphAtlasTexture:null,rd=Ee.LINEAR,Oa=c.paint.get("text-halo-width").constantOr(1)!==0,Wl=f.terrain&&Le&&$i?o.bi(o.bz(),Nr):ju;if($i&&Nt.text){const ms=pe.elevation,za=ms?ms.getAtTileOffsetFunc(wt,pe.center.lat,pe.worldSize,Nt.getProjection()):null,Wu=uc(qt,Et.tileID.canonical,Le,ve,pe,Nt.getProjection(),hn);Nl(Nt,qt,f,!0,Wu,ir,Le,X,za,wt)}return{program:Zs,buffers:Nt.text,uniformValues:ou,atlasTexture:id,atlasTextureIcon:aa,atlasInterpolation:rd,atlasInterpolationIcon:xl,isSDF:!0,hasHalo:Oa,depthMode:Yr,tile:Et,renderWithShadows:Qi,labelPlaneMatrixInv:Wl}},nr=Nt.icon.segments.get().length,Kn=Nt.text.segments.get().length,Ei=nr&&!b.onlyText?Ti():null,Ci=Kn&&!b.onlyIcons?Ri():null,Mi=c.paint.get("icon-opacity").constantOr(1),ti=c.paint.get("text-opacity").constantOr(1);if(lt&&Nt.canOverlap){Ye=!0;const $i=Mi&&!b.onlyText?Nt.icon.segments.get():[],ki=ti&&!b.onlyIcons?Nt.text.segments.get():[];for(const Pr of $i)Ke.push({segments:new o.bd([Pr]),sortKey:Pr.sortKey,state:Ei});for(const Pr of ki)Ke.push({segments:new o.bd([Pr]),sortKey:Pr.sortKey,state:Ci})}else b.onlyText||Ke.push({segments:Mi?Nt.icon.segments:new o.bd([]),sortKey:0,state:Ei}),b.onlyIcons||Ke.push({segments:ti?Nt.text.segments:new o.bd([]),sortKey:0,state:Ci})}Ye&&Ke.sort((wt,Et)=>wt.sortKey-Et.sortKey);for(const wt of Ke){const Et=wt.state;if(Et)if(f.terrain?f.terrain.setupElevationDraw(Et.tile,Et.program,{useDepthForOcclusion:pe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Et.labelPlaneMatrixInv}):f.setupDepthForOcclusion(pe.depthOcclusionForSymbolsAndCircles,Et.program),be.activeTexture.set(Ee.TEXTURE0),Et.atlasTexture&&Et.atlasTexture.bind(Et.atlasInterpolation,Ee.CLAMP_TO_EDGE,!0),Et.atlasTextureIcon&&(be.activeTexture.set(Ee.TEXTURE1),Et.atlasTextureIcon&&Et.atlasTextureIcon.bind(Et.atlasInterpolationIcon,Ee.CLAMP_TO_EDGE,!0)),Et.renderWithShadows&&f.shadowRenderer.setupShadows(Et.tile.tileID.toUnwrapped(),Et.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Et.program),Et.hasHalo){const Nt=Et.uniformValues;Nt.u_is_halo=1,eu(Et.buffers,wt.segments,c,f,Et.program,Et.depthMode,y,x,Nt,2),Nt.u_is_halo=0}else{if(Et.isSDF){const Nt=Et.uniformValues;Et.hasHalo&&(Nt.u_is_halo=1,eu(Et.buffers,wt.segments,c,f,Et.program,Et.depthMode,y,x,Nt,1)),Nt.u_is_halo=0}eu(Et.buffers,wt.segments,c,f,Et.program,Et.depthMode,y,x,Et.uniformValues,1)}}}function eu(f,r,c,p,y,x,b,I,A,D){const L=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,x,b,I,yn.disabled,A,c.id,f.layoutVertexBuffer,f.indexBuffer,r,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),L,D)}function xf(f,r){const c=1<<f.canonical.z,p=(r.x*c-f.canonical.x-f.wrap*c)*o.aj,y=(r.y*c-f.canonical.y)*o.aj,x=o.e2(r.z,r.y);return o.d2(p,y,x)}function Xt(f,r,c,p,y){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const x=f.context.gl,b=new Ut(f.context.gl.LEQUAL,Ut.ReadWrite,f.depthRangeFor3D),I=new Ut(f.context.gl.GREATER,Ut.ReadWrite,f.depthRangeFor3D),A=function(U){const q=o.cU(U.pitch);let $=.01;return U.isOrthographic&&($=o.ai(1e-4,$,o.cZ(q>=Ws?1:q/Ws))),2*$}(f.transform),D=f.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",B=f.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),O=f.getOrCreateProgram(L);for(const U of p){const q=r.getTile(U),$=q.getBucket(c);if(!$)continue;const X=$.elevatedStructures;if(!X)continue;const Z=$.elevationBufferData.heightRange,te=xf(U.toUnwrapped(),D),re=f.translatePosMatrix(U.projMatrix,q,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let ae,fe,be,Ee;if(y==="initialize"){if(!Z||Z.min>=1||X.depthSegments.segments[0].primitiveLength===0)continue;ae=em(re,te,A,1,0),fe=b,be=X.depthSegments,Ee=B}else if(y==="reset"){if(!Z||Z.min>=0||X.maskSegments.segments[0].primitiveLength===0)continue;ae=em(re,te,0,0,1),fe=I,be=X.maskSegments,Ee=B}else if(y==="geometry"){if(X.depthSegments.segments[0].primitiveLength===0)continue;ae=em(re,te,A,1,0),fe=b,be=X.depthSegments,Ee=O}Ee.draw(f,x.TRIANGLES,fe,bn.disabled,pn.disabled,yn.disabled,ae,c.id,X.vertexBuffer,X.indexBuffer,be,c.paint,f.transform.zoom)}}function om(f,r,c){const{painter:p,sourceCache:y,layer:x,coords:b,colorMode:I,elevationType:A,terrainEnabled:D,pass:L}=f,B=p.context.gl,O=x.paint.get("fill-pattern"),U=x.paint.get("fill-pattern-cross-fade"),q=O.constantOr(null);let $=A;A!=="road"||r&&!D||($="none");const X=$==="road",Z=f.painter.shadowRenderer,te=X&&!!Z&&Z.enabled,re=new Ut(p.context.gl.LEQUAL,Ut.ReadOnly,p.depthRangeFor3D);let ae=[0,0,0];if(te){const Ee=p.style.directionalLight,pe=p.style.ambientLight;Ee&&pe&&(ae=Ou(p.style,Ee,pe))}const fe=O&&O.constantOr(1),be=(Ee,pe)=>{let _e,ve,We,Le,lt;pe?(_e=fe&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",We=B.LINES):(_e=fe?"fillPattern":"fill",We=B.TRIANGLES);for(const Ye of b){const ft=y.getTile(Ye);if(fe&&!ft.patternsLoaded())continue;const kt=ft.getBucket(x);if(!kt)continue;const Ze=r?kt.elevationBufferData:kt.bufferData;if(Ze.isEmpty())continue;p.prepareDrawTile();const Ce=Ze.programConfigurations.get(x.id),rt=p.isTileAffectedByFog(Ye),Ke=[],xt=[];X&&(Ke.push("ELEVATED_ROADS"),xt.push(Ze.elevatedLayoutVertexBuffer)),te&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),fe&&(p.context.activeTexture.set(B.TEXTURE0),ft.imageAtlasTexture&&ft.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ce.updatePaintBuffers());let wt=!1;if(q&&ft.imageAtlas){const qt=ft.imageAtlas,hn=o.dZ.from(q),an=hn.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Rn=hn.getSecondary(),Fn=qt.patternPositions.get(an),ei=Rn?qt.patternPositions.get(Rn.scaleSelf(o.q.devicePixelRatio).toString()):null;wt=!!Fn&&!!ei,Fn&&Ce.setConstantPatternPositions(Fn,ei)}U>0&&(wt||Ce.getPatternTransitionVertexBuffer("fill-pattern"))&&Ke.push("FILL_PATTERN_TRANSITION");const Et=p.getOrCreateProgram(_e,{config:Ce,overrideFog:rt,defines:Ke}),Nt=p.translatePosMatrix(Ye.projMatrix,ft,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));te&&Z.setupShadows(ft.tileID.toUnwrapped(),Et,"vector-tile");const tn=x.paint.get("fill-emissive-strength");if(pe){Le=Ze.lineIndexBuffer,lt=Ze.lineSegments;const qt=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];ve=_e==="fillOutlinePattern"&&fe?mE(Nt,tn,p,ft,qt,ae,U):pE(Nt,tn,qt,ae)}else Le=Ze.indexBuffer,lt=Ze.triangleSegments,ve=fe?T0(Nt,tn,p,ft,ae,U):b0(Nt,tn,ae);p.uploadCommonUniforms(p.context,Et,Ye.toUnwrapped());let dn=Ee;(A==="road"&&!D||A==="offset")&&(dn=re),Et.draw(p,We,dn,c||p.stencilModeForClipping(Ye),I,yn.disabled,ve,x.id,Ze.layoutVertexBuffer,Le,lt,x.paint,p.transform.zoom,Ce,xt)}};p.renderPass===L&&be(p.depthModeForSublayer(1,p.renderPass==="opaque"?Ut.ReadWrite:Ut.ReadOnly),!1),$==="none"&&p.renderPass==="translucent"&&x.paint.get("fill-antialias")&&be(p.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly),!0)}function wf(f,r,c,p,y,x,b,I){c.resetLayerRenderingStats(f);const A=f.context,D=A.gl,L=f.transform,B=c.paint.get("fill-extrusion-pattern"),O=c.paint.get("fill-extrusion-pattern-cross-fade"),U=B.constantOr(null),q=B.constantOr(1),$=c.paint.get("fill-extrusion-opacity"),X=f.style.enable3dLights(),Z=c.paint.get(X&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),te=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],re=c.layout.get("fill-extrusion-edge-radius"),ae=re>0&&!c.paint.get("fill-extrusion-rounded-roof"),fe=ae?0:re,be=L.projection.name==="globe"?o.e5():0,Ee=L.projection.name==="globe",pe=Ee?o.ah(L.zoom):0,_e=[o.aD(L.center.lng),o.aH(L.center.lat)],ve=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ve?null:c.lut).toArray01().slice(0,3),Le=c.paint.get("fill-extrusion-flood-light-intensity"),lt=c.paint.get("fill-extrusion-vertical-scale"),Ye=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ft=c.paint.get("fill-extrusion-height-alignment"),kt=c.paint.get("fill-extrusion-base-alignment"),Ze=jl(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Ce=[];let rt;Ee&&Ce.push("PROJECTION_GLOBE_VIEW"),te[0]>0&&Ce.push("FAUX_AO"),ae&&Ce.push("ZERO_ROOF_RADIUS"),I&&Ce.push("HAS_CENTROID"),Le>0&&Ce.push("FLOOD_LIGHT"),Ze.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),Ye&&Ce.push("RENDER_WALL_MODE");const Ke=f.renderPass==="shadow",xt=f.shadowRenderer,wt=Ke&&!!xt,Et=Ke?yn.disabled:yn.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Nt=[0,0,0];if(xt){const qt=f.style.directionalLight,hn=f.style.ambientLight;qt&&hn&&(Nt=Ou(f.style,qt,hn)),Ke||(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),xt.useNormalOffset&&Ce.push("NORMAL_OFFSET")),rt=Ce.concat(["SHADOWS_SINGLE_CASCADE"])}const tn=wt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",dn=c.getLayerRenderingStats();for(const qt of p){const hn=r.getTile(qt),an=hn.getBucket(c);if(!an||an.projection.name!==L.projection.name)continue;let Rn=!1;xt&&(Rn=xt.getMaxCascadeForTile(qt.toUnwrapped())===0);const Fn=f.isTileAffectedByFog(qt),ei=an.programConfigurations.get(c.id);let bi=!1;if(U&&hn.imageAtlas){const Ci=hn.imageAtlas,Mi=o.dZ.from(U),ti=Mi.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),$i=Mi.getSecondary(),ki=Ci.patternPositions.get(ti),Pr=$i?Ci.patternPositions.get($i.scaleSelf(o.q.devicePixelRatio).toString()):null;bi=!!ki&&!!Pr,ki&&ei.setConstantPatternPositions(ki,Pr)}O>0&&(bi||ei.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ce.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Dn=f.getOrCreateProgram(tn,{config:ei,defines:Rn?rt:Ce,overrideFog:Fn});if(f.terrain&&f.terrain.setupElevationDraw(hn,Dn,{useMeterToDem:!0}),!an.centroidVertexBuffer){const Ci=Dn.attributes.a_centroid_pos;Ci!==void 0&&D.vertexAttrib2f(Ci,0,0)}!Ke&&xt&&xt.setupShadows(hn.tileID.toUnwrapped(),Dn,"vector-tile"),q&&(f.context.activeTexture.set(D.TEXTURE0),hn.imageAtlasTexture&&hn.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ei.updatePaintBuffers());const Ti=c.paint.get("fill-extrusion-vertical-gradient"),Ri=1/an.tileToMeter;let nr;if(Ke&&xt){if(am(hn.tileID,an.maxHeight,f))continue;const Ci=xt.calculateShadowPassMatrixFromTile(hn.tileID.toUnwrapped());nr=w0(Ci,fe,Ri,lt,ft,kt)}else{const Ci=f.translatePosMatrix(qt.expandedProjMatrix,hn,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Mi=L.projection.createInversionMatrix(L,qt.canonical);nr=q?Uh(Ci,f,Ti,$,te,fe,Ri,qt,hn,be,ft,kt,pe,_e,Mi,We,lt,O):k_(Ci,f,Ti,$,te,fe,Ri,qt,be,ft,kt,pe,_e,Mi,We,lt,Le,Nt)}f.uploadCommonUniforms(A,Dn,qt.toUnwrapped(),null,Ze);let Kn=an.segments;if(L.projection.name==="mercator"&&!Ke&&(Kn=an.getVisibleSegments(hn.tileID,f.terrain,f.transform.getFrustum(0)),!Kn.get().length))continue;if(dn)if(Ke)for(const Ci of Kn.get())dn.numRenderedVerticesInShadowPass+=Ci.primitiveLength;else for(const Ci of Kn.get())dn.numRenderedVerticesInTransparentPass+=Ci.primitiveLength;const Ei=[];(f.terrain||I)&&Ei.push(an.centroidVertexBuffer),Ee&&Ei.push(an.layoutVertexExtBuffer),Ye&&Ei.push(an.wallVertexBuffer),Dn.draw(f,A.gl.TRIANGLES,y,x,b,Et,nr,c.id,an.layoutVertexBuffer,an.indexBuffer,Kn,c.paint,f.transform.zoom,ei,Ei)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class fc{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Xo(f,r,c,p,y,x,b,I,A,D,L,B,O,U,q,$,X,Z,te,re){const ae=r.context,fe=ae.gl,be=r.transform,Ee=r.transform.zoom,pe=[],_e=f.translate,ve=f.translateAnchor,We=f.edgeRadius,Le=jl(r,f.cutoffFadeRange);L==="clear"?(pe.push("CLEAR_SUBPASS"),re&&(pe.push("CLEAR_FROM_TEXTURE"),ae.activeTexture.set(fe.TEXTURE0),re.bind(fe.LINEAR,fe.CLAMP_TO_EDGE))):L==="sdf"&&pe.push("SDF_SUBPASS"),Z&&pe.push("HAS_CENTROID"),Le.shouldRenderCutoff&&pe.push("RENDER_CUTOFF");const lt=(Ye,ft,kt,Ze,Ce)=>{const rt=ft.programConfigurations.get(p.id),Ke=r.isTileAffectedByFog(Ye),xt=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:rt,defines:pe,overrideFog:Ke}),wt=((Nt,tn,dn,qt,hn,an,Rn,Fn,ei,bi,Dn)=>({u_matrix:tn,u_opacity:dn,u_ao_pass:qt?1:0,u_meter_to_tile:hn,u_ao:an,u_flood_light_intensity:Rn,u_flood_light_color:Fn,u_attenuation:ei,u_edge_radius:bi,u_fb:0,u_fb_size:Dn,u_dynamic_offset:1}))(0,Ze,B,D,Ce,[O,U*Ce],q,$,X,Ee>=17?0:We*Ce,re?re.size[0]:0),Et=[];Z&&Et.push(ft.hiddenByLandmarkVertexBuffer),r.uploadCommonUniforms(ae,xt,Ye.toUnwrapped(),null,Le),xt.draw(r,ae.gl.TRIANGLES,x,b,I,A,wt,p.id,ft.vertexBuffer,ft.indexBuffer,kt,p.paint,Ee,rt,Et)};for(const Ye of y){const ft=c.getTile(Ye),kt=ft.getBucket(p);if(!kt||kt.projection.name!==be.projection.name||!kt.groundEffect||kt.groundEffect&&!kt.groundEffect.hasData())continue;const Ze=kt.groundEffect,Ce=1/kt.tileToMeter;{const rt=r.translatePosMatrix(Ye.projMatrix,ft,_e,ve),Ke=Ze.getDefaultSegment();lt(Ye,Ze,Ke,rt,Ce)}if(te)for(let rt=0;rt<4;rt++){const Ke=o.e3[rt](Ye),xt=c.getTile(Ke);if(!xt)continue;const wt=xt.getBucket(p);if(!wt||wt.projection.name!==be.projection.name||!wt.groundEffect||wt.groundEffect&&!wt.groundEffect.hasData())continue;const Et=wt.groundEffect;let Nt,tn;rt===0?(Nt=[-o.aj,0,0],tn=1):rt===1?(Nt=[o.aj,0,0],tn=0):rt===2?(Nt=[0,-o.aj,0],tn=3):(Nt=[0,o.aj,0],tn=2);const dn=Et.regionSegments[tn];if(!dn)continue;const qt=new Float32Array(16);o.bo(qt,Ye.projMatrix,Nt),lt(Ye,Et,dn,r.translatePosMatrix(qt,ft,_e,ve),Ce)}}}function In(f,r,c,p,y,x,b){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const I=x?x.findDEMTileFor(c):null;if(!(I&&I.dem||b))return;x&&I&&I.dem&&p.selfDEMTileTimestamp!==I.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=I.dem._timestamp);const A=Z=>new o.P(Math.ceil((Z+o.e7)*o.e8),0),D=Z=>{const te=r.getSource().minzoom,re=fe=>{const be=r.getTileByID(fe);if(be&&be.hasData())return be.getBucket(y)},ae=[0,-1,1];for(const fe of ae){if(Z.overscaledZ+fe<te)continue;const be=re(Z.calculateScaledKey(Z.overscaledZ+fe));if(be)return be}},L=[0,0,0],B=(Z,te)=>(L[0]=Math.min(Z.min.y,te.min.y),L[1]=Math.max(Z.max.y,te.max.y),L[2]=o.aj-te.min.x>Z.max.x?te.min.x-o.aj:Z.max.x,L),O=(Z,te)=>(L[0]=Math.min(Z.min.x,te.min.x),L[1]=Math.max(Z.max.x,te.max.x),L[2]=o.aj-te.min.y>Z.max.y?te.min.y-o.aj:Z.max.y,L),U=[(Z,te)=>B(Z,te),(Z,te)=>B(te,Z),(Z,te)=>O(Z,te),(Z,te)=>O(te,Z)],q=(Z,te,re,ae,fe,be,Ee)=>{if(!x)return 0;const pe=[[be?re:Z,be?Z:re,0],[be?re:te,be?te:re,0]],_e=Ee<0?o.aj+Ee:Ee,ve=[be?_e:(Z+te)/2,be?(Z+te)/2:_e,0];return re===0&&Ee<0||re!==0&&Ee>0?x.getForTilePoints(fe,[ve],!0,ae):pe.push(ve),x.getForTilePoints(c,pe,!0,I),Math.max(pe[0][2],pe[1][2],ve[2])/x.exaggeration()};for(let Z=0;Z<4;Z++){const te=p.borderFeatureIndices[Z];if(te.length===0)continue;const re=o.e3[Z](c),ae=D(re);if(!(ae&&ae instanceof o.e4))continue;const fe=x?x.findDEMTileFor(re):null;if(!(fe&&fe.dem||b)||(x&&fe&&fe.dem&&p.borderDEMTileTimestamp[Z]!==fe.dem._timestamp&&(p.borderDoneWithNeighborZ[Z]=-1,p.borderDEMTileTimestamp[Z]=fe.dem._timestamp),p.borderDoneWithNeighborZ[Z]===ae.canonical.z))continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();const be=(Z<2?1:5)-Z,Ee=ae.borderDoneWithNeighborZ[be]!==p.canonical.z,pe=ae.borderFeatureIndices[be];let _e=0;if(p.canonical.z!==ae.canonical.z){for(const ve of te)p.showCentroid(p.featuresOnBorder[ve]);if(Ee)for(const ve of pe)ae.showCentroid(ae.featuresOnBorder[ve]);p.borderDoneWithNeighborZ[Z]=ae.canonical.z,ae.borderDoneWithNeighborZ[be]=p.canonical.z}for(const ve of te){const We=p.featuresOnBorder[ve],Le=p.centroidData[We.centroidDataIndex],lt=We.borders[Z];let Ye;for(;_e<pe.length;){Ye=ae.featuresOnBorder[pe[_e]];const ft=Ye.borders[be];if(ft[1]>lt[0]+3||ft[0]>lt[0]-3)break;ae.showCentroid(Ye),_e++}if(Ye&&_e<pe.length){const ft=_e;let kt=0;for(;!(Ye.borders[be][0]>lt[1]-3)&&(kt++,++_e!==pe.length);)Ye=ae.featuresOnBorder[pe[_e]];Ye=ae.featuresOnBorder[pe[ft]];let Ze=!1;if(kt>=1){const Ke=Ye.borders[be];Math.abs(lt[0]-Ke[0])<3&&Math.abs(lt[1]-Ke[1])<3&&(kt=1,Ze=!0,_e=ft+1)}else if(kt===0){p.showCentroid(We);continue}const Ce=ae.centroidData[Ye.centroidDataIndex];b&&Ze&&((($=Le).flags|(X=Ce).flags)&o.e6?($.flags|=o.e6,X.flags|=o.e6):($.flags&=~o.e6,X.flags&=~o.e6));const rt=We.intersectsCount()>1||Ye.intersectsCount()>1;if(kt>1)_e=ft,Le.centroidXY=Ce.centroidXY=new o.P(0,0);else if(fe&&fe.dem&&!rt){const Ke=U[Z](Le,Ce),xt=Z%2?o.aj-1:0,wt=q(Ke[0],Math.min(o.aj-1,Ke[1]),xt,fe,re,Z<2,Ke[2]);Le.centroidXY=Ce.centroidXY=A(wt)}else rt?Le.centroidXY=Ce.centroidXY=new o.P(0,0):(Le.centroidXY=p.encodeBorderCentroid(We),Ce.centroidXY=ae.encodeBorderCentroid(Ye));p.writeCentroidToBuffer(Le),ae.writeCentroidToBuffer(Ce)}else p.showCentroid(We)}p.borderDoneWithNeighborZ[Z]=ae.canonical.z,ae.borderDoneWithNeighborZ[be]=p.canonical.z}var $,X;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const G_=[1,0,0],_E=[0,1,0],yE=[0,0,1];function am(f,r,c){const p=c.transform,y=c.shadowRenderer;if(!y)return!0;const x=f.toUnwrapped(),b=p.tileSize*y._cascades[c.currentShadowCascade].scale;let I=r;if(p.elevation){const $=p.elevation.getMinMaxForTile(f);$&&(I+=$.max)}const A=[...y.shadowDirection];A[2]=-A[2];const D=y.computeSimplifiedTileShadowVolume(x,I,b,A);if(!D)return!1;const L=[G_,_E,yE,A,[A[0],0,A[2]],[0,A[1],A[2]]],B=p.projection.name==="globe",O=p.scaleZoom(b),U=o.cy.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,O,!B),q=y.getCurrentCascadeFrustum();return U.intersectsPrecise(D.vertices,D.planes,L)===0||q.intersectsPrecise(D.vertices,D.planes,L)===0}function lm(f){const{painter:r,source:c,layer:p,coords:y}=f,x=f.defines,b=r.context,I=r.renderPass==="shadow",A=r.renderPass==="light-beam",D=r.shadowRenderer;let L;D&&(L=x.concat(["SHADOWS_SINGLE_CASCADE"]));const B=o.e9(r.transform.center.lat,r.transform.zoom);for(const O of y){const U=c.getTile(O),q=U.getBucket(p);if(!q)continue;let $=!1;D&&($=D.getMaxCascadeForTile(O.toUnwrapped())===0);const X=q.programConfigurations.get(p.id);let Z,te,re=r.translatePosMatrix(O.expandedProjMatrix,U,[0,0],"map");if(re=o.cP(o.bz(),re,[1,1,f.verticalScale]),I&&D){if(am(U.tileID,q.maxHeight*B,r))continue;let ae=D.calculateShadowPassMatrixFromTile(U.tileID.toUnwrapped());ae=o.cP(o.bz(),ae,[1,1,f.verticalScale]),te=E0(ae),Z=r.getOrCreateProgram("buildingDepth",{config:X,defines:$?L:x,overrideFog:!1})}else if(A)Z=r.getOrCreateProgram("buildingBloom",{config:X,defines:$?L:x,overrideFog:!1}),te=D_(re);else{const ae=r.transform.calculatePosMatrix(O.toUnwrapped(),r.transform.worldSize);o.cP(ae,ae,[1,1,f.verticalScale]);const fe=o.bz();o.cP(fe,ae,[1,-1,1/B]),o.bi(fe,fe),o.ea(fe,fe),te=M_(re,fe),Z=r.getOrCreateProgram("building",{config:X,defines:$?L:x,overrideFog:!1}),D&&D.setupShadowsFromMatrix(ae,Z,!0)}if(r.uploadCommonUniforms(b,Z,O.toUnwrapped(),null,null),A){const ae=q.bloomGeometry;Z.draw(r,b.gl.TRIANGLES,f.depthMode,bn.disabled,f.blendMode,yn.disabled,te,p.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segmentsBucket,p.paint,r.transform.zoom,X,[ae.layoutAttenuationBuffer,ae.layoutColorBuffer])}else Z.draw(r,b.gl.TRIANGLES,f.depthMode,bn.disabled,f.blendMode,I?yn.disabled:yn.backCW,te,p.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,p.paint,r.transform.zoom,X,[q.layoutNormalBuffer,q.layoutColorBuffer])}}function D0(f){return[f[0]*o.eb,f[1]*o.eb,f[2]*o.eb,0]}function cm(f,r,c,p,y,x,b,I,A){const D=p.getSource(),L=c.globeSharedBuffers;if(!L)return;let B,O,U;if(r&&(B=p.getTile(r)),D instanceof o.aP?(O=D.texture,U=o.dE(0,0,c.transform)):B&&r&&(O=B.texture,U=o.dE(r.canonical.z,r.canonical.x,c.transform)),!O||!U)return;f||(U=o.cP(o.bz(),U,[1,-1,1]));const q=c.context,$=q.gl,X=y.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR,Z=c.colorModeForDrapableLayerRenderPass(x),te=b.defines;te.push("GLOBE_POLES");const re=new Ut($.LEQUAL,Ut.ReadWrite,c.depthRangeFor3D),ae=Float32Array.from(c.transform.expandedFarZProjMatrix),fe=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),q.activeTexture.set($.TEXTURE0),O.bind(X,$.CLAMP_TO_EDGE),q.activeTexture.set($.TEXTURE1),O.bind(X,$.CLAMP_TO_EDGE),"useMipmap"in O&&q.extTextureFilterAnisotropic&&c.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[be,Ee,pe,_e]=r?L.getPoleBuffers(r.canonical.z,!1):L.getPoleBuffers(0,!0),ve=y.paint.get("raster-elevation");let We;f?(We=be,c.renderDefaultNorthPole=ve!==0):(We=Ee,c.renderDefaultSouthPole=ve!==0);const Le=D0(b.mix),lt=((ft,kt,Ze,Ce,rt,Ke,xt,wt,Et,Nt,tn,dn,qt)=>O_(ft,kt,Ze,new Float32Array(16),new Float32Array(9),[0,0],Ce,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ke,[0,0],wt,2,Nt,tn,dn,1,0,qt))(ae,fe,U,o.ah(c.transform.zoom),0,y,0,ve,0,Le,b.offset,b.range,x),Ye=c.getOrCreateProgram("raster",{defines:te});c.uploadCommonUniforms(q,Ye,null),Ye.draw(c,$.TRIANGLES,re,A,Z,I,lt,y.id,We,pe,_e)}function vE(f){const r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,y=.2*f.height,x=r+y;return[r,c,(x-y-r)/p,(x-r)/p]}function xE(f,r,c,p){if(f)return r instanceof tt&&f instanceof zl?r.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:D0(p.mix),offset:p.offset,buffer:0,tileSize:1}}var oa=o.ec([{name:"a_index",type:"Int16",components:1}]);class $_{constructor(r,c,p,y){const x={width:p[0],height:p[1],data:null},b=r.gl;this.targetColorTexture=new o.T(r,x,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,x,b.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(c,y),this.lastInvalidatedAt=0}updateParticleTexture(r,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=c.width*c.height;this.particleTexture0=new o.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const x=new o.ed;x.reserve(y);for(let b=0;b<y;b++)x.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(x,oa.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Fo(f,r,c){if(!f)return null;const p=r.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:y,mix:x,offset:b,tileSize:I,buffer:A,format:D}=p;if(!y||!D)return null;let L=!1;return D==="uint32"&&(L=!0,x[3]=0,x=tm(o.ee,x,[0,c.paint.get("raster-particle-max-speed")]),b=Xc(o.ee,b,[0,c.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[A/(I+2*A),I/(I+2*A)],tileSize:I,scalarData:L,scale:x,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function tu(f){const r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,y=.2*f.height,x=r+y;return[r,c,(x-y-r)/p,(x-r)/p]}const L0=new o.am(1,0,0,1),H_=new o.am(0,1,0,1),q_=new o.am(0,0,1,1),W_=new o.am(1,0,1,1),O0=new o.am(0,1,1,1);function Gl(f,r,c,p,y,x){for(let b=0;b<c.length;b++)if(y){const D=new o.am(p.r*.8,p.g*.8,p.b*.8,1);Zi(f,r,c[b],p,-1,-1,x),Zi(f,r,c[b],p,-1,1,x),Zi(f,r,c[b],p,1,1,x),Zi(f,r,c[b],p,1,-1,x),Zi(f,r,c[b],D,0,0,x)}else Zi(f,r,c[b],p,0,0,x)}function Zi(f,r,c,p,y,x,b){const I=f.context,A=f.transform,D=I.gl,L=A.projection.name==="globe",B=L?["PROJECTION_GLOBE_VIEW"]:[];let O=o.bw(c.projMatrix);if(L&&o.ah(A.zoom)>0){const Le=o.bg(c.canonical,A),lt=o.ef(Le);O=o.az(new Float32Array(16),A.globeMatrix,lt),o.az(O,A.projMatrix,O)}const U=o.bz();U[12]+=2*y/(o.q.devicePixelRatio*A.width),U[13]+=2*x/(o.q.devicePixelRatio*A.height),o.az(O,U,O);const q=f.getOrCreateProgram("debug",{defines:B}),$=r.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw($,q);const X=Ut.disabled,Z=bn.disabled,te=f.colorModeForRenderPass(),re="$debug";I.activeTexture.set(D.TEXTURE0),f.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),L?$._makeGlobeTileDebugBuffers(f.context,A):$._makeDebugTileBoundsBuffers(f.context,A.projection);const ae=$._tileDebugBuffer||f.debugBuffer,fe=$._tileDebugIndexBuffer||f.debugIndexBuffer,be=$._tileDebugSegments||f.debugSegments;if(q.draw(f,D.LINE_STRIP,X,Z,te,yn.disabled,L_(O,p.toPremultipliedRenderColor(null)),re,ae,fe,be,null,null,null,[$._globeTileDebugBorderBuffer]),b){const Le=$.latestRawTileData,lt=Math.floor((Le&&Le.byteLength||0)/1024);let Ye=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ye+=` => ${c.overscaledZ}`),Ye+=` ${$.state}`,Ye+=` ${lt}kb`,function(ft,kt){ft.initDebugOverlayCanvas();const Ze=ft.debugOverlayCanvas,Ce=ft.context.gl,rt=ft.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ze.width,Ze.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(kt,5,5),rt.strokeText(kt,5,5),ft.debugOverlayTexture.update(Ze),ft.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(f,Ye)}const Ee=r.getTile(c).tileSize,pe=512/Math.min(Ee,512)*(c.overscaledZ/A.zoom)*.5,_e=$._tileDebugTextBuffer||f.debugBuffer,ve=$._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,We=$._tileDebugTextSegments||f.debugSegments;q.draw(f,D.TRIANGLES,X,Z,pn.alphaBlended,yn.disabled,L_(O,o.am.transparent.toPremultipliedRenderColor(null),pe),re,_e,ve,We,null,null,null,[$._globeTileDebugTextBuffer])}function bf(f,r,c,p){Tf(f,0,r+c/2,f.transform.width,c,p)}function um(f,r,c,p){Tf(f,r-c/2,0,c,f.transform.height,p)}function Tf(f,r,c,p,y,x){const b=f.context,I=b.gl;I.enable(I.SCISSOR_TEST),I.scissor(r*o.q.devicePixelRatio,c*o.q.devicePixelRatio,p*o.q.devicePixelRatio,y*o.q.devicePixelRatio),b.clear({color:x}),I.disable(I.SCISSOR_TEST)}const z0=o.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:F0}=z0;function nu(f,r,c,p){f.emplaceBack(r,c,p)}class Gu{constructor(r){this.vertexArray=new o.eg,this.indices=new o.a_,nu(this.vertexArray,-1,-1,1),nu(this.vertexArray,1,-1,1),nu(this.vertexArray,-1,1,1),nu(this.vertexArray,1,1,1),nu(this.vertexArray,-1,-1,-1),nu(this.vertexArray,1,-1,-1),nu(this.vertexArray,-1,1,-1),nu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,F0),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function vl(f,r,c,p,y,x){const b=f.context.gl,I=r.paint.get("sky-atmosphere-color"),A=r.paint.get("sky-atmosphere-halo-color"),D=r.paint.get("sky-atmosphere-sun-intensity"),L=((B,O,U,q,$)=>({u_matrix_3f:B,u_sun_direction:O,u_sun_intensity:U,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[$.r,$.g,$.b,$.a],u_luminance:5e-5}))(o.ei(o.dJ(),p),y,D,I.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),c.draw(f,b.TRIANGLES,Ut.disabled,bn.disabled,pn.unblended,yn.frontCW,L,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Lt=o.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ht{constructor(r){const c=new o.ej;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new o.a_;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,Lt.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Gh=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Gr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class $e{constructor(r){this.colorModeAlphaBlendedWriteRGB=new pn([1,us,1,us],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new pn([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new Gr,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const c=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ht(c);const p=this.params.sizeRange,y=this.params.intensityRange,x=function(L){const B=o.el(30),O=[];for(let U=0;U<L;++U){const q=2*Math.PI*B(),$=Math.acos(1-2*B())-.5*Math.PI;O.push(o.d2(Math.cos($)*Math.cos(q),Math.cos($)*Math.sin(q),Math.sin($)))}return O}(this.params.starsCount),b=o.el(300),I=new o.ek,A=new o.a_;let D=0;for(let L=0;L<x.length;++L){const B=o.c1([],x[L],200),O=Math.max(0,1+.01*p*(1*b()-.5)),U=Math.max(0,1+.01*y*(1*b()-.5));I.emplaceBack(B[0],B[1],B[2],-1,-1,O,U),I.emplaceBack(B[0],B[1],B[2],1,-1,O,U),I.emplaceBack(B[0],B[1],B[2],1,1,O,U),I.emplaceBack(B[0],B[1],B[2],-1,1,O,U),A.emplaceBack(D+0,D+1,D+2),A.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=c.createVertexBuffer(I,Gh.members),this.starsIdx=c.createIndexBuffer(A),this.starsSegments=o.bd.simpleSegment(0,0,I.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,c){const p=r.context,y=p.gl,x=r.transform,b=new Ut(y.LEQUAL,Ut.ReadOnly,[0,1]),I=o.ah(x.zoom),A=r.style.getLut(c.scope),D=c.properties.get("color-use-theme")==="none",L=c.properties.get("color").toNonPremultipliedRenderColor(D?null:A).toArray01(),B=c.properties.get("high-color-use-theme")==="none",O=c.properties.get("high-color").toNonPremultipliedRenderColor(B?null:A).toArray01(),U=c.properties.get("space-color-use-theme")==="none",q=c.properties.get("space-color").toNonPremultipliedRenderColor(U?null:A).toArray01(),$=5e-4,X=o.em(c.properties.get("horizon-blend"),0,1,$,.25),Z=o.dy(r,p,x)&&X===$?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,te=r.frameCounter/1e3%1,re=o.ae(x.globeCenterInViewSpace),ae=Math.sqrt(Math.pow(re,2)-Math.pow(Z,2)),fe=Math.acos(ae/re),be=Ee=>{const pe=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ee&&pe.push("ALPHA_PASS");const _e=r.getOrCreateProgram("globeAtmosphere",{defines:pe}),ve=((Le,lt,Ye,ft,kt,Ze,Ce,rt,Ke,xt,wt,Et)=>({u_frustum_tl:Le,u_frustum_tr:lt,u_frustum_br:Ye,u_frustum_bl:ft,u_horizon:kt,u_transition:Ze,u_fadeout_range:Ce,u_color:rt,u_high_color:Ke,u_space_color:xt,u_temporal_offset:wt,u_horizon_angle:Et}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,I,X,L,O,q,te,fe);r.uploadCommonUniforms(p,_e);const We=this.atmosphereBuffer;We&&_e.draw(r,y.TRIANGLES,b,bn.disabled,Ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,yn.backCW,ve,Ee?"atmosphere_glow_alpha":"atmosphere_glow",We.vertexBuffer,We.indexBuffer,We.segments)};be(!1),be(!0)}drawStars(r,c){const p=o.ay(c.properties.get("star-intensity"),0,1);if(p===0)return;const y=r.context,x=y.gl,b=r.transform,I=r.getOrCreateProgram("stars"),A=o.c3([]);o.c5(A,A,-b._pitch),o.c4(A,A,-b.angle),o.c5(A,A,o.al(b._center.lat)),o.en(A,A,-o.al(b._center.lng));const D=o.c8(new Float32Array(16),A),L=o.az([],b.starsProjMatrix,D),B=o.ei([],D),O=o.eo([],B),U=[0,1,0];o.dL(U,U,O),o.c1(U,U,this.params.sizeMultiplier);const q=[1,0,0];o.dL(q,q,O),o.c1(q,q,this.params.sizeMultiplier);const $=(X=U,Z=q,te=p,{u_matrix:Float32Array.from(L),u_up:X,u_right:Z,u_intensity_multiplier:te});var X,Z,te;r.uploadCommonUniforms(y,I),this.starsVx&&this.starsIdx&&I.draw(r,x.TRIANGLES,Ut.disabled,bn.disabled,this.colorModeAlphaBlendedWriteRGB,yn.disabled,$,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class N0{constructor(){this.visibleTiles=[]}updateBorders(r,c){const p=[],y=[],x=r._getRenderableCoordinates(!1,!0);for(const A of x){const D=r.getTile(A);if(!D.hasData())continue;const L=D.getBucket(c);L&&(L.isEmpty()||(p.push(A.key),y.push({bucket:L,tileID:A.canonical})))}let b=p.length!==this.visibleTiles.length;if(!b){p.sort();for(let A=0;A<p.length;A++)if(p[A]!==this.visibleTiles[A]){b=!0;break}}if(!b)return;const I=new Set;this.visibleTiles=p,y.sort((A,D)=>A.tileID.z-D.tileID.z||A.tileID.x-D.tileID.x||A.tileID.y-D.tileID.y);for(const A of y){const D=new Array,L=new Array,B=A.bucket;for(const O of B.featuresOnBorder)I.has(O.featureId)?L.push(O.footprintIndex):(I.add(O.featureId),D.push(O.footprintIndex));B.updateFootprintHiddenFlags(D,o.ep,!1),B.updateFootprintHiddenFlags(L,o.ep,!0)}}}function Ef(f,r){const c=[...f],p=r.cameraWorldSizeForFog/r.worldSize,y=o.bx([]);return o.cP(y,y,[p,p,1]),o.az(c,y,c),o.az(c,r.worldToFogMatrix,c),c}function If(f,r,c,p,y){const x=c.material,b=p.context,{baseColorTexture:I,metallicRoughnessTexture:A}=x.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:L,emissionTexture:B}=x;function O(q,$,X){if(q&&(f.push($),b.activeTexture.set(b.gl.TEXTURE0+X),q.gfxTexture)){const{minFilter:Z,magFilter:te,wrapS:re,wrapT:ae}=q.sampler;q.gfxTexture.bindExtraParam(Z,te,re,ae)}}O(I,"HAS_TEXTURE_u_baseColorTexture",zo.BaseColor),O(A,"HAS_TEXTURE_u_metallicRoughnessTexture",zo.MetallicRoughness),O(D,"HAS_TEXTURE_u_normalTexture",zo.Normal),O(L,"HAS_TEXTURE_u_occlusionTexture",zo.Occlusion),O(B,"HAS_TEXTURE_u_emissionTexture",zo.Emission),y&&(y.texture||(y.texture=new o.et(p.context,y.image,[y.image.height,y.image.height,y.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+zo.LUT),y.texture&&y.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(c.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED");const U=p.shadowRenderer;U&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&f.push("NORMAL_OFFSET"))}function $h(f,r,c,p,y,x){const b=c.paint.get("model-opacity").constantOr(1),I=r.context,A=new Ut(r.context.gl.LEQUAL,Ut.ReadWrite,r.depthRangeFor3D),D=r.transform,L=f.mesh,B=L.material,O=B.pbrMetallicRoughness,U=r.style.fog;let q;q=r.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:o.az([],p.zScaleMatrix,f.nodeModelMatrix),o.az(q,p.negCameraPosMatrix,q);const $=o.bi([],q);o.ea($,$);const X=c.paint.get("model-color-use-theme").constantOr("default")==="none",Z=c.paint.get("model-emissive-strength").constantOr(0),te=F_(new Float32Array(f.worldViewProjection),new Float32Array(q),new Float32Array($),null,r,b,O.baseColorFactor,B.emissiveFactor,O.metallicFactor,O.roughnessFactor,B,Z,c),re={defines:[]},ae=[],fe=r.shadowRenderer;fe&&(fe.useNormalOffset=!1),If(re.defines,ae,L,r,X?null:c.lut);let be=null;if(U){const _e=Ef(f.nodeModelMatrix,r.transform);if(be=new Float32Array(_e),D.projection.name!=="globe"){const ve=L.aabb.min,We=L.aabb.max,[Le,lt]=U.getOpacityForBounds(_e,ve[0],ve[1],We[0],We[1]);re.overrideFog=Le>=pt||lt>=pt}}const Ee=jl(r,c.paint.get("model-cutoff-fade-range"));Ee.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");const pe=r.getOrCreateProgram("model",re);r.uploadCommonUniforms(I,pe,null,be,Ee),r.renderPass!=="shadow"&&fe&&fe.setupShadowsFromMatrix(f.nodeModelMatrix,pe),pe.draw(r,I.gl.TRIANGLES,A,y,x,L.material.doubleSided?yn.disabled:yn.backCCW,te,c.id,L.vertexBuffer,L.indexBuffer,L.segments,c.paint,r.transform.zoom,void 0,ae)}function Z_(f,r,c,p,y,x,b){let I;I=f.projection.name==="globe"?o.er(c,f):[...c],o.az(I,I,r.matrix);const A=o.az([],p,I);if(r.meshes)for(const D of r.meshes){if(D.material.alphaMode!=="BLEND"){b.push({mesh:D,depth:0,modelIndex:y,worldViewProjection:A,nodeModelMatrix:I});continue}const L=o.ad([],D.centroid,A);!f.isOrthographic&&L[2]<=0||x.push({mesh:D,depth:L[2],modelIndex:y,worldViewProjection:A,nodeModelMatrix:I})}if(r.children)for(const D of r.children)Z_(f,D,c,p,y,x,b)}function hm(f,r,c,p){const y=c.shadowRenderer;if(!y)return;const x=y.getShadowPassDepthMode(),b=y.getShadowPassColorMode(),I=y.calculateShadowPassMatrixFromMatrix(r),A=R0(I);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,x,bn.disabled,b,yn.backCCW,A,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function Hh(f,r,c){const p=r.updateZoomBasedPaintProperties(),y=function(x,b,I){let A,D,L,B=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&B>0){const O=x.terrain,U=O.findDEMTileFor(I);U&&U.dem?A=o.eu.create(O,I,U):B=0}if(B===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),B===b.validForExaggeration&&(B===0||A&&A._demTile&&A._demTile.tileID===b.validForDEMTile.id&&A._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const O in b.instancesPerModel){const U=b.instancesPerModel[O];for(let q=0;q<U.instancedDataArray.length;++q){const $=(A?B*A.getElevationAt(0|U.instancedDataArray.float32[16*q],0|U.instancedDataArray.float32[16*q+1],!0,!0):0)+U.instancesEvaluatedElevation[q];U.instancedDataArray.float32[16*q+6]=$,D=D?Math.min(b.terrainElevationMin,$):$,L=L?Math.max(b.terrainElevationMax,$):$}}return b.terrainElevationMin=D||0,b.terrainElevationMax=L||0,b.validForExaggeration=B,b.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,r,c);(p||y)&&(r.uploaded=!1,r.upload(f.context))}const $l={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d6([0,0,0],[o.aj,o.aj,0])};function wE(f,r){const c=1<<f.canonical.z,p=r.getFreeCameraOptions().position,y=r.elevation,x=f.canonical.x/c,b=(f.canonical.x+1)/c,I=f.canonical.y/c,A=(f.canonical.y+1)/c;let D=r._centerAltitude;if(y){const U=y.getMinMaxForTile(f);U&&U.max>D&&(D=U.max)}const L=o.ay(p.x,x,b)-p.x,B=o.ay(p.y,I,A)-p.y,O=o.cb(D,r.center.lat)-p.z;return r._zoomFromMercatorZ(Math.sqrt(L*L+B*B+O*O))}function X_(f,r,c,p,y,x,b){const I=f.context,A=f.renderPass==="shadow",D=f.shadowRenderer,L=A&&D?D.getShadowPassDepthMode():new Ut(I.gl.LEQUAL,Ut.ReadWrite,f.depthRangeFor3D),B=f.isTileAffectedByFog(x);if(c.meshes)for(const O of c.meshes){const U=["MODEL_POSITION_ON_GPU"],q=[];let $,X,Z;p.instancedDataArray.length>20&&U.push("INSTANCED_ARRAYS");const te=jl(f,r.paint.get("model-cutoff-fade-range"));if(te.shouldRenderCutoff&&U.push("RENDER_CUTOFF"),A&&D)$=f.getOrCreateProgram("modelDepth",{defines:U}),X=R0(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(c.matrix)),Z=D.getShadowPassColorMode();else{If(U,q,O,f,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),$=f.getOrCreateProgram("model",{defines:U,overrideFog:B});const ae=O.material,fe=ae.pbrMetallicRoughness,be=r.paint.get("model-opacity").constantOr(1),Ee=r.paint.get("model-emissive-strength").constantOr(0);X=F_(x.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,f,be,fe.baseColorFactor,ae.emissiveFactor,fe.metallicFactor,fe.roughnessFactor,ae,Ee,r,y),D&&(b.shadowUniformsInitialized?$.setShadowUniformValues(I,D.getShadowUniformValues()):(D.setupShadows(x.toUnwrapped(),$,"model-tile"),b.shadowUniformsInitialized=!0)),Z=te.shouldRenderCutoff||be<1||ae.alphaMode!=="OPAQUE"?pn.alphaBlended:pn.unblended}f.uploadCommonUniforms(I,$,x.toUnwrapped(),null,te);const re=O.material.doubleSided?yn.disabled:yn.backCCW;if(p.instancedDataArray.length>20)q.push(p.instancedDataBuffer),$.draw(f,I.gl.TRIANGLES,L,bn.disabled,Z,re,X,r.id,O.vertexBuffer,O.indexBuffer,O.segments,r.paint,f.transform.zoom,void 0,q,p.instancedDataArray.length);else{const ae=A?"u_instance":"u_normal_matrix";for(let fe=0;fe<p.instancedDataArray.length;++fe)X[ae]=new Float32Array(p.instancedDataArray.arrayBuffer,64*fe,16),$.draw(f,I.gl.TRIANGLES,L,bn.disabled,Z,re,X,r.id,O.vertexBuffer,O.indexBuffer,O.segments,r.paint,f.transform.zoom,void 0,q)}}if(c.children)for(const O of c.children)X_(f,r,O,p,y,x,b)}const dm=[1,-1,1];function K_(f,r,c,p){if(!c.modelManager)return!0;const y=c.modelManager;if(!c.shadowRenderer)return!0;const x=c.shadowRenderer,b=r.aabb;let I=!0,A=f.maxHeight;if(A===0){let L=0;for(const B in f.instancesPerModel){const O=y.getModel(B,p);O?L=Math.max(L,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):I=!1}A=f.maxScale*L*1.41+f.maxVerticalOffset,I&&(f.maxHeight=A)}b.max[2]=A,b.min[2]+=f.terrainElevationMin,b.max[2]+=f.terrainElevationMax,o.ad(b.min,b.min,r.tileMatrix),o.ad(b.max,b.max,r.tileMatrix);const D=b.intersects(x.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=D===2),D===0}function B0(f,r){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return p===c||x===y?1:o.ay(((r-c)/(p-c)-y)/(x-y),0,1)}function V0(f,r,c,p){if(r.pitch<20)return 1;const y=r.getWorldToCameraMatrix();o.az(y,y,f);const x=o.bR(c.min[0],c.min[1],c.min[2],1);let b=o.aA(o.ev(),x,y),I=b,A=b;x[1]=c.max[1],b=o.aA(o.ev(),x,y),I=b[1]<I[1]?b:I,A=b[1]>A[1]?b:A,x[0]=c.max[0],b=o.aA(o.ev(),x,y),I=b[1]<I[1]?b:I,A=b[1]>A[1]?b:A,x[1]=c.min[1],b=o.aA(o.ev(),x,y),I=b[1]<I[1]?b:I,A=b[1]>A[1]?b:A;const D=o.ay(p[0],0,1),L=100*r.pixelsPerMeter*o.ay(p[1],0,1),B=o.ay(p[2],0,1),O=o.ew(o.ev(),I,A,D),U=Math.tan(.5*r.fovX),q=-O[2]*U;if(L===0)return O[1]<-Math.abs(q)?B:1;const $=(-Math.abs(q)-O[1])/L,X=(te,re,ae)=>(1-ae)*te+ae*re,Z=o.ay(X(1,B,$),B,1);return X(1,Z,o.ay((r.pitch-20)/20,0,1))}class fm{}class Sf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,c,p){{const B=this._storage.get(c.id);if(B)return B.lastUsedFrameIdx=r,B.buf}const y=p.gl,x=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),b=new ArrayBuffer(x),I=new Int16Array(b);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const A=new o.ey;for(let B=0;B<x/2;B+=3){const O=I[B],U=I[B+1],q=I[B+2];A.emplaceBack(O,U),A.emplaceBack(U,q),A.emplaceBack(q,O)}const D=p.bindVertexArrayOES.current,L=new fm;return L.buf=new Qc(p,A),L.lastUsedFrameIdx=r,this._storage.set(c.id,L),p.bindVertexArrayOES.set(D),L.buf}update(r){for(const[c,p]of this._storage)r-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[r,c]of this._storage)c.buf.destroy(),this._storage.delete(r)}}class qh{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const U0=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class bE{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class bo{constructor(r,c){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const TE=o.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class Af{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,c){const p=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new o.ez,I=new o.a_;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(b,TE.members),this.vignetteIdx=r.context.createIndexBuffer(I)}const y=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,p);const b={u_vignetteShape:(x={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};p.draw(r,r.context.gl.TRIANGLES,Ut.disabled,bn.disabled,pn.alphaBlended,yn.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,y)}var x}}class mr{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,c){const p=r.getFreeCameraOptions().position,y=p.toAltitude(),x=p.toLngLat(),b=o.al(x.lng),I=o.al(x.lat),A=r.pixelsPerMeter/c,D=b*o.eB,L=o.eB*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const B=-this._offsetYPrev+L,O=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*A,this._accumulatedOffsetY+=B*A,this._accumulatedElevation+=O*A,this._offsetXPrev=D,this._offsetYPrev=L,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function di(f,r){return[-(f[0]-Math.floor(f[0]/r)*r),-(f[1]-Math.floor(f[1]/r)*r),-(f[2]-Math.floor(f[2]/r)*r)]}function Y_(f){const r=o.el(1323123451230),c=[];for(let p=0;p<f;++p){const y=2*r()-1,x=2*r()-1,b=2*r()-1;c.push(o.d2(y,x,b))}return c}function Ko(f,r,c,p,y){const x=o.ay((y-c)/(p-c),0,1);return(1-x)*f+x*r}class Wh{constructor(r){this._movement=new mr,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Af,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,c){const p=r.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,x=o.c3([]);o.c5(x,x,o.al(90)-p._pitch),o.c4(x,x,-p.angle);const b=o.c8(new Float32Array(16),x),I=o.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=o.ea([],I),D=o.az([],A,b),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*c,this._prevTime=L,{projectionMatrix:y,modelviewMatrix:D}}}class Zh extends Wh{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new bo(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const p=Y_(this.particlesCount),y=new o.eC,x=new o.a_;let b=0;const I=o.el(1323123451230);for(let A=0;A<p.length;++A){const D=p[A],L=[2*I()-1,I(),I(),I()];y.emplaceBack(D[0],D[1],D[2],-1,-1,...L),y.emplaceBack(D[0],D[1],D[2],1,-1,...L),y.emplaceBack(D[0],D[1],D[2],1,1,...L),y.emplaceBack(D[0],D[1],D[2],-1,1,...L),x.emplaceBack(b+0,b+1,b+2),x.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=c.createVertexBuffer(y,U0.members),this.particlesIdx=c.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=r.transform.zoom;if(c.revealStart>p)return;const y=Ko(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let b=[-x.direction.x,x.direction.y,-100];o.au(b,b);const I=structuredClone(this._vignetteParams);I.strength*=y,x.overrideStyleParameters||(x.intensity=r.style.rain.state.density,x.timeFactor=r.style.rain.state.intensity,x.color=structuredClone(r.style.rain.state.color),b=structuredClone(r.style.rain.state.direction),x.screenThinning.intensity=r.style.rain.state.centerThinning,x.dropletSizeX=r.style.rain.state.dropletSize[0],x.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],x.distortionStrength=100*r.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(r.style.rain.state.vignetteColor));const A=this.updateOnRender(r,x.timeFactor),D=r.context,L=D.gl,B=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new o.T(D,{width:r.width,height:r.height,data:null},L.RGBA8)),x.distortionStrength>0&&(D.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const O=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(D,O),D.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const U=[x.color.r,x.color.g,x.color.b,x.color.a],q=($,X)=>{const Z=di(this._movement.getPosition(),$),te=x.dropletSizeX,re=x.dropletSizeX*x.dropletSizeYScale,ae=r.width/2,fe=r.height/2,be=Ko(0,x.screenThinning.start,0,1,x.screenThinning.intensity),Ee=Ko(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),pe=Ko(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),_e=(ve={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:$,rainDropletSize:[te,re],distortionStrength:x.distortionStrength,rainDirection:b,color:U,screenSize:[B.width,B.height],thinningCenterPos:[ae,fe],thinningShape:[be,Ee,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:pe,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:X?0:1},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_texScreen:0,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_boxSize:ve.boxSize,u_rainDropletSize:ve.rainDropletSize,u_distortionStrength:ve.distortionStrength,u_rainDirection:ve.rainDirection,u_color:ve.color,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_shapeDirectionalPower:ve.shapeDirectionalPower,u_shapeNormalPower:ve.shapeNormalPower,u_mode:ve.mode});var ve;const We=Math.round(x.intensity*this.particlesCount),Le=o.bd.simpleSegment(0,0,4*We,2*We);O.draw(r,L.TRIANGLES,Ut.disabled,bn.disabled,pn.alphaBlended,yn.disabled,_e,"rain_particles",this.particlesVx,this.particlesIdx,Le)};x.distortionStrength>0&&q(x.boxSize,!0),q(x.boxSize,!1),this._vignette.draw(r,I)}}const $u=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Q_ extends Wh{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new bo(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const p=Y_(this.particlesCount),y=new o.eD,x=new o.a_;let b=0;const I=o.el(1323123451230);for(let A=0;A<p.length;++A){const D=p[A],L=I(),B=I(),O=I(),U=[A/p.length,L,B,O],q=[I(),I()];y.emplaceBack(D[0],D[1],D[2],-1,-1,...U,...q),y.emplaceBack(D[0],D[1],D[2],1,-1,...U,...q),y.emplaceBack(D[0],D[1],D[2],1,1,...U,...q),y.emplaceBack(D[0],D[1],D[2],-1,1,...U,...q),x.emplaceBack(b+0,b+1,b+2),x.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=c.createVertexBuffer(y,$u.members),this.particlesIdx=c.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];o.au(p,p);const y=structuredClone(this._vignetteParams),x=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=r.transform.zoom;if(x.revealStart>b)return;const I=Ko(0,1,x.revealStart,x.revealStart+x.revealRange,b);y.strength*=I,c.overrideStyleParameters||(c.intensity=r.style.snow.state.density,c.timeFactor=r.style.snow.state.intensity,c.color=structuredClone(r.style.snow.state.color),p=structuredClone(r.style.snow.state.direction),c.screenThinning.intensity=r.style.snow.state.centerThinning,c.billboardSize=2.79*r.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(r.style.snow.state.vignetteColor));const A=this.updateOnRender(r,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=r.context,L=D.gl,B=r.transform,O=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(D,O),((U,q,$)=>{const X=di(this._movement.getPosition(),U),Z=B.width/2,te=B.height/2,re=Ko(0,$.screenThinning.start,0,1,$.screenThinning.intensity),ae=Ko(.001,$.screenThinning.range,0,1,$.screenThinning.intensity),fe=Ko(0,$.screenThinning.particleOffset,0,1,$.screenThinning.intensity),be=(Ee={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:$.velocityConeAperture,velocity:$.velocity,horizontalOscillationRadius:$.horizontalOscillationRadius,horizontalOscillationRate:$.horizontalOscillationRate,boxSize:U,billboardSize:1*$.billboardSize,simpleShapeParameters:[$.shapeFadeStart,$.shapeFadePower],screenSize:[B.width,B.height],thinningCenterPos:[Z,te],thinningShape:[re,ae,Math.pow(10,$.screenThinning.fadePower)],thinningAffectedRatio:$.screenThinning.affectedRatio,thinningParticleOffset:fe,color:[$.color.r,$.color.g,$.color.b,$.color.a],direction:p},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_horizontalOscillationRadius:Ee.horizontalOscillationRadius,u_horizontalOscillationRate:Ee.horizontalOscillationRate,u_boxSize:Ee.boxSize,u_billboardSize:Ee.billboardSize,u_simpleShapeParameters:Ee.simpleShapeParameters,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_particleColor:Ee.color,u_direction:Ee.direction});var Ee;const pe=Math.round($.intensity*this.particlesCount),_e=o.bd.simpleSegment(0,0,4*pe,2*pe);this.particlesVx&&this.particlesIdx&&O.draw(r,L.TRIANGLES,Ut.disabled,bn.disabled,pn.alphaBlended,yn.disabled,be,"snow_particles",this.particlesVx,this.particlesIdx,_e)})(c.boxSize,0,c),this._vignette.draw(r,y)}}const J_={symbol:function(f,r,c,p,y){if(f.renderPass!=="translucent")return;const x=bn.disabled,b=f.colorModeForRenderPass(),I=c.layout.get("text-variable-anchor"),A=c.layout.get("text-size-scale-range"),D=o.ay(f.scaleFactor,A[0],A[1]);I&&function(O,U,q,$,X,Z,te,re){const ae=U.transform,fe=X==="map",be=Z==="map";for(const Ee of O){const pe=$.getTile(Ee),_e=pe.getBucket(q);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const ve=o.bH(_e.textSizeData,ae.zoom,re),We=Ru(Ee,_e.getProjection(),ae),Le=ae.calculatePixelsToTileUnitsMatrix(pe),lt=Nc(We,pe.tileID.canonical,be,fe,ae,_e.getProjection(),Le),Ye=_e.hasIconTextFit()&&_e.hasIconData();ve&&M0(_e,fe,be,te,ae,lt,Ee,Math.pow(2,ae.zoom-pe.tileID.overscaledZ),ve,Ye)}}(p,f,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y,D);const L=c.paint.get("icon-opacity").constantOr(1)!==0,B=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||B)?j_(f,r,c,p,x,b):(L&&j_(f,r,c,p,x,b,{onlyIcons:!0}),B&&j_(f,r,c,p,x,b,{onlyText:!0})),r.map.showCollisionBoxes&&(V_(f,r,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),V_(f,r,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,c,p){if(f.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),b=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0,A=c.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(x.constantOr(1)===0||b.constantOr(1)===0))return;const D=f.context,L=D.gl,B=f.transform,O=!(!f.terrain||!f.terrain.enabled),U=c.layout.get("circle-elevation-reference"),q=f.depthModeForSublayer(0,Ut.ReadOnly),$=new Ut(f.context.gl.LEQUAL,Ut.ReadOnly,f.depthRangeFor3D),X=U==="none"||O?q:$,Z=bn.disabled,te=f.colorModeForDrapableLayerRenderPass(A),re=B.projection.name==="globe",ae=[o.aD(B.center.lng),o.aH(B.center.lat)],fe=[];for(let Ee=0;Ee<p.length;Ee++){const pe=p[Ee],_e=r.getTile(pe),ve=_e.getBucket(c);if(!ve||ve.projection.name!==B.projection.name)continue;const We=ve.programConfigurations.get(c.id),Le=ve.layoutVertexBuffer,lt=ve.globeExtVertexBuffer,Ye=ve.indexBuffer,ft=o.dW(c),kt=[lt],Ze=f.isTileAffectedByFog(pe);re&&ft.push("PROJECTION_GLOBE_VIEW"),ft.push("DEPTH_D24"),f.terrain&&B.depthOcclusionForSymbolsAndCircles&&ft.push("DEPTH_OCCLUSION"),ve.hasElevation&&!f.terrain&&(ft.push("ELEVATED_ROADS"),kt.push(ve.elevatedLayoutVertexBuffer));const Ce=f.getOrCreateProgram("circle",{config:We,defines:ft,overrideFog:Ze}),rt=B.projection.createInversionMatrix(B,pe.canonical),Ke={programConfiguration:We,program:Ce,layoutVertexBuffer:Le,dynamicBuffers:kt,indexBuffer:Ye,uniformValues:o.dX(f,pe,_e,rt,ae,c),tile:_e};if(I){const xt=ve.segments.get();for(const wt of xt)fe.push({segments:new o.bd([wt]),sortKey:wt.sortKey,state:Ke})}else fe.push({segments:ve.segments,sortKey:0,state:Ke})}I&&fe.sort((Ee,pe)=>Ee.sortKey-pe.sortKey);const be={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const Ee of fe){const{programConfiguration:pe,program:_e,layoutVertexBuffer:ve,dynamicBuffers:We,indexBuffer:Le,uniformValues:lt,tile:Ye}=Ee.state,ft=Ee.segments;f.terrain&&f.terrain.setupElevationDraw(Ye,_e,be),f.uploadCommonUniforms(D,_e,Ye.tileID.toUnwrapped()),_e.draw(f,L.TRIANGLES,X,Z,te,yn.disabled,lt,c.id,ve,Le,ft,c.paint,B.zoom,pe,We)}},heatmap:function(f,r,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,x=y.gl,b=bn.disabled,I=new pn([x.ONE,x.ONE,x.ONE,x.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(U,q,$,X){const Z=U.gl,te=q.width*X,re=q.height*X;U.activeTexture.set(Z.TEXTURE1),U.viewport.set([0,0,te,re]);let ae=$.heatmapFbo;if(!ae||ae&&(ae.width!==te||ae.height!==re)){ae&&ae.destroy();const fe=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,fe),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ae=$.heatmapFbo=U.createFramebuffer(te,re,!0,null),function(be,Ee,pe,_e,ve,We){const Le=be.gl;Le.texImage2D(Le.TEXTURE_2D,0,be.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,ve,We,0,Le.RGBA,be.extRenderToTextureHalfFloat?Le.HALF_FLOAT:Le.UNSIGNED_BYTE,null),_e.colorAttachment.set(pe)}(U,0,fe,ae,te,re)}else Z.bindTexture(Z.TEXTURE_2D,ae.colorAttachment.get()),U.bindFramebuffer.set(ae.framebuffer)})(y,f,c,f.transform.projection.name==="globe"?.5:.25),y.clear({color:o.am.transparent});const A=f.transform,D=A.projection.name==="globe",L=D?["PROJECTION_GLOBE_VIEW"]:[],B=D?yn.frontCCW:yn.disabled,O=[o.aD(A.center.lng),o.aH(A.center.lat)];for(let U=0;U<p.length;U++){const q=p[U];if(r.hasRenderableParent(q))continue;const $=r.getTile(q),X=$.getBucket(c);if(!X||X.projection.name!==A.projection.name)continue;const Z=f.isTileAffectedByFog(q),te=X.programConfigurations.get(c.id),re=f.getOrCreateProgram("heatmap",{config:te,defines:L,overrideFog:Z}),{zoom:ae}=f.transform;f.terrain&&f.terrain.setupElevationDraw($,re),f.uploadCommonUniforms(y,re,q.toUnwrapped());const fe=A.projection.createInversionMatrix(A,q.canonical);re.draw(f,x.TRIANGLES,Ut.disabled,b,I,B,S0(f,q,$,fe,O,ae,c.paint.get("heatmap-intensity")),c.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,c.paint,f.transform.zoom,te,D?[X.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,x){const b=y.context,I=b.gl,A=x.heatmapFbo;if(!A)return;b.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get()),b.activeTexture.set(I.TEXTURE1);let D=x.colorRampTexture;D||(D=x.colorRampTexture=new o.T(b,x.colorRamp,I.RGBA8)),D.bind(I.LINEAR,I.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,I.TRIANGLES,Ut.disabled,bn.disabled,y.colorModeForRenderPass(),yn.disabled,((L,B,O,U)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(f,c))},line:function(f,r,c,p){if(f.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;const b=c.paint.get("line-emissive-strength"),I=c.paint.get("line-occlusion-opacity"),A=c.layout.get("line-elevation-reference"),D=c.layout.get("line-width-unit")==="meters",L=A==="sea",B=!(!f.terrain||!f.terrain.enabled),O=f.context,U=O.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const q=c.layout.get("line-cross-slope"),$=q!==void 0,X=q<1,Z=f.colorModeForDrapableLayerRenderPass(b),te=f.terrain&&f.terrain.renderingToTexture,re=te?1:o.q.devicePixelRatio,ae=c.paint.get("line-dasharray"),fe=ae.constantOr(1),be=c.layout.get("line-cap"),Ee=ae.constantOr(null),pe=be.constantOr(null),_e=c.paint.get("line-pattern"),ve=_e.constantOr(1),We=c.paint.get("line-pattern-cross-fade"),Le=_e.constantOr(null),lt=c.paint.get("line-opacity").constantOr(1);let Ye=!ve&&lt!==1||f.depthOcclusion&&I>0&&I<1;const ft=c.paint.get("line-gradient"),kt=ve?"linePattern":"line",Ze=o.dY(c);let Ce;if(te&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Ye=!1),I!==0&&f.depthOcclusion){const wt=c.paint._values["line-opacity"];wt&&wt.value&&wt.value.kind==="constant"?Ce=wt.value:o.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&Ze.push("VARIABLE_LINE_WIDTH");const rt=(wt,Et,Nt,tn,dn,qt)=>{for(const hn of wt){const an=r.getTile(hn);if(ve&&!an.patternsLoaded())continue;const Rn=an.getBucket(c);if(!Rn||Rn.elevationType!=="none"&&!dn||Rn.elevationType==="none"&&dn)continue;f.prepareDrawTile();const Fn=[...Et],ei=f.shadowRenderer,bi=Rn.elevationType==="road"&&!!ei&&ei.enabled;let Dn=[0,0,0];if(bi){const xi=f.style.directionalLight,Di=f.style.ambientLight;xi&&Di&&(Dn=Ou(f.style,xi,Di)),Fn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Ti=Rn.programConfigurations.get(c.id);let Ri=!1;if(Le&&an.imageAtlas){const xi=o.dZ.from(Le),Di=xi.getPrimary().scaleSelf(re).toString(),Qi=an.imageAtlas.patternPositions.get(Di),ns=xi.getSecondary(),Yr=ns?an.imageAtlas.patternPositions.get(ns.scaleSelf(re).toString()):null;Ri=!!Qi&&!!Yr,Qi&&Ti.setConstantPatternPositions(Qi,Yr)}We>0&&(Ri||Ti.getPatternTransitionVertexBuffer("line-pattern"))&&Fn.push("LINE_PATTERN_TRANSITION");const nr=f.isTileAffectedByFog(hn),Kn=f.getOrCreateProgram(kt,{config:Ti,defines:Fn,overrideFog:nr});if(!ve&&Ee&&pe&&an.lineAtlas){const xi=an.lineAtlas.getDash(Ee,pe);xi&&Ti.setConstantPatternPositions(xi)}bi&&ei.setupShadows(an.tileID.toUnwrapped(),Kn,"vector-tile");let[Ei,Ci]=c.paint.get("line-trim-offset");(pe==="round"||pe==="square")&&Ei!==Ci&&(Ei===0&&(Ei-=1),Ci===1&&(Ci+=1));const Mi=te?hn.projMatrix:null,ti=D?1/Rn.tileToMeter/o.aw(an,1,f.transform.zoom):1,$i=D?1/Rn.tileToMeter/o.aw(an,1,Math.floor(f.transform.zoom)):1,ki=ve?o.d_(f,an,c,Mi,re,ti,$i,[Ei,Ci],Dn,We):o.d$(f,an,c,Mi,Rn.lineClipsArray.length,re,ti,$i,[Ei,Ci],Dn);if(ft){const xi=Rn.gradients[c.id];let Di=xi.texture;if(c.gradientVersion!==xi.version){let Qi=256;if(c.stepInterpolant){const ns=r.getSource().maxzoom,Yr=hn.canonical.z===ns?Math.ceil(1<<f.transform.maxZoom-hn.canonical.z):1;Qi=o.ay(o.e0(Rn.maxLineLength/o.aj*1024*Yr),256,O.maxTextureSize)}xi.gradient=o.e1({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Qi,image:xi.gradient||void 0,clips:Rn.lineClipsArray}),xi.texture?xi.texture.update(xi.gradient):xi.texture=new o.T(O,xi.gradient,U.RGBA8),xi.version=c.gradientVersion,Di=xi.texture}O.activeTexture.set(U.TEXTURE1),Di.bind(c.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}fe&&(O.activeTexture.set(U.TEXTURE0),an.lineAtlasTexture&&an.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),Ti.updatePaintBuffers()),ve&&(O.activeTexture.set(U.TEXTURE0),an.imageAtlasTexture&&an.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ti.updatePaintBuffers()),dn&&!L&&f.terrain.setupElevationDraw(an,Kn),f.uploadCommonUniforms(O,Kn,hn.toUnwrapped());const Pr=xi=>{Ce!=null&&(Ce.value=lt*I),Kn.draw(f,U.TRIANGLES,Nt,xi,Z,yn.disabled,ki,c.id,Rn.layoutVertexBuffer,Rn.indexBuffer,Rn.segments,c.paint,f.transform.zoom,Ti,[Rn.layoutVertexBuffer2,Rn.patternVertexBuffer,Rn.zOffsetVertexBuffer]),Ce!=null&&(Ce.value=lt)};if(Ye&&!dn){const xi=f.stencilModeForClipping(hn).ref;xi===0&&te&&O.clear({stencil:0});const Di={func:U.EQUAL,mask:255};ki.u_alpha_discard_threshold=.8,Pr(new bn(Di,xi,255,U.KEEP,U.KEEP,U.INVERT)),ki.u_alpha_discard_threshold=0,Pr(new bn(Di,xi,255,U.KEEP,U.KEEP,U.KEEP))}else ki.u_alpha_discard_threshold=Ye&&dn&&qt?.8:0,Pr(dn?tn:f.stencilModeForClipping(hn))}};let Ke=f.depthModeForSublayer(0,Ut.ReadOnly);const xt=new Ut(f.depthOcclusion?U.GREATER:U.LEQUAL,Ut.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const wt=!te&&f.terrain;I!==0&&wt?o.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):wt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):rt(p,Ze,Ke,bn.disabled,!1,!0)}if(c.hasElevatedBuckets){A==="hd-road-markup"?B||(Ke=xt,Ze.push("ELEVATED_ROADS")):(Ze.push("ELEVATED"),Ke=xt,$&&Ze.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&Ze.push("ELEVATION_REFERENCE_SEA"));const wt=Ye?f.stencilModeFor3D():bn.disabled;f.forceTerrainMode=!0,rt(p,Ze,Ke,wt,!0,!0),Ye&&rt(p,Ze,Ke,wt,!0,!1),f.forceTerrainMode=!1}Ye&&(f.resetStencilClippingMasks(),te&&O.clear({stencil:0})),I===0||f.depthOcclusion||te||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,r,c,p){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const b=c.paint.get("fill-emissive-strength"),I=f.colorModeForDrapableLayerRenderPass(b),A=c.paint.get("fill-pattern"),D=f.opaquePassEnabledForLayer()&&!A.constantOr(1)&&y.constantOr(o.am.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let L="none";c.layout.get("fill-elevation-reference")!=="none"?L="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const B=!(!f.terrain||!f.terrain.enabled),O={painter:f,sourceCache:r,layer:c,coords:p,colorMode:I,elevationType:L,terrainEnabled:B,pass:D};if(f.renderPass!=="shadow")if(L!=="offset"){if(om(O,!1),L==="road"){const U=!B&&f.renderPass==="translucent";U&&Xt(f,r,c,p,"geometry"),om(O,!0,bn.disabled),U&&function(q){const{painter:$,sourceCache:X,layer:Z,coords:te,colorMode:re}=q,ae=$.context.gl,fe=q.painter.shadowRenderer,be=!!fe&&fe.enabled,Ee=new Ut($.context.gl.LEQUAL,Ut.ReadOnly,$.depthRangeFor3D);let pe=[0,0,0];if(be){const ve=$.style.directionalLight,We=$.style.ambientLight;ve&&We&&(pe=Ou($.style,ve,We))}const _e=ve=>{for(const We of te){const Le=X.getTile(We),lt=Le.getBucket(Z);if(!lt)continue;const Ye=lt.elevatedStructures;if(!Ye)continue;let ft,kt;if(ve?(ft=Ye.renderableBridgeSegments,kt=Ye.bridgeProgramConfigurations.get(Z.id)):(ft=Ye.renderableTunnelSegments,kt=Ye.tunnelProgramConfigurations.get(Z.id)),!ft||ft.segments[0].primitiveLength===0)continue;kt.updatePaintBuffers(),$.prepareDrawTile();const Ze=$.isTileAffectedByFog(We),Ce=[];be&&Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const rt=$.getOrCreateProgram("elevatedStructures",{config:kt,overrideFog:Ze,defines:Ce}),Ke=$.translatePosMatrix(We.projMatrix,Le,Z.paint.get("fill-translate"),Z.paint.get("fill-translate-anchor"));be&&fe.setupShadows(Le.tileID.toUnwrapped(),rt,"vector-tile");const xt=gE(Ke,pe);$.uploadCommonUniforms($.context,rt,We.toUnwrapped()),rt.draw($,ae.TRIANGLES,Ee,bn.disabled,re,yn.backCCW,xt,Z.id,Ye.vertexBuffer,Ye.indexBuffer,ft,Z.paint,$.transform.zoom,kt,[Ye.vertexBufferNormal])}};_e(!0),_e(!1)}(O)}}else om(O,!1,f.stencilModeFor3D());else f.shadowRenderer&&L==="road"&&!B&&function(U){const{painter:q,sourceCache:$,layer:X,coords:Z}=U,te=q.context.gl,re=U.painter.shadowRenderer;for(const ae of Z){const fe=$.getTile(ae),be=fe.getBucket(X);if(!be)continue;const Ee=be.elevatedStructures;if(!Ee||!Ee.shadowCasterSegments||Ee.shadowCasterSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();const pe=be.bufferData.programConfigurations.get(X.id),_e=q.isTileAffectedByFog(ae),ve=q.getOrCreateProgram("elevatedStructuresDepth",{config:pe,overrideFog:_e}),We=re.calculateShadowPassMatrixFromTile(fe.tileID.toUnwrapped());q.uploadCommonUniforms(q.context,ve,ae.toUnwrapped());const Le={u_matrix:We,u_depth_bias:0};ve.draw(q,te.TRIANGLES,re.getShadowPassDepthMode(),bn.disabled,re.getShadowPassColorMode(),yn.disabled,Le,X.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.shadowCasterSegments,X.paint,q.transform.zoom,pe)}}(O)},"fill-extrusion":function(f,r,c,p){const y=c.paint.get("fill-extrusion-opacity"),x=f.context,b=x.gl,I=f.terrain,A=I&&I.renderingToTexture;if(y===0)return;const D=f.conflationActive&&f.style.isLayerClipped(c,r.getSource()),L=f.style.order.indexOf(c.fqid);if(D&&function(B,O,U,q,$){for(const X of q){const Z=O.getTile(X).getBucket(U);Z&&(Z.updateReplacement(X,B.replacementSource,$),Z.uploadCentroid(B.context))}}(f,r,c,p,L),I||D)for(const B of p){const O=r.getTile(B).getBucket(c);O&&In(f.context,r,B,O,c,I,D)}if(f.renderPass==="shadow"&&f.shadowRenderer){const B=f.shadowRenderer;if(I&&y<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const O=B.getShadowPassDepthMode(),U=B.getShadowPassColorMode();wf(f,r,c,p,O,bn.disabled,U,D)}else if(f.renderPass==="translucent"){const B=!c.paint.get("fill-extrusion-pattern").constantOr(1),O=c.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!A&&O.a!==0){const U=new Ut(f.context.gl.LEQUAL,Ut.ReadWrite,f.depthRangeFor3D);y===1&&B?wf(f,r,c,p,U,bn.disabled,pn.unblended,D):(wf(f,r,c,p,U,bn.disabled,pn.disabled,D),wf(f,r,c,p,U,f.stencilModeFor3D(),f.colorModeForRenderPass(),D),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&B&&(!I&&f.transform.projection.name!=="globe"||A)){const U=c.paint.get("fill-extrusion-opacity"),q=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),$=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=c.paint.get("fill-extrusion-flood-light-intensity"),Z=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",te=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Z?null:c.lut).toArray01().slice(0,3),re=q>0&&$>0,ae=X>0,fe=(pe,_e,ve)=>(1-ve)*pe+ve*_e,be=new fc;be.translate=c.paint.get("fill-extrusion-translate"),be.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),be.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),be.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const Ee=pe=>{const _e=f.depthModeForSublayer(1,Ut.ReadOnly,b.LEQUAL,!0),ve=c.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=fe(.1,3,ve),Le=f._showOverdrawInspector;if(!Le){const lt=new bn({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ye=new pn([b.ONE,b.ONE,b.ONE,b.ONE],o.am.transparent,[!1,!1,!1,!0],b.MIN);Xo(be,f,r,c,p,_e,lt,Ye,yn.disabled,pe,"sdf",U,q,$,X,te,We,D,!1)}{const lt=Le?bn.disabled:new bn({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ye=Le?f.colorModeForRenderPass():new pn([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],o.am.transparent,[!0,!0,!0,!0]);Xo(be,f,r,c,p,_e,lt,Ye,yn.disabled,pe,"color",U,q,$,X,te,We,D,!1)}};if(A){const pe=(_e,ve,We)=>{const Le=f.depthModeForSublayer(1,Ut.ReadOnly,b.LEQUAL,!1),lt=c.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=fe(.1,3,lt);{const ft=new pn([b.ONE,b.ONE,b.ONE,b.ONE],o.am.transparent,[!1,!1,!1,!0]);Xo(be,f,r,c,p,Le,bn.disabled,ft,yn.disabled,_e,"clear",U,q,$,X,te,Ye,D,ve)}{const ft=new bn({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),kt=new pn([b.ONE,b.ONE,b.ONE,b.ONE],o.am.transparent,[!1,!1,!1,!0],b.MIN);Xo(be,f,r,c,p,Le,ft,kt,yn.disabled,_e,"sdf",U,q,$,X,te,Ye,D,ve)}{const ft=_e?b.ZERO:b.ONE_MINUS_DST_ALPHA,kt=new bn({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ze=new pn([ft,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],o.am.transparent,[!0,!0,!0,!0]);Xo(be,f,r,c,p,Le,kt,Ze,yn.disabled,_e,"color",U,q,$,X,te,Ye,D,ve)}{const ft=new pn([b.ONE,b.ONE,b.ONE,_e?b.ZERO:b.ONE],o.am.transparent,[!1,!1,!1,!0],_e?b.FUNC_ADD:b.MAX);Xo(be,f,r,c,p,Le,bn.disabled,ft,yn.disabled,_e,"clear",U,q,$,X,te,Ye,D,ve,We)}};if(re||ae){let _e;if(f.prepareDrawTile(),I){const ve=I.drapeBufferSize[0],We=I.drapeBufferSize[1];_e=I.framebufferCopyTexture,_e&&(!_e||_e.size[0]===ve&&_e.size[1]===We)||(_e&&_e.destroy(),_e=I.framebufferCopyTexture=new o.T(x,new o.r({width:ve,height:We}),b.RGBA8)),_e.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,ve,We)}re&&pe(!0,!1,_e),ae&&pe(!1,!0,_e)}}else re&&Ee(!0),ae&&Ee(!1),(re||ae)&&f.resetStencilClippingMasks()}}},building:function(f,r,c,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=c.paint.get("building-ambient-occlusion-ground-intensity"),x=c.paint.get("building-ambient-occlusion-ground-radius"),b=c.paint.get("building-ambient-occlusion-ground-attenuation");let I=y>0&&x>0,A=!0;const D=c.paint.get("building-vertical-scale");D<1&&(A=!1);const L=f.conflationActive&&f.style.isLayerClipped(c,r.getSource()),B=f.style.order.indexOf(c.fqid);if(function(O,U,q,$,X,Z){for(const te of Z){const re=U.getTile(te).getBucket(q);re&&(X&&re.updateReplacement(te,O.replacementSource,$),re.uploadUpdatedIndexBuffer(O.context))}}(f,r,c,B,L,p),function(O,U,q,$){for(const X of $){const Z=U.getTile(X).getBucket(q);Z&&Z.needsEvaluation(O,q)&&(Z.evaluate(q),Z.uploadUpdatedColorBuffer(O.context))}}(f,r,c,p),c.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const O=f.shadowRenderer,U=[],q=O.getShadowPassDepthMode();lm({painter:f,source:r,layer:c,coords:p,defines:U,blendMode:O.getShadowPassColorMode(),depthMode:q,verticalScale:D})}else if(f.renderPass==="translucent"){I&&function($,X,Z,te,re,ae,fe,be,Ee,pe,_e,ve,We){const Le=$.context.gl,lt=$.depthModeForSublayer(1,Ut.ReadOnly,Le.LEQUAL,!0),Ye=.1*(1-(ft=_e))+3*ft;var ft;const kt=$._showOverdrawInspector,Ze=ve,Ce=new fc;kt||Xo(Ce,$,X,Z,te,lt,new bn({func:Le.ALWAYS,mask:255},255,255,Le.KEEP,Le.KEEP,Le.REPLACE),new pn([Le.ONE,Le.ONE,Le.ONE,Le.ONE],o.am.transparent,[!1,!1,!1,!0],Le.MIN),yn.disabled,re,"sdf",1,fe,be,0,pe,Ye,Ze,!1);{const rt=kt?bn.disabled:new bn({func:Le.EQUAL,mask:255},255,255,Le.KEEP,Le.DECR,Le.DECR),Ke=kt?$.colorModeForRenderPass():new pn([Le.ONE_MINUS_DST_ALPHA,Le.DST_ALPHA,Le.ONE,Le.ONE],o.am.transparent,[!0,!0,!0,!0]);Xo(Ce,$,X,Z,te,lt,rt,Ke,yn.disabled,re,"color",1,fe,be,0,pe,Ye,Ze,!1)}}(f,r,c,p,!0,0,y,x,0,[0,0,0],b,L);let O=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];A&&(O=O.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer.useNormalOffset&&(O=O.concat("NORMAL_OFFSET"));const U=new Ut(f.context.gl.LEQUAL,Ut.ReadWrite,f.depthRangeFor3D),q=f.colorModeForRenderPass();lm({painter:f,source:r,layer:c,coords:p,defines:O,blendMode:q,depthMode:U,verticalScale:D})}else if(f.renderPass==="light-beam"){const O=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],U=new Ut(f.context.gl.LEQUAL,Ut.ReadOnly,f.depthRangeFor3D);lm({painter:f,source:r,layer:c,coords:p,defines:O,blendMode:pn.alphaBlended,depthMode:U,verticalScale:D})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,r,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,x=f.terrain&&f.terrain.renderingToTexture,[b,I]=f.renderPass!=="translucent"||x?[{},p]:f.stencilConfigForOverlap(p);for(const A of I){const D=r.getTile(A);if(D.needsHillshadePrepare&&f.renderPass==="offscreen")u0(f,D,c);else if(f.renderPass==="translucent"){const L=f.depthModeForSublayer(0,Ut.ReadOnly),B=c.paint.get("hillshade-emissive-strength"),O=f.colorModeForDrapableLayerRenderPass(B),U=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(A):b[A.overscaledZ];oE(f,A,D,c,L,U,O)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,c,p,y,x){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const b=f.transform.projection.name==="globe",I=c.paint.get("raster-elevation")!==0,A=I&&b;if(f.renderElevatedRasterBackface&&!A)return;const D=f.context,L=D.gl,B=r.getSource(),O=function(be,Ee,pe,_e){const ve=Ee.paint.get("raster-color"),We=be.type==="raster-array",Le=[],lt=Ee.paint.get("raster-resampling"),Ye=Ee.paint.get("raster-color-mix");let ft=Ee.paint.get("raster-color-range");const kt=[Ye[0],Ye[1],Ye[2],0],Ze=Ye[3];let Ce=lt==="nearest"?_e.NEAREST:_e.LINEAR;if(We&&(Le.push("RASTER_ARRAY"),ve||Le.push("RASTER_COLOR"),lt==="linear"&&Le.push("RASTER_ARRAY_LINEAR"),Ce=_e.NEAREST,!ft&&be.rasterLayers)){const rt=be.rasterLayers.find(({id:Ke})=>Ke===Ee.sourceLayer);rt&&rt.fields&&rt.fields.range&&(ft=rt.fields.range)}if(ft=ft||[0,1],ve){Le.push("RASTER_COLOR"),pe.activeTexture.set(_e.TEXTURE2),Ee.updateColorRamp(ft);let rt=Ee.colorRampTexture;rt||(rt=Ee.colorRampTexture=new o.T(pe,Ee.colorRamp,_e.RGBA8)),rt.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:kt,range:ft,offset:Ze,defines:Le,resampling:Ce}}(B,c,D,L);if(B instanceof o.aP&&!p.length&&!b)return;const U=c.paint.get("raster-emissive-strength"),q=f.colorModeForDrapableLayerRenderPass(U),$=f.terrain&&f.terrain.renderingToTexture,X=!f.options.moving,Z=c.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(B instanceof o.aP&&!p.length&&(B.onNorthPole||B.onSouthPole)){const be=I?f.stencilModeFor3D():bn.disabled;return void cm(!!B.onNorthPole,null,f,r,c,U,O,yn.disabled,be)}if(!p.length)return;const[te,re]=B instanceof o.aP||$?[{},p]:f.stencilConfigForOverlap(p),ae=re[re.length-1].overscaledZ;A&&O.defines.push("PROJECTION_GLOBE_VIEW"),I&&O.defines.push("RENDER_CUTOFF");const fe=(be,Ee,pe)=>{for(const _e of be){const ve=_e.toUnwrapped(),We=r.getTile(_e);if($&&(!We||!We.hasData()))continue;D.activeTexture.set(L.TEXTURE0);const Le=xE(We,B,c,O);if(!Le||!Le.texture)continue;const{texture:lt,mix:Ye,offset:ft,tileSize:kt,buffer:Ze}=Le;let Ce,rt;$?(Ce=Ut.disabled,rt=_e.projMatrix):I?(Ce=new Ut(L.LEQUAL,Ut.ReadWrite,f.depthRangeFor3D),rt=b?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(ve,X)):(Ce=f.depthModeForSublayer(_e.overscaledZ-ae,c.paint.get("raster-opacity")===1?Ut.ReadWrite:Ut.ReadOnly,L.LESS),rt=f.transform.calculateProjMatrix(ve,X));const Ke=f.terrain&&$?f.terrain.stencilModeForRTTOverlap(_e):te[_e.overscaledZ],xt=x?0:c.paint.get("raster-fade-duration");We.registerFadeDuration(xt);const wt=r.findLoadedParent(_e,0),Et=Zo(We,wt,r,f.transform,xt);let Nt,tn;f.terrain&&f.terrain.prepareDrawTile(),D.activeTexture.set(L.TEXTURE0),lt.bind(Z,L.CLAMP_TO_EDGE),D.activeTexture.set(L.TEXTURE1),wt?(wt.texture&&wt.texture.bind(Z,L.CLAMP_TO_EDGE),Nt=Math.pow(2,wt.tileID.overscaledZ-We.tileID.overscaledZ),tn=[We.tileID.canonical.x*Nt%1,We.tileID.canonical.y*Nt%1]):lt.bind(Z,L.CLAMP_TO_EDGE),"useMipmap"in lt&&D.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const dn=f.transform;let qt;const hn=I?vE(dn):[0,0,0,0];let an,Rn,Fn,ei,bi,Dn=0;if(A&&B instanceof o.aP&&B.coordinates.length>3)an=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0)))),Rn=Float32Array.from(dn.globeMatrix),Fn=Float32Array.from(o.dz(dn)),ei=[o.aD(dn.center.lng),o.aH(dn.center.lat)],qt=B.elevatedGlobePerspectiveTransform,bi=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const Kn=o.dA(_e.canonical);Dn=o.dB(Kn.getCenter().lat),an=Float32Array.from(o.bh(o.dD(_e.canonical))),Rn=Float32Array.from(dn.globeMatrix),Fn=Float32Array.from(o.dz(dn)),ei=[o.aD(dn.center.lng),o.aH(dn.center.lat)],qt=[0,0],bi=Float32Array.from(o.dC(_e.canonical,Kn,Dn,dn.worldSize/dn._pixelsPerMercatorPixel))}else qt=B instanceof o.aP?B.perspectiveTransform:[0,0],an=new Float32Array(16),Rn=new Float32Array(9),Fn=new Float32Array(16),ei=[0,0],bi=new Float32Array(9);const Ti=O_(rt,an,Rn,Fn,bi,tn||[0,0],o.ah(f.transform.zoom),ei,hn,Nt||1,Et,c,qt,I?c.paint.get("raster-elevation"):0,2,Ye,ft,O.range,kt,Ze,U),Ri=f.isTileAffectedByFog(_e),nr=f.getOrCreateProgram("raster",{defines:O.defines,overrideFog:Ri});if(f.uploadCommonUniforms(D,nr,ve),B instanceof o.aP){const Kn=B.elevatedGlobeVertexBuffer,Ei=B.elevatedGlobeIndexBuffer;if($||!b)B.boundsBuffer&&B.boundsSegments&&nr.draw(f,L.TRIANGLES,Ce,bn.disabled,q,yn.disabled,Ti,c.id,B.boundsBuffer,f.quadTriangleIndexBuffer,B.boundsSegments);else if(Kn&&Ei){const Ci=dn.zoom<=o.cX?B.elevatedGlobeSegments:B.getSegmentsForLongitude(dn.center.lng);Ci&&nr.draw(f,L.TRIANGLES,Ce,bn.disabled,q,Ee,Ti,c.id,Kn,Ei,Ci)}}else if(A){Ce=new Ut(L.LEQUAL,Ut.ReadOnly,f.depthRangeFor3D);const Kn=f.globeSharedBuffers;if(Kn){const[Ei,Ci,Mi]=Kn.getGridBuffers(Dn,!1);nr.draw(f,L.TRIANGLES,Ce,pe||Ke,f.colorModeForRenderPass(),Ee,Ti,c.id,Ei,Ci,Mi)}}else{const{tileBoundsBuffer:Kn,tileBoundsIndexBuffer:Ei,tileBoundsSegments:Ci}=f.getTileBoundsBuffers(We);nr.draw(f,L.TRIANGLES,Ce,Ke,q,yn.disabled,Ti,c.id,Kn,Ei,Ci)}}if(!(B instanceof o.aP)&&A)for(const _e of be){const ve=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&cm(!0,_e,f,r,c,U,O,Ee,pe||bn.disabled),ve&&cm(!1,_e,f,r,c,U,O,Ee===yn.frontCW?yn.backCW:yn.frontCW,pe||bn.disabled)}};A?fe(re,f.renderElevatedRasterBackface?yn.backCW:yn.frontCW,f.stencilModeFor3D()):fe(re,yn.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,r,c,p,y,x){f.renderPass==="offscreen"&&function(b,I,A,D){if(!D.length)return;const L=b.context,B=L.gl,O=I.getSource();if(!(O instanceof tt))return;const U=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let q=A.particlePositionRGBAImage;if(!q||q.width!==U){const re=function(ae){const fe=ae*ae,be=new Uint8Array(4*fe),Ee=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},pe=1/1.1;for(let _e=0;_e<fe;_e++){const ve=pe*(Ee(2*_e+0)+Yc),We=pe*(Ee(2*_e+1)+Yc),Le=255*ve%1,lt=255*We%1,Ye=Le,ft=We-lt/255,kt=lt;be[4*_e+0]=255*(ve-Le/255),be[4*_e+1]=255*Ye,be[4*_e+2]=255*ft,be[4*_e+3]=255*kt}return be}(U);q=A.particlePositionRGBAImage=new o.r({width:U,height:U},re)}let $=A.particleFramebuffer;$?$.width!==U&&($.destroy(),$=A.particleFramebuffer=L.createFramebuffer(U,U,!0,null)):$=A.particleFramebuffer=L.createFramebuffer(U,U,!0,null);const X=[];for(const re of D){const ae=I.getTile(re);if(!(ae instanceof zl))continue;const fe=Fo(ae,O,A);if(!fe)continue;const be=[ae.tileSize,ae.tileSize];let Ee=A.tileFramebuffer;Ee||(Ee=A.tileFramebuffer=L.createFramebuffer(be[0],be[1],!0,null));let pe=ae.rasterParticleState;pe||(pe=ae.rasterParticleState=new $_(L,re,be,q));const _e=pe.update(A.lastInvalidatedAt);pe.particleTextureDimension!==U&&pe.updateParticleTexture(re,q);const ve=pe.targetColorTexture;pe.targetColorTexture=pe.backgroundColorTexture,pe.backgroundColorTexture=ve;const We=pe.particleTexture0;pe.particleTexture0=pe.particleTexture1,pe.particleTexture1=We,X.push([re,fe,pe,_e])}if(X.length===0)return;const Z=o.q.now(),te=A.previousDrawTimestamp?.001*(Z-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=Z,A.hasColorMap()){L.activeTexture.set(B.TEXTURE0+2);let re=A.colorRampTexture;re||(re=A.colorRampTexture=new o.T(L,A.colorRamp,B.RGBA8)),re.bind(B.LINEAR,B.CLAMP_TO_EDGE)}L.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(re,ae,fe){const be=re.context,Ee=be.gl,pe=ae.tileFramebuffer;be.activeTexture.set(Ee.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(We=ae.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},ve=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const Le of fe){const[,,lt,Ye]=Le;pe.colorAttachment.set(lt.targetColorTexture.texture),be.viewport.set([0,0,pe.width,pe.height]),be.clear({color:o.am.transparent}),Ye&&(lt.backgroundColorTexture.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE),ve.draw(re,Ee.TRIANGLES,Ut.disabled,bn.disabled,pn.alphaBlended,yn.disabled,_e,ae.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}}(b,A,X),function(re,ae,fe,be){const Ee=re.context,pe=Ee.gl,_e=fe.tileFramebuffer,ve=re.transform.projection.name==="globe",We=fe.paint.get("raster-particle-max-speed");for(const Le of be){const[lt,Ye,ft]=Le;Ee.activeTexture.set(pe.TEXTURE0+0),Ye.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),_e.colorAttachment.set(ft.targetColorTexture.texture);const kt=re.getOrCreateProgram("rasterParticleDraw",{defines:Ye.defines,overrideFog:!1});Ee.activeTexture.set(pe.TEXTURE0+1);const Ze=Ye.scalarData?[]:[0,1,2,3].map(Ke=>o.e3[Ke](lt));Ze.push(lt);const Ce=lt.canonical.x,rt=lt.canonical.y;for(const Ke of Ze){const xt=ae.getTile(ve?Ke.wrapped():Ke);if(!xt)continue;const wt=xt.rasterParticleState;if(!wt)continue;const Et=Ke.canonical.x+(1<<Ke.canonical.z)*(Ke.wrap-lt.wrap),Nt=Ke.canonical.y;wt.particleTexture0.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const tn=A0(1,wt.particleTexture0.size[0],[Et-Ce,Nt-rt],0,Ye.texture.size,2,We,Ye.textureOffset,Ye.scale,Ye.offset);kt.draw(re,pe.POINTS,Ut.disabled,bn.disabled,pn.alphaBlended,yn.disabled,tn,fe.id,wt.particleIndexBuffer,void 0,wt.particleSegment)}}}(b,I,A,X),L.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(re,ae,fe,be){const Ee=re.context,pe=Ee.gl,_e=ae.paint.get("raster-particle-max-speed"),ve=be*ae.paint.get("raster-particle-speed-factor")*.15,We=function(lt){return Math.pow(lt,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),Le=ae.particleFramebuffer;Ee.viewport.set([0,0,Le.width,Le.height]);for(const lt of fe){const[,Ye,ft]=lt;Ee.activeTexture.set(pe.TEXTURE0+0),Ye.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Ee.activeTexture.set(pe.TEXTURE0+1);const kt=ft.particleTexture0;kt.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const Ze=C0(1,kt.size[0],0,Ye.texture.size,_e,ve,We,Ye.textureOffset,Ye.scale,Ye.offset);Le.colorAttachment.set(ft.particleTexture1.texture),Ee.clear({color:o.am.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Ye.defines}).draw(re,pe.TRIANGLES,Ut.disabled,bn.disabled,pn.unblended,yn.disabled,Ze,ae.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}}(b,A,X,te)}(f,r,c,p),f.renderPass==="translucent"&&(function(b,I,A,D,L){const B=b.context,O=B.gl,U=I.getSource().tileSize,q=5*(1-o.af(o.cI,o.cI+1,b.transform.zoom))*U+A.paint.get("raster-particle-elevation"),$=!b.options.moving,X=b.transform.projection.name==="globe";if(!D.length)return;const[Z,te]=b.stencilConfigForOverlap(D),re=[];X&&re.push("PROJECTION_GLOBE_VIEW");const ae=b.stencilModeFor3D();for(const fe of te){const be=fe.toUnwrapped(),Ee=I.getTile(fe);if(!Ee.rasterParticleState)continue;const pe=Ee.rasterParticleState,_e=100;Ee.registerFadeDuration(_e);const ve=I.findLoadedParent(fe,0),We=Zo(Ee,ve,I,b.transform,_e);let Le,lt;b.terrain&&b.terrain.prepareDrawTile(),B.activeTexture.set(O.TEXTURE0),pe.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),B.activeTexture.set(O.TEXTURE1),ve&&ve.rasterParticleState?(ve.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Le=Math.pow(2,ve.tileID.overscaledZ-Ee.tileID.overscaledZ),lt=[Ee.tileID.canonical.x*Le%1,Ee.tileID.canonical.y*Le%1]):pe.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const Ye=X?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(be,$),ft=b.transform,kt=tu(ft),Ze=o.dA(fe.canonical),Ce=o.dB(Ze.getCenter().lat);let rt,Ke,xt,wt,Et;X?(rt=Float32Array.from(o.bh(o.dD(fe.canonical))),Ke=Float32Array.from(ft.globeMatrix),xt=Float32Array.from(o.dz(ft)),wt=[o.aD(ft.center.lng),o.aH(ft.center.lat)],Et=Float32Array.from(o.dC(fe.canonical,Ze,Ce,ft.worldSize/ft._pixelsPerMercatorPixel))):(rt=new Float32Array(16),Ke=new Float32Array(9),xt=new Float32Array(16),wt=[0,0],Et=new Float32Array(9));const Nt=nm(Ye,rt,Ke,xt,Et,lt||[0,0],o.ah(b.transform.zoom),wt,kt,Le||1,We,q),tn=b.isTileAffectedByFog(fe),dn=b.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:tn});if(b.uploadCommonUniforms(B,dn,be),X){const qt=new Ut(O.LEQUAL,Ut.ReadOnly,b.depthRangeFor3D),hn=0,an=b.globeSharedBuffers;if(an){const[Rn,Fn,ei]=an.getGridBuffers(Ce,hn!==0);dn.draw(b,O.TRIANGLES,qt,ae,pn.alphaBlended,b.renderElevatedRasterBackface?yn.frontCCW:yn.backCCW,Nt,A.id,Rn,Fn,ei)}}else{const qt=b.depthModeForSublayer(0,Ut.ReadOnly),hn=Z[fe.overscaledZ],{tileBoundsBuffer:an,tileBoundsIndexBuffer:Rn,tileBoundsSegments:Fn}=b.getTileBoundsBuffers(Ee);dn.draw(b,O.TRIANGLES,qt,hn,pn.alphaBlended,yn.disabled,Nt,A.id,an,Rn,Fn)}}b.resetStencilClippingMasks()}(f,r,c,p),f.style.map.triggerRepaint())},background:function(f,r,c,p){const y=c.paint.get("background-color"),x=c.paint.get("background-color-use-theme").constantOr("default")==="none",b=c.paint.get("background-opacity"),I=c.paint.get("background-emissive-strength"),A=c.paint.get("background-pitch-alignment")==="viewport";if(b===0)return;const D=f.context,L=D.gl,B=f.transform,O=B.tileSize,U=c.paint.get("background-pattern");let q;if(U!==void 0&&(U===null||(q=f.imageManager.getPattern(o.I.from(U.toString()),c.scope,f.style.getLut(c.scope)),!q)))return;const $=!U&&y.a===1&&b===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==$)return;const X=bn.disabled,Z=f.depthModeForSublayer(0,$==="opaque"?Ut.ReadWrite:Ut.ReadOnly),te=f.colorModeForDrapableLayerRenderPass(I),re=U?"backgroundPattern":"background";let ae,fe=p;if(fe||(ae=f.getBackgroundTiles(),fe=Object.values(ae).map(be=>be.tileID)),U&&(D.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context,c.scope)),A){const be=f.getOrCreateProgram(re,{overrideFog:!1,overrideRtt:!0}),Ee=new Float32Array(o.bx([])),pe=new o.aM(0,0,0,0,0),_e=U?z_(Ee,I,b,f,0,c.scope,q,A,{tileID:pe,tileSize:O}):P0(Ee,I,b,y.toPremultipliedRenderColor(x?null:c.lut));be.draw(f,L.TRIANGLES,Z,X,te,yn.disabled,_e,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const be of fe){const Ee=f.isTileAffectedByFog(be),pe=f.getOrCreateProgram(re,{overrideFog:Ee}),_e=be.toUnwrapped(),ve=p?be.projMatrix:f.transform.calculateProjMatrix(_e);f.prepareDrawTile();const We=r?r.getTile(be):ae?ae[be.key]:new Sa(be,O,B.zoom,f),Le=U?z_(ve,I,b,f,0,c.scope,q,A,{tileID:be,tileSize:O}):P0(ve,I,b,y.toPremultipliedRenderColor(x?null:c.lut));f.uploadCommonUniforms(D,pe,_e);const{tileBoundsBuffer:lt,tileBoundsIndexBuffer:Ye,tileBoundsSegments:ft}=f.getTileBoundsBuffers(We);pe.draw(f,L.TRIANGLES,Z,X,te,yn.disabled,Le,c.id,lt,Ye,ft)}},sky:function(f,r,c){const p=f._atmosphere?o.ah(f.transform.zoom):1,y=c.paint.get("sky-opacity")*p;if(y===0)return;const x=f.context,b=c.paint.get("sky-type"),I=new Ut(x.gl.LEQUAL,Ut.ReadOnly,[0,1]),A=f.frameCounter/1e3%1;b==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&(function(D,L,B,O){const U=D.context,q=U.gl;let $=L.skyboxFbo;if(!$){$=L.skyboxFbo=U.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Gu(U),L.skyboxTexture=U.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,L.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let re=0;re<6;++re)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}U.bindFramebuffer.set($.framebuffer),U.viewport.set([0,0,32,32]);const X=L.getCenter(D,!0),Z=D.getOrCreateProgram("skyboxCapture"),te=new Float64Array(16);o.bx(te),o.eh(te,te,.5*-Math.PI),vl(D,L,Z,te,X,0),o.bx(te),o.eh(te,te,.5*Math.PI),vl(D,L,Z,te,X,1),o.bx(te),o.cR(te,te,.5*-Math.PI),vl(D,L,Z,te,X,2),o.bx(te),o.cR(te,te,.5*Math.PI),vl(D,L,Z,te,X,3),o.bx(te),vl(D,L,Z,te,X,4),o.bx(te),o.eh(te,te,Math.PI),vl(D,L,Z,te,X,5),U.viewport.set([0,0,D.width,D.height])}(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&function(D,L,B,O,U){const q=D.context,$=q.gl,X=D.transform,Z=D.getOrCreateProgram("skybox");q.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,L.skyboxTexture);const te=((re,ae,fe,be,Ee)=>({u_matrix:re,u_sun_direction:ae,u_cubemap:0,u_opacity:be,u_temporal_offset:Ee}))(X.skyboxMatrix,L.getCenter(D,!1),0,O,U);D.uploadCommonUniforms(q,Z),Z.draw(D,$.TRIANGLES,B,bn.disabled,D.colorModeForRenderPass(),yn.backCW,te,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,c,I,y,A):b==="gradient"&&f.renderPass==="sky"&&function(D,L,B,O,U){const q=D.context,$=q.gl,X=D.transform,Z=D.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Gu(q)),q.activeTexture.set($.TEXTURE0);let te=L.colorRampTexture;te||(te=L.colorRampTexture=new o.T(q,L.colorRamp,$.RGBA8)),te.bind($.LINEAR,$.CLAMP_TO_EDGE);const re=((ae,fe,be,Ee,pe)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:fe,u_radius:o.al(be),u_opacity:Ee,u_temporal_offset:pe}))(X.skyboxMatrix,L.getCenter(D,!1),L.paint.get("sky-gradient-radius"),O,U);D.uploadCommonUniforms(q,Z),Z.draw(D,$.TRIANGLES,B,bn.disabled,D.colorModeForRenderPass(),yn.backCW,re,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(f,c,I,y,A)},custom:function(f,r,c,p){const y=f.context,x=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(r)){if(f.renderPass==="offscreen"){const b=x.prerender;if(b){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;b.call(x,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.ah(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else b.call(x,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const I=x.renderToTile;if(I){const A=p[0].canonical,D={x:A.x+p[0].wrap*(x.wrapTileId?0:1<<A.z),y:A.y,z:A.z};y.setDepthMode(Ut.disabled),y.setStencilMode(bn.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),I.call(x,y.gl,D),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(bn.disabled);const b=x.renderingMode==="3d"?new Ut(f.context.gl.LEQUAL,Ut.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ut.ReadOnly);if(y.setDepthMode(b),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;x.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.ah(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else x.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,r,c,p){if(f.renderPass==="opaque")return;const y=c.paint.get("model-opacity").constantOr(1);if(y===0)return;const x=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&y<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const b=f.shadowRenderer,I=c.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,I||(b.enabled=!1));const A=()=>{b&&(b.useNormalOffset=!0,I||(b.enabled=!0))},D=r.getSource();if(f.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(Z,te,re,ae,fe){const be=Z.transform;if(be.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${be.projection.name} projection is not yet implemented`);const Ee=be.getFreeCameraOptions().position;if(!Z.modelManager)return;const pe=Z.modelManager;re.modelManager=pe;const _e=Z.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ve=re._unevaluatedLayout._values["model-id"],We=Object.assign({},re.layout.get("model-id").parameters),Le=Z.style.order.indexOf(re.fqid);for(const lt of ae){const Ye=te.getTile(lt).getBucket(re);if(!Ye||Ye.projection.name!==be.projection.name)continue;const ft=Ye.getModelUris();ft&&!Ye.modelsRequested&&(pe.addModelsFromBucket(ft,fe),Ye.modelsRequested=!0);const kt=wE(lt,be);We.zoom=kt;const Ze=ve.possiblyEvaluate(We);if(Hh(Z,Ye,lt),$l.shadowUniformsInitialized=!1,$l.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(lt.toUnwrapped())===0,Z.renderPass==="shadow"&&_e){if(Z.currentShadowCascade===1&&Ye.isInsideFirstShadowMapFrustum)continue;const Ke=be.calculatePosMatrix(lt.toUnwrapped(),be.worldSize);if($l.tileMatrix.set(Ke),$l.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(Ke)),$l.aabb.min.fill(0),$l.aabb.max[0]=$l.aabb.max[1]=o.aj,$l.aabb.max[2]=0,K_(Ye,$l,Z,re.scope))continue}const Ce=1<<lt.canonical.z,rt=[((Ee.x-lt.wrap)*Ce-lt.canonical.x)*o.aj,(Ee.y*Ce-lt.canonical.y)*o.aj,Ee.z*Ce*o.aj];Z.conflationActive&&Object.keys(Ye.instancesPerModel).length>0&&Z.style.isLayerClipped(re,te.getSource())&&Ye.updateReplacement(lt,Z.replacementSource,Le,fe)&&(Ye.uploaded=!1,Ye.upload(Z.context));for(let Ke in Ye.instancesPerModel){const xt=Ye.instancesPerModel[Ke];xt.features.length>0&&(Ke=Ze.evaluate(xt.features[0].feature,{}));const wt=pe.getModel(Ke,fe);if(wt||pe.hasURLBeenRequested(Ke)||Ye.modelUris.includes(Ke)||(Ye.modelUris.push(Ke),Ye.modelsRequested=!1),wt&&wt.uploaded)for(const Et of wt.nodes)X_(Z,re,Et,xt,rt,lt,$l)}}}(f,r,c,p,D.type==="vector"?c.scope:""),void A();if(!D.loaded())return;if(D.type==="batched-model")return function(Z,te,re,ae){re.resetLayerRenderingStats(Z);const fe=Z.context,be=Z.transform,Ee=Z.style.fog,pe=Z.shadowRenderer;if(be.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${be.projection.name} projection is not yet implemented`);const _e=Z.transform.getFreeCameraOptions().position,ve=o.c1([],[_e.x,_e.y,_e.z],Z.transform.worldSize),We=o.eq([],ve),Le=o.bx([]),lt=o.e9(be.center.lat,be.zoom),Ye=o.bn([],[1,1,1/lt]);o.bo(Le,Le,We);const ft=re.paint.get("model-opacity").constantOr(1),kt=new Ut(fe.gl.LEQUAL,Ut.ReadWrite,Z.depthRangeFor3D),Ze=new Ut(fe.gl.LEQUAL,Ut.ReadOnly,Z.depthRangeFor3D),Ce=new o.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),rt=Z.renderPass==="shadow",Ke=rt&&pe?pe.getCurrentCascadeFrustum():be.getFrustum(be.scaleZoom(be.worldSize)),xt=re.paint.get("model-front-cutoff"),wt=xt[2]<1,Et=jl(Z,re.paint.get("model-cutoff-fade-range")),Nt=re.getLayerRenderingStats();(function(tn,dn,qt,hn){const an=tn.terrain?tn.terrain.exaggeration():0,Rn=tn.transform.zoom;for(const Fn of hn){const ei=dn.getTile(Fn).getBucket(qt);ei&&(ei.setFilter(qt.filter),tn.conflationActive&&ei.updateReplacement(Fn,tn.replacementSource),ei.evaluateTransform(tn,qt),tn.terrain&&an>0&&ei.elevationUpdate(tn.terrain,an,Fn,qt.source),ei.needsReEvaluation(tn,Rn,qt)&&ei.evaluate(qt))}})(Z,te,re,ae),function(){let tn,dn,qt;wt?(tn=ae.length-1,dn=-1,qt=-1):(tn=0,dn=ae.length,qt=1);const hn=new Float64Array(16),an=o.cx(),Rn=new o.P(0,0);for(let Fn=tn;Fn!==dn;Fn+=qt){const ei=ae[Fn],bi=te.getTile(ei).getBucket(re);if(!bi||!bi.uploaded)continue;let Dn=!1;pe&&(Dn=pe.getMaxCascadeForTile(ei.toUnwrapped())===0);const Ti=be.calculatePosMatrix(ei.toUnwrapped(),be.worldSize),Ri=bi.modelTraits;!rt&&wt&&(o.bi(hn,Ti),o.ad(an,ve,hn),Rn.x=an[0],Rn.y=an[1]);const nr=[];bi.setFilter(re.filter);for(const Kn of bi.getNodesInfo()){if(Kn.hiddenByReplacement||!Kn.node.meshes)continue;const Ei=Kn.node;let Ci=0;Z.terrain&&Ei.elevation&&(Ci=Ei.elevation*Z.terrain.exaggeration());const Mi=(()=>{const Zs=Kn.aabb;return Ce.min=[...Zs.min],Ce.max=[...Zs.max],Ce.min[2]+=Ci,Ce.max[2]+=Ci,o.ad(Ce.min,Ce.min,Ti),o.ad(Ce.max,Ce.max,Ti),Ce})(),ti=Kn.evaluatedScale;if(ti[0]<=1&&ti[1]<=1&&ti[2]<=1&&Mi.intersects(Ke)===0)continue;if(!rt&&wt){const Zs=.16666666666666666;Kn.cameraCollisionOpacity=ve[0]>Mi.min[0]&&ve[0]<Mi.max[0]&&ve[1]>Mi.min[1]&&ve[1]<Mi.max[1]&&ve[2]*lt<Mi.max[2]&&Ei.footprint&&o.bY(Rn,Ei.footprint)?Math.max(Kn.cameraCollisionOpacity-Zs,0):Math.min(1,Kn.cameraCollisionOpacity+Zs)}const $i=[...Ti],ki=1/o.d4(ei.canonical),Pr=Ei.anchor?Ei.anchor[0]:0,xi=Ei.anchor?Ei.anchor[1]:0;o.bo($i,$i,[Pr*(ti[0]-1)+Kn.evaluatedTranslation[0]*ki,xi*(ti[1]-1)+Kn.evaluatedTranslation[1]*ki,Ci+Kn.evaluatedTranslation[2]]),o.cn(ti,o.es)||o.cP($i,$i,ti);const Di=o.az([],$i,Ei.matrix),Qi=o.az([],be.expandedFarZProjMatrix,Di),ns=o.az([],be.expandedFarZProjMatrix,$i),Yr=o.aA([],[Pr,xi,Ci,1],Qi)[2];Ei.hidden=!1;let os=ft;rt||(wt&&(os*=Kn.cameraCollisionOpacity,os*=V0($i,be,Kn.aabb,xt)),os*=B0(Et,Yr)),os!==0?nr.push({nodeInfo:Kn,depth:Yr,opacity:os,wvpForNode:Qi,wvpForTile:ns,nodeModelMatrix:Di,tileModelMatrix:$i}):Ei.hidden=!0}rt||nr.sort((Kn,Ei)=>!wt||Kn.opacity===1&&Ei.opacity===1?Kn.depth<Ei.depth?-1:1:Kn.opacity===1?-1:Ei.opacity===1?1:Kn.depth>Ei.depth?-1:1);for(const Kn of nr){const Ei=Kn.nodeInfo,Ci=Ei.node;let Mi=o.az([],Ye,Kn.tileModelMatrix);o.az(Mi,Le,Mi);const ti=o.bi([],Mi);o.ea(ti,ti),o.cP(ti,ti,dm),Mi=o.az(Mi,Mi,Ci.matrix);const $i=Z.renderPass==="light-beam",ki=re.paint.get("model-color-use-theme").constantOr("default")==="none",Pr=Ri&o.ex.HasMapboxMeshFeatures,xi=Pr?0:Ei.evaluatedRMEA[0][2];for(let Di=0;Di<Ci.meshes.length;++Di){const Qi=Ci.meshes[Di],ns=Di===Ci.lightMeshIndex;let Yr=Kn.wvpForNode;if(ns){if(!$i&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}Yr=Kn.wvpForTile}else if($i)continue;const os={defines:[]},Zs=[];if(!rt&&pe&&(pe.useNormalOffset=!!Qi.normalBuffer),If(os.defines,Zs,Qi,Z,ki?null:re.lut),Pr||os.defines.push("DIFFUSE_SHADED"),Dn&&os.defines.push("SHADOWS_SINGLE_CASCADE"),Nt&&(rt?Nt.numRenderedVerticesInShadowPass+=Qi.vertexArray.length:Nt.numRenderedVerticesInTransparentPass+=Qi.vertexArray.length),rt){hm(Qi,Kn.nodeModelMatrix,Z,re);continue}let xl=null;if(Ee){const ao=Ef(Kn.nodeModelMatrix,Z.transform);if(xl=new Float32Array(ao),be.projection.name!=="globe"){const qr=Qi.aabb.min,Nr=Qi.aabb.max,[ir,ps]=Ee.getOpacityForBounds(ao,qr[0],qr[1],Nr[0],Nr[1]);os.overrideFog=ir>=pt||ps>=pt}}const Bo=Qi.material;let aa;Bo.occlusionTexture&&Bo.occlusionTexture.offsetScale&&(aa=Bo.occlusionTexture.offsetScale,os.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const oo=Z.getOrCreateProgram("model",os);!rt&&pe&&pe.setupShadowsFromMatrix(Kn.tileModelMatrix,oo,pe.useNormalOffset),Z.uploadCommonUniforms(fe,oo,null,xl);const Da=Bo.pbrMetallicRoughness;Da.metallicFactor=.9,Da.roughnessFactor=.5;const Ya=F_(new Float32Array(Yr),new Float32Array(Mi),new Float32Array(ti),new Float32Array(Ci.matrix),Z,Kn.opacity,Da.baseColorFactor,Bo.emissiveFactor,Da.metallicFactor,Da.roughnessFactor,Bo,xi,re,[0,0,0],aa);!ns&&(Ei.hasTranslucentParts||Kn.opacity<1)&&oo.draw(Z,fe.gl.TRIANGLES,kt,bn.disabled,pn.disabled,yn.backCCW,Ya,re.id,Qi.vertexBuffer,Qi.indexBuffer,Qi.segments,re.paint,Z.transform.zoom,void 0,Zs),oo.draw(Z,fe.gl.TRIANGLES,ns?Ze:kt,bn.disabled,ns||Kn.opacity<1||Ei.hasTranslucentParts?pn.alphaBlended:pn.unblended,yn.backCCW,Ya,re.id,Qi.vertexBuffer,Qi.indexBuffer,Qi.segments,re.paint,Z.transform.zoom,void 0,Zs)}}}}()}(f,r,c,p),void A();if(D.type!=="model")return;const L=D.getModels(),B=[],O=f.transform.getFreeCameraOptions().position,U=o.c1([],[O.x,O.y,O.z],f.transform.worldSize);o.eq(U,U);const q=[],$=[];let X=0;for(const Z of L){const te=c.paint.get("model-rotation").constantOr(null),re=c.paint.get("model-scale").constantOr(null),ae=c.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(f,te,re,ae,!0,!0,!1);const fe=o.bx([]),be=o.e9(Z.position.lat,f.transform.zoom),Ee=o.bn([],[1,1,1/be]);o.bo(fe,fe,U),B.push({zScaleMatrix:Ee,negCameraPosMatrix:fe});for(const pe of Z.nodes)Z_(f.transform,pe,Z.matrix,f.transform.expandedFarZProjMatrix,X,q,$);X++}if(q.sort((Z,te)=>te.depth-Z.depth),f.renderPass!=="shadow"){if(y===1)for(const Z of $)$h(Z,f,c,B[Z.modelIndex],bn.disabled,f.colorModeForRenderPass());else{for(const Z of $)$h(Z,f,c,B[Z.modelIndex],bn.disabled,pn.disabled);for(const Z of $)$h(Z,f,c,B[Z.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const Z of q)$h(Z,f,c,B[Z.modelIndex],bn.disabled,f.colorModeForRenderPass());A()}else{for(const Z of $)hm(Z.mesh,Z.nodeModelMatrix,f,c);for(const Z of q)hm(Z.mesh,Z.nodeModelMatrix,f,c);A()}}},pm={line:function(f,r,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const p=r.getVisibleCoordinates();for(const y of p){const x=r.getTile(y).getBucket(f);if(x&&(x.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,r,c){const p=r.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const y=p.getModels();for(const x of y)x.upload(c.context)},raster:function(f,r,c){const p=r.getSource();if(!(p instanceof tt&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const x=f.paint.get("raster-array-band")||p.getInitialBand(y);if(x==null)return;const b=r.getIds().map(I=>r.getTileByID(I));for(const I of b)I.updateNeeded(f.id,x)&&p.prepareTile(I,y,f.id,x)},"raster-particle":function(f,r,c){const p=r.getSource();if(!(p instanceof tt&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const x=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(x==null)return;const b=r.getIds().map(I=>r.getTileByID(I));for(const I of b)I.updateNeeded(f.id,x)&&p.prepareTile(I,y,f.id,x)}},mm={fill:Xt},Ra={fill:function(f,r,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const y=f.context.gl,x=new Ut(y.LEQUAL,Ut.ReadOnly,f.depthRangeFor3D),b=new bn({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),I=f.transform.getFreeCameraOptions().position,A=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const D of p){const L=r.getTile(D),B=L.getBucket(c);if(!B)continue;const O=B.elevatedStructures;if(!O||O.depthSegments.segments[0].primitiveLength===0)continue;const U=xf(D.toUnwrapped(),I),q=f.translatePosMatrix(D.projMatrix,L,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),$=em(q,U,0,1,0);A.draw(f,y.TRIANGLES,x,b,pn.disabled,yn.disabled,$,c.id,O.vertexBuffer,O.indexBuffer,O.depthSegments,c.paint,f.transform.zoom)}}};class iu{constructor(r,c,p,y,x,b){this.context=new sm(r,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const D of I)this._debugParams.enabledLayers[D]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of I)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new qh(x),this.setup(),this.numSublayers=Is.maxUnderzooming+Is.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new nE(this),this._wireframeDebugCache=new Sf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,A,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=b}updateTerrain(r,c){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Kp(this,r));const y=this._terrain;this.transform.elevation=p?y:null,y.update(r,this.transform,c),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(r){const c=r.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=c.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const x=p+.78*(y-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new Kp(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,c){if(this.width=r*o.q.devicePixelRatio,this.height=c*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const r=this.context,c=new o.ba;c.emplaceBack(0,0),c.emplaceBack(o.aj,0),c.emplaceBack(0,o.aj),c.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=r.createVertexBuffer(c,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const p=new o.ba;p.emplaceBack(0,0),p.emplaceBack(o.aj,0),p.emplaceBack(0,o.aj),p.emplaceBack(o.aj,o.aj),this.debugBuffer=r.createVertexBuffer(p,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const y=new o.ba;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const x=new o.aZ;x.emplaceBack(0,0,0,0),x.emplaceBack(o.aj,0,o.aj,0),x.emplaceBack(0,o.aj,0,o.aj),x.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=r.createVertexBuffer(x,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const b=new o.a_;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(b);const I=new o.bb;for(const D of[0,1,3,2,0])I.emplaceBack(D);this.debugIndexBuffer=r.createIndexBuffer(I),this.emptyTexture=new o.T(r,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=o.bz();const A=this.context.gl;this.stencilClearMode=new bn({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Ut.disabled,this.stencilClearMode,pn.disabled,yn.disabled,Zp(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,p){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const A of p)if(this._tileClippingMaskIDs[A.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(pn.disabled),y.setDepthMode(Ut.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const A=c.getTile(I),D=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:B,tileBoundsSegments:O}=this.getTileBoundsBuffers(A);b.draw(this,x.TRIANGLES,Ut.disabled,new bn({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),pn.disabled,yn.disabled,Zp(I.projMatrix),"$clipping",L,B,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new bn({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new bn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,p=r.sort((b,I)=>I.overscaledZ-b.overscaledZ),y=p[p.length-1].overscaledZ,x=p[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const b={};for(let I=0;I<x;I++)b[I+y]=new bn({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[b,p]}return[{[y]:bn.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new pn([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pn.unblended:pn.alphaBlended}colorModeForDrapableLayerRenderPass(r){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new pn([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,c,p,y=!1){if(this.depthOcclusion)return new Ut(this.context.gl.GREATER,Ut.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Ut.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Ut(p||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),x=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new Uu(this.context,c,p,!1,"texture"),this.depthTexture=new o.T(this.context,{width:c,height:p,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),r.bindTexture(r.TEXTURE_2D,x),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,c,p,0,0,c,p,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,c)=>r+c/this._fpsHistory.length,0))}render(r,c){const p=o.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=c;const y=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(x).filter(Ze=>{const Ce=y[Ze];return!(Ce.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ce.type]});let I=b(),A=!1,D=!1,L=null;for(const Ze of I){const Ce=y[Ze];Ce.type==="circle"?A=!0:Ce.type==="building"?L=Ce:Ce.type==="symbol"&&(Ce.hasInitialOcclusionOpacityProperties?D=!0:A=!0)}let B=I.map(Ze=>y[Ze]);const O=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let U=0,q=!1;for(const Ze in O){const Ce=O[Ze];Ce.used&&(Ce.prepare(this.context),Ce.getSource().usedInConflation&&++U)}let $=!1;for(const Ze of B)Ze.isHidden(this.transform.zoom)||(Ze.type==="clip"&&($=!0),this.prepareLayer(Ze));const X={},Z={},te={},re={},ae={};for(const Ze in O){const Ce=O[Ze];X[Ze]=Ce.getVisibleCoordinates(),Z[Ze]=X[Ze].slice().reverse(),te[Ze]=Ce.getVisibleCoordinates(!0).reverse(),re[Ze]=Ce.getShadowCasterCoordinates(),ae[Ze]=Ce.sortCoordinatesByDistance(X[Ze])}const fe=Ze=>{const Ce=this.style.getLayerSourceCache(Ze);return Ce&&Ce.used?Ce.getSource():null};if(U||$||this._clippingActiveLastFrame){const Ze=[],Ce=[];let rt=0;for(const Ke of B)this.isSourceForClippingOrConflation(Ke,fe(Ke))&&(Ze.push(Ke),Ce.push(rt)),rt++;if(Ze&&($||Ze.length>1)||this._clippingActiveLastFrame){$=!1;const Ke=[];for(let xt=0;xt<Ze.length;xt++){const wt=Ze[xt],Et=Ce[xt],Nt=this.style.getLayerSourceCache(wt);if(!Nt||!Nt.used||!Nt.getSource().usedInConflation&&wt.type!=="clip"&&wt.type!=="building")continue;let tn=o.eF,dn=o.bW.None;const qt=[];let hn=!0;if(wt.type==="building")tn=o.eH;else if(wt.type==="clip"){tn=Et;for(const an of wt.layout.get("clip-layer-types"))dn|=an==="model"?o.bW.Model:an==="symbol"?o.bW.Symbol:o.bW.FillExtrusion;for(const an of wt.layout.get("clip-layer-scope"))qt.push(an);wt.isHidden(this.transform.zoom)?hn=!1:$=!0}hn&&Ke.push({layer:wt.fqid,cache:Nt,order:tn,clipMask:dn,clipScope:qt})}this.replacementSource.setSources(Ke),q=!0}}this._clippingActiveLastFrame=$,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ze=0;Ze<B.length;Ze++){const Ce=B[Ze],rt=Ce.cutoffRange();if(this.longestCutoffRange=Math.max(rt,this.longestCutoffRange),rt>0){const Ke=fe(Ce);Ke&&(this.minCutoffZoom=Math.max(Ke.minzoom,this.minCutoffZoom)),Ce.minzoom&&(this.minCutoffZoom=Math.max(Ce.minzoom,this.minCutoffZoom))}Ce.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ze),this._lastOcclusionLayer=Ze)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(te),this.opaquePassCutoff=0,I=b(),B=I.map(Ze=>y[Ze]));const Ee=this._shadowRenderer;if(Ee){Ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ze in O)for(const Ce of X[Ze]){let rt={min:0,max:0};this.terrain&&(rt=this.terrain.getMinMaxForTile(Ce)||rt),Ee.addShadowReceiver(Ce.toUnwrapped(),rt.min,rt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new $e(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),_e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(pe&&!this._snow&&(this._snow=new Q_(this)),!pe&&this._snow&&(this._snow.destroy(),delete this._snow),_e&&!this._rain&&(this._rain=new Zh(this)),!_e&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),L){this.buildingTileBorderManager||(this.buildingTileBorderManager=new N0);const Ze=this.style.getLayerSourceCache(L);this.buildingTileBorderManager.updateBorders(Ze,L)}if(!$s.has(this.context.gl))return;this.renderPass="offscreen";for(const Ze of B){const Ce=r.getLayerSourceCache(Ze);if(!Ze.hasOffscreenPass()||Ze.isHidden(this.transform.zoom))continue;const rt=Ce?Z[Ce.id]:void 0;(Ze.type==="custom"||Ze.type==="raster"||Ze.type==="raster-particle"||Ze.isSky()||rt&&rt.length)&&this.renderLayer(this,Ce,Ze,rt)}this.depthRangeFor3D=[0,1-(B.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,re)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ve=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),We=(()=>{if(c.showOverdrawInspector)return o.am.black;const Ze=this.style.fog;if(Ze&&this.transform.projection.supportsFog){const Ce=this.style.getLut(Ze.scope);if(!ve){const rt=Ze.properties.get("color-use-theme")==="none",Ke=Ze.properties.get("color").toNonPremultipliedRenderColor(rt?null:Ce).toArray01();return new o.am(...Ke)}if(ve){const rt=Ze.properties.get("space-color-use-theme")==="none",Ke=Ze.properties.get("space-color").toNonPremultipliedRenderColor(rt?null:Ce).toArray01();return new o.am(...Ke)}}return o.am.transparent})();if(this.context.clear({color:We,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Ze=B[this.currentLayer],Ce=r.getLayerSourceCache(Ze);if(Ze.isSky())continue;const rt=Ce?(Ze.is3D(x)?ae:Z)[Ce.id]:void 0;this._renderTileClippingMasks(Ze,Ce,rt),this.renderLayer(this,Ce,Ze,rt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ve&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Ze=B[this.currentLayer],Ce=r.getLayerSourceCache(Ze);Ze.isSky()&&this.renderLayer(this,Ce,Ze,Ce?Z[Ce.id]:void 0)}function Le(Ze,Ce){let rt;return Ce&&(rt=(Ze.type==="symbol"?te:Ze.is3D(x)?ae:Z)[Ce.id]),rt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Ze=B[this.currentLayer];if(Ze.type==="raster"||Ze.type==="raster-particle"){const Ce=r.getLayerSourceCache(Ze);this.renderLayer(this,Ce,Ze,Le(Ze,Ce))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let lt=0;Ee&&(lt=Ee.getShadowCastingLayerCount());let Ye=!1,ft=-1;for(let Ze=0;Ze<I.length;++Ze){const Ce=B[Ze];Ce.isHidden(this.transform.zoom)||Ce.is3D(x)&&(ft=Ze)}D&&ft===-1&&(A=!0);let kt=!1;for(;this.currentLayer<I.length;){const Ze=B[this.currentLayer],Ce=r.getLayerSourceCache(Ze);if(Ze.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ze)){if(Ze.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!kt&&Ze.is3D(x)&&!x){const rt=this.currentLayer,Ke=xt=>{for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const wt=B[this.currentLayer];if(mm[wt.type]){const Et=this.style.getLayerSourceCache(wt);mm[wt.type](this,Et,wt,Le(wt,Et),xt)}}};Ke("initialize"),Ke("reset"),this.currentLayer=rt,kt=!0}if(A&&!Ye&&this.terrain&&!this.transform.isOrthographic&&(Ye=!0,this.blitDepth()),D&&ft!==-1&&this.currentLayer===ft+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ze,Ce,Ce?X[Ce.id]:void 0),this.renderLayer(this,Ce,Ze,Le(Ze,Ce)),!this.terrain&&Ee&&lt>0&&Ze.hasShadowPass()&&--lt==0){{this.clearStencil(),this.resetStencilClippingMasks();const rt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const Ke=B[this.currentLayer];if(Ra[Ke.type]){const xt=this.style.getLayerSourceCache(Ke);Ra[Ke.type](this,xt,Ke,Le(Ke,xt))}}this.currentLayer=rt}if(Ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const rt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=rt;this.currentLayer++){const Ke=B[this.currentLayer];if(!Ke.hasLightBeamPass())continue;const xt=r.getLayerSourceCache(Ke);this.renderLayer(this,xt,Ke,xt?Z[xt.id]:void 0)}this.currentLayer=rt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const rt=this.currentLayer;this.depthOcclusion=!0;for(const Ke of this.layersWithOcclusionOpacity){this.currentLayer=Ke;const xt=B[this.currentLayer],wt=r.getLayerSourceCache(xt),Et=wt?Z[wt.id]:void 0;this.terrain||this._renderTileClippingMasks(xt,wt,wt?X[wt.id]:void 0),this.renderLayer(this,wt,xt,Et)}this.depthOcclusion=!1,this.currentLayer=rt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ze=null;B.forEach(Ce=>{const rt=r.getLayerSourceCache(Ce);rt&&!Ce.isHidden(this.transform.zoom)&&rt.getVisibleCoordinates().length&&(!Ze||Ze.getSource().maxzoom<rt.getSource().maxzoom)&&(Ze=rt)}),Ze&&this.options.showTileBoundaries&&Gl(this,Ze,Ze.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Gl(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ze){const Ce=Ze.transform.padding;bf(Ze,Ze.transform.height-(Ce.top||0),3,L0),bf(Ze,Ce.bottom||0,3,H_),um(Ze,Ce.left||0,3,q_),um(Ze,Ze.transform.width-(Ce.right||0),3,W_);const rt=Ze.transform.centerPoint;(function(Ke,xt,wt,Et){Tf(Ke,xt-1,wt-10,2,20,Et),Tf(Ke,xt-10,wt-1,20,2,Et)})(Ze,rt.x,Ze.transform.height-rt.y,O0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(r.type);if(pm[r.type]&&(p||this.terrain&&r.type==="custom")){const y=this.style.getLayerSourceCache(r);pm[r.type](r,y,this)}this.gpuTimingEnd()}renderLayer(r,c,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)&&(!r.terrain||p.type!=="custom")||p.type==="clip"||J_[p.type](r,c,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[r.id];y||(y=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(r.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const p in r){const y=r[p],x=this.context.extTimerQuery,b=x.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(y.query),c[p]=b}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const y of r)p+=c.getQueryParameter(y,c.QUERY_RESULT)/1e6,c.deleteQuery(y);return p}translatePosMatrix(r,c,p,y,x){if(!p[0]&&!p[1])return r;const b=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(b){const D=Math.sin(b),L=Math.cos(b);p=[p[0]*L-p[1]*D,p[0]*D+p[1]*L]}const I=[x?p[0]:o.aw(c,p[0],this.transform.zoom),x?p[1]:o.aw(c,p[1],this.transform.zoom),0],A=new Float32Array(16);return o.bo(A,r,I),A}saveTileTexture(r){if(r.context!==this.context)return;const c=r.size[0],p=this._tileTextures[c];p?p.push(r):this._tileTextures[c]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,c,p){const y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,x=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||y||c!==void 0&&!c||x.push("FOG","FOG_DITHERING"),y&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(r,c){this.cache=this.cache||{};const p=c&&c.defines||[],y=c&&c.config,x=this.currentGlobalDefines(r,c&&c.overrideFog,c&&c.overrideRtt).concat(p),b=Qp.cacheKey(mf[r],r,x,y);return this.cache[b]||(this.cache[b]=new Qp(this.context,r,mf[r],y,k0[r],x)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const x=((b,I,A)=>{const D=b.properties.get("direction"),L=b.properties.get("color-use-theme")==="none",B=b.properties.get("color").toNonPremultipliedRenderColor(L?null:A.getLut(b.scope)).toArray01(),O=b.properties.get("intensity"),U=I.properties.get("color-use-theme")==="none",q=I.properties.get("color").toNonPremultipliedRenderColor(U?null:A.getLut(I.scope)).toArray01(),$=I.properties.get("intensity"),X=[D.x,D.y,D.z],Z=o.dI(q,$),te=o.dI(B,O);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:X,u_lighting_directional_color:te,u_ground_radiance:C_(X,te,Z)}})(p,y,this.style);c.setLightsUniformValues(r,x)}}}uploadCommonUniforms(r,c,p,y,x){if(this.uploadCommonLightUniforms(r,c),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const I=b.getOpacity(this.transform.pitch),A=((D,L,B,O,U,q,$,X,Z,te,re,ae)=>{const fe=D.transform,be=L.properties.get("color-use-theme")==="none",Ee=L.properties.get("color").toNonPremultipliedRenderColor(be?null:D.style.getLut(L.scope)).toArray01();Ee[3]=O;const pe=D.frameCounter/1e3%1,[_e,ve]=L.properties.get("vertical-range");return{u_fog_matrix:B?fe.calculateFogTileMatrix(B):ae||D.identityMat,u_fog_range:L.getFovAdjustedRange(fe._fov),u_fog_color:Ee,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_e,ve),ve],u_fog_temporal_offset:pe,u_frustum_tl:U,u_frustum_tr:q,u_frustum_br:$,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:te,u_viewport:re,u_globe_transition:o.ah(fe.zoom),u_is_globe:+(fe.projection.name==="globe")}})(this,b,p,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],y);c.setFogUniformValues(r,A)}x&&c.setCutoffUniformValues(r,x.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)c[y.key]=r[y.key]||new Sa(y,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,c){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&r.type!=="building"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building"&&r.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[r.key];return c||(this._cachedTileFogOpacities[r.key]=c=this.style.fog.getOpacityForTile(r)),c[0]>=pt||c[1]>=pt}setupDepthForOcclusion(r,c,p){const y=this.context,x=y.gl,b=!!p;var I;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(x.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE0),b||c.setTerrainUniformValues(y,p)}}function Xh(f,r){let c=!1,p=null;const y=()=>{p=null,c&&(f(),p=setTimeout(y,r),c=!1)};return()=>(c=!0,p||y(),p)}class gm{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xh(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=_m(r);if(this._hashName){const p=this._hashName;let y=!1;const x=location.hash.slice(1).split("&").map(b=>{const I=b.split("=")[0];return I===p?(y=!0,`${I}=${c}`):b}).filter(b=>b);return y||x.push(`${p}=${c}`),`#${x.join("&")}`}return`#${c}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function _m(f,r){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),b=Math.round(c.lng*x)/x,I=Math.round(c.lat*x)/x,A=f.getBearing(),D=f.getPitch();let L=r?`/${b}/${I}/${p}`:`${p}/${I}/${b}`;return(A||D)&&(L+="/"+Math.round(10*A)/10),D&&(L+=`/${Math.round(D)}`),L}const Kh={linearity:.3,easing:o.eI(0,0,.3,1)},ru=o.h({deceleration:2500,maxSpeed:1400},Kh),ey=o.h({deceleration:20,maxSpeed:1400},Kh),Hl=o.h({deceleration:1e3,maxSpeed:360},Kh),ty=o.h({deceleration:1e3,maxSpeed:90},Kh);class ym{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=o.q.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=Qh(c.pan.mag(),p,o.h({},ru,r||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,Yh(y,x)}if(c.zoom){const x=Qh(c.zoom,p,ey);y.zoom=this._map.transform.zoom+x.amount,Yh(y,x)}if(c.bearing){const x=Qh(c.bearing,p,Hl);y.bearing=this._map.transform.bearing+o.ay(x.amount,-179,179),Yh(y,x)}if(c.pitch){const x=Qh(c.pitch,p,ty);y.pitch=this._map.transform.pitch+x.amount,Yh(y,x)}if(y.zoom||y.bearing){const x=c.pinchAround===void 0?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Yh(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function Qh(f,r,c){const{maxSpeed:p,linearity:y,deceleration:x}=c,b=o.ay(f*y/(r/1e3),-p,p),I=Math.abs(b)/(x*y);return{easing:c.easing,duration:1e3*I,amount:b*(I/2)}}class yr extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p,y={}){const x=xe(c.getCanvasContainer(),p),b=c.unproject(x);super(r,o.h({point:x,lngLat:b,originalEvent:p},y)),this._defaultPrevented=!1,this.target=c}}class Jh extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){const y=r==="touchend"?p.changedTouches:p.touches,x=ke(c.getCanvasContainer(),y),b=x.map(A=>c.unproject(A)),I=x.reduce((A,D,L,B)=>A.add(D.div(B.length)),new o.P(0,0));super(r,{points:x,point:I,lngLats:b,lngLat:c.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class ny extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class iy{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new ny(this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new yr(r.type,this._map,r))}mouseup(r){this._map.fire(new yr(r.type,this._map,r))}preclick(r){const c=o.h({},r);c.type="preclick",this._map.fire(new yr(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new yr(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new yr(r.type,this._map,r))}mouseover(r){this._map.fire(new yr(r.type,this._map,r))}mouseout(r){this._map.fire(new yr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Jh(r.type,this._map,r))}touchmove(r){this._map.fire(new Jh(r.type,this._map,r))}touchend(r){this._map.fire(new Jh(r.type,this._map,r))}touchcancel(r){this._map.fire(new Jh(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new yr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new yr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ry{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&r.button===0&&(_t(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const p=c,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=me("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const b=Math.min(y.x,p.x),I=Math.max(y.x,p.x),A=Math.min(y.y,p.y),D=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=I-b+"px",this._box.style.height=D-A+"px")})}mouseupWindow(r,c){if(!this._active)return;const p=this._startPos,y=c;if(p&&r.button===0){if(this.reset(),Pe(),p.x!==y.x||p.y!==y.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ct(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new o.A(r,{originalEvent:c}))}}function Cf(f,r){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=r[p];return c}class sy{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const x=new o.P(0,0);for(const b of y)x._add(b);return x.div(y.length)}(c),this.touches=Cf(p,c)))}touchmove(r,c,p){if(this.aborted||!this.centroid)return;const y=Cf(p,c);for(const x in this.touches){const b=y[x];(!b||b.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,c,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class su{constructor(r){this.singleTap=new sy(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,p){this.singleTap.touchstart(r,c,p)}touchmove(r,c,p){this.singleTap.touchmove(r,c,p)}touchend(r,c,p){const y=this.singleTap.touchend(r,c,p);if(y){const x=r.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(y)<30;if(x&&b||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class oy{constructor(){this._zoomIn=new su({numTouches:1,numTaps:2}),this._zoomOut=new su({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,p){this._zoomIn.touchstart(r,c,p),this._zoomOut.touchstart(r,c,p)}touchmove(r,c,p){this._zoomIn.touchmove(r,c,p),this._zoomOut.touchmove(r,c,p)}touchend(r,c,p){const y=this._zoomIn.touchend(r,c,p),x=this._zoomOut.touchend(r,c,p);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(y)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ay={0:1,2:2},vm={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ed{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const p=Ve(r);this._correctButton(r,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(r,c){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(y,x){const b=ay[x];return y.buttons===void 0||(y.buttons&b)!==b}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(r){this._lastPoint&&Ve(r)===this._eventButton&&(this._moved&&Pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ly extends ed{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return c===0&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class xm extends ed{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?vm[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const p=.8*(c.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class cy extends ed{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?vm[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const p=-.5*(c.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class j0{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,c,p){return this._calculateTransform(r,c,p)}touchmove(r,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!o.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,p)}}touchend(r,c,p){this._calculateTransform(r,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,p){p.length>0&&(this._active=!0);const y=Cf(p,c),x=new o.P(0,0),b=new o.P(0,0);let I=0;for(const D in y){const L=y[D],B=this._touches[D];B&&(x._add(L),b._add(L.sub(B)),I++,y[D]=L)}if(this._touches=y,I<this._minTouches||!b.mag())return;const A=b.div(I);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class wm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,p){return{}}touchstart(r,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,p){const y=this._firstTwoTouches;if(!y)return;r.preventDefault();const[x,b]=y,I=Pf(p,c,x),A=Pf(p,c,b);if(!I||!A)return;const D=this._aroundCenter?null:I.add(A).div(2);return this._move([I,A],D,r)}touchend(r,c,p){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,b=Pf(p,c,y),I=Pf(p,c,x);b&&I||(this._active&&Pe(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pf(f,r,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return r[p]}function uy(f,r){return Math.log(f/r)/Math.LN2}class G0 extends wm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(uy(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uy(this._distance,p),pinchAround:c}}}function hy(f,r){return 180*f.angleWith(r)/Math.PI}class $0 extends wm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:hy(this._vector,p),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=hy(r,p);return Math.abs(y)<c}}function bm(f){return Math.abs(f.y)>Math.abs(f.x)}class H0 extends wm{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,bm(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,p){const y=this._lastPoints;if(!y)return;const x=r[0].sub(y[0]),b=r[1].sub(y[1]);return this._map._cooperativeGestures&&!o.eJ()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(x,b,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+b.y)/2*-.5})}gestureBeginsVertically(r,c,p){if(this._valid!==void 0)return this._valid;const y=r.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const b=r.y>0==c.y>0;return bm(r)&&bm(c)&&b}}const q0={panStep:100,bearingStep:15,pitchStep:10};class W0{constructor(){const r=q0;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,p=0,y=0,x=0,b=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),b=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:I=>{const A=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Z0,zoom:c?Math.round(A)+c*(r.shiftKey?2:1):A,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-b*this._panStep],center:I.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Z0(f){return f*(2-f)}const X0=4.000244140625,EE=1/450;class IE{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=EE,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=o.q.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%X0==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=xe(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>X0?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const B=c(),O=Math.pow(2,B),U=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(U*L))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,x=this._easing;let b,I=!1;if(this._type==="wheel"&&y&&x){const D=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),L=x(D);b=o.ai(y,p,L),D<1?this._frameId||(this._frameId=!0):I=!0}else b=p,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=b-c();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=o.eK;if(this._prevEase){const p=this._prevEase,y=(o.q.now()-p.start)/p.duration,x=p.easing(y+.01)-p.easing(y),b=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-b*b);c=o.eI(b,I,.25,1)}return this._prevEase={start:o.q.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=me("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Cr{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class K0{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class SE{constructor(){this._tap=new su({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,c,p))}touchmove(r,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,c,p)}touchend(r,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,c,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dy{constructor(r,c,p){this._el=r,this._mousePan=c,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class AE{constructor(r,c,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rf{constructor(r,c,p,y){this._el=r,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kf=f=>f.zoom||f.drag||f.pitch||f.rotate;class fy extends o.A{}class Tm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const p=o.at([],c,r);this.radius=o.ae(p[2]<0?o.eM([],p,this.constants):[p[0],p[1],0])}projectRay(r){o.eM(r,r,this.constants),o.au(r,r),o.eN(r,r,this.constants);const c=o.c1([],r,this.radius);if(c[2]>0){const p=o.c1([],[0,0,1],o.bG(c,[0,0,1])),y=o.c1([],o.au([],[c[0],c[1],0]),this.radius),x=o.d5([],c,o.c1([],o.at([],o.d5([],y,p),c),2));c[0]=x[0],c[1]=x[1]}return c}}function Xa(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Em{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ym(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Tm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.aV(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,b]of this._listeners){const I=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(x,I,b)}}destroy(){for(const[r,c,p]of this._listeners){const y=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(c,y,p)}}_addDefaultHandlers(r){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new iy(c,r));const y=c.boxZoom=new ry(c,r);this._add("boxZoom",y);const x=new oy,b=new K0;c.doubleClickZoom=new Cr(b,x),this._add("tapZoom",x),this._add("clickZoom",b);const I=new SE;this._add("tapDragZoom",I);const A=c.touchPitch=new H0(c);this._add("touchPitch",A);const D=new xm(r),L=new cy(r);c.dragRotate=new AE(r,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new ly(r),O=new j0(c,r);c.dragPan=new dy(p,B,O),this._add("mousePan",B),this._add("touchPan",O,["touchZoom","touchRotate"]);const U=new $0,q=new G0;c.touchZoomRotate=new Rf(p,q,U,I),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hu(c));const $=c.scrollZoom=new IE(c,this);this._add("scrollZoom",$,["mousePan"]);const X=c.keyboard=new W0;this._add("keyboard",X);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Z]&&c[Z].enable(r[Z])}_add(r,c,p){this._handlers.push({handlerName:r,handler:c,allowed:p}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,p){for(const y in r)if(y!==p&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const p of r)this._el.contains(p.target)&&c.push(p);return c}handleEvent(r,c){this._updatingCamera=!0;const p=r.type==="renderFrame",y=p?void 0:r,x={needsRenderFrame:!1},b={},I={},A=r.touches?this._getMapTouches(r.touches):void 0,D=A?ke(this._el,A):p?void 0:xe(this._el,r);for(const{handlerName:O,handler:U,allowed:q}of this._handlers){if(!U.isEnabled())continue;let $;this._blockedByActive(I,q,O)?U.reset():U[c||r.type]&&($=U[c||r.type](r,D,A),this.mergeHandlerResult(x,b,$,O,y),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||U.isActive())&&(I[O]=U)}const L={};for(const O in this._previousActiveHandlers)I[O]||(L[O]=y);this._previousActiveHandlers=I,(Object.keys(L).length||Xa(x))&&(this._changes.push([x,b,L]),this._triggerRenderFrame()),(Object.keys(I).length||Xa(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=x;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(r,c,p,y,x){if(!p)return;o.h(r,p);const b={handlerName:y,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(c.zoom=b),p.panDelta!==void 0&&(c.drag=b),p.pitchDelta!==void 0&&(c.pitch=b),p.bearingDelta!==void 0&&(c.rotate=b)}_applyChanges(){const r={},c={},p={};for(const[y,x,b]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(r.around=y.around),y.aroundCoord!==void 0&&(r.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),o.h(c,x),o.h(p,b);this._updateMapTransform(r,c,p),this._changes=[]}_updateMapTransform(r,c,p){const y=this._map,x=y.transform,b=te=>[te.x,te.y,te.z];if((te=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Xa(r)){const te=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),te!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!Xa(r))return void this._fireEvents(c,p,!0);let{panDelta:I,zoomDelta:A,bearingDelta:D,pitchDelta:L,around:B,aroundCoord:O,pinchAround:U}=r;x._isCameraConstrained&&(A>0&&(A=0),x._isCameraConstrained=!1),U!==void 0&&(B=U),(A||(te=>c[te]&&!this._eventsInProgress[te])("drag"))&&B&&(this._dragOrigin=b(x.pointCoordinate3D(B)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),B=B||y.transform.centerPoint,D&&(x.bearing+=D),L&&(x.pitch+=L),x._updateCameraState();const q=[0,0,0];if(I)if(x.projection.name==="mercator"){const te=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B).dir),re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B.sub(I)).dir);q[0]=re[0]-te[0],q[1]=re[1]-te[1]}else{const te=x.pointCoordinate(B);if(x.projection.name==="globe"){I=I.rotate(-x.angle);const re=x._pixelsPerMercatorPixel/x.worldSize;q[0]=-I.x*o.eL(o.aY(te.y))*re,q[1]=-I.y*o.eL(x.center.lat)*re}else{const re=x.pointCoordinate(B.sub(I));te&&re&&(q[0]=re.x-te.x,q[1]=re.y-te.y)}}const $=x.zoom,X=[0,0,0];if(A){const te=b(O||x.pointCoordinate3D(B)),re={dir:o.au([],o.at([],te,x._camera.position))};if(re.dir[2]<0){const ae=x.zoomDeltaToMovement(te,A);o.c1(X,re.dir,ae)}}const Z=o.d5(q,q,X);x._translateCameraConstrained(Z),A&&Math.abs(x.zoom-$)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,p,!0)}_fireEvents(r,c,p){const y=kf(this._eventsInProgress),x=kf(r),b={};for(const L in r){const{originalEvent:B}=r[L];this._eventsInProgress[L]||(b[`${L}start`]=B),this._eventsInProgress[L]=r[L]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const L in b)this._fireEvent(L,b[L]);x&&this._fireEvent("move",x.originalEvent);for(const L in r){const{originalEvent:B}=r[L];this._fireEvent(L,B)}const I={};let A;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:O}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],A=c[B]||O,I[`${L}end`]=A)}for(const L in I)this._fireEvent(L,I[L]);const D=kf(this._eventsInProgress);if(p&&(y||x)&&!D){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:A})):(this._map.fire(new o.A("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new o.A(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new fy("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ts="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ql extends o.E{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,p){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.h({offset:r},c),p)}panTo(r,c,p){return this.easeTo(o.h({center:r},c),p)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,p){return this.easeTo(o.h({zoom:r},c),p)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,p){return this.easeTo(o.h({bearing:r},c),p)}resetNorth(r,c){return this.rotateTo(0,o.h({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=o.aG.convert(r);const p=c&&c.bearing||0,y=c&&c.pitch||0,x=r.getNorthWest(),b=r.getSouthEast();return this._cameraForBounds(this.transform,x,b,p,y,c)}_extendPadding(r){const c={top:0,right:0,bottom:0,left:0};return r==null?o.h({},c,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:o.h({},c,r)}_extendCameraOptions(r){return(r=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,c){const p=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return p/y>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):y/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,p,y,x,b){const I=r.clone(),A=this._extendCameraOptions(b);I.bearing=y,I.pitch=x;const D=o.ci.convert(c),L=o.ci.convert(p),B=.5*(D.lat+L.lat),O=.5*(D.lng+L.lng),U=o.eO(B,O),q=o.au([],U),$=o.au([],o.bF([],q,[0,1,0])),X=o.bF([],$,q),Z=[$[0],$[1],$[2],0,X[0],X[1],X[2],0,q[0],q[1],q[2],0,0,0,0,1],te=[U,o.eO(D.lat,D.lng),o.eO(L.lat,D.lng),o.eO(L.lat,L.lng),o.eO(D.lat,L.lng),o.eO(B,D.lng),o.eO(B,L.lng),o.eO(D.lat,O),o.eO(L.lat,O)];let re=o.d6.fromPoints(te.map(Ke=>[o.bG($,Ke),o.bG(X,Ke),o.bG(q,Ke)]));const ae=o.ad([],re.center,Z);o.eP(ae)===0&&o.eQ(ae,0,0,1),o.au(ae,ae),o.c1(ae,ae,o.aB),I.center=o.eR(ae);const fe=I.getWorldToCameraMatrix(),be=o.bi(new Float64Array(16),fe);re=o.d6.applyTransform(re,o.az([],fe,Z));const Ee=this._extendAABB(re,I,A,y);if(!Ee)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=Ee,o.ad(ae,ae,fe);const pe=.5*(re.max[2]-re.min[2]),_e=this._minimumAABBFrustumDistance(I,re),ve=o.c1([],[0,0,1],pe),We=o.d5(ve,ae,ve),Le=_e+(I.pitch===0?0:o.bD(ae,We)),lt=I.globeCenterInViewSpace,Ye=o.at([],ae,[lt[0],lt[1],lt[2]]);o.au(Ye,Ye),o.c1(Ye,Ye,Le);const ft=o.d5([],ae,Ye);o.ad(ft,ft,be);const kt=o.eB/o.aB,Ze=o.ae(ft),Ce=o.cb(Math.max(Ze*kt-o.eB,Number.EPSILON),0),rt=Math.min(I.zoomFromMercatorZAdjusted(Ce),A.maxZoom);return rt>.5*(o.cX+o.cI)?(I.setProjection({name:"mercator"}),I.zoom=rt,this._cameraForBounds(I,c,p,y,x,b)):{center:I.center,zoom:rt,bearing:y,pitch:x}}_extendAABB(r,c,p,y){const x=.5*((p.padding.left||0)+(p.padding.right||0)),b=.5*((p.padding.top||0)+(p.padding.bottom||0)),I=b,A=x,D=x,L=b,B=c.width-(A+D),O=c.height-(I+L),U=o.at([],r.max,r.min),q=Math.min(B/U[0],O/U[1]),$=Math.min(c.scaleZoom(c.scale*q),p.maxZoom);if(isNaN($))return null;const X=c.scale/c.zoomScale($),Z=new o.d6([r.min[0]-A*X,r.min[1]-L*X,r.min[2]],[r.max[0]+D*X,r.max[1]+I*X,r.max[2]]),te=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new o.P(p.offset.x,p.offset.y):o.P.convert(p.offset)).rotate(-o.al(y));return Z.center[0]-=te.x*X,Z.center[1]+=te.y*X,Z}queryTerrainElevation(r,c){const p=this.transform.elevation;return p?(c=o.h({},{exaggerated:!0},c),p.getAtPoint(o.ac.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,p,y,x,b){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,c,p,y,x,b);const I=r.clone(),A=this._extendCameraOptions(b);I.bearing=y,I.pitch=x;const D=o.ci.convert(c),L=o.ci.convert(p),B=new o.ci(D.lng,L.lat),O=new o.ci(L.lng,D.lat),U=I.project(D),q=I.project(L),$=this.queryTerrainElevation(D),X=this.queryTerrainElevation(L),Z=this.queryTerrainElevation(B),te=this.queryTerrainElevation(O),re=[[U.x,U.y,Math.min($||0,X||0,Z||0,te||0)],[q.x,q.y,Math.max($||0,X||0,Z||0,te||0)]];let ae=o.d6.fromPoints(re);const fe=I.getWorldToCameraMatrix(),be=o.bi(new Float64Array(16),fe);ae=o.d6.applyTransform(ae,fe);const Ee=this._extendAABB(ae,I,A,y);if(!Ee)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=Ee;const pe=.5*o.at([],ae.max,ae.min)[2],_e=this._minimumAABBFrustumDistance(I,ae),ve=[0,0,1,0];o.aA(ve,ve,fe),o.eS(ve,ve);const We=o.c1([],ve,_e+pe),Le=o.d5([],ae.center,We);o.ad(ae.center,ae.center,be),o.ad(Le,Le,be);const lt=I.unproject(new o.P(ae.center[0],ae.center[1])),Ye=o.eT(I.projection,lt),ft=Math.pow(2,Ye),kt=Math.min(I._zoomFromMercatorZ(Le[2]*I.pixelsPerMeter*ft/I.worldSize),A.maxZoom);return I.mercatorFromTransition&&kt<.5*(o.cX+o.cI)?(I.setProjection({name:"globe"}),I.zoom=kt,this._cameraForBounds(I,c,p,y,x,b)):{center:lt,zoom:kt,bearing:y,pitch:x}}fitBounds(r,c,p){const y=this.cameraForBounds(r,c);return this._fitInternal(y,c,p)}fitScreenCoordinates(r,c,p,y,x){const b=o.P.convert(r),I=o.P.convert(c),A=new o.P(Math.min(b.x,I.x),Math.min(b.y,I.y)),D=new o.P(Math.max(b.x,I.x),Math.max(b.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,I))return this;const L=this.transform.pointLocation3D(A),B=this.transform.pointLocation3D(D),O=this.transform.pointLocation3D(new o.P(A.x,D.y)),U=this.transform.pointLocation3D(new o.P(D.x,A.y)),q=[Math.min(L.lng,B.lng,O.lng,U.lng),Math.min(L.lat,B.lat,O.lat,U.lat)],$=[Math.max(L.lng,B.lng,O.lng,U.lng),Math.max(L.lat,B.lat,O.lat,U.lat)],X=y&&y.pitch?y.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,q,$,p,X,y);return this._fitInternal(Z,y,x)}_fitInternal(r,c,p){return r?(c=o.h(r,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(r,c){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,b=!1;"zoom"in r&&p.zoom!==+r.zoom&&(y=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=o.ci.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(x=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(b=!0,p.pitch=+r.pitch);const I=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!p.isPaddingEqual(I))if(r.retainPadding===!1){const A=p.clone();A.padding=I,p.setLocationAtPoint(p.center,A.centerPoint)}else p.padding=I;return r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.A("movestart",c)).fire(new o.A("move",c)),y&&this.fire(new o.A("zoomstart",c)).fire(new o.A("zoom",c)).fire(new o.A("zoomend",c)),x&&this.fire(new o.A("rotatestart",c)).fire(new o.A("rotate",c)).fire(new o.A("rotateend",c)),b&&this.fire(new o.A("pitchstart",c)).fire(new o.A("pitch",c)).fire(new o.A("pitchend",c)),this.fire(new o.A("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(ts),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return o.w(ts),this;this.stop();const y=p.zoom,x=p.pitch,b=p.bearing;p.setFreeCameraOptions(r);const I=y!==p.zoom,A=x!==p.pitch,D=b!==p.bearing;return this.fire(new o.A("movestart",c)).fire(new o.A("move",c)),I&&this.fire(new o.A("zoomstart",c)).fire(new o.A("zoom",c)).fire(new o.A("zoomend",c)),D&&this.fire(new o.A("rotatestart",c)).fire(new o.A("rotate",c)).fire(new o.A("rotateend",c)),A&&this.fire(new o.A("pitchstart",c)).fire(new o.A("pitch",c)).fire(new o.A("pitchend",c)),this.fire(new o.A("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),((r=o.h({offset:[0,0],duration:500,easing:o.eK},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,y=this.getZoom(),x=this.getBearing(),b=this.getPitch(),I=this.getPadding(),A="zoom"in r?+r.zoom:y,D="bearing"in r?this._normalizeBearing(r.bearing,x):x,L="pitch"in r?+r.pitch:b,B=this._extendPadding(r.padding),O=o.P.convert(r.offset);let U,q,$;if(p.projection.name==="globe"){const ve=o.ac.fromLngLat(p.center),We=O.rotate(-p.angle);ve.x+=We.x/p.worldSize,ve.y+=We.y/p.worldSize;const Le=ve.toLngLat(),lt=o.ci.convert(r.center||Le);this._normalizeCenter(lt),U=p.centerPoint.add(We),q=new o.P(ve.x,ve.y).mult(p.worldSize),$=new o.P(o.aD(lt.lng),o.aH(lt.lat)).mult(p.worldSize).sub(q)}else{U=p.centerPoint.add(O);const ve=p.pointLocation(U),We=o.ci.convert(r.center||ve);this._normalizeCenter(We),q=p.project(ve),$=p.project(We).sub(q)}const X=p.zoomScale(A-y);let Z,te;r.around&&(Z=o.ci.convert(r.around),te=p.locationPoint(Z));const re=this._zooming||A!==y,ae=this._rotating||x!==D,fe=this._pitching||L!==b,be=!p.isPaddingEqual(B),Ee=r.retainPadding===!1?p.clone():p,pe=ve=>We=>{if(re&&(ve.zoom=o.ai(y,A,We)),ae&&(ve.bearing=o.ai(x,D,We)),fe&&(ve.pitch=o.ai(b,L,We)),be&&(Ee.interpolatePadding(I,B,We),U=Ee.centerPoint.add(O)),Z)ve.setLocationAtPoint(Z,te);else{const Le=ve.zoomScale(ve.zoom-y),lt=A>y?Math.min(2,X):Math.max(.5,X),Ye=Math.pow(lt,1-We),ft=ve.unproject(q.add($.mult(We*Ye)).mult(Le));ve.setLocationAtPoint(ve.renderWorldCopies?ft.wrap():ft,U)}return r.preloadOnly||this._fireMoveEvents(c),ve};if(r.preloadOnly){const ve=this._emulate(pe,r.duration,p);return this._preloadTiles(ve),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ae,this._pitching=fe,this._padding=be,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,_e),this._ease(pe(p),ve=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,ve)},r),this}_prepareEase(r,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new o.A("movestart",r)),this._zooming&&!p.zooming&&this.fire(new o.A("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new o.A("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new o.A("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.A("move",r)),this._zooming&&this.fire(new o.A("zoom",r)),this._rotating&&this.fire(new o.A("rotate",r)),this._pitching&&this.fire(new o.A("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.A("zoomend",r)),y&&this.fire(new o.A("rotateend",r)),x&&this.fire(new o.A("pitchend",r)),this.fire(new o.A("moveend",r))}flyTo(r,c){if(this._prefersReducedMotion(r)){const Ke=o.aF(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ke,c)}this.stop(),r=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.eK},r);const p=this.transform,y=this.getZoom(),x=this.getBearing(),b=this.getPitch(),I=this.getPadding(),A="zoom"in r?o.ay(+r.zoom,p.minZoom,p.maxZoom):y,D="bearing"in r?this._normalizeBearing(r.bearing,x):x,L="pitch"in r?+r.pitch:b,B=this._extendPadding(r.padding),O=p.zoomScale(A-y),U=o.P.convert(r.offset);let q=p.centerPoint.add(U);const $=p.pointLocation(q),X=o.ci.convert(r.center||$);this._normalizeCenter(X);const Z=p.project($),te=p.project(X).sub(Z);let re=r.curve;const ae=Math.max(p.width,p.height),fe=ae/O,be=te.mag();if("minZoom"in r){const Ke=o.ay(Math.min(r.minZoom,y,A),p.minZoom,p.maxZoom),xt=ae/p.zoomScale(Ke-y);re=Math.sqrt(xt/be*2)}const Ee=re*re;function pe(Ke){const xt=(fe*fe-ae*ae+(Ke?-1:1)*Ee*Ee*be*be)/(2*(Ke?fe:ae)*Ee*be);return Math.log(Math.sqrt(xt*xt+1)-xt)}function _e(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function ve(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const We=pe(0);let Le=function(Ke){return ve(We)/ve(We+re*Ke)},lt=function(Ke){return ae*((ve(We)*(_e(xt=We+re*Ke)/ve(xt))-_e(We))/Ee)/be;var xt},Ye=(pe(1)-We)/re;if(Math.abs(be)<1e-6||!isFinite(Ye)){if(Math.abs(ae-fe)<1e-6)return this.easeTo(r,c);const Ke=fe<ae?-1:1;Ye=Math.abs(Math.log(fe/ae))/re,lt=function(){return 0},Le=function(xt){return Math.exp(Ke*re*xt)}}r.duration="duration"in r?+r.duration:1e3*Ye/("screenSpeed"in r?+r.screenSpeed/re:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const ft=x!==D,kt=L!==b,Ze=!p.isPaddingEqual(B),Ce=r.retainPadding===!1?p.clone():p,rt=Ke=>xt=>{const wt=xt*Ye,Et=1/Le(wt);Ke.zoom=xt===1?A:y+Ke.scaleZoom(Et),ft&&(Ke.bearing=o.ai(x,D,xt)),kt&&(Ke.pitch=o.ai(b,L,xt)),Ze&&(Ce.interpolatePadding(I,B,xt),q=Ce.centerPoint.add(U));const Nt=xt===1?X:Ke.unproject(Z.add(te.mult(lt(wt))).mult(Et));return Ke.setLocationAtPoint(Ke.renderWorldCopies?Nt.wrap():Nt,q),Ke._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),Ke};if(r.preloadOnly){const Ke=this._emulate(rt,r.duration,p);return this._preloadTiles(Ke),this}return this._zooming=!0,this._rotating=ft,this._pitching=kt,this._padding=Ze,this._prepareEase(c,!1),this._ease(rt(p),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,c,p){p.animate===!1||p.duration===0?(r(1),c()):(this._easeStart=o.q.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=o.bQ(r,-180,180);const p=Math.abs(r-c);return Math.abs(r-360-c)<p&&(r-=360),Math.abs(r+360-c)<p&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=r.lng-c.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,c,p){const y=Math.ceil(15*c/1e3),x=[],b=r(p.clone());for(let I=0;I<=y;I++){const A=b(I/y);x.push(A.clone())}return x}_preloadTiles(r,c){}}class td{constructor(r={}){this.options=r,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact,p=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=me("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=me("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=me("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(r){const p=c.reduce((y,x,b)=>(x.value&&(y+=`${x.key}=${x.value}${b<c.length-1?"&":""}`),y),"?");r.href=`${o.e.FEEDBACK_URL}/${p}#${_m(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._mergedSourceCaches;for(const y in c){const x=c[y];if(x.used){const b=x.getSource();b.attribution&&r.indexOf(b.attribution)<0&&r.push(b.attribution)}}r.sort((y,x)=>y.length-x.length),r=r.filter((y,x)=>{for(let b=x+1;b<r.length;b++)if(r[b].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mf{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=me("div","mapboxgl-ctrl");const c=me("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const c in r){const p=r[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class py{constructor(){o.aV(["_onIndoorUpdate"],this)}onAdd(r){return this._map=r,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",c=>this._onIndoorUpdate({selectedFloorId:c.selectedFloorId,floors:c.floors})),this._container}_createButton(r,c){const p=me("button",r,this._container);return p.type="button",p.addEventListener("click",c),p}_setButtonTitle(r,c){this._map&&(r.setAttribute("aria-label",c),r.innerHTML=`<strong>${c}</strong>`,r.firstElementChild&&r.firstElementChild.setAttribute("title",c))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(r){if(!r||!r.floors)return void(this._container.style.display="none");const c=this._model;this._model=r,this._container.style.display="inline-block";const p=r.floors.sort((y,x)=>y.levelOrder-x.levelOrder);c?(Array.from(this._container.children).forEach(y=>y.remove()),this.addCurrentFloors(p)):this.addCurrentFloors(p)}addCurrentFloors(r){for(const c of r){const p=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(c.id),Array.from(this._container.children).forEach(y=>{y.classList.remove("mapboxgl-ctrl-level-button-selected")}),p.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(p,c.shortName),this._model&&c.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(c.id),p.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(p)}}}class Y0{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const y of p)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Df{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=o.dx((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,p){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+p}}const CE={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Q0 extends o.A{constructor(r,c,p,y){const{point:x,lngLat:b,originalEvent:I,target:A}=r;super(r.type,{point:x,lngLat:b,originalEvent:I,target:A}),this.preventDefault=()=>{r.preventDefault()},this.id=c,this.interaction=p,this.feature=y}}class my{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,c){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const p=c.filter;let y=c.type;p&&this.filters.set(r,o.b3(p)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const x=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,c)):x.size===0&&this.map.on(y,this.handleType),x.size===0&&this.interactionsByType.set(y,x),x.set(r,c),this.typeById.set(r,y)}get(r){const c=this.typeById.get(r);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(r):void 0}remove(r){const c=this.typeById.get(r);if(!c)return;this.typeById.delete(r),this.filters.delete(r);const p=this.interactionsByType.get(c);p&&(p.delete(r),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(r,c){const p=[];for(const[y,x]of c)x.target&&p.push({targetId:y,target:x.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(r,p,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());c.length&&(r.type="mouseenter",this.handleType(r,c));const p=new Map;for(const[y,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||p.set(x.id,x);p.size&&(r.type="mouseleave",this.handleType(r,Array.from(p.values())))}handleOut(r){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(r.type="mouseleave",this.handleType(r,c)),this.hoveredFeatures.clear()}handleType(r,c){const p=r.type==="mouseenter";if(p&&!this.interactionsByType.has(r.type))return void o.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(r.type)).reverse(),x=!!c;c=c||this.queryTargets(r.point,y);let b=!1;const I=new Set;for(const A of c){for(const[D,L]of y){if(!L.target)continue;const B=A.variants?A.variants[D]:null;if(B){for(const O of B){if(ut(O,A,I,D))continue;const U=new o.dr(A,O),q=mt(O,A,D);x&&(U.state=this.map.getFeatureState(U));const $=p?this.prevHoveredFeatures.get(q):null,X=new Q0(r,D,L,U),Z=$?$.stop:L.handler(X);if(p&&this.hoveredFeatures.set(q,{feature:A,stop:Z}),Z!==!1){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[A,D]of y){const{handler:L,target:B}=D;if(!B&&L(new Q0(r,A,D,null))!==!1)break}}}function gy(f,r){if(Array.isArray(f)&&Array.isArray(r)){const c=new Set(f),p=new Set(r);return c.size===p.size&&f.every(y=>p.has(y))}return o.bv(f,r)}const Lf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},nd={showCompass:!0,showZoom:!0,visualizePitch:!1};class pc{constructor(r,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new xm({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new cy({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),_t()}move(r,c){const p=this.map,y=this.mouseRotate.mousemoveWindow(r,c),x=y&&y.bearingDelta;if(x&&p.setBearing(p.getBearing()+x),this.mousePitch){const b=this.mousePitch.mousemoveWindow(r,c),I=b&&b.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ct(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.h({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),xe(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,xe(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ke(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=ke(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ka(f,r,c){if(f=new o.ci(f.lng,f.lat),r){const p=new o.ci(f.lng-360,f.lat),y=new o.ci(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),b=c.locationPoint3D(f).distSqr(r),I=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint3D(p).distSqr(r)<b&&(I||Math.abs(p.lng-c.center.lng)<x)?f=p:c.locationPoint3D(y).distSqr(r)<b&&(I||Math.abs(y.lng-c.center.lng)<x)&&(f=y)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const ka={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},No={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Ma extends o.E{constructor(r,c){super(),(r instanceof HTMLElement||c)&&(r=o.h({element:r},c)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:y="#3FB1CE",scale:x=1,draggable:b=!1,clickTolerance:I=0,rotation:A=No.rotation,rotationAlignment:D=No.rotationAlignment,pitchAlignment:L=No.pitchAlignment,occludedOpacity:B=No.occludedOpacity,altitude:O=No.altitude}=r||{};this._anchor=p,this._color=y,this._scale=x,this._draggable=b,this._clickTolerance=I,this._rotation=A,this._rotationAlignment=D,this._pitchAlignment=L,this._occludedOpacity=B,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",$=>{$.preventDefault()}),this._element.addEventListener("mousedown",$=>{$.preventDefault()});const U=this._element.classList;for(const $ in ka)U.remove(`mapboxgl-marker-anchor-${$}`);U.add(`mapboxgl-marker-anchor-${this._anchor}`);const q=r&&r.className?r.className.trim().split(/\s+/):[];U.add(...q),this._popup=null}_createDefaultMarker(){const r=me("div"),c=Ue("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const p=Ue("radialGradient",{id:"shadowGradient"},Ue("defs",{},c));Ue("stop",{offset:"10%","stop-opacity":.4},p),Ue("stop",{offset:"100%","stop-opacity":.05},p),Ue("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return Ue("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),Ue("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),Ue("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.ci.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||No.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,p=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const p=r.unproject(c,this._altitude),y=r.getFreeCameraOptions();if(!y.position)return!1;const x=y.position.toLngLat();return x.distanceTo(p)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(c,this._altitude);let y;r._showingGlobe()&&o.eW(r.transform,this._lngLat)?y=0:(y=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ka[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const r=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!r||p!=="map")return"";if(!c._showingGlobe()){const A=c.getPitch();return A?`rotateX(${A}deg)`:""}const y=o.cU(o.eX(c.transform,this._lngLat)),x=r.sub(o.eY(c.transform)),b=Math.abs(x.x)+Math.abs(x.y);if(b===0)return"";const I=y/b;return`rotateX(${-x.y*I}deg) rotateY(${x.x*I}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const x=c.project(new o.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=c.project(new o.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);p=o.cU(Math.atan2(b.y,b.x))-90}else p=-c.getBearing();else if(y==="horizon"){const x=o.af(4,6,c.getZoom()),b=o.eY(c.transform);b.y+=x*c.transform.height;const I=r.sub(b),A=o.cU(Math.atan2(I.y,I.x));p=(A>90?A-270:A+90)*(1-x)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Ka(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const c=this._map;if(!c)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const x=this._clickTolerance||c._clickTolerance;if(r.point.dist(p)<x)return;this._isDragging=!0}this._pos=r.point.sub(y),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,p=this._pos;c&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||No.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||No.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||No.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||No.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const PE={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},RE={maxWidth:100,unit:"metric"},kE={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ME={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},J0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function To(f=new o.P(0,0),r="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new o.P(0,f);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-f);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(f,0);case"right":return new o.P(-f,0)}return new o.P(0,0)}return f instanceof o.P||Array.isArray(f)?o.P.convert(f):o.P.convert(f[r]||[0,0])}return{version:S,supported:oe.supported,setRTLTextPlugin:o.f0,getRTLTextPluginStatus:o.e$,Map:class extends ql{constructor(f){N.mark(P.create);const r=f;if((f=o.h({},Lf,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&o.eU(window)&&(f.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new u_(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Y0,this._domRenderTaskQueue=new Y0,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},CE,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Df(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Hn(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new bE),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Em(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||o.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new rE(this),f.hash&&(this._hash=new gm(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,o.h({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new td({customAttribution:f.customAttribution})),this._logoControl=new Mf,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.A(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.A(`${c.dataType}dataloading`,c))}),this._interactions=new my(this)}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.A("movestart",f)).fire(new o.A("move",f)),this.fire(new o.A("resize",f)),r&&this.fire(new o.A("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(o.aG.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(r=>r==="auto"?navigator.language:r):f}setLanguage(f){const r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,r=f.projection.name;let c;r==="globe"&&f.zoom>=o.cI?(f.setMercatorFromTransition(),c=!0):r==="mercator"&&f.zoom<o.cI&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;return r=f.name==="globe"&&this.transform.zoom>=o.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,r){return this.transform.locationPoint3D(o.ci.convert(f),r)}unproject(f,r){return this.transform.pointLocation3D(o.P.convert(f),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,c){const p=y=>{let x=[];if(Array.isArray(r)){const b=r.filter(I=>this.getLayer(I));x=b.length?this.queryRenderedFeatures(y,{layers:b}):[]}else x=this.queryRenderedFeatures(y,{target:r});return x};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:c,targets:r,delegates:{mousemove:b=>{const I=p(b.point);I.length?y||(y=!0,c.call(this,new yr(f,this,b.originalEvent,{features:I}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:c,targets:r,delegates:{mousemove:I=>{p(I.point).length?y=!0:y&&(y=!1,c.call(this,new yr(f,this,I.originalEvent)))},mouseout:I=>{y&&(y=!1,c.call(this,new yr(f,this,I.originalEvent)))}}}}{const y=x=>{const b=p(x.point);b.length&&(x.features=b,c.call(this,x),delete x.features)};return{listener:c,targets:r,delegates:{[f]:y}}}}on(f,r,c){if(typeof r=="function"||c===void 0)return super.on(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,r,c){if(typeof r=="function"||c===void 0)return super.once(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,c);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,r,c){if(typeof r=="function"||c===void 0)return super.off(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let x=0;x<y.length;x++){const b=y[x];if(b.listener===c&&gy(b.targets,r)){for(const I in b.delegates)this.off(I,b.delegates[I]);return y.splice(x,1),this}}})(p),this}queryRenderedFeatures(f,r){if(!this.style)return[];if(f===void 0||f instanceof o.P||Array.isArray(f)||r!==void 0||(r=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!r){const x=this.style.queryRenderedFeatures(f,void 0,this.transform),b=this.style.queryRenderedFeatureset(f,void 0,this.transform);return x.concat(b)}let c=!0;if(r.target&&(c=this._isTargetValid(r.target),c&&!r.layers))return this.style.queryRenderedFeatureset(f,r,this.transform);let p=!0;if(r.layers&&Array.isArray(r.layers)){for(const x of r.layers)if(!this._isValidId(x)){p=!1;break}if(p&&!r.target)return this.style.queryRenderedFeatures(f,r,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,r,this.transform))),c&&(y=y.concat(this.style.queryRenderedFeatureset(f,r,this.transform))),y}querySourceFeatures(f,r){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,r)}isPointOnSurface(f){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(f))}addInteraction(f,r){return this._interactions.add(f,r),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,r){return r=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&f&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(f,(c,p)=>{if(c){const y=typeof c=="string"?c:c instanceof Error?c.message:c.error;o.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,r)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=o.h({},r);r&&r.config&&(c.initialConfig=r.config,delete c.config),this.style=new Wa(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.dk(f)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const r of f)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(f)}addSource(f,r){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,r,{pixelRatio:c=1,sdf:p=!1,stretchX:y,stretchY:x,content:b}={}){this._lazyInitEmptyStyle();const I=o.I.from(f);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:A,height:D,data:L}=o.q.getImageData(r);this.style.addImage(I,{data:new o.r({width:A,height:D},L),pixelRatio:c,stretchX:y,stretchY:x,content:b,sdf:p,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:D}=r,L=r;this.style.addImage(I,{data:new o.r({width:A,height:D},new Uint8Array(L.data)),pixelRatio:c,stretchX:y,stretchY:x,content:b,sdf:p,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f)}}updateImage(f,r){this._lazyInitEmptyStyle();const c=o.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.q.getImageData(r):r,{width:x,height:b,data:I}=y;if(x===void 0||b===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||b!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${x}, ${b})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const A=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let D=!1;p.usvg?(p.data=new o.r({width:x,height:b},new Uint8Array(I)),p.usvg=!1,p.icon=void 0,D=!0):p.data.replace(I,A),this.style.updateImage(c,p,D)}hasImage(f){return f?!!this.style&&!!this.style.getImage(o.I.from(f)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(o.I.from(f))}loadImage(f,r){o.o(this._requestManager.transformRequest(f,o.R.Image),(c,p)=>{r(c,p instanceof HTMLImageElement?o.q.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,r){this._lazyInitEmptyStyle(),this.style.addModel(f,r)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,r){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)):this}getSlot(f){const r=this.getLayer(f);return r&&r.slot||null}setSlot(f,r){return this.style.setSlot(f,r),this.style.mergeLayers(),this._update(!0)}addImport(f,r){return this.style.addImport(f,r).catch(c=>this.fire(new o.z(new Error("Failed to add import",c)))),this}updateImport(f,r){return typeof r!="string"&&r.id!==f?(this.removeImport(f),this.addImport(r)):(this.style.updateImport(f,r),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,r){return this.style.moveImport(f,r),this._update(!0)}moveLayer(f,r){return this._isValidId(f)?(this.style.moveLayer(f,r),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const r=this.style.getOwnLayer(f);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,r,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,r,c),this._update(!0)):this}setFilter(f,r,c={}){return this._isValidId(f)?(this.style.setFilter(f,r,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,r,c,p),this._update(!0)):this}getPaintProperty(f,r){return this._isValidId(f)?this.style.getPaintProperty(f,r):null}setLayoutProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,r,c,p),this._update(!0)):this}getLayoutProperty(f,r){return this._isValidId(f)?this.style.getLayoutProperty(f,r):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,r){return this.style.setSchema(f,r),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,r){return this.style.setConfig(f,r),this._update(!0)}getConfigProperty(f,r){return this.style.getConfigProperty(f,r)}setConfigProperty(f,r,c){return this.style.setConfigProperty(f,r,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const r=f[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,r),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.ci.convert(f),this.transform):0}setFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,r),this._update())}removeFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,r),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new py),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,p,y,x=this._container;for(;x&&(!p||!y);){const b=window.getComputedStyle(x).transform;b&&b!=="none"&&(c=b.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),x=x.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(r/y):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=me("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=me("div","mapboxgl-canvas-container",f);this._canvas=me("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=me("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=me("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const c=o.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const r=this._popups.indexOf(f);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const f=o.h({},oe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",f);r?(Po(r,!0),this.painter=new iu(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.l.testSupport(r)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;this.fire(new o.A("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=o.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=y.createQuery(),y.beginQuery(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,L=this.transform.pitch,B=o.q.now(),O=new o.aa(D,{now:B,fadeDuration:x,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(p);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(P.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const D=o.q.now()-p;y.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const L=y.getQueryParameter(r,y.QUERY_RESULT)/1e6;y.deleteQuery(r),this.fire(new o.A("gpu-timing-frame",{cpuTime:D,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(D);this.fire(new o.A("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(D);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:L}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(b=this._updateAverageElevation(p,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,N.mark(P.fullLoad),this._performanceMetricsCollection&&ar(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){const c=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;const b=Math.abs(y-x);if(b>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,f,300)}else if(b>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){Wi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Be||f.status===401)){const r=this.painter.context.gl;Po(r,!1),this._logoControl instanceof Mf&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Xr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&qn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const b=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,b),b}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(f,r,c){let p=c[1]-c[0];const y=f.length/4;for(let x=0;x<r.length;x++){const b=r[x];let I=0;for(let A=0;A<b.length;A+=4)b[A]===f[A]&&b[A+1]===f[A+1]&&b[A+2]===f[A+2]&&b[A+3]===f[A+3]&&(I+=1);p+=(c[x+2]-c[x+1])*(1-I/y)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),$s.delete(this.painter.context.gl),rs.remove(),et.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=o.q.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(f){const r=this.style?this.style.getSourceCaches():[];return o.bt(r,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,r){o.eV(f,r)}get version(){return S}},NavigationControl:class{constructor(f={}){this.options=o.h({},nd,f),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),me("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),me("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=me("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),c=r===f.getMaxZoom(),p=r===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pc(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const c=me("button",f,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(f,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(f={}){super();const r=navigator.geolocation;this.options=o.h({geolocation:r},PE,f),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>r(c.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),c=f.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",f)),this._finish()}}_updateCamera(f){const r=new o.ci(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),y=o.h({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),y,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new o.ci(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=o.cb(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=me("button","mapboxgl-ctrl-geolocate",this._container),me("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me("div","mapboxgl-user-location"),this._dotElement.appendChild(me("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(me("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ma({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=me("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ma({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:td,ScaleControl:class{constructor(f={}){this.options=o.h({},RE,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,p=r._containerWidth/2-f/2,y=r.unproject([p,c]),x=r.unproject([p+f,c]),b=y.distanceTo(x);if(this.options.unit==="imperial"){const I=3.2808*b;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else this.options.unit==="nautical"?this._setScale(f,b/1852,"nautical-mile"):b>=1e3?this._setScale(f,b/1e3,"kilometer"):this._setScale(f,b,"meter")}_setScale(f,r,c){this._map._requestDomTask(()=>{const p=function(x){const b=Math.pow(10,`${Math.floor(x)}`.length-1);let I=x/b;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(A){const D=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*D)/D}(I),b*I}(r),y=p/r;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${kE[c]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=me("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=me("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=me("button","mapboxgl-ctrl-fullscreen",this._controlContainer);me("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:py,Popup:class extends o.E{constructor(f){super(),this.options=o.h(Object.create(ME),f),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=o.ci.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const r=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=me("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const c=this._closeButton=me("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,p=this._pos;if(!r||!c||!p)return"bottom";const y=c.offsetWidth,x=c.offsetHeight,b=p.x<y/2,I=p.x>r.transform.width-y/2;if(p.y+f<x)return b?"top-left":I?"top-right":"top";if(p.y>r.transform.height-x){if(b)return"bottom-left";if(I)return"bottom-right"}return b?"left":I?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=me("div","mapboxgl-popup",r.getContainer()),this._tip=me("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ka(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof o.P?f:r.project(this._lngLat,this._altitude),x=To(this.options.offset),b=this._anchor=this._getAnchor(x.y),I=To(this.options.offset,b),A=y.add(I).round();r._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${ka[b]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&r._showingGlobe()){const y=o.eW(r.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(J0);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Ma,Style:Wa,LngLat:o.ci,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:i0,Evented:o.E,config:o.e,prewarm:o.e_,clearPrewarmedResources:o.eZ,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(f){o.e.ACCESS_TOKEN=f},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(f){o.e.API_URL=f},get workerCount(){return o.f7.workerCount},set workerCount(f){o.f7.workerCount=f},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.f6(f)},get workerUrl(){return o.f5.workerUrl},set workerUrl(f){o.f5.workerUrl=f},get workerClass(){return o.f5.workerClass},set workerClass(f){o.f5.workerClass=f},get workerParams(){return o.f5.workerParams},set workerParams(f){o.f5.workerParams=f},get dracoUrl(){return o.f4()},set dracoUrl(f){o.f3(f)},get meshoptUrl(){return o.f2()},set meshoptUrl(f){o.f1(f)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var v=h;return v})})(Pj);var Coe=Pj.exports;const QC=tT(Coe),Poe="pk.eyJ1Ijoib3Jpb25pbXYiLCJhIjoiY21ldjR2c2FmMDZhazJrcjI0MDJkOXVsNSJ9.QWnLbif06XAORQ0mz0Bcmg";QC.accessToken=Poe;function Roe({center:t,onPick:e,height:n=400,readOnly:a=!1,className:h=""}){const m=yt.useRef(null),v=yt.useRef(null),o=yt.useRef(null),[S,P]=yt.useState(null);return yt.useEffect(()=>{if(!m.current||v.current)return;const V=t&&Number.isFinite(t.lat)&&Number.isFinite(t.lng)?[t.lng,t.lat]:[30.5234,50.4501];try{const j=new QC.Map({container:m.current,style:"mapbox://styles/mapbox/streets-v11",center:V,zoom:10});v.current=j,o.current=new QC.Marker().setLngLat(V).addTo(j);const Q=oe=>{var de;if(a)return;const{lng:me,lat:Ue}=oe.lngLat;(de=o.current)==null||de.setLngLat([me,Ue]),e==null||e({lat:Ue,lng:me})};return j.on("click",Q),()=>{try{j.off("click",Q),j.remove()}catch{}v.current=null}}catch(j){console.error("Mapbox init error:",j),P((j==null?void 0:j.message)||"  ")}},[t,a,e]),yt.useEffect(()=>{const N=v.current,V=o.current;if(!N||!V||!t||!Number.isFinite(t.lat)||!Number.isFinite(t.lng))return;const j=[t.lng,t.lat];try{V.setLngLat(j),N.easeTo({center:j})}catch(Q){console.warn("Map recenter error:",Q)}},[t==null?void 0:t.lat,t==null?void 0:t.lng]),S?mn.jsx("div",{className:`glass border border-white/10 rounded-xl grid place-items-center text-rose-300 text-sm text-center p-3 ${h}`,style:{height:n},children:S}):mn.jsx("div",{ref:m,className:`rounded-xl overflow-hidden border border-white/10 ${h}`,style:{height:n}})}function koe(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const Moe=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Doe=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Loe={};function $N(t,e){return(Loe.jsx?Doe:Moe).test(t)}const Ooe=/[ \t\n\f\r]/g;function zoe(t){return typeof t=="object"?t.type==="text"?HN(t.value):!1:HN(t)}function HN(t){return t.replace(Ooe,"")===""}class t0{constructor(e,n,a){this.normal=n,this.property=e,a&&(this.space=a)}}t0.prototype.normal={};t0.prototype.property={};t0.prototype.space=void 0;function kj(t,e){const n={},a={};for(const h of t)Object.assign(n,h.property),Object.assign(a,h.normal);return new t0(n,a,e)}function JC(t){return t.toLowerCase()}class hl{constructor(e,n){this.attribute=n,this.property=e}}hl.prototype.attribute="";hl.prototype.booleanish=!1;hl.prototype.boolean=!1;hl.prototype.commaOrSpaceSeparated=!1;hl.prototype.commaSeparated=!1;hl.prototype.defined=!1;hl.prototype.mustUseProperty=!1;hl.prototype.number=!1;hl.prototype.overloadedBoolean=!1;hl.prototype.property="";hl.prototype.spaceSeparated=!1;hl.prototype.space=void 0;let Foe=0;const or=Pp(),fo=Pp(),e2=Pp(),En=Pp(),ys=Pp(),Tg=Pp(),bl=Pp();function Pp(){return 2**++Foe}const t2=Object.freeze(Object.defineProperty({__proto__:null,boolean:or,booleanish:fo,commaOrSpaceSeparated:bl,commaSeparated:Tg,number:En,overloadedBoolean:e2,spaceSeparated:ys},Symbol.toStringTag,{value:"Module"})),eA=Object.keys(t2);class UR extends hl{constructor(e,n,a,h){let m=-1;if(super(e,n),qN(this,"space",h),typeof a=="number")for(;++m<eA.length;){const v=eA[m];qN(this,eA[m],(a&t2[v])===t2[v])}}}UR.prototype.defined=!0;function qN(t,e,n){n&&(t[e]=n)}function a_(t){const e={},n={};for(const[a,h]of Object.entries(t.properties)){const m=new UR(a,t.transform(t.attributes||{},a),h,t.space);t.mustUseProperty&&t.mustUseProperty.includes(a)&&(m.mustUseProperty=!0),e[a]=m,n[JC(a)]=a,n[JC(m.attribute)]=a}return new t0(e,n,t.space)}const Mj=a_({properties:{ariaActiveDescendant:null,ariaAtomic:fo,ariaAutoComplete:null,ariaBusy:fo,ariaChecked:fo,ariaColCount:En,ariaColIndex:En,ariaColSpan:En,ariaControls:ys,ariaCurrent:null,ariaDescribedBy:ys,ariaDetails:null,ariaDisabled:fo,ariaDropEffect:ys,ariaErrorMessage:null,ariaExpanded:fo,ariaFlowTo:ys,ariaGrabbed:fo,ariaHasPopup:null,ariaHidden:fo,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:ys,ariaLevel:En,ariaLive:null,ariaModal:fo,ariaMultiLine:fo,ariaMultiSelectable:fo,ariaOrientation:null,ariaOwns:ys,ariaPlaceholder:null,ariaPosInSet:En,ariaPressed:fo,ariaReadOnly:fo,ariaRelevant:null,ariaRequired:fo,ariaRoleDescription:ys,ariaRowCount:En,ariaRowIndex:En,ariaRowSpan:En,ariaSelected:fo,ariaSetSize:En,ariaSort:null,ariaValueMax:En,ariaValueMin:En,ariaValueNow:En,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function Dj(t,e){return e in t?t[e]:e}function Lj(t,e){return Dj(t,e.toLowerCase())}const Noe=a_({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Tg,acceptCharset:ys,accessKey:ys,action:null,allow:null,allowFullScreen:or,allowPaymentRequest:or,allowUserMedia:or,alt:null,as:null,async:or,autoCapitalize:null,autoComplete:ys,autoFocus:or,autoPlay:or,blocking:ys,capture:null,charSet:null,checked:or,cite:null,className:ys,cols:En,colSpan:null,content:null,contentEditable:fo,controls:or,controlsList:ys,coords:En|Tg,crossOrigin:null,data:null,dateTime:null,decoding:null,default:or,defer:or,dir:null,dirName:null,disabled:or,download:e2,draggable:fo,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:or,formTarget:null,headers:ys,height:En,hidden:e2,high:En,href:null,hrefLang:null,htmlFor:ys,httpEquiv:ys,id:null,imageSizes:null,imageSrcSet:null,inert:or,inputMode:null,integrity:null,is:null,isMap:or,itemId:null,itemProp:ys,itemRef:ys,itemScope:or,itemType:ys,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:or,low:En,manifest:null,max:null,maxLength:En,media:null,method:null,min:null,minLength:En,multiple:or,muted:or,name:null,nonce:null,noModule:or,noValidate:or,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:or,optimum:En,pattern:null,ping:ys,placeholder:null,playsInline:or,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:or,referrerPolicy:null,rel:ys,required:or,reversed:or,rows:En,rowSpan:En,sandbox:ys,scope:null,scoped:or,seamless:or,selected:or,shadowRootClonable:or,shadowRootDelegatesFocus:or,shadowRootMode:null,shape:null,size:En,sizes:null,slot:null,span:En,spellCheck:fo,src:null,srcDoc:null,srcLang:null,srcSet:null,start:En,step:null,style:null,tabIndex:En,target:null,title:null,translate:null,type:null,typeMustMatch:or,useMap:null,value:fo,width:En,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:ys,axis:null,background:null,bgColor:null,border:En,borderColor:null,bottomMargin:En,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:or,declare:or,event:null,face:null,frame:null,frameBorder:null,hSpace:En,leftMargin:En,link:null,longDesc:null,lowSrc:null,marginHeight:En,marginWidth:En,noResize:or,noHref:or,noShade:or,noWrap:or,object:null,profile:null,prompt:null,rev:null,rightMargin:En,rules:null,scheme:null,scrolling:fo,standby:null,summary:null,text:null,topMargin:En,valueType:null,version:null,vAlign:null,vLink:null,vSpace:En,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:or,disableRemotePlayback:or,prefix:null,property:null,results:En,security:null,unselectable:null},space:"html",transform:Lj}),Boe=a_({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:bl,accentHeight:En,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:En,amplitude:En,arabicForm:null,ascent:En,attributeName:null,attributeType:null,azimuth:En,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:En,by:null,calcMode:null,capHeight:En,className:ys,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:En,diffuseConstant:En,direction:null,display:null,dur:null,divisor:En,dominantBaseline:null,download:or,dx:null,dy:null,edgeMode:null,editable:null,elevation:En,enableBackground:null,end:null,event:null,exponent:En,externalResourcesRequired:null,fill:null,fillOpacity:En,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Tg,g2:Tg,glyphName:Tg,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:En,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:En,horizOriginX:En,horizOriginY:En,id:null,ideographic:En,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:En,k:En,k1:En,k2:En,k3:En,k4:En,kernelMatrix:bl,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:En,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:En,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:En,overlineThickness:En,paintOrder:null,panose1:null,path:null,pathLength:En,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:ys,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:En,pointsAtY:En,pointsAtZ:En,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:bl,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:bl,rev:bl,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:bl,requiredFeatures:bl,requiredFonts:bl,requiredFormats:bl,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:En,specularExponent:En,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:En,strikethroughThickness:En,string:null,stroke:null,strokeDashArray:bl,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:En,strokeOpacity:En,strokeWidth:null,style:null,surfaceScale:En,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:bl,tabIndex:En,tableValues:null,target:null,targetX:En,targetY:En,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:bl,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:En,underlineThickness:En,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:En,values:null,vAlphabetic:En,vMathematical:En,vectorEffect:null,vHanging:En,vIdeographic:En,version:null,vertAdvY:En,vertOriginX:En,vertOriginY:En,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:En,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Dj}),Oj=a_({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),zj=a_({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Lj}),Fj=a_({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),Voe={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},Uoe=/[A-Z]/g,WN=/-[a-z]/g,joe=/^data[-\w.:]+$/i;function Goe(t,e){const n=JC(e);let a=e,h=hl;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&joe.test(e)){if(e.charAt(4)==="-"){const m=e.slice(5).replace(WN,Hoe);a="data"+m.charAt(0).toUpperCase()+m.slice(1)}else{const m=e.slice(4);if(!WN.test(m)){let v=m.replace(Uoe,$oe);v.charAt(0)!=="-"&&(v="-"+v),e="data"+v}}h=UR}return new h(a,e)}function $oe(t){return"-"+t.toLowerCase()}function Hoe(t){return t.charAt(1).toUpperCase()}const qoe=kj([Mj,Noe,Oj,zj,Fj],"html"),jR=kj([Mj,Boe,Oj,zj,Fj],"svg");function Woe(t){return t.join(" ").trim()}var GR={},ZN=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,Zoe=/\n/g,Xoe=/^\s*/,Koe=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,Yoe=/^:\s*/,Qoe=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,Joe=/^[;\s]*/,eae=/^\s+|\s+$/g,tae=`
`,XN="/",KN="*",Wf="",nae="comment",iae="declaration",rae=function(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,a=1;function h(oe){var me=oe.match(Zoe);me&&(n+=me.length);var Ue=oe.lastIndexOf(tae);a=~Ue?oe.length-Ue:a+oe.length}function m(){var oe={line:n,column:a};return function(me){return me.position=new v(oe),P(),me}}function v(oe){this.start=oe,this.end={line:n,column:a},this.source=e.source}v.prototype.content=t;function o(oe){var me=new Error(e.source+":"+n+":"+a+": "+oe);if(me.reason=oe,me.filename=e.source,me.line=n,me.column=a,me.source=t,!e.silent)throw me}function S(oe){var me=oe.exec(t);if(me){var Ue=me[0];return h(Ue),t=t.slice(Ue.length),me}}function P(){S(Xoe)}function N(oe){var me;for(oe=oe||[];me=V();)me!==!1&&oe.push(me);return oe}function V(){var oe=m();if(!(XN!=t.charAt(0)||KN!=t.charAt(1))){for(var me=2;Wf!=t.charAt(me)&&(KN!=t.charAt(me)||XN!=t.charAt(me+1));)++me;if(me+=2,Wf===t.charAt(me-1))return o("End of comment missing");var Ue=t.slice(2,me-2);return a+=2,h(Ue),t=t.slice(me),a+=2,oe({type:nae,comment:Ue})}}function j(){var oe=m(),me=S(Koe);if(me){if(V(),!S(Yoe))return o("property missing ':'");var Ue=S(Qoe),de=oe({type:iae,property:YN(me[0].replace(ZN,Wf)),value:Ue?YN(Ue[0].replace(ZN,Wf)):Wf});return S(Joe),de}}function Q(){var oe=[];N(oe);for(var me;me=j();)me!==!1&&(oe.push(me),N(oe));return oe}return P(),Q()};function YN(t){return t?t.replace(eae,Wf):Wf}var sae=th&&th.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(GR,"__esModule",{value:!0});GR.default=aae;var oae=sae(rae);function aae(t,e){var n=null;if(!t||typeof t!="string")return n;var a=(0,oae.default)(t),h=typeof e=="function";return a.forEach(function(m){if(m.type==="declaration"){var v=m.property,o=m.value;h?e(v,o,m):o&&(n=n||{},n[v]=o)}}),n}var YT={};Object.defineProperty(YT,"__esModule",{value:!0});YT.camelCase=void 0;var lae=/^--[a-zA-Z0-9_-]+$/,cae=/-([a-z])/g,uae=/^[^-]+$/,hae=/^-(webkit|moz|ms|o|khtml)-/,dae=/^-(ms)-/,fae=function(t){return!t||uae.test(t)||lae.test(t)},pae=function(t,e){return e.toUpperCase()},QN=function(t,e){return"".concat(e,"-")},mae=function(t,e){return e===void 0&&(e={}),fae(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(dae,QN):t=t.replace(hae,QN),t.replace(cae,pae))};YT.camelCase=mae;var gae=th&&th.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},_ae=gae(GR),yae=YT;function n2(t,e){var n={};return!t||typeof t!="string"||(0,_ae.default)(t,function(a,h){a&&h&&(n[(0,yae.camelCase)(a,e)]=h)}),n}n2.default=n2;var vae=n2;const xae=tT(vae),Nj=Bj("end"),$R=Bj("start");function Bj(t){return e;function e(n){const a=n&&n.position&&n.position[t]||{};if(typeof a.line=="number"&&a.line>0&&typeof a.column=="number"&&a.column>0)return{line:a.line,column:a.column,offset:typeof a.offset=="number"&&a.offset>-1?a.offset:void 0}}}function wae(t){const e=$R(t),n=Nj(t);if(e&&n)return{start:e,end:n}}function Wv(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?JN(t.position):"start"in t||"end"in t?JN(t):"line"in t||"column"in t?i2(t):""}function i2(t){return e3(t&&t.line)+":"+e3(t&&t.column)}function JN(t){return i2(t&&t.start)+"-"+i2(t&&t.end)}function e3(t){return t&&typeof t=="number"?t:1}class Ta extends Error{constructor(e,n,a){super(),typeof n=="string"&&(a=n,n=void 0);let h="",m={},v=!1;if(n&&("line"in n&&"column"in n?m={place:n}:"start"in n&&"end"in n?m={place:n}:"type"in n?m={ancestors:[n],place:n.position}:m={...n}),typeof e=="string"?h=e:!m.cause&&e&&(v=!0,h=e.message,m.cause=e),!m.ruleId&&!m.source&&typeof a=="string"){const S=a.indexOf(":");S===-1?m.ruleId=a:(m.source=a.slice(0,S),m.ruleId=a.slice(S+1))}if(!m.place&&m.ancestors&&m.ancestors){const S=m.ancestors[m.ancestors.length-1];S&&(m.place=S.position)}const o=m.place&&"start"in m.place?m.place.start:m.place;this.ancestors=m.ancestors||void 0,this.cause=m.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=h,this.line=o?o.line:void 0,this.name=Wv(m.place)||"1:1",this.place=m.place||void 0,this.reason=this.message,this.ruleId=m.ruleId||void 0,this.source=m.source||void 0,this.stack=v&&m.cause&&typeof m.cause.stack=="string"?m.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Ta.prototype.file="";Ta.prototype.name="";Ta.prototype.reason="";Ta.prototype.message="";Ta.prototype.stack="";Ta.prototype.column=void 0;Ta.prototype.line=void 0;Ta.prototype.ancestors=void 0;Ta.prototype.cause=void 0;Ta.prototype.fatal=void 0;Ta.prototype.place=void 0;Ta.prototype.ruleId=void 0;Ta.prototype.source=void 0;const HR={}.hasOwnProperty,bae=new Map,Tae=/[A-Z]/g,Eae=new Set(["table","tbody","thead","tfoot","tr"]),Iae=new Set(["td","th"]),Vj="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function Sae(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let a;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");a=Lae(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");a=Dae(n,e.jsx,e.jsxs)}const h={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:a,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?jR:qoe,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},m=Uj(h,t,void 0);return m&&typeof m!="string"?m:h.create(t,h.Fragment,{children:m||void 0},void 0)}function Uj(t,e,n){if(e.type==="element")return Aae(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return Cae(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return Rae(t,e,n);if(e.type==="mdxjsEsm")return Pae(t,e);if(e.type==="root")return kae(t,e,n);if(e.type==="text")return Mae(t,e)}function Aae(t,e,n){const a=t.schema;let h=a;e.tagName.toLowerCase()==="svg"&&a.space==="html"&&(h=jR,t.schema=h),t.ancestors.push(e);const m=Gj(t,e.tagName,!1),v=Oae(t,e);let o=WR(t,e);return Eae.has(e.tagName)&&(o=o.filter(function(S){return typeof S=="string"?!zoe(S):!0})),jj(t,v,m,e),qR(v,o),t.ancestors.pop(),t.schema=a,t.create(e,m,v,n)}function Cae(t,e){if(e.data&&e.data.estree&&t.evaluater){const a=e.data.estree.body[0];return a.type,t.evaluater.evaluateExpression(a.expression)}Rx(t,e.position)}function Pae(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Rx(t,e.position)}function Rae(t,e,n){const a=t.schema;let h=a;e.name==="svg"&&a.space==="html"&&(h=jR,t.schema=h),t.ancestors.push(e);const m=e.name===null?t.Fragment:Gj(t,e.name,!0),v=zae(t,e),o=WR(t,e);return jj(t,v,m,e),qR(v,o),t.ancestors.pop(),t.schema=a,t.create(e,m,v,n)}function kae(t,e,n){const a={};return qR(a,WR(t,e)),t.create(e,t.Fragment,a,n)}function Mae(t,e){return e.value}function jj(t,e,n,a){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=a)}function qR(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function Dae(t,e,n){return a;function a(h,m,v,o){const P=Array.isArray(v.children)?n:e;return o?P(m,v,o):P(m,v)}}function Lae(t,e){return n;function n(a,h,m,v){const o=Array.isArray(m.children),S=$R(a);return e(h,m,v,o,{columnNumber:S?S.column-1:void 0,fileName:t,lineNumber:S?S.line:void 0},void 0)}}function Oae(t,e){const n={};let a,h;for(h in e.properties)if(h!=="children"&&HR.call(e.properties,h)){const m=Fae(t,h,e.properties[h]);if(m){const[v,o]=m;t.tableCellAlignToStyle&&v==="align"&&typeof o=="string"&&Iae.has(e.tagName)?a=o:n[v]=o}}if(a){const m=n.style||(n.style={});m[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=a}return n}function zae(t,e){const n={};for(const a of e.attributes)if(a.type==="mdxJsxExpressionAttribute")if(a.data&&a.data.estree&&t.evaluater){const m=a.data.estree.body[0];m.type;const v=m.expression;v.type;const o=v.properties[0];o.type,Object.assign(n,t.evaluater.evaluateExpression(o.argument))}else Rx(t,e.position);else{const h=a.name;let m;if(a.value&&typeof a.value=="object")if(a.value.data&&a.value.data.estree&&t.evaluater){const o=a.value.data.estree.body[0];o.type,m=t.evaluater.evaluateExpression(o.expression)}else Rx(t,e.position);else m=a.value===null?!0:a.value;n[h]=m}return n}function WR(t,e){const n=[];let a=-1;const h=t.passKeys?new Map:bae;for(;++a<e.children.length;){const m=e.children[a];let v;if(t.passKeys){const S=m.type==="element"?m.tagName:m.type==="mdxJsxFlowElement"||m.type==="mdxJsxTextElement"?m.name:void 0;if(S){const P=h.get(S)||0;v=S+"-"+P,h.set(S,P+1)}}const o=Uj(t,m,v);o!==void 0&&n.push(o)}return n}function Fae(t,e,n){const a=Goe(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=a.commaSeparated?koe(n):Woe(n)),a.property==="style"){let h=typeof n=="object"?n:Nae(t,String(n));return t.stylePropertyNameCase==="css"&&(h=Bae(h)),["style",h]}return[t.elementAttributeNameCase==="react"&&a.space?Voe[a.property]||a.property:a.attribute,n]}}function Nae(t,e){try{return xae(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const a=n,h=new Ta("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:a,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw h.file=t.filePath||void 0,h.url=Vj+"#cannot-parse-style-attribute",h}}function Gj(t,e,n){let a;if(!n)a={type:"Literal",value:e};else if(e.includes(".")){const h=e.split(".");let m=-1,v;for(;++m<h.length;){const o=$N(h[m])?{type:"Identifier",name:h[m]}:{type:"Literal",value:h[m]};v=v?{type:"MemberExpression",object:v,property:o,computed:!!(m&&o.type==="Literal"),optional:!1}:o}a=v}else a=$N(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(a.type==="Literal"){const h=a.value;return HR.call(t.components,h)?t.components[h]:h}if(t.evaluater)return t.evaluater.evaluateExpression(a);Rx(t)}function Rx(t,e){const n=new Ta("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=Vj+"#cannot-handle-mdx-estrees-without-createevaluater",n}function Bae(t){const e={};let n;for(n in t)HR.call(t,n)&&(e[Vae(n)]=t[n]);return e}function Vae(t){let e=t.replace(Tae,Uae);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function Uae(t){return"-"+t.toLowerCase()}const tA={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},jae={};function Gae(t,e){const n=jae,a=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,h=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return $j(t,a,h)}function $j(t,e,n){if($ae(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return t3(t.children,e,n)}return Array.isArray(t)?t3(t,e,n):""}function t3(t,e,n){const a=[];let h=-1;for(;++h<t.length;)a[h]=$j(t[h],e,n);return a.join("")}function $ae(t){return!!(t&&typeof t=="object")}const n3=document.createElement("i");function ZR(t){const e="&"+t+";";n3.innerHTML=e;const n=n3.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Su(t,e,n,a){const h=t.length;let m=0,v;if(e<0?e=-e>h?0:h+e:e=e>h?h:e,n=n>0?n:0,a.length<1e4)v=Array.from(a),v.unshift(e,n),t.splice(...v);else for(n&&t.splice(e,n);m<a.length;)v=a.slice(m,m+1e4),v.unshift(e,0),t.splice(...v),m+=1e4,e+=1e4}function Yl(t,e){return t.length>0?(Su(t,t.length,0,e),t):e}const i3={}.hasOwnProperty;function Hae(t){const e={};let n=-1;for(;++n<t.length;)qae(e,t[n]);return e}function qae(t,e){let n;for(n in e){const h=(i3.call(t,n)?t[n]:void 0)||(t[n]={}),m=e[n];let v;if(m)for(v in m){i3.call(h,v)||(h[v]=[]);const o=m[v];Wae(h[v],Array.isArray(o)?o:o?[o]:[])}}}function Wae(t,e){let n=-1;const a=[];for(;++n<e.length;)(e[n].add==="after"?t:a).push(e[n]);Su(t,0,0,a)}function Hj(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Eg(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const gu=cf(/[A-Za-z]/),Sl=cf(/[\dA-Za-z]/),Zae=cf(/[#-'*+\--9=?A-Z^-~]/);function r2(t){return t!==null&&(t<32||t===127)}const s2=cf(/\d/),Xae=cf(/[\dA-Fa-f]/),Kae=cf(/[!-/:-@[-`{-~]/);function Bi(t){return t!==null&&t<-2}function cl(t){return t!==null&&(t<0||t===32)}function Zr(t){return t===-2||t===-1||t===32}const Yae=cf(new RegExp("\\p{P}|\\p{S}","u")),Qae=cf(/\s/);function cf(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function l_(t){const e=[];let n=-1,a=0,h=0;for(;++n<t.length;){const m=t.charCodeAt(n);let v="";if(m===37&&Sl(t.charCodeAt(n+1))&&Sl(t.charCodeAt(n+2)))h=2;else if(m<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(m))||(v=String.fromCharCode(m));else if(m>55295&&m<57344){const o=t.charCodeAt(n+1);m<56320&&o>56319&&o<57344?(v=String.fromCharCode(m,o),h=1):v=""}else v=String.fromCharCode(m);v&&(e.push(t.slice(a,n),encodeURIComponent(v)),a=n+h+1,v=""),h&&(n+=h,h=0)}return e.join("")+t.slice(a)}function ws(t,e,n,a){const h=a?a-1:Number.POSITIVE_INFINITY;let m=0;return v;function v(S){return Zr(S)?(t.enter(n),o(S)):e(S)}function o(S){return Zr(S)&&m++<h?(t.consume(S),o):(t.exit(n),e(S))}}const Jae={tokenize:ele};function ele(t){const e=t.attempt(this.parser.constructs.contentInitial,a,h);let n;return e;function a(o){if(o===null){t.consume(o);return}return t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),ws(t,e,"linePrefix")}function h(o){return t.enter("paragraph"),m(o)}function m(o){const S=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=S),n=S,v(o)}function v(o){if(o===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(o);return}return Bi(o)?(t.consume(o),t.exit("chunkText"),m):(t.consume(o),v)}}const tle={tokenize:nle},r3={tokenize:ile};function nle(t){const e=this,n=[];let a=0,h,m,v;return o;function o(Re){if(a<n.length){const _t=n[a];return e.containerState=_t[1],t.attempt(_t[0].continuation,S,P)(Re)}return P(Re)}function S(Re){if(a++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,h&&ge();const _t=e.events.length;let ct=_t,nt;for(;ct--;)if(e.events[ct][0]==="exit"&&e.events[ct][1].type==="chunkFlow"){nt=e.events[ct][1].end;break}de(a);let Pe=_t;for(;Pe<e.events.length;)e.events[Pe][1].end={...nt},Pe++;return Su(e.events,ct+1,0,e.events.slice(_t)),e.events.length=Pe,P(Re)}return o(Re)}function P(Re){if(a===n.length){if(!h)return j(Re);if(h.currentConstruct&&h.currentConstruct.concrete)return oe(Re);e.interrupt=!!(h.currentConstruct&&!h._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(r3,N,V)(Re)}function N(Re){return h&&ge(),de(a),j(Re)}function V(Re){return e.parser.lazy[e.now().line]=a!==n.length,v=e.now().offset,oe(Re)}function j(Re){return e.containerState={},t.attempt(r3,Q,oe)(Re)}function Q(Re){return a++,n.push([e.currentConstruct,e.containerState]),j(Re)}function oe(Re){if(Re===null){h&&ge(),de(0),t.consume(Re);return}return h=h||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:h,contentType:"flow",previous:m}),me(Re)}function me(Re){if(Re===null){Ue(t.exit("chunkFlow"),!0),de(0),t.consume(Re);return}return Bi(Re)?(t.consume(Re),Ue(t.exit("chunkFlow")),a=0,e.interrupt=void 0,o):(t.consume(Re),me)}function Ue(Re,_t){const ct=e.sliceStream(Re);if(_t&&ct.push(null),Re.previous=m,m&&(m.next=Re),m=Re,h.defineSkip(Re.start),h.write(ct),e.parser.lazy[Re.start.line]){let nt=h.events.length;for(;nt--;)if(h.events[nt][1].start.offset<v&&(!h.events[nt][1].end||h.events[nt][1].end.offset>v))return;const Pe=e.events.length;let xe=Pe,ke,Ve;for(;xe--;)if(e.events[xe][0]==="exit"&&e.events[xe][1].type==="chunkFlow"){if(ke){Ve=e.events[xe][1].end;break}ke=!0}for(de(a),nt=Pe;nt<e.events.length;)e.events[nt][1].end={...Ve},nt++;Su(e.events,xe+1,0,e.events.slice(Pe)),e.events.length=nt}}function de(Re){let _t=n.length;for(;_t-- >Re;){const ct=n[_t];e.containerState=ct[1],ct[0].exit.call(e,t)}n.length=Re}function ge(){h.write([null]),m=void 0,h=void 0,e.containerState._closeFlow=void 0}}function ile(t,e,n){return ws(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function s3(t){if(t===null||cl(t)||Qae(t))return 1;if(Yae(t))return 2}function XR(t,e,n){const a=[];let h=-1;for(;++h<t.length;){const m=t[h].resolveAll;m&&!a.includes(m)&&(e=m(e,n),a.push(m))}return e}const o2={name:"attention",resolveAll:rle,tokenize:sle};function rle(t,e){let n=-1,a,h,m,v,o,S,P,N;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(a=n;a--;)if(t[a][0]==="exit"&&t[a][1].type==="attentionSequence"&&t[a][1]._open&&e.sliceSerialize(t[a][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[a][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[a][1].end.offset-t[a][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;S=t[a][1].end.offset-t[a][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const V={...t[a][1].end},j={...t[n][1].start};o3(V,-S),o3(j,S),v={type:S>1?"strongSequence":"emphasisSequence",start:V,end:{...t[a][1].end}},o={type:S>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:j},m={type:S>1?"strongText":"emphasisText",start:{...t[a][1].end},end:{...t[n][1].start}},h={type:S>1?"strong":"emphasis",start:{...v.start},end:{...o.end}},t[a][1].end={...v.start},t[n][1].start={...o.end},P=[],t[a][1].end.offset-t[a][1].start.offset&&(P=Yl(P,[["enter",t[a][1],e],["exit",t[a][1],e]])),P=Yl(P,[["enter",h,e],["enter",v,e],["exit",v,e],["enter",m,e]]),P=Yl(P,XR(e.parser.constructs.insideSpan.null,t.slice(a+1,n),e)),P=Yl(P,[["exit",m,e],["enter",o,e],["exit",o,e],["exit",h,e]]),t[n][1].end.offset-t[n][1].start.offset?(N=2,P=Yl(P,[["enter",t[n][1],e],["exit",t[n][1],e]])):N=0,Su(t,a-1,n-a+3,P),n=a+P.length-N-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function sle(t,e){const n=this.parser.constructs.attentionMarkers.null,a=this.previous,h=s3(a);let m;return v;function v(S){return m=S,t.enter("attentionSequence"),o(S)}function o(S){if(S===m)return t.consume(S),o;const P=t.exit("attentionSequence"),N=s3(S),V=!N||N===2&&h||n.includes(S),j=!h||h===2&&N||n.includes(a);return P._open=!!(m===42?V:V&&(h||!j)),P._close=!!(m===42?j:j&&(N||!V)),e(S)}}function o3(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const ole={name:"autolink",tokenize:ale};function ale(t,e,n){let a=0;return h;function h(Q){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(Q),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),m}function m(Q){return gu(Q)?(t.consume(Q),v):Q===64?n(Q):P(Q)}function v(Q){return Q===43||Q===45||Q===46||Sl(Q)?(a=1,o(Q)):P(Q)}function o(Q){return Q===58?(t.consume(Q),a=0,S):(Q===43||Q===45||Q===46||Sl(Q))&&a++<32?(t.consume(Q),o):(a=0,P(Q))}function S(Q){return Q===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(Q),t.exit("autolinkMarker"),t.exit("autolink"),e):Q===null||Q===32||Q===60||r2(Q)?n(Q):(t.consume(Q),S)}function P(Q){return Q===64?(t.consume(Q),N):Zae(Q)?(t.consume(Q),P):n(Q)}function N(Q){return Sl(Q)?V(Q):n(Q)}function V(Q){return Q===46?(t.consume(Q),a=0,N):Q===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(Q),t.exit("autolinkMarker"),t.exit("autolink"),e):j(Q)}function j(Q){if((Q===45||Sl(Q))&&a++<63){const oe=Q===45?j:V;return t.consume(Q),oe}return n(Q)}}const QT={partial:!0,tokenize:lle};function lle(t,e,n){return a;function a(m){return Zr(m)?ws(t,h,"linePrefix")(m):h(m)}function h(m){return m===null||Bi(m)?e(m):n(m)}}const qj={continuation:{tokenize:ule},exit:hle,name:"blockQuote",tokenize:cle};function cle(t,e,n){const a=this;return h;function h(v){if(v===62){const o=a.containerState;return o.open||(t.enter("blockQuote",{_container:!0}),o.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(v),t.exit("blockQuoteMarker"),m}return n(v)}function m(v){return Zr(v)?(t.enter("blockQuotePrefixWhitespace"),t.consume(v),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(v))}}function ule(t,e,n){const a=this;return h;function h(v){return Zr(v)?ws(t,m,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(v):m(v)}function m(v){return t.attempt(qj,e,n)(v)}}function hle(t){t.exit("blockQuote")}const Wj={name:"characterEscape",tokenize:dle};function dle(t,e,n){return a;function a(m){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(m),t.exit("escapeMarker"),h}function h(m){return Kae(m)?(t.enter("characterEscapeValue"),t.consume(m),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(m)}}const Zj={name:"characterReference",tokenize:fle};function fle(t,e,n){const a=this;let h=0,m,v;return o;function o(V){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(V),t.exit("characterReferenceMarker"),S}function S(V){return V===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(V),t.exit("characterReferenceMarkerNumeric"),P):(t.enter("characterReferenceValue"),m=31,v=Sl,N(V))}function P(V){return V===88||V===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(V),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),m=6,v=Xae,N):(t.enter("characterReferenceValue"),m=7,v=s2,N(V))}function N(V){if(V===59&&h){const j=t.exit("characterReferenceValue");return v===Sl&&!ZR(a.sliceSerialize(j))?n(V):(t.enter("characterReferenceMarker"),t.consume(V),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return v(V)&&h++<m?(t.consume(V),N):n(V)}}const a3={partial:!0,tokenize:mle},l3={concrete:!0,name:"codeFenced",tokenize:ple};function ple(t,e,n){const a=this,h={partial:!0,tokenize:ct};let m=0,v=0,o;return S;function S(nt){return P(nt)}function P(nt){const Pe=a.events[a.events.length-1];return m=Pe&&Pe[1].type==="linePrefix"?Pe[2].sliceSerialize(Pe[1],!0).length:0,o=nt,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),N(nt)}function N(nt){return nt===o?(v++,t.consume(nt),N):v<3?n(nt):(t.exit("codeFencedFenceSequence"),Zr(nt)?ws(t,V,"whitespace")(nt):V(nt))}function V(nt){return nt===null||Bi(nt)?(t.exit("codeFencedFence"),a.interrupt?e(nt):t.check(a3,me,_t)(nt)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),j(nt))}function j(nt){return nt===null||Bi(nt)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),V(nt)):Zr(nt)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),ws(t,Q,"whitespace")(nt)):nt===96&&nt===o?n(nt):(t.consume(nt),j)}function Q(nt){return nt===null||Bi(nt)?V(nt):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),oe(nt))}function oe(nt){return nt===null||Bi(nt)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),V(nt)):nt===96&&nt===o?n(nt):(t.consume(nt),oe)}function me(nt){return t.attempt(h,_t,Ue)(nt)}function Ue(nt){return t.enter("lineEnding"),t.consume(nt),t.exit("lineEnding"),de}function de(nt){return m>0&&Zr(nt)?ws(t,ge,"linePrefix",m+1)(nt):ge(nt)}function ge(nt){return nt===null||Bi(nt)?t.check(a3,me,_t)(nt):(t.enter("codeFlowValue"),Re(nt))}function Re(nt){return nt===null||Bi(nt)?(t.exit("codeFlowValue"),ge(nt)):(t.consume(nt),Re)}function _t(nt){return t.exit("codeFenced"),e(nt)}function ct(nt,Pe,xe){let ke=0;return Ve;function Ve(Ln){return nt.enter("lineEnding"),nt.consume(Ln),nt.exit("lineEnding"),De}function De(Ln){return nt.enter("codeFencedFence"),Zr(Ln)?ws(nt,Qe,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Ln):Qe(Ln)}function Qe(Ln){return Ln===o?(nt.enter("codeFencedFenceSequence"),Be(Ln)):xe(Ln)}function Be(Ln){return Ln===o?(ke++,nt.consume(Ln),Be):ke>=v?(nt.exit("codeFencedFenceSequence"),Zr(Ln)?ws(nt,Hn,"whitespace")(Ln):Hn(Ln)):xe(Ln)}function Hn(Ln){return Ln===null||Bi(Ln)?(nt.exit("codeFencedFence"),Pe(Ln)):xe(Ln)}}}function mle(t,e,n){const a=this;return h;function h(v){return v===null?n(v):(t.enter("lineEnding"),t.consume(v),t.exit("lineEnding"),m)}function m(v){return a.parser.lazy[a.now().line]?n(v):e(v)}}const nA={name:"codeIndented",tokenize:_le},gle={partial:!0,tokenize:yle};function _le(t,e,n){const a=this;return h;function h(P){return t.enter("codeIndented"),ws(t,m,"linePrefix",5)(P)}function m(P){const N=a.events[a.events.length-1];return N&&N[1].type==="linePrefix"&&N[2].sliceSerialize(N[1],!0).length>=4?v(P):n(P)}function v(P){return P===null?S(P):Bi(P)?t.attempt(gle,v,S)(P):(t.enter("codeFlowValue"),o(P))}function o(P){return P===null||Bi(P)?(t.exit("codeFlowValue"),v(P)):(t.consume(P),o)}function S(P){return t.exit("codeIndented"),e(P)}}function yle(t,e,n){const a=this;return h;function h(v){return a.parser.lazy[a.now().line]?n(v):Bi(v)?(t.enter("lineEnding"),t.consume(v),t.exit("lineEnding"),h):ws(t,m,"linePrefix",5)(v)}function m(v){const o=a.events[a.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(v):Bi(v)?h(v):n(v)}}const vle={name:"codeText",previous:wle,resolve:xle,tokenize:ble};function xle(t){let e=t.length-4,n=3,a,h;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(a=n;++a<e;)if(t[a][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(a=n-1,e++;++a<=e;)h===void 0?a!==e&&t[a][1].type!=="lineEnding"&&(h=a):(a===e||t[a][1].type==="lineEnding")&&(t[h][1].type="codeTextData",a!==h+2&&(t[h][1].end=t[a-1][1].end,t.splice(h+2,a-h-2),e-=a-h-2,a=h+2),h=void 0);return t}function wle(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function ble(t,e,n){let a=0,h,m;return v;function v(V){return t.enter("codeText"),t.enter("codeTextSequence"),o(V)}function o(V){return V===96?(t.consume(V),a++,o):(t.exit("codeTextSequence"),S(V))}function S(V){return V===null?n(V):V===32?(t.enter("space"),t.consume(V),t.exit("space"),S):V===96?(m=t.enter("codeTextSequence"),h=0,N(V)):Bi(V)?(t.enter("lineEnding"),t.consume(V),t.exit("lineEnding"),S):(t.enter("codeTextData"),P(V))}function P(V){return V===null||V===32||V===96||Bi(V)?(t.exit("codeTextData"),S(V)):(t.consume(V),P)}function N(V){return V===96?(t.consume(V),h++,N):h===a?(t.exit("codeTextSequence"),t.exit("codeText"),e(V)):(m.type="codeTextData",P(V))}}class Tle{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const a=n??Number.POSITIVE_INFINITY;return a<this.left.length?this.left.slice(e,a):e>this.left.length?this.right.slice(this.right.length-a+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-a+this.left.length).reverse())}splice(e,n,a){const h=n||0;this.setCursor(Math.trunc(e));const m=this.right.splice(this.right.length-h,Number.POSITIVE_INFINITY);return a&&mv(this.left,a),m.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),mv(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),mv(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);mv(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);mv(this.left,n.reverse())}}}function mv(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function Xj(t){const e={};let n=-1,a,h,m,v,o,S,P;const N=new Tle(t);for(;++n<N.length;){for(;n in e;)n=e[n];if(a=N.get(n),n&&a[1].type==="chunkFlow"&&N.get(n-1)[1].type==="listItemPrefix"&&(S=a[1]._tokenizer.events,m=0,m<S.length&&S[m][1].type==="lineEndingBlank"&&(m+=2),m<S.length&&S[m][1].type==="content"))for(;++m<S.length&&S[m][1].type!=="content";)S[m][1].type==="chunkText"&&(S[m][1]._isInFirstContentOfListItem=!0,m++);if(a[0]==="enter")a[1].contentType&&(Object.assign(e,Ele(N,n)),n=e[n],P=!0);else if(a[1]._container){for(m=n,h=void 0;m--;)if(v=N.get(m),v[1].type==="lineEnding"||v[1].type==="lineEndingBlank")v[0]==="enter"&&(h&&(N.get(h)[1].type="lineEndingBlank"),v[1].type="lineEnding",h=m);else if(!(v[1].type==="linePrefix"||v[1].type==="listItemIndent"))break;h&&(a[1].end={...N.get(h)[1].start},o=N.slice(h,n),o.unshift(a),N.splice(h,n-h+1,o))}}return Su(t,0,Number.POSITIVE_INFINITY,N.slice(0)),!P}function Ele(t,e){const n=t.get(e)[1],a=t.get(e)[2];let h=e-1;const m=[];let v=n._tokenizer;v||(v=a.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(v._contentTypeTextTrailing=!0));const o=v.events,S=[],P={};let N,V,j=-1,Q=n,oe=0,me=0;const Ue=[me];for(;Q;){for(;t.get(++h)[1]!==Q;);m.push(h),Q._tokenizer||(N=a.sliceStream(Q),Q.next||N.push(null),V&&v.defineSkip(Q.start),Q._isInFirstContentOfListItem&&(v._gfmTasklistFirstContentOfListItem=!0),v.write(N),Q._isInFirstContentOfListItem&&(v._gfmTasklistFirstContentOfListItem=void 0)),V=Q,Q=Q.next}for(Q=n;++j<o.length;)o[j][0]==="exit"&&o[j-1][0]==="enter"&&o[j][1].type===o[j-1][1].type&&o[j][1].start.line!==o[j][1].end.line&&(me=j+1,Ue.push(me),Q._tokenizer=void 0,Q.previous=void 0,Q=Q.next);for(v.events=[],Q?(Q._tokenizer=void 0,Q.previous=void 0):Ue.pop(),j=Ue.length;j--;){const de=o.slice(Ue[j],Ue[j+1]),ge=m.pop();S.push([ge,ge+de.length-1]),t.splice(ge,2,de)}for(S.reverse(),j=-1;++j<S.length;)P[oe+S[j][0]]=oe+S[j][1],oe+=S[j][1]-S[j][0]-1;return P}const Ile={resolve:Ale,tokenize:Cle},Sle={partial:!0,tokenize:Ple};function Ale(t){return Xj(t),t}function Cle(t,e){let n;return a;function a(o){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),h(o)}function h(o){return o===null?m(o):Bi(o)?t.check(Sle,v,m)(o):(t.consume(o),h)}function m(o){return t.exit("chunkContent"),t.exit("content"),e(o)}function v(o){return t.consume(o),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,h}}function Ple(t,e,n){const a=this;return h;function h(v){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(v),t.exit("lineEnding"),ws(t,m,"linePrefix")}function m(v){if(v===null||Bi(v))return n(v);const o=a.events[a.events.length-1];return!a.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(v):t.interrupt(a.parser.constructs.flow,n,e)(v)}}function Kj(t,e,n,a,h,m,v,o,S){const P=S||Number.POSITIVE_INFINITY;let N=0;return V;function V(de){return de===60?(t.enter(a),t.enter(h),t.enter(m),t.consume(de),t.exit(m),j):de===null||de===32||de===41||r2(de)?n(de):(t.enter(a),t.enter(v),t.enter(o),t.enter("chunkString",{contentType:"string"}),me(de))}function j(de){return de===62?(t.enter(m),t.consume(de),t.exit(m),t.exit(h),t.exit(a),e):(t.enter(o),t.enter("chunkString",{contentType:"string"}),Q(de))}function Q(de){return de===62?(t.exit("chunkString"),t.exit(o),j(de)):de===null||de===60||Bi(de)?n(de):(t.consume(de),de===92?oe:Q)}function oe(de){return de===60||de===62||de===92?(t.consume(de),Q):Q(de)}function me(de){return!N&&(de===null||de===41||cl(de))?(t.exit("chunkString"),t.exit(o),t.exit(v),t.exit(a),e(de)):N<P&&de===40?(t.consume(de),N++,me):de===41?(t.consume(de),N--,me):de===null||de===32||de===40||r2(de)?n(de):(t.consume(de),de===92?Ue:me)}function Ue(de){return de===40||de===41||de===92?(t.consume(de),me):me(de)}}function Yj(t,e,n,a,h,m){const v=this;let o=0,S;return P;function P(Q){return t.enter(a),t.enter(h),t.consume(Q),t.exit(h),t.enter(m),N}function N(Q){return o>999||Q===null||Q===91||Q===93&&!S||Q===94&&!o&&"_hiddenFootnoteSupport"in v.parser.constructs?n(Q):Q===93?(t.exit(m),t.enter(h),t.consume(Q),t.exit(h),t.exit(a),e):Bi(Q)?(t.enter("lineEnding"),t.consume(Q),t.exit("lineEnding"),N):(t.enter("chunkString",{contentType:"string"}),V(Q))}function V(Q){return Q===null||Q===91||Q===93||Bi(Q)||o++>999?(t.exit("chunkString"),N(Q)):(t.consume(Q),S||(S=!Zr(Q)),Q===92?j:V)}function j(Q){return Q===91||Q===92||Q===93?(t.consume(Q),o++,V):V(Q)}}function Qj(t,e,n,a,h,m){let v;return o;function o(j){return j===34||j===39||j===40?(t.enter(a),t.enter(h),t.consume(j),t.exit(h),v=j===40?41:j,S):n(j)}function S(j){return j===v?(t.enter(h),t.consume(j),t.exit(h),t.exit(a),e):(t.enter(m),P(j))}function P(j){return j===v?(t.exit(m),S(v)):j===null?n(j):Bi(j)?(t.enter("lineEnding"),t.consume(j),t.exit("lineEnding"),ws(t,P,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),N(j))}function N(j){return j===v||j===null||Bi(j)?(t.exit("chunkString"),P(j)):(t.consume(j),j===92?V:N)}function V(j){return j===v||j===92?(t.consume(j),N):N(j)}}function Zv(t,e){let n;return a;function a(h){return Bi(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),n=!0,a):Zr(h)?ws(t,a,n?"linePrefix":"lineSuffix")(h):e(h)}}const Rle={name:"definition",tokenize:Mle},kle={partial:!0,tokenize:Dle};function Mle(t,e,n){const a=this;let h;return m;function m(Q){return t.enter("definition"),v(Q)}function v(Q){return Yj.call(a,t,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(Q)}function o(Q){return h=Eg(a.sliceSerialize(a.events[a.events.length-1][1]).slice(1,-1)),Q===58?(t.enter("definitionMarker"),t.consume(Q),t.exit("definitionMarker"),S):n(Q)}function S(Q){return cl(Q)?Zv(t,P)(Q):P(Q)}function P(Q){return Kj(t,N,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(Q)}function N(Q){return t.attempt(kle,V,V)(Q)}function V(Q){return Zr(Q)?ws(t,j,"whitespace")(Q):j(Q)}function j(Q){return Q===null||Bi(Q)?(t.exit("definition"),a.parser.defined.push(h),e(Q)):n(Q)}}function Dle(t,e,n){return a;function a(o){return cl(o)?Zv(t,h)(o):n(o)}function h(o){return Qj(t,m,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function m(o){return Zr(o)?ws(t,v,"whitespace")(o):v(o)}function v(o){return o===null||Bi(o)?e(o):n(o)}}const Lle={name:"hardBreakEscape",tokenize:Ole};function Ole(t,e,n){return a;function a(m){return t.enter("hardBreakEscape"),t.consume(m),h}function h(m){return Bi(m)?(t.exit("hardBreakEscape"),e(m)):n(m)}}const zle={name:"headingAtx",resolve:Fle,tokenize:Nle};function Fle(t,e){let n=t.length-2,a=3,h,m;return t[a][1].type==="whitespace"&&(a+=2),n-2>a&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(a===n-1||n-4>a&&t[n-2][1].type==="whitespace")&&(n-=a+1===n?2:4),n>a&&(h={type:"atxHeadingText",start:t[a][1].start,end:t[n][1].end},m={type:"chunkText",start:t[a][1].start,end:t[n][1].end,contentType:"text"},Su(t,a,n-a+1,[["enter",h,e],["enter",m,e],["exit",m,e],["exit",h,e]])),t}function Nle(t,e,n){let a=0;return h;function h(N){return t.enter("atxHeading"),m(N)}function m(N){return t.enter("atxHeadingSequence"),v(N)}function v(N){return N===35&&a++<6?(t.consume(N),v):N===null||cl(N)?(t.exit("atxHeadingSequence"),o(N)):n(N)}function o(N){return N===35?(t.enter("atxHeadingSequence"),S(N)):N===null||Bi(N)?(t.exit("atxHeading"),e(N)):Zr(N)?ws(t,o,"whitespace")(N):(t.enter("atxHeadingText"),P(N))}function S(N){return N===35?(t.consume(N),S):(t.exit("atxHeadingSequence"),o(N))}function P(N){return N===null||N===35||cl(N)?(t.exit("atxHeadingText"),o(N)):(t.consume(N),P)}}const Ble=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],c3=["pre","script","style","textarea"],Vle={concrete:!0,name:"htmlFlow",resolveTo:Gle,tokenize:$le},Ule={partial:!0,tokenize:qle},jle={partial:!0,tokenize:Hle};function Gle(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function $le(t,e,n){const a=this;let h,m,v,o,S;return P;function P(et){return N(et)}function N(et){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(et),V}function V(et){return et===33?(t.consume(et),j):et===47?(t.consume(et),m=!0,me):et===63?(t.consume(et),h=3,a.interrupt?e:je):gu(et)?(t.consume(et),v=String.fromCharCode(et),Ue):n(et)}function j(et){return et===45?(t.consume(et),h=2,Q):et===91?(t.consume(et),h=5,o=0,oe):gu(et)?(t.consume(et),h=4,a.interrupt?e:je):n(et)}function Q(et){return et===45?(t.consume(et),a.interrupt?e:je):n(et)}function oe(et){const Xr="CDATA[";return et===Xr.charCodeAt(o++)?(t.consume(et),o===Xr.length?a.interrupt?e:Qe:oe):n(et)}function me(et){return gu(et)?(t.consume(et),v=String.fromCharCode(et),Ue):n(et)}function Ue(et){if(et===null||et===47||et===62||cl(et)){const Xr=et===47,Kr=v.toLowerCase();return!Xr&&!m&&c3.includes(Kr)?(h=1,a.interrupt?e(et):Qe(et)):Ble.includes(v.toLowerCase())?(h=6,Xr?(t.consume(et),de):a.interrupt?e(et):Qe(et)):(h=7,a.interrupt&&!a.parser.lazy[a.now().line]?n(et):m?ge(et):Re(et))}return et===45||Sl(et)?(t.consume(et),v+=String.fromCharCode(et),Ue):n(et)}function de(et){return et===62?(t.consume(et),a.interrupt?e:Qe):n(et)}function ge(et){return Zr(et)?(t.consume(et),ge):Ve(et)}function Re(et){return et===47?(t.consume(et),Ve):et===58||et===95||gu(et)?(t.consume(et),_t):Zr(et)?(t.consume(et),Re):Ve(et)}function _t(et){return et===45||et===46||et===58||et===95||Sl(et)?(t.consume(et),_t):ct(et)}function ct(et){return et===61?(t.consume(et),nt):Zr(et)?(t.consume(et),ct):Re(et)}function nt(et){return et===null||et===60||et===61||et===62||et===96?n(et):et===34||et===39?(t.consume(et),S=et,Pe):Zr(et)?(t.consume(et),nt):xe(et)}function Pe(et){return et===S?(t.consume(et),S=null,ke):et===null||Bi(et)?n(et):(t.consume(et),Pe)}function xe(et){return et===null||et===34||et===39||et===47||et===60||et===61||et===62||et===96||cl(et)?ct(et):(t.consume(et),xe)}function ke(et){return et===47||et===62||Zr(et)?Re(et):n(et)}function Ve(et){return et===62?(t.consume(et),De):n(et)}function De(et){return et===null||Bi(et)?Qe(et):Zr(et)?(t.consume(et),De):n(et)}function Qe(et){return et===45&&h===2?(t.consume(et),ii):et===60&&h===1?(t.consume(et),Ii):et===62&&h===4?(t.consume(et),Pn):et===63&&h===3?(t.consume(et),je):et===93&&h===5?(t.consume(et),Vn):Bi(et)&&(h===6||h===7)?(t.exit("htmlFlowData"),t.check(Ule,oi,Be)(et)):et===null||Bi(et)?(t.exit("htmlFlowData"),Be(et)):(t.consume(et),Qe)}function Be(et){return t.check(jle,Hn,oi)(et)}function Hn(et){return t.enter("lineEnding"),t.consume(et),t.exit("lineEnding"),Ln}function Ln(et){return et===null||Bi(et)?Be(et):(t.enter("htmlFlowData"),Qe(et))}function ii(et){return et===45?(t.consume(et),je):Qe(et)}function Ii(et){return et===47?(t.consume(et),v="",vn):Qe(et)}function vn(et){if(et===62){const Xr=v.toLowerCase();return c3.includes(Xr)?(t.consume(et),Pn):Qe(et)}return gu(et)&&v.length<8?(t.consume(et),v+=String.fromCharCode(et),vn):Qe(et)}function Vn(et){return et===93?(t.consume(et),je):Qe(et)}function je(et){return et===62?(t.consume(et),Pn):et===45&&h===2?(t.consume(et),je):Qe(et)}function Pn(et){return et===null||Bi(et)?(t.exit("htmlFlowData"),oi(et)):(t.consume(et),Pn)}function oi(et){return t.exit("htmlFlow"),e(et)}}function Hle(t,e,n){const a=this;return h;function h(v){return Bi(v)?(t.enter("lineEnding"),t.consume(v),t.exit("lineEnding"),m):n(v)}function m(v){return a.parser.lazy[a.now().line]?n(v):e(v)}}function qle(t,e,n){return a;function a(h){return t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),t.attempt(QT,e,n)}}const Wle={name:"htmlText",tokenize:Zle};function Zle(t,e,n){const a=this;let h,m,v;return o;function o(je){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(je),S}function S(je){return je===33?(t.consume(je),P):je===47?(t.consume(je),ct):je===63?(t.consume(je),Re):gu(je)?(t.consume(je),xe):n(je)}function P(je){return je===45?(t.consume(je),N):je===91?(t.consume(je),m=0,oe):gu(je)?(t.consume(je),ge):n(je)}function N(je){return je===45?(t.consume(je),Q):n(je)}function V(je){return je===null?n(je):je===45?(t.consume(je),j):Bi(je)?(v=V,Ii(je)):(t.consume(je),V)}function j(je){return je===45?(t.consume(je),Q):V(je)}function Q(je){return je===62?ii(je):je===45?j(je):V(je)}function oe(je){const Pn="CDATA[";return je===Pn.charCodeAt(m++)?(t.consume(je),m===Pn.length?me:oe):n(je)}function me(je){return je===null?n(je):je===93?(t.consume(je),Ue):Bi(je)?(v=me,Ii(je)):(t.consume(je),me)}function Ue(je){return je===93?(t.consume(je),de):me(je)}function de(je){return je===62?ii(je):je===93?(t.consume(je),de):me(je)}function ge(je){return je===null||je===62?ii(je):Bi(je)?(v=ge,Ii(je)):(t.consume(je),ge)}function Re(je){return je===null?n(je):je===63?(t.consume(je),_t):Bi(je)?(v=Re,Ii(je)):(t.consume(je),Re)}function _t(je){return je===62?ii(je):Re(je)}function ct(je){return gu(je)?(t.consume(je),nt):n(je)}function nt(je){return je===45||Sl(je)?(t.consume(je),nt):Pe(je)}function Pe(je){return Bi(je)?(v=Pe,Ii(je)):Zr(je)?(t.consume(je),Pe):ii(je)}function xe(je){return je===45||Sl(je)?(t.consume(je),xe):je===47||je===62||cl(je)?ke(je):n(je)}function ke(je){return je===47?(t.consume(je),ii):je===58||je===95||gu(je)?(t.consume(je),Ve):Bi(je)?(v=ke,Ii(je)):Zr(je)?(t.consume(je),ke):ii(je)}function Ve(je){return je===45||je===46||je===58||je===95||Sl(je)?(t.consume(je),Ve):De(je)}function De(je){return je===61?(t.consume(je),Qe):Bi(je)?(v=De,Ii(je)):Zr(je)?(t.consume(je),De):ke(je)}function Qe(je){return je===null||je===60||je===61||je===62||je===96?n(je):je===34||je===39?(t.consume(je),h=je,Be):Bi(je)?(v=Qe,Ii(je)):Zr(je)?(t.consume(je),Qe):(t.consume(je),Hn)}function Be(je){return je===h?(t.consume(je),h=void 0,Ln):je===null?n(je):Bi(je)?(v=Be,Ii(je)):(t.consume(je),Be)}function Hn(je){return je===null||je===34||je===39||je===60||je===61||je===96?n(je):je===47||je===62||cl(je)?ke(je):(t.consume(je),Hn)}function Ln(je){return je===47||je===62||cl(je)?ke(je):n(je)}function ii(je){return je===62?(t.consume(je),t.exit("htmlTextData"),t.exit("htmlText"),e):n(je)}function Ii(je){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(je),t.exit("lineEnding"),vn}function vn(je){return Zr(je)?ws(t,Vn,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(je):Vn(je)}function Vn(je){return t.enter("htmlTextData"),v(je)}}const KR={name:"labelEnd",resolveAll:Qle,resolveTo:Jle,tokenize:ece},Xle={tokenize:tce},Kle={tokenize:nce},Yle={tokenize:ice};function Qle(t){let e=-1;const n=[];for(;++e<t.length;){const a=t[e][1];if(n.push(t[e]),a.type==="labelImage"||a.type==="labelLink"||a.type==="labelEnd"){const h=a.type==="labelImage"?4:2;a.type="data",e+=h}}return t.length!==n.length&&Su(t,0,t.length,n),t}function Jle(t,e){let n=t.length,a=0,h,m,v,o;for(;n--;)if(h=t[n][1],m){if(h.type==="link"||h.type==="labelLink"&&h._inactive)break;t[n][0]==="enter"&&h.type==="labelLink"&&(h._inactive=!0)}else if(v){if(t[n][0]==="enter"&&(h.type==="labelImage"||h.type==="labelLink")&&!h._balanced&&(m=n,h.type!=="labelLink")){a=2;break}}else h.type==="labelEnd"&&(v=n);const S={type:t[m][1].type==="labelLink"?"link":"image",start:{...t[m][1].start},end:{...t[t.length-1][1].end}},P={type:"label",start:{...t[m][1].start},end:{...t[v][1].end}},N={type:"labelText",start:{...t[m+a+2][1].end},end:{...t[v-2][1].start}};return o=[["enter",S,e],["enter",P,e]],o=Yl(o,t.slice(m+1,m+a+3)),o=Yl(o,[["enter",N,e]]),o=Yl(o,XR(e.parser.constructs.insideSpan.null,t.slice(m+a+4,v-3),e)),o=Yl(o,[["exit",N,e],t[v-2],t[v-1],["exit",P,e]]),o=Yl(o,t.slice(v+1)),o=Yl(o,[["exit",S,e]]),Su(t,m,t.length,o),t}function ece(t,e,n){const a=this;let h=a.events.length,m,v;for(;h--;)if((a.events[h][1].type==="labelImage"||a.events[h][1].type==="labelLink")&&!a.events[h][1]._balanced){m=a.events[h][1];break}return o;function o(j){return m?m._inactive?V(j):(v=a.parser.defined.includes(Eg(a.sliceSerialize({start:m.end,end:a.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(j),t.exit("labelMarker"),t.exit("labelEnd"),S):n(j)}function S(j){return j===40?t.attempt(Xle,N,v?N:V)(j):j===91?t.attempt(Kle,N,v?P:V)(j):v?N(j):V(j)}function P(j){return t.attempt(Yle,N,V)(j)}function N(j){return e(j)}function V(j){return m._balanced=!0,n(j)}}function tce(t,e,n){return a;function a(V){return t.enter("resource"),t.enter("resourceMarker"),t.consume(V),t.exit("resourceMarker"),h}function h(V){return cl(V)?Zv(t,m)(V):m(V)}function m(V){return V===41?N(V):Kj(t,v,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(V)}function v(V){return cl(V)?Zv(t,S)(V):N(V)}function o(V){return n(V)}function S(V){return V===34||V===39||V===40?Qj(t,P,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(V):N(V)}function P(V){return cl(V)?Zv(t,N)(V):N(V)}function N(V){return V===41?(t.enter("resourceMarker"),t.consume(V),t.exit("resourceMarker"),t.exit("resource"),e):n(V)}}function nce(t,e,n){const a=this;return h;function h(o){return Yj.call(a,t,m,v,"reference","referenceMarker","referenceString")(o)}function m(o){return a.parser.defined.includes(Eg(a.sliceSerialize(a.events[a.events.length-1][1]).slice(1,-1)))?e(o):n(o)}function v(o){return n(o)}}function ice(t,e,n){return a;function a(m){return t.enter("reference"),t.enter("referenceMarker"),t.consume(m),t.exit("referenceMarker"),h}function h(m){return m===93?(t.enter("referenceMarker"),t.consume(m),t.exit("referenceMarker"),t.exit("reference"),e):n(m)}}const rce={name:"labelStartImage",resolveAll:KR.resolveAll,tokenize:sce};function sce(t,e,n){const a=this;return h;function h(o){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(o),t.exit("labelImageMarker"),m}function m(o){return o===91?(t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelImage"),v):n(o)}function v(o){return o===94&&"_hiddenFootnoteSupport"in a.parser.constructs?n(o):e(o)}}const oce={name:"labelStartLink",resolveAll:KR.resolveAll,tokenize:ace};function ace(t,e,n){const a=this;return h;function h(v){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(v),t.exit("labelMarker"),t.exit("labelLink"),m}function m(v){return v===94&&"_hiddenFootnoteSupport"in a.parser.constructs?n(v):e(v)}}const iA={name:"lineEnding",tokenize:lce};function lce(t,e){return n;function n(a){return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),ws(t,e,"linePrefix")}}const K1={name:"thematicBreak",tokenize:cce};function cce(t,e,n){let a=0,h;return m;function m(P){return t.enter("thematicBreak"),v(P)}function v(P){return h=P,o(P)}function o(P){return P===h?(t.enter("thematicBreakSequence"),S(P)):a>=3&&(P===null||Bi(P))?(t.exit("thematicBreak"),e(P)):n(P)}function S(P){return P===h?(t.consume(P),a++,S):(t.exit("thematicBreakSequence"),Zr(P)?ws(t,o,"whitespace")(P):o(P))}}const Qa={continuation:{tokenize:fce},exit:mce,name:"list",tokenize:dce},uce={partial:!0,tokenize:gce},hce={partial:!0,tokenize:pce};function dce(t,e,n){const a=this,h=a.events[a.events.length-1];let m=h&&h[1].type==="linePrefix"?h[2].sliceSerialize(h[1],!0).length:0,v=0;return o;function o(Q){const oe=a.containerState.type||(Q===42||Q===43||Q===45?"listUnordered":"listOrdered");if(oe==="listUnordered"?!a.containerState.marker||Q===a.containerState.marker:s2(Q)){if(a.containerState.type||(a.containerState.type=oe,t.enter(oe,{_container:!0})),oe==="listUnordered")return t.enter("listItemPrefix"),Q===42||Q===45?t.check(K1,n,P)(Q):P(Q);if(!a.interrupt||Q===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),S(Q)}return n(Q)}function S(Q){return s2(Q)&&++v<10?(t.consume(Q),S):(!a.interrupt||v<2)&&(a.containerState.marker?Q===a.containerState.marker:Q===41||Q===46)?(t.exit("listItemValue"),P(Q)):n(Q)}function P(Q){return t.enter("listItemMarker"),t.consume(Q),t.exit("listItemMarker"),a.containerState.marker=a.containerState.marker||Q,t.check(QT,a.interrupt?n:N,t.attempt(uce,j,V))}function N(Q){return a.containerState.initialBlankLine=!0,m++,j(Q)}function V(Q){return Zr(Q)?(t.enter("listItemPrefixWhitespace"),t.consume(Q),t.exit("listItemPrefixWhitespace"),j):n(Q)}function j(Q){return a.containerState.size=m+a.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(Q)}}function fce(t,e,n){const a=this;return a.containerState._closeFlow=void 0,t.check(QT,h,m);function h(o){return a.containerState.furtherBlankLines=a.containerState.furtherBlankLines||a.containerState.initialBlankLine,ws(t,e,"listItemIndent",a.containerState.size+1)(o)}function m(o){return a.containerState.furtherBlankLines||!Zr(o)?(a.containerState.furtherBlankLines=void 0,a.containerState.initialBlankLine=void 0,v(o)):(a.containerState.furtherBlankLines=void 0,a.containerState.initialBlankLine=void 0,t.attempt(hce,e,v)(o))}function v(o){return a.containerState._closeFlow=!0,a.interrupt=void 0,ws(t,t.attempt(Qa,e,n),"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function pce(t,e,n){const a=this;return ws(t,h,"listItemIndent",a.containerState.size+1);function h(m){const v=a.events[a.events.length-1];return v&&v[1].type==="listItemIndent"&&v[2].sliceSerialize(v[1],!0).length===a.containerState.size?e(m):n(m)}}function mce(t){t.exit(this.containerState.type)}function gce(t,e,n){const a=this;return ws(t,h,"listItemPrefixWhitespace",a.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function h(m){const v=a.events[a.events.length-1];return!Zr(m)&&v&&v[1].type==="listItemPrefixWhitespace"?e(m):n(m)}}const u3={name:"setextUnderline",resolveTo:_ce,tokenize:yce};function _ce(t,e){let n=t.length,a,h,m;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){a=n;break}t[n][1].type==="paragraph"&&(h=n)}else t[n][1].type==="content"&&t.splice(n,1),!m&&t[n][1].type==="definition"&&(m=n);const v={type:"setextHeading",start:{...t[a][1].start},end:{...t[t.length-1][1].end}};return t[h][1].type="setextHeadingText",m?(t.splice(h,0,["enter",v,e]),t.splice(m+1,0,["exit",t[a][1],e]),t[a][1].end={...t[m][1].end}):t[a][1]=v,t.push(["exit",v,e]),t}function yce(t,e,n){const a=this;let h;return m;function m(P){let N=a.events.length,V;for(;N--;)if(a.events[N][1].type!=="lineEnding"&&a.events[N][1].type!=="linePrefix"&&a.events[N][1].type!=="content"){V=a.events[N][1].type==="paragraph";break}return!a.parser.lazy[a.now().line]&&(a.interrupt||V)?(t.enter("setextHeadingLine"),h=P,v(P)):n(P)}function v(P){return t.enter("setextHeadingLineSequence"),o(P)}function o(P){return P===h?(t.consume(P),o):(t.exit("setextHeadingLineSequence"),Zr(P)?ws(t,S,"lineSuffix")(P):S(P))}function S(P){return P===null||Bi(P)?(t.exit("setextHeadingLine"),e(P)):n(P)}}const vce={tokenize:xce};function xce(t){const e=this,n=t.attempt(QT,a,t.attempt(this.parser.constructs.flowInitial,h,ws(t,t.attempt(this.parser.constructs.flow,h,t.attempt(Ile,h)),"linePrefix")));return n;function a(m){if(m===null){t.consume(m);return}return t.enter("lineEndingBlank"),t.consume(m),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function h(m){if(m===null){t.consume(m);return}return t.enter("lineEnding"),t.consume(m),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const wce={resolveAll:e8()},bce=Jj("string"),Tce=Jj("text");function Jj(t){return{resolveAll:e8(t==="text"?Ece:void 0),tokenize:e};function e(n){const a=this,h=this.parser.constructs[t],m=n.attempt(h,v,o);return v;function v(N){return P(N)?m(N):o(N)}function o(N){if(N===null){n.consume(N);return}return n.enter("data"),n.consume(N),S}function S(N){return P(N)?(n.exit("data"),m(N)):(n.consume(N),S)}function P(N){if(N===null)return!0;const V=h[N];let j=-1;if(V)for(;++j<V.length;){const Q=V[j];if(!Q.previous||Q.previous.call(a,a.previous))return!0}return!1}}}function e8(t){return e;function e(n,a){let h=-1,m;for(;++h<=n.length;)m===void 0?n[h]&&n[h][1].type==="data"&&(m=h,h++):(!n[h]||n[h][1].type!=="data")&&(h!==m+2&&(n[m][1].end=n[h-1][1].end,n.splice(m+2,h-m-2),h=m+2),m=void 0);return t?t(n,a):n}}function Ece(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const a=t[n-1][1],h=e.sliceStream(a);let m=h.length,v=-1,o=0,S;for(;m--;){const P=h[m];if(typeof P=="string"){for(v=P.length;P.charCodeAt(v-1)===32;)o++,v--;if(v)break;v=-1}else if(P===-2)S=!0,o++;else if(P!==-1){m++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(o=0),o){const P={type:n===t.length||S||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:m?v:a.start._bufferIndex+v,_index:a.start._index+m,line:a.end.line,column:a.end.column-o,offset:a.end.offset-o},end:{...a.end}};a.end={...P.start},a.start.offset===a.end.offset?Object.assign(a,P):(t.splice(n,0,["enter",P,e],["exit",P,e]),n+=2)}n++}return t}const Ice={42:Qa,43:Qa,45:Qa,48:Qa,49:Qa,50:Qa,51:Qa,52:Qa,53:Qa,54:Qa,55:Qa,56:Qa,57:Qa,62:qj},Sce={91:Rle},Ace={[-2]:nA,[-1]:nA,32:nA},Cce={35:zle,42:K1,45:[u3,K1],60:Vle,61:u3,95:K1,96:l3,126:l3},Pce={38:Zj,92:Wj},Rce={[-5]:iA,[-4]:iA,[-3]:iA,33:rce,38:Zj,42:o2,60:[ole,Wle],91:oce,92:[Lle,Wj],93:KR,95:o2,96:vle},kce={null:[o2,wce]},Mce={null:[42,95]},Dce={null:[]},Lce=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Mce,contentInitial:Sce,disable:Dce,document:Ice,flow:Cce,flowInitial:Ace,insideSpan:kce,string:Pce,text:Rce},Symbol.toStringTag,{value:"Module"}));function Oce(t,e,n){let a={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const h={},m=[];let v=[],o=[];const S={attempt:Pe(ct),check:Pe(nt),consume:ge,enter:Re,exit:_t,interrupt:Pe(nt,{interrupt:!0})},P={code:null,containerState:{},defineSkip:me,events:[],now:oe,parser:t,previous:null,sliceSerialize:j,sliceStream:Q,write:V};let N=e.tokenize.call(P,S);return e.resolveAll&&m.push(e),P;function V(De){return v=Yl(v,De),Ue(),v[v.length-1]!==null?[]:(xe(e,0),P.events=XR(m,P.events,P),P.events)}function j(De,Qe){return Fce(Q(De),Qe)}function Q(De){return zce(v,De)}function oe(){const{_bufferIndex:De,_index:Qe,line:Be,column:Hn,offset:Ln}=a;return{_bufferIndex:De,_index:Qe,line:Be,column:Hn,offset:Ln}}function me(De){h[De.line]=De.column,Ve()}function Ue(){let De;for(;a._index<v.length;){const Qe=v[a._index];if(typeof Qe=="string")for(De=a._index,a._bufferIndex<0&&(a._bufferIndex=0);a._index===De&&a._bufferIndex<Qe.length;)de(Qe.charCodeAt(a._bufferIndex));else de(Qe)}}function de(De){N=N(De)}function ge(De){Bi(De)?(a.line++,a.column=1,a.offset+=De===-3?2:1,Ve()):De!==-1&&(a.column++,a.offset++),a._bufferIndex<0?a._index++:(a._bufferIndex++,a._bufferIndex===v[a._index].length&&(a._bufferIndex=-1,a._index++)),P.previous=De}function Re(De,Qe){const Be=Qe||{};return Be.type=De,Be.start=oe(),P.events.push(["enter",Be,P]),o.push(Be),Be}function _t(De){const Qe=o.pop();return Qe.end=oe(),P.events.push(["exit",Qe,P]),Qe}function ct(De,Qe){xe(De,Qe.from)}function nt(De,Qe){Qe.restore()}function Pe(De,Qe){return Be;function Be(Hn,Ln,ii){let Ii,vn,Vn,je;return Array.isArray(Hn)?oi(Hn):"tokenize"in Hn?oi([Hn]):Pn(Hn);function Pn(qn){return zi;function zi(ar){const rs=ar!==null&&qn[ar],Wi=ar!==null&&qn.null,$s=[...Array.isArray(rs)?rs:rs?[rs]:[],...Array.isArray(Wi)?Wi:Wi?[Wi]:[]];return oi($s)(ar)}}function oi(qn){return Ii=qn,vn=0,qn.length===0?ii:et(qn[vn])}function et(qn){return zi;function zi(ar){return je=ke(),Vn=qn,qn.partial||(P.currentConstruct=qn),qn.name&&P.parser.constructs.disable.null.includes(qn.name)?Kr():qn.tokenize.call(Qe?Object.assign(Object.create(P),Qe):P,S,Xr,Kr)(ar)}}function Xr(qn){return De(Vn,je),Ln}function Kr(qn){return je.restore(),++vn<Ii.length?et(Ii[vn]):ii}}}function xe(De,Qe){De.resolveAll&&!m.includes(De)&&m.push(De),De.resolve&&Su(P.events,Qe,P.events.length-Qe,De.resolve(P.events.slice(Qe),P)),De.resolveTo&&(P.events=De.resolveTo(P.events,P))}function ke(){const De=oe(),Qe=P.previous,Be=P.currentConstruct,Hn=P.events.length,Ln=Array.from(o);return{from:Hn,restore:ii};function ii(){a=De,P.previous=Qe,P.currentConstruct=Be,P.events.length=Hn,o=Ln,Ve()}}function Ve(){a.line in h&&a.column<2&&(a.column=h[a.line],a.offset+=h[a.line]-1)}}function zce(t,e){const n=e.start._index,a=e.start._bufferIndex,h=e.end._index,m=e.end._bufferIndex;let v;if(n===h)v=[t[n].slice(a,m)];else{if(v=t.slice(n,h),a>-1){const o=v[0];typeof o=="string"?v[0]=o.slice(a):v.shift()}m>0&&v.push(t[h].slice(0,m))}return v}function Fce(t,e){let n=-1;const a=[];let h;for(;++n<t.length;){const m=t[n];let v;if(typeof m=="string")v=m;else switch(m){case-5:{v="\r";break}case-4:{v=`
`;break}case-3:{v=`\r
`;break}case-2:{v=e?" ":"	";break}case-1:{if(!e&&h)continue;v=" ";break}default:v=String.fromCharCode(m)}h=m===-2,a.push(v)}return a.join("")}function Nce(t){const a={constructs:Hae([Lce,...(t||{}).extensions||[]]),content:h(Jae),defined:[],document:h(tle),flow:h(vce),lazy:{},string:h(bce),text:h(Tce)};return a;function h(m){return v;function v(o){return Oce(a,m,o)}}}function Bce(t){for(;!Xj(t););return t}const h3=/[\0\t\n\r]/g;function Vce(){let t=1,e="",n=!0,a;return h;function h(m,v,o){const S=[];let P,N,V,j,Q;for(m=e+(typeof m=="string"?m.toString():new TextDecoder(v||void 0).decode(m)),V=0,e="",n&&(m.charCodeAt(0)===65279&&V++,n=void 0);V<m.length;){if(h3.lastIndex=V,P=h3.exec(m),j=P&&P.index!==void 0?P.index:m.length,Q=m.charCodeAt(j),!P){e=m.slice(V);break}if(Q===10&&V===j&&a)S.push(-3),a=void 0;else switch(a&&(S.push(-5),a=void 0),V<j&&(S.push(m.slice(V,j)),t+=j-V),Q){case 0:{S.push(65533),t++;break}case 9:{for(N=Math.ceil(t/4)*4,S.push(-2);t++<N;)S.push(-1);break}case 10:{S.push(-4),t=1;break}default:a=!0,t=1}V=j+1}return o&&(a&&S.push(-5),e&&S.push(e),S.push(null)),S}}const Uce=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function jce(t){return t.replace(Uce,Gce)}function Gce(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const h=n.charCodeAt(1),m=h===120||h===88;return Hj(n.slice(m?2:1),m?16:10)}return ZR(n)||t}const t8={}.hasOwnProperty;function $ce(t,e,n){return typeof e!="string"&&(n=e,e=void 0),Hce(n)(Bce(Nce(n).document().write(Vce()(t,e,!0))))}function Hce(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:m(Qs),autolinkProtocol:ke,autolinkEmail:ke,atxHeading:m(Vi),blockQuote:m(Wi),characterEscape:ke,characterReference:ke,codeFenced:m($s),codeFencedFenceInfo:v,codeFencedFenceMeta:v,codeIndented:m($s,v),codeText:m(Po,v),codeTextData:ke,data:ke,codeFlowValue:ke,definition:m(Ea),definitionDestinationString:v,definitionLabelString:v,definitionTitleString:v,emphasis:m(Hs),hardBreakEscape:m(Ts),hardBreakTrailing:m(Ts),htmlFlow:m(Ro,v),htmlFlowData:ke,htmlText:m(Ro,v),htmlTextData:ke,image:m(ia),label:v,link:m(Qs),listItem:m(Es),listItemValue:j,listOrdered:m(ds,V),listUnordered:m(ds),paragraph:m(ko),reference:et,referenceString:v,resourceDestinationString:v,resourceTitleString:v,setextHeading:m(Vi),strong:m(io),thematicBreak:m(ra)},exit:{atxHeading:S(),atxHeadingSequence:ct,autolink:S(),autolinkEmail:rs,autolinkProtocol:ar,blockQuote:S(),characterEscapeValue:Ve,characterReferenceMarkerHexadecimal:Kr,characterReferenceMarkerNumeric:Kr,characterReferenceValue:qn,characterReference:zi,codeFenced:S(Ue),codeFencedFence:me,codeFencedFenceInfo:Q,codeFencedFenceMeta:oe,codeFlowValue:Ve,codeIndented:S(de),codeText:S(Ln),codeTextData:Ve,data:Ve,definition:S(),definitionDestinationString:_t,definitionLabelString:ge,definitionTitleString:Re,emphasis:S(),hardBreakEscape:S(Qe),hardBreakTrailing:S(Qe),htmlFlow:S(Be),htmlFlowData:Ve,htmlText:S(Hn),htmlTextData:Ve,image:S(Ii),label:Vn,labelText:vn,lineEnding:De,link:S(ii),listItem:S(),listOrdered:S(),listUnordered:S(),paragraph:S(),referenceString:Xr,resourceDestinationString:je,resourceTitleString:Pn,resource:oi,setextHeading:S(xe),setextHeadingLineSequence:Pe,setextHeadingText:nt,strong:S(),thematicBreak:S()}};n8(e,(t||{}).mdastExtensions||[]);const n={};return a;function a(Dt){let Qt={type:"root",children:[]};const ai={stack:[Qt],tokenStack:[],config:e,enter:o,exit:P,buffer:v,resume:N,data:n},vi=[];let er=-1;for(;++er<Dt.length;)if(Dt[er][1].type==="listOrdered"||Dt[er][1].type==="listUnordered")if(Dt[er][0]==="enter")vi.push(er);else{const wr=vi.pop();er=h(Dt,wr,er)}for(er=-1;++er<Dt.length;){const wr=e[Dt[er][0]];t8.call(wr,Dt[er][1].type)&&wr[Dt[er][1].type].call(Object.assign({sliceSerialize:Dt[er][2].sliceSerialize},ai),Dt[er][1])}if(ai.tokenStack.length>0){const wr=ai.tokenStack[ai.tokenStack.length-1];(wr[1]||d3).call(ai,void 0,wr[0])}for(Qt.position={start:gd(Dt.length>0?Dt[0][1].start:{line:1,column:1,offset:0}),end:gd(Dt.length>0?Dt[Dt.length-2][1].end:{line:1,column:1,offset:0})},er=-1;++er<e.transforms.length;)Qt=e.transforms[er](Qt)||Qt;return Qt}function h(Dt,Qt,ai){let vi=Qt-1,er=-1,wr=!1,Ur,fs,Ds,qs;for(;++vi<=ai;){const ss=Dt[vi];switch(ss[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ss[0]==="enter"?er++:er--,qs=void 0;break}case"lineEndingBlank":{ss[0]==="enter"&&(Ur&&!qs&&!er&&!Ds&&(Ds=vi),qs=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:qs=void 0}if(!er&&ss[0]==="enter"&&ss[1].type==="listItemPrefix"||er===-1&&ss[0]==="exit"&&(ss[1].type==="listUnordered"||ss[1].type==="listOrdered")){if(Ur){let Js=vi;for(fs=void 0;Js--;){const mi=Dt[Js];if(mi[1].type==="lineEnding"||mi[1].type==="lineEndingBlank"){if(mi[0]==="exit")continue;fs&&(Dt[fs][1].type="lineEndingBlank",wr=!0),mi[1].type="lineEnding",fs=Js}else if(!(mi[1].type==="linePrefix"||mi[1].type==="blockQuotePrefix"||mi[1].type==="blockQuotePrefixWhitespace"||mi[1].type==="blockQuoteMarker"||mi[1].type==="listItemIndent"))break}Ds&&(!fs||Ds<fs)&&(Ur._spread=!0),Ur.end=Object.assign({},fs?Dt[fs][1].start:ss[1].end),Dt.splice(fs||vi,0,["exit",Ur,ss[2]]),vi++,ai++}if(ss[1].type==="listItemPrefix"){const Js={type:"listItem",_spread:!1,start:Object.assign({},ss[1].start),end:void 0};Ur=Js,Dt.splice(vi,0,["enter",Js,ss[2]]),vi++,ai++,Ds=void 0,qs=!0}}}return Dt[Qt][1]._spread=wr,ai}function m(Dt,Qt){return ai;function ai(vi){o.call(this,Dt(vi),vi),Qt&&Qt.call(this,vi)}}function v(){this.stack.push({type:"fragment",children:[]})}function o(Dt,Qt,ai){this.stack[this.stack.length-1].children.push(Dt),this.stack.push(Dt),this.tokenStack.push([Qt,ai||void 0]),Dt.position={start:gd(Qt.start),end:void 0}}function S(Dt){return Qt;function Qt(ai){Dt&&Dt.call(this,ai),P.call(this,ai)}}function P(Dt,Qt){const ai=this.stack.pop(),vi=this.tokenStack.pop();if(vi)vi[0].type!==Dt.type&&(Qt?Qt.call(this,Dt,vi[0]):(vi[1]||d3).call(this,Dt,vi[0]));else throw new Error("Cannot close `"+Dt.type+"` ("+Wv({start:Dt.start,end:Dt.end})+"): its not open");ai.position.end=gd(Dt.end)}function N(){return Gae(this.stack.pop())}function V(){this.data.expectingFirstListItemValue=!0}function j(Dt){if(this.data.expectingFirstListItemValue){const Qt=this.stack[this.stack.length-2];Qt.start=Number.parseInt(this.sliceSerialize(Dt),10),this.data.expectingFirstListItemValue=void 0}}function Q(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.lang=Dt}function oe(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.meta=Dt}function me(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function Ue(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.value=Dt.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function de(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.value=Dt.replace(/(\r?\n|\r)$/g,"")}function ge(Dt){const Qt=this.resume(),ai=this.stack[this.stack.length-1];ai.label=Qt,ai.identifier=Eg(this.sliceSerialize(Dt)).toLowerCase()}function Re(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.title=Dt}function _t(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.url=Dt}function ct(Dt){const Qt=this.stack[this.stack.length-1];if(!Qt.depth){const ai=this.sliceSerialize(Dt).length;Qt.depth=ai}}function nt(){this.data.setextHeadingSlurpLineEnding=!0}function Pe(Dt){const Qt=this.stack[this.stack.length-1];Qt.depth=this.sliceSerialize(Dt).codePointAt(0)===61?1:2}function xe(){this.data.setextHeadingSlurpLineEnding=void 0}function ke(Dt){const ai=this.stack[this.stack.length-1].children;let vi=ai[ai.length-1];(!vi||vi.type!=="text")&&(vi=Mo(),vi.position={start:gd(Dt.start),end:void 0},ai.push(vi)),this.stack.push(vi)}function Ve(Dt){const Qt=this.stack.pop();Qt.value+=this.sliceSerialize(Dt),Qt.position.end=gd(Dt.end)}function De(Dt){const Qt=this.stack[this.stack.length-1];if(this.data.atHardBreak){const ai=Qt.children[Qt.children.length-1];ai.position.end=gd(Dt.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Qt.type)&&(ke.call(this,Dt),Ve.call(this,Dt))}function Qe(){this.data.atHardBreak=!0}function Be(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.value=Dt}function Hn(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.value=Dt}function Ln(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.value=Dt}function ii(){const Dt=this.stack[this.stack.length-1];if(this.data.inReference){const Qt=this.data.referenceType||"shortcut";Dt.type+="Reference",Dt.referenceType=Qt,delete Dt.url,delete Dt.title}else delete Dt.identifier,delete Dt.label;this.data.referenceType=void 0}function Ii(){const Dt=this.stack[this.stack.length-1];if(this.data.inReference){const Qt=this.data.referenceType||"shortcut";Dt.type+="Reference",Dt.referenceType=Qt,delete Dt.url,delete Dt.title}else delete Dt.identifier,delete Dt.label;this.data.referenceType=void 0}function vn(Dt){const Qt=this.sliceSerialize(Dt),ai=this.stack[this.stack.length-2];ai.label=jce(Qt),ai.identifier=Eg(Qt).toLowerCase()}function Vn(){const Dt=this.stack[this.stack.length-1],Qt=this.resume(),ai=this.stack[this.stack.length-1];if(this.data.inReference=!0,ai.type==="link"){const vi=Dt.children;ai.children=vi}else ai.alt=Qt}function je(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.url=Dt}function Pn(){const Dt=this.resume(),Qt=this.stack[this.stack.length-1];Qt.title=Dt}function oi(){this.data.inReference=void 0}function et(){this.data.referenceType="collapsed"}function Xr(Dt){const Qt=this.resume(),ai=this.stack[this.stack.length-1];ai.label=Qt,ai.identifier=Eg(this.sliceSerialize(Dt)).toLowerCase(),this.data.referenceType="full"}function Kr(Dt){this.data.characterReferenceType=Dt.type}function qn(Dt){const Qt=this.sliceSerialize(Dt),ai=this.data.characterReferenceType;let vi;ai?(vi=Hj(Qt,ai==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):vi=ZR(Qt);const er=this.stack[this.stack.length-1];er.value+=vi}function zi(Dt){const Qt=this.stack.pop();Qt.position.end=gd(Dt.end)}function ar(Dt){Ve.call(this,Dt);const Qt=this.stack[this.stack.length-1];Qt.url=this.sliceSerialize(Dt)}function rs(Dt){Ve.call(this,Dt);const Qt=this.stack[this.stack.length-1];Qt.url="mailto:"+this.sliceSerialize(Dt)}function Wi(){return{type:"blockquote",children:[]}}function $s(){return{type:"code",lang:null,meta:null,value:""}}function Po(){return{type:"inlineCode",value:""}}function Ea(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Hs(){return{type:"emphasis",children:[]}}function Vi(){return{type:"heading",depth:0,children:[]}}function Ts(){return{type:"break"}}function Ro(){return{type:"html",value:""}}function ia(){return{type:"image",title:null,url:"",alt:null}}function Qs(){return{type:"link",title:null,url:"",children:[]}}function ds(Dt){return{type:"list",ordered:Dt.type==="listOrdered",start:null,spread:Dt._spread,children:[]}}function Es(Dt){return{type:"listItem",spread:Dt._spread,checked:null,children:[]}}function ko(){return{type:"paragraph",children:[]}}function io(){return{type:"strong",children:[]}}function Mo(){return{type:"text",value:""}}function ra(){return{type:"thematicBreak"}}}function gd(t){return{line:t.line,column:t.column,offset:t.offset}}function n8(t,e){let n=-1;for(;++n<e.length;){const a=e[n];Array.isArray(a)?n8(t,a):qce(t,a)}}function qce(t,e){let n;for(n in e)if(t8.call(e,n))switch(n){case"canContainEols":{const a=e[n];a&&t[n].push(...a);break}case"transforms":{const a=e[n];a&&t[n].push(...a);break}case"enter":case"exit":{const a=e[n];a&&Object.assign(t[n],a);break}}}function d3(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Wv({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Wv({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Wv({start:e.start,end:e.end})+") is still open")}function Wce(t){const e=this;e.parser=n;function n(a){return $ce(a,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function Zce(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function Xce(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function Kce(t,e){const n=e.value?e.value+`
`:"",a={};e.lang&&(a.className=["language-"+e.lang]);let h={type:"element",tagName:"code",properties:a,children:[{type:"text",value:n}]};return e.meta&&(h.data={meta:e.meta}),t.patch(e,h),h=t.applyData(e,h),h={type:"element",tagName:"pre",properties:{},children:[h]},t.patch(e,h),h}function Yce(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function Qce(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function Jce(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",a=String(e.identifier).toUpperCase(),h=l_(a.toLowerCase()),m=t.footnoteOrder.indexOf(a);let v,o=t.footnoteCounts.get(a);o===void 0?(o=0,t.footnoteOrder.push(a),v=t.footnoteOrder.length):v=m+1,o+=1,t.footnoteCounts.set(a,o);const S={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+h,id:n+"fnref-"+h+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(v)}]};t.patch(e,S);const P={type:"element",tagName:"sup",properties:{},children:[S]};return t.patch(e,P),t.applyData(e,P)}function eue(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function tue(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function i8(t,e){const n=e.referenceType;let a="]";if(n==="collapsed"?a+="[]":n==="full"&&(a+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+a}];const h=t.all(e),m=h[0];m&&m.type==="text"?m.value="["+m.value:h.unshift({type:"text",value:"["});const v=h[h.length-1];return v&&v.type==="text"?v.value+=a:h.push({type:"text",value:a}),h}function nue(t,e){const n=String(e.identifier).toUpperCase(),a=t.definitionById.get(n);if(!a)return i8(t,e);const h={src:l_(a.url||""),alt:e.alt};a.title!==null&&a.title!==void 0&&(h.title=a.title);const m={type:"element",tagName:"img",properties:h,children:[]};return t.patch(e,m),t.applyData(e,m)}function iue(t,e){const n={src:l_(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const a={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,a),t.applyData(e,a)}function rue(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const a={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,a),t.applyData(e,a)}function sue(t,e){const n=String(e.identifier).toUpperCase(),a=t.definitionById.get(n);if(!a)return i8(t,e);const h={href:l_(a.url||"")};a.title!==null&&a.title!==void 0&&(h.title=a.title);const m={type:"element",tagName:"a",properties:h,children:t.all(e)};return t.patch(e,m),t.applyData(e,m)}function oue(t,e){const n={href:l_(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const a={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,a),t.applyData(e,a)}function aue(t,e,n){const a=t.all(e),h=n?lue(n):r8(e),m={},v=[];if(typeof e.checked=="boolean"){const N=a[0];let V;N&&N.type==="element"&&N.tagName==="p"?V=N:(V={type:"element",tagName:"p",properties:{},children:[]},a.unshift(V)),V.children.length>0&&V.children.unshift({type:"text",value:" "}),V.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),m.className=["task-list-item"]}let o=-1;for(;++o<a.length;){const N=a[o];(h||o!==0||N.type!=="element"||N.tagName!=="p")&&v.push({type:"text",value:`
`}),N.type==="element"&&N.tagName==="p"&&!h?v.push(...N.children):v.push(N)}const S=a[a.length-1];S&&(h||S.type!=="element"||S.tagName!=="p")&&v.push({type:"text",value:`
`});const P={type:"element",tagName:"li",properties:m,children:v};return t.patch(e,P),t.applyData(e,P)}function lue(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let a=-1;for(;!e&&++a<n.length;)e=r8(n[a])}return e}function r8(t){const e=t.spread;return e??t.children.length>1}function cue(t,e){const n={},a=t.all(e);let h=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++h<a.length;){const v=a[h];if(v.type==="element"&&v.tagName==="li"&&v.properties&&Array.isArray(v.properties.className)&&v.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const m={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(a,!0)};return t.patch(e,m),t.applyData(e,m)}function uue(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function hue(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function due(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function fue(t,e){const n=t.all(e),a=n.shift(),h=[];if(a){const v={type:"element",tagName:"thead",properties:{},children:t.wrap([a],!0)};t.patch(e.children[0],v),h.push(v)}if(n.length>0){const v={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},o=$R(e.children[1]),S=Nj(e.children[e.children.length-1]);o&&S&&(v.position={start:o,end:S}),h.push(v)}const m={type:"element",tagName:"table",properties:{},children:t.wrap(h,!0)};return t.patch(e,m),t.applyData(e,m)}function pue(t,e,n){const a=n?n.children:void 0,m=(a?a.indexOf(e):1)===0?"th":"td",v=n&&n.type==="table"?n.align:void 0,o=v?v.length:e.children.length;let S=-1;const P=[];for(;++S<o;){const V=e.children[S],j={},Q=v?v[S]:void 0;Q&&(j.align=Q);let oe={type:"element",tagName:m,properties:j,children:[]};V&&(oe.children=t.all(V),t.patch(V,oe),oe=t.applyData(V,oe)),P.push(oe)}const N={type:"element",tagName:"tr",properties:{},children:t.wrap(P,!0)};return t.patch(e,N),t.applyData(e,N)}function mue(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const f3=9,p3=32;function gue(t){const e=String(t),n=/\r?\n|\r/g;let a=n.exec(e),h=0;const m=[];for(;a;)m.push(m3(e.slice(h,a.index),h>0,!0),a[0]),h=a.index+a[0].length,a=n.exec(e);return m.push(m3(e.slice(h),h>0,!1)),m.join("")}function m3(t,e,n){let a=0,h=t.length;if(e){let m=t.codePointAt(a);for(;m===f3||m===p3;)a++,m=t.codePointAt(a)}if(n){let m=t.codePointAt(h-1);for(;m===f3||m===p3;)h--,m=t.codePointAt(h-1)}return h>a?t.slice(a,h):""}function _ue(t,e){const n={type:"text",value:gue(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function yue(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const vue={blockquote:Zce,break:Xce,code:Kce,delete:Yce,emphasis:Qce,footnoteReference:Jce,heading:eue,html:tue,imageReference:nue,image:iue,inlineCode:rue,linkReference:sue,link:oue,listItem:aue,list:cue,paragraph:uue,root:hue,strong:due,table:fue,tableCell:mue,tableRow:pue,text:_ue,thematicBreak:yue,toml:b1,yaml:b1,definition:b1,footnoteDefinition:b1};function b1(){}const s8=-1,JT=0,Xv=1,Jb=2,YR=3,QR=4,JR=5,ek=6,o8=7,a8=8,g3=typeof self=="object"?self:globalThis,xue=(t,e)=>{const n=(h,m)=>(t.set(m,h),h),a=h=>{if(t.has(h))return t.get(h);const[m,v]=e[h];switch(m){case JT:case s8:return n(v,h);case Xv:{const o=n([],h);for(const S of v)o.push(a(S));return o}case Jb:{const o=n({},h);for(const[S,P]of v)o[a(S)]=a(P);return o}case YR:return n(new Date(v),h);case QR:{const{source:o,flags:S}=v;return n(new RegExp(o,S),h)}case JR:{const o=n(new Map,h);for(const[S,P]of v)o.set(a(S),a(P));return o}case ek:{const o=n(new Set,h);for(const S of v)o.add(a(S));return o}case o8:{const{name:o,message:S}=v;return n(new g3[o](S),h)}case a8:return n(BigInt(v),h);case"BigInt":return n(Object(BigInt(v)),h);case"ArrayBuffer":return n(new Uint8Array(v).buffer,v);case"DataView":{const{buffer:o}=new Uint8Array(v);return n(new DataView(o),v)}}return n(new g3[m](v),h)};return a},_3=t=>xue(new Map,t)(0),$m="",{toString:wue}={},{keys:bue}=Object,gv=t=>{const e=typeof t;if(e!=="object"||!t)return[JT,e];const n=wue.call(t).slice(8,-1);switch(n){case"Array":return[Xv,$m];case"Object":return[Jb,$m];case"Date":return[YR,$m];case"RegExp":return[QR,$m];case"Map":return[JR,$m];case"Set":return[ek,$m];case"DataView":return[Xv,n]}return n.includes("Array")?[Xv,n]:n.includes("Error")?[o8,n]:[Jb,n]},T1=([t,e])=>t===JT&&(e==="function"||e==="symbol"),Tue=(t,e,n,a)=>{const h=(v,o)=>{const S=a.push(v)-1;return n.set(o,S),S},m=v=>{if(n.has(v))return n.get(v);let[o,S]=gv(v);switch(o){case JT:{let N=v;switch(S){case"bigint":o=a8,N=v.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+S);N=null;break;case"undefined":return h([s8],v)}return h([o,N],v)}case Xv:{if(S){let j=v;return S==="DataView"?j=new Uint8Array(v.buffer):S==="ArrayBuffer"&&(j=new Uint8Array(v)),h([S,[...j]],v)}const N=[],V=h([o,N],v);for(const j of v)N.push(m(j));return V}case Jb:{if(S)switch(S){case"BigInt":return h([S,v.toString()],v);case"Boolean":case"Number":case"String":return h([S,v.valueOf()],v)}if(e&&"toJSON"in v)return m(v.toJSON());const N=[],V=h([o,N],v);for(const j of bue(v))(t||!T1(gv(v[j])))&&N.push([m(j),m(v[j])]);return V}case YR:return h([o,v.toISOString()],v);case QR:{const{source:N,flags:V}=v;return h([o,{source:N,flags:V}],v)}case JR:{const N=[],V=h([o,N],v);for(const[j,Q]of v)(t||!(T1(gv(j))||T1(gv(Q))))&&N.push([m(j),m(Q)]);return V}case ek:{const N=[],V=h([o,N],v);for(const j of v)(t||!T1(gv(j)))&&N.push(m(j));return V}}const{message:P}=v;return h([o,{name:S,message:P}],v)};return m},y3=(t,{json:e,lossy:n}={})=>{const a=[];return Tue(!(e||n),!!e,new Map,a)(t),a},eT=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?_3(y3(t,e)):structuredClone(t):(t,e)=>_3(y3(t,e));function Eue(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function Iue(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function Sue(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||Eue,a=t.options.footnoteBackLabel||Iue,h=t.options.footnoteLabel||"Footnotes",m=t.options.footnoteLabelTagName||"h2",v=t.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let S=-1;for(;++S<t.footnoteOrder.length;){const P=t.footnoteById.get(t.footnoteOrder[S]);if(!P)continue;const N=t.all(P),V=String(P.identifier).toUpperCase(),j=l_(V.toLowerCase());let Q=0;const oe=[],me=t.footnoteCounts.get(V);for(;me!==void 0&&++Q<=me;){oe.length>0&&oe.push({type:"text",value:" "});let ge=typeof n=="string"?n:n(S,Q);typeof ge=="string"&&(ge={type:"text",value:ge}),oe.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+j+(Q>1?"-"+Q:""),dataFootnoteBackref:"",ariaLabel:typeof a=="string"?a:a(S,Q),className:["data-footnote-backref"]},children:Array.isArray(ge)?ge:[ge]})}const Ue=N[N.length-1];if(Ue&&Ue.type==="element"&&Ue.tagName==="p"){const ge=Ue.children[Ue.children.length-1];ge&&ge.type==="text"?ge.value+=" ":Ue.children.push({type:"text",value:" "}),Ue.children.push(...oe)}else N.push(...oe);const de={type:"element",tagName:"li",properties:{id:e+"fn-"+j},children:t.wrap(N,!0)};t.patch(P,de),o.push(de)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:m,properties:{...eT(v),id:"footnote-label"},children:[{type:"text",value:h}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(o,!0)},{type:"text",value:`
`}]}}const l8=function(t){if(t==null)return Rue;if(typeof t=="function")return eE(t);if(typeof t=="object")return Array.isArray(t)?Aue(t):Cue(t);if(typeof t=="string")return Pue(t);throw new Error("Expected function, string, or object as test")};function Aue(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=l8(t[n]);return eE(a);function a(...h){let m=-1;for(;++m<e.length;)if(e[m].apply(this,h))return!0;return!1}}function Cue(t){const e=t;return eE(n);function n(a){const h=a;let m;for(m in t)if(h[m]!==e[m])return!1;return!0}}function Pue(t){return eE(e);function e(n){return n&&n.type===t}}function eE(t){return e;function e(n,a,h){return!!(kue(n)&&t.call(this,n,typeof a=="number"?a:void 0,h||void 0))}}function Rue(){return!0}function kue(t){return t!==null&&typeof t=="object"&&"type"in t}const c8=[],Mue=!0,v3=!1,Due="skip";function Lue(t,e,n,a){let h;typeof e=="function"&&typeof n!="function"?(a=n,n=e):h=e;const m=l8(h),v=a?-1:1;o(t,void 0,[])();function o(S,P,N){const V=S&&typeof S=="object"?S:{};if(typeof V.type=="string"){const Q=typeof V.tagName=="string"?V.tagName:typeof V.name=="string"?V.name:void 0;Object.defineProperty(j,"name",{value:"node ("+(S.type+(Q?"<"+Q+">":""))+")"})}return j;function j(){let Q=c8,oe,me,Ue;if((!e||m(S,P,N[N.length-1]||void 0))&&(Q=Oue(n(S,N)),Q[0]===v3))return Q;if("children"in S&&S.children){const de=S;if(de.children&&Q[0]!==Due)for(me=(a?de.children.length:-1)+v,Ue=N.concat(de);me>-1&&me<de.children.length;){const ge=de.children[me];if(oe=o(ge,me,Ue)(),oe[0]===v3)return oe;me=typeof oe[1]=="number"?oe[1]:me+v}}return Q}}}function Oue(t){return Array.isArray(t)?t:typeof t=="number"?[Mue,t]:t==null?c8:[t]}function u8(t,e,n,a){let h,m,v;typeof e=="function"&&typeof n!="function"?(m=void 0,v=e,h=n):(m=e,v=n,h=a),Lue(t,m,o,h);function o(S,P){const N=P[P.length-1],V=N?N.children.indexOf(S):void 0;return v(S,V,N)}}const a2={}.hasOwnProperty,zue={};function Fue(t,e){const n=e||zue,a=new Map,h=new Map,m=new Map,v={...vue,...n.handlers},o={all:P,applyData:Bue,definitionById:a,footnoteById:h,footnoteCounts:m,footnoteOrder:[],handlers:v,one:S,options:n,patch:Nue,wrap:Uue};return u8(t,function(N){if(N.type==="definition"||N.type==="footnoteDefinition"){const V=N.type==="definition"?a:h,j=String(N.identifier).toUpperCase();V.has(j)||V.set(j,N)}}),o;function S(N,V){const j=N.type,Q=o.handlers[j];if(a2.call(o.handlers,j)&&Q)return Q(o,N,V);if(o.options.passThrough&&o.options.passThrough.includes(j)){if("children"in N){const{children:me,...Ue}=N,de=eT(Ue);return de.children=o.all(N),de}return eT(N)}return(o.options.unknownHandler||Vue)(o,N,V)}function P(N){const V=[];if("children"in N){const j=N.children;let Q=-1;for(;++Q<j.length;){const oe=o.one(j[Q],N);if(oe){if(Q&&j[Q-1].type==="break"&&(!Array.isArray(oe)&&oe.type==="text"&&(oe.value=x3(oe.value)),!Array.isArray(oe)&&oe.type==="element")){const me=oe.children[0];me&&me.type==="text"&&(me.value=x3(me.value))}Array.isArray(oe)?V.push(...oe):V.push(oe)}}}return V}}function Nue(t,e){t.position&&(e.position=wae(t))}function Bue(t,e){let n=e;if(t&&t.data){const a=t.data.hName,h=t.data.hChildren,m=t.data.hProperties;if(typeof a=="string")if(n.type==="element")n.tagName=a;else{const v="children"in n?n.children:[n];n={type:"element",tagName:a,properties:{},children:v}}n.type==="element"&&m&&Object.assign(n.properties,eT(m)),"children"in n&&n.children&&h!==null&&h!==void 0&&(n.children=h)}return n}function Vue(t,e){const n=e.data||{},a="value"in e&&!(a2.call(n,"hProperties")||a2.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,a),t.applyData(e,a)}function Uue(t,e){const n=[];let a=-1;for(e&&n.push({type:"text",value:`
`});++a<t.length;)a&&n.push({type:"text",value:`
`}),n.push(t[a]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function x3(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function w3(t,e){const n=Fue(t,e),a=n.one(t,void 0),h=Sue(n),m=Array.isArray(a)?{type:"root",children:a}:a||{type:"root",children:[]};return h&&m.children.push({type:"text",value:`
`},h),m}function jue(t,e){return t&&"run"in t?async function(n,a){const h=w3(n,{file:a,...e});await t.run(h,a)}:function(n,a){return w3(n,{file:a,...t||e})}}function b3(t){if(t)throw t}var Y1=Object.prototype.hasOwnProperty,h8=Object.prototype.toString,T3=Object.defineProperty,E3=Object.getOwnPropertyDescriptor,I3=function(e){return typeof Array.isArray=="function"?Array.isArray(e):h8.call(e)==="[object Array]"},S3=function(e){if(!e||h8.call(e)!=="[object Object]")return!1;var n=Y1.call(e,"constructor"),a=e.constructor&&e.constructor.prototype&&Y1.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!a)return!1;var h;for(h in e);return typeof h>"u"||Y1.call(e,h)},A3=function(e,n){T3&&n.name==="__proto__"?T3(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},C3=function(e,n){if(n==="__proto__")if(Y1.call(e,n)){if(E3)return E3(e,n).value}else return;return e[n]},Gue=function t(){var e,n,a,h,m,v,o=arguments[0],S=1,P=arguments.length,N=!1;for(typeof o=="boolean"&&(N=o,o=arguments[1]||{},S=2),(o==null||typeof o!="object"&&typeof o!="function")&&(o={});S<P;++S)if(e=arguments[S],e!=null)for(n in e)a=C3(o,n),h=C3(e,n),o!==h&&(N&&h&&(S3(h)||(m=I3(h)))?(m?(m=!1,v=a&&I3(a)?a:[]):v=a&&S3(a)?a:{},A3(o,{name:n,newValue:t(N,v,h)})):typeof h<"u"&&A3(o,{name:n,newValue:h}));return o};const rA=tT(Gue);function l2(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function $ue(){const t=[],e={run:n,use:a};return e;function n(...h){let m=-1;const v=h.pop();if(typeof v!="function")throw new TypeError("Expected function as last argument, not "+v);o(null,...h);function o(S,...P){const N=t[++m];let V=-1;if(S){v(S);return}for(;++V<h.length;)(P[V]===null||P[V]===void 0)&&(P[V]=h[V]);h=P,N?Hue(N,o)(...P):v(null,...P)}}function a(h){if(typeof h!="function")throw new TypeError("Expected `middelware` to be a function, not "+h);return t.push(h),e}}function Hue(t,e){let n;return a;function a(...v){const o=t.length>v.length;let S;o&&v.push(h);try{S=t.apply(this,v)}catch(P){const N=P;if(o&&n)throw N;return h(N)}o||(S&&S.then&&typeof S.then=="function"?S.then(m,h):S instanceof Error?h(S):m(S))}function h(v,...o){n||(n=!0,e(v,...o))}function m(v){h(null,v)}}const fu={basename:que,dirname:Wue,extname:Zue,join:Xue,sep:"/"};function que(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');n0(t);let n=0,a=-1,h=t.length,m;if(e===void 0||e.length===0||e.length>t.length){for(;h--;)if(t.codePointAt(h)===47){if(m){n=h+1;break}}else a<0&&(m=!0,a=h+1);return a<0?"":t.slice(n,a)}if(e===t)return"";let v=-1,o=e.length-1;for(;h--;)if(t.codePointAt(h)===47){if(m){n=h+1;break}}else v<0&&(m=!0,v=h+1),o>-1&&(t.codePointAt(h)===e.codePointAt(o--)?o<0&&(a=h):(o=-1,a=v));return n===a?a=v:a<0&&(a=t.length),t.slice(n,a)}function Wue(t){if(n0(t),t.length===0)return".";let e=-1,n=t.length,a;for(;--n;)if(t.codePointAt(n)===47){if(a){e=n;break}}else a||(a=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function Zue(t){n0(t);let e=t.length,n=-1,a=0,h=-1,m=0,v;for(;e--;){const o=t.codePointAt(e);if(o===47){if(v){a=e+1;break}continue}n<0&&(v=!0,n=e+1),o===46?h<0?h=e:m!==1&&(m=1):h>-1&&(m=-1)}return h<0||n<0||m===0||m===1&&h===n-1&&h===a+1?"":t.slice(h,n)}function Xue(...t){let e=-1,n;for(;++e<t.length;)n0(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":Kue(n)}function Kue(t){n0(t);const e=t.codePointAt(0)===47;let n=Yue(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function Yue(t,e){let n="",a=0,h=-1,m=0,v=-1,o,S;for(;++v<=t.length;){if(v<t.length)o=t.codePointAt(v);else{if(o===47)break;o=47}if(o===47){if(!(h===v-1||m===1))if(h!==v-1&&m===2){if(n.length<2||a!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(S=n.lastIndexOf("/"),S!==n.length-1){S<0?(n="",a=0):(n=n.slice(0,S),a=n.length-1-n.lastIndexOf("/")),h=v,m=0;continue}}else if(n.length>0){n="",a=0,h=v,m=0;continue}}e&&(n=n.length>0?n+"/..":"..",a=2)}else n.length>0?n+="/"+t.slice(h+1,v):n=t.slice(h+1,v),a=v-h-1;h=v,m=0}else o===46&&m>-1?m++:m=-1}return n}function n0(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const Que={cwd:Jue};function Jue(){return"/"}function c2(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function ehe(t){if(typeof t=="string")t=new URL(t);else if(!c2(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return the(t)}function the(t){if(t.hostname!==""){const a=new TypeError('File URL host must be "localhost" or empty on darwin');throw a.code="ERR_INVALID_FILE_URL_HOST",a}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const a=e.codePointAt(n+2);if(a===70||a===102){const h=new TypeError("File URL path must not include encoded / characters");throw h.code="ERR_INVALID_FILE_URL_PATH",h}}return decodeURIComponent(e)}const sA=["history","path","basename","stem","extname","dirname"];class d8{constructor(e){let n;e?c2(e)?n={path:e}:typeof e=="string"||nhe(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":Que.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let a=-1;for(;++a<sA.length;){const m=sA[a];m in n&&n[m]!==void 0&&n[m]!==null&&(this[m]=m==="history"?[...n[m]]:n[m])}let h;for(h in n)sA.includes(h)||(this[h]=n[h])}get basename(){return typeof this.path=="string"?fu.basename(this.path):void 0}set basename(e){aA(e,"basename"),oA(e,"basename"),this.path=fu.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?fu.dirname(this.path):void 0}set dirname(e){P3(this.basename,"dirname"),this.path=fu.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?fu.extname(this.path):void 0}set extname(e){if(oA(e,"extname"),P3(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=fu.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){c2(e)&&(e=ehe(e)),aA(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?fu.basename(this.path,this.extname):void 0}set stem(e){aA(e,"stem"),oA(e,"stem"),this.path=fu.join(this.dirname||"",e+(this.extname||""))}fail(e,n,a){const h=this.message(e,n,a);throw h.fatal=!0,h}info(e,n,a){const h=this.message(e,n,a);return h.fatal=void 0,h}message(e,n,a){const h=new Ta(e,n,a);return this.path&&(h.name=this.path+":"+h.name,h.file=this.path),h.fatal=!1,this.messages.push(h),h}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function oA(t,e){if(t&&t.includes(fu.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+fu.sep+"`")}function aA(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function P3(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function nhe(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const ihe=function(t){const a=this.constructor.prototype,h=a[t],m=function(){return h.apply(m,arguments)};return Object.setPrototypeOf(m,a),m},rhe={}.hasOwnProperty;class tk extends ihe{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=$ue()}copy(){const e=new tk;let n=-1;for(;++n<this.attachers.length;){const a=this.attachers[n];e.use(...a)}return e.data(rA(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(uA("data",this.frozen),this.namespace[e]=n,this):rhe.call(this.namespace,e)&&this.namespace[e]||void 0:e?(uA("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...a]=this.attachers[this.freezeIndex];if(a[0]===!1)continue;a[0]===!0&&(a[0]=void 0);const h=n.call(e,...a);typeof h=="function"&&this.transformers.use(h)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=E1(e),a=this.parser||this.Parser;return lA("parse",a),a(String(n),n)}process(e,n){const a=this;return this.freeze(),lA("process",this.parser||this.Parser),cA("process",this.compiler||this.Compiler),n?h(void 0,n):new Promise(h);function h(m,v){const o=E1(e),S=a.parse(o);a.run(S,o,function(N,V,j){if(N||!V||!j)return P(N);const Q=V,oe=a.stringify(Q,j);ahe(oe)?j.value=oe:j.result=oe,P(N,j)});function P(N,V){N||!V?v(N):m?m(V):n(void 0,V)}}}processSync(e){let n=!1,a;return this.freeze(),lA("processSync",this.parser||this.Parser),cA("processSync",this.compiler||this.Compiler),this.process(e,h),k3("processSync","process",n),a;function h(m,v){n=!0,b3(m),a=v}}run(e,n,a){R3(e),this.freeze();const h=this.transformers;return!a&&typeof n=="function"&&(a=n,n=void 0),a?m(void 0,a):new Promise(m);function m(v,o){const S=E1(n);h.run(e,S,P);function P(N,V,j){const Q=V||e;N?o(N):v?v(Q):a(void 0,Q,j)}}}runSync(e,n){let a=!1,h;return this.run(e,n,m),k3("runSync","run",a),h;function m(v,o){b3(v),h=o,a=!0}}stringify(e,n){this.freeze();const a=E1(n),h=this.compiler||this.Compiler;return cA("stringify",h),R3(e),h(e,a)}use(e,...n){const a=this.attachers,h=this.namespace;if(uA("use",this.frozen),e!=null)if(typeof e=="function")S(e,n);else if(typeof e=="object")Array.isArray(e)?o(e):v(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function m(P){if(typeof P=="function")S(P,[]);else if(typeof P=="object")if(Array.isArray(P)){const[N,...V]=P;S(N,V)}else v(P);else throw new TypeError("Expected usable value, not `"+P+"`")}function v(P){if(!("plugins"in P)&&!("settings"in P))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(P.plugins),P.settings&&(h.settings=rA(!0,h.settings,P.settings))}function o(P){let N=-1;if(P!=null)if(Array.isArray(P))for(;++N<P.length;){const V=P[N];m(V)}else throw new TypeError("Expected a list of plugins, not `"+P+"`")}function S(P,N){let V=-1,j=-1;for(;++V<a.length;)if(a[V][0]===P){j=V;break}if(j===-1)a.push([P,...N]);else if(N.length>0){let[Q,...oe]=N;const me=a[j][1];l2(me)&&l2(Q)&&(Q=rA(!0,me,Q)),a[j]=[P,Q,...oe]}}}}const she=new tk().freeze();function lA(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function cA(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function uA(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function R3(t){if(!l2(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function k3(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function E1(t){return ohe(t)?t:new d8(t)}function ohe(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function ahe(t){return typeof t=="string"||lhe(t)}function lhe(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const che="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",M3=[],D3={allowDangerousHtml:!0},uhe=/^(https?|ircs?|mailto|xmpp)$/i,hhe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function dhe(t){const e=fhe(t),n=phe(t);return mhe(e.runSync(e.parse(n),n),t)}function fhe(t){const e=t.rehypePlugins||M3,n=t.remarkPlugins||M3,a=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...D3}:D3;return she().use(Wce).use(n).use(jue,a).use(e)}function phe(t){const e=t.children||"",n=new d8;return typeof e=="string"&&(n.value=e),n}function mhe(t,e){const n=e.allowedElements,a=e.allowElement,h=e.components,m=e.disallowedElements,v=e.skipHtml,o=e.unwrapDisallowed,S=e.urlTransform||ghe;for(const N of hhe)Object.hasOwn(e,N.from)&&(""+N.from+(N.to?"use `"+N.to+"` instead":"remove it")+che+N.id,void 0);return e.className&&(t={type:"element",tagName:"div",properties:{className:e.className},children:t.type==="root"?t.children:[t]}),u8(t,P),Sae(t,{Fragment:mn.Fragment,components:h,ignoreInvalidStyle:!0,jsx:mn.jsx,jsxs:mn.jsxs,passKeys:!0,passNode:!0});function P(N,V,j){if(N.type==="raw"&&j&&typeof V=="number")return v?j.children.splice(V,1):j.children[V]={type:"text",value:N.value},V;if(N.type==="element"){let Q;for(Q in tA)if(Object.hasOwn(tA,Q)&&Object.hasOwn(N.properties,Q)){const oe=N.properties[Q],me=tA[Q];(me===null||me.includes(N.tagName))&&(N.properties[Q]=S(String(oe||""),Q,N))}}if(N.type==="element"){let Q=n?!n.includes(N.tagName):m?m.includes(N.tagName):!1;if(!Q&&a&&typeof V=="number"&&(Q=!a(N,V,j)),Q&&j&&typeof V=="number")return o&&N.children?j.children.splice(V,1,...N.children):j.children.splice(V,1),V}}}function ghe(t){const e=t.indexOf(":"),n=t.indexOf("?"),a=t.indexOf("#"),h=t.indexOf("/");return e===-1||h!==-1&&e>h||n!==-1&&e>n||a!==-1&&e>a||uhe.test(t.slice(0,e))?t:""}function _he({value:t,onChange:e}){const[n,a]=yt.useState("edit");return mn.jsxs("div",{className:"glass rounded-xl overflow-hidden border border-white/10",children:[mn.jsxs("div",{className:"flex gap-2 p-2 bg-surface border-b border-white/10",children:[mn.jsx("button",{type:"button",onClick:()=>a("edit"),disabled:n==="edit",className:`px-3 py-1 rounded-md text-sm font-medium transition ${n==="edit"?"bg-accent text-white shadow":"bg-surface text-slate-300 hover:bg-white/5"}`,children:""}),mn.jsx("button",{type:"button",onClick:()=>a("preview"),disabled:n==="preview",className:`px-3 py-1 rounded-md text-sm font-medium transition ${n==="preview"?"bg-accent text-white shadow":"bg-surface text-slate-300 hover:bg-white/5"}`,children:""})]}),n==="edit"?mn.jsx("textarea",{className:"w-full min-h-[140px] p-3 bg-surface text-slate-200 border-0 outline-none resize-none placeholder-slate-500",value:t,onChange:h=>e(h.target.value),placeholder:"  Markdown..."}):mn.jsx("div",{className:"p-3 prose prose-invert max-w-none text-slate-200",children:mn.jsx(dhe,{children:(t==null?void 0:t.trim())||"* ...*"})})]})}function yhe(t){const e=h=>new Date(h).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Event Planner//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${`${Date.now()}@event-planner`}`,`DTSTAMP:${e(new Date)}`,`DTSTART:${e(t.start)}`,`DTEND:${e(t.end||t.start)}`,`SUMMARY:${hA(t.title)}`,`DESCRIPTION:${hA(t.description||"")}`,`LOCATION:${hA(t.location||"")}`,"END:VEVENT","END:VCALENDAR"].join(`\r
`)}function hA(t){return String(t).replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;")}function vhe(t){const e=new Blob([yhe(t)],{type:"text/calendar;charset=utf-8"}),n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=`${(t.title||"event").replace(/\W+/g,"_")}.ics`,a.click(),URL.revokeObjectURL(n)}function xhe(t){return`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:t.title||"",dates:whe(t.start,t.end||t.start),details:t.description||"",location:t.location||""}).toString()}`}function whe(t,e){const n=a=>new Date(a).toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";return`${n(t)}/${n(e)}`}function f8(){const[t,e]=yt.useState(null),[n,a]=yt.useState(null),[h,m]=yt.useState(!0);return yt.useEffect(()=>{if(!("geolocation"in navigator)){a("Geolocation API "),m(!1);return}let v=!1;const o=navigator.geolocation.watchPosition(S=>{v||(e({lat:S.coords.latitude,lng:S.coords.longitude}),a(null),m(!1))},S=>{v||(a((S==null?void 0:S.message)||"   "),m(!1))},{enableHighAccuracy:!0,maximumAge:1e4,timeout:8e3});return()=>{v=!0,o!=null&&navigator.geolocation.clearWatch(o)}},[]),{position:t,error:n,loading:h}}const L3={lat:50.4501,lng:30.5234};function bhe({user:t,onCreate:e}){const[n,a]=yt.useState(""),[h,m]=yt.useState(""),[v,o]=yt.useState(""),[S,P]=yt.useState(""),[N,V]=yt.useState(null),[j,Q]=yt.useState(""),{position:oe,loading:me,error:Ue}=f8(),de=Number.isFinite(oe==null?void 0:oe.lat)&&Number.isFinite(oe==null?void 0:oe.lng);yt.useEffect(()=>{de&&!N&&V(oe)},[de,oe,N]);async function ge(ct){if(ct.preventDefault(),!n||!v){alert("  / ");return}const nt={title:n,description:h,start:new Date(v).toISOString(),end:S?new Date(S).toISOString():null,location:j,center:N||oe||L3,owner:t.uid,participants:[t.uid],category:"meeting"};await e(nt),a(""),m(""),o(""),P(""),Q(""),V(null)}const Re={title:n,description:h,start:v||new Date().toISOString(),end:S||v,location:j},_t=N||oe||L3;return mn.jsxs("form",{onSubmit:ge,className:"grid gap-3",children:[mn.jsx("input",{className:"input",value:n,onChange:ct=>a(ct.target.value),placeholder:" ",required:!0}),mn.jsxs("div",{className:"field-row",children:[mn.jsx("input",{className:"input",type:"datetime-local",value:v,onChange:ct=>o(ct.target.value),required:!0}),mn.jsx("input",{className:"input",type:"datetime-local",value:S,onChange:ct=>P(ct.target.value)})]}),mn.jsx("input",{className:"input",value:j,onChange:ct=>Q(ct.target.value),placeholder:"/ ()"}),mn.jsxs("div",{className:"relative rounded-xl overflow-hidden border border-white/10",children:[mn.jsx(Roe,{center:_t,onPick:V}),(me||Ue)&&mn.jsx("div",{className:"absolute inset-0 grid place-items-center pointer-events-none text-slate-400 text-sm",children:me?" ":"      "})]}),mn.jsx("div",{className:"glass p-0",children:mn.jsx(_he,{value:h,onChange:m})}),mn.jsxs("div",{className:"flex flex-wrap gap-2",children:[mn.jsx("button",{type:"submit",className:"btn-primary",children:" "}),mn.jsx("a",{href:xhe(Re),target:"_blank",rel:"noreferrer",className:"btn-ghost",children:"  Google Calendar"}),mn.jsx("button",{type:"button",className:"btn-ghost",onClick:()=>vhe(Re),children:" .ics"})]})]})}function The({title:t,titleId:e,...n},a){return yt.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":e},n),t?yt.createElement("title",{id:e},t):null,yt.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z"}))}const Ehe=yt.forwardRef(The);function Ihe({title:t,titleId:e,...n},a){return yt.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":e},n),t?yt.createElement("title",{id:e},t):null,yt.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const She=yt.forwardRef(Ihe);function Ahe({title:t,titleId:e,...n},a){return yt.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":e},n),t?yt.createElement("title",{id:e},t):null,yt.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),yt.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const Che=yt.forwardRef(Ahe);function Phe({title:t,titleId:e,...n},a){return yt.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":e},n),t?yt.createElement("title",{id:e},t):null,yt.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const Rhe=yt.forwardRef(Phe);function khe({title:t,titleId:e,...n},a){return yt.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":e},n),t?yt.createElement("title",{id:e},t):null,yt.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m.94 3.198.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0 1 12 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 0 1 6 18.719m12 0a5.971 5.971 0 0 0-.941-3.197m0 0A5.995 5.995 0 0 0 12 12.75a5.995 5.995 0 0 0-5.058 2.772m0 0a3 3 0 0 0-4.681 2.72 8.986 8.986 0 0 0 3.74.477m.94-3.197a5.971 5.971 0 0 0-.94 3.197M15 6.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm6 3a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-13.5 0a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Z"}))}const Mhe=yt.forwardRef(khe);function Dhe({events:t,onRemove:e,onToggleJoin:n,user:a}){const[h,m]=yt.useState(""),[v,o]=yt.useState("all"),S=yt.useMemo(()=>t.filter(P=>{const V=[P.title,P.location,P.description].filter(Boolean).join(" ").toLowerCase().includes(h.toLowerCase()),j=v==="all"||P.category===v;return V&&j}),[t,h,v]);return mn.jsxs("div",{className:"space-y-3",children:[mn.jsxs("div",{className:"glass p-2 flex flex-col md:flex-row gap-2",children:[mn.jsx("input",{className:"input flex-1",placeholder:"...",value:h,onChange:P=>m(P.target.value)}),mn.jsxs("select",{className:"input md:w-48",value:v,onChange:P=>o(P.target.value),children:[mn.jsx("option",{value:"all",children:""}),mn.jsx("option",{value:"meeting",children:""}),mn.jsx("option",{value:"trip",children:""}),mn.jsx("option",{value:"party",children:""})]})]}),mn.jsx("ul",{className:"grid gap-3",children:S.map(P=>{var oe,me;let N="",V="";try{if(P.start){const Ue=new Date(P.start);N=Ue.toLocaleDateString(),V=Ue.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}catch{N=" "}const j=(a==null?void 0:a.uid)&&((oe=P.participants)==null?void 0:oe.includes(a.uid)),Q=(a==null?void 0:a.uid)&&P.owner===a.uid;return mn.jsxs("li",{className:"list-card",children:[mn.jsxs("div",{className:"flex items-start justify-between gap-3",children:[mn.jsxs("div",{className:"min-w-0",children:[mn.jsx("div",{className:"text-base font-bold truncate",children:P.title}),mn.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-slate-300",children:[mn.jsxs("span",{className:"inline-flex items-center gap-1",children:[mn.jsx(Ehe,{className:"size-4 opacity-80"}),N]}),V&&mn.jsxs("span",{className:"inline-flex items-center gap-1",children:[mn.jsx(She,{className:"size-4 opacity-80"}),V]}),mn.jsxs("span",{className:"inline-flex items-center gap-1",children:[mn.jsx(Che,{className:"size-4 opacity-80"}),P.location||""]}),mn.jsxs("span",{className:"inline-flex items-center gap-1",children:[mn.jsx(Mhe,{className:"size-4 opacity-80"}),((me=P.participants)==null?void 0:me.length)||0]})]})]}),a&&mn.jsxs("div",{className:"flex shrink-0 items-center gap-2",children:[mn.jsx("button",{className:`btn-ghost ${j?"border-[#7c5cff] text-white":""}`,onClick:()=>n(P),title:j?"":"",children:j?"":""}),Q&&mn.jsxs("button",{className:"btn-danger",onClick:()=>e(P.id),title:"",children:[mn.jsx(Rhe,{className:"size-4 mr-1"}),""]})]})]}),P.description&&mn.jsx("div",{className:"mt-2 text-sm text-slate-200 whitespace-pre-wrap",children:P.description})]},P.id)})}),S.length===0&&mn.jsx("div",{className:"glass p-4 text-sm text-slate-400",children:"  ."})]})}async function Lhe(t,e){const n="fd8e1a4ec0af9a7428b56cf7e1bd4da2";if(typeof t!="number"||typeof e!="number")throw new Error("   ");const a=`https://api.openweathermap.org/data/2.5/weather?lat=${t}&lon=${e}&units=metric&lang=ru&appid=${n}`,h=await fetch(a);if(!h.ok){let m="";try{const v=await h.json();m=v!=null&&v.message?`: ${v.message}`:""}catch{}throw new Error("   "+h.status+m)}return h.json()}function Ohe({coords:t}){var P,N,V;const[e,n]=yt.useState(null),[a,h]=yt.useState(null),[m,v]=yt.useState(!1),o=yt.useRef(0),S=t&&Number.isFinite(t.lat)&&Number.isFinite(t.lng);return yt.useEffect(()=>{if(!S)return;const j=++o.current;v(!0),h(null),n(null),Lhe(t.lat,t.lng).then(Q=>{o.current===j&&n(Q)}).catch(Q=>{o.current===j&&h((Q==null?void 0:Q.message)||"   ")}).finally(()=>{o.current===j&&v(!1)})},[t==null?void 0:t.lat,t==null?void 0:t.lng,S]),mn.jsxs("section",{className:"card mt-4",children:[mn.jsx("h2",{className:"title",children:""}),!S&&mn.jsx("p",{className:"text-sm text-slate-400",children:"   .         ."}),a&&mn.jsxs("p",{className:"text-sm text-rose-400","aria-live":"assertive",children:[": ",a]}),m&&mn.jsx("p",{className:"text-sm text-slate-400","aria-live":"polite",children:" "}),e&&mn.jsxs("div",{className:"mb-3",children:[mn.jsx("h3",{className:"font-semibold mb-1",children:""}),mn.jsxs("p",{className:"text-sm text-slate-200",children:[e!=null&&e.name?`${e.name}: `:null,Number.isFinite((P=e==null?void 0:e.main)==null?void 0:P.temp)?Math.round(e.main.temp):"","C",", ",((V=(N=e==null?void 0:e.weather)==null?void 0:N[0])==null?void 0:V.description)||" "]})]}),mn.jsxs("div",{children:[mn.jsx("h3",{className:"font-semibold mb-1",children:""}),mn.jsxs("ul",{className:"list-disc list-inside text-sm text-slate-300",children:[mn.jsx("li",{children:"    ,   ."}),mn.jsx("li",{children:"        ."})]})]})]})}function zhe({onEmailLogin:t,onEmailRegister:e,onGoogle:n}){const[a,h]=yt.useState(""),[m,v]=yt.useState(""),[o,S]=yt.useState(null),[P,N]=yt.useState(!1);async function V(){S(null),N(!0);try{await t(a.trim(),m)}catch(oe){S((oe==null?void 0:oe.message)||" ")}finally{N(!1)}}async function j(){S(null),N(!0);try{await e(a.trim(),m)}catch(oe){S((oe==null?void 0:oe.message)||" ")}finally{N(!1)}}async function Q(){S(null),N(!0);try{await n()}catch(oe){S((oe==null?void 0:oe.message)||"   Google")}finally{N(!1)}}return mn.jsx("div",{className:"min-h-screen justify-center bg-zinc-950 text-zinc-100 flex flex-col items-center p-4",children:mn.jsxs("div",{className:"card w-96",children:[mn.jsx("h1",{className:"title text-center",children:""}),mn.jsxs("div",{className:"grid gap-3",children:[mn.jsx("input",{className:"input",placeholder:"Email",value:a,onChange:oe=>h(oe.target.value)}),mn.jsx("input",{type:"password",className:"input",placeholder:"",value:m,onChange:oe=>v(oe.target.value)}),mn.jsx("button",{onClick:V,disabled:P,className:"btn-primary",children:"  email"}),mn.jsx("button",{onClick:j,disabled:P,className:"btn-ghost",children:""}),mn.jsx("button",{onClick:Q,disabled:P,className:"btn-ghost",children:"  Google"}),o&&mn.jsx("div",{className:"text-xs text-rose-500 mt-1",children:o})]})]})})}function Fhe(){const{user:t,loading:e,loginEmail:n,registerEmail:a,loginGoogle:h,logout:m}=Eoe(),{events:v,addEvent:o,removeEvent:S}=Aoe(t==null?void 0:t.uid),{position:P}=f8();yt.useEffect(()=>{if(!t)return;async function j(){const oe=await boe();if(oe)try{const me=Ex(cg,"users",t.uid);await LC(me,{fcmTokens:VF(oe)}).catch(()=>{})}catch{}}j();const Q=Toe(oe=>{console.log(" FCM:",oe)});return()=>Q&&Q()},[t]);async function N(j){var me;const Q=Ex(cg,"events",j.id),oe=(me=j.participants)==null?void 0:me.includes(t.uid);await LC(Q,{participants:oe?ite(t.uid):VF(t.uid)})}if(e)return mn.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-slate-50 to-indigo-50",children:mn.jsx("div",{className:"text-slate-600 animate-pulse",children:"..."})});if(!t)return mn.jsx(zhe,{onEmailLogin:n,onEmailRegister:a,onGoogle:h});const V=Number.isFinite(P==null?void 0:P.lat)&&Number.isFinite(P==null?void 0:P.lng);return mn.jsxs("div",{className:"min-h-screen bg-zinc-950 text-zinc-100 flex flex-col items-center p-4",children:[mn.jsxs("header",{className:"sticky top-0 z-10 glass px-4 py-3 mb-4 max-w-4xl w-full flex justify-between items-center",children:[mn.jsx("div",{className:"font-extrabold text-lg flex items-center gap-2",children:" Event Planner"}),mn.jsxs("div",{className:"flex items-center gap-3",children:[mn.jsx("span",{className:"text-xs text-zinc-400",children:t.email}),mn.jsx("button",{onClick:m,className:"btn-ghost text-sm px-3 py-1.5",children:""})]})]}),mn.jsxs("main",{className:"grid gap-6 max-w-4xl w-full",children:[mn.jsxs("section",{className:"card",children:[mn.jsx("h2",{className:"title",children:" "}),mn.jsx(bhe,{user:t,onCreate:o})]}),mn.jsxs("section",{className:"card",children:[mn.jsx("h2",{className:"title",children:" "}),mn.jsx("div",{className:"text-xs text-slate-500 mb-2",children:V?` : ${P.lat.toFixed(4)}, ${P.lng.toFixed(4)}`:" ..."}),V&&mn.jsx(Ohe,{coords:P})]}),mn.jsxs("section",{className:"card",children:[mn.jsx("h2",{className:"title",children:" "}),mn.jsx(Dhe,{events:v,onRemove:S,onToggleJoin:N,user:t})]})]})]})}W4(document.getElementById("root")).render(mn.jsx(I7,{children:mn.jsx(Fhe,{})}));
//# sourceMappingURL=index-CeFXJQoz.js.map
